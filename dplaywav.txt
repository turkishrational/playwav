     1                                  ; ****************************************************************************
     2                                  ; dplaywav.s - TRDOS 386 (TRDOS v2.0.9) WAV PLAYER - VESA VBE Video Mode 101h
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; DPLAYWAV.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 21/12/2024
     7                                  ;
     8                                  ; [ Last Modification: 18/01/2025 ]
     9                                  ;
    10                                  ; Modified from PLAYWAV9.PRG .wav player program by Erdogan Tan, 18/12/2024
    11                                  ;
    12                                  ; ****************************************************************************
    13                                  ; nasm dplaywav.s -l dplaywav.txt -o DPLAYWAV.PRG -Z error.txt
    14                                  ; (modified from 'circle10.s', 18/02/2021)
    15                                  
    16                                  ; Draw graphics by using 'sysvideo' bx=0305h
    17                                  ; and display text by using bx=010Fh
    18                                  
    19                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    20                                  ; ------------------------------------------------------------
    21                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    22                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    23                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    24                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    25                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    26                                  
    27                                  ; ------------------------------------------------------------
    28                                  
    29                                  ; 30/11/2024
    30                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    31                                  ; 29/04/2016
    32                                  _ver 	equ 0
    33                                  _exit 	equ 1
    34                                  _fork 	equ 2
    35                                  _read 	equ 3
    36                                  _write	equ 4
    37                                  _open	equ 5
    38                                  _close 	equ 6
    39                                  _wait 	equ 7
    40                                  _creat 	equ 8
    41                                  _link 	equ 9
    42                                  _unlink	equ 10
    43                                  _exec	equ 11
    44                                  _chdir	equ 12
    45                                  _time 	equ 13
    46                                  _mkdir 	equ 14
    47                                  _chmod	equ 15
    48                                  _chown	equ 16
    49                                  _break	equ 17
    50                                  _stat	equ 18
    51                                  _seek	equ 19
    52                                  _tell 	equ 20
    53                                  _mount	equ 21
    54                                  _umount	equ 22
    55                                  _setuid	equ 23
    56                                  _getuid	equ 24
    57                                  _stime	equ 25
    58                                  _quit	equ 26
    59                                  _intr	equ 27
    60                                  _fstat	equ 28
    61                                  _emt 	equ 29
    62                                  _mdate 	equ 30
    63                                  _video 	equ 31
    64                                  _audio	equ 32
    65                                  _timer	equ 33
    66                                  _sleep	equ 34
    67                                  _msg    equ 35
    68                                  _geterr	equ 36
    69                                  _fpsave	equ 37
    70                                  _pri	equ 38
    71                                  _rele	equ 39
    72                                  _fff	equ 40
    73                                  _fnf	equ 41
    74                                  _alloc	equ 42
    75                                  _dalloc equ 43
    76                                  _calbac equ 44
    77                                  _dma	equ 45
    78                                  _stdio  equ 46
    79                                  
    80                                  ; ------------------------------------------------------------
    81                                  
    82                                  %macro sys 1-4
    83                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    84                                      ; 03/09/2015
    85                                      ; 13/04/2015
    86                                      ; Retro UNIX 386 v1 system call.
    87                                      %if %0 >= 2
    88                                          mov ebx, %2
    89                                          %if %0 >= 3
    90                                              mov ecx, %3
    91                                              %if %0 = 4
    92                                                 mov edx, %4
    93                                              %endif
    94                                          %endif
    95                                      %endif
    96                                      mov eax, %1
    97                                      ;int 30h
    98                                      int 40h ; TRDOS 386 (TRDOS v2.0)
    99                                  %endmacro
   100                                  
   101                                  ; Retro UNIX 386 v1 system call format:
   102                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   103                                  
   104                                  ; ------------------------------------------------------------
   105                                  
   106                                  ; player internal variables and other equates.
   107                                  BUFFERSIZE	equ 65536
   108                                  ENDOFFILE	equ 1		; flag for knowing end of file
   109                                  
   110                                  ; ------------------------------------------------------------
   111                                  
   112                                  [BITS 32] ; 32-bit intructions
   113                                  
   114                                  [ORG 0]
   115                                  
   116                                  START_CODE:
   117                                  	; Prints the Credits Text.
   118                                  	sys	_msg, Credits, 255, 0Bh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000000 BB[68280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000005 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000000A BA0B000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000000F B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000014 CD40                <1>  int 40h
   119                                  
   120                                  	; clear bss
   121 00000016 BF[20730000]            	mov	edi, bss_start
   122 0000001B B9B1020000              	mov	ecx, (bss_end - bss_start)/4
   123 00000020 31C0                    	xor	eax, eax
   124 00000022 F3AB                    	rep	stosd
   125                                  
   126                                  ; -------------------------------------------------------------
   127                                  
   128                                  	; 21/12/2024
   129                                  	; Detect (& Enable) AC'97 Audio Device
   130 00000024 E812070000              	call	DetectAC97
   131 00000029 731B                    	jnc	short ac97_hardware_ready
   132                                  
   133                                  	; 30/11/2024
   134                                  	; 30/05/2024
   135                                  _dev_not_ready:
   136                                  	; couldn't find the audio device!
   137                                  	sys	_msg, noDevMsg, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000002B BB[FA280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000030 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000035 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000003A B823000000          <1>  mov eax, %1
    97                              <1> 
    98 0000003F CD40                <1>  int 40h
   138 00000041 E982040000                      jmp     Exit
   139                                  
   140                                  ac97_hardware_ready:
   141 00000046 E88F080000              	call	write_audio_dev_info
   142                                  
   143                                  ; -------------------------------------------------------------
   144                                  
   145                                  	; 21/12/2024
   146                                  	;;;
   147                                  	; Read (copy) 8x14 system fonts
   148 0000004B BE[C83F0000]            	mov	esi, fontbuff1
   149                                  	sys	_video, 0C03h, 256, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000050 BB030C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000055 B900010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000005A BA00000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000005F B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000064 CD40                <1>  int 40h
   150                                  
   151                                  	; convert 8x14 fonts to 8x16 fonts
   152                                  	; by inserting 2 empty rows to each characters
   153                                  	;mov	esi, fontbuff1
   154 00000066 BF[C84D0000]            	mov	edi, fontbuff2
   155                                  	; 18/02/2021
   156                                  	;mov	cx, 256
   157                                  fontconvert:
   158 0000006B 51                      	push	ecx
   159 0000006C 66B90E00                	mov	cx, 14
   160 00000070 F3A4                    	rep	movsb
   161 00000072 28C0                    	sub	al, al
   162 00000074 AA                      	stosb
   163 00000075 AA                      	stosb
   164 00000076 59                      	pop	ecx
   165 00000077 E2F2                    	loop	fontconvert
   166                                  	;;;
   167                                  
   168                                  ; ------------------------------------------------------------- 
   169                                  
   170                                  	; 21/12/2024
   171                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   172                                  	sys	_video, 08FFh, 101h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000079 BBFF080000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000007E B901010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000083 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000088 CD40                <1>  int 40h
   173 0000008A 09C0                    	or	eax, eax
   174 0000008C 0F8431040000            	jz	terminate    ; nothing to do				
   175                                  	;jz	trdos386_err ; write (OS) error msg and exit
   176                                  
   177                                  set_vesa_mode_101h_ok:
   178                                  	; linear frame buffer access
   179                                  	sys	_video, 06FFh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000092 BBFF060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000097 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000009C CD40                <1>  int 40h
   180 0000009E 21C0                    	and	eax, eax
   181 000000A0 0F8468040000            	jz	error_exit ; set text mode and write err msg
   182 000000A6 A3[10730000]            	mov	[LFB_ADDR], eax
   183                                  
   184                                  ; -------------------------------------------------------------
   185                                  
   186                                  	; 07/12/2024
   187                                  GetFileName_@:
   188                                  	; 30/11/2024
   189                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   190                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   191                                  	;			.. argv0text, argv1text ..) 
   192                                  	; ---- argc, argv[] ----
   193 000000AB 89E6                    	mov	esi, esp
   194 000000AD AD                      	lodsd
   195 000000AE 83F802                  	cmp	eax, 2 ; two arguments 
   196                                  		; (program file name & mod file name)
   197 000000B1 0F821A040000            	jb	pmsg_usage ; nothing to do
   198                                  	; 07/12/2024
   199 000000B7 AD                      	lodsd	; skip program (PRG) file name
   200                                  
   201                                  	; 30/11/2024 (32bit)
   202                                  	; 29/11/2024
   203                                  	; 30/05/2024
   204                                  GetFileName:
   205 000000B8 BF[647D0000]            	mov	edi, wav_file_name 
   206                                  	; 07/12/2024
   207 000000BD 8B36                    	mov	esi, [esi]
   208 000000BF 31C9                    	xor	ecx, ecx ; 0
   209                                  ScanName:
   210 000000C1 AC                      	lodsb
   211                                  	;test	al, al
   212                                  	;jz	short a_4
   213                                  	; 29/11/2024
   214 000000C2 3C0D                    	cmp	al, 0Dh
   215 000000C4 7638                    	jna	short a_4
   216 000000C6 3C20                    	cmp	al, 20h
   217 000000C8 74F7                    	je	short ScanName	; scan start of name.
   218 000000CA AA                      	stosb
   219 000000CB B4FF                    	mov	ah, 0FFh
   220                                  	;;;
   221                                  	; 14/11/2024
   222                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   223                                  	;xor	ecx, ecx ; 0
   224                                  	;;;
   225                                  a_0:	
   226 000000CD FEC4                    	inc	ah
   227                                  a_1:
   228                                  	;;;
   229                                  	; 14/11/2024
   230 000000CF 41                      	inc	ecx
   231                                  	;;;
   232 000000D0 AC                      	lodsb
   233 000000D1 AA                      	stosb
   234 000000D2 3C2E                    	cmp	al, '.'
   235 000000D4 74F7                    	je	short a_0
   236                                  	; 29/11/2024
   237 000000D6 3C20                    	cmp	al, 20h
   238                                  	;and	al, al
   239                                  	;jnz	short a_1
   240                                  	;;;
   241                                  	; 14/11/2024
   242 000000D8 7613                    	jna	short a_3
   243 000000DA 20E4                    	and	ah, ah
   244 000000DC 7406                    	jz	short a_2
   245 000000DE 3C2F                    	cmp	al, '/'	; 14/12/2024
   246 000000E0 7502                    	jne	short a_2
   247 000000E2 B400                    	mov	ah, 0
   248                                  a_2:
   249 000000E4 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   250 000000E7 72E6                    	jb	short a_1
   251                                  	; 29/11/2024
   252 000000E9 29C9                    	sub	ecx, ecx
   253 000000EB EB11                    	jmp	short a_4
   254                                  a_3:
   255                                  	; 29/11/2024
   256 000000ED 4F                      	dec	edi
   257                                  	;;;
   258 000000EE 08E4                    	or	ah, ah		; if period NOT found,
   259 000000F0 750C                    	jnz	short a_4 	; then add a .WAV extension.
   260                                  SetExt:
   261                                  	; 29/11/2024
   262                                  	;dec	edi
   263 000000F2 C7072E574156            	mov	dword [edi], '.WAV'
   264                                  				; ! 64+12 is DOS limit
   265                                  				; but writing +4 must not
   266                                  				; destroy the following data	 
   267                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   268                                  	; 29/11/2024
   269 000000F8 83C104                  	add	ecx, 4
   270 000000FB 83C704                  	add	edi, 4
   271                                  a_4:	
   272 000000FE C60700                  	mov	byte [edi], 0
   273                                  
   274                                          ; open existing file
   275                                  	; 28/11/2024
   276                                  	;mov	edx, wav_file_name
   277 00000101 E887060000                      call    openFile ; no error? ok.
   278 00000106 7325                            jnc     short getwavparms
   279                                  
   280                                  	; 21/12/2024
   281 00000108 E89E040000              	call	set_text_mode
   282                                  	; file not found!
   283                                  	; 30/11/2024
   284                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000010D BB[25290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000112 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000117 BA0C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000011C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000121 CD40                <1>  int 40h
   285 00000123 E9A0030000                      jmp     Exit
   286                                  
   287                                  _exit_:
   288 00000128 E996030000              	jmp	terminate
   289                                  
   290                                  ; -------------------------------------------------------------
   291                                  
   292                                  getwavparms:
   293                                  	; 14/11/2024
   294 0000012D E890060000                     	call    getWAVParameters
   295 00000132 72F4                    	jc	short _exit_		; nothing to do
   296                                  
   297                                  	; 17/11/2024
   298 00000134 B304                    	mov	bl, 4
   299 00000136 2A1D[507D0000]          	sub	bl, byte [WAVE_BlockAlign]
   300                                  			; = 0 for 16 bit stereo
   301                                  			; = 2 for 8 bit stereo or 16 bit mono
   302                                  			; = 3 for 8 bit mono	
   303                                  
   304 0000013C D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   305                                  	; 15/11/2024
   306 0000013E 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   307 00000141 881D[B67D0000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   308                                  					; = 0 stereo and 16 bit
   309                                  					; = 1 mono or 8 bit
   310                                  
   311                                  ; -------------------------------------------------------------
   312                                  
   313                                  	; 26/12/2024
   314                                  	; 21/12/2024
   315                                  	;mov	byte [tcolor], 15
   316                                  
   317                                  Player_SplashScreen:
   318                                  _0:
   319 00000147 E800040000              	call	drawsplashscreen
   320                                  
   321                                  	; 21/12/2024
   322                                  	;;;
   323                                  	; set wave volume led addresses
   324 0000014C 8B1D[10730000]          	mov	ebx, [LFB_ADDR]
   325 00000152 81C300C70100            	add	ebx, (13*80*8*14)
   326 00000158 BD50000000              	mov	ebp, 80
   327 0000015D BF[C85D0000]            	mov	edi, wleds_addr
   328                                  wleds_sa_1:
   329 00000162 B90F000000              	mov	ecx, 15
   330                                  wleds_sa_2:
   331 00000167 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   332 0000016C F7E1                    	mul	ecx
   333 0000016E 01D8                    	add	eax, ebx
   334 00000170 AB                      	stosd
   335 00000171 E2F4                    	loop	wleds_sa_2
   336 00000173 89D8                    	mov	eax, ebx
   337 00000175 AB                      	stosd
   338 00000176 83C308                  	add	ebx, 8
   339 00000179 4D                      	dec	ebp
   340 0000017A 75E6                    	jnz	short wleds_sa_1
   341                                  	;;;
   342                                  
   343                                  	; 24/12/2024
   344                                  	; 07/12/2024
   345                                  	;;; wait for 3 seconds
   346                                  	sys	_time, 0 ; get time in unix epoch format
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000017C BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000181 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 00000186 CD40                <1>  int 40h
   347 00000188 89C1                    	mov	ecx, eax
   348 0000018A 83C103                  	add	ecx, 3
   349                                  _wait_3s:
   350 0000018D 90                      	nop
   351                                  	sys	_time, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000018E BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000193 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 00000198 CD40                <1>  int 40h
   352 0000019A 39C8                    	cmp	eax, ecx
   353 0000019C 72EF                    	jb	short _wait_3s
   354                                  	;;;
   355                                  
   356                                  ; -------------------------------------------------------------
   357                                  
   358                                  	; 07/12/2024 (playwav9.s)
   359                                  
   360                                  	; 18/11/2023 (ich_wav4.asm)
   361                                  	; 13/11/2023 (ich_wav3.asm)
   362                                  
   363 0000019E 803D[2E7D0000]01        	cmp	byte [VRA], 1
   364 000001A5 7226                    	jb	short chk_sample_rate
   365                                  
   366                                  playwav_48_khz:
   367 000001A7 C705[C47D0000]-         	mov	dword [loadfromwavfile], loadFromFile
   367 000001AD [0C080000]         
   368                                  	;mov	dword [loadsize], 0 ; 65536
   369                                  	;;;
   370                                  	; 17/11/2024
   371                                  	;mov	word [buffersize], 32768
   372                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   373                                  	; 30/11/2024
   374                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   375                                  	; 07/12/2024
   376 000001B1 B800000100              	mov	eax, BUFFERSIZE ; 65536
   377 000001B6 A3[CC7D0000]            	mov	[buffersize], eax	; 16 bit samples
   378                                  	; 07/12/2024
   379                                  	;shl	eax, 1			; bytes
   380 000001BB 8A0D[B67D0000]          	mov	cl, [fbs_shift]
   381 000001C1 D3E8                    	shr	eax, cl 
   382                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   383 000001C3 A3[C87D0000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   384                                  	;;;
   385                                  	;jmp	PlayNow ; 30/05/2024
   386                                  	; 07/12/2024
   387 000001C8 E95F020000              	jmp	Player_Template
   388                                  
   389                                  chk_sample_rate:
   390                                  	; set conversion parameters
   391                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   392 000001CD 66A1[487D0000]          	mov	ax, [WAVE_SampleRate]
   393 000001D3 663D80BB                	cmp	ax, 48000
   394 000001D7 74CE                    	je	short playwav_48_khz
   395                                  chk_22khz:
   396 000001D9 663D2256                	cmp	ax, 22050
   397 000001DD 7545                    	jne	short chk_11khz
   398 000001DF 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   399 000001E6 7615                    	jna	short chk_22khz_1
   400 000001E8 BB[76170000]            	mov	ebx, load_22khz_stereo_16_bit
   401 000001ED 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   402 000001F4 751A                    	jne	short chk_22khz_2
   403 000001F6 BB[E9160000]            	mov	ebx, load_22khz_mono_16_bit
   404 000001FB EB13                    	jmp	short chk_22khz_2
   405                                  chk_22khz_1:
   406 000001FD BB[62160000]            	mov	ebx, load_22khz_stereo_8_bit
   407 00000202 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   408 00000209 7505                    	jne	short chk_22khz_2
   409 0000020B BB[D9150000]            	mov	ebx, load_22khz_mono_8_bit
   410                                  chk_22khz_2:
   411 00000210 B85A1D0000              	mov	eax, 7514  ; (442*17)
   412 00000215 BA25000000              	mov	edx, 37
   413 0000021A B911000000              	mov	ecx, 17
   414 0000021F E9DB010000              	jmp	set_sizes
   415                                  chk_11khz:
   416 00000224 663D112B                	cmp	ax, 11025
   417 00000228 7545                    	jne	short chk_44khz
   418 0000022A 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   419 00000231 7615                    	jna	short chk_11khz_1
   420 00000233 BB[92190000]            	mov	ebx, load_11khz_stereo_16_bit
   421 00000238 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   422 0000023F 751A                    	jne	short chk_11khz_2
   423 00000241 BB[19190000]            	mov	ebx, load_11khz_mono_16_bit
   424 00000246 EB13                    	jmp	short chk_11khz_2
   425                                  chk_11khz_1:
   426 00000248 BB[9F180000]            	mov	ebx, load_11khz_stereo_8_bit
   427 0000024D 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   428 00000254 7505                    	jne	short chk_11khz_2
   429 00000256 BB[27180000]            	mov	ebx, load_11khz_mono_8_bit
   430                                  chk_11khz_2:
   431 0000025B B8AD0E0000              	mov	eax, 3757  ; (221*17)
   432 00000260 BA4A000000              	mov	edx, 74
   433 00000265 B911000000              	mov	ecx, 17
   434 0000026A E990010000              	jmp	set_sizes
   435                                  chk_44khz:
   436 0000026F 663D44AC                	cmp	ax, 44100
   437 00000273 7545                    	jne	short chk_16khz
   438 00000275 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   439 0000027C 7615                    	jna	short chk_44khz_1
   440 0000027E BB[991B0000]            	mov	ebx, load_44khz_stereo_16_bit
   441 00000283 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   442 0000028A 751A                    	jne	short chk_44khz_2
   443 0000028C BB[201B0000]            	mov	ebx, load_44khz_mono_16_bit
   444 00000291 EB13                    	jmp	short chk_44khz_2
   445                                  chk_44khz_1:
   446 00000293 BB[A31A0000]            	mov	ebx, load_44khz_stereo_8_bit
   447 00000298 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   448 0000029F 7505                    	jne	short chk_44khz_2
   449 000002A1 BB[271A0000]            	mov	ebx, load_44khz_mono_8_bit
   450                                  chk_44khz_2:
   451                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   452 000002A6 B8D93A0000              	mov	eax, 15065 ; (655*23)
   453                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   454                                  	;mov	ax, 14076 ; (612*23)
   455                                  	; 17/11/2024
   456                                  	;mov	ax, 12650 ; (550*23)
   457 000002AB BA19000000              	mov	edx, 25
   458 000002B0 B917000000              	mov	ecx, 23
   459 000002B5 E945010000              	jmp	set_sizes
   460                                  chk_16khz:
   461 000002BA 663D803E                	cmp	ax, 16000
   462 000002BE 7545                    	jne	short chk_8khz
   463 000002C0 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   464 000002C7 7615                    	jna	short chk_16khz_1
   465 000002C9 BB[1E110000]            	mov	ebx, load_16khz_stereo_16_bit
   466 000002CE 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   467 000002D5 751A                    	jne	short chk_16khz_2
   468 000002D7 BB[9D100000]            	mov	ebx, load_16khz_mono_16_bit
   469 000002DC EB13                    	jmp	short chk_16khz_2
   470                                  chk_16khz_1:
   471 000002DE BB[E30F0000]            	mov	ebx, load_16khz_stereo_8_bit
   472 000002E3 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   473 000002EA 7505                    	jne	short chk_16khz_2
   474 000002EC BB[640F0000]            	mov	ebx, load_16khz_mono_8_bit
   475                                  chk_16khz_2:
   476                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   477 000002F1 B855150000              	mov	eax, 5461
   478                                  	; 17/11/2024
   479                                  	;mov	ax, 5460
   480 000002F6 BA03000000              	mov	edx, 3
   481 000002FB B901000000              	mov	ecx, 1
   482 00000300 E9FA000000              	jmp	set_sizes
   483                                  chk_8khz:
   484 00000305 663D401F                	cmp	ax, 8000
   485 00000309 7545                    	jne	short chk_24khz
   486 0000030B 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   487 00000312 7615                    	jna	short chk_8khz_1
   488 00000314 BB[190E0000]            	mov	ebx, load_8khz_stereo_16_bit
   489 00000319 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   490 00000320 751A                    	jne	short chk_8khz_2
   491 00000322 BB[490D0000]            	mov	ebx, load_8khz_mono_16_bit
   492 00000327 EB13                    	jmp	short chk_8khz_2
   493                                  chk_8khz_1:
   494 00000329 BB[190C0000]            	mov	ebx, load_8khz_stereo_8_bit
   495 0000032E 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   496 00000335 7505                    	jne	short chk_8khz_2
   497 00000337 BB[350B0000]            	mov	ebx, load_8khz_mono_8_bit
   498                                  chk_8khz_2:
   499 0000033C B8AA0A0000              	mov	eax, 2730
   500 00000341 BA06000000              	mov	edx, 6
   501 00000346 B901000000              	mov	ecx, 1
   502 0000034B E9AF000000              	jmp	set_sizes
   503                                  chk_24khz:
   504 00000350 663DC05D                	cmp	ax, 24000
   505 00000354 7563                    	jne	short chk_32khz
   506 00000356 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   507 0000035D 7615                    	jna	short chk_24khz_1
   508                                  	; 18/01/2025 (BugFix)
   509                                  	; bx -> ebx
   510 0000035F BB[48130000]            	mov	ebx, load_24khz_stereo_16_bit
   511 00000364 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   512 0000036B 751A                    	jne	short chk_24khz_2
   513 0000036D BB[E5120000]            	mov	ebx, load_24khz_mono_16_bit
   514 00000372 EB13                    	jmp	short chk_24khz_2
   515                                  chk_24khz_1:
   516 00000374 BB[5B120000]            	mov	ebx, load_24khz_stereo_8_bit
   517 00000379 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   518 00000380 7505                    	jne	short chk_24khz_2
   519 00000382 BB[F4110000]            	mov	ebx, load_24khz_mono_8_bit
   520                                  chk_24khz_2:
   521                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   522 00000387 B800200000              	mov	eax, 8192
   523                                  	; 17/11/2024
   524                                  	;mov	ax, 8190
   525 0000038C BA02000000              	mov	edx, 2
   526 00000391 B901000000              	mov	ecx, 1
   527 00000396 EB67                    	jmp	short set_sizes
   528                                  
   529                                  	; 07/12/2024
   530                                  vra_needed:
   531                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   532                                  	; 13/11/2023
   533 00000398 58                      	pop	eax ; discard return address to the caller
   534                                  	; 30/05/2024
   535                                  vra_err:
   536                                  	; 21/12/2024
   537 00000399 E80D020000              	call	set_text_mode
   538                                  	; 30/11/2024
   539                                  	sys	_msg, msg_no_vra, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000039E BB[8F290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000003A3 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000003A8 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000003AD B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000003B2 CD40                <1>  int 40h
   540 000003B4 E90F010000              	jmp	Exit
   541                                  
   542                                  chk_32khz:
   543 000003B9 663D007D                	cmp	ax, 32000
   544 000003BD 75D9                    	jne	short vra_needed
   545 000003BF 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   546 000003C6 7615                    	jna	short chk_32khz_1
   547 000003C8 BB[49150000]            	mov	ebx, load_32khz_stereo_16_bit
   548 000003CD 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   549 000003D4 751A                    	jne	short chk_32khz_2
   550 000003D6 BB[DF140000]            	mov	ebx, load_32khz_mono_16_bit
   551 000003DB EB13                    	jmp	short chk_32khz_2
   552                                  chk_32khz_1:
   553 000003DD BB[42140000]            	mov	ebx, load_32khz_stereo_8_bit
   554 000003E2 803D[467D0000]01        	cmp	byte [WAVE_NumChannels], 1
   555 000003E9 7505                    	jne	short chk_32khz_2
   556 000003EB BB[CF130000]            	mov	ebx, load_32khz_mono_8_bit
   557                                  chk_32khz_2:
   558                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   559 000003F0 B8AA2A0000              	mov	eax, 10922
   560                                  	; 17/11/2024
   561                                  	;mov	ax, 10920
   562 000003F5 BA03000000              	mov	edx, 3
   563 000003FA B902000000              	mov	ecx, 2
   564                                  	;jmp	short set_sizes
   565                                  set_sizes:
   566                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   567                                  	;;;
   568                                  	; 17/11/2024
   569 000003FF 51                      	push	ecx
   570 00000400 B102                    	mov	cl, 2
   571 00000402 2A0D[B67D0000]          	sub	cl, [fbs_shift]
   572                                  		; = 2 for 16 bit stereo
   573                                  		; = 1 for 16 bit mono or 8 bit stereo
   574                                  		; = 0 for 8 bit mono
   575 00000408 D3E0                    	shl	eax, cl
   576 0000040A 59                      	pop	ecx	
   577 0000040B A3[C87D0000]            	mov	[loadsize], eax	; (one) read count in bytes
   578                                  	;;;
   579 00000410 F7E2                    	mul	edx
   580 00000412 83F901                  	cmp	ecx, 1
   581 00000415 7402                    	je	short s_2
   582                                  s_1:
   583 00000417 F7F1                    	div	ecx
   584                                  s_2:
   585                                  	;;;
   586                                  	; eax = byte count of (to be) converted samples 
   587                                  	
   588                                  	; 17/11/2024
   589                                  	;;;
   590 00000419 8A0D[B67D0000]          	mov	cl, [fbs_shift]
   591                                  
   592 0000041F D3E0                    	shl	eax, cl
   593                                  		; *1 for 16 bit stereo
   594                                  		; *2 for 16 bit mono or 8 bit stereo
   595                                  		; *4 for for 8 bit mono
   596                                  	;;;
   597                                  
   598                                  	; eax = 16 bit stereo byte count (target buffer size)
   599                                  	
   600                                  	; 07/12/2024
   601                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   602 00000421 A3[CC7D0000]            	mov	[buffersize], eax ; buffer size in bytes
   603 00000426 891D[C47D0000]          	mov	[loadfromwavfile], ebx
   604                                  
   605                                  ; -------------------------------------------------------------
   606                                  
   607                                  Player_Template:
   608                                  	; 21/12/2024
   609 0000042C E80B010000              	call	clearscreen
   610 00000431 E822010000              	call	drawplayingscreen
   611                                  
   612                                  	; 14/11/2024
   613 00000436 E8C41F0000              	call	SetTotalTime
   614 0000043B E891200000              	call	UpdateFileInfo
   615                                  
   616                                  ; -------------------------------------------------------------
   617                                  
   618                                  StartPlay:
   619                                  	; 21/12/2024 (VGA/LFB modifications)
   620                                  	; (Direct access/map to the LFB is already done here)
   621                                  	; ((this program is in VESA/VBE graphics mode here))
   622                                  PlayNow:
   623                                  	; 07/12/2024
   624                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000440 BB00020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000445 8B0D[CC7D0000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000044B BA[00800000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000450 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000455 CD40                <1>  int 40h
   625 00000457 0F82B1000000            	jc	error_exit ; return to text mode and print err msg
   626                                  
   627                                  	; 01/06/2024
   628                                  	; Initialize Audio Device (bh = 3)
   629                                  	sys	_audio, 0301h, 0, audio_int_handler
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000045D BB01030000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000462 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000467 BA[F8070000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000046C B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000471 CD40                <1>  int 40h
   630                                  	;jc	short error_exit
   631 00000473 7279                    	jc	init_err ; return to text mode and print err msg
   632                                  
   633                                  	;;;
   634                                  	; 14/11/2024
   635 00000475 B003                    	mov	al, 3	; 0 = max, 31 = min
   636                                  	; 15/11/2024
   637 00000477 E8A5020000              	call	SetMasterVolume
   638                                  	; 07/12/2024
   639                                  	;call	SetPCMOutVolume
   640 0000047C E8D1200000              	call	UpdateVolume
   641                                  	;;;
   642                                  	;
   643                                  	; 14/11/2024
   644 00000481 E85C210000              	call	UpdateProgressBar
   645                                  	;;;
   646                                  
   647                                   	; 30/05/2024
   648                                  	; playwav4.asm
   649                                  ;_2:	; 24/12/2024
   650                                  	;call	check4keyboardstop	; flush keyboard buffer
   651                                  	;jc	short _2		; 07/11/2023
   652                                  
   653                                  	; 24/12/2024 (setting for wave lighting points)
   654 00000486 A1[10730000]            	mov	eax, [LFB_ADDR]
   655                                  	;add	eax, 228*640 ; wave graphics start (top) line/row
   656 0000048B 05009A0100              	add	eax, 164*640 ; 256 volume levels ; 24/12/2024
   657 00000490 A3[0C730000]            	mov	[graphstart], eax
   658                                  
   659                                  ; play the .wav file. Most of the good stuff is in here.
   660                                  	
   661                                  	; 05/12/2024
   662 00000495 E818010000              	call    PlayWav
   663                                  
   664                                  ; close the .wav file and exit.
   665                                  
   666                                  	; 07/12/2024
   667                                  	;;;
   668                                  	; Stop Playing
   669                                  	;sys	_audio, 0700h
   670                                  	; Cancel callback service (for user)
   671                                  	sys	_audio, 0900h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000049A BB00090000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000049F B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004A4 CD40                <1>  int 40h
   672                                  	; Deallocate Audio Buffer (for user)
   673                                  	sys	_audio, 0A00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004A6 BB000A0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004AB B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004B0 CD40                <1>  int 40h
   674                                  	; Disable Audio Device
   675                                  	sys	_audio, 0C00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004B2 BB000C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004B7 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004BC CD40                <1>  int 40h
   676                                  	;;;
   677                                  
   678                                  	; 25/12/2024
   679 000004BE E8E8020000              	call	closeFile
   680                                  
   681                                  terminate:
   682 000004C3 E8E3000000              	call	set_text_mode
   683                                  Exit:
   684                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004C8 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 000004CD CD40                <1>  int 40h
   685                                  halt:
   686 000004CF EBFE                    	jmp	short halt
   687                                  
   688                                  ; -------------------------------------------------------------
   689                                  
   690                                  	; 30/05/2024
   691                                  pmsg_usage:
   692                                  	; 21/12/2024
   693 000004D1 E8D5000000              	call	set_text_mode
   694                                  	; 01/12/2024
   695                                  	sys	_msg, msg_usage, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004D6 BB[DB280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000004DB B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000004E0 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004E5 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000004EA CD40                <1>  int 40h
   696 000004EC EBDA                    	jmp	short Exit
   697                                  
   698                                  ; -------------------------------------------------------------
   699                                  
   700                                  	; 30/05/2024
   701                                  init_err:
   702                                  	; 21/12/2024
   703 000004EE E8B8000000              	call	set_text_mode
   704                                  	; 01/12/2024
   705                                  	sys	_msg, msg_init_err, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004F3 BB[5E290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000004F8 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000004FD BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000502 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000507 CD40                <1>  int 40h
   706 00000509 EBBD                    	jmp	short Exit
   707                                  
   708                                  ; -------------------------------------------------------------
   709                                  
   710                                  	; 02/12/2024
   711                                  Player_Quit@:
   712 0000050B 58                      	pop	eax ; return addr (call PlayWav@)
   713                                  	
   714                                  	; 29/11/2024
   715                                  Player_Quit:
   716 0000050C EBB5                    	jmp	 short terminate
   717                                  
   718                                  
   719                                  ; -------------------------------------------------------------
   720                                  
   721                                  	; 07/12/2024
   722                                  error_exit:
   723                                  	; 21/12/2024
   724 0000050E E898000000              	call	set_text_mode
   725                                  trdos386_error:
   726                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000513 BB[3E290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000518 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000051D BA0E000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000522 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000527 CD40                <1>  int 40h
   727 00000529 EB9D                    	jmp	short Exit
   728                                  
   729                                  ; -------------------------------------------------------------
   730                                  
   731                                  	; 21/12/2024
   732                                  print_msg:
   733 0000052B B40E                    	mov	ah, 0Eh
   734 0000052D BB07000000              	mov	ebx, 7
   735                                  	;mov	bl, 7 ; char attribute & color
   736                                  p_next_chr:
   737 00000532 AC                      	lodsb
   738 00000533 08C0                    	or	al, al
   739 00000535 7404                    	jz	short p_retn ; retn
   740 00000537 CD31                    	int	31h
   741 00000539 EBF7                    	jmp	short p_next_chr
   742                                  p_retn:
   743 0000053B C3                      	retn
   744                                  
   745                                  ; -------------------------------------------------------------
   746                                  
   747                                  	; 21/12/2024
   748                                  clearscreen:
   749                                  	; fast clear
   750                                  	; 640*480, 256 colors
   751 0000053C 8B3D[10730000]          	mov	edi, [LFB_ADDR]
   752 00000542 B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   753 00000547 31C0                    	xor	eax, eax
   754 00000549 F3AB                    	rep	stosd
   755 0000054B C3                      	retn
   756                                  
   757                                  ; -------------------------------------------------------------
   758                                  
   759                                  	; 21/12/2024
   760                                  drawsplashscreen:
   761 0000054C BD[BC2A0000]            	mov	ebp, SplashScreen
   762                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   763                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   764                                  	;mov	esi, 0 ; row 0, column 0
   765 00000551 BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   766 00000556 EB0A                    	jmp	short p_d_x
   767                                  drawplayingscreen:
   768 00000558 BD[5D350000]            	mov	ebp, PlayingScreen
   769                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   770                                  	;mov	esi, 0 ; row 0, column 0
   771 0000055D BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   772                                  p_d_x:
   773 00000562 C605[1C730000]50        	mov	byte [columns], 80
   774                                  p_d_x_n:
   775 00000569 31D2                    	xor	edx, edx
   776 0000056B 8A5500                  	mov	dl, [ebp]
   777 0000056E 20D2                    	and	dl, dl
   778 00000570 7438                    	jz	short p_d_x_ok
   779 00000572 C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   780                                  
   781 00000575 BF[C84D0000]            	mov	edi, fontbuff2 ; start of user font data
   782 0000057A 01D7                    	add	edi, edx
   783                                  	
   784                                  	;; NOTE: Following system call writes fonts at
   785                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   786                                  	;; screen width as 640 pixels (instead of 320 pixels)
   787                                  	;; so 8Fh is sub function 0Fh (write char)
   788                                  	;; with 640 pixels screen witdh. 
   789                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   790                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   791                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   792                                  	;; region, the text is appeared on screen
   793                                  	;; while LFB is at C0000000h or E0000000h.)
   794                                  
   795                                  	;sys	_video, 018Fh, [tcolor], 8001h
   796                                  			;; use STD VGA video memory
   797                                  			;; (0A0000h)
   798                                  	;sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
   799                                  		 ; use LFB for current VBE mode
   800                                  		 ; for writing fonts on screen
   801                                  	; 26/12/2024
   802                                  	sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000057C BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000581 B90F000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000586 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000058B B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000590 CD40                <1>  int 40h
   803                                  
   804 00000592 45                      	inc	ebp
   805 00000593 6683C608                	add	si, 8 ; next char pos
   806 00000597 FE0D[1C730000]          	dec	byte [columns]
   807 0000059D 75CA                    	jnz	short p_d_x_n	; next column
   808 0000059F 6631F6                  	xor	si, si
   809                                  	;;add	esi, 00100000h	; next row ; 8*16
   810                                  	;add	esi, [nextrow]
   811 000005A2 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   812 000005A8 EBB8                    	jmp	short p_d_x
   813                                  p_d_x_ok:
   814 000005AA C3                      	retn
   815                                  
   816                                  ; -------------------------------------------------------------
   817                                  
   818                                  	; 21/12/2024
   819                                  set_text_mode:
   820 000005AB 30E4                    	xor    ah, ah
   821 000005AD B003                    	mov    al, 3                        
   822                                   	;int   10h ; al = 03h text mode, int 10 video
   823 000005AF CD31                    	int    31h ; TRDOS 386 - Video interrupt
   824 000005B1 C3                      	retn
   825                                  
   826                                  ; -------------------------------------------------------------
   827                                  
   828                                  	; 07/12/2024 (playwav9.s)
   829                                  	; 26/11/2023 (playwav8.s)
   830                                  PlayWav:
   831                                  	; 19/11/2024
   832 000005B2 C605[237D0000]01        	mov	byte [wleds], 1
   833                                  
   834                                  	;;;
   835                                  	; 09/12/2024
   836 000005B9 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
   837 000005BE 803D[2E7D0000]00        	cmp	byte [VRA], 0
   838 000005C5 7614                    	jna	short _3 ; 48kHZ (interpolation)
   839                                  	;;;
   840                                  	; 01/12/2024 (32bit)
   841                                  	;movzx	eax, word [WAVE_SampleRate]
   842                                  	; 09/12/2024
   843 000005C7 66A1[487D0000]          	mov	ax, [WAVE_SampleRate]
   844 000005CD B90A000000              	mov	ecx, 10
   845 000005D2 F7E1                    	mul	ecx
   846 000005D4 B1B6                    	mov	cl, 182
   847 000005D6 F7F1                    	div	ecx
   848                                  	; ax = samples per 1/18.2 second
   849                                  	;mov	cl, byte [WAVE_BlockAlign]
   850                                  	; 09/12/2024 
   851                                  	;mov	cl, 4 ; 16 bit, stereo
   852                                  	;mul	ecx
   853 000005D8 C1E002                  	shl	eax, 2 ; * 4
   854                                  _3:
   855 000005DB A3[247D0000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
   856                                  				; for wave volume leds update
   857                                  				; (byte stream per 1/18.2 second)
   858                                  	;;;
   859                                  	; 24/12/2024
   860 000005E0 3D000A0000              	cmp	eax, 640*4 ; 640 samples (for 640 wave light points)
   861 000005E5 7305                    	jnb	short _4
   862 000005E7 B8000A0000              	mov	eax, 640*4	
   863                                  _4:
   864 000005EC A3[08730000]            	mov	[wpoints_dif], eax
   865                                  	;;;
   866                                  
   867                                  RePlayWav:
   868                                  	; 07/12/2024
   869 000005F1 BF[00800000]            	mov	edi, audio_buffer
   870 000005F6 FF15[C47D0000]          	call	dword [loadfromwavfile]
   871 000005FC 0F820CFFFFFF            	jc	error_exit
   872                                  
   873 00000602 C605[2D7D0000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
   874                                  
   875 00000609 A1[D87D0000]            	mov	eax, [count]
   876 0000060E 0105[DC7D0000]          	add	[LoadedDataBytes], eax
   877                                  
   878 00000614 F605[5E7D0000]01        	test    byte [flags], ENDOFFILE  ; end of file
   879 0000061B 752C                    	jnz	short _5 ; yes
   880                                  			 ; bypass filling dma half buffer 2
   881                                  
   882                                  	; bh = 16 : update (current, first) dma half buffer
   883                                  	; bl = 0  : then switch to the next (second) half buffer
   884                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000061D BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000622 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000627 CD40                <1>  int 40h
   885                                  
   886                                  	; 18/12/2024
   887 00000629 C705[D87D0000]0000-     	mov	dword [count], 0
   887 00000631 0000               
   888                                  
   889                                  	; 07/12/2024
   890 00000633 BF[00800000]            	mov	edi, audio_buffer
   891 00000638 FF15[C47D0000]          	call	dword [loadfromwavfile]
   892                                  	;jc	error_exit
   893                                  	
   894 0000063E A1[D87D0000]            	mov	eax, [count]
   895 00000643 0105[DC7D0000]          	add	[LoadedDataBytes], eax
   896                                  _5:
   897                                  	; 07/12/2024
   898 00000649 668B0D[487D0000]         	mov	cx, [WAVE_SampleRate]
   899 00000650 B303                    	mov	bl, 3	; 16 bit, stereo
   900 00000652 B704                    	mov	bh, 4	; start to play
   901                                  	sys	_audio
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000654 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000659 CD40                <1>  int 40h
   902                                  
   903                                  ; -------------------------------------------
   904                                  
   905                                  	; 22/12/2024
   906                                   	; prepare all leds as turned off
   907 0000065B E884200000              	call	reset_wave_leds
   908                                  
   909                                  ; -------------------------------------------
   910                                  
   911                                  	; 07/12/2024 (playwav9.s)
   912                                  	; 01/12/2024 (32bit)
   913                                  	; 29/11/2024
   914                                  tuneLoop:
   915                                  	; 30/05/2024
   916                                  	; 18/11/2023 (ich_wav4.asm)
   917                                  	; 08/11/2023
   918                                  	; 06/11/2023
   919                                  tLWait:
   920                                  	; 18/11/2024
   921 00000660 803D[207D0000]00        	cmp	byte [stopped], 0
   922                                  	; 24/11/2024
   923 00000667 761E                    	jna	short tL1
   924                                  
   925                                  tLWait@:	; 21/11/2024
   926 00000669 E8331B0000              	call	checkUpdateEvents
   927 0000066E 726E                    	jc	_exitt_
   928 00000670 803D[217D0000]30        	cmp	byte [tLO], '0'
   929 00000677 74E7                    	je	short tLWait
   930 00000679 E86A000000              	call	tLZ
   931 0000067E C605[217D0000]30        	mov	byte [tLO], '0'
   932 00000685 EBD9                    	jmp	short tLWait
   933                                  tL1:
   934                                  	; 27/11/2024
   935                                  	; Check AC'97 interrupt status
   936 00000687 803D[B77D0000]00        	cmp	byte [SRB], 0
   937 0000068E 7709                    	ja	short tL3
   938                                  tL2:
   939 00000690 E80C1B0000              	call	checkUpdateEvents
   940 00000695 7247                    	jc	_exitt_
   941 00000697 EBC7                    	jmp	short tLWait
   942                                  tL3:
   943 00000699 8035[2D7D0000]01        	xor	byte [half_buffer], 1
   944                                  	; 07/12/2024
   945 000006A0 C605[B77D0000]00        	mov	byte [SRB], 0
   946                                  
   947                                  	; 07/12/2024
   948 000006A7 BF[00800000]            	mov	edi, audio_buffer
   949                                  	;call	loadFromFile
   950                                  	; 18/11/2023
   951                                  	;call	word [loadfromwavfile]
   952                                  	; 01/12/2024
   953 000006AC FF15[C47D0000]          	call	dword [loadfromwavfile]
   954 000006B2 722A                    	jc	short _exitt_	; end of file
   955                                  
   956                                  	; 07/12/2024
   957                                  	;;;;
   958                                  	; bh = 16 : update (current, first) dma half buffer
   959                                  	; bl = 0  : then switch to the other half buffer
   960                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000006B4 BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000006B9 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000006BE CD40                <1>  int 40h
   961                                  	;;;;
   962                                  
   963                                  	; 26/11/2024
   964 000006C0 A0[2D7D0000]            	mov	al, [half_buffer]
   965 000006C5 0431                    	add	al, '1'
   966                                  	; 19/11/2024
   967 000006C7 A2[217D0000]            	mov	[tLO], al
   968 000006CC E819000000              	call	tL0
   969                                  
   970                                  	; 24/11/2024
   971                                  	; 14/11/2024
   972                                  	;mov	ax, [count]
   973                                  	;add	[LoadedDataBytes], ax
   974                                  	;adc	word [LoadedDataBytes+2], 0
   975                                  	; 01/12/2024
   976 000006D1 A1[D87D0000]            	mov	eax, [count]
   977 000006D6 0105[DC7D0000]          	add	[LoadedDataBytes], eax
   978                                  
   979                                  	; 07/12/2024 (playwav9.s)
   980                                  	; 27/11/2024 (playwav9.asm)
   981 000006DC EBB2                    	jmp	short tL2
   982                                  
   983                                  _exitt_:
   984                                  	; 07/12/2024
   985                                  	; Stop Playing
   986                                  	;mov	byte [stopped], 2
   987                                  	;sys	_audio, 0700h
   988 000006DE E8821A0000              	call	ac97_stop
   989                                  
   990                                  	;;;
   991                                  	; 14/11/2024
   992 000006E3 E8FA1E0000              	call	UpdateProgressBar
   993                                  	;;;
   994                                  
   995                                  	; 18/11/2024
   996                                  tLZ:
   997                                  	; 30/05/2024
   998 000006E8 B030                    	mov	al, '0'
   999                                  
  1000                                  	;add	al, '0'
  1001                                  	;call	tL0
  1002                                  	;
  1003                                  	;retn
  1004                                  	; 06/11/2023
  1005                                  	;jmp	short tL0
  1006                                  	;retn
  1007                                  
  1008                                  	; 06/11/2023
  1009                                  tL0:
  1010                                  	; 29/05/2024 (TRDOS 386)
  1011                                  	; 08/11/2023
  1012                                  	; 05/11/2023
  1013                                  	; 17/02/2017 - Buffer switch test (temporary)
  1014                                  	; 06/11/2023
  1015                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1016                                  
  1017                                  	; 22/12/2024 (graphics mode modification)
  1018                                  	; (640*480, 256 colors)
  1019                                  	;;;
  1020                                  	;mov	ebp, 16
  1021 000006EA BD0E000000              	mov	ebp, 14
  1022 000006EF 8B3D[10730000]          	mov	edi, [LFB_ADDR]
  1023 000006F5 0FB6F0                  	movzx	esi, al
  1024 000006F8 C1E604                  	shl	esi, 4 ; * 16
  1025 000006FB 81C6[C84D0000]          	add	esi, fontbuff2
  1026                                  tL0_1:
  1027 00000701 BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1028 00000706 8A26                    	mov	ah, [esi]
  1029                                  tL0_2:
  1030 00000708 B00C                    	mov	al, 0Ch ; red
  1031 0000070A D0E4                    	shl	ah, 1
  1032 0000070C 7302                    	jnc	short tL0_3
  1033 0000070E B00E                    	mov	al, 0Eh ; yellow
  1034                                  tL0_3:
  1035 00000710 AA                      	stosb
  1036 00000711 4A                      	dec	edx
  1037 00000712 75F4                    	jnz	short tL0_2
  1038 00000714 4D                      	dec	ebp
  1039 00000715 7409                    	jz	short tL0_4
  1040 00000717 81C778020000            	add	edi, 640-8 ; next line
  1041 0000071D 46                      	inc	esi
  1042 0000071E EBE1                    	jmp	short tL0_1
  1043                                  tL0_4:
  1044                                  	;;;
  1045 00000720 C3                      	retn
  1046                                  
  1047                                  ; -------------------------------------------
  1048                                  
  1049                                  	; 07/12/2024
  1050                                  SetMasterVolume:
  1051                                  	;cmp	al, 31
  1052                                  	;ja	short setvolume_ok
  1053 00000721 A2[E3230000]            	mov	[volume], al  ; max = 0, min = 31
  1054                                  
  1055 00000726 B41F                    	mov	ah, 31
  1056 00000728 28C4                    	sub	ah, al
  1057 0000072A 88E0                    	mov	al, ah
  1058                                  
  1059                                  	; Set Master Volume Level (BL=0 or 80h)
  1060                                  	; 	for next playing (BL>=80h)
  1061                                  	;sys	_audio, 0B80h, eax
  1062                                  	sys	_audio, 0B00h, eax
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000072C BB000B0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000731 89C1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000733 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000738 CD40                <1>  int 40h
  1063                                  	
  1064                                  setvolume_ok:
  1065                                  ac97_not_detected:
  1066 0000073A C3                      	retn
  1067                                  
  1068                                  ; -------------------------------------------
  1069                                  
  1070                                  	; 07/12/2024 (playwav9.s)
  1071                                  DetectAC97:
  1072                                  DetectICH:
  1073                                  	; 25/11/2023 (playwav8.s)
  1074                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1075                                          sys	_audio, 0102h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000073B BB02010000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000740 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000745 CD40                <1>  int 40h
  1076                                  	;jnc	short d_ac97_@
  1077                                  	;retn
  1078 00000747 72F1                    	jc	short ac97_not_detected
  1079                                  d_ac97_@:
  1080                                  	; 07/12/2024 (playwav9.s)
  1081                                  	; 06/06/2017
  1082                                  	sys	_audio, 0E00h ; get audio controller info
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000749 BB000E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000074E B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000753 CD40                <1>  int 40h
  1083 00000755 0F82B3FDFFFF            	jc	error_exit ; 25/11/2023
  1084                                  
  1085                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1086                                  	;jne	_dev_not_ready	
  1087                                  
  1088                                  	; EAX = IRQ Number in AL
  1089                                  	;	Audio Device Number in AH 
  1090                                  	; EBX = DEV/VENDOR ID
  1091                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1092                                  	; ECX = BUS/DEV/FN 
  1093                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1094                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1095                                  	;      (Low word, DX = NAMBAR address)
  1096                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1097                                  
  1098 0000075B 891D[BC7D0000]          	mov	[dev_vendor], ebx
  1099 00000761 890D[B87D0000]          	mov	[bus_dev_fn], ecx
  1100                                  
  1101 00000767 668915[C07D0000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1102                                  	;shr	edx, 16
  1103                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1104 0000076E 8915[C07D0000]          	mov	[NAMBAR], edx
  1105                                  
  1106 00000774 A2[5F7D0000]            	mov	[ac97_int_ln_reg], al
  1107                                  
  1108                                  	; 07/12/2024
  1109                                  	; 01/06/2024
  1110                                  	; 25/11/2023
  1111                                  	; Get AC'97 Codec info
  1112                                  	; (Function 14, sub function 1)
  1113                                  	sys	_audio, 0E01h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000779 BB010E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000077E B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000783 CD40                <1>  int 40h
  1114                                  	; Save Variable Rate Audio support bit
  1115 00000785 2401                    	and	al, 1
  1116 00000787 A2[2E7D0000]            	mov	[VRA], al
  1117                                  
  1118                                  	;clc
  1119                                  
  1120 0000078C C3                      	retn
  1121                                  
  1122                                  ; ----------------------------------
  1123                                  	
  1124                                  	; 01/12/2024
  1125                                  	; 14/11/2024
  1126                                  	; INPUT: ds:dx = file name address
  1127                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1128                                  openFile:
  1129                                  	;mov	ax, 3D00h	; open File for read
  1130                                  	;int	21h
  1131                                  	;jnc	short _of1
  1132                                  	; 01/12/2024 (TRDOS 386)
  1133                                  	;sys	_open, edx, 0
  1134                                  	; 07/12/2024
  1135                                  	sys	_open, wav_file_name, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000078D BB[647D0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000792 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000797 B805000000          <1>  mov eax, %1
    97                              <1> 
    98 0000079C CD40                <1>  int 40h
  1136 0000079E 7305                    	jnc	short _of1
  1137                                  
  1138 000007A0 B8FFFFFFFF              	mov	eax, -1
  1139                                  	; cf = 1 -> not found or access error
  1140                                  _of1:
  1141 000007A5 A3[607D0000]            	mov	[filehandle], eax
  1142 000007AA C3                      	retn
  1143                                  
  1144                                  ; ----------------------------------
  1145                                  
  1146                                  ; close the currently open file
  1147                                  
  1148                                  	; 01/12/2024
  1149                                  	; 14/11/2024
  1150                                  	; INPUT: [filehandle] ; -1 = not open
  1151                                  	; OUTPUT: none
  1152                                  closeFile:
  1153 000007AB 833D[607D0000]FF        	cmp	dword [filehandle], -1
  1154 000007B2 740D                    	jz	short _cf1
  1155                                  	;mov	bx, [filehandle]  
  1156                                  	;mov	ax, 3E00h
  1157                                          ;int	21h              ; close file
  1158                                  	; 01/12/2024
  1159                                  	sys	_close, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007B4 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007BA B806000000          <1>  mov eax, %1
    97                              <1> 
    98 000007BF CD40                <1>  int 40h
  1160                                  	;mov 	dword [filehandle], -1
  1161                                  _cf1:
  1162 000007C1 C3                      	retn
  1163                                  
  1164                                  ; ----------------------------------
  1165                                  
  1166                                  	; 01/12/2024
  1167                                  	; 14/11/2024 - Erdogan Tan
  1168                                  getWAVParameters:
  1169                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1170                                  ; entry: none - assumes file is already open
  1171                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1172                                  ;	cx = number of channels (mono=1, stereo=2)
  1173                                  ;	dx = bits per sample (8, 16)
  1174                                  ;	bx = number of bytes per sample (1 to 4)
  1175                                  
  1176                                          ;mov	dx, WAVFILEHEADERbuff
  1177                                  	;mov	bx, [filehandle]
  1178                                          ;mov	cx, 44			; 44 bytes
  1179                                  	;mov	ah, 3Fh
  1180                                          ;int	21h
  1181                                  	;jc	short gwavp_retn
  1182                                  	; 01/12/2024 (TRDOS 386)
  1183                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007C2 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000007C8 B9[307D0000]        <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000007CD BA2C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007D2 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000007D7 CD40                <1>  int 40h
  1184 000007D9 721C                    	jc	short gwavp_retn
  1185                                  
  1186 000007DB 83F82C                  	cmp	eax, 44
  1187 000007DE 7217                    	jb	short gwavp_retn
  1188                                  
  1189 000007E0 813D[387D0000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1189 000007E8 5645               
  1190 000007EA 750A                    	jne	short gwavp_stc_retn
  1191                                  
  1192 000007EC 66833D[447D0000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1193                                  	;jne	short gwavp_stc_retn
  1194 000007F4 7401                    	je	short gwavp_retn ; 15/11/2024
  1195                                  
  1196                                  	; 15/11/2024
  1197                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1198                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1199                                  	;mov	dx, [WAVE_BitsPerSample] 
  1200                                  					; return bits per sample value in DX
  1201                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1202                                  ;gwavp_retn:
  1203                                          ;retn
  1204                                  
  1205                                  gwavp_stc_retn:
  1206 000007F6 F9                      	stc
  1207                                  gwavp_retn:
  1208 000007F7 C3                      	retn
  1209                                  
  1210                                  ; --------------------------------------------------------
  1211                                  ; 07/12/2024
  1212                                  ; --------------------------------------------------------
  1213                                  ; ref: playwav8.s (04/06/2024)
  1214                                  
  1215                                  audio_int_handler:
  1216                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1217                                  
  1218                                  	; 07/12/2024
  1219                                  	;mov	al, [stopped]
  1220                                  	;cmp	al, 2
  1221                                  	;je	short _callback_retn
  1222                                  
  1223                                  	; 18/08/2020
  1224                                  	;mov	byte [SRB], 1
  1225                                  	; 07/12/2024
  1226 000007F8 FE05[B77D0000]          	inc	byte [SRB]
  1227                                  
  1228                                  ;_callback_retn:
  1229                                  	sys	_rele ; return from callback service 
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007FE B827000000          <1>  mov eax, %1
    97                              <1> 
    98 00000803 CD40                <1>  int 40h
  1230                                  	; we must not come here !
  1231                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000805 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 0000080A CD40                <1>  int 40h
  1232                                  
  1233                                  ; --------------------------------------------------------
  1234                                  ; 07/12/2024
  1235                                  ; --------------------------------------------------------
  1236                                  
  1237                                  ; /////
  1238                                  	; 14/12/2024
  1239                                  	; 07/12/2024
  1240                                  	; 01/12/2024
  1241                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1242                                  loadFromFile:
  1243                                  	; 07/11/2023
  1244                                  
  1245 0000080C F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1246                                  					; last of the file?
  1247 00000813 7402                    	jz	short lff_0		; no
  1248 00000815 F9                      	stc
  1249 00000816 C3                      	retn
  1250                                  
  1251                                  lff_0:
  1252                                  	; 07/12/2024
  1253                                  	; 26/11/2023 (playwav8.s)
  1254                                  	;mov	edi, audio_buffer
  1255                                  
  1256                                  	; 01/12/2024 (TRDOS 386)
  1257                                  	; edi = audio buffer address
  1258                                  
  1259                                  	; 14/12/2024
  1260                                  	; 01/12/2024
  1261                                  	; 17/11/2024
  1262                                  	;mov	ebx, [filehandle]
  1263                                  	; 02/12/2024
  1264                                  	;mov	edx, [loadsize] 
  1265                                  
  1266                                  	; 17/11/2024
  1267 00000817 803D[B67D0000]00        	cmp	byte [fbs_shift], 0
  1268 0000081E 7677                    	jna	short lff_1 ; stereo, 16 bit
  1269                                  
  1270                                  lff_2:
  1271                                  	; 01/12/2024
  1272 00000820 BE[00800100]            	mov	esi, temp_buffer 
  1273                                  	; 14/12/2024
  1274                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000825 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000082B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000082D 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000833 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000838 CD40                <1>  int 40h
  1275 0000083A 0F8289000000            	jc	lff_4 ; error !
  1276                                  
  1277                                  	; 01/12/2024
  1278                                  	; 14/11/2024
  1279 00000840 A3[D87D0000]            	mov	[count], eax
  1280                                  
  1281                                  	; 01/12/2024
  1282 00000845 21C0                    	and	eax, eax
  1283                                  	;jz	short lff_3
  1284                                  	; 14/12/2024
  1285 00000847 0F8485000000            	jz	lff_10
  1286                                  
  1287 0000084D 8A1D[B67D0000]          	mov	bl, [fbs_shift]
  1288                                  
  1289                                  	; 14/12/2024
  1290 00000853 89FA                    	mov	edx, edi ; audio buffer start address
  1291                                  
  1292                                  	; 01/12/2024
  1293 00000855 89C1                    	mov	ecx, eax
  1294 00000857 803D[527D0000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1295 0000085E 751E                    	jne	short lff_7 ; 16 bit samples
  1296                                  	; 8 bit samples
  1297 00000860 FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1298 00000862 740E                    	jz	short lff_6 ; 8 bit, stereo
  1299                                  	; 01/12/2024 (32bit registers)
  1300                                  lff_5:
  1301                                  	; mono & 8 bit
  1302 00000864 AC                      	lodsb
  1303 00000865 2C80                    	sub	al, 80h ; 08/11/2023
  1304 00000867 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1305 0000086A 66AB                    	stosw	; left channel
  1306 0000086C 66AB                    	stosw	; right channel
  1307 0000086E E2F4                    	loop	lff_5
  1308 00000870 EB16                    	jmp	short lff_9
  1309                                  lff_6:
  1310                                  	; stereo & 8 bit
  1311 00000872 AC                      	lodsb
  1312 00000873 2C80                    	sub	al, 80h ; 08/11/2023
  1313 00000875 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1314 00000878 66AB                    	stosw
  1315 0000087A E2F6                    	loop	lff_6
  1316 0000087C EB0A                    	jmp	short lff_9
  1317                                  lff_7:
  1318 0000087E D1E9                    	shr	ecx, 1 ; word count
  1319                                  lff_8:
  1320 00000880 66AD                    	lodsw
  1321 00000882 66AB                    	stosw	; left channel
  1322 00000884 66AB                    	stosw	; right channel
  1323 00000886 E2F8                    	loop	lff_8
  1324                                  lff_9:
  1325                                  	; 14/12/2024
  1326 00000888 89F8                    	mov	eax, edi
  1327 0000088A 8B0D[CC7D0000]          	mov	ecx, [buffersize] 
  1328 00000890 01D1                    	add	ecx, edx ; + buffer start address
  1329 00000892 39C8                    	cmp	eax, ecx	
  1330 00000894 7225                    	jb	short lff_3
  1331 00000896 C3                      	retn
  1332                                  	
  1333                                  lff_1:  
  1334                                  	; 07/12/2024
  1335                                  	; 01/12/2024
  1336                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1337                                  	; 14/12/2024
  1338                                  	sys 	_read, [filehandle], edi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000897 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000089D 89F9                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000089F 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008A5 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000008AA CD40                <1>  int 40h
  1339                                  	; 07/11/2023
  1340 000008AC 721B                    	jc	short lff_4 ; error !
  1341                                  
  1342                                  	; 01/12/2024
  1343                                  	; 14/11/2024
  1344 000008AE A3[D87D0000]            	mov	[count], eax
  1345                                  
  1346                                  	; 02/12/2024
  1347 000008B3 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1348 000008B5 7411                    	je	short endLFF
  1349                                  	; edi = buffer (start) address
  1350 000008B7 01C7                    	add	edi, eax
  1351 000008B9 89D1                    	mov	ecx, edx
  1352                                  lff_3:
  1353                                  	;call	padfill			; blank pad the remainder
  1354                                  	; 21/12/2024
  1355                                  padfill:
  1356                                  	; 14/12/2024
  1357                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1358                                  	; 17/11/2024
  1359                                  	;   di = offset (to be filled with ZEROs)
  1360                                  	;   bp = buffer segment
  1361                                  	;   ax = di = number of bytes loaded
  1362                                  	;   cx = buffer size (> loaded bytes)	
  1363                                  	; 07/11/2023
  1364                                  	; 06/11/2023
  1365                                  	; 17/02/2017
  1366                                  	; 01/12/2024
  1367 000008BB 29C1                    	sub	ecx, eax
  1368                                  	; 01/12/2024
  1369                                  	; 25/11/2024
  1370 000008BD 31C0                    	xor	eax, eax
  1371                                  	; 14/12/2024
  1372 000008BF F3AA                    	rep	stosb
  1373                                  	; 21/12/2024
  1374                                  	;retn
  1375                                  	; ----------
  1376                                          ;clc				; don't exit with CY yet.
  1377 000008C1 800D[5E7D0000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1378                                  endLFF:
  1379 000008C8 C3                              retn
  1380                                  lff_4:
  1381                                  	; 08/11/2023
  1382 000008C9 B021                    	mov	al, '!'  ; error
  1383 000008CB E81AFEFFFF              	call	tL0
  1384                                  
  1385                                  	; 01/12/2024
  1386 000008D0 31C0                    	xor	eax, eax
  1387                                  lff_10:
  1388                                  	; 14/12/2024
  1389 000008D2 8B0D[CC7D0000]          	mov	ecx, [buffersize]
  1390 000008D8 EBE1                    	jmp	short lff_3
  1391                                  
  1392                                  ; /////
  1393                                  
  1394                                  ; --------------------------------------------------------
  1395                                  ; --------------------------------------------------------
  1396                                  	
  1397                                  write_audio_dev_info:
  1398                                  	; 30/05/2024
  1399                                       	;sys_msg msgAudioCardInfo, 0Fh
  1400                                  	; 01/12/2024
  1401                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008DA BB[B2280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000008DF B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000008E4 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008E9 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000008EE CD40                <1>  int 40h
  1402 000008F0 C3                      	retn
  1403                                  
  1404                                  ; --------------------------------------------------------
  1405                                  
  1406                                  write_ac97_pci_dev_info:
  1407                                  	; 19/11/2024
  1408                                  	; 30/05/2024
  1409                                  	; 06/06/2017
  1410                                  	; 03/06/2017
  1411                                  	; BUS/DEV/FN
  1412                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1413                                  	; DEV/VENDOR
  1414                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1415                                  
  1416 000008F1 A1[BC7D0000]            	mov	eax, [dev_vendor]
  1417 000008F6 31DB                    	xor	ebx, ebx
  1418 000008F8 88C3                    	mov	bl, al
  1419 000008FA 88DA                    	mov	dl, bl
  1420 000008FC 80E30F                  	and	bl, 0Fh
  1421 000008FF 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1422 00000905 A2[0F2A0000]            	mov	[msgVendorId+3], al
  1423 0000090A 88D3                    	mov	bl, dl
  1424 0000090C C0EB04                  	shr	bl, 4
  1425 0000090F 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1426 00000915 A2[0E2A0000]            	mov	[msgVendorId+2], al
  1427 0000091A 88E3                    	mov	bl, ah
  1428 0000091C 88DA                    	mov	dl, bl
  1429 0000091E 80E30F                  	and	bl, 0Fh
  1430 00000921 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1431 00000927 A2[0D2A0000]            	mov	[msgVendorId+1], al
  1432 0000092C 88D3                    	mov	bl, dl
  1433 0000092E C0EB04                  	shr	bl, 4
  1434 00000931 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1435 00000937 A2[0C2A0000]            	mov	[msgVendorId], al
  1436 0000093C C1E810                  	shr	eax, 16
  1437 0000093F 88C3                    	mov	bl, al
  1438 00000941 88DA                    	mov	dl, bl
  1439 00000943 80E30F                  	and	bl, 0Fh
  1440 00000946 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1441 0000094C A2[202A0000]            	mov	[msgDevId+3], al
  1442 00000951 88D3                    	mov	bl, dl
  1443 00000953 C0EB04                  	shr	bl, 4
  1444 00000956 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1445 0000095C A2[1F2A0000]            	mov	[msgDevId+2], al
  1446 00000961 88E3                    	mov	bl, ah
  1447 00000963 88DA                    	mov	dl, bl
  1448 00000965 80E30F                  	and	bl, 0Fh
  1449 00000968 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1450 0000096E A2[1E2A0000]            	mov	[msgDevId+1], al
  1451 00000973 88D3                    	mov	bl, dl
  1452 00000975 C0EB04                  	shr	bl, 4
  1453 00000978 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1454 0000097E A2[1D2A0000]            	mov	[msgDevId], al
  1455                                  
  1456 00000983 A1[B87D0000]            	mov	eax, [bus_dev_fn]
  1457 00000988 C1E808                  	shr	eax, 8
  1458 0000098B 88C3                    	mov	bl, al
  1459 0000098D 88DA                    	mov	dl, bl
  1460 0000098F 80E307                  	and	bl, 7 ; bit 0,1,2
  1461 00000992 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1462 00000998 A2[452A0000]            	mov	[msgFncNo+1], al
  1463 0000099D 88D3                    	mov	bl, dl
  1464 0000099F C0EB03                  	shr	bl, 3
  1465 000009A2 88DA                    	mov	dl, bl
  1466 000009A4 80E30F                  	and	bl, 0Fh
  1467 000009A7 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1468 000009AD A2[372A0000]            	mov	[msgDevNo+1], al
  1469 000009B2 88D3                    	mov	bl, dl
  1470 000009B4 C0EB04                  	shr	bl, 4
  1471 000009B7 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1472 000009BD A2[362A0000]            	mov	[msgDevNo], al
  1473 000009C2 88E3                    	mov	bl, ah
  1474 000009C4 88DA                    	mov	dl, bl
  1475 000009C6 80E30F                  	and	bl, 0Fh
  1476 000009C9 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1477 000009CF A2[2B2A0000]            	mov	[msgBusNo+1], al
  1478 000009D4 88D3                    	mov	bl, dl
  1479 000009D6 C0EB04                  	shr	bl, 4
  1480 000009D9 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1481 000009DF A2[2A2A0000]            	mov	[msgBusNo], al
  1482                                  
  1483                                  	;mov	ax, [ac97_NamBar]
  1484 000009E4 66A1[C07D0000]          	mov	ax, [NAMBAR]
  1485 000009EA 88C3                    	mov	bl, al
  1486 000009EC 88DA                    	mov	dl, bl
  1487 000009EE 80E30F                  	and	bl, 0Fh
  1488 000009F1 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1489 000009F7 A2[552A0000]            	mov	[msgNamBar+3], al
  1490 000009FC 88D3                    	mov	bl, dl
  1491 000009FE C0EB04                  	shr	bl, 4
  1492 00000A01 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1493 00000A07 A2[542A0000]            	mov	[msgNamBar+2], al
  1494 00000A0C 88E3                    	mov	bl, ah
  1495 00000A0E 88DA                    	mov	dl, bl
  1496 00000A10 80E30F                  	and	bl, 0Fh
  1497 00000A13 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1498 00000A19 A2[532A0000]            	mov	[msgNamBar+1], al
  1499 00000A1E 88D3                    	mov	bl, dl
  1500 00000A20 C0EB04                  	shr	bl, 4
  1501 00000A23 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1502 00000A29 A2[522A0000]            	mov	[msgNamBar], al
  1503                                  
  1504                                  	;mov	ax, [ac97_NabmBar]
  1505 00000A2E 66A1[C27D0000]          	mov	ax, [NABMBAR]
  1506 00000A34 88C3                    	mov	bl, al
  1507 00000A36 88DA                    	mov	dl, bl
  1508 00000A38 80E30F                  	and	bl, 0Fh
  1509 00000A3B 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1510 00000A41 A2[652A0000]            	mov	[msgNabmBar+3], al
  1511 00000A46 88D3                    	mov	bl, dl
  1512 00000A48 C0EB04                  	shr	bl, 4
  1513 00000A4B 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1514 00000A51 A2[642A0000]            	mov	[msgNabmBar+2], al
  1515 00000A56 88E3                    	mov	bl, ah
  1516 00000A58 88DA                    	mov	dl, bl
  1517 00000A5A 80E30F                  	and	bl, 0Fh
  1518 00000A5D 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1519 00000A63 A2[632A0000]            	mov	[msgNabmBar+1], al
  1520 00000A68 88D3                    	mov	bl, dl
  1521 00000A6A C0EB04                  	shr	bl, 4
  1522 00000A6D 8A83[C8290000]          	mov	al, [hex_chars+ebx]
  1523 00000A73 A2[622A0000]            	mov	[msgNabmBar], al
  1524                                  
  1525 00000A78 31C0                    	xor	eax, eax
  1526 00000A7A A0[5F7D0000]            	mov	al, [ac97_int_ln_reg]
  1527 00000A7F B10A                    	mov	cl, 10
  1528 00000A81 F6F1                    	div	cl
  1529                                  	; 23/11/2024
  1530                                  	;add	[msgIRQ], ax
  1531 00000A83 66053030                	add	ax, 3030h
  1532 00000A87 66A3[6E2A0000]          	mov	[msgIRQ], ax
  1533                                  	;and	al, al
  1534 00000A8D 3C30                    	cmp	al, 30h
  1535 00000A8F 750D                    	jnz	short _w_ac97imsg_
  1536 00000A91 A0[6F2A0000]            	mov	al, byte [msgIRQ+1]
  1537 00000A96 B420                    	mov	ah, ' '
  1538 00000A98 66A3[6E2A0000]          	mov	[msgIRQ], ax
  1539                                  _w_ac97imsg_:
  1540                                  	; 19/11/2024
  1541 00000A9E E8261C0000              	call 	clear_window
  1542 00000AA3 B60D                    	mov	dh, 13
  1543 00000AA5 B200                    	mov	dl, 0
  1544 00000AA7 E838190000              	call	setCursorPosition
  1545                                  	;;;
  1546                                  	; 21/12/2024
  1547 00000AAC BD[D9290000]            	mov	ebp, msgAC97Info ; message
  1548                                  	; 22/12/2024
  1549                                  	;mov	cl, 07h ; color 
  1550 00000AB1 E81F000000              	call	sys_gmsg
  1551                                  	;
  1552                                  	; 30/05/2024
  1553                                  write_VRA_info:
  1554                                  	; 21/12/2024
  1555 00000AB6 BD[732A0000]            	mov	ebp, msgVRAheader ; message
  1556                                  	;mov	cl, 07h ; color 
  1557 00000ABB E815000000              	call	sys_gmsg
  1558                                  	;
  1559 00000AC0 803D[2E7D0000]00        	cmp	byte [VRA], 0
  1560 00000AC7 7607                    	jna	short _w_VRAi_no
  1561                                  _w_VRAi_yes:
  1562 00000AC9 BD[822A0000]            	mov	ebp, msgVRAyes
  1563 00000ACE EB05                    	jmp	short _w_VRAi_yn_msg
  1564                                  _w_VRAi_no:
  1565 00000AD0 BD[882A0000]            	mov	ebp, msgVRAno
  1566                                  _w_VRAi_yn_msg:
  1567                                  	;mov	cl, 07h ; color 
  1568                                  	;call	sys_msg
  1569                                  	;retn
  1570                                  	;jmp	short sys_gmsg
  1571                                  	;;;
  1572                                  ; --------------------------------------------------------
  1573                                  
  1574                                  	; 22/12/2024
  1575                                  	;;;
  1576                                  	; 21/12/2024
  1577                                  	; (write message in VGA/VESA-VBE mode)
  1578                                  sys_gmsg:
  1579 00000AD5 8A4500                  	mov	al, [ebp]
  1580 00000AD8 20C0                    	and	al, al
  1581 00000ADA 7458                    	jz	short sys_gmsg_ok
  1582 00000ADC 3C20                    	cmp	al, 20h
  1583 00000ADE 731E                    	jnb	short sys_gmsg_3
  1584 00000AE0 3C0D                    	cmp	al, CR ; 13
  1585 00000AE2 750C                    	jne	short sys_gmsg_2
  1586                                  	; carriege return, move cursor to column 0
  1587 00000AE4 66C705[14730000]00-     	mov	word [screenpos], 0
  1587 00000AEC 00                 
  1588                                  sys_gmsg_1:
  1589 00000AED 45                      	inc	ebp
  1590 00000AEE EBE5                    	jmp	short sys_gmsg
  1591                                  sys_gmsg_2:
  1592 00000AF0 3C0A                    	cmp	al, LF ; 10
  1593 00000AF2 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1594                                  	; line feed, move cursor to next row
  1595 00000AF4 668305[16730000]10      	add	word [screenpos+2], 16
  1596 00000AFC EBEF                    	jmp	short sys_gmsg_1
  1597                                  sys_gmsg_3:
  1598 00000AFE 8B35[14730000]          	mov	esi, [screenpos]
  1599                                  		; hw = (cursor) row
  1600                                  		; si = (cursor) column
  1601 00000B04 B907000000              	mov	ecx, 07h ; gray (light)
  1602 00000B09 E88F1A0000              	call	write_character
  1603 00000B0E 83C608                  	add	esi, 8
  1604                                  	;;;
  1605 00000B11 6681FE8002              	cmp	si, 640
  1606 00000B16 7213                    	jb	short sys_gmsg_5
  1607 00000B18 C1EE10                  	shr	esi, 16
  1608 00000B1B 6683C610                	add	si, 16
  1609 00000B1F 6681FEE001              	cmp	si, 480
  1610 00000B24 7202                    	jb	short sys_gmsg_4
  1611 00000B26 31F6                    	xor	esi, esi
  1612                                  sys_gmsg_4:
  1613 00000B28 C1E610                  	shl	esi, 16
  1614                                  	;;;
  1615                                  sys_gmsg_5:
  1616 00000B2B 8935[14730000]          	mov	[screenpos], esi
  1617 00000B31 45                      	inc	ebp
  1618 00000B32 EBA1                    	jmp	short sys_gmsg
  1619                                  sys_gmsg_ok:
  1620 00000B34 C3                      	retn
  1621                                  	;;;
  1622                                  
  1623                                  ; --------------------------------------------------------
  1624                                  
  1625                                  ; 07/12/2024 - playwav9.s
  1626                                  ; 01/12/2024 - ac97play.s
  1627                                  ; 29/05/2024
  1628                                  ; 26/11/2023
  1629                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1630                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1631                                  ; 14/11/2023
  1632                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1633                                  ; --------------------------------------------------------
  1634                                  
  1635                                  ;;Note:	At the end of every buffer load,
  1636                                  ;;	during buffer switch/swap, there will be discontinuity
  1637                                  ;;	between the last converted sample and the 1st sample
  1638                                  ;;	of the next buffer.
  1639                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1640                                  ;;	-To avoid this defect, the 1st sample of
  1641                                  ;;	the next buffer may be read from the wav file but
  1642                                  ;;	the file pointer would need to be set to 1 sample back
  1643                                  ;;	again via seek system call. Time comsumption problem! -
  1644                                  ;;
  1645                                  ;;	Erdogan Tan - 15/11/2023
  1646                                  ;;
  1647                                  ;;	((If entire wav data would be loaded at once.. conversion
  1648                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1649                                  ;;	64KB buffer limit is important also it is important
  1650                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1651                                  ;;	I have tested this program by using 2-30MB wav files.))
  1652                                  ;;
  1653                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1654                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1655                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1656                                  ;;			Realtek ALC850 codec.
  1657                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1658                                  
  1659                                  load_8khz_mono_8_bit:
  1660                                  	; 15/11/2023
  1661                                  	; 14/11/2023
  1662                                  	; 13/11/2023
  1663 00000B35 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1664                                  					; last of the file?
  1665 00000B3C 7402                    	jz	short lff8m_0		; no
  1666 00000B3E F9                      	stc
  1667 00000B3F C3                      	retn
  1668                                  
  1669                                  lff8m_0:
  1670                                  	; 01/12/2024
  1671                                  	; edi = audio buffer address
  1672 00000B40 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1673                                          ;mov	edx, [loadsize]
  1674                                  
  1675                                  	; esi = buffer address
  1676                                  	;; edx = buffer size
  1677                                  
  1678                                  	; load file into memory
  1679                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000B45 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000B4B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000B4D 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000B53 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000B58 CD40                <1>  int 40h
  1680 00000B5A 7305                    	jnc	short lff8m_6
  1681 00000B5C E9AF000000              	jmp	lff8m_5  ; error !
  1682                                  
  1683                                  lff8m_6:
  1684                                  	; 01/12/2024
  1685 00000B61 A3[D87D0000]            	mov	[count], eax
  1686                                  	;;;
  1687                                  	; 07/12/2024
  1688                                  	;mov	edi, audio_buffer
  1689                                  	;;;
  1690 00000B66 21C0                    	and	eax, eax
  1691 00000B68 0F8499000000            	jz	lff8_eof
  1692                                  
  1693 00000B6E 89C1                    	mov	ecx, eax		; byte count
  1694                                  lff8m_1:
  1695 00000B70 AC                      	lodsb
  1696 00000B71 A2[5C210000]            	mov	[previous_val], al
  1697 00000B76 2C80                    	sub	al, 80h
  1698 00000B78 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1699 00000B7C 66AB                    	stosw		; original sample (left channel)
  1700 00000B7E 66AB                    	stosw		; original sample (right channel)
  1701                                  	;xor	eax, eax
  1702 00000B80 B080                    	mov	al, 80h
  1703 00000B82 49                      	dec	ecx
  1704 00000B83 7402                    	jz	short lff8m_2
  1705 00000B85 8A06                    	mov	al, [esi]
  1706                                  lff8m_2:
  1707                                  	;mov	[next_val], ax
  1708 00000B87 88C7                    	mov	bh, al	; [next_val]
  1709 00000B89 8A25[5C210000]          	mov	ah, [previous_val]
  1710 00000B8F 00E0                    	add	al, ah	; [previous_val]
  1711 00000B91 D0D8                    	rcr	al, 1
  1712 00000B93 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1713 00000B95 00E0                    	add	al, ah	; [previous_val]
  1714 00000B97 D0D8                    	rcr	al, 1	
  1715 00000B99 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1716 00000B9B 00E0                    	add	al, ah	; [previous_val]
  1717 00000B9D D0D8                    	rcr	al, 1
  1718 00000B9F 2C80                    	sub	al, 80h
  1719 00000BA1 66C1E008                	shl	ax, 8	
  1720 00000BA5 66AB                    	stosw		; this is 1st interpolated sample (L)
  1721 00000BA7 66AB                    	stosw		; this is 1st interpolated sample (R)
  1722 00000BA9 88D8                    	mov	al, bl
  1723 00000BAB 00D0                    	add	al, dl
  1724 00000BAD D0D8                    	rcr	al, 1
  1725 00000BAF 2C80                    	sub	al, 80h
  1726 00000BB1 66C1E008                	shl	ax, 8
  1727 00000BB5 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1728 00000BB7 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1729 00000BB9 88D0                    	mov	al, dl
  1730 00000BBB 2C80                    	sub	al, 80h
  1731 00000BBD 66C1E008                	shl	ax, 8
  1732 00000BC1 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1733 00000BC3 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1734                                  	;mov	al, [next_val]
  1735 00000BC5 88F8                    	mov	al, bh
  1736 00000BC7 00D0                    	add	al, dl
  1737 00000BC9 D0D8                    	rcr	al, 1
  1738 00000BCB 88C3                    	mov	bl, al	; this is temporary interpolation value
  1739 00000BCD 00D0                    	add	al, dl
  1740 00000BCF D0D8                    	rcr	al, 1
  1741 00000BD1 2C80                    	sub	al, 80h
  1742 00000BD3 66C1E008                	shl	ax, 8
  1743 00000BD7 66AB                    	stosw		; this is 4th interpolated sample (L)
  1744 00000BD9 66AB                    	stosw		; this is 4th interpolated sample (R)
  1745                                  	;mov	al, [next_val]
  1746 00000BDB 88F8                    	mov	al, bh
  1747 00000BDD 00D8                    	add	al, bl
  1748 00000BDF D0D8                    	rcr	al, 1
  1749 00000BE1 2C80                    	sub	al, 80h
  1750 00000BE3 66C1E008                	shl	ax, 8
  1751 00000BE7 66AB                    	stosw		; this is 5th interpolated sample (L)
  1752 00000BE9 66AB                    	stosw		; this is 5th interpolated sample (R)
  1753                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1754 00000BEB 09C9                    	or	ecx, ecx
  1755 00000BED 7581                    	jnz	short lff8m_1
  1756                                  
  1757                                  	; --------------
  1758                                  
  1759                                  lff8s_3:
  1760                                  lff8m_3:
  1761                                  lff8s2_3:
  1762                                  lff8m2_3:
  1763                                  lff16s_3:
  1764                                  lff16m_3:
  1765                                  lff16s2_3:
  1766                                  lff16m2_3:
  1767                                  lff24_3:
  1768                                  lff32_3:
  1769                                  lff44_3:
  1770                                  lff22_3:
  1771                                  lff11_3:
  1772                                  	; 08/12/2024 (BugFix)
  1773                                  	; 31/05/2024 (BugFix)
  1774 00000BEF 8B0D[CC7D0000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  1775                                  	;shl	ecx, 1	; byte count ; Bug !
  1776                                  	; 08/12/2024
  1777 00000BF5 81C1[00800000]          	add	ecx, audio_buffer
  1778 00000BFB 29F9                    	sub	ecx, edi
  1779 00000BFD 7607                    	jna	short lff8m_4
  1780                                  	;inc	ecx
  1781 00000BFF C1E902                  	shr	ecx, 2
  1782 00000C02 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  1783 00000C04 F3AB                    	rep	stosd
  1784                                  lff8m_4:
  1785                                  	; 31/05/2024 (BugFix)
  1786                                  	; cf=1 ; Bug !
  1787                                  	; 08/12/2024
  1788                                  	;clc
  1789 00000C06 C3                      	retn
  1790                                  
  1791                                  lff8_eof:
  1792                                  lff16_eof:
  1793                                  lff24_eof:
  1794                                  lff32_eof:
  1795                                  lff44_eof:
  1796                                  lff22_eof:
  1797                                  lff11_eof:
  1798                                  	; 15/11/2023
  1799 00000C07 C605[5E7D0000]01        	mov	byte [flags], ENDOFFILE
  1800 00000C0E EBDF                    	jmp	short lff8m_3
  1801                                  
  1802                                  lff8s_5:
  1803                                  lff8m_5:
  1804                                  lff8s2_5:
  1805                                  lff8m2_5:
  1806                                  lff16s_5:
  1807                                  lff16m_5:
  1808                                  lff16s2_5:
  1809                                  lff16m2_5:
  1810                                  lff24_5:
  1811                                  lff32_5:
  1812                                  lff44_5:
  1813                                  lff22_5:
  1814                                  lff11_5:
  1815 00000C10 B021                    	mov	al, '!'  ; error
  1816 00000C12 E8D3FAFFFF              	call	tL0
  1817                                  	
  1818                                  	;jmp	short lff8m_3
  1819                                  	; 15/11/2023
  1820 00000C17 EBEE                    	jmp	lff8_eof
  1821                                  
  1822                                  	; --------------
  1823                                  
  1824                                  load_8khz_stereo_8_bit:
  1825                                  	; 15/11/2023
  1826                                  	; 14/11/2023
  1827                                  	; 13/11/2023
  1828 00000C19 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1829                                  					; last of the file?
  1830 00000C20 7402                    	jz	short lff8s_0		; no
  1831 00000C22 F9                      	stc
  1832 00000C23 C3                      	retn
  1833                                  
  1834                                  lff8s_0:
  1835                                  	; 01/12/2024
  1836                                  	; edi = audio buffer address
  1837 00000C24 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1838                                          ;mov	edx, [loadsize]
  1839                                  
  1840                                  	; esi = buffer address
  1841                                  	;; edx = buffer size
  1842                                  
  1843                                  	; load file into memory
  1844                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000C29 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000C2F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000C31 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000C37 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000C3C CD40                <1>  int 40h
  1845 00000C3E 72D0                    	jc	short lff8s_5 ; error !
  1846                                  
  1847                                  	; 01/12/2024
  1848 00000C40 A3[D87D0000]            	mov	[count], eax
  1849                                  	;;;
  1850                                  	; 07/12/2024
  1851                                  	;mov	edi, audio_buffer
  1852                                  	;;;
  1853 00000C45 D1E8                    	shr	eax, 1
  1854 00000C47 74BE                    	jz	short lff8_eof
  1855                                  
  1856 00000C49 89C1                    	mov	ecx, eax	; word count
  1857                                  lff8s_1:
  1858 00000C4B AC                      	lodsb
  1859 00000C4C A2[5C210000]            	mov	[previous_val_l], al
  1860 00000C51 2C80                    	sub	al, 80h
  1861 00000C53 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1862 00000C57 66AB                    	stosw		; original sample (L)
  1863 00000C59 AC                      	lodsb
  1864 00000C5A A2[5E210000]            	mov	[previous_val_r], al
  1865 00000C5F 2C80                    	sub	al, 80h
  1866 00000C61 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1867 00000C65 66AB                    	stosw		; original sample (R)
  1868                                  
  1869                                  	;xor	eax, eax
  1870 00000C67 66B88080                	mov	ax, 8080h
  1871 00000C6B 49                      	dec	ecx
  1872 00000C6C 7403                    	jz	short lff8s_2
  1873                                  		; convert 8 bit sample to 16 bit sample
  1874 00000C6E 668B06                  	mov	ax, [esi]
  1875                                  lff8s_2:
  1876 00000C71 A2[60210000]            	mov	[next_val_l], al
  1877 00000C76 8825[62210000]          	mov	[next_val_r], ah
  1878 00000C7C 8A25[5C210000]          	mov	ah, [previous_val_l]
  1879 00000C82 00E0                    	add	al, ah
  1880 00000C84 D0D8                    	rcr	al, 1
  1881 00000C86 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  1882 00000C88 00E0                    	add	al, ah
  1883 00000C8A D0D8                    	rcr	al, 1
  1884 00000C8C 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1885 00000C8E 00E0                    	add	al, ah
  1886 00000C90 D0D8                    	rcr	al, 1
  1887 00000C92 2C80                    	sub	al, 80h
  1888 00000C94 66C1E008                	shl	ax, 8
  1889 00000C98 66AB                    	stosw		; this is 1st interpolated sample (L)
  1890 00000C9A A0[62210000]            	mov	al, [next_val_r]
  1891 00000C9F 8A25[5E210000]          	mov	ah, [previous_val_r]
  1892 00000CA5 00E0                    	add	al, ah
  1893 00000CA7 D0D8                    	rcr	al, 1
  1894 00000CA9 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  1895 00000CAB 00E0                    	add	al, ah
  1896 00000CAD D0D8                    	rcr	al, 1
  1897 00000CAF 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1898 00000CB1 00E0                    	add	al, ah
  1899 00000CB3 D0D8                    	rcr	al, 1
  1900 00000CB5 2C80                    	sub	al, 80h
  1901 00000CB7 66C1E008                	shl	ax, 8
  1902 00000CBB 66AB                    	stosw		; this is 1st interpolated sample (R)
  1903 00000CBD 88D8                    	mov	al, bl
  1904 00000CBF 00D0                    	add	al, dl
  1905 00000CC1 D0D8                    	rcr	al, 1
  1906 00000CC3 2C80                    	sub	al, 80h
  1907 00000CC5 66C1E008                	shl	ax, 8
  1908 00000CC9 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1909 00000CCB 88F8                    	mov	al, bh
  1910 00000CCD 00F0                    	add	al, dh
  1911 00000CCF D0D8                    	rcr	al, 1
  1912 00000CD1 2C80                    	sub	al, 80h
  1913 00000CD3 66C1E008                	shl	ax, 8
  1914 00000CD7 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1915 00000CD9 88D0                    	mov	al, dl
  1916 00000CDB 2C80                    	sub	al, 80h
  1917 00000CDD 66C1E008                	shl	ax, 8
  1918 00000CE1 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1919 00000CE3 88F0                    	mov	al, dh
  1920 00000CE5 2C80                    	sub	al, 80h
  1921 00000CE7 66C1E008                	shl	ax, 8
  1922 00000CEB 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1923 00000CED A0[60210000]            	mov	al, [next_val_l]
  1924 00000CF2 00D0                    	add	al, dl
  1925 00000CF4 D0D8                    	rcr	al, 1
  1926 00000CF6 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1927 00000CF8 00D0                    	add	al, dl
  1928 00000CFA D0D8                    	rcr	al, 1
  1929 00000CFC 2C80                    	sub	al, 80h
  1930 00000CFE 66C1E008                	shl	ax, 8
  1931 00000D02 66AB                    	stosw		; this is 4th interpolated sample (L)
  1932 00000D04 A0[62210000]            	mov	al, [next_val_r]
  1933 00000D09 00F0                    	add	al, dh
  1934 00000D0B D0D8                    	rcr	al, 1
  1935 00000D0D 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1936 00000D0F 00F0                    	add	al, dh
  1937 00000D11 D0D8                    	rcr	al, 1
  1938 00000D13 2C80                    	sub	al, 80h
  1939 00000D15 66C1E008                	shl	ax, 8
  1940 00000D19 66AB                    	stosw		; this is 4th interpolated sample (R)
  1941 00000D1B A0[60210000]            	mov	al, [next_val_l]
  1942 00000D20 00D8                    	add	al, bl
  1943 00000D22 D0D8                    	rcr	al, 1
  1944 00000D24 2C80                    	sub	al, 80h
  1945 00000D26 66C1E008                	shl	ax, 8
  1946 00000D2A 66AB                    	stosw		; this is 5th interpolated sample (L)
  1947 00000D2C A0[62210000]            	mov	al, [next_val_r]
  1948 00000D31 00F8                    	add	al, bh
  1949 00000D33 D0D8                    	rcr	al, 1
  1950 00000D35 2C80                    	sub	al, 80h
  1951 00000D37 66C1E008                	shl	ax, 8
  1952 00000D3B 66AB                    	stosw		; this is 5th interpolated sample (R)
  1953                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1954 00000D3D E305                    	jecxz	lff8s_6
  1955 00000D3F E907FFFFFF              	jmp	lff8s_1
  1956                                  lff8s_6:
  1957 00000D44 E9A6FEFFFF              	jmp	lff8s_3
  1958                                  
  1959                                  load_8khz_mono_16_bit:
  1960                                  	; 13/11/2023
  1961 00000D49 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1962                                  					; last of the file?
  1963 00000D50 7402                    	jz	short lff8m2_0		; no
  1964 00000D52 F9                      	stc
  1965 00000D53 C3                      	retn
  1966                                  
  1967                                  lff8m2_0:
  1968                                  	; 01/12/2024
  1969                                  	; edi = audio buffer address
  1970 00000D54 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1971                                          ;mov	edx, [loadsize]
  1972                                  
  1973                                  	; esi = buffer address
  1974                                  	;; edx = buffer size
  1975                                  
  1976                                  	; load file into memory
  1977                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000D59 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000D5F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000D61 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000D67 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000D6C CD40                <1>  int 40h
  1978 00000D6E 0F82A0000000            	jc	lff8m2_7 ; error !
  1979                                  
  1980                                  	; 01/12/2024
  1981 00000D74 A3[D87D0000]            	mov	[count], eax
  1982                                  	;;;
  1983                                  	; 07/12/2024
  1984                                  	;mov	edi, audio_buffer
  1985                                  	;;;
  1986 00000D79 D1E8                    	shr	eax, 1
  1987 00000D7B 7505                    	jnz	short lff8m2_8
  1988 00000D7D E985FEFFFF              	jmp	lff8_eof
  1989                                  
  1990                                  lff8m2_8:
  1991 00000D82 89C1                    	mov	ecx, eax	; word count
  1992                                  lff8m2_1:
  1993 00000D84 66AD                    	lodsw
  1994 00000D86 66AB                    	stosw		; original sample (left channel)
  1995 00000D88 66AB                    	stosw		; original sample (right channel)
  1996 00000D8A 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1997 00000D8D 66A3[5C210000]          	mov	[previous_val], ax
  1998 00000D93 31C0                    	xor	eax, eax
  1999 00000D95 49                      	dec	ecx
  2000 00000D96 7403                    	jz	short lff8m2_2
  2001 00000D98 668B06                  	mov	ax, [esi]
  2002                                  lff8m2_2:
  2003 00000D9B 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  2004 00000D9E 89C5                    	mov	ebp, eax	; [next_val]
  2005 00000DA0 660305[5C210000]        	add	ax, [previous_val]
  2006 00000DA7 66D1D8                  	rcr	ax, 1
  2007 00000DAA 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  2008 00000DAC 660305[5C210000]        	add	ax, [previous_val]
  2009 00000DB3 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  2010 00000DB6 89C3                    	mov	ebx, eax 		
  2011 00000DB8 660305[5C210000]        	add	ax, [previous_val]
  2012 00000DBF 66D1D8                  	rcr	ax, 1
  2013 00000DC2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2014 00000DC5 66AB                    	stosw		; this is 1st interpolated sample (L)
  2015 00000DC7 66AB                    	stosw		; this is 1st interpolated sample (R)
  2016 00000DC9 89D8                    	mov	eax, ebx
  2017 00000DCB 6601D0                  	add	ax, dx
  2018 00000DCE 66D1D8                  	rcr	ax, 1
  2019 00000DD1 80EC80                  	sub	ah, 80h
  2020 00000DD4 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2021 00000DD6 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2022 00000DD8 89D0                    	mov	eax, edx
  2023 00000DDA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2024 00000DDD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2025 00000DDF 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2026 00000DE1 89E8                    	mov	eax, ebp
  2027 00000DE3 6601D0                  	add	ax, dx
  2028 00000DE6 66D1D8                  	rcr	ax, 1
  2029 00000DE9 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2030 00000DEB 6601D0                  	add	ax, dx
  2031 00000DEE 66D1D8                  	rcr	ax, 1
  2032 00000DF1 80EC80                  	sub	ah, 80h
  2033 00000DF4 66AB                    	stosw		; this is 4th interpolated sample (L)
  2034 00000DF6 66AB                    	stosw		; this is 4th interpolated sample (R)
  2035 00000DF8 89E8                    	mov	eax, ebp
  2036 00000DFA 6601D8                  	add	ax, bx
  2037 00000DFD 66D1D8                  	rcr	ax, 1
  2038 00000E00 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2039 00000E03 66AB                    	stosw		; this is 5th interpolated sample (L)
  2040 00000E05 66AB                    	stosw		; this is 5th interpolated sample (R)
  2041                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2042 00000E07 09C9                    	or	ecx, ecx
  2043 00000E09 0F8575FFFFFF            	jnz	lff8m2_1
  2044 00000E0F E9DBFDFFFF              	jmp	lff8m2_3
  2045                                  
  2046                                  lff8m2_7:
  2047                                  lff8s2_7:
  2048 00000E14 E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2049                                  
  2050                                  load_8khz_stereo_16_bit:
  2051                                  	; 16/11/2023
  2052                                  	; 15/11/2023
  2053                                  	; 13/11/2023
  2054 00000E19 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2055                                  					; last of the file?
  2056 00000E20 7402                    	jz	short lff8s2_0		; no
  2057 00000E22 F9                      	stc
  2058 00000E23 C3                      	retn
  2059                                  
  2060                                  lff8s2_0:
  2061                                  	; 01/12/2024
  2062                                  	; edi = audio buffer address
  2063 00000E24 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2064                                          ;mov	edx, [loadsize]
  2065                                  
  2066                                  	; esi = buffer address
  2067                                  	;; edx = buffer size
  2068                                  
  2069                                  	; load file into memory
  2070                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000E29 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000E2F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000E31 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000E37 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000E3C CD40                <1>  int 40h
  2071 00000E3E 72D4                    	jc	short lff8s2_7 ; error !
  2072                                  
  2073                                  	; 01/12/2024
  2074 00000E40 A3[D87D0000]            	mov	[count], eax
  2075                                  	;;;
  2076                                  	; 07/12/2024
  2077                                  	;mov	edi, audio_buffer
  2078                                  	;;;
  2079 00000E45 C1E802                  	shr	eax, 2
  2080 00000E48 7505                    	jnz	short lff8s2_8
  2081 00000E4A E9B8FDFFFF              	jmp	lff8_eof
  2082                                  
  2083                                  lff8s2_8:
  2084 00000E4F 89C1                    	mov	ecx, eax ; dword count
  2085                                  lff8s2_1:
  2086 00000E51 66AD                    	lodsw
  2087 00000E53 66AB                    	stosw		; original sample (L)
  2088                                  	; 15/11/2023
  2089 00000E55 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2090 00000E58 66A3[5C210000]          	mov	[previous_val_l], ax
  2091 00000E5E 66AD                    	lodsw
  2092 00000E60 66AB                    	stosw		; original sample (R)
  2093 00000E62 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2094 00000E65 66A3[5E210000]          	mov	[previous_val_r], ax
  2095 00000E6B 31D2                    	xor	edx, edx
  2096 00000E6D 31C0                    	xor	eax, eax
  2097                                  	; 16/11/2023
  2098 00000E6F 49                      	dec	ecx
  2099 00000E70 7407                    	jz	short lff8s2_2
  2100 00000E72 668B06                  	mov	ax, [esi]
  2101 00000E75 668B5602                	mov	dx, [esi+2]
  2102                                  lff8s2_2:
  2103 00000E79 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2104 00000E7C 66A3[60210000]          	mov	[next_val_l], ax
  2105 00000E82 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2106 00000E85 668915[62210000]        	mov	[next_val_r], dx
  2107 00000E8C 660305[5C210000]        	add	ax, [previous_val_l]
  2108 00000E93 66D1D8                  	rcr	ax, 1
  2109 00000E96 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2110 00000E98 660305[5C210000]        	add	ax, [previous_val_l]
  2111 00000E9F 66D1D8                  	rcr	ax, 1	
  2112 00000EA2 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2113 00000EA4 660305[5C210000]        	add	ax, [previous_val_l]
  2114 00000EAB 66D1D8                  	rcr	ax, 1
  2115 00000EAE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2116 00000EB1 66AB                    	stosw		; this is 1st interpolated sample (L)
  2117 00000EB3 66A1[62210000]          	mov	ax, [next_val_r]
  2118 00000EB9 660305[5E210000]        	add	ax, [previous_val_r]
  2119 00000EC0 66D1D8                  	rcr	ax, 1
  2120 00000EC3 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2121 00000EC5 660305[5E210000]        	add	ax, [previous_val_r]
  2122 00000ECC 66D1D8                  	rcr	ax, 1
  2123 00000ECF 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2124 00000ED0 660305[5E210000]        	add	ax, [previous_val_r]
  2125 00000ED7 66D1D8                  	rcr	ax, 1
  2126 00000EDA 80EC80                  	sub	ah, 80h
  2127 00000EDD 66AB                    	stosw		; this is 1st interpolated sample (R)
  2128 00000EDF 89D8                    	mov	eax, ebx
  2129 00000EE1 6601D0                  	add	ax, dx
  2130 00000EE4 66D1D8                  	rcr	ax, 1
  2131 00000EE7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2132 00000EEA 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2133 00000EEC 58                      	pop	eax ; *
  2134 00000EED 6601E8                  	add	ax, bp
  2135 00000EF0 66D1D8                  	rcr	ax, 1
  2136 00000EF3 80EC80                  	sub	ah, 80h
  2137 00000EF6 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2138 00000EF8 89D0                    	mov	eax, edx
  2139 00000EFA 80EC80                  	sub	ah, 80h
  2140 00000EFD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2141 00000EFF 89E8                    	mov	eax, ebp
  2142 00000F01 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2143 00000F04 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2144 00000F06 66A1[60210000]          	mov	ax, [next_val_l]
  2145 00000F0C 6601D0                  	add	ax, dx
  2146 00000F0F 66D1D8                  	rcr	ax, 1
  2147 00000F12 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2148 00000F14 6601D0                  	add	ax, dx
  2149 00000F17 66D1D8                  	rcr	ax, 1
  2150 00000F1A 80EC80                  	sub	ah, 80h
  2151 00000F1D 66AB                    	stosw		; this is 4th interpolated sample (L)
  2152 00000F1F 66A1[62210000]          	mov	ax, [next_val_r]
  2153 00000F25 6601E8                  	add	ax, bp
  2154 00000F28 66D1D8                  	rcr	ax, 1
  2155 00000F2B 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2156 00000F2C 6601E8                  	add	ax, bp
  2157 00000F2F 66D1D8                  	rcr	ax, 1
  2158 00000F32 80EC80                  	sub	ah, 80h
  2159 00000F35 66AB                    	stosw		; this is 4th interpolated sample (R)
  2160 00000F37 66A1[60210000]          	mov	ax, [next_val_l]
  2161 00000F3D 6601D8                  	add	ax, bx
  2162 00000F40 66D1D8                  	rcr	ax, 1
  2163 00000F43 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2164 00000F46 66AB                    	stosw		; this is 5th interpolated sample (L)
  2165 00000F48 58                      	pop	eax ; **
  2166 00000F49 660305[62210000]        	add	ax, [next_val_r]
  2167 00000F50 66D1D8                  	rcr	ax, 1
  2168 00000F53 80EC80                  	sub	ah, 80h
  2169 00000F56 66AB                    	stosw		; this is 5th interpolated sample (R)
  2170                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2171 00000F58 E305                    	jecxz	lff8_s2_9
  2172 00000F5A E9F2FEFFFF              	jmp	lff8s2_1
  2173                                  lff8_s2_9:
  2174 00000F5F E98BFCFFFF              	jmp	lff8s2_3
  2175                                  
  2176                                  ; .....................
  2177                                  
  2178                                  load_16khz_mono_8_bit:
  2179                                  	; 14/11/2023
  2180                                  	; 13/11/2023
  2181 00000F64 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2182                                  					; last of the file?
  2183 00000F6B 7402                    	jz	short lff16m_0		; no
  2184 00000F6D F9                      	stc
  2185 00000F6E C3                      	retn
  2186                                  
  2187                                  lff16m_0:
  2188                                  	; 01/12/2024
  2189                                  	; edi = audio buffer address
  2190 00000F6F BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2191                                          ;mov	edx, [loadsize]
  2192                                  
  2193                                  	; esi = buffer address
  2194                                  	;; edx = buffer size
  2195                                  
  2196                                  	; load file into memory
  2197                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000F74 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000F7A 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000F7C 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000F82 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000F87 CD40                <1>  int 40h
  2198 00000F89 7253                    	jc	short lff16m_7 ; error !
  2199                                  
  2200                                  	; 01/12/2024
  2201 00000F8B A3[D87D0000]            	mov	[count], eax
  2202                                  	;;;
  2203                                  	; 07/12/2024
  2204                                  	;mov	edi, audio_buffer
  2205                                  	;;;
  2206 00000F90 21C0                    	and	eax, eax
  2207 00000F92 7505                    	jnz	short lff16m_8
  2208 00000F94 E96EFCFFFF              	jmp	lff16_eof
  2209                                  
  2210                                  lff16m_8:
  2211 00000F99 89C1                    	mov	ecx, eax		; byte count
  2212                                  lff16m_1:
  2213 00000F9B AC                      	lodsb
  2214                                  	;mov	[previous_val], al
  2215 00000F9C 88C3                    	mov	bl, al
  2216 00000F9E 2C80                    	sub	al, 80h
  2217 00000FA0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2218 00000FA4 66AB                    	stosw		; original sample (left channel)
  2219 00000FA6 66AB                    	stosw		; original sample (right channel)
  2220                                  	;xor	ax, ax
  2221                                  	; 14/11/22023
  2222 00000FA8 B080                    	mov	al, 80h
  2223 00000FAA 49                      	dec	ecx
  2224 00000FAB 7402                    	jz	short lff16m_2
  2225 00000FAD 8A06                    	mov	al, [esi]
  2226                                  lff16m_2:
  2227                                  	;mov	[next_val], al
  2228 00000FAF 88C7                    	mov	bh, al
  2229                                  	;add	al, [previous_val]
  2230 00000FB1 00D8                    	add	al, bl
  2231 00000FB3 D0D8                    	rcr	al, 1
  2232 00000FB5 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2233                                  	;add	al, [previous_val]
  2234 00000FB7 00D8                    	add	al, bl
  2235 00000FB9 D0D8                    	rcr	al, 1
  2236 00000FBB 2C80                    	sub	al, 80h
  2237 00000FBD 66C1E008                	shl	ax, 8
  2238 00000FC1 66AB                    	stosw		; this is 1st interpolated sample (L)
  2239 00000FC3 66AB                    	stosw		; this is 1st interpolated sample (R)
  2240                                  	;mov	al, [next_val]
  2241 00000FC5 88F8                    	mov	al, bh
  2242 00000FC7 00D0                    	add	al, dl
  2243 00000FC9 D0D8                    	rcr	al, 1
  2244 00000FCB 2C80                    	sub	al, 80h
  2245 00000FCD 66C1E008                	shl	ax, 8
  2246 00000FD1 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2247 00000FD3 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2248                                  	
  2249                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2250 00000FD5 09C9                    	or	ecx, ecx
  2251 00000FD7 75C2                    	jnz	short lff16m_1
  2252 00000FD9 E911FCFFFF              	jmp	lff16m_3
  2253                                  
  2254                                  lff16m_7:
  2255                                  lff16s_7:
  2256 00000FDE E92DFCFFFF              	jmp	lff16m_5  ; error
  2257                                  
  2258                                  load_16khz_stereo_8_bit:
  2259                                  	; 14/11/2023
  2260                                  	; 13/11/2023
  2261 00000FE3 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2262                                  					; last of the file?
  2263 00000FEA 7402                    	jz	short lff16s_0		; no
  2264 00000FEC F9                      	stc
  2265 00000FED C3                      	retn
  2266                                  
  2267                                  lff16s_0:
  2268                                  	; 01/12/2024
  2269                                  	; edi = audio buffer address
  2270 00000FEE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2271                                          ;mov	edx, [loadsize]
  2272                                  
  2273                                  	; esi = buffer address
  2274                                  	;; edx = buffer size
  2275                                  
  2276                                  	; load file into memory
  2277                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000FF3 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000FF9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000FFB 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001001 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001006 CD40                <1>  int 40h
  2278 00001008 72D4                    	jc	short lff16s_7 ; error !
  2279                                  
  2280                                  	; 01/12/2024
  2281 0000100A A3[D87D0000]            	mov	[count], eax
  2282                                  	;;;
  2283                                  	; 07/12/2024
  2284                                  	;mov	edi, audio_buffer
  2285                                  	;;;
  2286 0000100F D1E8                    	shr	eax, 1
  2287 00001011 7505                    	jnz	short lff16s_8
  2288 00001013 E9EFFBFFFF              	jmp	lff16_eof
  2289                                  
  2290                                  lff16s_8:
  2291 00001018 89C1                    	mov	ecx, eax	; word count
  2292                                  lff16s_1:
  2293 0000101A AC                      	lodsb
  2294 0000101B A2[5C210000]            	mov	[previous_val_l], al
  2295 00001020 2C80                    	sub	al, 80h
  2296 00001022 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2297 00001026 66AB                    	stosw		; original sample (L)
  2298 00001028 AC                      	lodsb
  2299 00001029 A2[5E210000]            	mov	[previous_val_r], al
  2300 0000102E 2C80                    	sub	al, 80h
  2301 00001030 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2302 00001034 66AB                    	stosw		; original sample (R)
  2303                                  
  2304                                  	;xor	eax, eax
  2305 00001036 66B88080                	mov	ax, 8080h
  2306 0000103A 49                      	dec	ecx
  2307 0000103B 7403                    	jz	short lff16s_2
  2308                                  		; convert 8 bit sample to 16 bit sample
  2309 0000103D 668B06                  	mov	ax, [esi]
  2310                                  lff16s_2:
  2311                                  	;mov	[next_val_l], al
  2312                                  	;mov	[next_val_r], ah
  2313 00001040 89C3                    	mov	ebx, eax
  2314 00001042 0205[5C210000]          	add	al, [previous_val_l]
  2315 00001048 D0D8                    	rcr	al, 1
  2316 0000104A 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2317 0000104C 0205[5C210000]          	add	al, [previous_val_l]
  2318 00001052 D0D8                    	rcr	al, 1
  2319 00001054 2C80                    	sub	al, 80h
  2320 00001056 66C1E008                	shl	ax, 8
  2321 0000105A 66AB                    	stosw		; this is 1st interpolated sample (L)
  2322 0000105C 88F8                    	mov	al, bh	; [next_val_r]
  2323 0000105E 0205[5E210000]          	add	al, [previous_val_r]
  2324 00001064 D0D8                    	rcr	al, 1
  2325 00001066 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2326 00001068 0205[5E210000]          	add	al, [previous_val_r]
  2327 0000106E D0D8                    	rcr	al, 1
  2328 00001070 2C80                    	sub	al, 80h
  2329 00001072 66C1E008                	shl	ax, 8
  2330 00001076 66AB                    	stosw		; this is 1st interpolated sample (R)
  2331 00001078 88D0                    	mov	al, dl
  2332 0000107A 00D8                    	add	al, bl	; [next_val_l]
  2333 0000107C D0D8                    	rcr	al, 1
  2334 0000107E 2C80                    	sub	al, 80h
  2335 00001080 66C1E008                	shl	ax, 8
  2336 00001084 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2337 00001086 88F0                    	mov	al, dh
  2338 00001088 00F8                    	add	al, bh	; [next_val_r]
  2339 0000108A D0D8                    	rcr	al, 1
  2340 0000108C 2C80                    	sub	al, 80h
  2341 0000108E 66C1E008                	shl	ax, 8
  2342 00001092 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2343                                  	
  2344                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2345 00001094 09C9                    	or	ecx, ecx
  2346 00001096 7582                    	jnz	short lff16s_1
  2347 00001098 E952FBFFFF              	jmp	lff16s_3
  2348                                  
  2349                                  load_16khz_mono_16_bit:
  2350                                  	; 15/11/2023
  2351                                  	; 13/11/2023
  2352 0000109D F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2353                                  					; last of the file?
  2354 000010A4 7402                    	jz	short lff16m2_0		; no
  2355 000010A6 F9                      	stc
  2356 000010A7 C3                      	retn
  2357                                  
  2358                                  lff16m2_0:
  2359                                  	; 01/12/2024
  2360                                  	; edi = audio buffer address
  2361 000010A8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2362                                          ;mov	edx, [loadsize]
  2363                                  
  2364                                  	; esi = buffer address
  2365                                  	;; edx = buffer size
  2366                                  
  2367                                  	; load file into memory
  2368                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000010AD 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000010B3 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000010B5 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000010BB B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000010C0 CD40                <1>  int 40h
  2369 000010C2 7255                    	jc	short lff16m2_7 ; error !
  2370                                  
  2371                                  	; 01/12/2024
  2372 000010C4 A3[D87D0000]            	mov	[count], eax
  2373                                  	;;;
  2374                                  	; 07/12/2024
  2375                                  	;mov	edi, audio_buffer
  2376                                  	;;;
  2377 000010C9 D1E8                    	shr	eax, 1
  2378 000010CB 7505                    	jnz	short lff16m2_8
  2379 000010CD E935FBFFFF              	jmp	lff16_eof
  2380                                  
  2381                                  lff16m2_8:
  2382 000010D2 89C1                    	mov	ecx, eax  ; word count
  2383                                  lff16m2_1:
  2384 000010D4 66AD                    	lodsw
  2385 000010D6 66AB                    	stosw		; original sample (left channel)
  2386 000010D8 66AB                    	stosw		; original sample (right channel)
  2387 000010DA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2388                                  	;mov	[previous_val], ax
  2389 000010DD 89C3                    	mov	ebx, eax
  2390 000010DF 31C0                    	xor	eax, eax
  2391 000010E1 49                      	dec	ecx
  2392 000010E2 7403                    	jz	short lff16m2_2
  2393 000010E4 668B06                  	mov	ax, [esi]
  2394                                  lff16m2_2:
  2395 000010E7 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2396 000010EA 89C5                    	mov	ebp, eax	; [next_val]
  2397                                  	;add	ax, [previous_val]
  2398 000010EC 6601D8                  	add	ax, bx
  2399 000010EF 66D1D8                  	rcr	ax, 1
  2400 000010F2 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2401                                  	;add	ax, [previous_val]
  2402 000010F4 6601D8                  	add	ax, bx
  2403 000010F7 66D1D8                  	rcr	ax, 1
  2404 000010FA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2405 000010FD 66AB                    	stosw		; this is 1st interpolated sample (L)
  2406 000010FF 66AB                    	stosw		; this is 1st interpolated sample (R)
  2407 00001101 89E8                    	mov	eax, ebp
  2408 00001103 6601D0                  	add	ax, dx
  2409 00001106 66D1D8                  	rcr	ax, 1
  2410 00001109 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2411 0000110C 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2412 0000110E 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2413                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2414 00001110 09C9                    	or	ecx, ecx
  2415 00001112 75C0                    	jnz	short lff16m2_1
  2416 00001114 E9D6FAFFFF              	jmp	lff16m2_3
  2417                                  
  2418                                  lff16m2_7:
  2419                                  lff16s2_7:
  2420 00001119 E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2421                                  
  2422                                  load_16khz_stereo_16_bit:
  2423                                  	; 16/11/2023
  2424                                  	; 15/11/2023
  2425                                  	; 13/11/2023
  2426 0000111E F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2427                                  					; last of the file?
  2428 00001125 7402                    	jz	short lff16s2_0		; no
  2429 00001127 F9                      	stc
  2430 00001128 C3                      	retn
  2431                                  
  2432                                  lff16s2_0:
  2433                                  	; 01/12/2024
  2434                                  	; edi = audio buffer address
  2435 00001129 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2436                                          ;mov	edx, [loadsize]
  2437                                  
  2438                                  	; esi = buffer address
  2439                                  	;; edx = buffer size
  2440                                  
  2441                                  	; load file into memory
  2442                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000112E 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001134 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001136 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000113C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001141 CD40                <1>  int 40h
  2443 00001143 72D4                    	jc	short lff16s2_7 ; error !
  2444                                  
  2445                                  	; 01/12/2024
  2446 00001145 A3[D87D0000]            	mov	[count], eax
  2447                                  	;;;
  2448                                  	; 07/12/2024
  2449                                  	;mov	edi, audio_buffer
  2450                                  	;;;
  2451 0000114A C1E802                  	shr	eax, 2
  2452 0000114D 7505                    	jnz	short lff16s2_8
  2453 0000114F E9B3FAFFFF              	jmp	lff16_eof
  2454                                  
  2455                                  lff16s2_8:
  2456 00001154 89C1                    	mov	ecx, eax  ; dword count
  2457                                  lff16s2_1:
  2458 00001156 66AD                    	lodsw
  2459 00001158 66AB                    	stosw		; original sample (L)
  2460 0000115A 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2461 0000115D 66A3[5C210000]          	mov	[previous_val_l], ax
  2462 00001163 66AD                    	lodsw
  2463 00001165 66AB                    	stosw		; original sample (R)
  2464 00001167 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2465 0000116A 66A3[5E210000]          	mov	[previous_val_r], ax
  2466 00001170 31D2                    	xor	edx, edx
  2467 00001172 31C0                    	xor	eax, eax
  2468                                  	; 16/11/2023
  2469 00001174 49                      	dec	ecx
  2470 00001175 7407                    	jz	short lff16s2_2
  2471 00001177 668B06                  	mov	ax, [esi]
  2472 0000117A 668B5602                	mov	dx, [esi+2]
  2473                                  lff16s2_2:
  2474 0000117E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2475                                  	;mov	[next_val_l], ax
  2476 00001181 89C5                    	mov	ebp, eax
  2477 00001183 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2478 00001186 668915[62210000]        	mov	[next_val_r], dx
  2479 0000118D 660305[5C210000]        	add	ax, [previous_val_l]
  2480 00001194 66D1D8                  	rcr	ax, 1
  2481 00001197 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2482 00001199 660305[5C210000]        	add	ax, [previous_val_l]
  2483 000011A0 66D1D8                  	rcr	ax, 1
  2484 000011A3 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2485 000011A6 66AB                    	stosw		; this is 1st interpolated sample (L)
  2486 000011A8 66A1[62210000]          	mov	ax, [next_val_r]
  2487 000011AE 660305[5E210000]        	add	ax, [previous_val_r]
  2488 000011B5 66D1D8                  	rcr	ax, 1
  2489 000011B8 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2490 000011BA 660305[5E210000]        	add	ax, [previous_val_r]
  2491 000011C1 66D1D8                  	rcr	ax, 1
  2492 000011C4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2493 000011C7 66AB                    	stosw		; this is 1st interpolated sample (R)
  2494                                  	;mov	ax, [next_val_l]
  2495 000011C9 89E8                    	mov	eax, ebp
  2496 000011CB 6601D0                  	add	ax, dx
  2497 000011CE 66D1D8                  	rcr	ax, 1
  2498 000011D1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2499 000011D4 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2500 000011D6 66A1[62210000]          	mov	ax, [next_val_r]
  2501 000011DC 6601D8                  	add	ax, bx
  2502 000011DF 66D1D8                  	rcr	ax, 1
  2503 000011E2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2504 000011E5 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2505                                  	
  2506                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2507 000011E7 09C9                    	or	ecx, ecx
  2508 000011E9 0F8567FFFFFF            	jnz	lff16s2_1
  2509 000011EF E9FBF9FFFF              	jmp	lff16s2_3
  2510                                  
  2511                                  ; .....................
  2512                                  
  2513                                  load_24khz_mono_8_bit:
  2514                                  	; 15/11/2023
  2515 000011F4 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2516                                  					; last of the file?
  2517 000011FB 7402                    	jz	short lff24m_0		; no
  2518 000011FD F9                      	stc
  2519 000011FE C3                      	retn
  2520                                  
  2521                                  lff24m_0:
  2522                                  	; 01/12/2024
  2523                                  	; edi = audio buffer address
  2524 000011FF BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2525                                          ;mov	edx, [loadsize]
  2526                                  
  2527                                  	; esi = buffer address
  2528                                  	;; edx = buffer size
  2529                                  
  2530                                  	; load file into memory
  2531                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001204 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000120A 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000120C 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001212 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001217 CD40                <1>  int 40h
  2532 00001219 723B                    	jc	short lff24m_7 ; error !
  2533                                  
  2534                                  	; 01/12/2024
  2535 0000121B A3[D87D0000]            	mov	[count], eax
  2536                                  	;;;
  2537                                  	; 07/12/2024
  2538                                  	;mov	edi, audio_buffer
  2539                                  	;;;
  2540 00001220 21C0                    	and	eax, eax
  2541 00001222 7505                    	jnz	short lff24m_8
  2542 00001224 E9DEF9FFFF              	jmp	lff24_eof
  2543                                  
  2544                                  lff24m_8:
  2545 00001229 89C1                    	mov	ecx, eax	; byte count
  2546                                  lff24m_1:
  2547 0000122B AC                      	lodsb
  2548                                  	;mov	[previous_val], al
  2549 0000122C 88C3                    	mov	bl, al
  2550 0000122E 2C80                    	sub	al, 80h
  2551 00001230 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2552 00001234 66AB                    	stosw		; original sample (left channel)
  2553 00001236 66AB                    	stosw		; original sample (right channel)
  2554                                  	;xor	eax, eax
  2555 00001238 B080                    	mov	al, 80h
  2556 0000123A 49                      	dec	ecx
  2557 0000123B 7402                    	jz	short lff24m_2
  2558 0000123D 8A06                    	mov	al, [esi]
  2559                                  lff24m_2:
  2560                                  	;;mov	[next_val], al
  2561                                  	;mov	bh, al
  2562                                  	;add	al, [previous_val]
  2563 0000123F 00D8                    	add	al, bl
  2564 00001241 D0D8                    	rcr	al, 1
  2565 00001243 2C80                    	sub	al, 80h
  2566 00001245 66C1E008                	shl	ax, 8
  2567 00001249 66AB                    	stosw		; this is interpolated sample (L)
  2568 0000124B 66AB                    	stosw		; this is interpolated sample (R)
  2569                                  	
  2570                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2571 0000124D 09C9                    	or	ecx, ecx
  2572 0000124F 75DA                    	jnz	short lff24m_1
  2573 00001251 E999F9FFFF              	jmp	lff24_3
  2574                                  
  2575                                  lff24m_7:
  2576                                  lff24s_7:
  2577 00001256 E9B5F9FFFF              	jmp	lff24_5  ; error
  2578                                  
  2579                                  load_24khz_stereo_8_bit:
  2580                                  	; 15/11/2023
  2581 0000125B F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2582                                  					; last of the file?
  2583 00001262 7402                    	jz	short lff24s_0		; no
  2584 00001264 F9                      	stc
  2585 00001265 C3                      	retn
  2586                                  
  2587                                  lff24s_0:
  2588                                  	; 01/12/2024
  2589                                  	; edi = audio buffer address
  2590 00001266 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2591                                          ;mov	edx, [loadsize]
  2592                                  
  2593                                  	; esi = buffer address
  2594                                  	;; edx = buffer size
  2595                                  
  2596                                  	; load file into memory
  2597                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000126B 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001271 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001273 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001279 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000127E CD40                <1>  int 40h
  2598 00001280 72D4                    	jc	short lff24s_7 ; error !
  2599                                  
  2600                                  	; 01/12/2024
  2601 00001282 A3[D87D0000]            	mov	[count], eax
  2602                                  	;;;
  2603                                  	; 07/12/2024
  2604                                  	;mov	edi, audio_buffer
  2605                                  	;;;
  2606 00001287 D1E8                    	shr	eax, 1
  2607 00001289 7505                    	jnz	short lff24s_8
  2608 0000128B E977F9FFFF              	jmp	lff24_eof
  2609                                  
  2610                                  lff24s_8:
  2611 00001290 89C1                    	mov	ecx, eax  ; word count
  2612                                  lff24s_1:
  2613 00001292 AC                      	lodsb
  2614 00001293 A2[5C210000]            	mov	[previous_val_l], al
  2615 00001298 2C80                    	sub	al, 80h
  2616 0000129A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2617 0000129E 66AB                    	stosw		; original sample (L)
  2618 000012A0 AC                      	lodsb
  2619 000012A1 A2[5E210000]            	mov	[previous_val_r], al
  2620 000012A6 2C80                    	sub	al, 80h
  2621 000012A8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2622 000012AC 66AB                    	stosw		; original sample (R)
  2623                                  
  2624                                  	;xor	eax, eax
  2625 000012AE 66B88080                	mov	ax, 8080h
  2626 000012B2 49                      	dec	ecx
  2627 000012B3 7403                    	jz	short lff24s_2
  2628                                  		; convert 8 bit sample to 16 bit sample
  2629 000012B5 668B06                  	mov	ax, [esi]
  2630                                  lff24s_2:
  2631                                  	;;mov	[next_val_l], al
  2632                                  	;;mov	[next_val_r], ah
  2633                                  	;mov	bx, ax
  2634 000012B8 88E7                    	mov	bh, ah
  2635 000012BA 0205[5C210000]          	add	al, [previous_val_l]
  2636 000012C0 D0D8                    	rcr	al, 1
  2637                                  	;mov	dl, al
  2638 000012C2 2C80                    	sub	al, 80h
  2639 000012C4 66C1E008                	shl	ax, 8
  2640 000012C8 66AB                    	stosw		; this is interpolated sample (L)
  2641 000012CA 88F8                    	mov	al, bh	; [next_val_r]
  2642 000012CC 0205[5E210000]          	add	al, [previous_val_r]
  2643 000012D2 D0D8                    	rcr	al, 1
  2644                                  	;mov	dh, al
  2645 000012D4 2C80                    	sub	al, 80h
  2646 000012D6 66C1E008                	shl	ax, 8
  2647 000012DA 66AB                    	stosw		; this is interpolated sample (R)
  2648                                  		
  2649                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2650 000012DC 09C9                    	or	ecx, ecx
  2651 000012DE 75B2                    	jnz	short lff24s_1
  2652 000012E0 E90AF9FFFF              	jmp	lff24_3
  2653                                  
  2654                                  load_24khz_mono_16_bit:
  2655                                  	; 15/11/2023
  2656 000012E5 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2657                                  					; last of the file?
  2658 000012EC 7402                    	jz	short lff24m2_0		; no
  2659 000012EE F9                      	stc
  2660 000012EF C3                      	retn
  2661                                  
  2662                                  lff24m2_0:
  2663                                  	; 01/12/2024
  2664                                  	; edi = audio buffer address
  2665 000012F0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2666                                          ;mov	edx, [loadsize]
  2667                                  
  2668                                  	; esi = buffer address
  2669                                  	;; edx = buffer size
  2670                                  
  2671                                  	; load file into memory
  2672                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000012F5 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000012FB 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000012FD 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001303 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001308 CD40                <1>  int 40h
  2673 0000130A 7237                    	jc	short lff24m2_7 ; error !
  2674                                  
  2675                                  	; 01/12/2024
  2676 0000130C A3[D87D0000]            	mov	[count], eax
  2677                                  	;;;
  2678                                  	; 07/12/2024
  2679                                  	;mov	edi, audio_buffer
  2680                                  	;;;
  2681 00001311 D1E8                    	shr	eax, 1
  2682 00001313 7505                    	jnz	short lff24m2_8
  2683 00001315 E9EDF8FFFF              	jmp	lff24_eof
  2684                                  
  2685                                  lff24m2_8:
  2686 0000131A 89C1                    	mov	ecx, eax  ; word count
  2687                                  lff24m2_1:
  2688 0000131C 66AD                    	lodsw
  2689 0000131E 66AB                    	stosw		; original sample (left channel)
  2690 00001320 66AB                    	stosw		; original sample (right channel)
  2691 00001322 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2692                                  	;mov	[previous_val], ax
  2693                                  	;mov	ebx, eax
  2694                                  	;xor	eax, eax
  2695 00001325 31DB                    	xor	ebx, ebx
  2696 00001327 49                      	dec	ecx
  2697 00001328 7403                    	jz	short lff24m2_2
  2698                                  	;mov	ax, [esi]
  2699 0000132A 668B1E                  	mov	bx, [esi]
  2700                                  lff24m2_2:
  2701                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2702                                  	;mov	ebp, eax	; [next_val]
  2703                                  	;add	ax, [previous_val]
  2704                                  	; ax = [previous_val]
  2705                                  	; bx = [next_val]
  2706 0000132D 6601D8                  	add	ax, bx
  2707 00001330 66D1D8                  	rcr	ax, 1
  2708 00001333 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2709 00001336 66AB                    	stosw		; this is interpolated sample (L)
  2710 00001338 66AB                    	stosw		; this is interpolated sample (R)
  2711                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2712 0000133A 09C9                    	or	ecx, ecx
  2713 0000133C 75DE                    	jnz	short lff24m2_1
  2714 0000133E E9ACF8FFFF              	jmp	lff24_3
  2715                                  
  2716                                  lff24m2_7:
  2717                                  lff24s2_7:
  2718 00001343 E9C8F8FFFF              	jmp	lff24_5  ; error
  2719                                  
  2720                                  load_24khz_stereo_16_bit:
  2721                                  	; 16/11/2023
  2722                                  	; 15/11/2023
  2723 00001348 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2724                                  					; last of the file?
  2725 0000134F 7402                    	jz	short lff24s2_0		; no
  2726 00001351 F9                      	stc
  2727 00001352 C3                      	retn
  2728                                  
  2729                                  lff24s2_0:
  2730                                  	; 01/12/2024
  2731                                  	; edi = audio buffer address
  2732 00001353 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2733                                          ;mov	edx, [loadsize]
  2734                                  
  2735                                  	; esi = buffer address
  2736                                  	;; edx = buffer size
  2737                                  
  2738                                  	; load file into memory
  2739                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001358 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000135E 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001360 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001366 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000136B CD40                <1>  int 40h
  2740 0000136D 72D4                    	jc	short lff24s2_7 ; error !
  2741                                  
  2742                                  	; 01/12/2024
  2743 0000136F A3[D87D0000]            	mov	[count], eax
  2744                                  	;;;
  2745                                  	; 07/12/2024
  2746                                  	;mov	edi, audio_buffer
  2747                                  	;;;
  2748 00001374 C1E802                  	shr	eax, 2
  2749 00001377 7505                    	jnz	short lff24s2_8
  2750 00001379 E989F8FFFF              	jmp	lff24_eof
  2751                                  
  2752                                  lff24s2_8:
  2753 0000137E 89C1                    	mov	ecx, eax  ; dword count
  2754                                  lff24s2_1:
  2755 00001380 66AD                    	lodsw
  2756 00001382 66AB                    	stosw		; original sample (L)
  2757 00001384 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2758 00001387 66A3[5C210000]          	mov	[previous_val_l], ax
  2759 0000138D 66AD                    	lodsw
  2760 0000138F 66AB                    	stosw		; original sample (R)
  2761 00001391 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2762                                  	;mov	[previous_val_r], ax
  2763 00001394 89C3                    	mov	ebx, eax
  2764 00001396 31D2                    	xor	edx, edx
  2765 00001398 31C0                    	xor	eax, eax
  2766                                  	; 16/11/2023
  2767 0000139A 49                      	dec	ecx
  2768 0000139B 7407                    	jz	short lff24s2_2
  2769 0000139D 668B06                  	mov	ax, [esi]
  2770 000013A0 668B5602                	mov	dx, [esi+2]
  2771                                  lff24s2_2:
  2772 000013A4 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2773                                  	;;mov	[next_val_l], ax
  2774                                  	;mov	ebp, eax
  2775 000013A7 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2776                                  	;mov	[next_val_r], dx
  2777 000013AA 660305[5C210000]        	add	ax, [previous_val_l]
  2778 000013B1 66D1D8                  	rcr	ax, 1
  2779 000013B4 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2780 000013B7 66AB                    	stosw		; this is interpolated sample (L)
  2781                                  	;mov	ax, [next_val_r]
  2782 000013B9 89D0                    	mov	eax, edx
  2783                                  	;add	ax, [previous_val_r]
  2784 000013BB 6601D8                  	add	ax, bx
  2785 000013BE 66D1D8                  	rcr	ax, 1
  2786 000013C1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2787 000013C4 66AB                    	stosw		; this is interpolated sample (R)
  2788                                  	
  2789                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2790 000013C6 09C9                    	or	ecx, ecx
  2791 000013C8 75B6                    	jnz	short lff24s2_1
  2792 000013CA E920F8FFFF              	jmp	lff24_3
  2793                                  
  2794                                  ; .....................
  2795                                  
  2796                                  load_32khz_mono_8_bit:
  2797                                  	; 15/11/2023
  2798 000013CF F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2799                                  					; last of the file?
  2800 000013D6 7402                    	jz	short lff32m_0		; no
  2801 000013D8 F9                      	stc
  2802 000013D9 C3                      	retn
  2803                                  
  2804                                  lff32m_0:
  2805                                  	; 01/12/2024
  2806                                  	; edi = audio buffer address
  2807 000013DA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2808                                          ;mov	edx, [loadsize]
  2809                                  
  2810                                  	; esi = buffer address
  2811                                  	;; edx = buffer size
  2812                                  
  2813                                  	; load file into memory
  2814                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000013DF 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000013E5 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000013E7 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000013ED B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000013F2 CD40                <1>  int 40h
  2815 000013F4 7247                    	jc	short lff32m_7 ; error !
  2816                                  
  2817                                  	; 01/12/2024
  2818 000013F6 A3[D87D0000]            	mov	[count], eax
  2819                                  	;;;
  2820                                  	; 07/12/2024
  2821                                  	;mov	edi, audio_buffer
  2822                                  	;;;
  2823 000013FB 21C0                    	and	eax, eax
  2824 000013FD 7505                    	jnz	short lff32m_8
  2825 000013FF E903F8FFFF              	jmp	lff32_eof
  2826                                  
  2827                                  lff32m_8:
  2828 00001404 89C1                    	mov	ecx, eax	; byte count
  2829                                  lff32m_1:
  2830 00001406 AC                      	lodsb
  2831                                  	;mov	[previous_val], al
  2832 00001407 88C3                    	mov	bl, al
  2833 00001409 2C80                    	sub	al, 80h
  2834 0000140B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2835 0000140F 66AB                    	stosw		; original sample (left channel)
  2836 00001411 66AB                    	stosw		; original sample (right channel)
  2837                                  	;xor	eax, eax
  2838 00001413 B080                    	mov	al, 80h
  2839 00001415 49                      	dec	ecx
  2840 00001416 7402                    	jz	short lff32m_2
  2841 00001418 8A06                    	mov	al, [esi]
  2842                                  lff32m_2:
  2843                                  	;;mov	[next_val], al
  2844                                  	;mov	bh, al
  2845                                  	;add	al, [previous_val]
  2846 0000141A 00D8                    	add	al, bl
  2847 0000141C D0D8                    	rcr	al, 1
  2848 0000141E 2C80                    	sub	al, 80h
  2849 00001420 66C1E008                	shl	ax, 8
  2850 00001424 66AB                    	stosw		; this is interpolated sample (L)
  2851 00001426 66AB                    	stosw		; this is interpolated sample (R)
  2852                                  	
  2853                                  	; different than 8-16-24 kHZ !
  2854                                  	; 'original-interpolated-original' trio samples
  2855 00001428 E30E                    	jecxz	lff32m_3
  2856                                  
  2857 0000142A AC                      	lodsb
  2858 0000142B 2C80                    	sub	al, 80h
  2859 0000142D 66C1E008                	shl	ax, 8
  2860 00001431 66AB                    	stosw		; original sample (left channel)
  2861 00001433 66AB                    	stosw		; original sample (right channel)
  2862                                  
  2863                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2864 00001435 49                      	dec	ecx
  2865 00001436 75CE                    	jnz	short lff32m_1
  2866                                  lff32m_3:
  2867 00001438 E9B2F7FFFF              	jmp	lff32_3
  2868                                  
  2869                                  lff32m_7:
  2870                                  lff32s_7:
  2871 0000143D E9CEF7FFFF              	jmp	lff32_5  ; error
  2872                                  
  2873                                  load_32khz_stereo_8_bit:
  2874                                  	; 15/11/2023
  2875 00001442 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2876                                  					; last of the file?
  2877 00001449 7402                    	jz	short lff32s_0		; no
  2878 0000144B F9                      	stc
  2879 0000144C C3                      	retn
  2880                                  
  2881                                  lff32s_0:
  2882                                  	; 01/12/2024
  2883                                  	; edi = audio buffer address
  2884 0000144D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2885                                          ;mov	edx, [loadsize]
  2886                                  
  2887                                  	; esi = buffer address
  2888                                  	;; edx = buffer size
  2889                                  
  2890                                  	; load file into memory
  2891                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001452 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001458 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000145A 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001460 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001465 CD40                <1>  int 40h
  2892 00001467 72D4                    	jc	short lff32s_7 ; error !
  2893                                  
  2894                                  	; 01/12/2024
  2895 00001469 A3[D87D0000]            	mov	[count], eax
  2896                                  	;;;
  2897                                  	; 07/12/2024
  2898                                  	;mov	edi, audio_buffer
  2899                                  	;;;
  2900 0000146E D1E8                    	shr	eax, 1
  2901 00001470 7505                    	jnz	short lff32s_8
  2902 00001472 E990F7FFFF              	jmp	lff32_eof
  2903                                  
  2904                                  lff32s_8:
  2905 00001477 89C1                    	mov	ecx, eax  ; word count
  2906                                  lff32s_1:
  2907 00001479 AC                      	lodsb
  2908 0000147A A2[5C210000]            	mov	[previous_val_l], al
  2909 0000147F 2C80                    	sub	al, 80h
  2910 00001481 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2911 00001485 66AB                    	stosw		; original sample (L)
  2912 00001487 AC                      	lodsb
  2913 00001488 A2[5E210000]            	mov	[previous_val_r], al
  2914 0000148D 2C80                    	sub	al, 80h
  2915 0000148F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2916 00001493 66AB                    	stosw		; original sample (R)
  2917                                  
  2918                                  	;xor	eax, eax
  2919 00001495 66B88080                	mov	ax, 8080h
  2920 00001499 49                      	dec	ecx
  2921 0000149A 7403                    	jz	short lff32s_2
  2922                                  		; convert 8 bit sample to 16 bit sample
  2923 0000149C 668B06                  	mov	ax, [esi]
  2924                                  lff32s_2:
  2925                                  	;;mov	[next_val_l], al
  2926                                  	;;mov	[next_val_r], ah
  2927                                  	;mov	bx, ax
  2928 0000149F 88E7                    	mov	bh, ah
  2929 000014A1 0205[5C210000]          	add	al, [previous_val_l]
  2930 000014A7 D0D8                    	rcr	al, 1
  2931                                  	;mov	dl, al
  2932 000014A9 2C80                    	sub	al, 80h
  2933 000014AB 66C1E008                	shl	ax, 8
  2934 000014AF 66AB                    	stosw		; this is interpolated sample (L)
  2935 000014B1 88F8                    	mov	al, bh	; [next_val_r]
  2936 000014B3 0205[5E210000]          	add	al, [previous_val_r]
  2937 000014B9 D0D8                    	rcr	al, 1
  2938                                  	;mov	dh, al
  2939 000014BB 2C80                    	sub	al, 80h
  2940 000014BD 66C1E008                	shl	ax, 8
  2941 000014C1 66AB                    	stosw		; this is interpolated sample (R)
  2942                                  
  2943                                  	; different than 8-16-24 kHZ !
  2944                                  	; 'original-interpolated-original' trio samples
  2945 000014C3 E315                    	jecxz	lff32s_3
  2946                                  
  2947 000014C5 AC                      	lodsb
  2948 000014C6 2C80                    	sub	al, 80h
  2949 000014C8 66C1E008                	shl	ax, 8
  2950 000014CC 66AB                    	stosw		; original sample (left channel)
  2951                                  
  2952 000014CE AC                      	lodsb
  2953 000014CF 2C80                    	sub	al, 80h
  2954 000014D1 66C1E008                	shl	ax, 8
  2955 000014D5 66AB                    	stosw		; original sample (right channel)
  2956                                  		
  2957                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2958 000014D7 49                      	dec	ecx
  2959 000014D8 759F                    	jnz	short lff32s_1
  2960                                  lff32s_3:
  2961 000014DA E910F7FFFF              	jmp	lff32_3
  2962                                  
  2963                                  load_32khz_mono_16_bit:
  2964                                  	; 15/11/2023
  2965 000014DF F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2966                                  					; last of the file?
  2967 000014E6 7402                    	jz	short lff32m2_0		; no
  2968 000014E8 F9                      	stc
  2969 000014E9 C3                      	retn
  2970                                  
  2971                                  lff32m2_0:
  2972                                  	; 01/12/2024
  2973                                  	; edi = audio buffer address
  2974 000014EA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2975                                          ;mov	edx, [loadsize]
  2976                                  
  2977                                  	; esi = buffer address
  2978                                  	;; edx = buffer size
  2979                                  
  2980                                  	; load file into memory
  2981                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000014EF 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000014F5 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000014F7 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000014FD B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001502 CD40                <1>  int 40h
  2982 00001504 723E                    	jc	short lff32m2_7 ; error !
  2983                                  
  2984                                  	; 01/12/2024
  2985 00001506 A3[D87D0000]            	mov	[count], eax
  2986                                  	;;;
  2987                                  	; 07/12/2024
  2988                                  	;mov	edi, audio_buffer
  2989                                  	;;;
  2990 0000150B D1E8                    	shr	eax, 1
  2991 0000150D 7505                    	jnz	short lff32m2_8
  2992 0000150F E9F3F6FFFF              	jmp	lff32_eof
  2993                                  
  2994                                  lff32m2_8:
  2995 00001514 89C1                    	mov	ecx, eax  ; word count
  2996                                  lff32m2_1:
  2997 00001516 66AD                    	lodsw
  2998 00001518 66AB                    	stosw		; original sample (left channel)
  2999 0000151A 66AB                    	stosw		; original sample (right channel)
  3000 0000151C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3001                                  	;mov	[previous_val], ax
  3002                                  	;mov	ebx, eax
  3003                                  	;xor	eax, eax
  3004 0000151F 31DB                    	xor	ebx, ebx
  3005 00001521 49                      	dec	ecx
  3006 00001522 7403                    	jz	short lff32m2_2
  3007                                  	;mov	ax, [esi]
  3008 00001524 668B1E                  	mov	bx, [esi]
  3009                                  lff32m2_2:
  3010                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  3011                                  	;mov	ebp, eax ; [next_val]
  3012                                  	;add	ax, [previous_val]
  3013                                  	; ax = [previous_val]
  3014                                  	; bx = [next_val]
  3015 00001527 6601D8                  	add	ax, bx
  3016 0000152A 66D1D8                  	rcr	ax, 1
  3017 0000152D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3018 00001530 66AB                    	stosw		; this is interpolated sample (L)
  3019 00001532 66AB                    	stosw		; this is interpolated sample (R)
  3020                                  
  3021                                  	; different than 8-16-24 kHZ !
  3022                                  	; 'original-interpolated-original' trio samples 
  3023 00001534 E309                    	jecxz	lff32m2_3
  3024                                  
  3025 00001536 66AD                    	lodsw
  3026 00001538 66AB                    	stosw		; original sample (left channel)
  3027 0000153A 66AB                    	stosw		; original sample (right channel)
  3028                                  
  3029                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3030 0000153C 49                      	dec	ecx
  3031 0000153D 75D7                    	jnz	short lff32m2_1
  3032                                  lff32m2_3:
  3033 0000153F E9ABF6FFFF              	jmp	lff32_3
  3034                                  
  3035                                  lff32m2_7:
  3036                                  lff32s2_7:
  3037 00001544 E9C7F6FFFF              	jmp	lff32_5  ; error
  3038                                  
  3039                                  load_32khz_stereo_16_bit:
  3040                                  	; 16/11/2023
  3041                                  	; 15/11/2023
  3042 00001549 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3043                                  					; last of the file?
  3044 00001550 7402                    	jz	short lff32s2_0		; no
  3045 00001552 F9                      	stc
  3046 00001553 C3                      	retn
  3047                                  
  3048                                  lff32s2_0:
  3049                                  	; 01/12/2024
  3050                                  	; edi = audio buffer address
  3051 00001554 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3052                                          ;mov	edx, [loadsize]
  3053                                  
  3054                                  	; esi = buffer address
  3055                                  	;; edx = buffer size
  3056                                  
  3057                                  	; load file into memory
  3058                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001559 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000155F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001561 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001567 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000156C CD40                <1>  int 40h
  3059 0000156E 72D4                    	jc	short lff32s2_7 ; error !
  3060                                  
  3061                                  	; 01/12/2024
  3062 00001570 A3[D87D0000]            	mov	[count], eax
  3063                                  	;;;
  3064                                  	; 07/12/2024
  3065                                  	;mov	edi, audio_buffer
  3066                                  	;;;
  3067 00001575 C1E802                  	shr	eax, 2
  3068 00001578 7505                    	jnz	short lff32s2_8
  3069 0000157A E988F6FFFF              	jmp	lff32_eof
  3070                                  
  3071                                  lff32s2_8:
  3072 0000157F 89C1                    	mov	ecx, eax ; dword count
  3073                                  lff32s2_1:
  3074 00001581 66AD                    	lodsw
  3075 00001583 66AB                    	stosw		; original sample (L)
  3076 00001585 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3077 00001588 66A3[5C210000]          	mov	[previous_val_l], ax
  3078 0000158E 66AD                    	lodsw
  3079 00001590 66AB                    	stosw		; original sample (R)
  3080 00001592 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3081                                  	;mov	[previous_val_r], ax
  3082 00001595 89C3                    	mov	ebx, eax
  3083 00001597 31D2                    	xor	edx, edx
  3084 00001599 31C0                    	xor	eax, eax
  3085                                  	; 16/11/2023
  3086 0000159B 49                      	dec	ecx
  3087 0000159C 7407                    	jz	short lff32s2_2
  3088 0000159E 668B06                  	mov	ax, [esi]
  3089 000015A1 668B5602                	mov	dx, [esi+2]
  3090                                  lff32s2_2:
  3091 000015A5 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3092                                  	;;mov	[next_val_l], ax
  3093                                  	;mov	ebp, eax
  3094 000015A8 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3095                                  	;mov	[next_val_r], dx
  3096 000015AB 660305[5C210000]        	add	ax, [previous_val_l]
  3097 000015B2 66D1D8                  	rcr	ax, 1
  3098 000015B5 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3099 000015B8 66AB                    	stosw		; this is interpolated sample (L)
  3100                                  	;mov	ax, [next_val_r]
  3101 000015BA 89D0                    	mov	eax, edx
  3102                                  	;add	ax, [previous_val_r]
  3103 000015BC 6601D8                  	add	ax, bx
  3104 000015BF 66D1D8                  	rcr	ax, 1
  3105 000015C2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3106 000015C5 66AB                    	stosw		; this is interpolated sample (R)
  3107                                  
  3108                                  	; different than 8-16-24 kHZ !
  3109                                  	; 'original-interpolated-original' trio samples
  3110 000015C7 E30B                    	jecxz	lff32s2_3
  3111                                  
  3112 000015C9 66AD                    	lodsw
  3113 000015CB 66AB                    	stosw	; original sample (L)
  3114 000015CD 66AD                    	lodsw
  3115 000015CF 66AB                    	stosw	; original sample (R)
  3116                                  	
  3117                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3118 000015D1 49                      	dec	ecx
  3119 000015D2 75AD                    	jnz	short lff32s2_1
  3120                                  lff32s2_3:
  3121 000015D4 E916F6FFFF              	jmp	lff32_3
  3122                                  
  3123                                  ; .....................
  3124                                  
  3125                                  load_22khz_mono_8_bit:
  3126                                  	; 16/11/2023
  3127 000015D9 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3128                                  					; last of the file?
  3129 000015E0 7402                    	jz	short lff22m_0		; no
  3130 000015E2 F9                      	stc
  3131 000015E3 C3                      	retn
  3132                                  
  3133                                  lff22m_0:
  3134                                  	; 01/12/2024
  3135                                  	; edi = audio buffer address
  3136 000015E4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3137                                          ;mov	edx, [loadsize]
  3138                                  
  3139                                  	; esi = buffer address
  3140                                  	;; edx = buffer size
  3141                                  
  3142                                  	; load file into memory
  3143                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000015E9 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000015EF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000015F1 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000015F7 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000015FC CD40                <1>  int 40h
  3144 000015FE 725D                    	jc	short lff22m_7 ; error !
  3145                                  
  3146                                  	; 01/12/2024
  3147 00001600 A3[D87D0000]            	mov	[count], eax
  3148                                  	;;;
  3149                                  	; 07/12/2024
  3150                                  	;mov	edi, audio_buffer
  3151                                  	;;;
  3152 00001605 21C0                    	and	eax, eax
  3153 00001607 7505                    	jnz	short lff22m_8
  3154 00001609 E9F9F5FFFF              	jmp	lff22_eof
  3155                                  
  3156                                  lff22m_8:
  3157 0000160E 89C1                    	mov	ecx, eax	; byte count
  3158                                  lff22m_9:
  3159 00001610 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3160 00001615 C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3161                                  lff22m_1:
  3162                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3163 0000161C AC                      	lodsb
  3164 0000161D B280                    	mov	dl, 80h
  3165 0000161F 49                      	dec	ecx
  3166 00001620 7402                    	jz	short lff22m_2_1
  3167 00001622 8A16                    	mov	dl, [esi]
  3168                                  lff22m_2_1:	
  3169                                  	; al = [previous_val]
  3170                                  	; dl = [next_val]
  3171 00001624 E8EF050000              	call	interpolating_3_8bit_mono ; 1 of 17
  3172 00001629 E32D                    	jecxz	lff22m_3
  3173                                  lff22m_2_2:
  3174 0000162B AC                      	lodsb
  3175 0000162C B280                    	mov	dl, 80h
  3176 0000162E 49                      	dec	ecx
  3177 0000162F 7402                    	jz	short lff22m_2_3
  3178 00001631 8A16                    	mov	dl, [esi]
  3179                                  lff22m_2_3:
  3180 00001633 E864060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3181 00001638 E31E                    	jecxz	lff22m_3
  3182 0000163A 4D                      	dec	ebp
  3183 0000163B 75EE                    	jnz	short lff22m_2_2
  3184                                  
  3185 0000163D A0[64210000]            	mov	al, [faz]
  3186 00001642 FEC8                    	dec	al
  3187 00001644 74CA                    	jz	short lff22m_9
  3188 00001646 FE0D[64210000]          	dec	byte [faz]
  3189 0000164C BD04000000              	mov	ebp, 4
  3190 00001651 FEC8                    	dec	al
  3191 00001653 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3192 00001655 45                      	inc	ebp ; 5
  3193 00001656 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3194                                  
  3195                                  lff22m_3:
  3196                                  lff22s_3:
  3197 00001658 E992F5FFFF              	jmp	lff22_3	; padfill
  3198                                  		; (put zeros in the remain words of the buffer)
  3199                                  lff22m_7:
  3200                                  lff22s_7:
  3201 0000165D E9AEF5FFFF              	jmp	lff22_5  ; error
  3202                                  
  3203                                  load_22khz_stereo_8_bit:
  3204                                  	; 16/11/2023
  3205 00001662 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3206                                  					; last of the file?
  3207 00001669 7402                    	jz	short lff22s_0		; no
  3208 0000166B F9                      	stc
  3209 0000166C C3                      	retn
  3210                                  
  3211                                  lff22s_0:
  3212                                  	; 01/12/2024
  3213                                  	; edi = audio buffer address
  3214 0000166D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3215                                          ;mov	edx, [loadsize]
  3216                                  
  3217                                  	; esi = buffer address
  3218                                  	;; edx = buffer size
  3219                                  
  3220                                  	; load file into memory
  3221                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001672 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001678 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000167A 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001680 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001685 CD40                <1>  int 40h
  3222 00001687 72D4                    	jc	short lff22s_7 ; error !
  3223                                  
  3224                                  	; 01/12/2024
  3225 00001689 A3[D87D0000]            	mov	[count], eax
  3226                                  	;;;
  3227                                  	; 07/12/2024
  3228                                  	;mov	edi, audio_buffer
  3229                                  	;;;
  3230 0000168E D1E8                    	shr	eax, 1
  3231 00001690 7505                    	jnz	short lff22s_8
  3232 00001692 E970F5FFFF              	jmp	lff22_eof
  3233                                  
  3234                                  lff22s_8:
  3235 00001697 89C1                    	mov	ecx, eax	; word count
  3236                                  lff22s_9:
  3237 00001699 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3238 0000169E C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3239                                  lff22s_1:
  3240                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3241 000016A5 66AD                    	lodsw
  3242 000016A7 66BA8080                	mov	dx, 8080h
  3243 000016AB 49                      	dec	ecx
  3244 000016AC 7403                    	jz	short lff22s_2_1
  3245 000016AE 668B16                  	mov	dx, [esi]
  3246                                  lff22s_2_1:	
  3247                                  	; al = [previous_val_l]
  3248                                  	; ah = [previous_val_r]
  3249                                  	; dl = [next_val_l]
  3250                                  	; dh = [next_val_r]
  3251 000016B1 E893050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3252 000016B6 E3A0                    	jecxz	lff22s_3
  3253                                  lff22s_2_2:
  3254 000016B8 66AD                    	lodsw
  3255 000016BA 66BA8080                	mov	dx, 8080h
  3256 000016BE 49                      	dec	ecx
  3257 000016BF 7403                    	jz	short lff22s_2_3
  3258 000016C1 668B16                  	mov	dx, [esi]
  3259                                  lff22s_2_3:
  3260 000016C4 E8F0050000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3261 000016C9 E38D                    	jecxz	lff22s_3
  3262 000016CB 4D                      	dec	ebp
  3263 000016CC 75EA                    	jnz	short lff22s_2_2
  3264                                  
  3265 000016CE A0[64210000]            	mov	al, [faz]
  3266 000016D3 FEC8                    	dec	al
  3267 000016D5 74C2                    	jz	short lff22s_9
  3268 000016D7 FE0D[64210000]          	dec	byte [faz]
  3269 000016DD BD04000000              	mov	ebp, 4
  3270 000016E2 FEC8                    	dec	al
  3271 000016E4 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3272 000016E6 45                      	inc	ebp ; 5
  3273 000016E7 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3274                                  
  3275                                  load_22khz_mono_16_bit:
  3276                                  	; 16/11/2023
  3277 000016E9 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3278                                  					; last of the file?
  3279 000016F0 7402                    	jz	short lff22m2_0		; no
  3280 000016F2 F9                      	stc
  3281 000016F3 C3                      	retn
  3282                                  
  3283                                  lff22m2_0:
  3284                                  	; 01/12/2024
  3285                                  	; edi = audio buffer address
  3286 000016F4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3287                                          ;mov	edx, [loadsize]
  3288                                  
  3289                                  	; esi = buffer address
  3290                                  	;; edx = buffer size
  3291                                  
  3292                                  	; load file into memory
  3293                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000016F9 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000016FF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001701 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001707 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000170C CD40                <1>  int 40h
  3294 0000170E 7261                    	jc	short lff22m2_7 ; error !
  3295                                  
  3296                                  	; 01/12/2024
  3297 00001710 A3[D87D0000]            	mov	[count], eax
  3298                                  	;;;
  3299                                  	; 07/12/2024
  3300                                  	;mov	edi, audio_buffer
  3301                                  	;;;
  3302 00001715 D1E8                    	shr	eax, 1
  3303 00001717 7505                    	jnz	short lff22m2_8
  3304 00001719 E9E9F4FFFF              	jmp	lff22_eof
  3305                                  
  3306                                  lff22m2_8:
  3307 0000171E 89C1                    	mov	ecx, eax	; word count
  3308                                  lff22m2_9:
  3309 00001720 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3310 00001725 C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3311                                  lff22m2_1:
  3312                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3313 0000172C 66AD                    	lodsw
  3314 0000172E 31D2                    	xor	edx, edx
  3315 00001730 49                      	dec	ecx
  3316 00001731 7403                    	jz	short lff22m2_2_1
  3317 00001733 668B16                  	mov	dx, [esi]
  3318                                  lff22m2_2_1:	
  3319                                  	; ax = [previous_val]
  3320                                  	; dx = [next_val]
  3321 00001736 E8AF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3322 0000173B E32F                    	jecxz	lff22m2_3
  3323                                  lff22m2_2_2:
  3324 0000173D 66AD                    	lodsw
  3325 0000173F 31D2                    	xor	edx, edx
  3326 00001741 49                      	dec	ecx
  3327 00001742 7403                    	jz	short lff22m2_2_3
  3328 00001744 668B16                  	mov	dx, [esi]
  3329                                  lff22m2_2_3:
  3330 00001747 E831060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3331 0000174C E31E                    	jecxz	lff22m2_3
  3332 0000174E 4D                      	dec	ebp
  3333 0000174F 75EC                    	jnz	short lff22m2_2_2
  3334                                  
  3335 00001751 A0[64210000]            	mov	al, [faz]
  3336 00001756 FEC8                    	dec	al
  3337 00001758 74C6                    	jz	short lff22m2_9
  3338 0000175A FE0D[64210000]          	dec	byte [faz]
  3339 00001760 BD04000000              	mov	ebp, 4
  3340 00001765 FEC8                    	dec	al
  3341 00001767 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3342 00001769 45                      	inc	ebp ; 5
  3343 0000176A EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3344                                  
  3345                                  lff22m2_3:
  3346                                  lff22s2_3:
  3347 0000176C E97EF4FFFF              	jmp	lff22_3	; padfill
  3348                                  		; (put zeros in the remain words of the buffer)
  3349                                  lff22m2_7:
  3350                                  lff22s2_7:
  3351 00001771 E99AF4FFFF              	jmp	lff22_5  ; error
  3352                                  
  3353                                  load_22khz_stereo_16_bit:
  3354                                  	; 16/11/2023
  3355 00001776 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3356                                  					; last of the file?
  3357 0000177D 7402                    	jz	short lff22s2_0		; no
  3358 0000177F F9                      	stc
  3359 00001780 C3                      	retn
  3360                                  
  3361                                  lff22s2_0:
  3362                                  	; 01/12/2024
  3363                                  	; edi = audio buffer address
  3364 00001781 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3365                                          ;mov	edx, [loadsize]
  3366                                  
  3367                                  	; esi = buffer address
  3368                                  	;; edx = buffer size
  3369                                  
  3370                                  	; load file into memory
  3371                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001786 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000178C 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000178E 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001794 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001799 CD40                <1>  int 40h
  3372 0000179B 72D4                    	jc	short lff22s2_7 ; error !
  3373                                  
  3374                                  	; 01/12/2024
  3375 0000179D A3[D87D0000]            	mov	[count], eax
  3376                                  	;;;
  3377                                  	; 07/12/2024
  3378                                  	;mov	edi, audio_buffer
  3379                                  	;;;
  3380 000017A2 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3381 000017A5 7505                    	jnz	short lff22s2_8
  3382 000017A7 E95BF4FFFF              	jmp	lff22_eof
  3383                                  
  3384                                  lff22s2_8:
  3385 000017AC 89C1                    	mov	ecx, eax	; dword count
  3386                                  lff22s2_9:
  3387 000017AE BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3388 000017B3 C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3389                                  lff22s2_1:
  3390                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3391 000017BA 66AD                    	lodsw
  3392 000017BC 89C3                    	mov	ebx, eax
  3393 000017BE 66AD                    	lodsw
  3394 000017C0 8B16                    	mov	edx, [esi]
  3395 000017C2 668915[60210000]        	mov	[next_val_l], dx
  3396                                  	; 26/11/2023
  3397 000017C9 C1EA10                  	shr	edx, 16
  3398 000017CC 49                      	dec	ecx
  3399 000017CD 7509                    	jnz	short lff22s2_2_1
  3400 000017CF 31D2                    	xor	edx, edx ; 0
  3401 000017D1 668915[60210000]        	mov	[next_val_l], dx
  3402                                  lff22s2_2_1:
  3403                                  	; bx = [previous_val_l]
  3404                                  	; ax = [previous_val_r]
  3405                                  	; [next_val_l]
  3406                                  	; dx = [next_val_r]
  3407 000017D8 E83D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3408 000017DD E38D                    	jecxz	lff22s2_3
  3409                                  lff22s2_2_2:
  3410 000017DF 66AD                    	lodsw
  3411 000017E1 89C3                    	mov	ebx, eax
  3412 000017E3 66AD                    	lodsw
  3413 000017E5 8B16                    	mov	edx, [esi]
  3414 000017E7 668915[60210000]        	mov	[next_val_l], dx
  3415                                  	; 26/11/2023
  3416 000017EE C1EA10                  	shr	edx, 16
  3417 000017F1 49                      	dec	ecx
  3418 000017F2 7509                    	jnz	short lff22s2_2_3
  3419 000017F4 31D2                    	xor	edx, edx ; 0
  3420 000017F6 668915[60210000]        	mov	[next_val_l], dx
  3421                                  lff22s2_2_3:
  3422 000017FD E893050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3423 00001802 E31E                    	jecxz	lff22s2_2_4
  3424                                  
  3425 00001804 4D                      	dec	ebp
  3426 00001805 75D8                    	jnz	short lff22s2_2_2
  3427                                  
  3428 00001807 A0[64210000]            	mov	al, [faz]
  3429 0000180C FEC8                    	dec	al
  3430 0000180E 749E                    	jz	short lff22s2_9
  3431 00001810 FE0D[64210000]          	dec	byte [faz]
  3432 00001816 BD04000000              	mov	ebp, 4
  3433 0000181B FEC8                    	dec	al
  3434 0000181D 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3435 0000181F 45                      	inc	ebp ; 5
  3436 00001820 EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3437                                  
  3438                                  lff22s2_2_4:
  3439                                  	; 26/11/2023
  3440 00001822 E9C8F3FFFF              	jmp	lff22_3	; padfill
  3441                                  
  3442                                  ; .....................
  3443                                  
  3444                                  load_11khz_mono_8_bit:
  3445                                  	; 18/11/2023
  3446 00001827 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3447                                  					; last of the file?
  3448 0000182E 7402                    	jz	short lff11m_0		; no
  3449 00001830 F9                      	stc
  3450 00001831 C3                      	retn
  3451                                  
  3452                                  lff11m_0:
  3453                                  	; 01/12/2024
  3454                                  	; edi = audio buffer address
  3455 00001832 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3456                                          ;mov	edx, [loadsize]
  3457                                  
  3458                                  	; esi = buffer address
  3459                                  	;; edx = buffer size
  3460                                  
  3461                                  	; load file into memory
  3462                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001837 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000183D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000183F 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001845 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000184A CD40                <1>  int 40h
  3463 0000184C 7247                    	jc	short lff11m_7 ; error !
  3464                                  
  3465                                  	; 01/12/2024
  3466 0000184E A3[D87D0000]            	mov	[count], eax
  3467                                  	;;;
  3468                                  	; 07/12/2024
  3469                                  	;mov	edi, audio_buffer
  3470                                  	;;;
  3471 00001853 21C0                    	and	eax, eax
  3472 00001855 7505                    	jnz	short lff11m_8
  3473 00001857 E9ABF3FFFF              	jmp	lff11_eof
  3474                                  
  3475                                  lff11m_8:
  3476 0000185C 89C1                    	mov	ecx, eax		; byte count
  3477                                  lff11m_9:
  3478 0000185E BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3479                                  lff11m_1:
  3480                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3481 00001863 AC                      	lodsb
  3482 00001864 B280                    	mov	dl, 80h
  3483 00001866 49                      	dec	ecx
  3484 00001867 7402                    	jz	short lff11m_2_1
  3485 00001869 8A16                    	mov	dl, [esi]
  3486                                  lff11m_2_1:	
  3487                                  	; al = [previous_val]
  3488                                  	; dl = [next_val]
  3489 0000186B E854050000              	call	interpolating_5_8bit_mono
  3490 00001870 E328                    	jecxz	lff11m_3
  3491                                  lff11m_2_2:
  3492 00001872 AC                      	lodsb
  3493 00001873 B280                    	mov	dl, 80h
  3494 00001875 49                      	dec	ecx
  3495 00001876 7402                    	jz	short lff11m_2_3
  3496 00001878 8A16                    	mov	dl, [esi]
  3497                                  lff11m_2_3:
  3498 0000187A E851060000               	call	interpolating_4_8bit_mono
  3499 0000187F E319                    	jecxz	lff11m_3
  3500                                  
  3501 00001881 4D                      	dec	ebp
  3502 00001882 74DA                    	jz	short lff11m_9
  3503                                  
  3504 00001884 AC                      	lodsb
  3505 00001885 B280                    	mov	dl, 80h
  3506 00001887 49                      	dec	ecx
  3507 00001888 7402                    	jz	short lff11m_2_4
  3508 0000188A 8A16                    	mov	dl, [esi]
  3509                                  lff11m_2_4:
  3510 0000188C E83F060000              	call	interpolating_4_8bit_mono
  3511 00001891 E307                    	jecxz	lff11m_3
  3512 00001893 EBCE                    	jmp	short lff11m_1
  3513                                  
  3514                                  lff11m_7:
  3515                                  lff11s_7:
  3516 00001895 E976F3FFFF              	jmp	lff11_5  ; error
  3517                                  
  3518                                  lff11m_3:
  3519                                  lff11s_3:
  3520 0000189A E950F3FFFF              	jmp	lff11_3	; padfill
  3521                                  		; (put zeros in the remain words of the buffer)
  3522                                  
  3523                                  load_11khz_stereo_8_bit:
  3524                                  	; 18/11/2023
  3525 0000189F F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3526                                  					; last of the file?
  3527 000018A6 7402                    	jz	short lff11s_0		; no
  3528 000018A8 F9                      	stc
  3529 000018A9 C3                      	retn
  3530                                  
  3531                                  lff11s_0:
  3532                                  	; 01/12/2024
  3533                                  	; edi = audio buffer address
  3534 000018AA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3535                                          ;mov	edx, [loadsize]
  3536                                  
  3537                                  	; esi = buffer address
  3538                                  	;; edx = buffer size
  3539                                  
  3540                                  	; load file into memory
  3541                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000018AF 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000018B5 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000018B7 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000018BD B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000018C2 CD40                <1>  int 40h
  3542 000018C4 72CF                    	jc	short lff11s_7 ; error !
  3543                                  
  3544                                  	; 01/12/2024
  3545 000018C6 A3[D87D0000]            	mov	[count], eax
  3546                                  	;;;
  3547                                  	; 07/12/2024
  3548                                  	;mov	edi, audio_buffer
  3549                                  	;;;
  3550 000018CB D1E8                    	shr	eax, 1
  3551 000018CD 7505                    	jnz	short lff11s_8
  3552 000018CF E933F3FFFF              	jmp	lff11_eof
  3553                                  
  3554                                  lff11s_8:
  3555 000018D4 89C1                    	mov	ecx, eax	; word count
  3556                                  lff11s_9:
  3557 000018D6 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3558                                  lff11s_1:
  3559                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3560 000018DB 66AD                    	lodsw
  3561 000018DD 66BA8080                	mov	dx, 8080h
  3562 000018E1 49                      	dec	ecx
  3563 000018E2 7403                    	jz	short lff11s_2_1
  3564 000018E4 668B16                  	mov	dx, [esi]
  3565                                  lff11s_2_1:	
  3566                                  	; al = [previous_val_l]
  3567                                  	; ah = [previous_val_r]
  3568                                  	; dl = [next_val_l]
  3569                                  	; dh = [next_val_r]
  3570 000018E7 E837050000              	call	interpolating_5_8bit_stereo
  3571 000018EC E3AC                    	jecxz	lff11s_3
  3572                                  lff11s_2_2:
  3573 000018EE 66AD                    	lodsw
  3574 000018F0 66BA8080                	mov	dx, 8080h
  3575 000018F4 49                      	dec	ecx
  3576 000018F5 7403                    	jz	short lff11s_2_3
  3577 000018F7 668B16                  	mov	dx, [esi]
  3578                                  lff11s_2_3:
  3579 000018FA E810060000               	call	interpolating_4_8bit_stereo
  3580 000018FF E399                    	jecxz	lff11s_3
  3581                                  	
  3582 00001901 4D                      	dec	ebp
  3583 00001902 74D2                    	jz	short lff11s_9
  3584                                  
  3585 00001904 66AD                    	lodsw
  3586 00001906 66BA8080                	mov	dx, 8080h
  3587 0000190A 49                      	dec	ecx
  3588 0000190B 7403                    	jz	short lff11s_2_4
  3589 0000190D 668B16                  	mov	dx, [esi]
  3590                                  lff11s_2_4:
  3591 00001910 E8FA050000              	call	interpolating_4_8bit_stereo
  3592 00001915 E383                    	jecxz	lff11s_3
  3593 00001917 EBC2                    	jmp	short lff11s_1
  3594                                  
  3595                                  load_11khz_mono_16_bit:
  3596                                  	; 18/11/2023
  3597 00001919 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3598                                  					; last of the file?
  3599 00001920 7402                    	jz	short lff11m2_0		; no
  3600 00001922 F9                      	stc
  3601 00001923 C3                      	retn
  3602                                  
  3603                                  lff11m2_0:
  3604                                  	; 01/12/2024
  3605                                  	; edi = audio buffer address
  3606 00001924 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3607                                          ;mov	edx, [loadsize]
  3608                                  
  3609                                  	; esi = buffer address
  3610                                  	;; edx = buffer size
  3611                                  
  3612                                  	; load file into memory
  3613                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001929 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000192F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001931 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001937 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000193C CD40                <1>  int 40h
  3614 0000193E 724D                    	jc	short lff11m2_7 ; error !
  3615                                  
  3616                                  	; 01/12/2024
  3617 00001940 A3[D87D0000]            	mov	[count], eax
  3618                                  	;;;
  3619                                  	; 07/12/2024
  3620                                  	;mov	edi, audio_buffer
  3621                                  	;;;
  3622 00001945 D1E8                    	shr	eax, 1
  3623 00001947 7505                    	jnz	short lff11m2_8
  3624 00001949 E9B9F2FFFF              	jmp	lff11_eof
  3625                                  
  3626                                  lff11m2_8:
  3627 0000194E 89C1                    	mov	ecx, eax	; word count
  3628                                  lff11m2_9:
  3629 00001950 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3630                                  lff11m2_1:
  3631                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3632 00001955 66AD                    	lodsw
  3633 00001957 31D2                    	xor	edx, edx
  3634 00001959 49                      	dec	ecx
  3635 0000195A 7403                    	jz	short lff11m2_2_1
  3636 0000195C 668B16                  	mov	dx, [esi]
  3637                                  lff11m2_2_1:	
  3638                                  	; ax = [previous_val]
  3639                                  	; dx = [next_val]
  3640 0000195F E818060000              	call	interpolating_5_16bit_mono
  3641 00001964 E362                    	jecxz	lff11m2_3
  3642                                  lff11m2_2_2:
  3643 00001966 66AD                    	lodsw
  3644 00001968 31D2                    	xor	edx, edx
  3645 0000196A 49                      	dec	ecx
  3646 0000196B 7403                    	jz	short lff11m2_2_3
  3647 0000196D 668B16                  	mov	dx, [esi]
  3648                                  lff11m2_2_3:
  3649 00001970 E831070000               	call	interpolating_4_16bit_mono
  3650 00001975 E351                    	jecxz	lff11m2_3
  3651                                  
  3652 00001977 4D                      	dec	ebp
  3653 00001978 74D6                    	jz	short lff11m2_9
  3654                                  
  3655 0000197A 66AD                    	lodsw
  3656 0000197C 31D2                    	xor	edx, edx
  3657 0000197E 49                      	dec	ecx
  3658 0000197F 7403                    	jz	short lff11m2_2_4
  3659 00001981 668B16                  	mov	dx, [esi]
  3660                                  lff11m2_2_4:
  3661 00001984 E81D070000               	call	interpolating_4_16bit_mono
  3662 00001989 E33D                    	jecxz	lff11m2_3
  3663 0000198B EBC8                    	jmp	short lff11m2_1
  3664                                  
  3665                                  lff11m2_7:
  3666                                  lff11s2_7:
  3667 0000198D E97EF2FFFF              	jmp	lff11_5  ; error
  3668                                  
  3669                                  load_11khz_stereo_16_bit:
  3670                                  	; 18/01/2025
  3671                                  	; 18/11/2023
  3672 00001992 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3673                                  					; last of the file?
  3674 00001999 7402                    	jz	short lff11s2_0		; no
  3675 0000199B F9                      	stc
  3676 0000199C C3                      	retn
  3677                                  
  3678                                  lff11s2_0:
  3679                                  	; 01/12/2024
  3680                                  	; edi = audio buffer address
  3681 0000199D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3682                                          ;mov	edx, [loadsize]
  3683                                  
  3684                                  	; esi = buffer address
  3685                                  	;; edx = buffer size
  3686                                  
  3687                                  	; load file into memory
  3688                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000019A2 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000019A8 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000019AA 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000019B0 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000019B5 CD40                <1>  int 40h
  3689 000019B7 72D4                    	jc	short lff11s2_7 ; error !
  3690                                  
  3691                                  	; 01/12/2024
  3692 000019B9 A3[D87D0000]            	mov	[count], eax
  3693                                  	;;;
  3694                                  	; 07/12/2024
  3695                                  	;mov	edi, audio_buffer
  3696                                  	;;;
  3697 000019BE C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3698 000019C1 750A                    	jnz	short lff11s2_8
  3699 000019C3 E93FF2FFFF              	jmp	lff11_eof
  3700                                  
  3701                                  lff11m2_3:
  3702                                  lff11s2_3:
  3703 000019C8 E922F2FFFF              	jmp	lff11_3	; padfill
  3704                                  		; (put zeros in the remain words of the buffer)
  3705                                  
  3706                                  lff11s2_8:
  3707 000019CD 89C1                    	mov	ecx, eax	; dword count
  3708                                  lff11s2_9:
  3709 000019CF BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3710                                  lff11s2_1:
  3711                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3712 000019D4 66AD                    	lodsw
  3713 000019D6 89C3                    	mov	ebx, eax
  3714 000019D8 66AD                    	lodsw
  3715 000019DA 8B16                    	mov	edx, [esi]
  3716                                  	; 18/01/2025
  3717                                  	;mov	[next_val_l], edx
  3718                                  	; 26/11/2023
  3719                                  	;shr	edx, 16
  3720                                  	;mov	[next_val_r], dx
  3721 000019DC 49                      	dec	ecx
  3722 000019DD 7502                    	jnz	short lff11s2_2_1
  3723 000019DF 31D2                    	xor	edx, edx ; 0
  3724                                  	;mov	[next_val_l], dx
  3725                                  	;mov	[next_val_r], dx
  3726                                  lff11s2_2_1:
  3727                                  	; bx = [previous_val_l]
  3728                                  	; ax = [previous_val_r]
  3729                                  	; [next_val_l]
  3730                                  	; dx = [next_val_r]
  3731                                  	;;;
  3732                                  	; 18/01/2025 (BugFix)
  3733 000019E1 8915[60210000]          	mov	[next_val_l], edx
  3734                                  	;;;
  3735 000019E7 E8EB050000              	call	interpolating_5_16bit_stereo
  3736 000019EC E3DA                    	jecxz	lff11s2_3
  3737                                  lff11s2_2_2:
  3738 000019EE 66AD                    	lodsw
  3739 000019F0 89C3                    	mov	ebx, eax
  3740 000019F2 66AD                    	lodsw
  3741 000019F4 8B16                    	mov	edx, [esi]
  3742                                  	; 18/01/2025
  3743                                  	;mov	[next_val_l], dx
  3744                                  	; 26/11/2023
  3745                                  	;shr	edx, 16
  3746                                  	;mov	[next_val_r], dx
  3747 000019F6 49                      	dec	ecx
  3748 000019F7 7502                    	jnz	short lff11s2_2_3
  3749 000019F9 31D2                    	xor	edx, edx ; 0
  3750                                  	;mov	[next_val_l], dx
  3751                                  	;mov	[next_val_r], dx
  3752                                  lff11s2_2_3:
  3753                                  	;;;
  3754                                  	; 18/01/2025 (BugFix)
  3755 000019FB 8915[60210000]          	mov	[next_val_l], edx
  3756                                  	;;;
  3757 00001A01 E8D9060000              	call	interpolating_4_16bit_stereo
  3758 00001A06 E3C0                    	jecxz	lff11s2_3
  3759                                  	
  3760 00001A08 4D                      	dec	ebp
  3761 00001A09 74C4                    	jz	short lff11s2_9
  3762                                  
  3763 00001A0B 66AD                    	lodsw
  3764 00001A0D 89C3                    	mov	ebx, eax
  3765 00001A0F 66AD                    	lodsw
  3766 00001A11 8B16                    	mov	edx, [esi]
  3767                                  	; 18/01/2025
  3768                                  	;mov	[next_val_l], dx
  3769                                  	; 26/11/2023
  3770                                  	;shr	edx, 16
  3771                                  	;mov	[next_val_r], dx
  3772 00001A13 49                      	dec	ecx
  3773 00001A14 7502                    	jnz	short lff11s2_2_4
  3774 00001A16 31D2                    	xor	edx, edx ; 0
  3775                                  	;mov	[next_val_l], dx
  3776                                  	;mov	[next_val_r], dx
  3777                                  lff11s2_2_4:
  3778                                  	;;;
  3779                                  	; 18/01/2025 (BugFix)
  3780 00001A18 8915[60210000]          	mov	[next_val_l], edx
  3781                                  	;;;
  3782 00001A1E E8BC060000               	call	interpolating_4_16bit_stereo
  3783 00001A23 E3A3                    	jecxz	lff11s2_3
  3784 00001A25 EBAD                    	jmp	short lff11s2_1
  3785                                  
  3786                                  ; .....................
  3787                                  
  3788                                  load_44khz_mono_8_bit:
  3789                                  	; 18/11/2023
  3790 00001A27 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3791                                  					; last of the file?
  3792 00001A2E 7402                    	jz	short lff44m_0		; no
  3793 00001A30 F9                      	stc
  3794 00001A31 C3                      	retn
  3795                                  
  3796                                  lff44m_0:
  3797                                  	; 01/12/2024
  3798                                  	; edi = audio buffer address
  3799 00001A32 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3800                                          ;mov	edx, [loadsize]
  3801                                  
  3802                                  	; esi = buffer address
  3803                                  	;; edx = buffer size
  3804                                  
  3805                                  	; load file into memory
  3806                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001A37 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001A3D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001A3F 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001A45 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001A4A CD40                <1>  int 40h
  3807 00001A4C 7250                    	jc	short lff44m_7 ; error !
  3808                                  
  3809                                  	; 01/12/2024
  3810 00001A4E A3[D87D0000]            	mov	[count], eax
  3811                                  	;;;
  3812                                  	; 07/12/2024
  3813                                  	;mov	edi, audio_buffer
  3814                                  	;;;
  3815 00001A53 21C0                    	and	eax, eax
  3816 00001A55 7505                    	jnz	short lff44m_8
  3817 00001A57 E9ABF1FFFF              	jmp	lff44_eof
  3818                                  
  3819                                  lff44m_8:
  3820 00001A5C 89C1                    	mov	ecx, eax	; byte count
  3821                                  lff44m_9:
  3822 00001A5E BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3823 00001A63 C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3824                                  lff44m_1:
  3825                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3826                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3827 00001A6A AC                      	lodsb
  3828 00001A6B B280                    	mov	dl, 80h
  3829 00001A6D 49                      	dec	ecx
  3830 00001A6E 7402                    	jz	short lff44m_2_1
  3831 00001A70 8A16                    	mov	dl, [esi]
  3832                                  lff44m_2_1:	
  3833                                  	; al = [previous_val]
  3834                                  	; dl = [next_val]
  3835 00001A72 E825020000              	call	interpolating_2_8bit_mono
  3836 00001A77 E320                    	jecxz	lff44m_3
  3837                                  lff44m_2_2:
  3838 00001A79 AC                      	lodsb
  3839 00001A7A 2C80                    	sub	al, 80h
  3840 00001A7C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3841 00001A80 66AB                    	stosw		; (L)
  3842 00001A82 66AB                    	stosw		; (R)
  3843                                  
  3844 00001A84 49                      	dec	ecx
  3845 00001A85 7412                    	jz	short lff44m_3
  3846 00001A87 4D                      	dec	ebp
  3847 00001A88 75EF                    	jnz	short lff44m_2_2
  3848                                  	
  3849 00001A8A FE0D[64210000]          	dec	byte [faz]
  3850 00001A90 74CC                    	jz	short lff44m_9 
  3851 00001A92 BD0B000000              	mov	ebp, 11
  3852 00001A97 EBD1                    	jmp	short lff44m_1
  3853                                  
  3854                                  lff44m_3:
  3855                                  lff44s_3:
  3856 00001A99 E951F1FFFF              	jmp	lff44_3	; padfill
  3857                                  		; (put zeros in the remain words of the buffer)
  3858                                  lff44m_7:
  3859                                  lff44s_7:
  3860 00001A9E E96DF1FFFF              	jmp	lff44_5  ; error
  3861                                  
  3862                                  load_44khz_stereo_8_bit:
  3863                                  	; 16/11/2023
  3864 00001AA3 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3865                                  					; last of the file?
  3866 00001AAA 7402                    	jz	short lff44s_0		; no
  3867 00001AAC F9                      	stc
  3868 00001AAD C3                      	retn
  3869                                  
  3870                                  lff44s_0:
  3871                                  	; 01/12/2024
  3872                                  	; edi = audio buffer address
  3873 00001AAE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3874                                          ;mov	edx, [loadsize]
  3875                                  
  3876                                  	; esi = buffer address
  3877                                  	;; edx = buffer size
  3878                                  
  3879                                  	; load file into memory
  3880                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001AB3 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001AB9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001ABB 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001AC1 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001AC6 CD40                <1>  int 40h
  3881 00001AC8 72D4                    	jc	short lff44s_7 ; error !
  3882                                  
  3883                                  	; 01/12/2024
  3884 00001ACA A3[D87D0000]            	mov	[count], eax
  3885                                  	;;;
  3886                                  	; 07/12/2024
  3887                                  	;mov	edi, audio_buffer
  3888                                  	;;;
  3889 00001ACF D1E8                    	shr	eax, 1
  3890 00001AD1 7505                    	jnz	short lff44s_8
  3891 00001AD3 E92FF1FFFF              	jmp	lff44_eof
  3892                                  
  3893                                  lff44s_8:
  3894 00001AD8 89C1                    	mov	ecx, eax	; word count
  3895                                  lff44s_9:
  3896 00001ADA BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3897 00001ADF C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3898                                  lff44s_1:
  3899                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3900                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3901 00001AE6 66AD                    	lodsw
  3902 00001AE8 66BA8080                	mov	dx, 8080h
  3903 00001AEC 49                      	dec	ecx
  3904 00001AED 7403                    	jz	short lff44s_2_1
  3905 00001AEF 668B16                  	mov	dx, [esi]
  3906                                  lff44s_2_1:	
  3907                                  	; al = [previous_val_l]
  3908                                  	; ah = [previous_val_r]
  3909                                  	; dl = [next_val_l]
  3910                                  	; dh = [next_val_r]
  3911 00001AF2 E8C2010000              	call	interpolating_2_8bit_stereo
  3912 00001AF7 E3A0                    	jecxz	lff44s_3
  3913                                  lff44s_2_2:
  3914 00001AF9 AC                      	lodsb
  3915 00001AFA 2C80                    	sub	al, 80h
  3916 00001AFC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3917 00001B00 66AB                    	stosw		; (L)
  3918 00001B02 AC                      	lodsb
  3919 00001B03 2C80                    	sub	al, 80h
  3920 00001B05 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3921 00001B09 66AB                    	stosw		; (R)
  3922                                  
  3923 00001B0B 49                      	dec	ecx
  3924 00001B0C 748B                    	jz	short lff44s_3	
  3925 00001B0E 4D                      	dec	ebp
  3926 00001B0F 75E8                    	jnz	short lff44s_2_2
  3927                                  	
  3928 00001B11 FE0D[64210000]          	dec	byte [faz]
  3929 00001B17 74C1                    	jz	short lff44s_9 
  3930 00001B19 BD0B000000              	mov	ebp, 11
  3931 00001B1E EBC6                    	jmp	short lff44s_1
  3932                                  
  3933                                  load_44khz_mono_16_bit:
  3934                                  	; 18/11/2023
  3935 00001B20 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3936                                  					; last of the file?
  3937 00001B27 7402                    	jz	short lff44m2_0		; no
  3938 00001B29 F9                      	stc
  3939 00001B2A C3                      	retn
  3940                                  
  3941                                  lff44m2_0:
  3942                                  	; 01/12/2024
  3943                                  	; edi = audio buffer address
  3944 00001B2B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3945                                          ;mov	edx, [loadsize]
  3946                                  
  3947                                  	; esi = buffer address
  3948                                  	;; edx = buffer size
  3949                                  
  3950                                  	; load file into memory
  3951                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001B30 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001B36 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001B38 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001B3E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001B43 CD40                <1>  int 40h
  3952 00001B45 724D                    	jc	short lff44m2_7 ; error !
  3953                                  
  3954                                  	; 01/12/2024
  3955 00001B47 A3[D87D0000]            	mov	[count], eax
  3956                                  	;;;
  3957                                  	; 07/12/2024
  3958                                  	;mov	edi, audio_buffer
  3959                                  	;;;
  3960 00001B4C D1E8                    	shr	eax, 1
  3961 00001B4E 7505                    	jnz	short lff44m2_8
  3962 00001B50 E9B2F0FFFF              	jmp	lff44_eof
  3963                                  
  3964                                  lff44m2_8:
  3965 00001B55 89C1                    	mov	ecx, eax	; word count
  3966                                  lff44m2_9:
  3967 00001B57 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3968 00001B5C C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3969                                  lff44m2_1:
  3970                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3971                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3972 00001B63 66AD                    	lodsw
  3973 00001B65 31D2                    	xor	edx, edx
  3974 00001B67 49                      	dec	ecx
  3975 00001B68 7403                    	jz	short lff44m2_2_1
  3976 00001B6A 668B16                  	mov	dx, [esi]
  3977                                  lff44m2_2_1:	
  3978                                  	; ax = [previous_val]
  3979                                  	; dx = [next_val]
  3980 00001B6D E80B020000              	call	interpolating_2_16bit_mono
  3981 00001B72 E31B                    	jecxz	lff44m2_3
  3982                                  lff44m2_2_2:
  3983 00001B74 66AD                    	lodsw
  3984 00001B76 66AB                    	stosw		; (L)eft Channel
  3985 00001B78 66AB                    	stosw		; (R)ight Channel
  3986                                  
  3987 00001B7A 49                      	dec	ecx
  3988 00001B7B 7412                    	jz	short lff44m2_3	
  3989 00001B7D 4D                      	dec	ebp
  3990 00001B7E 75F4                    	jnz	short lff44m2_2_2
  3991                                  	
  3992 00001B80 FE0D[64210000]          	dec	byte [faz]
  3993 00001B86 74CF                    	jz	short lff44m2_9 
  3994 00001B88 BD0B000000              	mov	ebp, 11
  3995 00001B8D EBD4                    	jmp	short lff44m2_1
  3996                                  
  3997                                  lff44m2_3:
  3998                                  lff44s2_3:
  3999 00001B8F E95BF0FFFF              	jmp	lff44_3	; padfill
  4000                                  		; (put zeros in the remain words of the buffer)
  4001                                  lff44m2_7:
  4002                                  lff44s2_7:
  4003 00001B94 E977F0FFFF              	jmp	lff44_5  ; error
  4004                                  
  4005                                  load_44khz_stereo_16_bit:
  4006                                  	; 18/11/2023
  4007 00001B99 F605[5E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4008                                  					; last of the file?
  4009 00001BA0 7402                    	jz	short lff44s2_0		; no
  4010 00001BA2 F9                      	stc
  4011 00001BA3 C3                      	retn
  4012                                  
  4013                                  lff44s2_0:
  4014                                  	; 01/12/2024
  4015                                  	; edi = audio buffer address
  4016 00001BA4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4017                                          ;mov	edx, [loadsize]
  4018                                  
  4019                                  	; esi = buffer address
  4020                                  	;; edx = buffer size
  4021                                  
  4022                                  	; load file into memory
  4023                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001BA9 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001BAF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001BB1 8B15[C87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001BB7 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001BBC CD40                <1>  int 40h
  4024 00001BBE 72D4                    	jc	short lff44s2_7 ; error !
  4025                                  
  4026                                  	; 01/12/2024
  4027 00001BC0 A3[D87D0000]            	mov	[count], eax
  4028                                  	;;;
  4029                                  	; 07/12/2024
  4030                                  	;mov	edi, audio_buffer
  4031                                  	;;;
  4032 00001BC5 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4033 00001BC8 7505                    	jnz	short lff44s2_8
  4034 00001BCA E938F0FFFF              	jmp	lff44_eof
  4035                                  
  4036                                  lff44s2_8:
  4037 00001BCF 89C1                    	mov	ecx, eax	; dword count
  4038                                  lff44s2_9:
  4039 00001BD1 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4040 00001BD6 C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4041                                  lff44s2_1:
  4042                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4043                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4044 00001BDD 66AD                    	lodsw
  4045 00001BDF 89C3                    	mov	ebx, eax
  4046 00001BE1 66AD                    	lodsw
  4047                                  	;mov	dx, [esi]
  4048                                  	;mov	[next_val_l], dx
  4049                                  	;mov	dx, [esi+2]
  4050                                  	; 26/11/2023
  4051 00001BE3 8B16                    	mov	edx, [esi]
  4052 00001BE5 668915[60210000]        	mov	[next_val_l], dx
  4053 00001BEC C1EA10                  	shr	edx, 16
  4054 00001BEF 49                      	dec	ecx
  4055 00001BF0 7509                    	jnz	short lff44s2_2_1
  4056 00001BF2 31D2                    	xor	edx, edx ; 0
  4057 00001BF4 668915[60210000]        	mov	[next_val_l], dx
  4058                                  lff44s2_2_1:
  4059                                  	; bx = [previous_val_l]
  4060                                  	; ax = [previous_val_r]
  4061                                  	; [next_val_l]
  4062                                  	; dx = [next_val_r]
  4063 00001BFB E895010000              	call	interpolating_2_16bit_stereo
  4064 00001C00 E38D                    	jecxz	lff44s2_3
  4065                                  lff44s2_2_2:
  4066                                  	;movsw		; (L)eft Channel
  4067                                  	;movsw		; (R)ight Channel
  4068 00001C02 A5                      	movsd
  4069                                  
  4070 00001C03 49                      	dec	ecx
  4071 00001C04 7489                    	jz	short lff44s2_3	
  4072 00001C06 4D                      	dec	ebp
  4073 00001C07 75F9                    	jnz	short lff44s2_2_2
  4074                                  	
  4075 00001C09 FE0D[64210000]          	dec	byte [faz]
  4076 00001C0F 74C0                    	jz	short lff44s2_9 
  4077 00001C11 BD0B000000              	mov	ebp, 11
  4078 00001C16 EBC5                    	jmp	short lff44s2_1
  4079                                  
  4080                                  ; .....................
  4081                                  
  4082                                  interpolating_3_8bit_mono:
  4083                                  	; 16/11/2023
  4084                                  	; al = [previous_val]
  4085                                  	; dl = [next_val]
  4086                                  	; original-interpolated-interpolated
  4087 00001C18 88C3                    	mov	bl, al
  4088 00001C1A 2C80                    	sub	al, 80h
  4089 00001C1C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4090 00001C20 66AB                    	stosw		; original sample (L)
  4091 00001C22 66AB                    	stosw		; original sample (R)
  4092 00001C24 88D8                    	mov	al, bl
  4093 00001C26 00D0                    	add	al, dl
  4094 00001C28 D0D8                    	rcr	al, 1
  4095 00001C2A 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4096 00001C2C 00D8                    	add	al, bl
  4097 00001C2E D0D8                    	rcr	al, 1
  4098 00001C30 2C80                    	sub	al, 80h
  4099 00001C32 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4100 00001C36 66AB                    	stosw		; interpolated sample 1 (L)
  4101 00001C38 66AB                    	stosw		; interpolated sample 1 (R)
  4102 00001C3A 88F8                    	mov	al, bh
  4103 00001C3C 00D0                    	add	al, dl	; [next_val]
  4104 00001C3E D0D8                    	rcr	al, 1
  4105 00001C40 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4106 00001C44 66AB                    	stosw		; interpolated sample 2 (L)
  4107 00001C46 66AB                    	stosw		; interpolated sample 2 (R)
  4108 00001C48 C3                      	retn
  4109                                  
  4110                                  interpolating_3_8bit_stereo:
  4111                                  	; 16/11/2023
  4112                                  	; al = [previous_val_l]
  4113                                  	; ah = [previous_val_r]
  4114                                  	; dl = [next_val_l]
  4115                                  	; dh = [next_val_r]
  4116                                  	; original-interpolated-interpolated
  4117 00001C49 89C3                    	mov	ebx, eax
  4118 00001C4B 2C80                    	sub	al, 80h
  4119 00001C4D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4120 00001C51 66AB                    	stosw		; original sample (L)
  4121 00001C53 88F8                    	mov	al, bh
  4122 00001C55 2C80                    	sub	al, 80h
  4123 00001C57 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4124 00001C5B 66AB                    	stosw		; original sample (R)
  4125 00001C5D 88D8                    	mov	al, bl
  4126 00001C5F 00D0                    	add	al, dl	; [next_val_l]
  4127 00001C61 D0D8                    	rcr	al, 1
  4128 00001C63 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4129 00001C64 00D8                    	add	al, bl	; [previous_val_l]
  4130 00001C66 D0D8                    	rcr	al, 1
  4131 00001C68 2C80                    	sub	al, 80h
  4132 00001C6A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4133 00001C6E 66AB                    	stosw		; interpolated sample 1 (L)
  4134 00001C70 88F8                    	mov	al, bh
  4135 00001C72 00F0                    	add	al, dh	; [next_val_r]
  4136 00001C74 D0D8                    	rcr	al, 1
  4137 00001C76 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4138 00001C77 00F8                    	add	al, bh	; [previous_val_r]
  4139 00001C79 D0D8                    	rcr	al, 1
  4140 00001C7B 2C80                    	sub	al, 80h
  4141 00001C7D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4142 00001C81 66AB                    	stosw		; interpolated sample 1 (R)
  4143 00001C83 5B                      	pop	ebx ; **
  4144 00001C84 58                      	pop	eax ; *
  4145 00001C85 00D0                    	add	al, dl	; [next_val_l]
  4146 00001C87 D0D8                    	rcr	al, 1
  4147 00001C89 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4148 00001C8D 66AB                    	stosw		; interpolated sample 2 (L)
  4149 00001C8F 88D8                    	mov	al, bl
  4150 00001C91 00F0                    	add	al, dh	; [next_val_r]
  4151 00001C93 D0D8                    	rcr	al, 1
  4152 00001C95 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4153 00001C99 66AB                    	stosw		; interpolated sample 2 (R)
  4154 00001C9B C3                      	retn
  4155                                  
  4156                                  interpolating_2_8bit_mono:
  4157                                  	; 16/11/2023
  4158                                  	; al = [previous_val]
  4159                                  	; dl = [next_val]
  4160                                  	; original-interpolated
  4161 00001C9C 88C3                    	mov	bl, al
  4162 00001C9E 2C80                    	sub	al, 80h
  4163 00001CA0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4164 00001CA4 66AB                    	stosw		; original sample (L)
  4165 00001CA6 66AB                    	stosw		; original sample (R)
  4166 00001CA8 88D8                    	mov	al, bl
  4167 00001CAA 00D0                    	add	al, dl
  4168 00001CAC D0D8                    	rcr	al, 1
  4169 00001CAE 2C80                    	sub	al, 80h
  4170 00001CB0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4171 00001CB4 66AB                    	stosw		; interpolated sample (L)
  4172 00001CB6 66AB                    	stosw		; interpolated sample (R)
  4173 00001CB8 C3                      	retn
  4174                                  
  4175                                  interpolating_2_8bit_stereo:
  4176                                  	; 16/11/2023
  4177                                  	; al = [previous_val_l]
  4178                                  	; ah = [previous_val_r]
  4179                                  	; dl = [next_val_l]
  4180                                  	; dh = [next_val_r]
  4181                                  	; original-interpolated
  4182 00001CB9 89C3                    	mov	ebx, eax
  4183 00001CBB 2C80                    	sub	al, 80h
  4184 00001CBD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4185 00001CC1 66AB                    	stosw		; original sample (L)
  4186 00001CC3 88F8                    	mov	al, bh
  4187 00001CC5 2C80                    	sub	al, 80h
  4188 00001CC7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4189 00001CCB 66AB                    	stosw		; original sample (R)
  4190 00001CCD 88D8                    	mov	al, bl	; [previous_val_l]
  4191 00001CCF 00D0                    	add	al, dl	; [next_val_l]
  4192 00001CD1 D0D8                    	rcr	al, 1
  4193 00001CD3 2C80                    	sub	al, 80h
  4194 00001CD5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4195 00001CD9 66AB                    	stosw		; interpolated sample (L)
  4196 00001CDB 88F8                    	mov	al, bh
  4197 00001CDD 00F0                    	add	al, dh	; [next_val_r]
  4198 00001CDF D0D8                    	rcr	al, 1
  4199 00001CE1 2C80                    	sub	al, 80h
  4200 00001CE3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4201 00001CE7 66AB                    	stosw		; interpolated sample (R)
  4202 00001CE9 C3                      	retn
  4203                                  
  4204                                  interpolating_3_16bit_mono:
  4205                                  	; 16/11/2023
  4206                                  	; ax = [previous_val]
  4207                                  	; dx = [next_val]
  4208                                  	; original-interpolated-interpolated
  4209                                  
  4210 00001CEA 66AB                    	stosw		; original sample (L)
  4211 00001CEC 66AB                    	stosw		; original sample (R)
  4212 00001CEE 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4213 00001CF1 50                      	push	eax ; *	; [previous_val]
  4214 00001CF2 80C680                  	add	dh, 80h
  4215 00001CF5 6601D0                  	add	ax, dx
  4216 00001CF8 66D1D8                  	rcr	ax, 1
  4217 00001CFB 5B                      	pop	ebx ; *
  4218 00001CFC 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4219 00001CFD 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4220 00001D00 66D1D8                  	rcr	ax, 1
  4221 00001D03 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4222 00001D06 66AB                    	stosw 		; interpolated sample 1 (L)
  4223 00001D08 66AB                    	stosw		; interpolated sample 1 (R)
  4224 00001D0A 89D8                    	mov	eax, ebx
  4225 00001D0C 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4226 00001D0F 66D1D8                  	rcr	ax, 1
  4227 00001D12 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4228 00001D15 66AB                    	stosw		; interpolated sample 2 (L)
  4229 00001D17 66AB                    	stosw		; interpolated sample 2 (R)
  4230 00001D19 C3                      	retn
  4231                                  
  4232                                  interpolating_3_16bit_stereo:
  4233                                  	; 16/11/2023
  4234                                  	; bx = [previous_val_l]
  4235                                  	; ax = [previous_val_r]
  4236                                  	; [next_val_l]
  4237                                  	; dx = [next_val_r]
  4238                                  	; original-interpolated-interpolated
  4239                                  
  4240 00001D1A 93                      	xchg	eax, ebx
  4241 00001D1B 66AB                    	stosw		; original sample (L)
  4242 00001D1D 93                      	xchg	eax, ebx
  4243 00001D1E 66AB                    	stosw		; original sample (R)
  4244 00001D20 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4245 00001D23 50                      	push	eax ; *	; [previous_val_r]
  4246 00001D24 80C780                  	add	bh, 80h
  4247 00001D27 8005[61210000]80        	add	byte [next_val_l+1], 80h
  4248 00001D2E 66A1[60210000]          	mov	ax, [next_val_l]
  4249 00001D34 6601D8                  	add	ax, bx	; [previous_val_l]
  4250 00001D37 66D1D8                  	rcr	ax, 1
  4251 00001D3A 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4252 00001D3B 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4253 00001D3E 66D1D8                  	rcr	ax, 1
  4254 00001D41 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4255 00001D44 66AB                    	stosw 		; interpolated sample 1 (L)
  4256 00001D46 58                      	pop	eax  ; *
  4257 00001D47 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4258 00001D4A 52                      	push	edx  ; * ; [next_val_r]
  4259 00001D4B 92                      	xchg	eax, edx
  4260 00001D4C 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4261 00001D4F 66D1D8                  	rcr	ax, 1	; / 2
  4262 00001D52 50                      	push	eax ; ** ; interpolated middle (R)
  4263 00001D53 6601D0                  	add	ax, dx	; + [previous_val_r]
  4264 00001D56 66D1D8                  	rcr	ax, 1
  4265 00001D59 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4266 00001D5C 66AB                    	stosw 		; interpolated sample 1 (R)
  4267 00001D5E 66A1[60210000]          	mov	ax, [next_val_l]
  4268 00001D64 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4269 00001D67 66D1D8                  	rcr	ax, 1
  4270 00001D6A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4271 00001D6D 66AB                    	stosw 		; interpolated sample 2 (L)
  4272 00001D6F 58                      	pop	eax ; **
  4273 00001D70 5A                      	pop	edx ; *
  4274 00001D71 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4275 00001D74 66D1D8                  	rcr	ax, 1	; / 2
  4276 00001D77 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4277 00001D7A 66AB                    	stosw 		; interpolated sample 2 (L)
  4278 00001D7C C3                      	retn
  4279                                  
  4280                                  interpolating_2_16bit_mono:
  4281                                  	; 16/11/2023
  4282                                  	; ax = [previous_val]
  4283                                  	; dx = [next_val]
  4284                                  	; original-interpolated
  4285                                  
  4286 00001D7D 66AB                    	stosw		; original sample (L)
  4287 00001D7F 66AB                    	stosw		; original sample (R)
  4288 00001D81 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4289 00001D84 80C680                  	add	dh, 80h
  4290 00001D87 6601D0                  	add	ax, dx
  4291 00001D8A 66D1D8                  	rcr	ax, 1
  4292 00001D8D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4293 00001D90 66AB                    	stosw		; interpolated sample (L)
  4294 00001D92 66AB                    	stosw		; interpolated sample (R)
  4295 00001D94 C3                      	retn
  4296                                  
  4297                                  interpolating_2_16bit_stereo:
  4298                                  	; 18/01/2025
  4299                                  	; 16/11/2023
  4300                                  	; bx = [previous_val_l]
  4301                                  	; ax = [previous_val_r]
  4302                                  	; [next_val_l]
  4303                                  	; dx = [next_val_r]
  4304                                  	; original-interpolated
  4305                                  
  4306 00001D95 93                      	xchg	eax, ebx
  4307 00001D96 66AB                    	stosw		; original sample (L)
  4308 00001D98 93                      	xchg	eax, ebx
  4309 00001D99 66AB                    	stosw		; original sample (R)
  4310 00001D9B 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4311 00001D9E 80C680                  	add	dh, 80h
  4312 00001DA1 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4313 00001DA4 66D1D8                  	rcr	ax, 1	; / 2
  4314                                  	; 18/01/2025
  4315 00001DA7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4316                                  	;push	eax ; *	; interpolated sample (R)
  4317                                  	; 18/01/2025
  4318 00001DAA C1E010                  	shl	eax, 16
  4319 00001DAD 66A1[60210000]          	mov	ax, [next_val_l]
  4320 00001DB3 80C480                  	add	ah, 80h
  4321 00001DB6 80C780                  	add	bh, 80h
  4322 00001DB9 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4323 00001DBC 66D1D8                  	rcr	ax, 1	; / 2
  4324 00001DBF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4325                                  	; 18/01/2025
  4326                                  	;stosw 		; interpolated sample (L)
  4327                                  	;pop	eax ; *	
  4328                                  	;sub	ah, 80h	; -32768 to +32767 format again
  4329                                  	;stosw 		; interpolated sample (R)
  4330                                  	; 18/01/2025
  4331 00001DC2 AB                      	stosd
  4332 00001DC3 C3                      	retn
  4333                                  
  4334                                  interpolating_5_8bit_mono:
  4335                                  	; 17/11/2023
  4336                                  	; al = [previous_val]
  4337                                  	; dl = [next_val]
  4338                                  	; original-interpltd-interpltd-interpltd-interpltd
  4339 00001DC4 88C3                    	mov	bl, al
  4340 00001DC6 2C80                    	sub	al, 80h
  4341 00001DC8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4342 00001DCC 66AB                    	stosw		; original sample (L)
  4343 00001DCE 66AB                    	stosw		; original sample (R)
  4344 00001DD0 88D8                    	mov	al, bl
  4345 00001DD2 00D0                    	add	al, dl
  4346 00001DD4 D0D8                    	rcr	al, 1
  4347 00001DD6 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4348 00001DD8 00D8                    	add	al, bl  ; [previous_val]
  4349 00001DDA D0D8                    	rcr	al, 1 	
  4350 00001DDC 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4351 00001DDE 00D8                    	add	al, bl
  4352 00001DE0 D0D8                    	rcr	al, 1
  4353 00001DE2 2C80                    	sub	al, 80h
  4354 00001DE4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4355 00001DE8 66AB                    	stosw		; interpolated sample 1 (L)
  4356 00001DEA 66AB                    	stosw		; interpolated sample 1 (R)
  4357 00001DEC 88F8                    	mov	al, bh
  4358 00001DEE 00F0                    	add	al, dh
  4359 00001DF0 D0D8                    	rcr	al, 1
  4360 00001DF2 2C80                    	sub	al, 80h
  4361 00001DF4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4362 00001DF8 66AB                    	stosw		; interpolated sample 2 (L)
  4363 00001DFA 66AB                    	stosw		; interpolated sample 2 (R)
  4364 00001DFC 88F8                    	mov	al, bh
  4365 00001DFE 00D0                    	add	al, dl	; [next_val]
  4366 00001E00 D0D8                    	rcr	al, 1
  4367 00001E02 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4368 00001E04 00F8                    	add	al, bh
  4369 00001E06 D0D8                    	rcr	al, 1
  4370 00001E08 2C80                    	sub	al, 80h
  4371 00001E0A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4372 00001E0E 66AB                    	stosw		; interpolated sample 3 (L)
  4373 00001E10 66AB                    	stosw		; interpolated sample 3 (R)
  4374 00001E12 88F0                    	mov	al, dh
  4375 00001E14 00D0                    	add	al, dl
  4376 00001E16 D0D8                    	rcr	al, 1
  4377 00001E18 2C80                    	sub	al, 80h
  4378 00001E1A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4379 00001E1E 66AB                    	stosw		; interpolated sample 4 (L)
  4380 00001E20 66AB                    	stosw		; interpolated sample 4 (R)
  4381 00001E22 C3                      	retn
  4382                                  
  4383                                  interpolating_5_8bit_stereo:
  4384                                  	; 17/11/2023
  4385                                  	; al = [previous_val_l]
  4386                                  	; ah = [previous_val_r]
  4387                                  	; dl = [next_val_l]
  4388                                  	; dh = [next_val_r]
  4389                                  	; original-interpltd-interpltd-interpltd-interpltd
  4390 00001E23 89C3                    	mov	ebx, eax
  4391 00001E25 2C80                    	sub	al, 80h
  4392 00001E27 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4393 00001E2B 66AB                    	stosw		; original sample (L)
  4394 00001E2D 88F8                    	mov	al, bh
  4395 00001E2F 2C80                    	sub	al, 80h
  4396 00001E31 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4397 00001E35 66AB                    	stosw		; original sample (R)
  4398 00001E37 52                      	push	edx ; *
  4399 00001E38 88D8                    	mov	al, bl
  4400 00001E3A 00D0                    	add	al, dl	; [next_val_l]
  4401 00001E3C D0D8                    	rcr	al, 1
  4402 00001E3E 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4403 00001E3F 00D8                    	add	al, bl	; [previous_val_l]
  4404 00001E41 D0D8                    	rcr	al, 1
  4405 00001E43 86D8                    	xchg	al, bl
  4406 00001E45 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4407 00001E47 D0D8                    	rcr	al, 1
  4408 00001E49 2C80                    	sub	al, 80h
  4409 00001E4B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4410 00001E4F 66AB                    	stosw		; interpolated sample 1 (L)
  4411 00001E51 88F8                    	mov	al, bh
  4412 00001E53 00F0                    	add	al, dh	; [next_val_r]
  4413 00001E55 D0D8                    	rcr	al, 1
  4414 00001E57 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4415 00001E58 00F8                    	add	al, bh	; [previous_val_r]
  4416 00001E5A D0D8                    	rcr	al, 1
  4417 00001E5C 86F8                    	xchg	al, bh
  4418 00001E5E 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4419 00001E60 D0D8                    	rcr	al, 1
  4420 00001E62 2C80                    	sub	al, 80h
  4421 00001E64 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4422 00001E68 66AB                    	stosw		; interpolated sample 1 (R)
  4423 00001E6A 5A                      	pop	edx ; ***
  4424 00001E6B 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4425 00001E6C 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4426 00001E6E 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4427 00001E70 D0D8                    	rcr	al, 1
  4428 00001E72 2C80                    	sub	al, 80h
  4429 00001E74 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4430 00001E78 66AB                    	stosw		; interpolated sample 2 (L)
  4431 00001E7A 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4432 00001E7C 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4433 00001E7E 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4434 00001E80 D0D8                    	rcr	al, 1
  4435 00001E82 2C80                    	sub	al, 80h
  4436 00001E84 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4437 00001E88 66AB                    	stosw		; interpolated sample 2 (R)
  4438 00001E8A 5A                      	pop	edx ; *
  4439 00001E8B 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4440 00001E8D 00D0                    	add	al, dl	; [next_val_l]
  4441 00001E8F D0D8                    	rcr	al, 1
  4442 00001E91 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4443 00001E93 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4444 00001E95 D0D8                    	rcr	al, 1
  4445 00001E97 2C80                    	sub	al, 80h
  4446 00001E99 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4447 00001E9D 66AB                    	stosw		; interpolated sample 3 (L)
  4448 00001E9F 88F8                    	mov	al, bh	
  4449 00001EA1 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4450 00001EA3 D0D8                    	rcr	al, 1
  4451 00001EA5 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4452 00001EA7 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4453 00001EA9 D0D8                    	rcr	al, 1
  4454 00001EAB 2C80                    	sub	al, 80h
  4455 00001EAD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4456 00001EB1 66AB                    	stosw		; interpolated sample 3 (R)
  4457 00001EB3 88D8                    	mov	al, bl
  4458 00001EB5 00D0                    	add	al, dl	; [next_val_l]
  4459 00001EB7 D0D8                    	rcr	al, 1
  4460 00001EB9 2C80                    	sub	al, 80h
  4461 00001EBB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4462 00001EBF 66AB                    	stosw		; interpolated sample 4 (L)
  4463 00001EC1 88F8                    	mov	al, bh
  4464 00001EC3 00F0                    	add	al, dh	; [next_val_r]
  4465 00001EC5 D0D8                    	rcr	al, 1
  4466 00001EC7 2C80                    	sub	al, 80h
  4467 00001EC9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4468 00001ECD 66AB                    	stosw		; interpolated sample 4 (R)
  4469 00001ECF C3                      	retn
  4470                                  
  4471                                  interpolating_4_8bit_mono:
  4472                                  	; 17/11/2023
  4473                                  	; al = [previous_val]
  4474                                  	; dl = [next_val]
  4475                                  	; original-interpolated-interpolated-interpolated
  4476 00001ED0 88C3                    	mov	bl, al
  4477 00001ED2 2C80                    	sub	al, 80h
  4478 00001ED4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4479 00001ED8 66AB                    	stosw		; original sample (L)
  4480 00001EDA 66AB                    	stosw		; original sample (R)
  4481 00001EDC 88D8                    	mov	al, bl
  4482 00001EDE 00D0                    	add	al, dl	
  4483 00001EE0 D0D8                    	rcr	al, 1
  4484 00001EE2 86D8                    	xchg	al, bl  ; al = [previous_val]
  4485 00001EE4 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4486 00001EE6 D0D8                    	rcr	al, 1 	
  4487 00001EE8 2C80                    	sub	al, 80h
  4488 00001EEA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4489 00001EEE 66AB                    	stosw		; interpolated sample 1 (L)
  4490 00001EF0 66AB                    	stosw		; interpolated sample 1 (R)
  4491 00001EF2 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4492 00001EF4 2C80                    	sub	al, 80h
  4493 00001EF6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4494 00001EFA 66AB                    	stosw		; interpolated sample 2 (L)
  4495 00001EFC 66AB                    	stosw		; interpolated sample 2 (R)
  4496 00001EFE 88D8                    	mov	al, bl
  4497 00001F00 00D0                    	add	al, dl	; [next_val]
  4498 00001F02 D0D8                    	rcr	al, 1
  4499 00001F04 2C80                    	sub	al, 80h
  4500 00001F06 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4501 00001F0A 66AB                    	stosw		; interpolated sample 3 (L)
  4502 00001F0C 66AB                    	stosw		; interpolated sample 3 (R)
  4503 00001F0E C3                      	retn
  4504                                  
  4505                                  interpolating_4_8bit_stereo:
  4506                                  	; 17/11/2023
  4507                                  	; al = [previous_val_l]
  4508                                  	; ah = [previous_val_r]
  4509                                  	; dl = [next_val_l]
  4510                                  	; dh = [next_val_r]	
  4511                                  	; original-interpolated-interpolated-interpolated
  4512 00001F0F 89C3                    	mov	ebx, eax
  4513 00001F11 2C80                    	sub	al, 80h
  4514 00001F13 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4515 00001F17 66AB                    	stosw		; original sample (L)
  4516 00001F19 88F8                    	mov	al, bh
  4517 00001F1B 2C80                    	sub	al, 80h
  4518 00001F1D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4519 00001F21 66AB                    	stosw		; original sample (R)
  4520 00001F23 88D8                    	mov	al, bl
  4521 00001F25 00D0                    	add	al, dl	; [next_val_l]
  4522 00001F27 D0D8                    	rcr	al, 1
  4523 00001F29 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4524 00001F2B 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4525 00001F2D D0D8                    	rcr	al, 1
  4526 00001F2F 2C80                    	sub	al, 80h
  4527 00001F31 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4528 00001F35 66AB                    	stosw		; interpolated sample 1 (L)
  4529 00001F37 88F8                    	mov	al, bh
  4530 00001F39 00F0                    	add	al, dh	; [next_val_r]
  4531 00001F3B D0D8                    	rcr	al, 1
  4532 00001F3D 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4533 00001F3F 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4534 00001F41 D0D8                    	rcr	al, 1
  4535 00001F43 2C80                    	sub	al, 80h
  4536 00001F45 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4537 00001F49 66AB                    	stosw		; interpolated sample 1 (R)
  4538 00001F4B 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4539 00001F4D 2C80                    	sub	al, 80h
  4540 00001F4F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4541 00001F53 66AB                    	stosw		; interpolated sample 2 (L)
  4542 00001F55 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4543 00001F57 2C80                    	sub	al, 80h
  4544 00001F59 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4545 00001F5D 66AB                    	stosw		; interpolated sample 2 (L)
  4546 00001F5F 88D8                    	mov	al, bl
  4547 00001F61 00D0                    	add	al, dl	; [next_val_l]
  4548 00001F63 D0D8                    	rcr	al, 1
  4549 00001F65 2C80                    	sub	al, 80h
  4550 00001F67 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4551 00001F6B 66AB                    	stosw		; interpolated sample 3 (L)
  4552 00001F6D 88F8                    	mov	al, bh
  4553 00001F6F 00F0                    	add	al, dh	; [next_val_r]
  4554 00001F71 D0D8                    	rcr	al, 1
  4555 00001F73 2C80                    	sub	al, 80h
  4556 00001F75 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4557 00001F79 66AB                    	stosw		; interpolated sample 3 (R)
  4558 00001F7B C3                      	retn
  4559                                  
  4560                                  interpolating_5_16bit_mono:
  4561                                  	; 18/11/2023
  4562                                  	; ax = [previous_val]
  4563                                  	; dx = [next_val]
  4564                                  	; original-interpltd-interpltd-interpltd-interpltd
  4565 00001F7C 66AB                    	stosw		; original sample (L)
  4566 00001F7E 66AB                    	stosw		; original sample (R)
  4567 00001F80 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4568 00001F83 89C3                    	mov	ebx, eax ; [previous_val]
  4569 00001F85 80C680                  	add	dh, 80h
  4570 00001F88 6601D0                  	add	ax, dx
  4571 00001F8B 66D1D8                  	rcr	ax, 1
  4572 00001F8E 50                      	push	eax ; *	; interpolated middle (temporary)
  4573 00001F8F 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4574 00001F92 66D1D8                  	rcr	ax, 1
  4575 00001F95 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4576 00001F96 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4577 00001F99 66D1D8                  	rcr	ax, 1	
  4578 00001F9C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4579 00001F9F 66AB                    	stosw 		; interpolated sample 1 (L)
  4580 00001FA1 66AB                    	stosw		; interpolated sample 1 (R)
  4581 00001FA3 58                      	pop	eax ; **
  4582 00001FA4 5B                      	pop	ebx ; *
  4583 00001FA5 6601D8                  	add	ax, bx	; 1st quarter + middle
  4584 00001FA8 66D1D8                  	rcr	ax, 1	; / 2
  4585 00001FAB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4586 00001FAE 66AB                    	stosw		; interpolated sample 2 (L)
  4587 00001FB0 66AB                    	stosw		; interpolated sample 2 (R)
  4588 00001FB2 89D8                    	mov	eax, ebx
  4589 00001FB4 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4590 00001FB7 66D1D8                  	rcr	ax, 1
  4591 00001FBA 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4592 00001FBB 6601D8                  	add	ax, bx	; + interpolated middle
  4593 00001FBE 66D1D8                  	rcr	ax, 1
  4594 00001FC1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4595 00001FC4 66AB                    	stosw		; interpolated sample 3 (L)
  4596 00001FC6 66AB                    	stosw		; interpolated sample 3 (R)
  4597 00001FC8 58                      	pop	eax ; *	
  4598 00001FC9 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4599 00001FCC 66D1D8                  	rcr	ax, 1	; / 2
  4600 00001FCF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4601 00001FD2 66AB                    	stosw		; interpolated sample 4 (L)
  4602 00001FD4 66AB                    	stosw		; interpolated sample 4 (R)
  4603 00001FD6 C3                      	retn
  4604                                  
  4605                                  interpolating_5_16bit_stereo:
  4606                                  	; 18/11/2023
  4607                                  	; bx = [previous_val_l]
  4608                                  	; ax = [previous_val_r]
  4609                                  	; [next_val_l]
  4610                                  	; [next_val_r]
  4611                                  	; original-interpltd-interpltd-interpltd-interpltd
  4612 00001FD7 51                      	push	ecx ; !
  4613 00001FD8 93                      	xchg	eax, ebx
  4614 00001FD9 66AB                    	stosw		; original sample (L)
  4615 00001FDB 93                      	xchg	eax, ebx
  4616 00001FDC 66AB                    	stosw		; original sample (R)
  4617 00001FDE 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4618 00001FE1 50                      	push	eax ; *	; [previous_val_r]
  4619 00001FE2 80C780                  	add	bh, 80h
  4620 00001FE5 8005[61210000]80        	add	byte [next_val_l+1], 80h
  4621 00001FEC 66A1[60210000]          	mov	ax, [next_val_l]
  4622 00001FF2 6601D8                  	add	ax, bx	; [previous_val_l]
  4623 00001FF5 66D1D8                  	rcr	ax, 1
  4624 00001FF8 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4625 00001FFA 6601D8                  	add	ax, bx	
  4626 00001FFD 66D1D8                  	rcr	ax, 1
  4627 00002000 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4628 00002002 6601D8                  	add	ax, bx	; [previous_val_l]
  4629 00002005 66D1D8                  	rcr	ax, 1
  4630 00002008 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4631 0000200B 66AB                    	stosw 		; interpolated sample 1 (L)
  4632 0000200D 89C8                    	mov	eax, ecx
  4633 0000200F 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4634 00002012 66D1D8                  	rcr	ax, 1	; / 2
  4635 00002015 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4636 00002017 5A                      	pop	edx ; *	; [previous_val_r]
  4637 00002018 89D0                    	mov	eax, edx
  4638 0000201A 8005[63210000]80        	add	byte [next_val_r+1], 80h
  4639 00002021 660305[62210000]        	add	ax, [next_val_r]
  4640 00002028 66D1D8                  	rcr	ax, 1
  4641 0000202B 50                      	push	eax ; *	; interpolated middle (R)
  4642 0000202C 6601D0                  	add	ax, dx
  4643 0000202F 66D1D8                  	rcr	ax, 1
  4644 00002032 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4645 00002033 6601D0                  	add	ax, dx	; [previous_val_r]
  4646 00002036 66D1D8                  	rcr	ax, 1
  4647 00002039 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4648 0000203C 66AB                    	stosw 		; interpolated sample 1 (R)
  4649 0000203E 89D8                    	mov	eax, ebx
  4650 00002040 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4651 00002043 66AB                    	stosw 		; interpolated sample 2 (L)
  4652 00002045 58                      	pop	eax ; **
  4653 00002046 5A                      	pop	edx ; *
  4654 00002047 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4655 0000204A 66D1D8                  	rcr	ax, 1	; / 2
  4656 0000204D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4657 00002050 66AB                    	stosw 		; interpolated sample 2 (R)
  4658 00002052 89C8                    	mov	eax, ecx
  4659 00002054 660305[60210000]        	add	ax, [next_val_l]
  4660 0000205B 66D1D8                  	rcr	ax, 1
  4661 0000205E 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4662 0000205F 6601C8                  	add	ax, cx	; interpolated middle (L)
  4663 00002062 66D1D8                  	rcr	ax, 1
  4664 00002065 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4665 00002068 66AB                    	stosw 		; interpolated sample 3 (L)
  4666 0000206A 89D0                    	mov	eax, edx
  4667 0000206C 660305[62210000]        	add	ax, [next_val_r]
  4668 00002073 66D1D8                  	rcr	ax, 1
  4669 00002076 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4670 00002077 6601D0                  	add	ax, dx	; interpolated middle (R)
  4671 0000207A 66D1D8                  	rcr	ax, 1
  4672 0000207D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4673 00002080 66AB                    	stosw 		; interpolated sample 3 (R)
  4674 00002082 5B                      	pop	ebx ; **
  4675 00002083 58                      	pop	eax ; *
  4676 00002084 660305[60210000]        	add	ax, [next_val_l]
  4677 0000208B 66D1D8                  	rcr	ax, 1
  4678 0000208E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4679 00002091 66AB                    	stosw 		; interpolated sample 4 (L)
  4680 00002093 89D8                    	mov	eax, ebx
  4681 00002095 660305[62210000]        	add	ax, [next_val_r]
  4682 0000209C 66D1D8                  	rcr	ax, 1
  4683 0000209F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4684 000020A2 66AB                    	stosw 		; interpolated sample 4 (R)
  4685 000020A4 59                      	pop	ecx ; !
  4686 000020A5 C3                      	retn
  4687                                  
  4688                                  interpolating_4_16bit_mono:
  4689                                  	; 18/11/2023
  4690                                  	; ax = [previous_val]
  4691                                  	; dx = [next_val]
  4692                                  	; original-interpolated
  4693                                  
  4694 000020A6 66AB                    	stosw		; original sample (L)
  4695 000020A8 66AB                    	stosw		; original sample (R)
  4696 000020AA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4697 000020AD 89C3                    	mov	ebx, eax ; [previous_val]
  4698 000020AF 80C680                  	add	dh, 80h
  4699 000020B2 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4700 000020B5 66D1D8                  	rcr	ax, 1
  4701 000020B8 93                      	xchg	eax, ebx
  4702 000020B9 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4703 000020BC 66D1D8                  	rcr	ax, 1
  4704 000020BF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4705 000020C2 66AB                    	stosw 		; interpolated sample 1 (L)
  4706 000020C4 66AB                    	stosw		; interpolated sample 1 (R)
  4707 000020C6 89D8                    	mov	eax, ebx ; interpolated middle
  4708 000020C8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4709 000020CB 66AB                    	stosw 		; interpolated sample 2 (L)
  4710 000020CD 66AB                    	stosw		; interpolated sample 2 (R)
  4711 000020CF 89D8                    	mov	eax, ebx
  4712 000020D1 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4713 000020D4 66D1D8                  	rcr	ax, 1
  4714 000020D7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4715 000020DA 66AB                    	stosw		; interpolated sample 3 (L)
  4716 000020DC 66AB                    	stosw		; interpolated sample 3 (R)
  4717 000020DE C3                      	retn
  4718                                  
  4719                                  interpolating_4_16bit_stereo:
  4720                                  	; 18/11/2023
  4721                                  	; bx = [previous_val_l]
  4722                                  	; ax = [previous_val_r]
  4723                                  	; [next_val_l]
  4724                                  	; [next_val_r]
  4725                                  	; original-interpolated-interpolated-interpolated
  4726 000020DF 93                      	xchg	eax, ebx
  4727 000020E0 66AB                    	stosw		; original sample (L)
  4728 000020E2 93                      	xchg	eax, ebx
  4729 000020E3 66AB                    	stosw		; original sample (R)
  4730 000020E5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4731 000020E8 89C2                    	mov	edx, eax ; [previous_val_r]
  4732 000020EA 80C780                  	add	bh, 80h
  4733 000020ED 8005[61210000]80        	add	byte [next_val_l+1], 80h
  4734 000020F4 66A1[60210000]          	mov	ax, [next_val_l]
  4735 000020FA 6601D8                  	add	ax, bx	; [previous_val_l]
  4736 000020FD 66D1D8                  	rcr	ax, 1
  4737 00002100 93                      	xchg	eax, ebx
  4738 00002101 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4739 00002104 66D1D8                  	rcr	ax, 1
  4740 00002107 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4741 0000210A 66AB                    	stosw 		; interpolated sample 1 (L)
  4742 0000210C 8005[63210000]80        	add	byte [next_val_r+1], 80h
  4743 00002113 89D0                    	mov	eax, edx ; [previous_val_r]
  4744 00002115 660305[62210000]        	add	ax, [next_val_r]
  4745 0000211C 66D1D8                  	rcr	ax, 1
  4746 0000211F 92                      	xchg	eax, edx
  4747 00002120 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4748 00002123 66D1D8                  	rcr	ax, 1
  4749 00002126 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4750 00002129 66AB                    	stosw 		; interpolated sample 1 (R)
  4751 0000212B 89D8                    	mov	eax, ebx
  4752 0000212D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4753 00002130 66AB                    	stosw 		; interpolated sample 2 (L)
  4754 00002132 89D0                    	mov	eax, edx
  4755 00002134 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4756 00002137 66AB                    	stosw 		; interpolated sample 2 (R)
  4757 00002139 89D8                    	mov	eax, ebx
  4758 0000213B 660305[60210000]        	add	ax, [next_val_l]
  4759 00002142 66D1D8                  	rcr	ax, 1
  4760 00002145 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4761 00002148 66AB                    	stosw 		; interpolated sample 3 (L)
  4762 0000214A 89D0                    	mov	eax, edx
  4763 0000214C 660305[62210000]        	add	ax, [next_val_r]
  4764 00002153 66D1D8                  	rcr	ax, 1
  4765 00002156 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4766 00002159 66AB                    	stosw 		; interpolated sample 3 (R)
  4767 0000215B C3                      	retn
  4768                                  
  4769                                  ; 13/11/2023
  4770                                  previous_val:
  4771 0000215C 0000                    previous_val_l: dw 0
  4772 0000215E 0000                    previous_val_r: dw 0
  4773                                  next_val:
  4774 00002160 0000                    next_val_l: dw 0
  4775 00002162 0000                    next_val_r: dw 0
  4776                                  
  4777                                  ; 16/11/2023
  4778 00002164 00                      faz:	db 0
  4779                                  
  4780                                  ; --------------------------------------------------------
  4781                                  ; --------------------------------------------------------
  4782                                  
  4783                                  ; 07/12/2024
  4784                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  4785                                  ;		'sysaudio' system call (23/08/2024)
  4786                                  ; 18/11/2024
  4787                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  4788                                  
  4789                                  ac97_stop: 
  4790                                  	; 18/11/2024
  4791 00002165 C605[207D0000]02        	mov	byte [stopped], 2
  4792                                  	; 07/12/2024
  4793                                  	sys	_audio, 0700h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000216C BB00070000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002171 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002176 CD40                <1>  int 40h
  4794 00002178 C3                      	retn
  4795                                  
  4796                                  ac97_pause:
  4797                                  	; 18/11/2024
  4798 00002179 C605[207D0000]01        	mov	byte [stopped], 1 ; paused
  4799                                  	; 07/12/2024
  4800                                  	sys	_audio, 0500h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002180 BB00050000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002185 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000218A CD40                <1>  int 40h
  4801 0000218C C3                      	retn
  4802                                  
  4803                                  ac97_play: ; continue to play (after pause)
  4804                                  	; 18/11/2024
  4805 0000218D C605[207D0000]00        	mov	byte [stopped], 0
  4806                                  	; 07/12/2024	
  4807                                  	sys	_audio, 0600h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002194 BB00060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002199 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000219E CD40                <1>  int 40h
  4808 000021A0 C3                      	retn
  4809                                  	
  4810                                  ; --------------------------------------------------------
  4811                                  ; 14/11/2024 - Erdogan Tan
  4812                                  ; --------------------------------------------------------
  4813                                  
  4814                                  	; 07/12/2024
  4815                                  	; 01/12/2024 (32bit registers)
  4816                                  	; 29/11/2024
  4817                                  checkUpdateEvents:
  4818 000021A1 E8E6010000              	call	check4keyboardstop
  4819 000021A6 7279                    	jc	short c4ue_ok
  4820                                  
  4821                                  	; 18/11/2024
  4822 000021A8 50                      	push	eax ; *
  4823 000021A9 09C0                    	or	eax, eax
  4824 000021AB 0F84F2000000            	jz	c4ue_cpt
  4825                                  
  4826                                  	; 18/11/2024
  4827 000021B1 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  4828 000021B3 7543                    	jne	short c4ue_chk_s
  4829 000021B5 803D[207D0000]00        	cmp	byte [stopped], 0
  4830 000021BC 7714                    	ja	short c4ue_chk_ps
  4831                                  	; pause
  4832 000021BE E8B6FFFFFF              	call	ac97_pause
  4833                                  	; 21/11/2024
  4834 000021C3 A0[217D0000]            	mov	al, [tLO]
  4835 000021C8 A2[227D0000]            	mov	byte [tLP], al
  4836 000021CD E9D1000000              	jmp	c4ue_cpt
  4837                                  c4ue_chk_ps:
  4838 000021D2 803D[207D0000]01        	cmp	byte [stopped], 1
  4839 000021D9 770A                    	ja	short c4ue_replay
  4840                                  	; continue to play (after a pause)
  4841 000021DB E8ADFFFFFF              	call	ac97_play 
  4842 000021E0 E9BE000000              	jmp	c4ue_cpt
  4843                                  c4ue_replay:
  4844                                  	; 19/11/2024
  4845 000021E5 58                      	pop	eax ; *
  4846 000021E6 58                      	pop	eax ; return address
  4847                                  	; 07/02/2024
  4848                                  	;mov	al, [volume]
  4849                                  	;call	SetmasterVolume
  4850 000021E7 C605[207D0000]00        	mov	byte [stopped], 0
  4851 000021EE E8A7040000              	call	move_to_beginning
  4852                                  	;jmp	PlayWav
  4853                                  	; 07/12/2024
  4854 000021F3 E9F9E3FFFF              	jmp	RePlayWav
  4855                                  
  4856                                  c4ue_chk_s:
  4857 000021F8 3C53                    	cmp	al, 'S'	; stop
  4858 000021FA 7526                    	jne	short c4ue_chk_fb
  4859 000021FC 803D[207D0000]00        	cmp	byte [stopped], 0
  4860 00002203 0F879A000000            	ja	c4ue_cpt ; Already stopped/paused
  4861 00002209 E857FFFFFF              	call	ac97_stop
  4862                                  	; 19/11/2024
  4863 0000220E C605[217D0000]00        	mov	byte [tLO], 0
  4864                                  	; 21/11/2024
  4865 00002215 C605[227D0000]30        	mov	byte [tLP], '0'
  4866 0000221C E982000000              	jmp	c4ue_cpt
  4867                                  
  4868                                  	; 01/12/2024
  4869                                  	; 18/11/2024
  4870                                  c4ue_ok:
  4871 00002221 C3                      	retn
  4872                                  
  4873                                  c4ue_chk_fb:
  4874                                  	; 17/11/2024
  4875 00002222 3C46                    	cmp	al, 'F'
  4876 00002224 7507                    	jne	short c4ue_chk_b
  4877 00002226 E847040000              	call 	Player_ProcessKey_Forwards
  4878 0000222B EB76                    	jmp	short c4ue_cpt
  4879                                  
  4880                                  c4ue_chk_b:
  4881 0000222D 3C42                    	cmp	al, 'B'
  4882                                  	;;jne	short c4ue_cpt
  4883                                  	; 19/11/2024
  4884 0000222F 7507                    	jne	short c4ue_chk_h
  4885 00002231 E838040000              	call 	Player_ProcessKey_Backwards
  4886 00002236 EB6B                    	jmp	short c4ue_cpt
  4887                                  
  4888                                  c4ue_chk_h:
  4889                                  	; 19/11/2024
  4890 00002238 3C48                    	cmp	al, 'H'
  4891 0000223A 7515                    	jne	short c4ue_chk_cr
  4892 0000223C C605[237D0000]00        	mov	byte [wleds], 0
  4893 00002243 E8A9E6FFFF              	call 	write_ac97_pci_dev_info
  4894                                  	;;;
  4895                                  	;24/12/2024 (wave lighting points option)
  4896 00002248 C605[2F7D0000]01        	mov	byte [p_mode], 1
  4897                                  	;;;
  4898                                  	;mov	dh, 24
  4899                                  	;mov	dl, 79
  4900                                  	;call	setCursorPosition
  4901                                  	; 21/12/2024
  4902 0000224F EB52                    	jmp	short c4ue_cpt
  4903                                  c4ue_chk_cr:
  4904                                  	;;;
  4905                                  	; 24/12/2024 (wave lighting points option)
  4906 00002251 8A25[237D0000]          	mov	ah, [wleds]
  4907 00002257 3C47                    	cmp	al, 'G'
  4908 00002259 7432                    	je	short c4ue_g
  4909                                  	;;;
  4910                                  	; 19/11/2024
  4911 0000225B 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  4912 0000225D 7544                    	jne	short c4ue_cpt
  4913                                  	;inc	byte [wleds]
  4914                                  	;jnz	short c4ue_cpt
  4915                                  	;inc	byte [wleds]
  4916                                  	;;;
  4917                                  	; 24/12/2024
  4918                                  	; 22/12/2024 (faster method)
  4919                                  	; (UpdateWaveLeds procedure turns off previously
  4920                                  	;  lighting wave leds only)
  4921                                  	;call	reset_wave_leds ; prepare all leds as turned off
  4922                                  	;;;
  4923                                  	; 23/11/2024
  4924 0000225F 31DB                    	xor	ebx, ebx
  4925                                  	; 24/12/2024 (wave lighting points option)
  4926 00002261 881D[2F7D0000]          	mov	[p_mode], bl ; 0
  4927                                  	;
  4928                                  	;mov	bl, [wleds]
  4929 00002267 88E3                    	mov	bl, ah ; 24/12/2024
  4930 00002269 FEC3                    	inc	bl
  4931 0000226B 80E30F                  	and	bl, 0Fh
  4932 0000226E 7501                    	jnz	short c4ue_sc
  4933 00002270 43                      	inc	ebx
  4934                                  c4ue_sc:
  4935 00002271 881D[237D0000]          	mov	[wleds], bl
  4936 00002277 D0EB                    	shr	bl, 1
  4937 00002279 8A83[BD3F0000]          	mov	al, [ebx+colors]
  4938                                  	; 24/12/2024
  4939 0000227F A2[C53F0000]            	mov	[ccolor], al
  4940 00002284 7211                    	jc	short c4ue_g_@
  4941                                  	; 24/12/2024
  4942 00002286 E859040000              	call	reset_wave_leds ; prepare all leds as turned off
  4943 0000228B EB16                    	jmp	short c4ue_cpt
  4944                                  	; 24/12/2024
  4945                                  c4ue_g:
  4946 0000228D 08E4                    	or	ah, ah	; byte [wleds]
  4947 0000228F 7506                    	jnz	short c4ue_g_@
  4948 00002291 FE05[237D0000]          	inc	byte [wleds]	; force wave lighting ('G' key)
  4949                                  c4ue_g_@:
  4950                                  	; 24/12/2024 (wave lighting points option)
  4951 00002297 C605[2F7D0000]01        	mov	byte [p_mode], 1
  4952 0000229E E826040000              	call	clear_window
  4953                                  	;;;
  4954                                  c4ue_cpt:
  4955                                  	; 24/12/2024
  4956                                  	; 18/11/2024
  4957 000022A3 59                      	pop	ecx ; *
  4958                                  	;;;
  4959                                  	; 24/12/2024 (skip wave lighting if data is not loaded yet)
  4960 000022A4 803D[B77D0000]00        	cmp	byte [SRB], 0
  4961 000022AB 7751                    	ja	short c4ue_vb_ok
  4962                                  	;;;
  4963                                  	; 01/12/2024 (TRDOS 386)
  4964                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second),
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000022AD BB04000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000022B2 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 000022B7 CD40                <1>  int 40h
  4965                                  	; 24/12/2024
  4966                                  	; 18/11/2024
  4967                                  	;pop	ecx ; *
  4968                                  	; 01/12/2024
  4969 000022B9 3B05[E07D0000]          	cmp	eax, [timerticks]
  4970                                  	;je	short c4ue_ok
  4971                                  	; 18/11/2024
  4972 000022BF 7407                    	je	short c4ue_skip_utt
  4973                                  c4ue_utt:	
  4974                                  	; 01/12/2024
  4975 000022C1 A3[E07D0000]            	mov	[timerticks], eax
  4976 000022C6 EB04                    	jmp	short c4ue_cpt_@
  4977                                  c4ue_skip_utt:
  4978                                  	; 18/11/2024
  4979 000022C8 21C9                    	and	ecx, ecx
  4980 000022CA 7432                    	jz	short c4ue_vb_ok
  4981                                  c4ue_cpt_@:
  4982                                  	; 18/11/2024
  4983 000022CC 803D[207D0000]00        	cmp	byte [stopped], 0
  4984 000022D3 7729                    	ja	short c4ue_vb_ok
  4985                                  	
  4986 000022D5 E8D7010000              	call	CalcProgressTime
  4987                                  
  4988                                  	;cmp	ax, [ProgressTime]
  4989                                  	; 01/12/2024
  4990 000022DA 3B05[D47D0000]          	cmp	eax, [ProgressTime]
  4991                                  	;je	short c4ue_vb_ok
  4992                                  			; same second, no need to update
  4993                                  	; 23/11/2024
  4994 000022E0 7405                    	je	short c4ue_uvb
  4995                                  
  4996                                  	;call	UpdateProgressTime
  4997                                  	;call	UpdateProgressBar@
  4998 000022E2 E8FB020000              	call	UpdateProgressBar
  4999                                  
  5000                                  	; 23/11/2024
  5001                                  c4ue_uvb:
  5002 000022E7 803D[237D0000]00        	cmp	byte [wleds], 0
  5003 000022EE 760E                    	jna	short c4ue_vb_ok
  5004                                  
  5005                                  	; 24/12/2024 (wave points mode)
  5006 000022F0 803D[2F7D0000]00        	cmp	byte [p_mode], 0
  5007 000022F7 7706                    	ja	short c4ue_uwp
  5008                                  
  5009 000022F9 E830040000              	call	UpdateWaveLeds
  5010                                  
  5011                                  c4ue_vb_ok:
  5012 000022FE C3                      	retn
  5013                                  
  5014                                  	; 22/12/2024
  5015                                  c4ue_uwp:
  5016                                  	;call	UpdateWavePoints
  5017                                  	;retn
  5018                                  
  5019                                  ; --------------------------------------------------------
  5020                                  ; 24/12/2024 - Erdogan Tan
  5021                                  ; --------------------------------------------------------
  5022                                  
  5023                                  	; 24/12/2024
  5024                                  UpdateWavePoints:
  5025 000022FF BE[20730000]            	mov	esi, prev_points
  5026 00002304 833E00                  	cmp	dword [esi], 0
  5027 00002307 740B                    	jz	short lights_off_ok
  5028 00002309 B980020000              	mov	ecx, 640
  5029                                  light_off:
  5030 0000230E AD                      	lodsd
  5031                                  	; eax = wave point (lighting point) address
  5032 0000230F C60000                  	mov	byte [eax], 0 ; black point (light off)
  5033 00002312 E2FA                    	loop	light_off	
  5034                                  lights_off_ok:
  5035 00002314 8A15[2D7D0000]          	mov	dl, [half_buffer]
  5036 0000231A 3815[2C7D0000]          	cmp	[pbuf_s], dl
  5037 00002320 7520                    	jne	short lights_on_2
  5038 00002322 8B1D[08730000]          	mov	ebx, [wpoints_dif]
  5039 00002328 8B35[287D0000]          	mov	esi, [pbuf_o]
  5040 0000232E 8B0D[CC7D0000]          	mov	ecx, [buffersize] ; bytes
  5041 00002334 29D9                    	sub	ecx, ebx ; sub ecx, [wpoints_dif]
  5042 00002336 01DE                    	add	esi, ebx
  5043 00002338 7204                    	jc	short lights_on_1
  5044 0000233A 39CE                    	cmp	esi, ecx
  5045 0000233C 760C                    	jna	short lights_on_3
  5046                                  lights_on_1:
  5047 0000233E 89CE                    	mov	esi, ecx
  5048 00002340 EB08                    	jmp	short lights_on_3
  5049                                  
  5050                                  lights_on_2:
  5051 00002342 8815[2C7D0000]          	mov	[pbuf_s], dl
  5052 00002348 31F6                    	xor	esi, esi ; 0
  5053                                  lights_on_3:
  5054 0000234A 8935[287D0000]          	mov	[pbuf_o], esi
  5055                                  	;
  5056 00002350 81C6[00800000]          	add	esi, audio_buffer
  5057 00002356 B980020000              	mov	ecx, 640
  5058 0000235B 89CD                    	mov	ebp, ecx
  5059                                  	; 26/12/2024
  5060                                  	;mov	bl, [ccolor]
  5061 0000235D BF[20730000]            	mov	edi, prev_points
  5062 00002362 8B1D[0C730000]          	mov	ebx, [graphstart] ; start (top) line
  5063                                  lights_on_4:
  5064 00002368 31C0                    	xor	eax, eax ; 0
  5065 0000236A 66AD                    	lodsw	; left
  5066 0000236C 80C480                  	add	ah, 80h
  5067 0000236F 89C2                    	mov	edx, eax
  5068 00002371 66AD                    	lodsw	; right
  5069                                  	;add	ax, dx
  5070 00002373 80C480                  	add	ah, 80h
  5071                                  	;shr	eax, 9	; 128 volume levels
  5072 00002376 01D0                    	add	eax, edx
  5073                                  	;shr	eax, 10	; (L+R/2) & 128 volume levels
  5074 00002378 C1E809                  	shr	eax, 9	; (L+R/2) & 256 volume levels
  5075 0000237B F7E5                    	mul	ebp	; * 640 (row)
  5076 0000237D 01D8                    	add	eax, ebx ; + column
  5077 0000237F 8A15[C53F0000]          	mov	dl, [ccolor]
  5078 00002385 8810                    	mov	[eax], dl ; pixel (light on) color
  5079 00002387 AB                      	stosd		; save light on addr in prev_points
  5080 00002388 43                      	inc	ebx
  5081 00002389 E2DD                    	loop	lights_on_4
  5082 0000238B C3                      	retn
  5083                                  
  5084                                  ; --------------------------------------------------------
  5085                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  5086                                  ; --------------------------------------------------------
  5087                                  
  5088                                  	; 07/12/2024
  5089                                  	; 01/12/2024 (TRDOS 386)
  5090                                  	; 29/11/2024
  5091                                  check4keyboardstop:
  5092                                  	; 19/05/2024
  5093                                  	; 08/11/2023
  5094                                  	; 04/11/2023
  5095 0000238C B401                    	mov	ah, 1
  5096                                  	;int	16h
  5097                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5098 0000238E CD32                    	int	32h
  5099                                  	;clc
  5100 00002390 7433                    	jz	short _cksr
  5101                                  
  5102 00002392 30E4                    	xor	ah, ah
  5103                                  	;int	16h
  5104                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5105 00002394 CD32                    	int	32h
  5106                                  
  5107                                  	;;;
  5108                                  	; 19/05/2024 (change PCM out volume)
  5109 00002396 3C2B                    	cmp	al, '+'
  5110 00002398 750D                    	jne	short p_1
  5111                                  	
  5112 0000239A A0[E3230000]            	mov	al, [volume]
  5113 0000239F 3C00                    	cmp	al, 0
  5114 000023A1 7624                    	jna	short p_3
  5115 000023A3 FEC8                    	dec	al
  5116 000023A5 EB0F                    	jmp	short p_2
  5117                                  p_1:
  5118 000023A7 3C2D                    	cmp	al, '-'
  5119 000023A9 751D                    	jne	short p_4
  5120                                  
  5121 000023AB A0[E3230000]            	mov	al, [volume]
  5122 000023B0 3C1F                    	cmp	al, 31
  5123 000023B2 7313                    	jnb	short p_3
  5124 000023B4 FEC0                    	inc	al
  5125                                  p_2:
  5126 000023B6 A2[E3230000]            	mov	[volume], al
  5127                                  	; 14/11/2024
  5128                                  	;call	SetPCMOutVolume
  5129                                  	; 15/11/2024 (QEMU)
  5130                                  	; 07/12/2024
  5131 000023BB E861E3FFFF              	call	SetMasterVolume
  5132                                  	;call	UpdateVolume
  5133                                  	;;clc
  5134                                  	;retn
  5135 000023C0 E98D010000              	jmp	UpdateVolume
  5136                                  	;mov	ah, al
  5137                                  	;mov    dx, [NAMBAR]
  5138                                    	;;add   dx, CODEC_MASTER_VOL_REG
  5139                                  	;add	dx, CODEC_PCM_OUT_REG
  5140                                  	;out    dx, ax
  5141                                  	;
  5142                                  	;call   delay1_4ms
  5143                                          ;call   delay1_4ms
  5144                                          ;call   delay1_4ms
  5145                                          ;call   delay1_4ms
  5146                                  _cksr:		; 19/05/2024
  5147                                  	; 18/12/2024
  5148 000023C5 31C0                    	xor	eax, eax
  5149                                  	;clc
  5150                                  p_3:
  5151 000023C7 C3                      	retn
  5152                                  p_4:
  5153                                  	; 17/11/2024
  5154 000023C8 80FC01                  	cmp	ah, 01h  ; ESC
  5155 000023CB 7414                        	je	short p_q
  5156                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5157 000023CD 3C03                    	cmp	al, 03h  ; CTRL+C
  5158 000023CF 7410                    	je	short p_q
  5159                                  
  5160                                  	; 18/11/2024
  5161 000023D1 3C20                    	cmp	al, 20h
  5162 000023D3 740D                    	je	short p_r
  5163                                  
  5164                                  	; 19/11/2024
  5165 000023D5 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5166 000023D7 7409                    	je	short p_r
  5167                                  
  5168 000023D9 24DF                    	and	al, 0DFh
  5169                                  
  5170                                  	;cmp	al, 'B'
  5171                                  	;je	short p_r
  5172                                  	;cmp	al, 'F'
  5173                                  	;je	short p_r
  5174                                  
  5175 000023DB 3C51                    	cmp	al, 'Q'
  5176                                  	;je	short p_q
  5177 000023DD 7402                    	je	short p_quit ; 29/11/2024
  5178                                  
  5179 000023DF F8                      	clc
  5180 000023E0 C3                      	retn
  5181                                  
  5182                                  	;;;
  5183                                  ;_cskr:	
  5184                                  p_q:
  5185                                  p_quit:
  5186 000023E1 F9                      	stc
  5187                                  p_r:
  5188 000023E2 C3                      	retn
  5189                                  
  5190                                  ; 29/05/2024
  5191                                  ; 19/05/2024
  5192 000023E3 02                      volume: db	02h
  5193                                  
  5194                                  ; --------------------------------------------------------
  5195                                  
  5196                                  	; 22/12/2024
  5197                                  	; 21/12/2024
  5198                                  	; simulate cursor position in VGA (VESA VBE) mode
  5199                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5200                                  setCursorPosition:
  5201                                  	; dh = Row
  5202                                  	; dl = Column
  5203                                  	
  5204 000023E4 31C0                    	xor	eax, eax
  5205 000023E6 B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5206 000023E8 F6E6                    	mul	dh
  5207 000023EA 6683C007                	add	ax, 7	; top margin
  5208 000023EE C1E010                  	shl	eax, 16
  5209 000023F1 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5210 000023F3 66C1E003                	shl	ax, 3
  5211                                  			; hw = row, ax = column
  5212 000023F7 A3[14730000]            	mov	[screenpos], eax
  5213                                  	; 22/12/2024
  5214 000023FC 31C0                    	xor	eax, eax
  5215 000023FE C3                      	retn
  5216                                  	
  5217                                  ; --------------------------------------------------------
  5218                                  ; 14/11/2024
  5219                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5220                                  
  5221                                  ;; NAME:	SetTotalTime
  5222                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5223                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5224                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5225                                  ;; 		Output on the screen of the total time in seconds
  5226                                  
  5227                                  	; 01/12/2024 (32 bit registers)
  5228                                  SetTotalTime:
  5229                                  	;; Calculate total seconds in file
  5230                                  	;mov	ax, [DATA_SubchunkSize]
  5231                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5232                                  	;mov	bx, [WAVE_SampleRate]
  5233                                  	;div	bx
  5234                                  	;xor	dx, dx
  5235                                  	; 01/12/2024
  5236 000023FF A1[587D0000]            	mov	eax, [DATA_SubchunkSize]
  5237 00002404 0FB71D[487D0000]        	movzx	ebx, word [WAVE_SampleRate]
  5238 0000240B 31D2                    	xor	edx, edx
  5239 0000240D F7F3                    	div	ebx
  5240                                  
  5241                                  	;mov	bx, [WAVE_BlockAlign]
  5242                                  	;div	bx
  5243                                  	; 01/12/2024
  5244 0000240F 668B1D[507D0000]        	mov	bx, [WAVE_BlockAlign]
  5245 00002416 31D2                    	xor	edx, edx
  5246 00002418 F7F3                    	div	ebx
  5247                                  
  5248                                  	;mov	[TotalTime], ax
  5249 0000241A A3[D07D0000]            	mov	[TotalTime], eax
  5250                                  
  5251 0000241F B33C                    	mov	bl, 60
  5252 00002421 F6F3                    	div	bl
  5253                                  
  5254                                  	;; al = minutes, ah = seconds
  5255 00002423 50                      	push	eax ; **
  5256 00002424 50                      	push	eax ; *
  5257                                  
  5258                                  	;mov	dh, 24
  5259                                  	; 21/12/2024 (640*480)
  5260 00002425 B620                    	mov	dh, 32
  5261 00002427 B22A                    	mov	dl, 42
  5262 00002429 E8B6FFFFFF              	call	setCursorPosition
  5263                                  
  5264 0000242E 58                      	pop	eax ; *
  5265 0000242F 30E4                    	xor	ah, ah
  5266 00002431 BD02000000              	mov	ebp, 2
  5267 00002436 E812000000              	call	PrintNumber
  5268                                  	
  5269                                  	;mov	dh, 24
  5270                                  	; 21/12/2024 (640*480)
  5271 0000243B B620                    	mov	dh, 32
  5272 0000243D B22D                    	mov	dl, 45
  5273 0000243F E8A0FFFFFF              	call	setCursorPosition
  5274                                  
  5275 00002444 58                      	pop	eax ; **
  5276 00002445 88E0                    	mov	al, ah
  5277 00002447 30E4                    	xor	ah, ah
  5278                                  	; 21/12/2024
  5279 00002449 66BD0200                	mov	bp, 2
  5280                                  	;jmp	short PrintNumber
  5281                                  
  5282                                  ; --------------------------------------------------------
  5283                                  
  5284                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5285                                  	; 01/12/2024 (32bit registers)
  5286                                  PrintNumber:
  5287                                  	; eax = binary number
  5288                                  	; ebp = digits
  5289 0000244D 8B35[14730000]          	mov	esi, [screenpos]
  5290                                  		; hw = row, si = column
  5291 00002453 BB0A000000              	mov	ebx, 10
  5292 00002458 31C9                    	xor	ecx, ecx
  5293                                  printNumber_CutNumber:
  5294 0000245A 41                      	inc	ecx
  5295 0000245B 31D2                    	xor	edx, edx
  5296 0000245D F7F3                    	div	ebx
  5297 0000245F 52                      	push	edx
  5298 00002460 39E9                    	cmp	ecx, ebp
  5299 00002462 7402                    	je	short printNumber_printloop
  5300 00002464 EBF4                    	jmp	printNumber_CutNumber
  5301                                  
  5302                                  printNumber_printloop:
  5303 00002466 58                      	pop	eax
  5304                                  	; 21/12/2024
  5305                                  	; ebp = count of digits
  5306                                  	; eax <= 9
  5307                                  
  5308 00002467 0430                    	add	al, '0'
  5309                                  	
  5310                                  	; esi = pixel position (hw = row, si = column)
  5311                                  	; eax = al = character
  5312                                  	;call	write_character
  5313                                  	; 22/12/2024
  5314 00002469 E82A010000              	call	write_character_white
  5315                                  
  5316 0000246E 4D                      	dec	ebp
  5317 0000246F 7405                     	jz	short printNumber_ok
  5318 00002471 83C608                  	add	esi, 8	; next column
  5319 00002474 EBF0                    	jmp	short printNumber_printloop
  5320                                  printNumber_ok:
  5321 00002476 C3                      	retn
  5322                                  
  5323                                  ; --------------------------------------------------------
  5324                                  
  5325                                  	; 14/11/2024 - Erdogan Tan
  5326                                  SetProgressTime:
  5327                                  	;; Calculate playing/progress seconds in file
  5328 00002477 E835000000              	call	CalcProgressTime
  5329                                  
  5330                                  	; 01/12/2024 (32bit registers)
  5331                                  UpdateProgressTime:
  5332                                  	; eax = (new) progress time 
  5333                                  
  5334 0000247C A3[D47D0000]            	mov	[ProgressTime], eax
  5335                                  
  5336 00002481 B33C                    	mov	bl, 60
  5337 00002483 F6F3                    	div	bl
  5338                                  
  5339                                  	;; al = minutes, ah = seconds
  5340 00002485 50                      	push	eax ; **
  5341 00002486 50                      	push	eax ; *
  5342                                  
  5343                                  	;mov	dh, 24
  5344                                  	; 21/12/2024 (640*480)
  5345 00002487 B620                    	mov	dh, 32
  5346 00002489 B221                    	mov	dl, 33
  5347 0000248B E854FFFFFF              	call	setCursorPosition
  5348                                  
  5349 00002490 58                      	pop	eax ; *
  5350 00002491 30E4                    	xor	ah, ah
  5351 00002493 BD02000000              	mov	ebp, 2
  5352 00002498 E8B0FFFFFF              	call	PrintNumber
  5353                                  	
  5354                                  	;mov	dh, 24
  5355                                  	; 21/12/2024 (640*480)
  5356 0000249D B620                    	mov	dh, 32
  5357 0000249F B224                    	mov	dl, 36
  5358 000024A1 E83EFFFFFF              	call	setCursorPosition
  5359                                  
  5360 000024A6 58                      	pop	eax ; **
  5361 000024A7 88E0                    	mov	al, ah
  5362 000024A9 30E4                    	xor	ah, ah
  5363                                  	; 21/12/2024
  5364 000024AB 66BD0200                	mov	bp, 2
  5365 000024AF EB9C                    	jmp	short PrintNumber
  5366                                  
  5367                                  ; --------------------------------------------------------
  5368                                  
  5369                                  	; 01/12/2024 (32bit registers)
  5370                                  	; 17/11/2024
  5371                                  	; 14/11/2024
  5372                                  CalcProgressTime:
  5373                                  	;mov	ax, [LoadedDataBytes]
  5374                                  	;mov	dx, [LoadedDataBytes+2]
  5375                                  	;mov	bx, ax
  5376                                  	;or	bx, dx
  5377                                  	;jz	short cpt_ok
  5378                                  	; 01/12/2024
  5379 000024B1 A1[DC7D0000]            	mov	eax, [LoadedDataBytes]
  5380 000024B6 09C0                    	or	eax, eax
  5381 000024B8 7416                    	jz	short cpt_ok
  5382                                  
  5383                                  	;mov	bx, [WAVE_SampleRate]
  5384                                  	;div	bx
  5385                                  	;xor	dx, dx
  5386                                  	;mov	bx, [WAVE_BlockAlign]
  5387                                  	;div	bx
  5388                                  	; 01/12/2024
  5389 000024BA 0FB71D[487D0000]        	movzx	ebx, word [WAVE_SampleRate]
  5390 000024C1 31D2                    	xor	edx, edx
  5391 000024C3 F7F3                    	div	ebx
  5392 000024C5 31D2                    	xor	edx, edx
  5393 000024C7 668B1D[507D0000]        	mov	bx, [WAVE_BlockAlign]
  5394 000024CE F7F3                    	div	ebx
  5395                                  cpt_ok:
  5396                                  	; eax = (new) progress time
  5397 000024D0 C3                      	retn
  5398                                  
  5399                                  ; --------------------------------------------------------
  5400                                  ; 14/11/2024
  5401                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5402                                  
  5403                                  ;; DESCRIPTION: Update file information on template
  5404                                  ;; PARAMS:	WAVE parameters and other variables
  5405                                  ;; REGS:	AX(RW)
  5406                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5407                                  ;; RETURNS:	On-screen file info is updated.
  5408                                  
  5409                                  	; 01/12/2024 (32bit registers)
  5410                                  UpdateFileInfo:
  5411                                  	;; Print File Name
  5412                                  	;mov	dh, 9
  5413                                  	; 21/12/2024 (640*480 graphics display)
  5414 000024D1 B608                    	mov	dh, 8
  5415 000024D3 B217                    	mov	dl, 23
  5416 000024D5 E80AFFFFFF              	call	setCursorPosition
  5417                                  	
  5418 000024DA BE[647D0000]            	mov	esi, wav_file_name
  5419                                  	
  5420                                  	;;;
  5421                                  	; 14/11/2024
  5422                                  	; skip directory separators
  5423                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5424 000024DF 89F3                    	mov	ebx, esi
  5425                                  chk4_nxt_sep:
  5426 000024E1 AC                      	lodsb
  5427 000024E2 3C2F                    	cmp	al, '/'	; 14/12/2024
  5428 000024E4 7406                    	je	short chg_fpos
  5429 000024E6 20C0                    	and	al, al
  5430 000024E8 7406                    	jz	short chg_fpos_ok
  5431 000024EA EBF5                    	jmp	short chk4_nxt_sep
  5432                                  chg_fpos:
  5433 000024EC 89F3                    	mov	ebx, esi
  5434 000024EE EBF1                    	jmp	short chk4_nxt_sep
  5435                                  chg_fpos_ok:
  5436 000024F0 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5437                                  
  5438                                  	;;;
  5439                                  _fnl_chk:
  5440                                  	; 26/12/2024 (file name length limit -display-)
  5441                                  	;mov	ebx, 12
  5442 000024F2 BB11000000              	mov	ebx, 17 ; ????????.wav?????
  5443 000024F7 56                      	push	esi
  5444                                  _fnl_chk_loop:
  5445 000024F8 AC                      	lodsb
  5446 000024F9 20C0                    	and	al, al
  5447 000024FB 7406                    	jz	short _fnl_ok
  5448 000024FD 4B                       	dec	ebx
  5449 000024FE 75F8                    	jnz	short _fnl_chk_loop
  5450 00002500 C60600                  	mov	byte [esi], 0
  5451                                  _fnl_ok:
  5452 00002503 5E                      	pop	esi
  5453                                  	;;;
  5454                                  
  5455 00002504 E870000000              	call	PrintString
  5456                                  	
  5457                                  	;; Print Frequency
  5458                                  	;mov	dh, 10
  5459                                  	; 21/12/2024 (640*480 graphics display)
  5460 00002509 B609                    	mov	dh, 9
  5461 0000250B B217                    	mov	dl, 23
  5462 0000250D E8D2FEFFFF              	call	setCursorPosition
  5463                                  	;movzx	eax, word [WAVE_SampleRate]
  5464                                  	; 22/12/2024
  5465                                  	; eax = 0
  5466 00002512 66A1[487D0000]          	mov	ax, [WAVE_SampleRate]
  5467 00002518 BD05000000              	mov	ebp, 5
  5468 0000251D E82BFFFFFF              	call	PrintNumber
  5469                                  
  5470                                  	;; Print BitRate
  5471                                  	;mov	dh, 9
  5472                                  	; 21/12/2024 (640*480 graphics display)
  5473 00002522 B608                    	mov	dh, 8
  5474 00002524 B239                    	mov	dl, 57
  5475 00002526 E8B9FEFFFF              	call	setCursorPosition
  5476 0000252B 66A1[527D0000]          	mov	ax, [WAVE_BitsPerSample]
  5477 00002531 66BD0200                	mov	bp, 2
  5478 00002535 E813FFFFFF              	call	PrintNumber
  5479                                  
  5480                                  	;; Print Channel Number
  5481                                  	;mov	dh, 10
  5482                                  	; 21/12/2024 (640*480 graphics display)
  5483 0000253A B609                    	mov	dh, 9
  5484 0000253C B239                    	mov	dl, 57
  5485 0000253E E8A1FEFFFF              	call	setCursorPosition
  5486 00002543 66A1[467D0000]          	mov	ax, [WAVE_NumChannels]
  5487 00002549 66BD0100                	mov	bp, 1
  5488 0000254D E8FBFEFFFF              	call	PrintNumber
  5489                                  
  5490                                  	;call	UpdateVolume
  5491                                  	;retn
  5492                                  
  5493                                  ; --------------------------------------------------------
  5494                                  
  5495                                  	; 14/11/2024
  5496                                  UpdateVolume:
  5497                                  	;; Print Volume
  5498                                  	;mov	dh, 24
  5499                                  	; 21/12/2024 (640*480)
  5500 00002552 B620                    	mov	dh, 32
  5501 00002554 B24B                    	mov	dl, 75
  5502 00002556 E889FEFFFF              	call	setCursorPosition
  5503                                  	; 22/12/2024
  5504                                  	; eax = 0
  5505                                  
  5506 0000255B A0[E3230000]            	mov	al, [volume]
  5507                                  
  5508 00002560 B364                    	mov	bl, 100
  5509 00002562 F6E3                    	mul	bl
  5510                                  
  5511 00002564 B31F                    	mov	bl, 31
  5512 00002566 F6F3                    	div	bl
  5513                                  
  5514                                  	;neg	ax
  5515                                  	;add	ax, 100	
  5516                                  	; 01/12/2024
  5517 00002568 B464                    	mov	ah, 100
  5518 0000256A 28C4                    	sub	ah, al
  5519 0000256C 0FB6C4                  	movzx	eax, ah
  5520                                  	;xor	ah, ah
  5521                                  	;mov	bp, 3
  5522 0000256F BD03000000              	mov	ebp, 3
  5523                                  	;call	PrintNumber
  5524                                  	;retn
  5525 00002574 E9D4FEFFFF              	jmp	PrintNumber	
  5526                                  
  5527                                  ; --------------------------------------------------------
  5528                                  
  5529                                  	; 21/12/2024
  5530                                  	; write text in VESA VBE graphics mode
  5531                                  PrintString:
  5532                                  	; esi = string address
  5533                                  printstr_loop:
  5534 00002579 31C0                    	xor	eax, eax
  5535 0000257B AC                      	lodsb
  5536 0000257C 08C0                    	or	al, al
  5537 0000257E 7417                    	jz	short printstr_ok
  5538                                  
  5539 00002580 56                      	push	esi
  5540                                  
  5541 00002581 8B35[14730000]          	mov	esi, [screenpos]
  5542                                  
  5543                                  	; esi = pixel position (hw = row, si = column)
  5544                                  	; eax = al = character
  5545                                  	;call	write_character
  5546                                  	; 22/12/2024
  5547 00002587 E80C000000              	call	write_character_white
  5548                                  
  5549 0000258C 668305[14730000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5550                                  
  5551 00002594 5E                      	pop	esi
  5552 00002595 EBE2                    	jmp	short printstr_loop
  5553                                  
  5554                                  printstr_ok:
  5555 00002597 C3                      	retn
  5556                                  
  5557                                  ; --------------------------------------------------------
  5558                                  
  5559                                  	; 21/12/2024
  5560                                  	; write character (at cursor position)
  5561                                  	; in graphics mode (640*480, 256 colors)
  5562                                  	; 22/12/2024
  5563                                  write_character_white:
  5564 00002598 B90F000000              	mov	ecx, 0Fh
  5565                                  write_character:
  5566                                  	; esi = pixel position (hw = row, si = column)
  5567                                  	; eax = al = character
  5568                                  	; cl = color
  5569 0000259D 890D[18730000]          	mov	[wcolor], ecx ; 22/12/2024
  5570                                  
  5571                                  	; 22/12/2024
  5572 000025A3 50                      	push	eax
  5573                                  	; clear previous character pixels
  5574 000025A4 BF[AD3F0000]            	mov	edi, fillblock
  5575                                  	sys	_video, 020Fh, 0, 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000025A9 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000025AE B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000025B3 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000025B8 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000025BD CD40                <1>  int 40h
  5576 000025BF 58                      	pop	eax
  5577                                  
  5578 000025C0 C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5579 000025C3 BF[C84D0000]            	mov	edi, fontbuff2 ; start of user font data
  5580 000025C8 01C7                    	add	edi, eax
  5581                                  
  5582                                  	; 21/12/2024
  5583                                  	; NOTE:
  5584                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5585                                  	; system calls -in graphics mode-
  5586                                  	; because 8*16 pixel operations are faster
  5587                                  	;			than 8*14 pixel operations.
  5588                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5589                                  	; adding 2 empty lines))
  5590                                  	; (8*14 characters can be written via pixel operations)
  5591                                    	
  5592                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5593                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5594                                  	;sysvideo:
  5595                                  	;   function in BH
  5596                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5597                                  	;   sub function in BL
  5598                                  	;	0Fh: WRITE CHARACTER (FONT)
  5599                                  	;          CL = char's color (8 bit, 256 colors)
  5600                                  	;	If DH bit 7 = 1
  5601                                  	;	   USER FONT (from user buffer)
  5602                                  	;	         DL = 1 -> 8x16 pixel font
  5603                                   	;	   EDI = user's font buffer address
  5604                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5605                                  	;	   ESI = start position (row, column)
  5606                                  	;		(HW = row, SI = column)
  5607                                  	;;;;;;;;;;;;;;;;;
  5608                                  
  5609                                  	sys	_video, 020Fh, [wcolor], 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000025CA BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000025CF 8B0D[18730000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000025D5 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000025DA B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000025DF CD40                <1>  int 40h
  5610                                  
  5611 000025E1 C3                      	retn
  5612                                  
  5613                                  ; --------------------------------------------------------
  5614                                  
  5615                                  	; 22/12/2024
  5616                                  	; 21/12/2024
  5617                                  	; (write chars in VESA VBE graphics mode)
  5618                                  	; 14/11/2024
  5619                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5620                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5621                                  
  5622                                  	;PROGRESSBAR_ROW equ 23
  5623                                  	; 21/12/2024 (640*480)
  5624                                  	PROGRESSBAR_ROW equ 31
  5625                                  
  5626                                  UpdateProgressBar:
  5627 000025E2 E890FEFFFF              	call	SetProgressTime	; 14/11/2024
  5628                                  
  5629                                  	; 01/12/2024 (32bit registers)
  5630 000025E7 A1[D47D0000]            	mov	eax, [ProgressTime]
  5631                                  UpdateProgressBar@:
  5632 000025EC BA50000000              	mov	edx, 80
  5633 000025F1 F7E2                    	mul	edx
  5634 000025F3 8B1D[D07D0000]          	mov	ebx, [TotalTime]
  5635 000025F9 F7F3                    	div	ebx
  5636                                  
  5637                                  	; 22/12/2024
  5638                                  	; check progress bar indicator position if it is same 
  5639 000025FB 3A05[1D730000]          	cmp	al, [pbprev]
  5640 00002601 7430                    	je	short UpdateProgressBar_ok
  5641 00002603 A2[1D730000]            	mov	[pbprev], al
  5642                                  
  5643                                  UpdateProgressBar@@:
  5644                                  	;; Push for the 'Clean' part
  5645 00002608 50                      	push	eax ; **
  5646 00002609 50                      	push	eax ; *
  5647                                  
  5648                                  	;; Set cursor position
  5649 0000260A B61F                    	mov	dh, PROGRESSBAR_ROW
  5650 0000260C B200                    	mov	dl, 0
  5651 0000260E E8D1FDFFFF              	call	setCursorPosition
  5652                                  
  5653 00002613 58                      	pop	eax ; *
  5654 00002614 09C0                    	or	eax, eax
  5655 00002616 742D                    	jz	short UpdateProgressBar_Clean
  5656                                  
  5657                                  UpdateProgressBar_DrawProgress:
  5658                                  	; 22/12/2024
  5659                                  	; 21/12/2024
  5660                                  	; (write progress bar chars in graphics mode)
  5661                                  	;;;;
  5662 00002618 89C5                    	mov	ebp, eax
  5663 0000261A 50                      	push	eax ; ***
  5664 0000261B 8B35[14730000]          	mov	esi, [screenpos]
  5665                                  UpdateProgressBar_DrawProgress_@:
  5666 00002621 B8DF000000              	mov	eax, 223
  5667                                  	
  5668                                  	; esi = pixel position (hw = row, si = column)
  5669                                  	; eax = al = character
  5670                                  	;call	write_character
  5671                                  	; 22/12/2024
  5672 00002626 E86DFFFFFF              	call	write_character_white
  5673                                  
  5674 0000262B 4D                      	dec	ebp
  5675 0000262C 7406                    	jz	short UpdateProgressBar_DrawCursor
  5676                                  
  5677 0000262E 83C608                  	add	esi, 8 ; next column
  5678 00002631 EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5679                                  	;;;
  5680                                  
  5681                                  UpdateProgressBar_ok:
  5682 00002633 C3                      	retn
  5683                                  
  5684                                  UpdateProgressBar_DrawCursor:
  5685                                  	; 22/12/2024
  5686 00002634 5A                      	pop	edx ; ***
  5687 00002635 B61F                    	mov	dh, PROGRESSBAR_ROW
  5688 00002637 E8A8FDFFFF              	call	setCursorPosition
  5689                                  
  5690                                  	; 21/12/2024
  5691                                  	; (write progress bar character in graphics mode)
  5692                                  	;;;;
  5693                                  	;;;mov	eax, 223
  5694                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5695                                  	;;mov	eax, 223*16
  5696                                  	;;mov	edi, fontbuff2 ; start of user font data
  5697                                  	;;add	edi, eax
  5698                                  	;mov	edi, fontbuff2+(223*16)
  5699                                  	;
  5700                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5701                                  	; 22/12/2024
  5702                                  	;mov	eax, 223
  5703                                  	; eax = 0
  5704 0000263C B0DF                    	mov	al, 223
  5705 0000263E B10C                    	mov	cl, 0Ch ; red
  5706 00002640 E858FFFFFF              	call	write_character
  5707                                  	;;;;
  5708                                  
  5709                                  UpdateProgressBar_Clean:
  5710                                  	;pop	eax  ; **
  5711                                  	; 22/12/2024
  5712 00002645 5A                      	pop	edx  ; **
  5713                                  	; 21/12/2024
  5714 00002646 BD50000000              	mov	ebp, 80
  5715                                  	;sub	bp, ax
  5716 0000264B 6629D5                  	sub	bp, dx ; 22/12/2024
  5717 0000264E 74E3                    	jz	short UpdateProgressBar_ok
  5718                                  
  5719 00002650 B61F                    	mov	dh, PROGRESSBAR_ROW
  5720                                  	;mov	dl, al ; 22/12/2024
  5721 00002652 E88DFDFFFF              	call	setCursorPosition
  5722                                  
  5723                                  	; 21/12/2024
  5724                                  	; (write progress bar chars in graphics mode)
  5725                                  	;;;;
  5726 00002657 8B35[14730000]          	mov	esi, [screenpos]
  5727                                  UpdateProgressBar_Clean_@:
  5728                                  	;;;mov	eax, 223
  5729                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5730                                  	;;mov	eax, 223*16
  5731                                  	;mov	edi, fontbuff2 ; start of user font data
  5732                                  	;add	edi, eax
  5733                                  	;mov	edi, fontbuff2+(223*16)
  5734                                  	;
  5735                                  	;sys	_video, 020Fh, 08h, 8001h
  5736                                  	; 22/12/2024
  5737                                  	;mov	eax, 223
  5738                                  	; eax = 0
  5739 0000265D B0DF                    	mov	al, 223
  5740 0000265F B108                    	mov	cl, 08h ; gray (dark)
  5741 00002661 E837FFFFFF              	call	write_character
  5742                                  	;;;;
  5743                                  
  5744 00002666 4D                      	dec	ebp
  5745 00002667 74CA                    	jz	short UpdateProgressBar_ok
  5746                                  
  5747 00002669 83C608                  	add	esi, 8 ; next column
  5748 0000266C EBEF                    	jmp	short UpdateProgressBar_Clean_@
  5749                                  	;;;;
  5750                                  
  5751                                  ; --------------------------------------------------------
  5752                                  ; 17/11/2024
  5753                                  
  5754                                  Player_ProcessKey_Backwards:
  5755                                  	;; In order to go backwards 5 seconds:
  5756                                  	;; Update file pointer to the beginning, skip headers
  5757 0000266E B142                    	mov	cl, 'B'
  5758 00002670 EB02                    	jmp	short Player_ProcessKey_B_or_F
  5759                                  
  5760                                  Player_ProcessKey_Forwards:
  5761                                  	;; In order to fast-forward 5 seconds, set the file pointer
  5762                                  	;; to CUR_SEEK + 5 * Freq
  5763                                  
  5764 00002672 B146                    	mov	cl, 'F'
  5765                                  	;jmp	short Player_ProcessKey_B_or_F
  5766                                  
  5767                                  	; 01/12/2024 (32bit regsisters)
  5768                                  Player_ProcessKey_B_or_F:
  5769                                  	; 17/11/2024
  5770                                  	; 04/11/2024
  5771                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5772                                    
  5773                                  	; 04/11/2024
  5774 00002674 B805000000              	mov	eax, 5
  5775 00002679 0FB71D[507D0000]        	movzx	ebx, word [WAVE_BlockAlign]
  5776 00002680 F7E3                    	mul	ebx
  5777 00002682 668B1D[487D0000]        	mov	bx, [WAVE_SampleRate]
  5778 00002689 F7E3                    	mul	ebx
  5779                                  	; eax = transfer byte count for 5 seconds
  5780                                  	
  5781                                  	; 17/11/2024
  5782 0000268B 80F942                  	cmp	cl, 'B'
  5783                                  	;mov	bx, [LoadedDataBytes]
  5784                                  	;mov	cx, [LoadedDataBytes+2]
  5785                                  	; 01/12/2024
  5786 0000268E 8B0D[DC7D0000]          	mov	ecx, [LoadedDataBytes]
  5787 00002694 7508                    	jne	short move_forward ; cl = 'F'
  5788                                  move_backward:
  5789                                  	;sub	bx, ax
  5790                                  	;sbb	cx, dx
  5791 00002696 29C1                    	sub	ecx, eax
  5792 00002698 7316                    	jnc	short move_file_pointer
  5793                                  move_to_beginning:
  5794                                  	;xor	cx, cx ; 0
  5795                                  	;xor	bx, bx ; 0
  5796 0000269A 31C9                    	xor	ecx, ecx
  5797 0000269C EB12                    	jmp	short move_file_pointer
  5798                                  move_forward: 
  5799                                  	;add	bx, ax
  5800                                  	;adc	cx, dx
  5801 0000269E 01C1                    	add	ecx, eax
  5802 000026A0 7208                    	jc	short move_to_end
  5803                                  	;cmp	cx, [DATA_SubchunkSize+2]
  5804                                  	;ja	short move_to_end
  5805                                  	;jb	short move_file_pointer
  5806                                  	;cmp	bx, [DATA_SubchunkSize]
  5807                                  	;jna	short move_file_pointer
  5808 000026A2 3B0D[587D0000]          	cmp	ecx, [DATA_SubchunkSize]
  5809 000026A8 7606                    	jna	short move_file_pointer
  5810                                  move_to_end:
  5811                                  	;mov	bx, [DATA_SubchunkSize]
  5812                                  	;mov	cx, [DATA_SubchunkSize+2]
  5813 000026AA 8B0D[587D0000]          	mov	ecx, [DATA_SubchunkSize]
  5814                                  move_file_pointer:
  5815                                  	;mov	dx, bx    
  5816                                  	;mov	[LoadedDataBytes], dx
  5817                                  	;mov	[LoadedDataBytes+2], cx
  5818 000026B0 890D[DC7D0000]          	mov	[LoadedDataBytes], ecx
  5819                                  	;add	dx, 44 ; + header
  5820                                  	;adc	cx, 0
  5821 000026B6 83C12C                  	add	ecx, 44 
  5822                                  
  5823                                  	; seek
  5824                                  	;mov	bx, [filehandle]
  5825                                  	;mov	ax, 4200h
  5826                                  	;int	21h
  5827                                  	; 01/12/2024
  5828 000026B9 31D2                    	xor	edx, edx ; offset from beginning of the file
  5829                                  	; ecx = offset	
  5830                                  	; ebx = file handle
  5831                                  	; edx = 0
  5832                                  	sys	_seek, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000026BB 8B1D[607D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000026C1 B813000000          <1>  mov eax, %1
    97                              <1> 
    98 000026C6 CD40                <1>  int 40h
  5833 000026C8 C3                      	retn
  5834                                  
  5835                                  ; --------------------------------------------------------
  5836                                  
  5837                                  	; 25/12/2024
  5838                                  	; 22/12/2024 (VESA VBE mode graphics) 
  5839                                  	; (640*480, 256 colors)
  5840                                  clear_window:
  5841 000026C9 8B3D[10730000]          	mov	edi, [LFB_ADDR]
  5842                                  	;add	edi, (13*80*8*14)
  5843                                  	; 25/12/2024
  5844 000026CF 81C7009A0100            	add	edi, 164*640
  5845 000026D5 29C0                    	sub	eax, eax
  5846                                  	;mov	ecx, (16*640*14)/4 ; 16 rows
  5847 000026D7 B900A00000              	mov	ecx, 64*640 ; 256 volume level points
  5848 000026DC F3AB                    	rep	stosd
  5849                                  	; 24/12/2024
  5850 000026DE A3[20730000]            	mov	[prev_points], eax ; 0
  5851                                  	;
  5852 000026E3 C3                      	retn
  5853                                  
  5854                                  ; --------------------------------------------------------
  5855                                  
  5856                                  	; 22/12/2024
  5857                                  	; 21/12/2024
  5858                                  	; (simulate wave leds in graphics mode)
  5859                                  	; (640*480, 256 colors)
  5860                                  reset_wave_leds:
  5861                                  	; 22/12/2024
  5862 000026E4 C705[C8710000]0000-     	mov	dword [prev_leds], 0
  5862 000026EC 0000               
  5863                                  	;
  5864 000026EE BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  5865 000026F3 BE[C85D0000]            	mov	esi, wleds_addr
  5866                                  next_led:
  5867 000026F8 AD                      	lodsd
  5868 000026F9 89C7                    	mov	edi, eax
  5869 000026FB BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  5870 00002700 BB[A85D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5871                                  led_line:
  5872 00002705 8A23                    	mov	ah, [ebx]
  5873 00002707 B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  5874                                  next_pixel:
  5875 0000270C D0E4                    	shl	ah, 1
  5876 0000270E 7308                    	jnc	short skip_this
  5877 00002710 B008                    	mov	al, 8 ; gray
  5878 00002712 AA                      	stosb
  5879 00002713 49                      	dec	ecx
  5880 00002714 75F6                    	jnz	short next_pixel
  5881 00002716 EB06                    	jmp	short next_line
  5882                                  skip_this:
  5883 00002718 B000                    	mov	al, 0 ; black
  5884 0000271A AA                      	stosb
  5885 0000271B 49                      	dec	ecx
  5886 0000271C 75EE                    	jnz	short next_pixel
  5887                                  next_line:
  5888 0000271E 4A                      	dec	edx
  5889 0000271F 7504                    	jnz	short next_line_@
  5890 00002721 4D                      	dec	ebp
  5891 00002722 75D4                    	jnz	short next_led
  5892                                  	;clc	; 25/12/2024
  5893 00002724 C3                      	retn
  5894                                  next_line_@:
  5895                                  	; 22/12/2024
  5896 00002725 81C778020000            	add	edi, 640-8 ; next line
  5897 0000272B 43                      	inc	ebx
  5898 0000272C EBD7                    	jmp	short led_line	
  5899                                  
  5900                                  ; --------------------------------------------------------
  5901                                  
  5902                                  	; 22/12/2024 (graphics mode)
  5903                                  	; 09/12/2024
  5904                                  	; 19/11/2024
  5905                                  UpdateWaveLeds:
  5906                                  	; 23/11/2024
  5907                                  	;call	reset_wave_leds
  5908                                  	; 22/12/2024 (faster method, 80 against 80*16)
  5909                                  	; turn off previously lighting wave leds at first
  5910                                  	;;;
  5911 0000272E BE[C8710000]            	mov	esi, prev_leds
  5912 00002733 833E00                  	cmp	dword [esi], 0
  5913 00002736 7433                    	jz	short UpdateWaveLeds_ok
  5914 00002738 B950000000              	mov	ecx, 80
  5915                                  turn_off_led:
  5916 0000273D AD                      	lodsd
  5917 0000273E 89C7                    	mov	edi, eax
  5918                                  	; edi = wave led address
  5919 00002740 BD0E000000              	mov	ebp, 14
  5920 00002745 BB[A85D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5921 0000274A 31D2                    	xor	edx, edx
  5922 0000274C B008                    	mov	al, 8 ; gray (dark)
  5923                                  toffl_next_line:
  5924                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5925                                  	;mov	dl, 8
  5926 0000274E 88C2                    	mov	dl, al ; 8
  5927 00002750 8A23                    	mov	ah, [ebx]
  5928                                  toffl_next_pixel:
  5929 00002752 D0E4                    	shl	ah, 1
  5930 00002754 7310                    	jnc	short toffl_skip_this
  5931 00002756 AA                      	stosb
  5932                                  toffl_next_pixel_@:
  5933 00002757 4A                      	dec	edx
  5934 00002758 75F8                    	jnz	short toffl_next_pixel
  5935 0000275A 4D                      	dec	ebp
  5936 0000275B 740C                    	jz	short toffl_next_led
  5937 0000275D 81C778020000            	add	edi, 640-8 ; next line
  5938 00002763 43                      	inc	ebx
  5939 00002764 EBE8                    	jmp	short toffl_next_line
  5940                                  toffl_skip_this:
  5941 00002766 47                      	inc	edi
  5942 00002767 EBEE                    	jmp	short toffl_next_pixel_@
  5943                                  toffl_next_led:
  5944 00002769 E2D2                    	loop	turn_off_led
  5945                                  UpdateWaveLeds_ok:
  5946                                  	;;;
  5947                                  	; 09/12/2024
  5948                                  	;jmp	short turn_on_leds
  5949                                  
  5950                                  ; --------------------------------------------------------
  5951                                  
  5952                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  5953                                  	; 09/12/2024
  5954                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  5955                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  5956                                  	; 21/11/2024, 22/11/2024
  5957                                  	; 19/11/2024
  5958                                  turn_on_leds:
  5959                                  	; 09/12/2024
  5960                                  	; 07/12/2024
  5961 0000276B 8A15[2D7D0000]          	mov	dl, [half_buffer]
  5962                                  tol_@:
  5963                                  	; 07/12/2024
  5964 00002771 3815[2C7D0000]          	cmp	[pbuf_s], dl
  5965 00002777 7520                    	jne	short tol_ns_buf
  5966 00002779 8B1D[247D0000]          	mov	ebx, [wleds_dif]
  5967 0000277F 8B35[287D0000]          	mov	esi, [pbuf_o]
  5968 00002785 8B0D[CC7D0000]          	mov	ecx, [buffersize] ; bytes
  5969 0000278B 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  5970 0000278D 01DE                    	add	esi, ebx
  5971 0000278F 7204                    	jc	short tol_o_@
  5972 00002791 39CE                    	cmp	esi, ecx
  5973 00002793 760C                    	jna	short tol_s_buf
  5974                                  tol_o_@:
  5975 00002795 89CE                    	mov	esi, ecx
  5976 00002797 EB08                    	jmp	short tol_s_buf
  5977                                  
  5978                                  tol_ns_buf:
  5979 00002799 8815[2C7D0000]          	mov	[pbuf_s], dl
  5980 0000279F 31F6                    	xor	esi, esi ; 0
  5981                                  tol_s_buf:
  5982 000027A1 8935[287D0000]          	mov	[pbuf_o], esi
  5983                                  
  5984                                  tol_buf_@:
  5985                                  	; 07/12/2024
  5986 000027A7 81C6[00800000]          	add	esi, audio_buffer
  5987 000027AD B950000000              	mov	ecx, 80
  5988                                  	;xor	eax, eax ; 0
  5989 000027B2 BB[C85D0000]            	mov	ebx, wleds_addr
  5990                                  	; 22/12/2024
  5991 000027B7 BF[C8710000]            	mov	edi, prev_leds
  5992                                  tol_fill_c:
  5993 000027BC 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  5994 000027BE 66AD                    	lodsw	; left
  5995 000027C0 80C480                  	add	ah, 80h	; 24/12/2024
  5996 000027C3 89C2                    	mov	edx, eax
  5997 000027C5 66AD                    	lodsw	; right
  5998                                  	;add	ax, dx
  5999 000027C7 80C480                  	add	ah, 80h
  6000                                  	;; 21/12/2024 (16 volume levels)
  6001                                  	;shr	eax, 12
  6002                                  	; 24/12/2024
  6003 000027CA 01D0                    	add	eax, edx
  6004 000027CC C1E80D                  	shr	eax, 13	; (L+R/2) & 16 volume levels
  6005                                  
  6006 000027CF 53                      	push	ebx ; *
  6007                                  	; 01/12/2024
  6008 000027D0 C1E002                  	shl	eax, 2
  6009 000027D3 01C3                    	add	ebx, eax
  6010                                  	; 01/12/2024 (32bit address)
  6011                                  	;mov	edi, [ebx]
  6012                                  	; 22/12/2024
  6013 000027D5 8B03                    	mov	eax, [ebx]
  6014 000027D7 AB                      	stosd
  6015 000027D8 57                      	push	edi ; **
  6016 000027D9 89C7                    	mov	edi, eax
  6017                                  	;;;
  6018                                  	; 21/12/2024
  6019                                  	; (simulate wave leds in graphics mode)
  6020                                  	; (640*480, 256 colors)
  6021                                  turn_on_led:
  6022                                  	; edi = wave led address
  6023 000027DB BD0E000000              	mov	ebp, 14
  6024 000027E0 BB[A85D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6025 000027E5 A0[C53F0000]            	mov	al, [ccolor]
  6026                                  tol_next_line:
  6027 000027EA BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6028 000027EF 8A23                    	mov	ah, [ebx]
  6029                                  tol_next_pixel:
  6030 000027F1 D0E4                    	shl	ah, 1
  6031 000027F3 7310                    	jnc	short tol_skip_this
  6032 000027F5 AA                      	stosb
  6033                                  tol_next_pixel_@:
  6034 000027F6 4A                      	dec	edx
  6035 000027F7 75F8                    	jnz	short tol_next_pixel
  6036 000027F9 4D                      	dec	ebp
  6037 000027FA 740C                    	jz	short tol_next_led
  6038                                  	; 22/12/2024
  6039 000027FC 81C778020000            	add	edi, 640-8 ; next line
  6040 00002802 43                      	inc	ebx
  6041 00002803 EBE5                    	jmp	short tol_next_line
  6042                                  tol_skip_this:
  6043 00002805 47                      	inc	edi
  6044 00002806 EBEE                    	jmp	short tol_next_pixel_@
  6045                                  tol_next_led:
  6046                                  	; 22/12/2024
  6047 00002808 5F                      	pop	edi ; **
  6048                                  	;;;
  6049 00002809 5B                      	pop	ebx ; *
  6050 0000280A 83C340                  	add	ebx, 16*4
  6051 0000280D E2AD                    	loop	tol_fill_c
  6052                                  
  6053 0000280F C3                      	retn
  6054                                  
  6055                                  ; -------------------------------------------------------------
  6056                                  
  6057                                  ; -------------------------------------------------------------
  6058                                  ; ac97.inc (11/11/2023)
  6059                                  ; -------------------------------------------------------------
  6060                                  
  6061                                  ; special characters
  6062                                  LF      EQU 10
  6063                                  CR      EQU 13
  6064                                  
  6065                                  ; PCI stuff
  6066                                  
  6067                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  6068                                  
  6069                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  6070                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6071                                  SIS_VID		equ	1039h
  6072                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  6073                                  AMD_VID		equ	1022h
  6074                                  
  6075                                  ICH_DID         equ     2415h           ; ICH device ID
  6076                                  ICH0_DID        equ     2425h           ; ICH0
  6077                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  6078                                                                          ; they all should be compatible.
  6079                                  
  6080                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  6081                                  ICH3_DID	equ     2485h           ; ICH3
  6082                                  ICH4_DID        equ     24C5h           ; ICH4
  6083                                  ICH5_DID	equ     24D5h           ; ICH5
  6084                                  ICH6_DID	equ     266Eh           ; ICH6
  6085                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  6086                                  ESB631X_DID	equ     2698h           ; 631XESB
  6087                                  ICH7_DID	equ	27DEh		; ICH7
  6088                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6089                                  MX82440_DID	equ	7195h
  6090                                  SI7012_DID	equ	7012h
  6091                                  NFORCE_DID	equ	01B1h
  6092                                  NFORCE2_DID	equ	006Ah
  6093                                  AMD8111_DID	equ	746Dh
  6094                                  AMD768_DID	equ	7445h
  6095                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  6096                                  CK804_DID	equ	0059h
  6097                                  MCP04_DID	equ	003Ah
  6098                                  CK8_DID		equ	008Ah
  6099                                  NFORCE3_DID	equ	00DAh
  6100                                  CK8S_DID	equ	00EAh
  6101                                  
  6102                                  ; -------------------------------------------------------------
  6103                                  
  6104                                  ; 22/12/2024
  6105                                  align 4
  6106                                  
  6107                                  ; 13/11/2024
  6108                                  ; ('<<' to 'shl' conversion for FASM)
  6109                                  ;
  6110                                  ; 29/05/2024 (TRDOS 386)
  6111                                  ; 17/02/2017
  6112                                  ; Valid ICH device IDs
  6113                                  
  6114                                  valid_ids:
  6115                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  6116 00002810 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  6117 00002814 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  6118 00002818 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  6119 0000281C 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  6120 00002820 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  6121 00002824 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  6122 00002828 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  6123 0000282C 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  6124 00002830 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  6125 00002834 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  6126                                  	; 03/11/2023 - Erdogan Tan
  6127 00002838 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  6128 0000283C 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  6129 00002840 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  6130 00002844 DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  6131 00002848 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  6132 0000284C 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  6133 00002850 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  6134 00002854 DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  6135 00002858 DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  6136 0000285C DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  6137 00002860 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  6138                                  
  6139                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  6140                                  ; 13/11/2024
  6141                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  6142                                  
  6143 00002864 00000000                	dd 0
  6144                                  
  6145                                  Credits:
  6146 00002868 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  6146 00002871 6C6179657220666F72-
  6146 0000287A 205452444F53203338-
  6146 00002883 36206279204572646F-
  6146 0000288C 67616E2054616E2E20 
  6147                                  	;db 'December 2024.', 10,13,0
  6148 00002895 4A616E756172792032-     	db 'January 2025.', 10,13,0
  6148 0000289E 3032352E0A0D00     
  6149                                  	;db '26/12/2024', 10,13
  6150 000028A5 31382F30312F323032-     	db '18/01/2025', 10,13
  6150 000028AE 350A0D             
  6151                                  ; 15/11/2024
  6152                                  reset:
  6153 000028B1 00                      	db 0
  6154                                  
  6155                                  msgAudioCardInfo:
  6156 000028B2 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  6156 000028BB 204143393720284943-
  6156 000028C4 482920417564696F20-
  6156 000028CD 436F6E74726F6C6C65-
  6156 000028D6 722E0A0D00         
  6157                                  
  6158                                  	; 21/12/2024
  6159                                  msg_usage:
  6160 000028DB 75736167653A206470-     	db 'usage: dplaywav filename.wav',10,13,0
  6160 000028E4 6C6179776176206669-
  6160 000028ED 6C656E616D652E7761-
  6160 000028F6 760A0D00           
  6161                                  
  6162                                  noDevMsg:
  6163 000028FA 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  6163 00002903 61626C6520746F2066-
  6163 0000290C 696E64204143393720-
  6163 00002915 617564696F20646576-
  6163 0000291E 69636521           
  6164 00002922 0A0D00                  	db 10,13,0
  6165                                  
  6166                                  noFileErrMsg:
  6167 00002925 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  6167 0000292E 6C65206E6F7420666F-
  6167 00002937 756E642E0A0D00     
  6168                                  
  6169                                  ; 07/12/2024
  6170                                  trdos386_err_msg:
  6171 0000293E 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  6171 00002947 2053797374656D2063-
  6171 00002950 616C6C206572726F72-
  6171 00002959 20210A0D00         
  6172                                  
  6173                                  ; 29/05/2024
  6174                                  ; 11/11/2023
  6175                                  msg_init_err:
  6176 0000295E 0D0A                    	db CR, LF
  6177 00002960 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6177 00002969 726F6C6C65722F436F-
  6177 00002972 64656320696E697469-
  6177 0000297B 616C697A6174696F6E-
  6177 00002984 206572726F722021   
  6178 0000298C 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6179                                  
  6180                                  ; 25/11/2023
  6181                                  msg_no_vra:
  6182 0000298F 0A0D                    	db 10,13
  6183 00002991 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6183 0000299A 70706F72742021204F-
  6183 000029A3 6E6C79203438206B48-
  6183 000029AC 5A2073616D706C6520-
  6183 000029B5 726174652073757070-
  6183 000029BE 6F727465642021     
  6184 000029C5 0A0D00                  	db 10,13,0
  6185                                  
  6186                                  ; 19/11/2024
  6187                                  ; 03/06/2017
  6188                                  hex_chars:
  6189 000029C8 303132333435363738-     	db '0123456789ABCDEF', 0
  6189 000029D1 3941424344454600   
  6190                                  msgAC97Info:
  6191 000029D9 0D0A                    	db 0Dh, 0Ah
  6192 000029DB 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6192 000029E4 696F20436F6E74726F-
  6192 000029ED 6C6C6572202620436F-
  6192 000029F6 64656320496E666F0D-
  6192 000029FF 0A                 
  6193 00002A00 2056656E646F722049-     	db ' Vendor ID: '
  6193 00002A09 443A20             
  6194                                  msgVendorId:
  6195 00002A0C 303030306820446576-     	db '0000h Device ID: '
  6195 00002A15 6963652049443A20   
  6196                                  msgDevId:
  6197 00002A1D 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6198 00002A24 204275733A20            	db ' Bus: '
  6199                                  msgBusNo:
  6200 00002A2A 303068204465766963-     	db '00h Device: '
  6200 00002A33 653A20             
  6201                                  msgDevNo:
  6202 00002A36 3030682046756E6374-     	db '00h Function: '
  6202 00002A3F 696F6E3A20         
  6203                                  msgFncNo:
  6204 00002A44 303068                  	db '00h'
  6205 00002A47 0D0A                    	db 0Dh, 0Ah
  6206 00002A49 204E414D4241523A20      	db ' NAMBAR: '
  6207                                  msgNamBar:
  6208 00002A52 30303030682020          	db '0000h  '
  6209 00002A59 4E41424D4241523A20      	db 'NABMBAR: '
  6210                                  msgNabmBar:
  6211 00002A62 303030306820204952-     	db '0000h  IRQ: '
  6211 00002A6B 513A20             
  6212                                  msgIRQ:
  6213 00002A6E 3030                    	dw 3030h
  6214 00002A70 0D0A00                  	db 0Dh, 0Ah, 0
  6215                                  ; 25/11/2023
  6216                                  msgVRAheader:
  6217 00002A73 205652412073757070-     	db ' VRA support: '
  6217 00002A7C 6F72743A20         
  6218 00002A81 00                      	db 0	
  6219                                  msgVRAyes:
  6220 00002A82 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6221                                  msgVRAno:
  6222 00002A88 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6223 00002A8D 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6223 00002A96 6C617465642073616D-
  6223 00002A9F 706C65207261746520-
  6223 00002AA8 706C6179696E67206D-
  6223 00002AB1 6574686F6429       
  6224 00002AB7 0D0A00                  	db 0Dh, 0Ah, 0
  6225                                  
  6226 00002ABA 90<rep 2h>              align 4
  6227                                  
  6228                                  ; -------------------------------------------------------------
  6229                                  
  6230                                  	; 21/12/2024
  6231                                  SplashScreen:
  6232 00002ABC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6232 00002AC5 202020202020202020-
  6232 00002ACE 202020202020202020-
  6232 00002AD7 202020202020202020-
  6232 00002AE0 202020202020202020-
  6232 00002AE9 202020202020202020-
  6232 00002AF2 202020202020202020-
  6232 00002AFB 202020202020202020-
  6232 00002B04 2020202020DDDBDE   
  6233 00002B0C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6233 00002B15 202020202020202020-
  6233 00002B1E 202020202020202020-
  6233 00002B27 202020202020202020-
  6233 00002B30 202020202020202020-
  6233 00002B39 202020202020202020-
  6233 00002B42 202020202020202020-
  6233 00002B4B 202020202020202020-
  6233 00002B54 2020202020DDDBDE   
  6234 00002B5C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6234 00002B65 202020202020202020-
  6234 00002B6E 202020202020202020-
  6234 00002B77 202020202020202020-
  6234 00002B80 202020202020202020-
  6234 00002B89 202020202020202020-
  6234 00002B92 202020202020202020-
  6234 00002B9B 202020202020202020-
  6234 00002BA4 2020202020DDDBDE   
  6235 00002BAC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6235 00002BB5 202020202020202020-
  6235 00002BBE 202020202020202020-
  6235 00002BC7 202020202020202020-
  6235 00002BD0 202020202020202020-
  6235 00002BD9 202020202020202020-
  6235 00002BE2 202020202020202020-
  6235 00002BEB 202020202020202020-
  6235 00002BF4 2020202020DDDBDE   
  6236 00002BFC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6236 00002C05 202020202020202020-
  6236 00002C0E 202020202020202020-
  6236 00002C17 202020202020202020-
  6236 00002C20 202020202020202020-
  6236 00002C29 202020202020202020-
  6236 00002C32 202020202020202020-
  6236 00002C3B 202020202020202020-
  6236 00002C44 2020202020DDDBDE   
  6237 00002C4C DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6237 00002C55 202020202020202020-
  6237 00002C5E 2020202020205F5F5F-
  6237 00002C67 5F5F5F5F2020205F5F-
  6237 00002C70 5F5F5F5F2020202020-
  6237 00002C79 2020205F5F5F5F5F5F-
  6237 00002C82 5F2E20202020202020-
  6237 00002C8B 202020202020202020-
  6237 00002C94 2020202020DDDBDE   
  6238 00002C9C DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6238 00002CA5 202020202020202020-
  6238 00002CAE 20202020207C202020-
  6238 00002CB7 202020205C202F2020-
  6238 00002CC0 5F5F20205C20202020-
  6238 00002CC9 20202F202020202020-
  6238 00002CD2 207C20202020202020-
  6238 00002CDB 202020202020202020-
  6238 00002CE4 2020202020DDDBDE   
  6239 00002CEC DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6239 00002CF5 202020202020202020-
  6239 00002CFE 20202020207C20202E-
  6239 00002D07 2D2D2E20207C20207C-
  6239 00002D10 20207C20207C202020-
  6239 00002D19 207C202020282D2D2D-
  6239 00002D22 2D6020202020202020-
  6239 00002D2B 202020202020202020-
  6239 00002D34 2020202020DDDBDE   
  6240 00002D3C DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6240 00002D45 202020202020202020-
  6240 00002D4E 20202020207C20207C-
  6240 00002D57 20207C20207C20207C-
  6240 00002D60 20207C20207C202020-
  6240 00002D69 20205C2020205C2020-
  6240 00002D72 202020202020202020-
  6240 00002D7B 202020202020202020-
  6240 00002D84 2020202020DDDBDE   
  6241 00002D8C DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6241 00002D95 202020202020202020-
  6241 00002D9E 20202020207C202027-
  6241 00002DA7 2D2D2720207C202060-
  6241 00002DB0 2D2D2720207C202E2D-
  6241 00002DB9 2D2D2D292020207C20-
  6241 00002DC2 202020202020202020-
  6241 00002DCB 202020202020202020-
  6241 00002DD4 2020202020DDDBDE   
  6242 00002DDC DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6242 00002DE5 202020202020202020-
  6242 00002DEE 20202020207C5F5F5F-
  6242 00002DF7 5F5F5F5F2F205C5F5F-
  6242 00002E00 5F5F5F5F2F20207C5F-
  6242 00002E09 5F5F5F5F5F5F2F2020-
  6242 00002E12 202020202020202020-
  6242 00002E1B 202020202020202020-
  6242 00002E24 2020202020DDDBDE   
  6243 00002E2C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6243 00002E35 202020202020202020-
  6243 00002E3E 202020202020202020-
  6243 00002E47 202020202020202020-
  6243 00002E50 202020202020202020-
  6243 00002E59 202020202020202020-
  6243 00002E62 202020202020202020-
  6243 00002E6B 202020202020202020-
  6243 00002E74 2020202020DDDBDE   
  6244 00002E7C DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6244 00002E85 5F5F5F5F5F5F202020-
  6244 00002E8E 205F5F202020202020-
  6244 00002E97 202020205F5F5F2020-
  6244 00002EA0 205F5F5F5F20202020-
  6244 00002EA9 5F5F5F5F20205F5F5F-
  6244 00002EB2 5F5F5F5F202E5F5F5F-
  6244 00002EBB 5F5F5F202020202020-
  6244 00002EC4 2020202020DDDBDE   
  6245 00002ECC DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6245 00002ED5 2020205F20205C2020-
  6245 00002EDE 7C20207C2020202020-
  6245 00002EE7 2020202F2020205C20-
  6245 00002EF0 205C2020205C20202F-
  6245 00002EF9 2020202F207C202020-
  6245 00002F02 5F5F5F5F7C7C202020-
  6245 00002F0B 5F20205C2020202020-
  6245 00002F14 2020202020DDDBDE   
  6246 00002F1C DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6246 00002F25 20207C5F2920207C20-
  6246 00002F2E 7C20207C2020202020-
  6246 00002F37 20202F20205E20205C-
  6246 00002F40 20205C2020205C2F20-
  6246 00002F49 20202F20207C20207C-
  6246 00002F52 5F5F2020207C20207C-
  6246 00002F5B 5F2920207C20202020-
  6246 00002F64 2020202020DDDBDE   
  6247 00002F6C DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6247 00002F75 2020205F5F5F2F2020-
  6247 00002F7E 7C20207C2020202020-
  6247 00002F87 202F20202F5F5C2020-
  6247 00002F90 5C20205C5F20202020-
  6247 00002F99 5F2F2020207C202020-
  6247 00002FA2 5F5F7C20207C202020-
  6247 00002FAB 2020202F2020202020-
  6247 00002FB4 2020202020DDDBDE   
  6248 00002FBC DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6248 00002FC5 20207C202020202020-
  6248 00002FCE 7C2020602D2D2D2D2E-
  6248 00002FD7 2F20205F5F5F5F5F20-
  6248 00002FE0 205C2020207C20207C-
  6248 00002FE9 20202020207C20207C-
  6248 00002FF2 5F5F5F5F207C20207C-
  6248 00002FFB 5C20205C2D2D2D2D2E-
  6248 00003004 2020202020DDDBDE   
  6249 0000300C DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6249 00003015 205F7C202020202020-
  6249 0000301E 7C5F5F5F5F5F5F5F2F-
  6249 00003027 5F5F2F20202020205C-
  6249 00003030 5F5F5C20207C5F5F7C-
  6249 00003039 20202020207C5F5F5F-
  6249 00003042 5F5F5F5F7C7C205F7C-
  6249 0000304B 20602E5F5F5F5F5F7C-
  6249 00003054 2020202020DDDBDE   
  6250 0000305C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6250 00003065 202020202020202020-
  6250 0000306E 202020202020202020-
  6250 00003077 202020202020202020-
  6250 00003080 202020202020202020-
  6250 00003089 202020202020202020-
  6250 00003092 202020202020202020-
  6250 0000309B 202020202020202020-
  6250 000030A4 2020202020DDDBDE   
  6251 000030AC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6251 000030B5 202020202020202020-
  6251 000030BE 202020202020202020-
  6251 000030C7 202020202020202020-
  6251 000030D0 202020202020202020-
  6251 000030D9 202020202020202020-
  6251 000030E2 202020202020202020-
  6251 000030EB 202020202020202020-
  6251 000030F4 2020202020DDDBDE   
  6252 000030FC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6252 00003105 202020202020202020-
  6252 0000310E 202020202020202020-
  6252 00003117 202020202020202020-
  6252 00003120 202020202020202020-
  6252 00003129 202020202020202020-
  6252 00003132 202020202020202020-
  6252 0000313B 202020202020202020-
  6252 00003144 2020202020DDDBDE   
  6253 0000314C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6253 00003155 202020202020202020-
  6253 0000315E 202020202020202020-
  6253 00003167 202020202020202020-
  6253 00003170 202020202020202020-
  6253 00003179 202020202020202020-
  6253 00003182 202020202020202020-
  6253 0000318B 202020202020202020-
  6253 00003194 2020202020DDDBDE   
  6254 0000319C DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6254 000031A5 202020202020202020-
  6254 000031AE 202020202020202020-
  6254 000031B7 202020202020202057-
  6254 000031C0 454C434F4D4520544F-
  6254 000031C9 202020202020202020-
  6254 000031D2 202020202020202020-
  6254 000031DB 202020202020202020-
  6254 000031E4 2020202020DDDBDE   
  6255 000031EC DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6255 000031F5 202020202020202020-
  6255 000031FE 202020202020202020-
  6255 00003207 202020202020202044-
  6255 00003210 4F5320504C41594552-
  6255 00003219 202020202020202020-
  6255 00003222 202020202020202020-
  6255 0000322B 202020202020202020-
  6255 00003234 2020202020DDDBDE   
  6256 0000323C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6256 00003245 202020202020202020-
  6256 0000324E 202020202020202020-
  6256 00003257 202020202020202020-
  6256 00003260 202020202020202020-
  6256 00003269 202020202020202020-
  6256 00003272 202020202020202020-
  6256 0000327B 202020202020202020-
  6256 00003284 2020202020DDDBDE   
  6257 0000328C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6257 00003295 202020202020202020-
  6257 0000329E 202020202020202020-
  6257 000032A7 202020202020202020-
  6257 000032B0 202020202020202020-
  6257 000032B9 202020202020202020-
  6257 000032C2 202020202020202020-
  6257 000032CB 202020202020202020-
  6257 000032D4 2020202020DDDBDE   
  6258 000032DC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6258 000032E5 202020202020202020-
  6258 000032EE 202020202020202020-
  6258 000032F7 202020202020202020-
  6258 00003300 202020202020202020-
  6258 00003309 202020202020202020-
  6258 00003312 202020202020202020-
  6258 0000331B 202020202020202020-
  6258 00003324 2020202020DDDBDE   
  6259 0000332C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6259 00003335 202020202020202020-
  6259 0000333E 202020202020202020-
  6259 00003347 202020202020202020-
  6259 00003350 202020202020202020-
  6259 00003359 202020202020202020-
  6259 00003362 202020202020202020-
  6259 0000336B 202020202020202020-
  6259 00003374 2020202020DDDBDE   
  6260 0000337C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6260 00003385 202020202020202020-
  6260 0000338E 202020202020202020-
  6260 00003397 202020202020202020-
  6260 000033A0 202020202020202020-
  6260 000033A9 202020202020202020-
  6260 000033B2 202020202020202020-
  6260 000033BB 202020202020202020-
  6260 000033C4 2020202020DDDBDE   
  6261 000033CC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6261 000033D5 202020202020202020-
  6261 000033DE 202020202020202020-
  6261 000033E7 202020202020202020-
  6261 000033F0 202020202020202020-
  6261 000033F9 202020202020202020-
  6261 00003402 202020202020202020-
  6261 0000340B 202020202020202020-
  6261 00003414 2020202020DDDBDE   
  6262 0000341C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6262 00003425 202020202020202020-
  6262 0000342E 202020202020202020-
  6262 00003437 202020202020202020-
  6262 00003440 202020202020202020-
  6262 00003449 202020202020202020-
  6262 00003452 202020202020202020-
  6262 0000345B 202020202020202020-
  6262 00003464 2020202020DDDBDE   
  6263 0000346C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6263 00003475 202020202020202020-
  6263 0000347E 202020202020202020-
  6263 00003487 202020202020202020-
  6263 00003490 202020202020202020-
  6263 00003499 202020202020202020-
  6263 000034A2 202020202020202020-
  6263 000034AB 202020202020202020-
  6263 000034B4 2020202020DDDBDE   
  6264 000034BC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6264 000034C5 202020202020202020-
  6264 000034CE 202020202020202020-
  6264 000034D7 202020202020202020-
  6264 000034E0 202020202020202020-
  6264 000034E9 202020202020202020-
  6264 000034F2 202020202020202020-
  6264 000034FB 202020202020202020-
  6264 00003504 2020202020DDDBDE   
  6265 0000350C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6265 00003515 202020202020202020-
  6265 0000351E 202020202020202020-
  6265 00003527 202020202020202020-
  6265 00003530 202020202020202020-
  6265 00003539 202020202020202020-
  6265 00003542 202020202020202020-
  6265 0000354B 202020202020202020-
  6265 00003554 2020202020DDDBDE   
  6266 0000355C 00                      	db 0
  6267                                  
  6268                                  ; -------------------------------------------------------------
  6269                                  
  6270                                  	; 22/12/2024
  6271                                  	; 21/12/2024
  6272                                  PlayingScreen:
  6273 0000355D DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6273 00003566 DBDBDBDBDBDBDBDBDB-
  6273 0000356F DBDBDBDBDBDBDBDBDB-
  6273 00003578 DBDBDBDBDBDBDB2044-
  6273 00003581 4F5320506C61796572-
  6273 0000358A 20DBDBDBDBDBDBDBDB-
  6273 00003593 DBDBDBDBDBDBDBDBDB-
  6273 0000359C DBDBDBDBDBDBDBDBDB-
  6273 000035A5 DBDBDBDBDBDBDBDB   
  6274 000035AD C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6274 000035B6 CDCDCDCDCDCDCDCDCD-
  6274 000035BF CDCDCDCDCDCDCDCDCD-
  6274 000035C8 CDCDCDCDCDCDCDCDCD-
  6274 000035D1 CDCDCDCDCDCDCDCDCD-
  6274 000035DA CDCDCDCDCDCDCDCDCD-
  6274 000035E3 CDCDCDCDCDCDCDCDCD-
  6274 000035EC CDCDCDCDCDCDCDCDCD-
  6274 000035F5 CDCDCDCDCDCDCDBB   
  6275 000035FD BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6275 00003606 202020202020202020-
  6275 0000360F 202020202020202020-
  6275 00003618 202020202020202055-
  6275 00003621 736572204775696465-
  6275 0000362A 202020202020202020-
  6275 00003633 202020202020202020-
  6275 0000363C 202020202020202020-
  6275 00003645 20202020202020BA   
  6276 0000364D BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<H>             Hardware Info", 9 dup(32), 186
  6276 00003656 706163653E20202020-
  6276 0000365F 2020202020506C6179-
  6276 00003668 2F5061757365202020-
  6276 00003671 20202020203C483E20-
  6276 0000367A 202020202020202020-
  6276 00003683 202020486172647761-
  6276 0000368C 726520496E666F2020-
  6276 00003695 20202020202020BA   
  6277                                  	; 25/12/2024
  6278 0000369D BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>/<G>     Wave Lighting", 9 dup(32), 186
  6278 000036A6 3E2020202020202020-
  6278 000036AF 202020202053746F70-
  6278 000036B8 202020202020202020-
  6278 000036C1 20202020203C456E74-
  6278 000036CA 65723E2F3C473E2020-
  6278 000036D3 20202057617665204C-
  6278 000036DC 69676874696E672020-
  6278 000036E5 20202020202020BA   
  6279 000036ED BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6279 000036F6 3E2020202020202020-
  6279 000036FF 2020202020466F7277-
  6279 00003708 617264732020202020-
  6279 00003711 20202020203C2B3E2F-
  6279 0000371A 3C2D3E202020202020-
  6279 00003723 202020496E632F4465-
  6279 0000372C 6320566F6C756D6520-
  6279 00003735 20202020202020BA   
  6280 0000373D BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6280 00003746 3E2020202020202020-
  6280 0000374F 20202020204261636B-
  6280 00003758 776172647320202020-
  6280 00003761 20202020203C513E20-
  6280 0000376A 202020202020202020-
  6280 00003773 202020517569742050-
  6280 0000377C 726F6772616D202020-
  6280 00003785 20202020202020BA   
  6281 0000378D CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6281 00003796 CDCDCDCDCDCDCDCDCD-
  6281 0000379F CDCDCDCDCDCDCDCDCD-
  6281 000037A8 CDCDCDCDCDCDCDCDCD-
  6281 000037B1 CDCDCDCDCDCDCDCDCD-
  6281 000037BA CDCDCDCDCDCDCDCDCD-
  6281 000037C3 CDCDCDCDCDCDCDCDCD-
  6281 000037CC CDCDCDCDCDCDCDCDCD-
  6281 000037D5 CDCDCDCDCDCDCDB9   
  6282 000037DD BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6282 000037E6 6C65204E616D65203A-
  6282 000037EF 202020202020202020-
  6282 000037F8 202020202020202020-
  6282 00003801 20202020204269742D-
  6282 0000380A 5261746520203A2020-
  6282 00003813 202020302020426974-
  6282 0000381C 732020202020202020-
  6282 00003825 20202020202020BA   
  6283 0000382D BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6283 00003836 657175656E6379203A-
  6283 0000383F 202020202030202020-
  6283 00003848 2020487A2020202020-
  6283 00003851 2020202020232D4368-
  6283 0000385A 616E6E656C733A2020-
  6283 00003863 202020302020202020-
  6283 0000386C 202020202020202020-
  6283 00003875 20202020202020BA   
  6284 0000387D C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6284 00003886 CDCDCDCDCDCDCDCDCD-
  6284 0000388F CDCDCDCDCDCDCDCDCD-
  6284 00003898 CDCDCDCDCDCDCDCDCD-
  6284 000038A1 CDCDCDCDCDCDCDCDCD-
  6284 000038AA CDCDCDCDCDCDCDCDCD-
  6284 000038B3 CDCDCDCDCDCDCDCDCD-
  6284 000038BC CDCDCDCDCDCDCDCDCD-
  6284 000038C5 CDCDCDCDCDCDCDBC   
  6285 000038CD 202020202020202020-     	db  80 dup(32)
  6285 000038D6 202020202020202020-
  6285 000038DF 202020202020202020-
  6285 000038E8 202020202020202020-
  6285 000038F1 202020202020202020-
  6285 000038FA 202020202020202020-
  6285 00003903 202020202020202020-
  6285 0000390C 202020202020202020-
  6285 00003915 2020202020202020   
  6286                                  improper_samplerate_txt:
  6287                                  read_error_txt:
  6288 0000391D 202020202020202020-     	db  80 dup(32)
  6288 00003926 202020202020202020-
  6288 0000392F 202020202020202020-
  6288 00003938 202020202020202020-
  6288 00003941 202020202020202020-
  6288 0000394A 202020202020202020-
  6288 00003953 202020202020202020-
  6288 0000395C 202020202020202020-
  6288 00003965 2020202020202020   
  6289 0000396D 202020202020202020-     	db  80 dup(32)
  6289 00003976 202020202020202020-
  6289 0000397F 202020202020202020-
  6289 00003988 202020202020202020-
  6289 00003991 202020202020202020-
  6289 0000399A 202020202020202020-
  6289 000039A3 202020202020202020-
  6289 000039AC 202020202020202020-
  6289 000039B5 2020202020202020   
  6290 000039BD 202020202020202020-     	db  80 dup(32)
  6290 000039C6 202020202020202020-
  6290 000039CF 202020202020202020-
  6290 000039D8 202020202020202020-
  6290 000039E1 202020202020202020-
  6290 000039EA 202020202020202020-
  6290 000039F3 202020202020202020-
  6290 000039FC 202020202020202020-
  6290 00003A05 2020202020202020   
  6291 00003A0D 202020202020202020-     	db  80 dup(32)
  6291 00003A16 202020202020202020-
  6291 00003A1F 202020202020202020-
  6291 00003A28 202020202020202020-
  6291 00003A31 202020202020202020-
  6291 00003A3A 202020202020202020-
  6291 00003A43 202020202020202020-
  6291 00003A4C 202020202020202020-
  6291 00003A55 2020202020202020   
  6292 00003A5D 202020202020202020-     	db  80 dup(32)
  6292 00003A66 202020202020202020-
  6292 00003A6F 202020202020202020-
  6292 00003A78 202020202020202020-
  6292 00003A81 202020202020202020-
  6292 00003A8A 202020202020202020-
  6292 00003A93 202020202020202020-
  6292 00003A9C 202020202020202020-
  6292 00003AA5 2020202020202020   
  6293 00003AAD 202020202020202020-     	db  80 dup(32)
  6293 00003AB6 202020202020202020-
  6293 00003ABF 202020202020202020-
  6293 00003AC8 202020202020202020-
  6293 00003AD1 202020202020202020-
  6293 00003ADA 202020202020202020-
  6293 00003AE3 202020202020202020-
  6293 00003AEC 202020202020202020-
  6293 00003AF5 2020202020202020   
  6294 00003AFD 202020202020202020-     	db  80 dup(32)
  6294 00003B06 202020202020202020-
  6294 00003B0F 202020202020202020-
  6294 00003B18 202020202020202020-
  6294 00003B21 202020202020202020-
  6294 00003B2A 202020202020202020-
  6294 00003B33 202020202020202020-
  6294 00003B3C 202020202020202020-
  6294 00003B45 2020202020202020   
  6295 00003B4D 202020202020202020-     	db  80 dup(32)
  6295 00003B56 202020202020202020-
  6295 00003B5F 202020202020202020-
  6295 00003B68 202020202020202020-
  6295 00003B71 202020202020202020-
  6295 00003B7A 202020202020202020-
  6295 00003B83 202020202020202020-
  6295 00003B8C 202020202020202020-
  6295 00003B95 2020202020202020   
  6296 00003B9D 202020202020202020-     	db  80 dup(32)
  6296 00003BA6 202020202020202020-
  6296 00003BAF 202020202020202020-
  6296 00003BB8 202020202020202020-
  6296 00003BC1 202020202020202020-
  6296 00003BCA 202020202020202020-
  6296 00003BD3 202020202020202020-
  6296 00003BDC 202020202020202020-
  6296 00003BE5 2020202020202020   
  6297 00003BED 202020202020202020-     	db  80 dup(32)
  6297 00003BF6 202020202020202020-
  6297 00003BFF 202020202020202020-
  6297 00003C08 202020202020202020-
  6297 00003C11 202020202020202020-
  6297 00003C1A 202020202020202020-
  6297 00003C23 202020202020202020-
  6297 00003C2C 202020202020202020-
  6297 00003C35 2020202020202020   
  6298 00003C3D 202020202020202020-     	db  80 dup(32)
  6298 00003C46 202020202020202020-
  6298 00003C4F 202020202020202020-
  6298 00003C58 202020202020202020-
  6298 00003C61 202020202020202020-
  6298 00003C6A 202020202020202020-
  6298 00003C73 202020202020202020-
  6298 00003C7C 202020202020202020-
  6298 00003C85 2020202020202020   
  6299 00003C8D 202020202020202020-     	db  80 dup(32)
  6299 00003C96 202020202020202020-
  6299 00003C9F 202020202020202020-
  6299 00003CA8 202020202020202020-
  6299 00003CB1 202020202020202020-
  6299 00003CBA 202020202020202020-
  6299 00003CC3 202020202020202020-
  6299 00003CCC 202020202020202020-
  6299 00003CD5 2020202020202020   
  6300 00003CDD 202020202020202020-     	db  80 dup(32)
  6300 00003CE6 202020202020202020-
  6300 00003CEF 202020202020202020-
  6300 00003CF8 202020202020202020-
  6300 00003D01 202020202020202020-
  6300 00003D0A 202020202020202020-
  6300 00003D13 202020202020202020-
  6300 00003D1C 202020202020202020-
  6300 00003D25 2020202020202020   
  6301 00003D2D 202020202020202020-     	db  80 dup(32)
  6301 00003D36 202020202020202020-
  6301 00003D3F 202020202020202020-
  6301 00003D48 202020202020202020-
  6301 00003D51 202020202020202020-
  6301 00003D5A 202020202020202020-
  6301 00003D63 202020202020202020-
  6301 00003D6C 202020202020202020-
  6301 00003D75 2020202020202020   
  6302 00003D7D 202020202020202020-     	db  80 dup(32)
  6302 00003D86 202020202020202020-
  6302 00003D8F 202020202020202020-
  6302 00003D98 202020202020202020-
  6302 00003DA1 202020202020202020-
  6302 00003DAA 202020202020202020-
  6302 00003DB3 202020202020202020-
  6302 00003DBC 202020202020202020-
  6302 00003DC5 2020202020202020   
  6303 00003DCD 202020202020202020-     	db  80 dup(32)
  6303 00003DD6 202020202020202020-
  6303 00003DDF 202020202020202020-
  6303 00003DE8 202020202020202020-
  6303 00003DF1 202020202020202020-
  6303 00003DFA 202020202020202020-
  6303 00003E03 202020202020202020-
  6303 00003E0C 202020202020202020-
  6303 00003E15 2020202020202020   
  6304 00003E1D 202020202020202020-     	db  80 dup(32)
  6304 00003E26 202020202020202020-
  6304 00003E2F 202020202020202020-
  6304 00003E38 202020202020202020-
  6304 00003E41 202020202020202020-
  6304 00003E4A 202020202020202020-
  6304 00003E53 202020202020202020-
  6304 00003E5C 202020202020202020-
  6304 00003E65 2020202020202020   
  6305 00003E6D 202020202020202020-     	db  80 dup(32)
  6305 00003E76 202020202020202020-
  6305 00003E7F 202020202020202020-
  6305 00003E88 202020202020202020-
  6305 00003E91 202020202020202020-
  6305 00003E9A 202020202020202020-
  6305 00003EA3 202020202020202020-
  6305 00003EAC 202020202020202020-
  6305 00003EB5 2020202020202020   
  6306 00003EBD CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6306 00003EC6 CDCDCDCDCDCDCDCDCD-
  6306 00003ECF CDCDCDCDCDCDCDCDCD-
  6306 00003ED8 CDCDCDCDCDCDCDCDCD-
  6306 00003EE1 CDCDCDCDCDCDCDCDCD-
  6306 00003EEA CDCDCDCDCDCDCDCDCD-
  6306 00003EF3 CDCDCDCDCDCDCDCDCD-
  6306 00003EFC CDCDCDCDCDCDCDCDCD-
  6306 00003F05 CDCDCDCDCDCDCDCD   
  6307 00003F0D 202020202020202020-     	db  80 dup(32)
  6307 00003F16 202020202020202020-
  6307 00003F1F 202020202020202020-
  6307 00003F28 202020202020202020-
  6307 00003F31 202020202020202020-
  6307 00003F3A 202020202020202020-
  6307 00003F43 202020202020202020-
  6307 00003F4C 202020202020202020-
  6307 00003F55 2020202020202020   
  6308 00003F5D 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6308 00003F66 202020202020202020-
  6308 00003F6F 202020202020202020-
  6308 00003F78 20202020202030303A-
  6308 00003F81 303020AEAF2030303A-
  6308 00003F8A 303020202020202020-
  6308 00003F93 202020202020202020-
  6308 00003F9C 202020202020202056-
  6308 00003FA5 4F4C2030303025     
  6309 00003FAC 00                      	db 0
  6310                                  
  6311                                  ; -------------------------------------------------------------
  6312                                  
  6313                                  	; 22/12/2024
  6314                                  fillblock:
  6315 00003FAD FF<rep Eh>              	times 14 db 0FFh
  6316 00003FBB 0000                    	dw 0
  6317                                  
  6318                                  ; -------------------------------------------------------------
  6319                                  
  6320                                  ; 23/11/2024
  6321                                  colors:
  6322 00003FBD 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6323                                  	; white, cyan, green, red, yellow, blue, magenta
  6324 00003FC5 0B                      ccolor:	db 0Bh	; cyan
  6325                                  
  6326                                  EOF: 
  6327                                  
  6328                                  ; -------------------------------------------------------------
  6329                                  
  6330                                  bss:
  6331                                  
  6332                                  ABSOLUTE bss
  6333                                  
  6334 00003FC6 ????                    alignb 4
  6335                                  
  6336                                  ; 21/12/2024
  6337                                  fontbuff1:
  6338 00003FC8 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6339                                  fontbuff2:
  6340 00004DC8 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6341                                  
  6342                                  ; 11/12/2024
  6343                                  wleds_addr:
  6344 00005DC8 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6345                                  ; 22/12/2024
  6346                                  prev_leds:
  6347 000071C8 <res 140h>              	resd 80	; previous lighting leds
  6348                                  
  6349                                  ; 24/12/2024
  6350                                  wpoints_dif:	; wave lighting points factor (differential) 
  6351 00007308 ????????                	resd 1	; required bytes for 1/18 second wave lighting
  6352                                  graphstart:
  6353 0000730C ????????                	resd 1	; start (top) line/row for wave lighting points 	 
  6354                                  
  6355                                  LFB_ADDR:
  6356 00007310 ????????                	resd 1
  6357                                  ;nextrow:
  6358                                  	;resd 1
  6359                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6360 00007314 ????????                	resd 1
  6361 00007318 ????????                wcolor:	resd 1
  6362                                  ; 26/12/2024
  6363                                  ;tcolor: resb 1 ; text color
  6364                                  columns:
  6365 0000731C ??                      	resb 1
  6366 0000731D ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6367                                  
  6368 0000731E ????                    alignb 4
  6369                                  
  6370                                  bss_start:
  6371                                  
  6372                                  ; 24/12/2024
  6373                                  prev_points:
  6374 00007320 <res A00h>              	resd 640 ; previous wave points (which are lighting)	
  6375                                  
  6376                                  ; 18/11/2024
  6377                                  stopped:
  6378 00007D20 ??                      	resb 1
  6379 00007D21 ??                      tLO:	resb 1
  6380                                  ; 21/11/2024
  6381 00007D22 ??                      tLP:	resb 1
  6382                                  ; 19/11/2024
  6383 00007D23 ??                      wleds:	resb 1
  6384                                  wleds_dif:
  6385 00007D24 ????????                	resd 1
  6386 00007D28 ????????                pbuf_o:	resd 1
  6387                                  ; 07/12/2024
  6388 00007D2C ??                      pbuf_s:	resb 1
  6389                                  
  6390                                  ; 07/12/2024
  6391                                  ; 24/11/2024
  6392                                  half_buffer:
  6393 00007D2D ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6394                                  
  6395                                  ; 30/05/2024
  6396 00007D2E ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6397                                  
  6398                                  ; 24/12/2024
  6399 00007D2F ??                      p_mode: resb 1	; point mode (as alternative to LED mode)
  6400                                  
  6401                                  ; 30/11/2024
  6402                                  alignb 4
  6403                                  
  6404                                  ;;;;;;;;;;;;;;
  6405                                  ; 14/11/2024
  6406                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6407                                  WAVFILEHEADERbuff:
  6408                                  RIFF_ChunkID:
  6409 00007D30 ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6410                                  		; 0x52494646
  6411                                  RIFF_ChunkSize:
  6412 00007D34 ????????                	resd 1	; Represents total file size, not 
  6413                                          	; including the first 2 fields 
  6414                                  		; (Total_File_Size - 8), little-endian
  6415                                  RIFF_Format:
  6416 00007D38 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6417                                  		; 0x57415645
  6418                                  
  6419                                  ;; WAVE header parameters ("Sub-chunk")
  6420                                  WAVE_SubchunkID:
  6421 00007D3C ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6422                                  		; 0x666d7420
  6423                                  WAVE_SubchunkSize:
  6424 00007D40 ????????                	resd 1	; Represents total chunk size
  6425                                  WAVE_AudioFormat:
  6426 00007D44 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6427                                  		; of compression, not supported.
  6428                                  WAVE_NumChannels:
  6429 00007D46 ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6430                                  WAVE_SampleRate:
  6431 00007D48 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6432                                  WAVE_ByteRate:
  6433 00007D4C ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6434                                  WAVE_BlockAlign:
  6435 00007D50 ????                    	resw 1	; NumChannels * BytesPerSample
  6436                                  		; Number of bytes for one sample.
  6437                                  WAVE_BitsPerSample:
  6438 00007D52 ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6439                                  
  6440                                  ;; DATA header parameters
  6441                                  DATA_SubchunkID:
  6442 00007D54 ????????                	resd 1	; Must be equal to "data" - big-endian
  6443                                          	; 0x64617461
  6444                                  DATA_SubchunkSize:
  6445 00007D58 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6446                                          	; Number of bytes in the data.
  6447                                  ;;;;;;;;;;;;;;
  6448                                  
  6449                                  ; 15/11/2024
  6450                                  cursortype:
  6451 00007D5C ????                    	resw 1
  6452 00007D5E ??                      flags:	resb 1
  6453                                  ; 06/11/2023
  6454                                  ac97_int_ln_reg:
  6455 00007D5F ??                      	resb 1
  6456                                  filehandle:
  6457 00007D60 ????????                	resd 1
  6458                                  
  6459                                  ; 30/05/2024
  6460                                  wav_file_name:
  6461 00007D64 <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6462 00007DB4 ????                    	resw 1	; 30/11/2024
  6463                                  
  6464                                  ; 08/11/2023
  6465                                  ; 07/11/2023
  6466                                  fbs_shift:
  6467 00007DB6 ??                      	resb 1
  6468                                  ; 07/12/2024
  6469 00007DB7 ??                      SRB:	resb 1
  6470                                  
  6471                                  ; 12/11/2016 - Erdogan Tan
  6472                                  bus_dev_fn:
  6473 00007DB8 ????????                	resd 1
  6474                                  dev_vendor:
  6475 00007DBC ????????                	resd 1
  6476                                  
  6477                                  ; 17/02/2017
  6478                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6479                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6480                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6481                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6482 00007DC0 ????                    NAMBAR:	resw 1	; BAR for mixer
  6483                                  NABMBAR:
  6484 00007DC2 ????                    	resw 1	; BAR for bus master regs
  6485                                  
  6486                                  ; 15/11/2024
  6487                                  loadfromwavfile:
  6488 00007DC4 ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6489                                  loadsize:
  6490 00007DC8 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6491                                  buffersize:
  6492 00007DCC ????????                	resd 1	; 16 bit samples (not bytes)
  6493                                  		
  6494                                  ; 14/11/2024
  6495                                  TotalTime:
  6496 00007DD0 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6497                                  ProgressTime:
  6498 00007DD4 ????????                	resd 1
  6499 00007DD8 ????????                count:	resd 1	; byte count of one (wav file) read
  6500                                  LoadedDataBytes:
  6501 00007DDC ????????                	resd 1	; total read/load count
  6502                                  
  6503                                  timerticks:
  6504 00007DE0 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6505                                  		; (in order to get the emulator/qemu to run correctly)
  6506                                  ; 14/11/2024	
  6507                                  bss_end:
  6508                                  
  6509                                  ; 02/12/2024
  6510 00007DE4 <res 21Ch>              alignb 4096
  6511                                  
  6512                                  ; 07/12/2024
  6513                                  ; 26/11/2023
  6514                                  audio_buffer:
  6515 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6516                                  
  6517                                  ; 01/12/2024
  6518                                  ; 26/11/2023
  6519                                  temp_buffer:
  6520 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
