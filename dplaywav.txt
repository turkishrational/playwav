     1                                  ; ****************************************************************************
     2                                  ; dplaywav.s - TRDOS 386 (TRDOS v2.0.9) WAV PLAYER - VESA VBE Video Mode 101h
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; DPLAYWAV.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 21/12/2024
     7                                  ;
     8                                  ; [ Last Modification: 26/12/2024 ]
     9                                  ;
    10                                  ; Modified from PLAYWAV9.PRG .wav player program by Erdogan Tan, 18/12/2024
    11                                  ;
    12                                  ; ****************************************************************************
    13                                  ; nasm dplaywav.s -l dplaywav.txt -o DPLAYWAV.PRG -Z error.txt
    14                                  ; (modified from 'circle10.s', 18/02/2021)
    15                                  
    16                                  ; Draw graphics by using 'sysvideo' bx=0305h
    17                                  ; and display text by using bx=010Fh
    18                                  
    19                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    20                                  ; ------------------------------------------------------------
    21                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    22                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    23                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    24                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    25                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    26                                  
    27                                  ; ------------------------------------------------------------
    28                                  
    29                                  ; 30/11/2024
    30                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    31                                  ; 29/04/2016
    32                                  _ver 	equ 0
    33                                  _exit 	equ 1
    34                                  _fork 	equ 2
    35                                  _read 	equ 3
    36                                  _write	equ 4
    37                                  _open	equ 5
    38                                  _close 	equ 6
    39                                  _wait 	equ 7
    40                                  _creat 	equ 8
    41                                  _link 	equ 9
    42                                  _unlink	equ 10
    43                                  _exec	equ 11
    44                                  _chdir	equ 12
    45                                  _time 	equ 13
    46                                  _mkdir 	equ 14
    47                                  _chmod	equ 15
    48                                  _chown	equ 16
    49                                  _break	equ 17
    50                                  _stat	equ 18
    51                                  _seek	equ 19
    52                                  _tell 	equ 20
    53                                  _mount	equ 21
    54                                  _umount	equ 22
    55                                  _setuid	equ 23
    56                                  _getuid	equ 24
    57                                  _stime	equ 25
    58                                  _quit	equ 26
    59                                  _intr	equ 27
    60                                  _fstat	equ 28
    61                                  _emt 	equ 29
    62                                  _mdate 	equ 30
    63                                  _video 	equ 31
    64                                  _audio	equ 32
    65                                  _timer	equ 33
    66                                  _sleep	equ 34
    67                                  _msg    equ 35
    68                                  _geterr	equ 36
    69                                  _fpsave	equ 37
    70                                  _pri	equ 38
    71                                  _rele	equ 39
    72                                  _fff	equ 40
    73                                  _fnf	equ 41
    74                                  _alloc	equ 42
    75                                  _dalloc equ 43
    76                                  _calbac equ 44
    77                                  _dma	equ 45
    78                                  _stdio  equ 46
    79                                  
    80                                  ; ------------------------------------------------------------
    81                                  
    82                                  %macro sys 1-4
    83                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    84                                      ; 03/09/2015
    85                                      ; 13/04/2015
    86                                      ; Retro UNIX 386 v1 system call.
    87                                      %if %0 >= 2
    88                                          mov ebx, %2
    89                                          %if %0 >= 3
    90                                              mov ecx, %3
    91                                              %if %0 = 4
    92                                                 mov edx, %4
    93                                              %endif
    94                                          %endif
    95                                      %endif
    96                                      mov eax, %1
    97                                      ;int 30h
    98                                      int 40h ; TRDOS 386 (TRDOS v2.0)
    99                                  %endmacro
   100                                  
   101                                  ; Retro UNIX 386 v1 system call format:
   102                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   103                                  
   104                                  ; ------------------------------------------------------------
   105                                  
   106                                  ; player internal variables and other equates.
   107                                  BUFFERSIZE	equ 65536
   108                                  ENDOFFILE	equ 1		; flag for knowing end of file
   109                                  
   110                                  ; ------------------------------------------------------------
   111                                  
   112                                  [BITS 32] ; 32-bit intructions
   113                                  
   114                                  [ORG 0]
   115                                  
   116                                  START_CODE:
   117                                  	; Prints the Credits Text.
   118                                  	sys	_msg, Credits, 255, 0Bh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000000 BB[88280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000005 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000000A BA0B000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000000F B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000014 CD40                <1>  int 40h
   119                                  
   120                                  	; clear bss
   121 00000016 BF[40730000]            	mov	edi, bss_start
   122 0000001B B9B1020000              	mov	ecx, (bss_end - bss_start)/4
   123 00000020 31C0                    	xor	eax, eax
   124 00000022 F3AB                    	rep	stosd
   125                                  
   126                                  ; -------------------------------------------------------------
   127                                  
   128                                  	; 21/12/2024
   129                                  	; Detect (& Enable) AC'97 Audio Device
   130 00000024 E810070000              	call	DetectAC97
   131 00000029 731B                    	jnc	short ac97_hardware_ready
   132                                  
   133                                  	; 30/11/2024
   134                                  	; 30/05/2024
   135                                  _dev_not_ready:
   136                                  	; couldn't find the audio device!
   137                                  	sys	_msg, noDevMsg, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000002B BB[1B290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000030 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000035 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000003A B823000000          <1>  mov eax, %1
    97                              <1> 
    98 0000003F CD40                <1>  int 40h
   138 00000041 E980040000                      jmp     Exit
   139                                  
   140                                  ac97_hardware_ready:
   141 00000046 E88D080000              	call	write_audio_dev_info
   142                                  
   143                                  ; -------------------------------------------------------------
   144                                  
   145                                  	; 21/12/2024
   146                                  	;;;
   147                                  	; Read (copy) 8x14 system fonts
   148 0000004B BE[E83F0000]            	mov	esi, fontbuff1
   149                                  	sys	_video, 0C03h, 256, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000050 BB030C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000055 B900010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000005A BA00000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000005F B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000064 CD40                <1>  int 40h
   150                                  
   151                                  	; convert 8x14 fonts to 8x16 fonts
   152                                  	; by inserting 2 empty rows to each characters
   153                                  	;mov	esi, fontbuff1
   154 00000066 BF[E84D0000]            	mov	edi, fontbuff2
   155                                  	; 18/02/2021
   156                                  	;mov	cx, 256
   157                                  fontconvert:
   158 0000006B 51                      	push	ecx
   159 0000006C 66B90E00                	mov	cx, 14
   160 00000070 F3A4                    	rep	movsb
   161 00000072 28C0                    	sub	al, al
   162 00000074 AA                      	stosb
   163 00000075 AA                      	stosb
   164 00000076 59                      	pop	ecx
   165 00000077 E2F2                    	loop	fontconvert
   166                                  	;;;
   167                                  
   168                                  ; ------------------------------------------------------------- 
   169                                  
   170                                  	; 21/12/2024
   171                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   172                                  	sys	_video, 08FFh, 101h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000079 BBFF080000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000007E B901010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000083 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000088 CD40                <1>  int 40h
   173 0000008A 09C0                    	or	eax, eax
   174 0000008C 0F842F040000            	jz	terminate    ; nothing to do				
   175                                  	;jz	trdos386_err ; write (OS) error msg and exit
   176                                  
   177                                  set_vesa_mode_101h_ok:
   178                                  	; linear frame buffer access
   179                                  	sys	_video, 06FFh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000092 BBFF060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000097 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000009C CD40                <1>  int 40h
   180 0000009E 21C0                    	and	eax, eax
   181 000000A0 0F8466040000            	jz	error_exit ; set text mode and write err msg
   182 000000A6 A3[30730000]            	mov	[LFB_ADDR], eax
   183                                  
   184                                  ; -------------------------------------------------------------
   185                                  
   186                                  	; 07/12/2024
   187                                  GetFileName_@:
   188                                  	; 30/11/2024
   189                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   190                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   191                                  	;			.. argv0text, argv1text ..) 
   192                                  	; ---- argc, argv[] ----
   193 000000AB 89E6                    	mov	esi, esp
   194 000000AD AD                      	lodsd
   195 000000AE 83F802                  	cmp	eax, 2 ; two arguments 
   196                                  		; (program file name & mod file name)
   197 000000B1 0F8218040000            	jb	pmsg_usage ; nothing to do
   198                                  	; 07/12/2024
   199 000000B7 AD                      	lodsd	; skip program (PRG) file name
   200                                  
   201                                  	; 30/11/2024 (32bit)
   202                                  	; 29/11/2024
   203                                  	; 30/05/2024
   204                                  GetFileName:
   205 000000B8 BF[847D0000]            	mov	edi, wav_file_name 
   206                                  	; 07/12/2024
   207 000000BD 8B36                    	mov	esi, [esi]
   208 000000BF 31C9                    	xor	ecx, ecx ; 0
   209                                  ScanName:
   210 000000C1 AC                      	lodsb
   211                                  	;test	al, al
   212                                  	;jz	short a_4
   213                                  	; 29/11/2024
   214 000000C2 3C0D                    	cmp	al, 0Dh
   215 000000C4 7638                    	jna	short a_4
   216 000000C6 3C20                    	cmp	al, 20h
   217 000000C8 74F7                    	je	short ScanName	; scan start of name.
   218 000000CA AA                      	stosb
   219 000000CB B4FF                    	mov	ah, 0FFh
   220                                  	;;;
   221                                  	; 14/11/2024
   222                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   223                                  	;xor	ecx, ecx ; 0
   224                                  	;;;
   225                                  a_0:	
   226 000000CD FEC4                    	inc	ah
   227                                  a_1:
   228                                  	;;;
   229                                  	; 14/11/2024
   230 000000CF 41                      	inc	ecx
   231                                  	;;;
   232 000000D0 AC                      	lodsb
   233 000000D1 AA                      	stosb
   234 000000D2 3C2E                    	cmp	al, '.'
   235 000000D4 74F7                    	je	short a_0
   236                                  	; 29/11/2024
   237 000000D6 3C20                    	cmp	al, 20h
   238                                  	;and	al, al
   239                                  	;jnz	short a_1
   240                                  	;;;
   241                                  	; 14/11/2024
   242 000000D8 7613                    	jna	short a_3
   243 000000DA 20E4                    	and	ah, ah
   244 000000DC 7406                    	jz	short a_2
   245 000000DE 3C2F                    	cmp	al, '/'	; 14/12/2024
   246 000000E0 7502                    	jne	short a_2
   247 000000E2 B400                    	mov	ah, 0
   248                                  a_2:
   249 000000E4 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   250 000000E7 72E6                    	jb	short a_1
   251                                  	; 29/11/2024
   252 000000E9 29C9                    	sub	ecx, ecx
   253 000000EB EB11                    	jmp	short a_4
   254                                  a_3:
   255                                  	; 29/11/2024
   256 000000ED 4F                      	dec	edi
   257                                  	;;;
   258 000000EE 08E4                    	or	ah, ah		; if period NOT found,
   259 000000F0 750C                    	jnz	short a_4 	; then add a .WAV extension.
   260                                  SetExt:
   261                                  	; 29/11/2024
   262                                  	;dec	edi
   263 000000F2 C7072E574156            	mov	dword [edi], '.WAV'
   264                                  				; ! 64+12 is DOS limit
   265                                  				; but writing +4 must not
   266                                  				; destroy the following data	 
   267                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   268                                  	; 29/11/2024
   269 000000F8 83C104                  	add	ecx, 4
   270 000000FB 83C704                  	add	edi, 4
   271                                  a_4:	
   272 000000FE C60700                  	mov	byte [edi], 0
   273                                  
   274                                          ; open existing file
   275                                  	; 28/11/2024
   276                                  	;mov	edx, wav_file_name
   277 00000101 E885060000                      call    openFile ; no error? ok.
   278 00000106 7325                            jnc     short getwavparms
   279                                  
   280                                  	; 21/12/2024
   281 00000108 E89C040000              	call	set_text_mode
   282                                  	; file not found!
   283                                  	; 30/11/2024
   284                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000010D BB[46290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000112 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000117 BA0C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000011C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000121 CD40                <1>  int 40h
   285 00000123 E99E030000                      jmp     Exit
   286                                  
   287                                  _exit_:
   288 00000128 E994030000              	jmp	terminate
   289                                  
   290                                  ; -------------------------------------------------------------
   291                                  
   292                                  getwavparms:
   293                                  	; 14/11/2024
   294 0000012D E88E060000                     	call    getWAVParameters
   295 00000132 72F4                    	jc	short _exit_		; nothing to do
   296                                  
   297                                  	; 17/11/2024
   298 00000134 B304                    	mov	bl, 4
   299 00000136 2A1D[707D0000]          	sub	bl, byte [WAVE_BlockAlign]
   300                                  			; = 0 for 16 bit stereo
   301                                  			; = 2 for 8 bit stereo or 16 bit mono
   302                                  			; = 3 for 8 bit mono	
   303                                  
   304 0000013C D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   305                                  	; 15/11/2024
   306 0000013E 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   307 00000141 881D[D67D0000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   308                                  					; = 0 stereo and 16 bit
   309                                  					; = 1 mono or 8 bit
   310                                  
   311                                  ; -------------------------------------------------------------
   312                                  
   313                                  	; 26/12/2024
   314                                  	; 21/12/2024
   315                                  	;mov	byte [tcolor], 15
   316                                  
   317                                  Player_SplashScreen:
   318                                  _0:
   319 00000147 E8FE030000              	call	drawsplashscreen
   320                                  
   321                                  	; 21/12/2024
   322                                  	;;;
   323                                  	; set wave volume led addresses
   324 0000014C 8B1D[30730000]          	mov	ebx, [LFB_ADDR]
   325 00000152 81C300C70100            	add	ebx, (13*80*8*14)
   326 00000158 BD50000000              	mov	ebp, 80
   327 0000015D BF[E85D0000]            	mov	edi, wleds_addr
   328                                  wleds_sa_1:
   329 00000162 B90F000000              	mov	ecx, 15
   330                                  wleds_sa_2:
   331 00000167 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   332 0000016C F7E1                    	mul	ecx
   333 0000016E 01D8                    	add	eax, ebx
   334 00000170 AB                      	stosd
   335 00000171 E2F4                    	loop	wleds_sa_2
   336 00000173 89D8                    	mov	eax, ebx
   337 00000175 AB                      	stosd
   338 00000176 83C308                  	add	ebx, 8
   339 00000179 4D                      	dec	ebp
   340 0000017A 75E6                    	jnz	short wleds_sa_1
   341                                  	;;;
   342                                  
   343                                  	; 24/12/2024
   344                                  	; 07/12/2024
   345                                  	;;; wait for 3 seconds
   346                                  	sys	_time, 0 ; get time in unix epoch format
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000017C BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000181 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 00000186 CD40                <1>  int 40h
   347 00000188 89C1                    	mov	ecx, eax
   348 0000018A 83C103                  	add	ecx, 3
   349                                  _wait_3s:
   350 0000018D 90                      	nop
   351                                  	sys	_time, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000018E BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000193 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 00000198 CD40                <1>  int 40h
   352 0000019A 39C8                    	cmp	eax, ecx
   353 0000019C 72EF                    	jb	short _wait_3s
   354                                  	;;;
   355                                  
   356                                  ; -------------------------------------------------------------
   357                                  
   358                                  	; 07/12/2024 (playwav9.s)
   359                                  
   360                                  	; 18/11/2023 (ich_wav4.asm)
   361                                  	; 13/11/2023 (ich_wav3.asm)
   362                                  
   363 0000019E 803D[4E7D0000]01        	cmp	byte [VRA], 1
   364 000001A5 7226                    	jb	short chk_sample_rate
   365                                  
   366                                  playwav_48_khz:
   367 000001A7 C705[E47D0000]-         	mov	dword [loadfromwavfile], loadFromFile
   367 000001AD [0A080000]         
   368                                  	;mov	dword [loadsize], 0 ; 65536
   369                                  	;;;
   370                                  	; 17/11/2024
   371                                  	;mov	word [buffersize], 32768
   372                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   373                                  	; 30/11/2024
   374                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   375                                  	; 07/12/2024
   376 000001B1 B800000100              	mov	eax, BUFFERSIZE ; 65536
   377 000001B6 A3[EC7D0000]            	mov	[buffersize], eax	; 16 bit samples
   378                                  	; 07/12/2024
   379                                  	;shl	eax, 1			; bytes
   380 000001BB 8A0D[D67D0000]          	mov	cl, [fbs_shift]
   381 000001C1 D3E8                    	shr	eax, cl 
   382                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   383 000001C3 A3[E87D0000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   384                                  	;;;
   385                                  	;jmp	PlayNow ; 30/05/2024
   386                                  	; 07/12/2024
   387 000001C8 E95D020000              	jmp	Player_Template
   388                                  
   389                                  chk_sample_rate:
   390                                  	; set conversion parameters
   391                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   392 000001CD 66A1[687D0000]          	mov	ax, [WAVE_SampleRate]
   393 000001D3 663D80BB                	cmp	ax, 48000
   394 000001D7 74CE                    	je	short playwav_48_khz
   395                                  chk_22khz:
   396 000001D9 663D2256                	cmp	ax, 22050
   397 000001DD 7545                    	jne	short chk_11khz
   398 000001DF 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   399 000001E6 7615                    	jna	short chk_22khz_1
   400 000001E8 BB[74170000]            	mov	ebx, load_22khz_stereo_16_bit
   401 000001ED 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   402 000001F4 751A                    	jne	short chk_22khz_2
   403 000001F6 BB[E7160000]            	mov	ebx, load_22khz_mono_16_bit
   404 000001FB EB13                    	jmp	short chk_22khz_2
   405                                  chk_22khz_1:
   406 000001FD BB[60160000]            	mov	ebx, load_22khz_stereo_8_bit
   407 00000202 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   408 00000209 7505                    	jne	short chk_22khz_2
   409 0000020B BB[D7150000]            	mov	ebx, load_22khz_mono_8_bit
   410                                  chk_22khz_2:
   411 00000210 B85A1D0000              	mov	eax, 7514  ; (442*17)
   412 00000215 BA25000000              	mov	edx, 37
   413 0000021A B911000000              	mov	ecx, 17
   414 0000021F E9D9010000              	jmp	set_sizes
   415                                  chk_11khz:
   416 00000224 663D112B                	cmp	ax, 11025
   417 00000228 7545                    	jne	short chk_44khz
   418 0000022A 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   419 00000231 7615                    	jna	short chk_11khz_1
   420 00000233 BB[90190000]            	mov	ebx, load_11khz_stereo_16_bit
   421 00000238 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   422 0000023F 751A                    	jne	short chk_11khz_2
   423 00000241 BB[17190000]            	mov	ebx, load_11khz_mono_16_bit
   424 00000246 EB13                    	jmp	short chk_11khz_2
   425                                  chk_11khz_1:
   426 00000248 BB[9D180000]            	mov	ebx, load_11khz_stereo_8_bit
   427 0000024D 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   428 00000254 7505                    	jne	short chk_11khz_2
   429 00000256 BB[25180000]            	mov	ebx, load_11khz_mono_8_bit
   430                                  chk_11khz_2:
   431 0000025B B8AD0E0000              	mov	eax, 3757  ; (221*17)
   432 00000260 BA4A000000              	mov	edx, 74
   433 00000265 B911000000              	mov	ecx, 17
   434 0000026A E98E010000              	jmp	set_sizes
   435                                  chk_44khz:
   436 0000026F 663D44AC                	cmp	ax, 44100
   437 00000273 7545                    	jne	short chk_16khz
   438 00000275 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   439 0000027C 7615                    	jna	short chk_44khz_1
   440 0000027E BB[B71B0000]            	mov	ebx, load_44khz_stereo_16_bit
   441 00000283 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   442 0000028A 751A                    	jne	short chk_44khz_2
   443 0000028C BB[3E1B0000]            	mov	ebx, load_44khz_mono_16_bit
   444 00000291 EB13                    	jmp	short chk_44khz_2
   445                                  chk_44khz_1:
   446 00000293 BB[C11A0000]            	mov	ebx, load_44khz_stereo_8_bit
   447 00000298 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   448 0000029F 7505                    	jne	short chk_44khz_2
   449 000002A1 BB[451A0000]            	mov	ebx, load_44khz_mono_8_bit
   450                                  chk_44khz_2:
   451                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   452 000002A6 B8D93A0000              	mov	eax, 15065 ; (655*23)
   453                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   454                                  	;mov	ax, 14076 ; (612*23)
   455                                  	; 17/11/2024
   456                                  	;mov	ax, 12650 ; (550*23)
   457 000002AB BA19000000              	mov	edx, 25
   458 000002B0 B917000000              	mov	ecx, 23
   459 000002B5 E943010000              	jmp	set_sizes
   460                                  chk_16khz:
   461 000002BA 663D803E                	cmp	ax, 16000
   462 000002BE 7545                    	jne	short chk_8khz
   463 000002C0 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   464 000002C7 7615                    	jna	short chk_16khz_1
   465 000002C9 BB[1C110000]            	mov	ebx, load_16khz_stereo_16_bit
   466 000002CE 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   467 000002D5 751A                    	jne	short chk_16khz_2
   468 000002D7 BB[9B100000]            	mov	ebx, load_16khz_mono_16_bit
   469 000002DC EB13                    	jmp	short chk_16khz_2
   470                                  chk_16khz_1:
   471 000002DE BB[E10F0000]            	mov	ebx, load_16khz_stereo_8_bit
   472 000002E3 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   473 000002EA 7505                    	jne	short chk_16khz_2
   474 000002EC BB[620F0000]            	mov	ebx, load_16khz_mono_8_bit
   475                                  chk_16khz_2:
   476                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   477 000002F1 B855150000              	mov	eax, 5461
   478                                  	; 17/11/2024
   479                                  	;mov	ax, 5460
   480 000002F6 BA03000000              	mov	edx, 3
   481 000002FB B901000000              	mov	ecx, 1
   482 00000300 E9F8000000              	jmp	set_sizes
   483                                  chk_8khz:
   484 00000305 663D401F                	cmp	ax, 8000
   485 00000309 7545                    	jne	short chk_24khz
   486 0000030B 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   487 00000312 7615                    	jna	short chk_8khz_1
   488 00000314 BB[170E0000]            	mov	ebx, load_8khz_stereo_16_bit
   489 00000319 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   490 00000320 751A                    	jne	short chk_8khz_2
   491 00000322 BB[470D0000]            	mov	ebx, load_8khz_mono_16_bit
   492 00000327 EB13                    	jmp	short chk_8khz_2
   493                                  chk_8khz_1:
   494 00000329 BB[170C0000]            	mov	ebx, load_8khz_stereo_8_bit
   495 0000032E 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   496 00000335 7505                    	jne	short chk_8khz_2
   497 00000337 BB[330B0000]            	mov	ebx, load_8khz_mono_8_bit
   498                                  chk_8khz_2:
   499 0000033C B8AA0A0000              	mov	eax, 2730
   500 00000341 BA06000000              	mov	edx, 6
   501 00000346 B901000000              	mov	ecx, 1
   502 0000034B E9AD000000              	jmp	set_sizes
   503                                  chk_24khz:
   504 00000350 663DC05D                	cmp	ax, 24000
   505 00000354 7561                    	jne	short chk_32khz
   506 00000356 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   507 0000035D 7613                    	jna	short chk_24khz_1
   508 0000035F 66BB[4613]              	mov	bx, load_24khz_stereo_16_bit
   509 00000363 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   510 0000036A 7519                    	jne	short chk_24khz_2
   511 0000036C 66BB[E312]              	mov	bx, load_24khz_mono_16_bit
   512 00000370 EB13                    	jmp	short chk_24khz_2
   513                                  chk_24khz_1:
   514 00000372 BB[59120000]            	mov	ebx, load_24khz_stereo_8_bit
   515 00000377 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   516 0000037E 7505                    	jne	short chk_24khz_2
   517 00000380 BB[F2110000]            	mov	ebx, load_24khz_mono_8_bit
   518                                  chk_24khz_2:
   519                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   520 00000385 B800200000              	mov	eax, 8192
   521                                  	; 17/11/2024
   522                                  	;mov	ax, 8190
   523 0000038A BA02000000              	mov	edx, 2
   524 0000038F B901000000              	mov	ecx, 1
   525 00000394 EB67                    	jmp	short set_sizes
   526                                  
   527                                  	; 07/12/2024
   528                                  vra_needed:
   529                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   530                                  	; 13/11/2023
   531 00000396 58                      	pop	eax ; discard return address to the caller
   532                                  	; 30/05/2024
   533                                  vra_err:
   534                                  	; 21/12/2024
   535 00000397 E80D020000              	call	set_text_mode
   536                                  	; 30/11/2024
   537                                  	sys	_msg, msg_no_vra, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000039C BB[B0290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000003A1 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000003A6 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000003AB B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000003B0 CD40                <1>  int 40h
   538 000003B2 E90F010000              	jmp	Exit
   539                                  
   540                                  chk_32khz:
   541 000003B7 663D007D                	cmp	ax, 32000
   542 000003BB 75D9                    	jne	short vra_needed
   543 000003BD 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   544 000003C4 7615                    	jna	short chk_32khz_1
   545 000003C6 BB[47150000]            	mov	ebx, load_32khz_stereo_16_bit
   546 000003CB 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   547 000003D2 751A                    	jne	short chk_32khz_2
   548 000003D4 BB[DD140000]            	mov	ebx, load_32khz_mono_16_bit
   549 000003D9 EB13                    	jmp	short chk_32khz_2
   550                                  chk_32khz_1:
   551 000003DB BB[40140000]            	mov	ebx, load_32khz_stereo_8_bit
   552 000003E0 803D[667D0000]01        	cmp	byte [WAVE_NumChannels], 1
   553 000003E7 7505                    	jne	short chk_32khz_2
   554 000003E9 BB[CD130000]            	mov	ebx, load_32khz_mono_8_bit
   555                                  chk_32khz_2:
   556                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   557 000003EE B8AA2A0000              	mov	eax, 10922
   558                                  	; 17/11/2024
   559                                  	;mov	ax, 10920
   560 000003F3 BA03000000              	mov	edx, 3
   561 000003F8 B902000000              	mov	ecx, 2
   562                                  	;jmp	short set_sizes
   563                                  set_sizes:
   564                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   565                                  	;;;
   566                                  	; 17/11/2024
   567 000003FD 51                      	push	ecx
   568 000003FE B102                    	mov	cl, 2
   569 00000400 2A0D[D67D0000]          	sub	cl, [fbs_shift]
   570                                  		; = 2 for 16 bit stereo
   571                                  		; = 1 for 16 bit mono or 8 bit stereo
   572                                  		; = 0 for 8 bit mono
   573 00000406 D3E0                    	shl	eax, cl
   574 00000408 59                      	pop	ecx	
   575 00000409 A3[E87D0000]            	mov	[loadsize], eax	; (one) read count in bytes
   576                                  	;;;
   577 0000040E F7E2                    	mul	edx
   578 00000410 83F901                  	cmp	ecx, 1
   579 00000413 7402                    	je	short s_2
   580                                  s_1:
   581 00000415 F7F1                    	div	ecx
   582                                  s_2:
   583                                  	;;;
   584                                  	; eax = byte count of (to be) converted samples 
   585                                  	
   586                                  	; 17/11/2024
   587                                  	;;;
   588 00000417 8A0D[D67D0000]          	mov	cl, [fbs_shift]
   589                                  
   590 0000041D D3E0                    	shl	eax, cl
   591                                  		; *1 for 16 bit stereo
   592                                  		; *2 for 16 bit mono or 8 bit stereo
   593                                  		; *4 for for 8 bit mono
   594                                  	;;;
   595                                  
   596                                  	; eax = 16 bit stereo byte count (target buffer size)
   597                                  	
   598                                  	; 07/12/2024
   599                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   600 0000041F A3[EC7D0000]            	mov	[buffersize], eax ; buffer size in bytes
   601 00000424 891D[E47D0000]          	mov	[loadfromwavfile], ebx
   602                                  
   603                                  ; -------------------------------------------------------------
   604                                  
   605                                  Player_Template:
   606                                  	; 21/12/2024
   607 0000042A E80B010000              	call	clearscreen
   608 0000042F E822010000              	call	drawplayingscreen
   609                                  
   610                                  	; 14/11/2024
   611 00000434 E8E61F0000              	call	SetTotalTime
   612 00000439 E8B3200000              	call	UpdateFileInfo
   613                                  
   614                                  ; -------------------------------------------------------------
   615                                  
   616                                  StartPlay:
   617                                  	; 21/12/2024 (VGA/LFB modifications)
   618                                  	; (Direct access/map to the LFB is already done here)
   619                                  	; ((this program is in VESA/VBE graphics mode here))
   620                                  PlayNow:
   621                                  	; 07/12/2024
   622                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000043E BB00020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000443 8B0D[EC7D0000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000449 BA[00800000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000044E B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000453 CD40                <1>  int 40h
   623 00000455 0F82B1000000            	jc	error_exit ; return to text mode and print err msg
   624                                  
   625                                  	; 01/06/2024
   626                                  	; Initialize Audio Device (bh = 3)
   627                                  	sys	_audio, 0301h, 0, audio_int_handler
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000045B BB01030000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000460 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000465 BA[F6070000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000046A B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000046F CD40                <1>  int 40h
   628                                  	;jc	short error_exit
   629 00000471 7279                    	jc	init_err ; return to text mode and print err msg
   630                                  
   631                                  	;;;
   632                                  	; 14/11/2024
   633 00000473 B003                    	mov	al, 3	; 0 = max, 31 = min
   634                                  	; 15/11/2024
   635 00000475 E8A5020000              	call	SetMasterVolume
   636                                  	; 07/12/2024
   637                                  	;call	SetPCMOutVolume
   638 0000047A E8F3200000              	call	UpdateVolume
   639                                  	;;;
   640                                  	;
   641                                  	; 14/11/2024
   642 0000047F E87E210000              	call	UpdateProgressBar
   643                                  	;;;
   644                                  
   645                                   	; 30/05/2024
   646                                  	; playwav4.asm
   647                                  ;_2:	; 24/12/2024
   648                                  	;call	check4keyboardstop	; flush keyboard buffer
   649                                  	;jc	short _2		; 07/11/2023
   650                                  
   651                                  	; 24/12/2024 (setting for wave lighting points)
   652 00000484 A1[30730000]            	mov	eax, [LFB_ADDR]
   653                                  	;add	eax, 228*640 ; wave graphics start (top) line/row
   654 00000489 05009A0100              	add	eax, 164*640 ; 256 volume levels ; 24/12/2024
   655 0000048E A3[2C730000]            	mov	[graphstart], eax
   656                                  
   657                                  ; play the .wav file. Most of the good stuff is in here.
   658                                  	
   659                                  	; 05/12/2024
   660 00000493 E818010000              	call    PlayWav
   661                                  
   662                                  ; close the .wav file and exit.
   663                                  
   664                                  	; 07/12/2024
   665                                  	;;;
   666                                  	; Stop Playing
   667                                  	;sys	_audio, 0700h
   668                                  	; Cancel callback service (for user)
   669                                  	sys	_audio, 0900h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000498 BB00090000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000049D B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004A2 CD40                <1>  int 40h
   670                                  	; Deallocate Audio Buffer (for user)
   671                                  	sys	_audio, 0A00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004A4 BB000A0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004A9 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004AE CD40                <1>  int 40h
   672                                  	; Disable Audio Device
   673                                  	sys	_audio, 0C00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004B0 BB000C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004B5 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004BA CD40                <1>  int 40h
   674                                  	;;;
   675                                  
   676                                  	; 25/12/2024
   677 000004BC E8E8020000              	call	closeFile
   678                                  
   679                                  terminate:
   680 000004C1 E8E3000000              	call	set_text_mode
   681                                  Exit:
   682                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004C6 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 000004CB CD40                <1>  int 40h
   683                                  halt:
   684 000004CD EBFE                    	jmp	short halt
   685                                  
   686                                  ; -------------------------------------------------------------
   687                                  
   688                                  	; 30/05/2024
   689                                  pmsg_usage:
   690                                  	; 21/12/2024
   691 000004CF E8D5000000              	call	set_text_mode
   692                                  	; 01/12/2024
   693                                  	sys	_msg, msg_usage, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004D4 BB[FC280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000004D9 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000004DE BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004E3 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000004E8 CD40                <1>  int 40h
   694 000004EA EBDA                    	jmp	short Exit
   695                                  
   696                                  ; -------------------------------------------------------------
   697                                  
   698                                  	; 30/05/2024
   699                                  init_err:
   700                                  	; 21/12/2024
   701 000004EC E8B8000000              	call	set_text_mode
   702                                  	; 01/12/2024
   703                                  	sys	_msg, msg_init_err, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004F1 BB[7F290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000004F6 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000004FB BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000500 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000505 CD40                <1>  int 40h
   704 00000507 EBBD                    	jmp	short Exit
   705                                  
   706                                  ; -------------------------------------------------------------
   707                                  
   708                                  	; 02/12/2024
   709                                  Player_Quit@:
   710 00000509 58                      	pop	eax ; return addr (call PlayWav@)
   711                                  	
   712                                  	; 29/11/2024
   713                                  Player_Quit:
   714 0000050A EBB5                    	jmp	 short terminate
   715                                  
   716                                  
   717                                  ; -------------------------------------------------------------
   718                                  
   719                                  	; 07/12/2024
   720                                  error_exit:
   721                                  	; 21/12/2024
   722 0000050C E898000000              	call	set_text_mode
   723                                  trdos386_error:
   724                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000511 BB[5F290000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000516 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000051B BA0E000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000520 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000525 CD40                <1>  int 40h
   725 00000527 EB9D                    	jmp	short Exit
   726                                  
   727                                  ; -------------------------------------------------------------
   728                                  
   729                                  	; 21/12/2024
   730                                  print_msg:
   731 00000529 B40E                    	mov	ah, 0Eh
   732 0000052B BB07000000              	mov	ebx, 7
   733                                  	;mov	bl, 7 ; char attribute & color
   734                                  p_next_chr:
   735 00000530 AC                      	lodsb
   736 00000531 08C0                    	or	al, al
   737 00000533 7404                    	jz	short p_retn ; retn
   738 00000535 CD31                    	int	31h
   739 00000537 EBF7                    	jmp	short p_next_chr
   740                                  p_retn:
   741 00000539 C3                      	retn
   742                                  
   743                                  ; -------------------------------------------------------------
   744                                  
   745                                  	; 21/12/2024
   746                                  clearscreen:
   747                                  	; fast clear
   748                                  	; 640*480, 256 colors
   749 0000053A 8B3D[30730000]          	mov	edi, [LFB_ADDR]
   750 00000540 B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   751 00000545 31C0                    	xor	eax, eax
   752 00000547 F3AB                    	rep	stosd
   753 00000549 C3                      	retn
   754                                  
   755                                  ; -------------------------------------------------------------
   756                                  
   757                                  	; 21/12/2024
   758                                  drawsplashscreen:
   759 0000054A BD[DC2A0000]            	mov	ebp, SplashScreen
   760                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   761                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   762                                  	;mov	esi, 0 ; row 0, column 0
   763 0000054F BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   764 00000554 EB0A                    	jmp	short p_d_x
   765                                  drawplayingscreen:
   766 00000556 BD[7D350000]            	mov	ebp, PlayingScreen
   767                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   768                                  	;mov	esi, 0 ; row 0, column 0
   769 0000055B BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   770                                  p_d_x:
   771 00000560 C605[3C730000]50        	mov	byte [columns], 80
   772                                  p_d_x_n:
   773 00000567 31D2                    	xor	edx, edx
   774 00000569 8A5500                  	mov	dl, [ebp]
   775 0000056C 20D2                    	and	dl, dl
   776 0000056E 7438                    	jz	short p_d_x_ok
   777 00000570 C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   778                                  
   779 00000573 BF[E84D0000]            	mov	edi, fontbuff2 ; start of user font data
   780 00000578 01D7                    	add	edi, edx
   781                                  	
   782                                  	;; NOTE: Following system call writes fonts at
   783                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   784                                  	;; screen width as 640 pixels (instead of 320 pixels)
   785                                  	;; so 8Fh is sub function 0Fh (write char)
   786                                  	;; with 640 pixels screen witdh. 
   787                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   788                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   789                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   790                                  	;; region, the text is appeared on screen
   791                                  	;; while LFB is at C0000000h or E0000000h.)
   792                                  
   793                                  	;sys	_video, 018Fh, [tcolor], 8001h
   794                                  			;; use STD VGA video memory
   795                                  			;; (0A0000h)
   796                                  	;sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
   797                                  		 ; use LFB for current VBE mode
   798                                  		 ; for writing fonts on screen
   799                                  	; 26/12/2024
   800                                  	sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000057A BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000057F B90F000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000584 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000589 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000058E CD40                <1>  int 40h
   801                                  
   802 00000590 45                      	inc	ebp
   803 00000591 6683C608                	add	si, 8 ; next char pos
   804 00000595 FE0D[3C730000]          	dec	byte [columns]
   805 0000059B 75CA                    	jnz	short p_d_x_n	; next column
   806 0000059D 6631F6                  	xor	si, si
   807                                  	;;add	esi, 00100000h	; next row ; 8*16
   808                                  	;add	esi, [nextrow]
   809 000005A0 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   810 000005A6 EBB8                    	jmp	short p_d_x
   811                                  p_d_x_ok:
   812 000005A8 C3                      	retn
   813                                  
   814                                  ; -------------------------------------------------------------
   815                                  
   816                                  	; 21/12/2024
   817                                  set_text_mode:
   818 000005A9 30E4                    	xor    ah, ah
   819 000005AB B003                    	mov    al, 3                        
   820                                   	;int   10h ; al = 03h text mode, int 10 video
   821 000005AD CD31                    	int    31h ; TRDOS 386 - Video interrupt
   822 000005AF C3                      	retn
   823                                  
   824                                  ; -------------------------------------------------------------
   825                                  
   826                                  	; 07/12/2024 (playwav9.s)
   827                                  	; 26/11/2023 (playwav8.s)
   828                                  PlayWav:
   829                                  	; 19/11/2024
   830 000005B0 C605[437D0000]01        	mov	byte [wleds], 1
   831                                  
   832                                  	;;;
   833                                  	; 09/12/2024
   834 000005B7 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
   835 000005BC 803D[4E7D0000]00        	cmp	byte [VRA], 0
   836 000005C3 7614                    	jna	short _3 ; 48kHZ (interpolation)
   837                                  	;;;
   838                                  	; 01/12/2024 (32bit)
   839                                  	;movzx	eax, word [WAVE_SampleRate]
   840                                  	; 09/12/2024
   841 000005C5 66A1[687D0000]          	mov	ax, [WAVE_SampleRate]
   842 000005CB B90A000000              	mov	ecx, 10
   843 000005D0 F7E1                    	mul	ecx
   844 000005D2 B1B6                    	mov	cl, 182
   845 000005D4 F7F1                    	div	ecx
   846                                  	; ax = samples per 1/18.2 second
   847                                  	;mov	cl, byte [WAVE_BlockAlign]
   848                                  	; 09/12/2024 
   849                                  	;mov	cl, 4 ; 16 bit, stereo
   850                                  	;mul	ecx
   851 000005D6 C1E002                  	shl	eax, 2 ; * 4
   852                                  _3:
   853 000005D9 A3[447D0000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
   854                                  				; for wave volume leds update
   855                                  				; (byte stream per 1/18.2 second)
   856                                  	;;;
   857                                  	; 24/12/2024
   858 000005DE 3D000A0000              	cmp	eax, 640*4 ; 640 samples (for 640 wave light points)
   859 000005E3 7305                    	jnb	short _4
   860 000005E5 B8000A0000              	mov	eax, 640*4	
   861                                  _4:
   862 000005EA A3[28730000]            	mov	[wpoints_dif], eax
   863                                  	;;;
   864                                  
   865                                  RePlayWav:
   866                                  	; 07/12/2024
   867 000005EF BF[00800000]            	mov	edi, audio_buffer
   868 000005F4 FF15[E47D0000]          	call	dword [loadfromwavfile]
   869 000005FA 0F820CFFFFFF            	jc	error_exit
   870                                  
   871 00000600 C605[4D7D0000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
   872                                  
   873 00000607 A1[F87D0000]            	mov	eax, [count]
   874 0000060C 0105[FC7D0000]          	add	[LoadedDataBytes], eax
   875                                  
   876 00000612 F605[7E7D0000]01        	test    byte [flags], ENDOFFILE  ; end of file
   877 00000619 752C                    	jnz	short _5 ; yes
   878                                  			 ; bypass filling dma half buffer 2
   879                                  
   880                                  	; bh = 16 : update (current, first) dma half buffer
   881                                  	; bl = 0  : then switch to the next (second) half buffer
   882                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000061B BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000620 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000625 CD40                <1>  int 40h
   883                                  
   884                                  	; 18/12/2024
   885 00000627 C705[F87D0000]0000-     	mov	dword [count], 0
   885 0000062F 0000               
   886                                  
   887                                  	; 07/12/2024
   888 00000631 BF[00800000]            	mov	edi, audio_buffer
   889 00000636 FF15[E47D0000]          	call	dword [loadfromwavfile]
   890                                  	;jc	error_exit
   891                                  	
   892 0000063C A1[F87D0000]            	mov	eax, [count]
   893 00000641 0105[FC7D0000]          	add	[LoadedDataBytes], eax
   894                                  _5:
   895                                  	; 07/12/2024
   896 00000647 668B0D[687D0000]         	mov	cx, [WAVE_SampleRate]
   897 0000064E B303                    	mov	bl, 3	; 16 bit, stereo
   898 00000650 B704                    	mov	bh, 4	; start to play
   899                                  	sys	_audio
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000652 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000657 CD40                <1>  int 40h
   900                                  
   901                                  ; -------------------------------------------
   902                                  
   903                                  	; 22/12/2024
   904                                   	; prepare all leds as turned off
   905 00000659 E8A6200000              	call	reset_wave_leds
   906                                  
   907                                  ; -------------------------------------------
   908                                  
   909                                  	; 07/12/2024 (playwav9.s)
   910                                  	; 01/12/2024 (32bit)
   911                                  	; 29/11/2024
   912                                  tuneLoop:
   913                                  	; 30/05/2024
   914                                  	; 18/11/2023 (ich_wav4.asm)
   915                                  	; 08/11/2023
   916                                  	; 06/11/2023
   917                                  tLWait:
   918                                  	; 18/11/2024
   919 0000065E 803D[407D0000]00        	cmp	byte [stopped], 0
   920                                  	; 24/11/2024
   921 00000665 761E                    	jna	short tL1
   922                                  
   923                                  tLWait@:	; 21/11/2024
   924 00000667 E8551B0000              	call	checkUpdateEvents
   925 0000066C 726E                    	jc	_exitt_
   926 0000066E 803D[417D0000]30        	cmp	byte [tLO], '0'
   927 00000675 74E7                    	je	short tLWait
   928 00000677 E86A000000              	call	tLZ
   929 0000067C C605[417D0000]30        	mov	byte [tLO], '0'
   930 00000683 EBD9                    	jmp	short tLWait
   931                                  tL1:
   932                                  	; 27/11/2024
   933                                  	; Check AC'97 interrupt status
   934 00000685 803D[D77D0000]00        	cmp	byte [SRB], 0
   935 0000068C 7709                    	ja	short tL3
   936                                  tL2:
   937 0000068E E82E1B0000              	call	checkUpdateEvents
   938 00000693 7247                    	jc	_exitt_
   939 00000695 EBC7                    	jmp	short tLWait
   940                                  tL3:
   941 00000697 8035[4D7D0000]01        	xor	byte [half_buffer], 1
   942                                  	; 07/12/2024
   943 0000069E C605[D77D0000]00        	mov	byte [SRB], 0
   944                                  
   945                                  	; 07/12/2024
   946 000006A5 BF[00800000]            	mov	edi, audio_buffer
   947                                  	;call	loadFromFile
   948                                  	; 18/11/2023
   949                                  	;call	word [loadfromwavfile]
   950                                  	; 01/12/2024
   951 000006AA FF15[E47D0000]          	call	dword [loadfromwavfile]
   952 000006B0 722A                    	jc	short _exitt_	; end of file
   953                                  
   954                                  	; 07/12/2024
   955                                  	;;;;
   956                                  	; bh = 16 : update (current, first) dma half buffer
   957                                  	; bl = 0  : then switch to the other half buffer
   958                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000006B2 BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000006B7 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000006BC CD40                <1>  int 40h
   959                                  	;;;;
   960                                  
   961                                  	; 26/11/2024
   962 000006BE A0[4D7D0000]            	mov	al, [half_buffer]
   963 000006C3 0431                    	add	al, '1'
   964                                  	; 19/11/2024
   965 000006C5 A2[417D0000]            	mov	[tLO], al
   966 000006CA E819000000              	call	tL0
   967                                  
   968                                  	; 24/11/2024
   969                                  	; 14/11/2024
   970                                  	;mov	ax, [count]
   971                                  	;add	[LoadedDataBytes], ax
   972                                  	;adc	word [LoadedDataBytes+2], 0
   973                                  	; 01/12/2024
   974 000006CF A1[F87D0000]            	mov	eax, [count]
   975 000006D4 0105[FC7D0000]          	add	[LoadedDataBytes], eax
   976                                  
   977                                  	; 07/12/2024 (playwav9.s)
   978                                  	; 27/11/2024 (playwav9.asm)
   979 000006DA EBB2                    	jmp	short tL2
   980                                  
   981                                  _exitt_:
   982                                  	; 07/12/2024
   983                                  	; Stop Playing
   984                                  	;mov	byte [stopped], 2
   985                                  	;sys	_audio, 0700h
   986 000006DC E8A41A0000              	call	ac97_stop
   987                                  
   988                                  	;;;
   989                                  	; 14/11/2024
   990 000006E1 E81C1F0000              	call	UpdateProgressBar
   991                                  	;;;
   992                                  
   993                                  	; 18/11/2024
   994                                  tLZ:
   995                                  	; 30/05/2024
   996 000006E6 B030                    	mov	al, '0'
   997                                  
   998                                  	;add	al, '0'
   999                                  	;call	tL0
  1000                                  	;
  1001                                  	;retn
  1002                                  	; 06/11/2023
  1003                                  	;jmp	short tL0
  1004                                  	;retn
  1005                                  
  1006                                  	; 06/11/2023
  1007                                  tL0:
  1008                                  	; 29/05/2024 (TRDOS 386)
  1009                                  	; 08/11/2023
  1010                                  	; 05/11/2023
  1011                                  	; 17/02/2017 - Buffer switch test (temporary)
  1012                                  	; 06/11/2023
  1013                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1014                                  
  1015                                  	; 22/12/2024 (graphics mode modification)
  1016                                  	; (640*480, 256 colors)
  1017                                  	;;;
  1018                                  	;mov	ebp, 16
  1019 000006E8 BD0E000000              	mov	ebp, 14
  1020 000006ED 8B3D[30730000]          	mov	edi, [LFB_ADDR]
  1021 000006F3 0FB6F0                  	movzx	esi, al
  1022 000006F6 C1E604                  	shl	esi, 4 ; * 16
  1023 000006F9 81C6[E84D0000]          	add	esi, fontbuff2
  1024                                  tL0_1:
  1025 000006FF BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1026 00000704 8A26                    	mov	ah, [esi]
  1027                                  tL0_2:
  1028 00000706 B00C                    	mov	al, 0Ch ; red
  1029 00000708 D0E4                    	shl	ah, 1
  1030 0000070A 7302                    	jnc	short tL0_3
  1031 0000070C B00E                    	mov	al, 0Eh ; yellow
  1032                                  tL0_3:
  1033 0000070E AA                      	stosb
  1034 0000070F 4A                      	dec	edx
  1035 00000710 75F4                    	jnz	short tL0_2
  1036 00000712 4D                      	dec	ebp
  1037 00000713 7409                    	jz	short tL0_4
  1038 00000715 81C778020000            	add	edi, 640-8 ; next line
  1039 0000071B 46                      	inc	esi
  1040 0000071C EBE1                    	jmp	short tL0_1
  1041                                  tL0_4:
  1042                                  	;;;
  1043 0000071E C3                      	retn
  1044                                  
  1045                                  ; -------------------------------------------
  1046                                  
  1047                                  	; 07/12/2024
  1048                                  SetMasterVolume:
  1049                                  	;cmp	al, 31
  1050                                  	;ja	short setvolume_ok
  1051 0000071F A2[03240000]            	mov	[volume], al  ; max = 0, min = 31
  1052                                  
  1053 00000724 B41F                    	mov	ah, 31
  1054 00000726 28C4                    	sub	ah, al
  1055 00000728 88E0                    	mov	al, ah
  1056                                  
  1057                                  	; Set Master Volume Level (BL=0 or 80h)
  1058                                  	; 	for next playing (BL>=80h)
  1059                                  	;sys	_audio, 0B80h, eax
  1060                                  	sys	_audio, 0B00h, eax
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000072A BB000B0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000072F 89C1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000731 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000736 CD40                <1>  int 40h
  1061                                  	
  1062                                  setvolume_ok:
  1063                                  ac97_not_detected:
  1064 00000738 C3                      	retn
  1065                                  
  1066                                  ; -------------------------------------------
  1067                                  
  1068                                  	; 07/12/2024 (playwav9.s)
  1069                                  DetectAC97:
  1070                                  DetectICH:
  1071                                  	; 25/11/2023 (playwav8.s)
  1072                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1073                                          sys	_audio, 0102h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000739 BB02010000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000073E B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000743 CD40                <1>  int 40h
  1074                                  	;jnc	short d_ac97_@
  1075                                  	;retn
  1076 00000745 72F1                    	jc	short ac97_not_detected
  1077                                  d_ac97_@:
  1078                                  	; 07/12/2024 (playwav9.s)
  1079                                  	; 06/06/2017
  1080                                  	sys	_audio, 0E00h ; get audio controller info
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000747 BB000E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000074C B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000751 CD40                <1>  int 40h
  1081 00000753 0F82B3FDFFFF            	jc	error_exit ; 25/11/2023
  1082                                  
  1083                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1084                                  	;jne	_dev_not_ready	
  1085                                  
  1086                                  	; EAX = IRQ Number in AL
  1087                                  	;	Audio Device Number in AH 
  1088                                  	; EBX = DEV/VENDOR ID
  1089                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1090                                  	; ECX = BUS/DEV/FN 
  1091                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1092                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1093                                  	;      (Low word, DX = NAMBAR address)
  1094                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1095                                  
  1096 00000759 891D[DC7D0000]          	mov	[dev_vendor], ebx
  1097 0000075F 890D[D87D0000]          	mov	[bus_dev_fn], ecx
  1098                                  
  1099 00000765 668915[E07D0000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1100                                  	;shr	edx, 16
  1101                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1102 0000076C 8915[E07D0000]          	mov	[NAMBAR], edx
  1103                                  
  1104 00000772 A2[7F7D0000]            	mov	[ac97_int_ln_reg], al
  1105                                  
  1106                                  	; 07/12/2024
  1107                                  	; 01/06/2024
  1108                                  	; 25/11/2023
  1109                                  	; Get AC'97 Codec info
  1110                                  	; (Function 14, sub function 1)
  1111                                  	sys	_audio, 0E01h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000777 BB010E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000077C B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000781 CD40                <1>  int 40h
  1112                                  	; Save Variable Rate Audio support bit
  1113 00000783 2401                    	and	al, 1
  1114 00000785 A2[4E7D0000]            	mov	[VRA], al
  1115                                  
  1116                                  	;clc
  1117                                  
  1118 0000078A C3                      	retn
  1119                                  
  1120                                  ; ----------------------------------
  1121                                  	
  1122                                  	; 01/12/2024
  1123                                  	; 14/11/2024
  1124                                  	; INPUT: ds:dx = file name address
  1125                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1126                                  openFile:
  1127                                  	;mov	ax, 3D00h	; open File for read
  1128                                  	;int	21h
  1129                                  	;jnc	short _of1
  1130                                  	; 01/12/2024 (TRDOS 386)
  1131                                  	;sys	_open, edx, 0
  1132                                  	; 07/12/2024
  1133                                  	sys	_open, wav_file_name, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000078B BB[847D0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000790 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000795 B805000000          <1>  mov eax, %1
    97                              <1> 
    98 0000079A CD40                <1>  int 40h
  1134 0000079C 7305                    	jnc	short _of1
  1135                                  
  1136 0000079E B8FFFFFFFF              	mov	eax, -1
  1137                                  	; cf = 1 -> not found or access error
  1138                                  _of1:
  1139 000007A3 A3[807D0000]            	mov	[filehandle], eax
  1140 000007A8 C3                      	retn
  1141                                  
  1142                                  ; ----------------------------------
  1143                                  
  1144                                  ; close the currently open file
  1145                                  
  1146                                  	; 01/12/2024
  1147                                  	; 14/11/2024
  1148                                  	; INPUT: [filehandle] ; -1 = not open
  1149                                  	; OUTPUT: none
  1150                                  closeFile:
  1151 000007A9 833D[807D0000]FF        	cmp	dword [filehandle], -1
  1152 000007B0 740D                    	jz	short _cf1
  1153                                  	;mov	bx, [filehandle]  
  1154                                  	;mov	ax, 3E00h
  1155                                          ;int	21h              ; close file
  1156                                  	; 01/12/2024
  1157                                  	sys	_close, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007B2 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007B8 B806000000          <1>  mov eax, %1
    97                              <1> 
    98 000007BD CD40                <1>  int 40h
  1158                                  	;mov 	dword [filehandle], -1
  1159                                  _cf1:
  1160 000007BF C3                      	retn
  1161                                  
  1162                                  ; ----------------------------------
  1163                                  
  1164                                  	; 01/12/2024
  1165                                  	; 14/11/2024 - Erdogan Tan
  1166                                  getWAVParameters:
  1167                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1168                                  ; entry: none - assumes file is already open
  1169                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1170                                  ;	cx = number of channels (mono=1, stereo=2)
  1171                                  ;	dx = bits per sample (8, 16)
  1172                                  ;	bx = number of bytes per sample (1 to 4)
  1173                                  
  1174                                          ;mov	dx, WAVFILEHEADERbuff
  1175                                  	;mov	bx, [filehandle]
  1176                                          ;mov	cx, 44			; 44 bytes
  1177                                  	;mov	ah, 3Fh
  1178                                          ;int	21h
  1179                                  	;jc	short gwavp_retn
  1180                                  	; 01/12/2024 (TRDOS 386)
  1181                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007C0 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000007C6 B9[507D0000]        <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000007CB BA2C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007D0 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000007D5 CD40                <1>  int 40h
  1182 000007D7 721C                    	jc	short gwavp_retn
  1183                                  
  1184 000007D9 83F82C                  	cmp	eax, 44
  1185 000007DC 7217                    	jb	short gwavp_retn
  1186                                  
  1187 000007DE 813D[587D0000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1187 000007E6 5645               
  1188 000007E8 750A                    	jne	short gwavp_stc_retn
  1189                                  
  1190 000007EA 66833D[647D0000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1191                                  	;jne	short gwavp_stc_retn
  1192 000007F2 7401                    	je	short gwavp_retn ; 15/11/2024
  1193                                  
  1194                                  	; 15/11/2024
  1195                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1196                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1197                                  	;mov	dx, [WAVE_BitsPerSample] 
  1198                                  					; return bits per sample value in DX
  1199                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1200                                  ;gwavp_retn:
  1201                                          ;retn
  1202                                  
  1203                                  gwavp_stc_retn:
  1204 000007F4 F9                      	stc
  1205                                  gwavp_retn:
  1206 000007F5 C3                      	retn
  1207                                  
  1208                                  ; --------------------------------------------------------
  1209                                  ; 07/12/2024
  1210                                  ; --------------------------------------------------------
  1211                                  ; ref: playwav8.s (04/06/2024)
  1212                                  
  1213                                  audio_int_handler:
  1214                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1215                                  
  1216                                  	; 07/12/2024
  1217                                  	;mov	al, [stopped]
  1218                                  	;cmp	al, 2
  1219                                  	;je	short _callback_retn
  1220                                  
  1221                                  	; 18/08/2020
  1222                                  	;mov	byte [SRB], 1
  1223                                  	; 07/12/2024
  1224 000007F6 FE05[D77D0000]          	inc	byte [SRB]
  1225                                  
  1226                                  ;_callback_retn:
  1227                                  	sys	_rele ; return from callback service 
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007FC B827000000          <1>  mov eax, %1
    97                              <1> 
    98 00000801 CD40                <1>  int 40h
  1228                                  	; we must not come here !
  1229                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000803 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 00000808 CD40                <1>  int 40h
  1230                                  
  1231                                  ; --------------------------------------------------------
  1232                                  ; 07/12/2024
  1233                                  ; --------------------------------------------------------
  1234                                  
  1235                                  ; /////
  1236                                  	; 14/12/2024
  1237                                  	; 07/12/2024
  1238                                  	; 01/12/2024
  1239                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1240                                  loadFromFile:
  1241                                  	; 07/11/2023
  1242                                  
  1243 0000080A F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1244                                  					; last of the file?
  1245 00000811 7402                    	jz	short lff_0		; no
  1246 00000813 F9                      	stc
  1247 00000814 C3                      	retn
  1248                                  
  1249                                  lff_0:
  1250                                  	; 07/12/2024
  1251                                  	; 26/11/2023 (playwav8.s)
  1252                                  	;mov	edi, audio_buffer
  1253                                  
  1254                                  	; 01/12/2024 (TRDOS 386)
  1255                                  	; edi = audio buffer address
  1256                                  
  1257                                  	; 14/12/2024
  1258                                  	; 01/12/2024
  1259                                  	; 17/11/2024
  1260                                  	;mov	ebx, [filehandle]
  1261                                  	; 02/12/2024
  1262                                  	;mov	edx, [loadsize] 
  1263                                  
  1264                                  	; 17/11/2024
  1265 00000815 803D[D67D0000]00        	cmp	byte [fbs_shift], 0
  1266 0000081C 7677                    	jna	short lff_1 ; stereo, 16 bit
  1267                                  
  1268                                  lff_2:
  1269                                  	; 01/12/2024
  1270 0000081E BE[00800100]            	mov	esi, temp_buffer 
  1271                                  	; 14/12/2024
  1272                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000823 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000829 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000082B 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000831 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000836 CD40                <1>  int 40h
  1273 00000838 0F8289000000            	jc	lff_4 ; error !
  1274                                  
  1275                                  	; 01/12/2024
  1276                                  	; 14/11/2024
  1277 0000083E A3[F87D0000]            	mov	[count], eax
  1278                                  
  1279                                  	; 01/12/2024
  1280 00000843 21C0                    	and	eax, eax
  1281                                  	;jz	short lff_3
  1282                                  	; 14/12/2024
  1283 00000845 0F8485000000            	jz	lff_10
  1284                                  
  1285 0000084B 8A1D[D67D0000]          	mov	bl, [fbs_shift]
  1286                                  
  1287                                  	; 14/12/2024
  1288 00000851 89FA                    	mov	edx, edi ; audio buffer start address
  1289                                  
  1290                                  	; 01/12/2024
  1291 00000853 89C1                    	mov	ecx, eax
  1292 00000855 803D[727D0000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1293 0000085C 751E                    	jne	short lff_7 ; 16 bit samples
  1294                                  	; 8 bit samples
  1295 0000085E FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1296 00000860 740E                    	jz	short lff_6 ; 8 bit, stereo
  1297                                  	; 01/12/2024 (32bit registers)
  1298                                  lff_5:
  1299                                  	; mono & 8 bit
  1300 00000862 AC                      	lodsb
  1301 00000863 2C80                    	sub	al, 80h ; 08/11/2023
  1302 00000865 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1303 00000868 66AB                    	stosw	; left channel
  1304 0000086A 66AB                    	stosw	; right channel
  1305 0000086C E2F4                    	loop	lff_5
  1306 0000086E EB16                    	jmp	short lff_9
  1307                                  lff_6:
  1308                                  	; stereo & 8 bit
  1309 00000870 AC                      	lodsb
  1310 00000871 2C80                    	sub	al, 80h ; 08/11/2023
  1311 00000873 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1312 00000876 66AB                    	stosw
  1313 00000878 E2F6                    	loop	lff_6
  1314 0000087A EB0A                    	jmp	short lff_9
  1315                                  lff_7:
  1316 0000087C D1E9                    	shr	ecx, 1 ; word count
  1317                                  lff_8:
  1318 0000087E 66AD                    	lodsw
  1319 00000880 66AB                    	stosw	; left channel
  1320 00000882 66AB                    	stosw	; right channel
  1321 00000884 E2F8                    	loop	lff_8
  1322                                  lff_9:
  1323                                  	; 14/12/2024
  1324 00000886 89F8                    	mov	eax, edi
  1325 00000888 8B0D[EC7D0000]          	mov	ecx, [buffersize] 
  1326 0000088E 01D1                    	add	ecx, edx ; + buffer start address
  1327 00000890 39C8                    	cmp	eax, ecx	
  1328 00000892 7225                    	jb	short lff_3
  1329 00000894 C3                      	retn
  1330                                  	
  1331                                  lff_1:  
  1332                                  	; 07/12/2024
  1333                                  	; 01/12/2024
  1334                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1335                                  	; 14/12/2024
  1336                                  	sys 	_read, [filehandle], edi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000895 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000089B 89F9                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000089D 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008A3 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000008A8 CD40                <1>  int 40h
  1337                                  	; 07/11/2023
  1338 000008AA 721B                    	jc	short lff_4 ; error !
  1339                                  
  1340                                  	; 01/12/2024
  1341                                  	; 14/11/2024
  1342 000008AC A3[F87D0000]            	mov	[count], eax
  1343                                  
  1344                                  	; 02/12/2024
  1345 000008B1 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1346 000008B3 7411                    	je	short endLFF
  1347                                  	; edi = buffer (start) address
  1348 000008B5 01C7                    	add	edi, eax
  1349 000008B7 89D1                    	mov	ecx, edx
  1350                                  lff_3:
  1351                                  	;call	padfill			; blank pad the remainder
  1352                                  	; 21/12/2024
  1353                                  padfill:
  1354                                  	; 14/12/2024
  1355                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1356                                  	; 17/11/2024
  1357                                  	;   di = offset (to be filled with ZEROs)
  1358                                  	;   bp = buffer segment
  1359                                  	;   ax = di = number of bytes loaded
  1360                                  	;   cx = buffer size (> loaded bytes)	
  1361                                  	; 07/11/2023
  1362                                  	; 06/11/2023
  1363                                  	; 17/02/2017
  1364                                  	; 01/12/2024
  1365 000008B9 29C1                    	sub	ecx, eax
  1366                                  	; 01/12/2024
  1367                                  	; 25/11/2024
  1368 000008BB 31C0                    	xor	eax, eax
  1369                                  	; 14/12/2024
  1370 000008BD F3AA                    	rep	stosb
  1371                                  	; 21/12/2024
  1372                                  	;retn
  1373                                  	; ----------
  1374                                          ;clc				; don't exit with CY yet.
  1375 000008BF 800D[7E7D0000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1376                                  endLFF:
  1377 000008C6 C3                              retn
  1378                                  lff_4:
  1379                                  	; 08/11/2023
  1380 000008C7 B021                    	mov	al, '!'  ; error
  1381 000008C9 E81AFEFFFF              	call	tL0
  1382                                  
  1383                                  	; 01/12/2024
  1384 000008CE 31C0                    	xor	eax, eax
  1385                                  lff_10:
  1386                                  	; 14/12/2024
  1387 000008D0 8B0D[EC7D0000]          	mov	ecx, [buffersize]
  1388 000008D6 EBE1                    	jmp	short lff_3
  1389                                  
  1390                                  ; /////
  1391                                  
  1392                                  ; --------------------------------------------------------
  1393                                  ; --------------------------------------------------------
  1394                                  	
  1395                                  write_audio_dev_info:
  1396                                  	; 30/05/2024
  1397                                       	;sys_msg msgAudioCardInfo, 0Fh
  1398                                  	; 01/12/2024
  1399                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008D8 BB[D3280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000008DD B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000008E2 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008E7 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000008EC CD40                <1>  int 40h
  1400 000008EE C3                      	retn
  1401                                  
  1402                                  ; --------------------------------------------------------
  1403                                  
  1404                                  write_ac97_pci_dev_info:
  1405                                  	; 19/11/2024
  1406                                  	; 30/05/2024
  1407                                  	; 06/06/2017
  1408                                  	; 03/06/2017
  1409                                  	; BUS/DEV/FN
  1410                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1411                                  	; DEV/VENDOR
  1412                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1413                                  
  1414 000008EF A1[DC7D0000]            	mov	eax, [dev_vendor]
  1415 000008F4 31DB                    	xor	ebx, ebx
  1416 000008F6 88C3                    	mov	bl, al
  1417 000008F8 88DA                    	mov	dl, bl
  1418 000008FA 80E30F                  	and	bl, 0Fh
  1419 000008FD 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1420 00000903 A2[302A0000]            	mov	[msgVendorId+3], al
  1421 00000908 88D3                    	mov	bl, dl
  1422 0000090A C0EB04                  	shr	bl, 4
  1423 0000090D 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1424 00000913 A2[2F2A0000]            	mov	[msgVendorId+2], al
  1425 00000918 88E3                    	mov	bl, ah
  1426 0000091A 88DA                    	mov	dl, bl
  1427 0000091C 80E30F                  	and	bl, 0Fh
  1428 0000091F 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1429 00000925 A2[2E2A0000]            	mov	[msgVendorId+1], al
  1430 0000092A 88D3                    	mov	bl, dl
  1431 0000092C C0EB04                  	shr	bl, 4
  1432 0000092F 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1433 00000935 A2[2D2A0000]            	mov	[msgVendorId], al
  1434 0000093A C1E810                  	shr	eax, 16
  1435 0000093D 88C3                    	mov	bl, al
  1436 0000093F 88DA                    	mov	dl, bl
  1437 00000941 80E30F                  	and	bl, 0Fh
  1438 00000944 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1439 0000094A A2[412A0000]            	mov	[msgDevId+3], al
  1440 0000094F 88D3                    	mov	bl, dl
  1441 00000951 C0EB04                  	shr	bl, 4
  1442 00000954 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1443 0000095A A2[402A0000]            	mov	[msgDevId+2], al
  1444 0000095F 88E3                    	mov	bl, ah
  1445 00000961 88DA                    	mov	dl, bl
  1446 00000963 80E30F                  	and	bl, 0Fh
  1447 00000966 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1448 0000096C A2[3F2A0000]            	mov	[msgDevId+1], al
  1449 00000971 88D3                    	mov	bl, dl
  1450 00000973 C0EB04                  	shr	bl, 4
  1451 00000976 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1452 0000097C A2[3E2A0000]            	mov	[msgDevId], al
  1453                                  
  1454 00000981 A1[D87D0000]            	mov	eax, [bus_dev_fn]
  1455 00000986 C1E808                  	shr	eax, 8
  1456 00000989 88C3                    	mov	bl, al
  1457 0000098B 88DA                    	mov	dl, bl
  1458 0000098D 80E307                  	and	bl, 7 ; bit 0,1,2
  1459 00000990 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1460 00000996 A2[662A0000]            	mov	[msgFncNo+1], al
  1461 0000099B 88D3                    	mov	bl, dl
  1462 0000099D C0EB03                  	shr	bl, 3
  1463 000009A0 88DA                    	mov	dl, bl
  1464 000009A2 80E30F                  	and	bl, 0Fh
  1465 000009A5 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1466 000009AB A2[582A0000]            	mov	[msgDevNo+1], al
  1467 000009B0 88D3                    	mov	bl, dl
  1468 000009B2 C0EB04                  	shr	bl, 4
  1469 000009B5 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1470 000009BB A2[572A0000]            	mov	[msgDevNo], al
  1471 000009C0 88E3                    	mov	bl, ah
  1472 000009C2 88DA                    	mov	dl, bl
  1473 000009C4 80E30F                  	and	bl, 0Fh
  1474 000009C7 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1475 000009CD A2[4C2A0000]            	mov	[msgBusNo+1], al
  1476 000009D2 88D3                    	mov	bl, dl
  1477 000009D4 C0EB04                  	shr	bl, 4
  1478 000009D7 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1479 000009DD A2[4B2A0000]            	mov	[msgBusNo], al
  1480                                  
  1481                                  	;mov	ax, [ac97_NamBar]
  1482 000009E2 66A1[E07D0000]          	mov	ax, [NAMBAR]
  1483 000009E8 88C3                    	mov	bl, al
  1484 000009EA 88DA                    	mov	dl, bl
  1485 000009EC 80E30F                  	and	bl, 0Fh
  1486 000009EF 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1487 000009F5 A2[762A0000]            	mov	[msgNamBar+3], al
  1488 000009FA 88D3                    	mov	bl, dl
  1489 000009FC C0EB04                  	shr	bl, 4
  1490 000009FF 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1491 00000A05 A2[752A0000]            	mov	[msgNamBar+2], al
  1492 00000A0A 88E3                    	mov	bl, ah
  1493 00000A0C 88DA                    	mov	dl, bl
  1494 00000A0E 80E30F                  	and	bl, 0Fh
  1495 00000A11 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1496 00000A17 A2[742A0000]            	mov	[msgNamBar+1], al
  1497 00000A1C 88D3                    	mov	bl, dl
  1498 00000A1E C0EB04                  	shr	bl, 4
  1499 00000A21 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1500 00000A27 A2[732A0000]            	mov	[msgNamBar], al
  1501                                  
  1502                                  	;mov	ax, [ac97_NabmBar]
  1503 00000A2C 66A1[E27D0000]          	mov	ax, [NABMBAR]
  1504 00000A32 88C3                    	mov	bl, al
  1505 00000A34 88DA                    	mov	dl, bl
  1506 00000A36 80E30F                  	and	bl, 0Fh
  1507 00000A39 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1508 00000A3F A2[862A0000]            	mov	[msgNabmBar+3], al
  1509 00000A44 88D3                    	mov	bl, dl
  1510 00000A46 C0EB04                  	shr	bl, 4
  1511 00000A49 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1512 00000A4F A2[852A0000]            	mov	[msgNabmBar+2], al
  1513 00000A54 88E3                    	mov	bl, ah
  1514 00000A56 88DA                    	mov	dl, bl
  1515 00000A58 80E30F                  	and	bl, 0Fh
  1516 00000A5B 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1517 00000A61 A2[842A0000]            	mov	[msgNabmBar+1], al
  1518 00000A66 88D3                    	mov	bl, dl
  1519 00000A68 C0EB04                  	shr	bl, 4
  1520 00000A6B 8A83[E9290000]          	mov	al, [hex_chars+ebx]
  1521 00000A71 A2[832A0000]            	mov	[msgNabmBar], al
  1522                                  
  1523 00000A76 31C0                    	xor	eax, eax
  1524 00000A78 A0[7F7D0000]            	mov	al, [ac97_int_ln_reg]
  1525 00000A7D B10A                    	mov	cl, 10
  1526 00000A7F F6F1                    	div	cl
  1527                                  	; 23/11/2024
  1528                                  	;add	[msgIRQ], ax
  1529 00000A81 66053030                	add	ax, 3030h
  1530 00000A85 66A3[8F2A0000]          	mov	[msgIRQ], ax
  1531                                  	;and	al, al
  1532 00000A8B 3C30                    	cmp	al, 30h
  1533 00000A8D 750D                    	jnz	short _w_ac97imsg_
  1534 00000A8F A0[902A0000]            	mov	al, byte [msgIRQ+1]
  1535 00000A94 B420                    	mov	ah, ' '
  1536 00000A96 66A3[8F2A0000]          	mov	[msgIRQ], ax
  1537                                  _w_ac97imsg_:
  1538                                  	; 19/11/2024
  1539 00000A9C E8481C0000              	call 	clear_window
  1540 00000AA1 B60D                    	mov	dh, 13
  1541 00000AA3 B200                    	mov	dl, 0
  1542 00000AA5 E85A190000              	call	setCursorPosition
  1543                                  	;;;
  1544                                  	; 21/12/2024
  1545 00000AAA BD[FA290000]            	mov	ebp, msgAC97Info ; message
  1546                                  	; 22/12/2024
  1547                                  	;mov	cl, 07h ; color 
  1548 00000AAF E81F000000              	call	sys_gmsg
  1549                                  	;
  1550                                  	; 30/05/2024
  1551                                  write_VRA_info:
  1552                                  	; 21/12/2024
  1553 00000AB4 BD[942A0000]            	mov	ebp, msgVRAheader ; message
  1554                                  	;mov	cl, 07h ; color 
  1555 00000AB9 E815000000              	call	sys_gmsg
  1556                                  	;
  1557 00000ABE 803D[4E7D0000]00        	cmp	byte [VRA], 0
  1558 00000AC5 7607                    	jna	short _w_VRAi_no
  1559                                  _w_VRAi_yes:
  1560 00000AC7 BD[A32A0000]            	mov	ebp, msgVRAyes
  1561 00000ACC EB05                    	jmp	short _w_VRAi_yn_msg
  1562                                  _w_VRAi_no:
  1563 00000ACE BD[A92A0000]            	mov	ebp, msgVRAno
  1564                                  _w_VRAi_yn_msg:
  1565                                  	;mov	cl, 07h ; color 
  1566                                  	;call	sys_msg
  1567                                  	;retn
  1568                                  	;jmp	short sys_gmsg
  1569                                  	;;;
  1570                                  ; --------------------------------------------------------
  1571                                  
  1572                                  	; 22/12/2024
  1573                                  	;;;
  1574                                  	; 21/12/2024
  1575                                  	; (write message in VGA/VESA-VBE mode)
  1576                                  sys_gmsg:
  1577 00000AD3 8A4500                  	mov	al, [ebp]
  1578 00000AD6 20C0                    	and	al, al
  1579 00000AD8 7458                    	jz	short sys_gmsg_ok
  1580 00000ADA 3C20                    	cmp	al, 20h
  1581 00000ADC 731E                    	jnb	short sys_gmsg_3
  1582 00000ADE 3C0D                    	cmp	al, CR ; 13
  1583 00000AE0 750C                    	jne	short sys_gmsg_2
  1584                                  	; carriege return, move cursor to column 0
  1585 00000AE2 66C705[34730000]00-     	mov	word [screenpos], 0
  1585 00000AEA 00                 
  1586                                  sys_gmsg_1:
  1587 00000AEB 45                      	inc	ebp
  1588 00000AEC EBE5                    	jmp	short sys_gmsg
  1589                                  sys_gmsg_2:
  1590 00000AEE 3C0A                    	cmp	al, LF ; 10
  1591 00000AF0 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1592                                  	; line feed, move cursor to next row
  1593 00000AF2 668305[36730000]10      	add	word [screenpos+2], 16
  1594 00000AFA EBEF                    	jmp	short sys_gmsg_1
  1595                                  sys_gmsg_3:
  1596 00000AFC 8B35[34730000]          	mov	esi, [screenpos]
  1597                                  		; hw = (cursor) row
  1598                                  		; si = (cursor) column
  1599 00000B02 B907000000              	mov	ecx, 07h ; gray (light)
  1600 00000B07 E8B11A0000              	call	write_character
  1601 00000B0C 83C608                  	add	esi, 8
  1602                                  	;;;
  1603 00000B0F 6681FE8002              	cmp	si, 640
  1604 00000B14 7213                    	jb	short sys_gmsg_5
  1605 00000B16 C1EE10                  	shr	esi, 16
  1606 00000B19 6683C610                	add	si, 16
  1607 00000B1D 6681FEE001              	cmp	si, 480
  1608 00000B22 7202                    	jb	short sys_gmsg_4
  1609 00000B24 31F6                    	xor	esi, esi
  1610                                  sys_gmsg_4:
  1611 00000B26 C1E610                  	shl	esi, 16
  1612                                  	;;;
  1613                                  sys_gmsg_5:
  1614 00000B29 8935[34730000]          	mov	[screenpos], esi
  1615 00000B2F 45                      	inc	ebp
  1616 00000B30 EBA1                    	jmp	short sys_gmsg
  1617                                  sys_gmsg_ok:
  1618 00000B32 C3                      	retn
  1619                                  	;;;
  1620                                  
  1621                                  ; --------------------------------------------------------
  1622                                  
  1623                                  ; 07/12/2024 - playwav9.s
  1624                                  ; 01/12/2024 - ac97play.s
  1625                                  ; 29/05/2024
  1626                                  ; 26/11/2023
  1627                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1628                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1629                                  ; 14/11/2023
  1630                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1631                                  ; --------------------------------------------------------
  1632                                  
  1633                                  ;;Note:	At the end of every buffer load,
  1634                                  ;;	during buffer switch/swap, there will be discontinuity
  1635                                  ;;	between the last converted sample and the 1st sample
  1636                                  ;;	of the next buffer.
  1637                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1638                                  ;;	-To avoid this defect, the 1st sample of
  1639                                  ;;	the next buffer may be read from the wav file but
  1640                                  ;;	the file pointer would need to be set to 1 sample back
  1641                                  ;;	again via seek system call. Time comsumption problem! -
  1642                                  ;;
  1643                                  ;;	Erdogan Tan - 15/11/2023
  1644                                  ;;
  1645                                  ;;	((If entire wav data would be loaded at once.. conversion
  1646                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1647                                  ;;	64KB buffer limit is important also it is important
  1648                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1649                                  ;;	I have tested this program by using 2-30MB wav files.))
  1650                                  ;;
  1651                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1652                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1653                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1654                                  ;;			Realtek ALC850 codec.
  1655                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1656                                  
  1657                                  load_8khz_mono_8_bit:
  1658                                  	; 15/11/2023
  1659                                  	; 14/11/2023
  1660                                  	; 13/11/2023
  1661 00000B33 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1662                                  					; last of the file?
  1663 00000B3A 7402                    	jz	short lff8m_0		; no
  1664 00000B3C F9                      	stc
  1665 00000B3D C3                      	retn
  1666                                  
  1667                                  lff8m_0:
  1668                                  	; 01/12/2024
  1669                                  	; edi = audio buffer address
  1670 00000B3E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1671                                          ;mov	edx, [loadsize]
  1672                                  
  1673                                  	; esi = buffer address
  1674                                  	;; edx = buffer size
  1675                                  
  1676                                  	; load file into memory
  1677                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000B43 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000B49 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000B4B 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000B51 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000B56 CD40                <1>  int 40h
  1678 00000B58 7305                    	jnc	short lff8m_6
  1679 00000B5A E9AF000000              	jmp	lff8m_5  ; error !
  1680                                  
  1681                                  lff8m_6:
  1682                                  	; 01/12/2024
  1683 00000B5F A3[F87D0000]            	mov	[count], eax
  1684                                  	;;;
  1685                                  	; 07/12/2024
  1686                                  	;mov	edi, audio_buffer
  1687                                  	;;;
  1688 00000B64 21C0                    	and	eax, eax
  1689 00000B66 0F8499000000            	jz	lff8_eof
  1690                                  
  1691 00000B6C 89C1                    	mov	ecx, eax		; byte count
  1692                                  lff8m_1:
  1693 00000B6E AC                      	lodsb
  1694 00000B6F A2[7C210000]            	mov	[previous_val], al
  1695 00000B74 2C80                    	sub	al, 80h
  1696 00000B76 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1697 00000B7A 66AB                    	stosw		; original sample (left channel)
  1698 00000B7C 66AB                    	stosw		; original sample (right channel)
  1699                                  	;xor	eax, eax
  1700 00000B7E B080                    	mov	al, 80h
  1701 00000B80 49                      	dec	ecx
  1702 00000B81 7402                    	jz	short lff8m_2
  1703 00000B83 8A06                    	mov	al, [esi]
  1704                                  lff8m_2:
  1705                                  	;mov	[next_val], ax
  1706 00000B85 88C7                    	mov	bh, al	; [next_val]
  1707 00000B87 8A25[7C210000]          	mov	ah, [previous_val]
  1708 00000B8D 00E0                    	add	al, ah	; [previous_val]
  1709 00000B8F D0D8                    	rcr	al, 1
  1710 00000B91 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1711 00000B93 00E0                    	add	al, ah	; [previous_val]
  1712 00000B95 D0D8                    	rcr	al, 1	
  1713 00000B97 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1714 00000B99 00E0                    	add	al, ah	; [previous_val]
  1715 00000B9B D0D8                    	rcr	al, 1
  1716 00000B9D 2C80                    	sub	al, 80h
  1717 00000B9F 66C1E008                	shl	ax, 8	
  1718 00000BA3 66AB                    	stosw		; this is 1st interpolated sample (L)
  1719 00000BA5 66AB                    	stosw		; this is 1st interpolated sample (R)
  1720 00000BA7 88D8                    	mov	al, bl
  1721 00000BA9 00D0                    	add	al, dl
  1722 00000BAB D0D8                    	rcr	al, 1
  1723 00000BAD 2C80                    	sub	al, 80h
  1724 00000BAF 66C1E008                	shl	ax, 8
  1725 00000BB3 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1726 00000BB5 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1727 00000BB7 88D0                    	mov	al, dl
  1728 00000BB9 2C80                    	sub	al, 80h
  1729 00000BBB 66C1E008                	shl	ax, 8
  1730 00000BBF 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1731 00000BC1 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1732                                  	;mov	al, [next_val]
  1733 00000BC3 88F8                    	mov	al, bh
  1734 00000BC5 00D0                    	add	al, dl
  1735 00000BC7 D0D8                    	rcr	al, 1
  1736 00000BC9 88C3                    	mov	bl, al	; this is temporary interpolation value
  1737 00000BCB 00D0                    	add	al, dl
  1738 00000BCD D0D8                    	rcr	al, 1
  1739 00000BCF 2C80                    	sub	al, 80h
  1740 00000BD1 66C1E008                	shl	ax, 8
  1741 00000BD5 66AB                    	stosw		; this is 4th interpolated sample (L)
  1742 00000BD7 66AB                    	stosw		; this is 4th interpolated sample (R)
  1743                                  	;mov	al, [next_val]
  1744 00000BD9 88F8                    	mov	al, bh
  1745 00000BDB 00D8                    	add	al, bl
  1746 00000BDD D0D8                    	rcr	al, 1
  1747 00000BDF 2C80                    	sub	al, 80h
  1748 00000BE1 66C1E008                	shl	ax, 8
  1749 00000BE5 66AB                    	stosw		; this is 5th interpolated sample (L)
  1750 00000BE7 66AB                    	stosw		; this is 5th interpolated sample (R)
  1751                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1752 00000BE9 09C9                    	or	ecx, ecx
  1753 00000BEB 7581                    	jnz	short lff8m_1
  1754                                  
  1755                                  	; --------------
  1756                                  
  1757                                  lff8s_3:
  1758                                  lff8m_3:
  1759                                  lff8s2_3:
  1760                                  lff8m2_3:
  1761                                  lff16s_3:
  1762                                  lff16m_3:
  1763                                  lff16s2_3:
  1764                                  lff16m2_3:
  1765                                  lff24_3:
  1766                                  lff32_3:
  1767                                  lff44_3:
  1768                                  lff22_3:
  1769                                  lff11_3:
  1770                                  	; 08/12/2024 (BugFix)
  1771                                  	; 31/05/2024 (BugFix)
  1772 00000BED 8B0D[EC7D0000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  1773                                  	;shl	ecx, 1	; byte count ; Bug !
  1774                                  	; 08/12/2024
  1775 00000BF3 81C1[00800000]          	add	ecx, audio_buffer
  1776 00000BF9 29F9                    	sub	ecx, edi
  1777 00000BFB 7607                    	jna	short lff8m_4
  1778                                  	;inc	ecx
  1779 00000BFD C1E902                  	shr	ecx, 2
  1780 00000C00 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  1781 00000C02 F3AB                    	rep	stosd
  1782                                  lff8m_4:
  1783                                  	; 31/05/2024 (BugFix)
  1784                                  	; cf=1 ; Bug !
  1785                                  	; 08/12/2024
  1786                                  	;clc
  1787 00000C04 C3                      	retn
  1788                                  
  1789                                  lff8_eof:
  1790                                  lff16_eof:
  1791                                  lff24_eof:
  1792                                  lff32_eof:
  1793                                  lff44_eof:
  1794                                  lff22_eof:
  1795                                  lff11_eof:
  1796                                  	; 15/11/2023
  1797 00000C05 C605[7E7D0000]01        	mov	byte [flags], ENDOFFILE
  1798 00000C0C EBDF                    	jmp	short lff8m_3
  1799                                  
  1800                                  lff8s_5:
  1801                                  lff8m_5:
  1802                                  lff8s2_5:
  1803                                  lff8m2_5:
  1804                                  lff16s_5:
  1805                                  lff16m_5:
  1806                                  lff16s2_5:
  1807                                  lff16m2_5:
  1808                                  lff24_5:
  1809                                  lff32_5:
  1810                                  lff44_5:
  1811                                  lff22_5:
  1812                                  lff11_5:
  1813 00000C0E B021                    	mov	al, '!'  ; error
  1814 00000C10 E8D3FAFFFF              	call	tL0
  1815                                  	
  1816                                  	;jmp	short lff8m_3
  1817                                  	; 15/11/2023
  1818 00000C15 EBEE                    	jmp	lff8_eof
  1819                                  
  1820                                  	; --------------
  1821                                  
  1822                                  load_8khz_stereo_8_bit:
  1823                                  	; 15/11/2023
  1824                                  	; 14/11/2023
  1825                                  	; 13/11/2023
  1826 00000C17 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1827                                  					; last of the file?
  1828 00000C1E 7402                    	jz	short lff8s_0		; no
  1829 00000C20 F9                      	stc
  1830 00000C21 C3                      	retn
  1831                                  
  1832                                  lff8s_0:
  1833                                  	; 01/12/2024
  1834                                  	; edi = audio buffer address
  1835 00000C22 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1836                                          ;mov	edx, [loadsize]
  1837                                  
  1838                                  	; esi = buffer address
  1839                                  	;; edx = buffer size
  1840                                  
  1841                                  	; load file into memory
  1842                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000C27 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000C2D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000C2F 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000C35 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000C3A CD40                <1>  int 40h
  1843 00000C3C 72D0                    	jc	short lff8s_5 ; error !
  1844                                  
  1845                                  	; 01/12/2024
  1846 00000C3E A3[F87D0000]            	mov	[count], eax
  1847                                  	;;;
  1848                                  	; 07/12/2024
  1849                                  	;mov	edi, audio_buffer
  1850                                  	;;;
  1851 00000C43 D1E8                    	shr	eax, 1
  1852 00000C45 74BE                    	jz	short lff8_eof
  1853                                  
  1854 00000C47 89C1                    	mov	ecx, eax	; word count
  1855                                  lff8s_1:
  1856 00000C49 AC                      	lodsb
  1857 00000C4A A2[7C210000]            	mov	[previous_val_l], al
  1858 00000C4F 2C80                    	sub	al, 80h
  1859 00000C51 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1860 00000C55 66AB                    	stosw		; original sample (L)
  1861 00000C57 AC                      	lodsb
  1862 00000C58 A2[7E210000]            	mov	[previous_val_r], al
  1863 00000C5D 2C80                    	sub	al, 80h
  1864 00000C5F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1865 00000C63 66AB                    	stosw		; original sample (R)
  1866                                  
  1867                                  	;xor	eax, eax
  1868 00000C65 66B88080                	mov	ax, 8080h
  1869 00000C69 49                      	dec	ecx
  1870 00000C6A 7403                    	jz	short lff8s_2
  1871                                  		; convert 8 bit sample to 16 bit sample
  1872 00000C6C 668B06                  	mov	ax, [esi]
  1873                                  lff8s_2:
  1874 00000C6F A2[80210000]            	mov	[next_val_l], al
  1875 00000C74 8825[82210000]          	mov	[next_val_r], ah
  1876 00000C7A 8A25[7C210000]          	mov	ah, [previous_val_l]
  1877 00000C80 00E0                    	add	al, ah
  1878 00000C82 D0D8                    	rcr	al, 1
  1879 00000C84 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  1880 00000C86 00E0                    	add	al, ah
  1881 00000C88 D0D8                    	rcr	al, 1
  1882 00000C8A 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1883 00000C8C 00E0                    	add	al, ah
  1884 00000C8E D0D8                    	rcr	al, 1
  1885 00000C90 2C80                    	sub	al, 80h
  1886 00000C92 66C1E008                	shl	ax, 8
  1887 00000C96 66AB                    	stosw		; this is 1st interpolated sample (L)
  1888 00000C98 A0[82210000]            	mov	al, [next_val_r]
  1889 00000C9D 8A25[7E210000]          	mov	ah, [previous_val_r]
  1890 00000CA3 00E0                    	add	al, ah
  1891 00000CA5 D0D8                    	rcr	al, 1
  1892 00000CA7 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  1893 00000CA9 00E0                    	add	al, ah
  1894 00000CAB D0D8                    	rcr	al, 1
  1895 00000CAD 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1896 00000CAF 00E0                    	add	al, ah
  1897 00000CB1 D0D8                    	rcr	al, 1
  1898 00000CB3 2C80                    	sub	al, 80h
  1899 00000CB5 66C1E008                	shl	ax, 8
  1900 00000CB9 66AB                    	stosw		; this is 1st interpolated sample (R)
  1901 00000CBB 88D8                    	mov	al, bl
  1902 00000CBD 00D0                    	add	al, dl
  1903 00000CBF D0D8                    	rcr	al, 1
  1904 00000CC1 2C80                    	sub	al, 80h
  1905 00000CC3 66C1E008                	shl	ax, 8
  1906 00000CC7 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1907 00000CC9 88F8                    	mov	al, bh
  1908 00000CCB 00F0                    	add	al, dh
  1909 00000CCD D0D8                    	rcr	al, 1
  1910 00000CCF 2C80                    	sub	al, 80h
  1911 00000CD1 66C1E008                	shl	ax, 8
  1912 00000CD5 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1913 00000CD7 88D0                    	mov	al, dl
  1914 00000CD9 2C80                    	sub	al, 80h
  1915 00000CDB 66C1E008                	shl	ax, 8
  1916 00000CDF 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1917 00000CE1 88F0                    	mov	al, dh
  1918 00000CE3 2C80                    	sub	al, 80h
  1919 00000CE5 66C1E008                	shl	ax, 8
  1920 00000CE9 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1921 00000CEB A0[80210000]            	mov	al, [next_val_l]
  1922 00000CF0 00D0                    	add	al, dl
  1923 00000CF2 D0D8                    	rcr	al, 1
  1924 00000CF4 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1925 00000CF6 00D0                    	add	al, dl
  1926 00000CF8 D0D8                    	rcr	al, 1
  1927 00000CFA 2C80                    	sub	al, 80h
  1928 00000CFC 66C1E008                	shl	ax, 8
  1929 00000D00 66AB                    	stosw		; this is 4th interpolated sample (L)
  1930 00000D02 A0[82210000]            	mov	al, [next_val_r]
  1931 00000D07 00F0                    	add	al, dh
  1932 00000D09 D0D8                    	rcr	al, 1
  1933 00000D0B 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1934 00000D0D 00F0                    	add	al, dh
  1935 00000D0F D0D8                    	rcr	al, 1
  1936 00000D11 2C80                    	sub	al, 80h
  1937 00000D13 66C1E008                	shl	ax, 8
  1938 00000D17 66AB                    	stosw		; this is 4th interpolated sample (R)
  1939 00000D19 A0[80210000]            	mov	al, [next_val_l]
  1940 00000D1E 00D8                    	add	al, bl
  1941 00000D20 D0D8                    	rcr	al, 1
  1942 00000D22 2C80                    	sub	al, 80h
  1943 00000D24 66C1E008                	shl	ax, 8
  1944 00000D28 66AB                    	stosw		; this is 5th interpolated sample (L)
  1945 00000D2A A0[82210000]            	mov	al, [next_val_r]
  1946 00000D2F 00F8                    	add	al, bh
  1947 00000D31 D0D8                    	rcr	al, 1
  1948 00000D33 2C80                    	sub	al, 80h
  1949 00000D35 66C1E008                	shl	ax, 8
  1950 00000D39 66AB                    	stosw		; this is 5th interpolated sample (R)
  1951                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1952 00000D3B E305                    	jecxz	lff8s_6
  1953 00000D3D E907FFFFFF              	jmp	lff8s_1
  1954                                  lff8s_6:
  1955 00000D42 E9A6FEFFFF              	jmp	lff8s_3
  1956                                  
  1957                                  load_8khz_mono_16_bit:
  1958                                  	; 13/11/2023
  1959 00000D47 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1960                                  					; last of the file?
  1961 00000D4E 7402                    	jz	short lff8m2_0		; no
  1962 00000D50 F9                      	stc
  1963 00000D51 C3                      	retn
  1964                                  
  1965                                  lff8m2_0:
  1966                                  	; 01/12/2024
  1967                                  	; edi = audio buffer address
  1968 00000D52 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1969                                          ;mov	edx, [loadsize]
  1970                                  
  1971                                  	; esi = buffer address
  1972                                  	;; edx = buffer size
  1973                                  
  1974                                  	; load file into memory
  1975                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000D57 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000D5D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000D5F 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000D65 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000D6A CD40                <1>  int 40h
  1976 00000D6C 0F82A0000000            	jc	lff8m2_7 ; error !
  1977                                  
  1978                                  	; 01/12/2024
  1979 00000D72 A3[F87D0000]            	mov	[count], eax
  1980                                  	;;;
  1981                                  	; 07/12/2024
  1982                                  	;mov	edi, audio_buffer
  1983                                  	;;;
  1984 00000D77 D1E8                    	shr	eax, 1
  1985 00000D79 7505                    	jnz	short lff8m2_8
  1986 00000D7B E985FEFFFF              	jmp	lff8_eof
  1987                                  
  1988                                  lff8m2_8:
  1989 00000D80 89C1                    	mov	ecx, eax	; word count
  1990                                  lff8m2_1:
  1991 00000D82 66AD                    	lodsw
  1992 00000D84 66AB                    	stosw		; original sample (left channel)
  1993 00000D86 66AB                    	stosw		; original sample (right channel)
  1994 00000D88 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1995 00000D8B 66A3[7C210000]          	mov	[previous_val], ax
  1996 00000D91 31C0                    	xor	eax, eax
  1997 00000D93 49                      	dec	ecx
  1998 00000D94 7403                    	jz	short lff8m2_2
  1999 00000D96 668B06                  	mov	ax, [esi]
  2000                                  lff8m2_2:
  2001 00000D99 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  2002 00000D9C 89C5                    	mov	ebp, eax	; [next_val]
  2003 00000D9E 660305[7C210000]        	add	ax, [previous_val]
  2004 00000DA5 66D1D8                  	rcr	ax, 1
  2005 00000DA8 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  2006 00000DAA 660305[7C210000]        	add	ax, [previous_val]
  2007 00000DB1 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  2008 00000DB4 89C3                    	mov	ebx, eax 		
  2009 00000DB6 660305[7C210000]        	add	ax, [previous_val]
  2010 00000DBD 66D1D8                  	rcr	ax, 1
  2011 00000DC0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2012 00000DC3 66AB                    	stosw		; this is 1st interpolated sample (L)
  2013 00000DC5 66AB                    	stosw		; this is 1st interpolated sample (R)
  2014 00000DC7 89D8                    	mov	eax, ebx
  2015 00000DC9 6601D0                  	add	ax, dx
  2016 00000DCC 66D1D8                  	rcr	ax, 1
  2017 00000DCF 80EC80                  	sub	ah, 80h
  2018 00000DD2 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2019 00000DD4 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2020 00000DD6 89D0                    	mov	eax, edx
  2021 00000DD8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2022 00000DDB 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2023 00000DDD 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2024 00000DDF 89E8                    	mov	eax, ebp
  2025 00000DE1 6601D0                  	add	ax, dx
  2026 00000DE4 66D1D8                  	rcr	ax, 1
  2027 00000DE7 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2028 00000DE9 6601D0                  	add	ax, dx
  2029 00000DEC 66D1D8                  	rcr	ax, 1
  2030 00000DEF 80EC80                  	sub	ah, 80h
  2031 00000DF2 66AB                    	stosw		; this is 4th interpolated sample (L)
  2032 00000DF4 66AB                    	stosw		; this is 4th interpolated sample (R)
  2033 00000DF6 89E8                    	mov	eax, ebp
  2034 00000DF8 6601D8                  	add	ax, bx
  2035 00000DFB 66D1D8                  	rcr	ax, 1
  2036 00000DFE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2037 00000E01 66AB                    	stosw		; this is 5th interpolated sample (L)
  2038 00000E03 66AB                    	stosw		; this is 5th interpolated sample (R)
  2039                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2040 00000E05 09C9                    	or	ecx, ecx
  2041 00000E07 0F8575FFFFFF            	jnz	lff8m2_1
  2042 00000E0D E9DBFDFFFF              	jmp	lff8m2_3
  2043                                  
  2044                                  lff8m2_7:
  2045                                  lff8s2_7:
  2046 00000E12 E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2047                                  
  2048                                  load_8khz_stereo_16_bit:
  2049                                  	; 16/11/2023
  2050                                  	; 15/11/2023
  2051                                  	; 13/11/2023
  2052 00000E17 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2053                                  					; last of the file?
  2054 00000E1E 7402                    	jz	short lff8s2_0		; no
  2055 00000E20 F9                      	stc
  2056 00000E21 C3                      	retn
  2057                                  
  2058                                  lff8s2_0:
  2059                                  	; 01/12/2024
  2060                                  	; edi = audio buffer address
  2061 00000E22 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2062                                          ;mov	edx, [loadsize]
  2063                                  
  2064                                  	; esi = buffer address
  2065                                  	;; edx = buffer size
  2066                                  
  2067                                  	; load file into memory
  2068                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000E27 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000E2D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000E2F 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000E35 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000E3A CD40                <1>  int 40h
  2069 00000E3C 72D4                    	jc	short lff8s2_7 ; error !
  2070                                  
  2071                                  	; 01/12/2024
  2072 00000E3E A3[F87D0000]            	mov	[count], eax
  2073                                  	;;;
  2074                                  	; 07/12/2024
  2075                                  	;mov	edi, audio_buffer
  2076                                  	;;;
  2077 00000E43 C1E802                  	shr	eax, 2
  2078 00000E46 7505                    	jnz	short lff8s2_8
  2079 00000E48 E9B8FDFFFF              	jmp	lff8_eof
  2080                                  
  2081                                  lff8s2_8:
  2082 00000E4D 89C1                    	mov	ecx, eax ; dword count
  2083                                  lff8s2_1:
  2084 00000E4F 66AD                    	lodsw
  2085 00000E51 66AB                    	stosw		; original sample (L)
  2086                                  	; 15/11/2023
  2087 00000E53 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2088 00000E56 66A3[7C210000]          	mov	[previous_val_l], ax
  2089 00000E5C 66AD                    	lodsw
  2090 00000E5E 66AB                    	stosw		; original sample (R)
  2091 00000E60 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2092 00000E63 66A3[7E210000]          	mov	[previous_val_r], ax
  2093 00000E69 31D2                    	xor	edx, edx
  2094 00000E6B 31C0                    	xor	eax, eax
  2095                                  	; 16/11/2023
  2096 00000E6D 49                      	dec	ecx
  2097 00000E6E 7407                    	jz	short lff8s2_2
  2098 00000E70 668B06                  	mov	ax, [esi]
  2099 00000E73 668B5602                	mov	dx, [esi+2]
  2100                                  lff8s2_2:
  2101 00000E77 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2102 00000E7A 66A3[80210000]          	mov	[next_val_l], ax
  2103 00000E80 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2104 00000E83 668915[82210000]        	mov	[next_val_r], dx
  2105 00000E8A 660305[7C210000]        	add	ax, [previous_val_l]
  2106 00000E91 66D1D8                  	rcr	ax, 1
  2107 00000E94 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2108 00000E96 660305[7C210000]        	add	ax, [previous_val_l]
  2109 00000E9D 66D1D8                  	rcr	ax, 1	
  2110 00000EA0 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2111 00000EA2 660305[7C210000]        	add	ax, [previous_val_l]
  2112 00000EA9 66D1D8                  	rcr	ax, 1
  2113 00000EAC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2114 00000EAF 66AB                    	stosw		; this is 1st interpolated sample (L)
  2115 00000EB1 66A1[82210000]          	mov	ax, [next_val_r]
  2116 00000EB7 660305[7E210000]        	add	ax, [previous_val_r]
  2117 00000EBE 66D1D8                  	rcr	ax, 1
  2118 00000EC1 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2119 00000EC3 660305[7E210000]        	add	ax, [previous_val_r]
  2120 00000ECA 66D1D8                  	rcr	ax, 1
  2121 00000ECD 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2122 00000ECE 660305[7E210000]        	add	ax, [previous_val_r]
  2123 00000ED5 66D1D8                  	rcr	ax, 1
  2124 00000ED8 80EC80                  	sub	ah, 80h
  2125 00000EDB 66AB                    	stosw		; this is 1st interpolated sample (R)
  2126 00000EDD 89D8                    	mov	eax, ebx
  2127 00000EDF 6601D0                  	add	ax, dx
  2128 00000EE2 66D1D8                  	rcr	ax, 1
  2129 00000EE5 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2130 00000EE8 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2131 00000EEA 58                      	pop	eax ; *
  2132 00000EEB 6601E8                  	add	ax, bp
  2133 00000EEE 66D1D8                  	rcr	ax, 1
  2134 00000EF1 80EC80                  	sub	ah, 80h
  2135 00000EF4 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2136 00000EF6 89D0                    	mov	eax, edx
  2137 00000EF8 80EC80                  	sub	ah, 80h
  2138 00000EFB 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2139 00000EFD 89E8                    	mov	eax, ebp
  2140 00000EFF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2141 00000F02 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2142 00000F04 66A1[80210000]          	mov	ax, [next_val_l]
  2143 00000F0A 6601D0                  	add	ax, dx
  2144 00000F0D 66D1D8                  	rcr	ax, 1
  2145 00000F10 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2146 00000F12 6601D0                  	add	ax, dx
  2147 00000F15 66D1D8                  	rcr	ax, 1
  2148 00000F18 80EC80                  	sub	ah, 80h
  2149 00000F1B 66AB                    	stosw		; this is 4th interpolated sample (L)
  2150 00000F1D 66A1[82210000]          	mov	ax, [next_val_r]
  2151 00000F23 6601E8                  	add	ax, bp
  2152 00000F26 66D1D8                  	rcr	ax, 1
  2153 00000F29 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2154 00000F2A 6601E8                  	add	ax, bp
  2155 00000F2D 66D1D8                  	rcr	ax, 1
  2156 00000F30 80EC80                  	sub	ah, 80h
  2157 00000F33 66AB                    	stosw		; this is 4th interpolated sample (R)
  2158 00000F35 66A1[80210000]          	mov	ax, [next_val_l]
  2159 00000F3B 6601D8                  	add	ax, bx
  2160 00000F3E 66D1D8                  	rcr	ax, 1
  2161 00000F41 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2162 00000F44 66AB                    	stosw		; this is 5th interpolated sample (L)
  2163 00000F46 58                      	pop	eax ; **
  2164 00000F47 660305[82210000]        	add	ax, [next_val_r]
  2165 00000F4E 66D1D8                  	rcr	ax, 1
  2166 00000F51 80EC80                  	sub	ah, 80h
  2167 00000F54 66AB                    	stosw		; this is 5th interpolated sample (R)
  2168                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2169 00000F56 E305                    	jecxz	lff8_s2_9
  2170 00000F58 E9F2FEFFFF              	jmp	lff8s2_1
  2171                                  lff8_s2_9:
  2172 00000F5D E98BFCFFFF              	jmp	lff8s2_3
  2173                                  
  2174                                  ; .....................
  2175                                  
  2176                                  load_16khz_mono_8_bit:
  2177                                  	; 14/11/2023
  2178                                  	; 13/11/2023
  2179 00000F62 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2180                                  					; last of the file?
  2181 00000F69 7402                    	jz	short lff16m_0		; no
  2182 00000F6B F9                      	stc
  2183 00000F6C C3                      	retn
  2184                                  
  2185                                  lff16m_0:
  2186                                  	; 01/12/2024
  2187                                  	; edi = audio buffer address
  2188 00000F6D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2189                                          ;mov	edx, [loadsize]
  2190                                  
  2191                                  	; esi = buffer address
  2192                                  	;; edx = buffer size
  2193                                  
  2194                                  	; load file into memory
  2195                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000F72 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000F78 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000F7A 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000F80 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000F85 CD40                <1>  int 40h
  2196 00000F87 7253                    	jc	short lff16m_7 ; error !
  2197                                  
  2198                                  	; 01/12/2024
  2199 00000F89 A3[F87D0000]            	mov	[count], eax
  2200                                  	;;;
  2201                                  	; 07/12/2024
  2202                                  	;mov	edi, audio_buffer
  2203                                  	;;;
  2204 00000F8E 21C0                    	and	eax, eax
  2205 00000F90 7505                    	jnz	short lff16m_8
  2206 00000F92 E96EFCFFFF              	jmp	lff16_eof
  2207                                  
  2208                                  lff16m_8:
  2209 00000F97 89C1                    	mov	ecx, eax		; byte count
  2210                                  lff16m_1:
  2211 00000F99 AC                      	lodsb
  2212                                  	;mov	[previous_val], al
  2213 00000F9A 88C3                    	mov	bl, al
  2214 00000F9C 2C80                    	sub	al, 80h
  2215 00000F9E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2216 00000FA2 66AB                    	stosw		; original sample (left channel)
  2217 00000FA4 66AB                    	stosw		; original sample (right channel)
  2218                                  	;xor	ax, ax
  2219                                  	; 14/11/22023
  2220 00000FA6 B080                    	mov	al, 80h
  2221 00000FA8 49                      	dec	ecx
  2222 00000FA9 7402                    	jz	short lff16m_2
  2223 00000FAB 8A06                    	mov	al, [esi]
  2224                                  lff16m_2:
  2225                                  	;mov	[next_val], al
  2226 00000FAD 88C7                    	mov	bh, al
  2227                                  	;add	al, [previous_val]
  2228 00000FAF 00D8                    	add	al, bl
  2229 00000FB1 D0D8                    	rcr	al, 1
  2230 00000FB3 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2231                                  	;add	al, [previous_val]
  2232 00000FB5 00D8                    	add	al, bl
  2233 00000FB7 D0D8                    	rcr	al, 1
  2234 00000FB9 2C80                    	sub	al, 80h
  2235 00000FBB 66C1E008                	shl	ax, 8
  2236 00000FBF 66AB                    	stosw		; this is 1st interpolated sample (L)
  2237 00000FC1 66AB                    	stosw		; this is 1st interpolated sample (R)
  2238                                  	;mov	al, [next_val]
  2239 00000FC3 88F8                    	mov	al, bh
  2240 00000FC5 00D0                    	add	al, dl
  2241 00000FC7 D0D8                    	rcr	al, 1
  2242 00000FC9 2C80                    	sub	al, 80h
  2243 00000FCB 66C1E008                	shl	ax, 8
  2244 00000FCF 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2245 00000FD1 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2246                                  	
  2247                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2248 00000FD3 09C9                    	or	ecx, ecx
  2249 00000FD5 75C2                    	jnz	short lff16m_1
  2250 00000FD7 E911FCFFFF              	jmp	lff16m_3
  2251                                  
  2252                                  lff16m_7:
  2253                                  lff16s_7:
  2254 00000FDC E92DFCFFFF              	jmp	lff16m_5  ; error
  2255                                  
  2256                                  load_16khz_stereo_8_bit:
  2257                                  	; 14/11/2023
  2258                                  	; 13/11/2023
  2259 00000FE1 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2260                                  					; last of the file?
  2261 00000FE8 7402                    	jz	short lff16s_0		; no
  2262 00000FEA F9                      	stc
  2263 00000FEB C3                      	retn
  2264                                  
  2265                                  lff16s_0:
  2266                                  	; 01/12/2024
  2267                                  	; edi = audio buffer address
  2268 00000FEC BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2269                                          ;mov	edx, [loadsize]
  2270                                  
  2271                                  	; esi = buffer address
  2272                                  	;; edx = buffer size
  2273                                  
  2274                                  	; load file into memory
  2275                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000FF1 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000FF7 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000FF9 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000FFF B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001004 CD40                <1>  int 40h
  2276 00001006 72D4                    	jc	short lff16s_7 ; error !
  2277                                  
  2278                                  	; 01/12/2024
  2279 00001008 A3[F87D0000]            	mov	[count], eax
  2280                                  	;;;
  2281                                  	; 07/12/2024
  2282                                  	;mov	edi, audio_buffer
  2283                                  	;;;
  2284 0000100D D1E8                    	shr	eax, 1
  2285 0000100F 7505                    	jnz	short lff16s_8
  2286 00001011 E9EFFBFFFF              	jmp	lff16_eof
  2287                                  
  2288                                  lff16s_8:
  2289 00001016 89C1                    	mov	ecx, eax	; word count
  2290                                  lff16s_1:
  2291 00001018 AC                      	lodsb
  2292 00001019 A2[7C210000]            	mov	[previous_val_l], al
  2293 0000101E 2C80                    	sub	al, 80h
  2294 00001020 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2295 00001024 66AB                    	stosw		; original sample (L)
  2296 00001026 AC                      	lodsb
  2297 00001027 A2[7E210000]            	mov	[previous_val_r], al
  2298 0000102C 2C80                    	sub	al, 80h
  2299 0000102E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2300 00001032 66AB                    	stosw		; original sample (R)
  2301                                  
  2302                                  	;xor	eax, eax
  2303 00001034 66B88080                	mov	ax, 8080h
  2304 00001038 49                      	dec	ecx
  2305 00001039 7403                    	jz	short lff16s_2
  2306                                  		; convert 8 bit sample to 16 bit sample
  2307 0000103B 668B06                  	mov	ax, [esi]
  2308                                  lff16s_2:
  2309                                  	;mov	[next_val_l], al
  2310                                  	;mov	[next_val_r], ah
  2311 0000103E 89C3                    	mov	ebx, eax
  2312 00001040 0205[7C210000]          	add	al, [previous_val_l]
  2313 00001046 D0D8                    	rcr	al, 1
  2314 00001048 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2315 0000104A 0205[7C210000]          	add	al, [previous_val_l]
  2316 00001050 D0D8                    	rcr	al, 1
  2317 00001052 2C80                    	sub	al, 80h
  2318 00001054 66C1E008                	shl	ax, 8
  2319 00001058 66AB                    	stosw		; this is 1st interpolated sample (L)
  2320 0000105A 88F8                    	mov	al, bh	; [next_val_r]
  2321 0000105C 0205[7E210000]          	add	al, [previous_val_r]
  2322 00001062 D0D8                    	rcr	al, 1
  2323 00001064 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2324 00001066 0205[7E210000]          	add	al, [previous_val_r]
  2325 0000106C D0D8                    	rcr	al, 1
  2326 0000106E 2C80                    	sub	al, 80h
  2327 00001070 66C1E008                	shl	ax, 8
  2328 00001074 66AB                    	stosw		; this is 1st interpolated sample (R)
  2329 00001076 88D0                    	mov	al, dl
  2330 00001078 00D8                    	add	al, bl	; [next_val_l]
  2331 0000107A D0D8                    	rcr	al, 1
  2332 0000107C 2C80                    	sub	al, 80h
  2333 0000107E 66C1E008                	shl	ax, 8
  2334 00001082 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2335 00001084 88F0                    	mov	al, dh
  2336 00001086 00F8                    	add	al, bh	; [next_val_r]
  2337 00001088 D0D8                    	rcr	al, 1
  2338 0000108A 2C80                    	sub	al, 80h
  2339 0000108C 66C1E008                	shl	ax, 8
  2340 00001090 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2341                                  	
  2342                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2343 00001092 09C9                    	or	ecx, ecx
  2344 00001094 7582                    	jnz	short lff16s_1
  2345 00001096 E952FBFFFF              	jmp	lff16s_3
  2346                                  
  2347                                  load_16khz_mono_16_bit:
  2348                                  	; 15/11/2023
  2349                                  	; 13/11/2023
  2350 0000109B F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2351                                  					; last of the file?
  2352 000010A2 7402                    	jz	short lff16m2_0		; no
  2353 000010A4 F9                      	stc
  2354 000010A5 C3                      	retn
  2355                                  
  2356                                  lff16m2_0:
  2357                                  	; 01/12/2024
  2358                                  	; edi = audio buffer address
  2359 000010A6 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2360                                          ;mov	edx, [loadsize]
  2361                                  
  2362                                  	; esi = buffer address
  2363                                  	;; edx = buffer size
  2364                                  
  2365                                  	; load file into memory
  2366                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000010AB 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000010B1 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000010B3 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000010B9 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000010BE CD40                <1>  int 40h
  2367 000010C0 7255                    	jc	short lff16m2_7 ; error !
  2368                                  
  2369                                  	; 01/12/2024
  2370 000010C2 A3[F87D0000]            	mov	[count], eax
  2371                                  	;;;
  2372                                  	; 07/12/2024
  2373                                  	;mov	edi, audio_buffer
  2374                                  	;;;
  2375 000010C7 D1E8                    	shr	eax, 1
  2376 000010C9 7505                    	jnz	short lff16m2_8
  2377 000010CB E935FBFFFF              	jmp	lff16_eof
  2378                                  
  2379                                  lff16m2_8:
  2380 000010D0 89C1                    	mov	ecx, eax  ; word count
  2381                                  lff16m2_1:
  2382 000010D2 66AD                    	lodsw
  2383 000010D4 66AB                    	stosw		; original sample (left channel)
  2384 000010D6 66AB                    	stosw		; original sample (right channel)
  2385 000010D8 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2386                                  	;mov	[previous_val], ax
  2387 000010DB 89C3                    	mov	ebx, eax
  2388 000010DD 31C0                    	xor	eax, eax
  2389 000010DF 49                      	dec	ecx
  2390 000010E0 7403                    	jz	short lff16m2_2
  2391 000010E2 668B06                  	mov	ax, [esi]
  2392                                  lff16m2_2:
  2393 000010E5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2394 000010E8 89C5                    	mov	ebp, eax	; [next_val]
  2395                                  	;add	ax, [previous_val]
  2396 000010EA 6601D8                  	add	ax, bx
  2397 000010ED 66D1D8                  	rcr	ax, 1
  2398 000010F0 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2399                                  	;add	ax, [previous_val]
  2400 000010F2 6601D8                  	add	ax, bx
  2401 000010F5 66D1D8                  	rcr	ax, 1
  2402 000010F8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2403 000010FB 66AB                    	stosw		; this is 1st interpolated sample (L)
  2404 000010FD 66AB                    	stosw		; this is 1st interpolated sample (R)
  2405 000010FF 89E8                    	mov	eax, ebp
  2406 00001101 6601D0                  	add	ax, dx
  2407 00001104 66D1D8                  	rcr	ax, 1
  2408 00001107 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2409 0000110A 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2410 0000110C 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2411                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2412 0000110E 09C9                    	or	ecx, ecx
  2413 00001110 75C0                    	jnz	short lff16m2_1
  2414 00001112 E9D6FAFFFF              	jmp	lff16m2_3
  2415                                  
  2416                                  lff16m2_7:
  2417                                  lff16s2_7:
  2418 00001117 E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2419                                  
  2420                                  load_16khz_stereo_16_bit:
  2421                                  	; 16/11/2023
  2422                                  	; 15/11/2023
  2423                                  	; 13/11/2023
  2424 0000111C F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2425                                  					; last of the file?
  2426 00001123 7402                    	jz	short lff16s2_0		; no
  2427 00001125 F9                      	stc
  2428 00001126 C3                      	retn
  2429                                  
  2430                                  lff16s2_0:
  2431                                  	; 01/12/2024
  2432                                  	; edi = audio buffer address
  2433 00001127 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2434                                          ;mov	edx, [loadsize]
  2435                                  
  2436                                  	; esi = buffer address
  2437                                  	;; edx = buffer size
  2438                                  
  2439                                  	; load file into memory
  2440                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000112C 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001132 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001134 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000113A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000113F CD40                <1>  int 40h
  2441 00001141 72D4                    	jc	short lff16s2_7 ; error !
  2442                                  
  2443                                  	; 01/12/2024
  2444 00001143 A3[F87D0000]            	mov	[count], eax
  2445                                  	;;;
  2446                                  	; 07/12/2024
  2447                                  	;mov	edi, audio_buffer
  2448                                  	;;;
  2449 00001148 C1E802                  	shr	eax, 2
  2450 0000114B 7505                    	jnz	short lff16s2_8
  2451 0000114D E9B3FAFFFF              	jmp	lff16_eof
  2452                                  
  2453                                  lff16s2_8:
  2454 00001152 89C1                    	mov	ecx, eax  ; dword count
  2455                                  lff16s2_1:
  2456 00001154 66AD                    	lodsw
  2457 00001156 66AB                    	stosw		; original sample (L)
  2458 00001158 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2459 0000115B 66A3[7C210000]          	mov	[previous_val_l], ax
  2460 00001161 66AD                    	lodsw
  2461 00001163 66AB                    	stosw		; original sample (R)
  2462 00001165 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2463 00001168 66A3[7E210000]          	mov	[previous_val_r], ax
  2464 0000116E 31D2                    	xor	edx, edx
  2465 00001170 31C0                    	xor	eax, eax
  2466                                  	; 16/11/2023
  2467 00001172 49                      	dec	ecx
  2468 00001173 7407                    	jz	short lff16s2_2
  2469 00001175 668B06                  	mov	ax, [esi]
  2470 00001178 668B5602                	mov	dx, [esi+2]
  2471                                  lff16s2_2:
  2472 0000117C 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2473                                  	;mov	[next_val_l], ax
  2474 0000117F 89C5                    	mov	ebp, eax
  2475 00001181 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2476 00001184 668915[82210000]        	mov	[next_val_r], dx
  2477 0000118B 660305[7C210000]        	add	ax, [previous_val_l]
  2478 00001192 66D1D8                  	rcr	ax, 1
  2479 00001195 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2480 00001197 660305[7C210000]        	add	ax, [previous_val_l]
  2481 0000119E 66D1D8                  	rcr	ax, 1
  2482 000011A1 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2483 000011A4 66AB                    	stosw		; this is 1st interpolated sample (L)
  2484 000011A6 66A1[82210000]          	mov	ax, [next_val_r]
  2485 000011AC 660305[7E210000]        	add	ax, [previous_val_r]
  2486 000011B3 66D1D8                  	rcr	ax, 1
  2487 000011B6 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2488 000011B8 660305[7E210000]        	add	ax, [previous_val_r]
  2489 000011BF 66D1D8                  	rcr	ax, 1
  2490 000011C2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2491 000011C5 66AB                    	stosw		; this is 1st interpolated sample (R)
  2492                                  	;mov	ax, [next_val_l]
  2493 000011C7 89E8                    	mov	eax, ebp
  2494 000011C9 6601D0                  	add	ax, dx
  2495 000011CC 66D1D8                  	rcr	ax, 1
  2496 000011CF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2497 000011D2 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2498 000011D4 66A1[82210000]          	mov	ax, [next_val_r]
  2499 000011DA 6601D8                  	add	ax, bx
  2500 000011DD 66D1D8                  	rcr	ax, 1
  2501 000011E0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2502 000011E3 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2503                                  	
  2504                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2505 000011E5 09C9                    	or	ecx, ecx
  2506 000011E7 0F8567FFFFFF            	jnz	lff16s2_1
  2507 000011ED E9FBF9FFFF              	jmp	lff16s2_3
  2508                                  
  2509                                  ; .....................
  2510                                  
  2511                                  load_24khz_mono_8_bit:
  2512                                  	; 15/11/2023
  2513 000011F2 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2514                                  					; last of the file?
  2515 000011F9 7402                    	jz	short lff24m_0		; no
  2516 000011FB F9                      	stc
  2517 000011FC C3                      	retn
  2518                                  
  2519                                  lff24m_0:
  2520                                  	; 01/12/2024
  2521                                  	; edi = audio buffer address
  2522 000011FD BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2523                                          ;mov	edx, [loadsize]
  2524                                  
  2525                                  	; esi = buffer address
  2526                                  	;; edx = buffer size
  2527                                  
  2528                                  	; load file into memory
  2529                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001202 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001208 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000120A 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001210 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001215 CD40                <1>  int 40h
  2530 00001217 723B                    	jc	short lff24m_7 ; error !
  2531                                  
  2532                                  	; 01/12/2024
  2533 00001219 A3[F87D0000]            	mov	[count], eax
  2534                                  	;;;
  2535                                  	; 07/12/2024
  2536                                  	;mov	edi, audio_buffer
  2537                                  	;;;
  2538 0000121E 21C0                    	and	eax, eax
  2539 00001220 7505                    	jnz	short lff24m_8
  2540 00001222 E9DEF9FFFF              	jmp	lff24_eof
  2541                                  
  2542                                  lff24m_8:
  2543 00001227 89C1                    	mov	ecx, eax	; byte count
  2544                                  lff24m_1:
  2545 00001229 AC                      	lodsb
  2546                                  	;mov	[previous_val], al
  2547 0000122A 88C3                    	mov	bl, al
  2548 0000122C 2C80                    	sub	al, 80h
  2549 0000122E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2550 00001232 66AB                    	stosw		; original sample (left channel)
  2551 00001234 66AB                    	stosw		; original sample (right channel)
  2552                                  	;xor	eax, eax
  2553 00001236 B080                    	mov	al, 80h
  2554 00001238 49                      	dec	ecx
  2555 00001239 7402                    	jz	short lff24m_2
  2556 0000123B 8A06                    	mov	al, [esi]
  2557                                  lff24m_2:
  2558                                  	;;mov	[next_val], al
  2559                                  	;mov	bh, al
  2560                                  	;add	al, [previous_val]
  2561 0000123D 00D8                    	add	al, bl
  2562 0000123F D0D8                    	rcr	al, 1
  2563 00001241 2C80                    	sub	al, 80h
  2564 00001243 66C1E008                	shl	ax, 8
  2565 00001247 66AB                    	stosw		; this is interpolated sample (L)
  2566 00001249 66AB                    	stosw		; this is interpolated sample (R)
  2567                                  	
  2568                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2569 0000124B 09C9                    	or	ecx, ecx
  2570 0000124D 75DA                    	jnz	short lff24m_1
  2571 0000124F E999F9FFFF              	jmp	lff24_3
  2572                                  
  2573                                  lff24m_7:
  2574                                  lff24s_7:
  2575 00001254 E9B5F9FFFF              	jmp	lff24_5  ; error
  2576                                  
  2577                                  load_24khz_stereo_8_bit:
  2578                                  	; 15/11/2023
  2579 00001259 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2580                                  					; last of the file?
  2581 00001260 7402                    	jz	short lff24s_0		; no
  2582 00001262 F9                      	stc
  2583 00001263 C3                      	retn
  2584                                  
  2585                                  lff24s_0:
  2586                                  	; 01/12/2024
  2587                                  	; edi = audio buffer address
  2588 00001264 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2589                                          ;mov	edx, [loadsize]
  2590                                  
  2591                                  	; esi = buffer address
  2592                                  	;; edx = buffer size
  2593                                  
  2594                                  	; load file into memory
  2595                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001269 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000126F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001271 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001277 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000127C CD40                <1>  int 40h
  2596 0000127E 72D4                    	jc	short lff24s_7 ; error !
  2597                                  
  2598                                  	; 01/12/2024
  2599 00001280 A3[F87D0000]            	mov	[count], eax
  2600                                  	;;;
  2601                                  	; 07/12/2024
  2602                                  	;mov	edi, audio_buffer
  2603                                  	;;;
  2604 00001285 D1E8                    	shr	eax, 1
  2605 00001287 7505                    	jnz	short lff24s_8
  2606 00001289 E977F9FFFF              	jmp	lff24_eof
  2607                                  
  2608                                  lff24s_8:
  2609 0000128E 89C1                    	mov	ecx, eax  ; word count
  2610                                  lff24s_1:
  2611 00001290 AC                      	lodsb
  2612 00001291 A2[7C210000]            	mov	[previous_val_l], al
  2613 00001296 2C80                    	sub	al, 80h
  2614 00001298 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2615 0000129C 66AB                    	stosw		; original sample (L)
  2616 0000129E AC                      	lodsb
  2617 0000129F A2[7E210000]            	mov	[previous_val_r], al
  2618 000012A4 2C80                    	sub	al, 80h
  2619 000012A6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2620 000012AA 66AB                    	stosw		; original sample (R)
  2621                                  
  2622                                  	;xor	eax, eax
  2623 000012AC 66B88080                	mov	ax, 8080h
  2624 000012B0 49                      	dec	ecx
  2625 000012B1 7403                    	jz	short lff24s_2
  2626                                  		; convert 8 bit sample to 16 bit sample
  2627 000012B3 668B06                  	mov	ax, [esi]
  2628                                  lff24s_2:
  2629                                  	;;mov	[next_val_l], al
  2630                                  	;;mov	[next_val_r], ah
  2631                                  	;mov	bx, ax
  2632 000012B6 88E7                    	mov	bh, ah
  2633 000012B8 0205[7C210000]          	add	al, [previous_val_l]
  2634 000012BE D0D8                    	rcr	al, 1
  2635                                  	;mov	dl, al
  2636 000012C0 2C80                    	sub	al, 80h
  2637 000012C2 66C1E008                	shl	ax, 8
  2638 000012C6 66AB                    	stosw		; this is interpolated sample (L)
  2639 000012C8 88F8                    	mov	al, bh	; [next_val_r]
  2640 000012CA 0205[7E210000]          	add	al, [previous_val_r]
  2641 000012D0 D0D8                    	rcr	al, 1
  2642                                  	;mov	dh, al
  2643 000012D2 2C80                    	sub	al, 80h
  2644 000012D4 66C1E008                	shl	ax, 8
  2645 000012D8 66AB                    	stosw		; this is interpolated sample (R)
  2646                                  		
  2647                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2648 000012DA 09C9                    	or	ecx, ecx
  2649 000012DC 75B2                    	jnz	short lff24s_1
  2650 000012DE E90AF9FFFF              	jmp	lff24_3
  2651                                  
  2652                                  load_24khz_mono_16_bit:
  2653                                  	; 15/11/2023
  2654 000012E3 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2655                                  					; last of the file?
  2656 000012EA 7402                    	jz	short lff24m2_0		; no
  2657 000012EC F9                      	stc
  2658 000012ED C3                      	retn
  2659                                  
  2660                                  lff24m2_0:
  2661                                  	; 01/12/2024
  2662                                  	; edi = audio buffer address
  2663 000012EE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2664                                          ;mov	edx, [loadsize]
  2665                                  
  2666                                  	; esi = buffer address
  2667                                  	;; edx = buffer size
  2668                                  
  2669                                  	; load file into memory
  2670                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000012F3 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000012F9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000012FB 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001301 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001306 CD40                <1>  int 40h
  2671 00001308 7237                    	jc	short lff24m2_7 ; error !
  2672                                  
  2673                                  	; 01/12/2024
  2674 0000130A A3[F87D0000]            	mov	[count], eax
  2675                                  	;;;
  2676                                  	; 07/12/2024
  2677                                  	;mov	edi, audio_buffer
  2678                                  	;;;
  2679 0000130F D1E8                    	shr	eax, 1
  2680 00001311 7505                    	jnz	short lff24m2_8
  2681 00001313 E9EDF8FFFF              	jmp	lff24_eof
  2682                                  
  2683                                  lff24m2_8:
  2684 00001318 89C1                    	mov	ecx, eax  ; word count
  2685                                  lff24m2_1:
  2686 0000131A 66AD                    	lodsw
  2687 0000131C 66AB                    	stosw		; original sample (left channel)
  2688 0000131E 66AB                    	stosw		; original sample (right channel)
  2689 00001320 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2690                                  	;mov	[previous_val], ax
  2691                                  	;mov	ebx, eax
  2692                                  	;xor	eax, eax
  2693 00001323 31DB                    	xor	ebx, ebx
  2694 00001325 49                      	dec	ecx
  2695 00001326 7403                    	jz	short lff24m2_2
  2696                                  	;mov	ax, [esi]
  2697 00001328 668B1E                  	mov	bx, [esi]
  2698                                  lff24m2_2:
  2699                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2700                                  	;mov	ebp, eax	; [next_val]
  2701                                  	;add	ax, [previous_val]
  2702                                  	; ax = [previous_val]
  2703                                  	; bx = [next_val]
  2704 0000132B 6601D8                  	add	ax, bx
  2705 0000132E 66D1D8                  	rcr	ax, 1
  2706 00001331 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2707 00001334 66AB                    	stosw		; this is interpolated sample (L)
  2708 00001336 66AB                    	stosw		; this is interpolated sample (R)
  2709                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2710 00001338 09C9                    	or	ecx, ecx
  2711 0000133A 75DE                    	jnz	short lff24m2_1
  2712 0000133C E9ACF8FFFF              	jmp	lff24_3
  2713                                  
  2714                                  lff24m2_7:
  2715                                  lff24s2_7:
  2716 00001341 E9C8F8FFFF              	jmp	lff24_5  ; error
  2717                                  
  2718                                  load_24khz_stereo_16_bit:
  2719                                  	; 16/11/2023
  2720                                  	; 15/11/2023
  2721 00001346 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2722                                  					; last of the file?
  2723 0000134D 7402                    	jz	short lff24s2_0		; no
  2724 0000134F F9                      	stc
  2725 00001350 C3                      	retn
  2726                                  
  2727                                  lff24s2_0:
  2728                                  	; 01/12/2024
  2729                                  	; edi = audio buffer address
  2730 00001351 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2731                                          ;mov	edx, [loadsize]
  2732                                  
  2733                                  	; esi = buffer address
  2734                                  	;; edx = buffer size
  2735                                  
  2736                                  	; load file into memory
  2737                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001356 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000135C 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000135E 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001364 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001369 CD40                <1>  int 40h
  2738 0000136B 72D4                    	jc	short lff24s2_7 ; error !
  2739                                  
  2740                                  	; 01/12/2024
  2741 0000136D A3[F87D0000]            	mov	[count], eax
  2742                                  	;;;
  2743                                  	; 07/12/2024
  2744                                  	;mov	edi, audio_buffer
  2745                                  	;;;
  2746 00001372 C1E802                  	shr	eax, 2
  2747 00001375 7505                    	jnz	short lff24s2_8
  2748 00001377 E989F8FFFF              	jmp	lff24_eof
  2749                                  
  2750                                  lff24s2_8:
  2751 0000137C 89C1                    	mov	ecx, eax  ; dword count
  2752                                  lff24s2_1:
  2753 0000137E 66AD                    	lodsw
  2754 00001380 66AB                    	stosw		; original sample (L)
  2755 00001382 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2756 00001385 66A3[7C210000]          	mov	[previous_val_l], ax
  2757 0000138B 66AD                    	lodsw
  2758 0000138D 66AB                    	stosw		; original sample (R)
  2759 0000138F 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2760                                  	;mov	[previous_val_r], ax
  2761 00001392 89C3                    	mov	ebx, eax
  2762 00001394 31D2                    	xor	edx, edx
  2763 00001396 31C0                    	xor	eax, eax
  2764                                  	; 16/11/2023
  2765 00001398 49                      	dec	ecx
  2766 00001399 7407                    	jz	short lff24s2_2
  2767 0000139B 668B06                  	mov	ax, [esi]
  2768 0000139E 668B5602                	mov	dx, [esi+2]
  2769                                  lff24s2_2:
  2770 000013A2 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2771                                  	;;mov	[next_val_l], ax
  2772                                  	;mov	ebp, eax
  2773 000013A5 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2774                                  	;mov	[next_val_r], dx
  2775 000013A8 660305[7C210000]        	add	ax, [previous_val_l]
  2776 000013AF 66D1D8                  	rcr	ax, 1
  2777 000013B2 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2778 000013B5 66AB                    	stosw		; this is interpolated sample (L)
  2779                                  	;mov	ax, [next_val_r]
  2780 000013B7 89D0                    	mov	eax, edx
  2781                                  	;add	ax, [previous_val_r]
  2782 000013B9 6601D8                  	add	ax, bx
  2783 000013BC 66D1D8                  	rcr	ax, 1
  2784 000013BF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2785 000013C2 66AB                    	stosw		; this is interpolated sample (R)
  2786                                  	
  2787                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2788 000013C4 09C9                    	or	ecx, ecx
  2789 000013C6 75B6                    	jnz	short lff24s2_1
  2790 000013C8 E920F8FFFF              	jmp	lff24_3
  2791                                  
  2792                                  ; .....................
  2793                                  
  2794                                  load_32khz_mono_8_bit:
  2795                                  	; 15/11/2023
  2796 000013CD F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2797                                  					; last of the file?
  2798 000013D4 7402                    	jz	short lff32m_0		; no
  2799 000013D6 F9                      	stc
  2800 000013D7 C3                      	retn
  2801                                  
  2802                                  lff32m_0:
  2803                                  	; 01/12/2024
  2804                                  	; edi = audio buffer address
  2805 000013D8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2806                                          ;mov	edx, [loadsize]
  2807                                  
  2808                                  	; esi = buffer address
  2809                                  	;; edx = buffer size
  2810                                  
  2811                                  	; load file into memory
  2812                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000013DD 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000013E3 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000013E5 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000013EB B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000013F0 CD40                <1>  int 40h
  2813 000013F2 7247                    	jc	short lff32m_7 ; error !
  2814                                  
  2815                                  	; 01/12/2024
  2816 000013F4 A3[F87D0000]            	mov	[count], eax
  2817                                  	;;;
  2818                                  	; 07/12/2024
  2819                                  	;mov	edi, audio_buffer
  2820                                  	;;;
  2821 000013F9 21C0                    	and	eax, eax
  2822 000013FB 7505                    	jnz	short lff32m_8
  2823 000013FD E903F8FFFF              	jmp	lff32_eof
  2824                                  
  2825                                  lff32m_8:
  2826 00001402 89C1                    	mov	ecx, eax	; byte count
  2827                                  lff32m_1:
  2828 00001404 AC                      	lodsb
  2829                                  	;mov	[previous_val], al
  2830 00001405 88C3                    	mov	bl, al
  2831 00001407 2C80                    	sub	al, 80h
  2832 00001409 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2833 0000140D 66AB                    	stosw		; original sample (left channel)
  2834 0000140F 66AB                    	stosw		; original sample (right channel)
  2835                                  	;xor	eax, eax
  2836 00001411 B080                    	mov	al, 80h
  2837 00001413 49                      	dec	ecx
  2838 00001414 7402                    	jz	short lff32m_2
  2839 00001416 8A06                    	mov	al, [esi]
  2840                                  lff32m_2:
  2841                                  	;;mov	[next_val], al
  2842                                  	;mov	bh, al
  2843                                  	;add	al, [previous_val]
  2844 00001418 00D8                    	add	al, bl
  2845 0000141A D0D8                    	rcr	al, 1
  2846 0000141C 2C80                    	sub	al, 80h
  2847 0000141E 66C1E008                	shl	ax, 8
  2848 00001422 66AB                    	stosw		; this is interpolated sample (L)
  2849 00001424 66AB                    	stosw		; this is interpolated sample (R)
  2850                                  	
  2851                                  	; different than 8-16-24 kHZ !
  2852                                  	; 'original-interpolated-original' trio samples
  2853 00001426 E30E                    	jecxz	lff32m_3
  2854                                  
  2855 00001428 AC                      	lodsb
  2856 00001429 2C80                    	sub	al, 80h
  2857 0000142B 66C1E008                	shl	ax, 8
  2858 0000142F 66AB                    	stosw		; original sample (left channel)
  2859 00001431 66AB                    	stosw		; original sample (right channel)
  2860                                  
  2861                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2862 00001433 49                      	dec	ecx
  2863 00001434 75CE                    	jnz	short lff32m_1
  2864                                  lff32m_3:
  2865 00001436 E9B2F7FFFF              	jmp	lff32_3
  2866                                  
  2867                                  lff32m_7:
  2868                                  lff32s_7:
  2869 0000143B E9CEF7FFFF              	jmp	lff32_5  ; error
  2870                                  
  2871                                  load_32khz_stereo_8_bit:
  2872                                  	; 15/11/2023
  2873 00001440 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2874                                  					; last of the file?
  2875 00001447 7402                    	jz	short lff32s_0		; no
  2876 00001449 F9                      	stc
  2877 0000144A C3                      	retn
  2878                                  
  2879                                  lff32s_0:
  2880                                  	; 01/12/2024
  2881                                  	; edi = audio buffer address
  2882 0000144B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2883                                          ;mov	edx, [loadsize]
  2884                                  
  2885                                  	; esi = buffer address
  2886                                  	;; edx = buffer size
  2887                                  
  2888                                  	; load file into memory
  2889                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001450 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001456 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001458 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000145E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001463 CD40                <1>  int 40h
  2890 00001465 72D4                    	jc	short lff32s_7 ; error !
  2891                                  
  2892                                  	; 01/12/2024
  2893 00001467 A3[F87D0000]            	mov	[count], eax
  2894                                  	;;;
  2895                                  	; 07/12/2024
  2896                                  	;mov	edi, audio_buffer
  2897                                  	;;;
  2898 0000146C D1E8                    	shr	eax, 1
  2899 0000146E 7505                    	jnz	short lff32s_8
  2900 00001470 E990F7FFFF              	jmp	lff32_eof
  2901                                  
  2902                                  lff32s_8:
  2903 00001475 89C1                    	mov	ecx, eax  ; word count
  2904                                  lff32s_1:
  2905 00001477 AC                      	lodsb
  2906 00001478 A2[7C210000]            	mov	[previous_val_l], al
  2907 0000147D 2C80                    	sub	al, 80h
  2908 0000147F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2909 00001483 66AB                    	stosw		; original sample (L)
  2910 00001485 AC                      	lodsb
  2911 00001486 A2[7E210000]            	mov	[previous_val_r], al
  2912 0000148B 2C80                    	sub	al, 80h
  2913 0000148D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2914 00001491 66AB                    	stosw		; original sample (R)
  2915                                  
  2916                                  	;xor	eax, eax
  2917 00001493 66B88080                	mov	ax, 8080h
  2918 00001497 49                      	dec	ecx
  2919 00001498 7403                    	jz	short lff32s_2
  2920                                  		; convert 8 bit sample to 16 bit sample
  2921 0000149A 668B06                  	mov	ax, [esi]
  2922                                  lff32s_2:
  2923                                  	;;mov	[next_val_l], al
  2924                                  	;;mov	[next_val_r], ah
  2925                                  	;mov	bx, ax
  2926 0000149D 88E7                    	mov	bh, ah
  2927 0000149F 0205[7C210000]          	add	al, [previous_val_l]
  2928 000014A5 D0D8                    	rcr	al, 1
  2929                                  	;mov	dl, al
  2930 000014A7 2C80                    	sub	al, 80h
  2931 000014A9 66C1E008                	shl	ax, 8
  2932 000014AD 66AB                    	stosw		; this is interpolated sample (L)
  2933 000014AF 88F8                    	mov	al, bh	; [next_val_r]
  2934 000014B1 0205[7E210000]          	add	al, [previous_val_r]
  2935 000014B7 D0D8                    	rcr	al, 1
  2936                                  	;mov	dh, al
  2937 000014B9 2C80                    	sub	al, 80h
  2938 000014BB 66C1E008                	shl	ax, 8
  2939 000014BF 66AB                    	stosw		; this is interpolated sample (R)
  2940                                  
  2941                                  	; different than 8-16-24 kHZ !
  2942                                  	; 'original-interpolated-original' trio samples
  2943 000014C1 E315                    	jecxz	lff32s_3
  2944                                  
  2945 000014C3 AC                      	lodsb
  2946 000014C4 2C80                    	sub	al, 80h
  2947 000014C6 66C1E008                	shl	ax, 8
  2948 000014CA 66AB                    	stosw		; original sample (left channel)
  2949                                  
  2950 000014CC AC                      	lodsb
  2951 000014CD 2C80                    	sub	al, 80h
  2952 000014CF 66C1E008                	shl	ax, 8
  2953 000014D3 66AB                    	stosw		; original sample (right channel)
  2954                                  		
  2955                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2956 000014D5 49                      	dec	ecx
  2957 000014D6 759F                    	jnz	short lff32s_1
  2958                                  lff32s_3:
  2959 000014D8 E910F7FFFF              	jmp	lff32_3
  2960                                  
  2961                                  load_32khz_mono_16_bit:
  2962                                  	; 15/11/2023
  2963 000014DD F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2964                                  					; last of the file?
  2965 000014E4 7402                    	jz	short lff32m2_0		; no
  2966 000014E6 F9                      	stc
  2967 000014E7 C3                      	retn
  2968                                  
  2969                                  lff32m2_0:
  2970                                  	; 01/12/2024
  2971                                  	; edi = audio buffer address
  2972 000014E8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2973                                          ;mov	edx, [loadsize]
  2974                                  
  2975                                  	; esi = buffer address
  2976                                  	;; edx = buffer size
  2977                                  
  2978                                  	; load file into memory
  2979                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000014ED 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000014F3 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000014F5 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000014FB B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001500 CD40                <1>  int 40h
  2980 00001502 723E                    	jc	short lff32m2_7 ; error !
  2981                                  
  2982                                  	; 01/12/2024
  2983 00001504 A3[F87D0000]            	mov	[count], eax
  2984                                  	;;;
  2985                                  	; 07/12/2024
  2986                                  	;mov	edi, audio_buffer
  2987                                  	;;;
  2988 00001509 D1E8                    	shr	eax, 1
  2989 0000150B 7505                    	jnz	short lff32m2_8
  2990 0000150D E9F3F6FFFF              	jmp	lff32_eof
  2991                                  
  2992                                  lff32m2_8:
  2993 00001512 89C1                    	mov	ecx, eax  ; word count
  2994                                  lff32m2_1:
  2995 00001514 66AD                    	lodsw
  2996 00001516 66AB                    	stosw		; original sample (left channel)
  2997 00001518 66AB                    	stosw		; original sample (right channel)
  2998 0000151A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2999                                  	;mov	[previous_val], ax
  3000                                  	;mov	ebx, eax
  3001                                  	;xor	eax, eax
  3002 0000151D 31DB                    	xor	ebx, ebx
  3003 0000151F 49                      	dec	ecx
  3004 00001520 7403                    	jz	short lff32m2_2
  3005                                  	;mov	ax, [esi]
  3006 00001522 668B1E                  	mov	bx, [esi]
  3007                                  lff32m2_2:
  3008                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  3009                                  	;mov	ebp, eax ; [next_val]
  3010                                  	;add	ax, [previous_val]
  3011                                  	; ax = [previous_val]
  3012                                  	; bx = [next_val]
  3013 00001525 6601D8                  	add	ax, bx
  3014 00001528 66D1D8                  	rcr	ax, 1
  3015 0000152B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3016 0000152E 66AB                    	stosw		; this is interpolated sample (L)
  3017 00001530 66AB                    	stosw		; this is interpolated sample (R)
  3018                                  
  3019                                  	; different than 8-16-24 kHZ !
  3020                                  	; 'original-interpolated-original' trio samples 
  3021 00001532 E309                    	jecxz	lff32m2_3
  3022                                  
  3023 00001534 66AD                    	lodsw
  3024 00001536 66AB                    	stosw		; original sample (left channel)
  3025 00001538 66AB                    	stosw		; original sample (right channel)
  3026                                  
  3027                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3028 0000153A 49                      	dec	ecx
  3029 0000153B 75D7                    	jnz	short lff32m2_1
  3030                                  lff32m2_3:
  3031 0000153D E9ABF6FFFF              	jmp	lff32_3
  3032                                  
  3033                                  lff32m2_7:
  3034                                  lff32s2_7:
  3035 00001542 E9C7F6FFFF              	jmp	lff32_5  ; error
  3036                                  
  3037                                  load_32khz_stereo_16_bit:
  3038                                  	; 16/11/2023
  3039                                  	; 15/11/2023
  3040 00001547 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3041                                  					; last of the file?
  3042 0000154E 7402                    	jz	short lff32s2_0		; no
  3043 00001550 F9                      	stc
  3044 00001551 C3                      	retn
  3045                                  
  3046                                  lff32s2_0:
  3047                                  	; 01/12/2024
  3048                                  	; edi = audio buffer address
  3049 00001552 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3050                                          ;mov	edx, [loadsize]
  3051                                  
  3052                                  	; esi = buffer address
  3053                                  	;; edx = buffer size
  3054                                  
  3055                                  	; load file into memory
  3056                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001557 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000155D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000155F 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001565 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000156A CD40                <1>  int 40h
  3057 0000156C 72D4                    	jc	short lff32s2_7 ; error !
  3058                                  
  3059                                  	; 01/12/2024
  3060 0000156E A3[F87D0000]            	mov	[count], eax
  3061                                  	;;;
  3062                                  	; 07/12/2024
  3063                                  	;mov	edi, audio_buffer
  3064                                  	;;;
  3065 00001573 C1E802                  	shr	eax, 2
  3066 00001576 7505                    	jnz	short lff32s2_8
  3067 00001578 E988F6FFFF              	jmp	lff32_eof
  3068                                  
  3069                                  lff32s2_8:
  3070 0000157D 89C1                    	mov	ecx, eax ; dword count
  3071                                  lff32s2_1:
  3072 0000157F 66AD                    	lodsw
  3073 00001581 66AB                    	stosw		; original sample (L)
  3074 00001583 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3075 00001586 66A3[7C210000]          	mov	[previous_val_l], ax
  3076 0000158C 66AD                    	lodsw
  3077 0000158E 66AB                    	stosw		; original sample (R)
  3078 00001590 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3079                                  	;mov	[previous_val_r], ax
  3080 00001593 89C3                    	mov	ebx, eax
  3081 00001595 31D2                    	xor	edx, edx
  3082 00001597 31C0                    	xor	eax, eax
  3083                                  	; 16/11/2023
  3084 00001599 49                      	dec	ecx
  3085 0000159A 7407                    	jz	short lff32s2_2
  3086 0000159C 668B06                  	mov	ax, [esi]
  3087 0000159F 668B5602                	mov	dx, [esi+2]
  3088                                  lff32s2_2:
  3089 000015A3 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3090                                  	;;mov	[next_val_l], ax
  3091                                  	;mov	ebp, eax
  3092 000015A6 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3093                                  	;mov	[next_val_r], dx
  3094 000015A9 660305[7C210000]        	add	ax, [previous_val_l]
  3095 000015B0 66D1D8                  	rcr	ax, 1
  3096 000015B3 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3097 000015B6 66AB                    	stosw		; this is interpolated sample (L)
  3098                                  	;mov	ax, [next_val_r]
  3099 000015B8 89D0                    	mov	eax, edx
  3100                                  	;add	ax, [previous_val_r]
  3101 000015BA 6601D8                  	add	ax, bx
  3102 000015BD 66D1D8                  	rcr	ax, 1
  3103 000015C0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3104 000015C3 66AB                    	stosw		; this is interpolated sample (R)
  3105                                  
  3106                                  	; different than 8-16-24 kHZ !
  3107                                  	; 'original-interpolated-original' trio samples
  3108 000015C5 E30B                    	jecxz	lff32s2_3
  3109                                  
  3110 000015C7 66AD                    	lodsw
  3111 000015C9 66AB                    	stosw	; original sample (L)
  3112 000015CB 66AD                    	lodsw
  3113 000015CD 66AB                    	stosw	; original sample (R)
  3114                                  	
  3115                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3116 000015CF 49                      	dec	ecx
  3117 000015D0 75AD                    	jnz	short lff32s2_1
  3118                                  lff32s2_3:
  3119 000015D2 E916F6FFFF              	jmp	lff32_3
  3120                                  
  3121                                  ; .....................
  3122                                  
  3123                                  load_22khz_mono_8_bit:
  3124                                  	; 16/11/2023
  3125 000015D7 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3126                                  					; last of the file?
  3127 000015DE 7402                    	jz	short lff22m_0		; no
  3128 000015E0 F9                      	stc
  3129 000015E1 C3                      	retn
  3130                                  
  3131                                  lff22m_0:
  3132                                  	; 01/12/2024
  3133                                  	; edi = audio buffer address
  3134 000015E2 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3135                                          ;mov	edx, [loadsize]
  3136                                  
  3137                                  	; esi = buffer address
  3138                                  	;; edx = buffer size
  3139                                  
  3140                                  	; load file into memory
  3141                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000015E7 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000015ED 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000015EF 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000015F5 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000015FA CD40                <1>  int 40h
  3142 000015FC 725D                    	jc	short lff22m_7 ; error !
  3143                                  
  3144                                  	; 01/12/2024
  3145 000015FE A3[F87D0000]            	mov	[count], eax
  3146                                  	;;;
  3147                                  	; 07/12/2024
  3148                                  	;mov	edi, audio_buffer
  3149                                  	;;;
  3150 00001603 21C0                    	and	eax, eax
  3151 00001605 7505                    	jnz	short lff22m_8
  3152 00001607 E9F9F5FFFF              	jmp	lff22_eof
  3153                                  
  3154                                  lff22m_8:
  3155 0000160C 89C1                    	mov	ecx, eax	; byte count
  3156                                  lff22m_9:
  3157 0000160E BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3158 00001613 C605[84210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3159                                  lff22m_1:
  3160                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3161 0000161A AC                      	lodsb
  3162 0000161B B280                    	mov	dl, 80h
  3163 0000161D 49                      	dec	ecx
  3164 0000161E 7402                    	jz	short lff22m_2_1
  3165 00001620 8A16                    	mov	dl, [esi]
  3166                                  lff22m_2_1:	
  3167                                  	; al = [previous_val]
  3168                                  	; dl = [next_val]
  3169 00001622 E80F060000              	call	interpolating_3_8bit_mono ; 1 of 17
  3170 00001627 E32D                    	jecxz	lff22m_3
  3171                                  lff22m_2_2:
  3172 00001629 AC                      	lodsb
  3173 0000162A B280                    	mov	dl, 80h
  3174 0000162C 49                      	dec	ecx
  3175 0000162D 7402                    	jz	short lff22m_2_3
  3176 0000162F 8A16                    	mov	dl, [esi]
  3177                                  lff22m_2_3:
  3178 00001631 E884060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3179 00001636 E31E                    	jecxz	lff22m_3
  3180 00001638 4D                      	dec	ebp
  3181 00001639 75EE                    	jnz	short lff22m_2_2
  3182                                  
  3183 0000163B A0[84210000]            	mov	al, [faz]
  3184 00001640 FEC8                    	dec	al
  3185 00001642 74CA                    	jz	short lff22m_9
  3186 00001644 FE0D[84210000]          	dec	byte [faz]
  3187 0000164A BD04000000              	mov	ebp, 4
  3188 0000164F FEC8                    	dec	al
  3189 00001651 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3190 00001653 45                      	inc	ebp ; 5
  3191 00001654 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3192                                  
  3193                                  lff22m_3:
  3194                                  lff22s_3:
  3195 00001656 E992F5FFFF              	jmp	lff22_3	; padfill
  3196                                  		; (put zeros in the remain words of the buffer)
  3197                                  lff22m_7:
  3198                                  lff22s_7:
  3199 0000165B E9AEF5FFFF              	jmp	lff22_5  ; error
  3200                                  
  3201                                  load_22khz_stereo_8_bit:
  3202                                  	; 16/11/2023
  3203 00001660 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3204                                  					; last of the file?
  3205 00001667 7402                    	jz	short lff22s_0		; no
  3206 00001669 F9                      	stc
  3207 0000166A C3                      	retn
  3208                                  
  3209                                  lff22s_0:
  3210                                  	; 01/12/2024
  3211                                  	; edi = audio buffer address
  3212 0000166B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3213                                          ;mov	edx, [loadsize]
  3214                                  
  3215                                  	; esi = buffer address
  3216                                  	;; edx = buffer size
  3217                                  
  3218                                  	; load file into memory
  3219                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001670 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001676 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001678 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000167E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001683 CD40                <1>  int 40h
  3220 00001685 72D4                    	jc	short lff22s_7 ; error !
  3221                                  
  3222                                  	; 01/12/2024
  3223 00001687 A3[F87D0000]            	mov	[count], eax
  3224                                  	;;;
  3225                                  	; 07/12/2024
  3226                                  	;mov	edi, audio_buffer
  3227                                  	;;;
  3228 0000168C D1E8                    	shr	eax, 1
  3229 0000168E 7505                    	jnz	short lff22s_8
  3230 00001690 E970F5FFFF              	jmp	lff22_eof
  3231                                  
  3232                                  lff22s_8:
  3233 00001695 89C1                    	mov	ecx, eax	; word count
  3234                                  lff22s_9:
  3235 00001697 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3236 0000169C C605[84210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3237                                  lff22s_1:
  3238                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3239 000016A3 66AD                    	lodsw
  3240 000016A5 66BA8080                	mov	dx, 8080h
  3241 000016A9 49                      	dec	ecx
  3242 000016AA 7403                    	jz	short lff22s_2_1
  3243 000016AC 668B16                  	mov	dx, [esi]
  3244                                  lff22s_2_1:	
  3245                                  	; al = [previous_val_l]
  3246                                  	; ah = [previous_val_r]
  3247                                  	; dl = [next_val_l]
  3248                                  	; dh = [next_val_r]
  3249 000016AF E8B3050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3250 000016B4 E3A0                    	jecxz	lff22s_3
  3251                                  lff22s_2_2:
  3252 000016B6 66AD                    	lodsw
  3253 000016B8 66BA8080                	mov	dx, 8080h
  3254 000016BC 49                      	dec	ecx
  3255 000016BD 7403                    	jz	short lff22s_2_3
  3256 000016BF 668B16                  	mov	dx, [esi]
  3257                                  lff22s_2_3:
  3258 000016C2 E810060000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3259 000016C7 E38D                    	jecxz	lff22s_3
  3260 000016C9 4D                      	dec	ebp
  3261 000016CA 75EA                    	jnz	short lff22s_2_2
  3262                                  
  3263 000016CC A0[84210000]            	mov	al, [faz]
  3264 000016D1 FEC8                    	dec	al
  3265 000016D3 74C2                    	jz	short lff22s_9
  3266 000016D5 FE0D[84210000]          	dec	byte [faz]
  3267 000016DB BD04000000              	mov	ebp, 4
  3268 000016E0 FEC8                    	dec	al
  3269 000016E2 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3270 000016E4 45                      	inc	ebp ; 5
  3271 000016E5 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3272                                  
  3273                                  load_22khz_mono_16_bit:
  3274                                  	; 16/11/2023
  3275 000016E7 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3276                                  					; last of the file?
  3277 000016EE 7402                    	jz	short lff22m2_0		; no
  3278 000016F0 F9                      	stc
  3279 000016F1 C3                      	retn
  3280                                  
  3281                                  lff22m2_0:
  3282                                  	; 01/12/2024
  3283                                  	; edi = audio buffer address
  3284 000016F2 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3285                                          ;mov	edx, [loadsize]
  3286                                  
  3287                                  	; esi = buffer address
  3288                                  	;; edx = buffer size
  3289                                  
  3290                                  	; load file into memory
  3291                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000016F7 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000016FD 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000016FF 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001705 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000170A CD40                <1>  int 40h
  3292 0000170C 7261                    	jc	short lff22m2_7 ; error !
  3293                                  
  3294                                  	; 01/12/2024
  3295 0000170E A3[F87D0000]            	mov	[count], eax
  3296                                  	;;;
  3297                                  	; 07/12/2024
  3298                                  	;mov	edi, audio_buffer
  3299                                  	;;;
  3300 00001713 D1E8                    	shr	eax, 1
  3301 00001715 7505                    	jnz	short lff22m2_8
  3302 00001717 E9E9F4FFFF              	jmp	lff22_eof
  3303                                  
  3304                                  lff22m2_8:
  3305 0000171C 89C1                    	mov	ecx, eax	; word count
  3306                                  lff22m2_9:
  3307 0000171E BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3308 00001723 C605[84210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3309                                  lff22m2_1:
  3310                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3311 0000172A 66AD                    	lodsw
  3312 0000172C 31D2                    	xor	edx, edx
  3313 0000172E 49                      	dec	ecx
  3314 0000172F 7403                    	jz	short lff22m2_2_1
  3315 00001731 668B16                  	mov	dx, [esi]
  3316                                  lff22m2_2_1:	
  3317                                  	; ax = [previous_val]
  3318                                  	; dx = [next_val]
  3319 00001734 E8CF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3320 00001739 E32F                    	jecxz	lff22m2_3
  3321                                  lff22m2_2_2:
  3322 0000173B 66AD                    	lodsw
  3323 0000173D 31D2                    	xor	edx, edx
  3324 0000173F 49                      	dec	ecx
  3325 00001740 7403                    	jz	short lff22m2_2_3
  3326 00001742 668B16                  	mov	dx, [esi]
  3327                                  lff22m2_2_3:
  3328 00001745 E851060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3329 0000174A E31E                    	jecxz	lff22m2_3
  3330 0000174C 4D                      	dec	ebp
  3331 0000174D 75EC                    	jnz	short lff22m2_2_2
  3332                                  
  3333 0000174F A0[84210000]            	mov	al, [faz]
  3334 00001754 FEC8                    	dec	al
  3335 00001756 74C6                    	jz	short lff22m2_9
  3336 00001758 FE0D[84210000]          	dec	byte [faz]
  3337 0000175E BD04000000              	mov	ebp, 4
  3338 00001763 FEC8                    	dec	al
  3339 00001765 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3340 00001767 45                      	inc	ebp ; 5
  3341 00001768 EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3342                                  
  3343                                  lff22m2_3:
  3344                                  lff22s2_3:
  3345 0000176A E97EF4FFFF              	jmp	lff22_3	; padfill
  3346                                  		; (put zeros in the remain words of the buffer)
  3347                                  lff22m2_7:
  3348                                  lff22s2_7:
  3349 0000176F E99AF4FFFF              	jmp	lff22_5  ; error
  3350                                  
  3351                                  load_22khz_stereo_16_bit:
  3352                                  	; 16/11/2023
  3353 00001774 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3354                                  					; last of the file?
  3355 0000177B 7402                    	jz	short lff22s2_0		; no
  3356 0000177D F9                      	stc
  3357 0000177E C3                      	retn
  3358                                  
  3359                                  lff22s2_0:
  3360                                  	; 01/12/2024
  3361                                  	; edi = audio buffer address
  3362 0000177F BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3363                                          ;mov	edx, [loadsize]
  3364                                  
  3365                                  	; esi = buffer address
  3366                                  	;; edx = buffer size
  3367                                  
  3368                                  	; load file into memory
  3369                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001784 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000178A 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000178C 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001792 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001797 CD40                <1>  int 40h
  3370 00001799 72D4                    	jc	short lff22s2_7 ; error !
  3371                                  
  3372                                  	; 01/12/2024
  3373 0000179B A3[F87D0000]            	mov	[count], eax
  3374                                  	;;;
  3375                                  	; 07/12/2024
  3376                                  	;mov	edi, audio_buffer
  3377                                  	;;;
  3378 000017A0 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3379 000017A3 7505                    	jnz	short lff22s2_8
  3380 000017A5 E95BF4FFFF              	jmp	lff22_eof
  3381                                  
  3382                                  lff22s2_8:
  3383 000017AA 89C1                    	mov	ecx, eax	; dword count
  3384                                  lff22s2_9:
  3385 000017AC BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3386 000017B1 C605[84210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3387                                  lff22s2_1:
  3388                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3389 000017B8 66AD                    	lodsw
  3390 000017BA 89C3                    	mov	ebx, eax
  3391 000017BC 66AD                    	lodsw
  3392 000017BE 8B16                    	mov	edx, [esi]
  3393 000017C0 668915[80210000]        	mov	[next_val_l], dx
  3394                                  	; 26/11/2023
  3395 000017C7 C1EA10                  	shr	edx, 16
  3396 000017CA 49                      	dec	ecx
  3397 000017CB 7509                    	jnz	short lff22s2_2_1
  3398 000017CD 31D2                    	xor	edx, edx ; 0
  3399 000017CF 668915[80210000]        	mov	[next_val_l], dx
  3400                                  lff22s2_2_1:
  3401                                  	; bx = [previous_val_l]
  3402                                  	; ax = [previous_val_r]
  3403                                  	; [next_val_l]
  3404                                  	; dx = [next_val_r]
  3405 000017D6 E85D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3406 000017DB E38D                    	jecxz	lff22s2_3
  3407                                  lff22s2_2_2:
  3408 000017DD 66AD                    	lodsw
  3409 000017DF 89C3                    	mov	ebx, eax
  3410 000017E1 66AD                    	lodsw
  3411 000017E3 8B16                    	mov	edx, [esi]
  3412 000017E5 668915[80210000]        	mov	[next_val_l], dx
  3413                                  	; 26/11/2023
  3414 000017EC C1EA10                  	shr	edx, 16
  3415 000017EF 49                      	dec	ecx
  3416 000017F0 7509                    	jnz	short lff22s2_2_3
  3417 000017F2 31D2                    	xor	edx, edx ; 0
  3418 000017F4 668915[80210000]        	mov	[next_val_l], dx
  3419                                  lff22s2_2_3:
  3420 000017FB E8B3050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3421 00001800 E31E                    	jecxz	lff22s2_2_4
  3422                                  
  3423 00001802 4D                      	dec	ebp
  3424 00001803 75D8                    	jnz	short lff22s2_2_2
  3425                                  
  3426 00001805 A0[84210000]            	mov	al, [faz]
  3427 0000180A FEC8                    	dec	al
  3428 0000180C 749E                    	jz	short lff22s2_9
  3429 0000180E FE0D[84210000]          	dec	byte [faz]
  3430 00001814 BD04000000              	mov	ebp, 4
  3431 00001819 FEC8                    	dec	al
  3432 0000181B 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3433 0000181D 45                      	inc	ebp ; 5
  3434 0000181E EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3435                                  
  3436                                  lff22s2_2_4:
  3437                                  	; 26/11/2023
  3438 00001820 E9C8F3FFFF              	jmp	lff22_3	; padfill
  3439                                  
  3440                                  ; .....................
  3441                                  
  3442                                  load_11khz_mono_8_bit:
  3443                                  	; 18/11/2023
  3444 00001825 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3445                                  					; last of the file?
  3446 0000182C 7402                    	jz	short lff11m_0		; no
  3447 0000182E F9                      	stc
  3448 0000182F C3                      	retn
  3449                                  
  3450                                  lff11m_0:
  3451                                  	; 01/12/2024
  3452                                  	; edi = audio buffer address
  3453 00001830 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3454                                          ;mov	edx, [loadsize]
  3455                                  
  3456                                  	; esi = buffer address
  3457                                  	;; edx = buffer size
  3458                                  
  3459                                  	; load file into memory
  3460                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001835 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000183B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000183D 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001843 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001848 CD40                <1>  int 40h
  3461 0000184A 7247                    	jc	short lff11m_7 ; error !
  3462                                  
  3463                                  	; 01/12/2024
  3464 0000184C A3[F87D0000]            	mov	[count], eax
  3465                                  	;;;
  3466                                  	; 07/12/2024
  3467                                  	;mov	edi, audio_buffer
  3468                                  	;;;
  3469 00001851 21C0                    	and	eax, eax
  3470 00001853 7505                    	jnz	short lff11m_8
  3471 00001855 E9ABF3FFFF              	jmp	lff11_eof
  3472                                  
  3473                                  lff11m_8:
  3474 0000185A 89C1                    	mov	ecx, eax		; byte count
  3475                                  lff11m_9:
  3476 0000185C BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3477                                  lff11m_1:
  3478                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3479 00001861 AC                      	lodsb
  3480 00001862 B280                    	mov	dl, 80h
  3481 00001864 49                      	dec	ecx
  3482 00001865 7402                    	jz	short lff11m_2_1
  3483 00001867 8A16                    	mov	dl, [esi]
  3484                                  lff11m_2_1:	
  3485                                  	; al = [previous_val]
  3486                                  	; dl = [next_val]
  3487 00001869 E876050000              	call	interpolating_5_8bit_mono
  3488 0000186E E328                    	jecxz	lff11m_3
  3489                                  lff11m_2_2:
  3490 00001870 AC                      	lodsb
  3491 00001871 B280                    	mov	dl, 80h
  3492 00001873 49                      	dec	ecx
  3493 00001874 7402                    	jz	short lff11m_2_3
  3494 00001876 8A16                    	mov	dl, [esi]
  3495                                  lff11m_2_3:
  3496 00001878 E873060000               	call	interpolating_4_8bit_mono
  3497 0000187D E319                    	jecxz	lff11m_3
  3498                                  
  3499 0000187F 4D                      	dec	ebp
  3500 00001880 74DA                    	jz	short lff11m_9
  3501                                  
  3502 00001882 AC                      	lodsb
  3503 00001883 B280                    	mov	dl, 80h
  3504 00001885 49                      	dec	ecx
  3505 00001886 7402                    	jz	short lff11m_2_4
  3506 00001888 8A16                    	mov	dl, [esi]
  3507                                  lff11m_2_4:
  3508 0000188A E861060000              	call	interpolating_4_8bit_mono
  3509 0000188F E307                    	jecxz	lff11m_3
  3510 00001891 EBCE                    	jmp	short lff11m_1
  3511                                  
  3512                                  lff11m_7:
  3513                                  lff11s_7:
  3514 00001893 E976F3FFFF              	jmp	lff11_5  ; error
  3515                                  
  3516                                  lff11m_3:
  3517                                  lff11s_3:
  3518 00001898 E950F3FFFF              	jmp	lff11_3	; padfill
  3519                                  		; (put zeros in the remain words of the buffer)
  3520                                  
  3521                                  load_11khz_stereo_8_bit:
  3522                                  	; 18/11/2023
  3523 0000189D F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3524                                  					; last of the file?
  3525 000018A4 7402                    	jz	short lff11s_0		; no
  3526 000018A6 F9                      	stc
  3527 000018A7 C3                      	retn
  3528                                  
  3529                                  lff11s_0:
  3530                                  	; 01/12/2024
  3531                                  	; edi = audio buffer address
  3532 000018A8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3533                                          ;mov	edx, [loadsize]
  3534                                  
  3535                                  	; esi = buffer address
  3536                                  	;; edx = buffer size
  3537                                  
  3538                                  	; load file into memory
  3539                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000018AD 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000018B3 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000018B5 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000018BB B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000018C0 CD40                <1>  int 40h
  3540 000018C2 72CF                    	jc	short lff11s_7 ; error !
  3541                                  
  3542                                  	; 01/12/2024
  3543 000018C4 A3[F87D0000]            	mov	[count], eax
  3544                                  	;;;
  3545                                  	; 07/12/2024
  3546                                  	;mov	edi, audio_buffer
  3547                                  	;;;
  3548 000018C9 D1E8                    	shr	eax, 1
  3549 000018CB 7505                    	jnz	short lff11s_8
  3550 000018CD E933F3FFFF              	jmp	lff11_eof
  3551                                  
  3552                                  lff11s_8:
  3553 000018D2 89C1                    	mov	ecx, eax	; word count
  3554                                  lff11s_9:
  3555 000018D4 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3556                                  lff11s_1:
  3557                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3558 000018D9 66AD                    	lodsw
  3559 000018DB 66BA8080                	mov	dx, 8080h
  3560 000018DF 49                      	dec	ecx
  3561 000018E0 7403                    	jz	short lff11s_2_1
  3562 000018E2 668B16                  	mov	dx, [esi]
  3563                                  lff11s_2_1:	
  3564                                  	; al = [previous_val_l]
  3565                                  	; ah = [previous_val_r]
  3566                                  	; dl = [next_val_l]
  3567                                  	; dh = [next_val_r]
  3568 000018E5 E859050000              	call	interpolating_5_8bit_stereo
  3569 000018EA E3AC                    	jecxz	lff11s_3
  3570                                  lff11s_2_2:
  3571 000018EC 66AD                    	lodsw
  3572 000018EE 66BA8080                	mov	dx, 8080h
  3573 000018F2 49                      	dec	ecx
  3574 000018F3 7403                    	jz	short lff11s_2_3
  3575 000018F5 668B16                  	mov	dx, [esi]
  3576                                  lff11s_2_3:
  3577 000018F8 E832060000               	call	interpolating_4_8bit_stereo
  3578 000018FD E399                    	jecxz	lff11s_3
  3579                                  	
  3580 000018FF 4D                      	dec	ebp
  3581 00001900 74D2                    	jz	short lff11s_9
  3582                                  
  3583 00001902 66AD                    	lodsw
  3584 00001904 66BA8080                	mov	dx, 8080h
  3585 00001908 49                      	dec	ecx
  3586 00001909 7403                    	jz	short lff11s_2_4
  3587 0000190B 668B16                  	mov	dx, [esi]
  3588                                  lff11s_2_4:
  3589 0000190E E81C060000              	call	interpolating_4_8bit_stereo
  3590 00001913 E383                    	jecxz	lff11s_3
  3591 00001915 EBC2                    	jmp	short lff11s_1
  3592                                  
  3593                                  load_11khz_mono_16_bit:
  3594                                  	; 18/11/2023
  3595 00001917 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3596                                  					; last of the file?
  3597 0000191E 7402                    	jz	short lff11m2_0		; no
  3598 00001920 F9                      	stc
  3599 00001921 C3                      	retn
  3600                                  
  3601                                  lff11m2_0:
  3602                                  	; 01/12/2024
  3603                                  	; edi = audio buffer address
  3604 00001922 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3605                                          ;mov	edx, [loadsize]
  3606                                  
  3607                                  	; esi = buffer address
  3608                                  	;; edx = buffer size
  3609                                  
  3610                                  	; load file into memory
  3611                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001927 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000192D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000192F 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001935 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000193A CD40                <1>  int 40h
  3612 0000193C 724D                    	jc	short lff11m2_7 ; error !
  3613                                  
  3614                                  	; 01/12/2024
  3615 0000193E A3[F87D0000]            	mov	[count], eax
  3616                                  	;;;
  3617                                  	; 07/12/2024
  3618                                  	;mov	edi, audio_buffer
  3619                                  	;;;
  3620 00001943 D1E8                    	shr	eax, 1
  3621 00001945 7505                    	jnz	short lff11m2_8
  3622 00001947 E9B9F2FFFF              	jmp	lff11_eof
  3623                                  
  3624                                  lff11m2_8:
  3625 0000194C 89C1                    	mov	ecx, eax	; word count
  3626                                  lff11m2_9:
  3627 0000194E BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3628                                  lff11m2_1:
  3629                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3630 00001953 66AD                    	lodsw
  3631 00001955 31D2                    	xor	edx, edx
  3632 00001957 49                      	dec	ecx
  3633 00001958 7403                    	jz	short lff11m2_2_1
  3634 0000195A 668B16                  	mov	dx, [esi]
  3635                                  lff11m2_2_1:	
  3636                                  	; ax = [previous_val]
  3637                                  	; dx = [next_val]
  3638 0000195D E83A060000              	call	interpolating_5_16bit_mono
  3639 00001962 E362                    	jecxz	lff11m2_3
  3640                                  lff11m2_2_2:
  3641 00001964 66AD                    	lodsw
  3642 00001966 31D2                    	xor	edx, edx
  3643 00001968 49                      	dec	ecx
  3644 00001969 7403                    	jz	short lff11m2_2_3
  3645 0000196B 668B16                  	mov	dx, [esi]
  3646                                  lff11m2_2_3:
  3647 0000196E E853070000               	call	interpolating_4_16bit_mono
  3648 00001973 E351                    	jecxz	lff11m2_3
  3649                                  
  3650 00001975 4D                      	dec	ebp
  3651 00001976 74D6                    	jz	short lff11m2_9
  3652                                  
  3653 00001978 66AD                    	lodsw
  3654 0000197A 31D2                    	xor	edx, edx
  3655 0000197C 49                      	dec	ecx
  3656 0000197D 7403                    	jz	short lff11m2_2_4
  3657 0000197F 668B16                  	mov	dx, [esi]
  3658                                  lff11m2_2_4:
  3659 00001982 E83F070000               	call	interpolating_4_16bit_mono
  3660 00001987 E33D                    	jecxz	lff11m2_3
  3661 00001989 EBC8                    	jmp	short lff11m2_1
  3662                                  
  3663                                  lff11m2_7:
  3664                                  lff11s2_7:
  3665 0000198B E97EF2FFFF              	jmp	lff11_5  ; error
  3666                                  
  3667                                  load_11khz_stereo_16_bit:
  3668                                  	; 18/11/2023
  3669 00001990 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3670                                  					; last of the file?
  3671 00001997 7402                    	jz	short lff11s2_0		; no
  3672 00001999 F9                      	stc
  3673 0000199A C3                      	retn
  3674                                  
  3675                                  lff11s2_0:
  3676                                  	; 01/12/2024
  3677                                  	; edi = audio buffer address
  3678 0000199B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3679                                          ;mov	edx, [loadsize]
  3680                                  
  3681                                  	; esi = buffer address
  3682                                  	;; edx = buffer size
  3683                                  
  3684                                  	; load file into memory
  3685                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000019A0 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000019A6 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000019A8 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000019AE B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000019B3 CD40                <1>  int 40h
  3686 000019B5 72D4                    	jc	short lff11s2_7 ; error !
  3687                                  
  3688                                  	; 01/12/2024
  3689 000019B7 A3[F87D0000]            	mov	[count], eax
  3690                                  	;;;
  3691                                  	; 07/12/2024
  3692                                  	;mov	edi, audio_buffer
  3693                                  	;;;
  3694 000019BC C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3695 000019BF 750A                    	jnz	short lff11s2_8
  3696 000019C1 E93FF2FFFF              	jmp	lff11_eof
  3697                                  
  3698                                  lff11m2_3:
  3699                                  lff11s2_3:
  3700 000019C6 E922F2FFFF              	jmp	lff11_3	; padfill
  3701                                  		; (put zeros in the remain words of the buffer)
  3702                                  
  3703                                  lff11s2_8:
  3704 000019CB 89C1                    	mov	ecx, eax	; dword count
  3705                                  lff11s2_9:
  3706 000019CD BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3707                                  lff11s2_1:
  3708                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3709 000019D2 66AD                    	lodsw
  3710 000019D4 89C3                    	mov	ebx, eax
  3711 000019D6 66AD                    	lodsw
  3712 000019D8 8B16                    	mov	edx, [esi]
  3713 000019DA 8915[80210000]          	mov	[next_val_l], edx
  3714                                  	; 26/11/2023
  3715 000019E0 C1EA10                  	shr	edx, 16
  3716                                  	;mov	[next_val_r], dx
  3717 000019E3 49                      	dec	ecx
  3718 000019E4 7509                    	jnz	short lff11s2_2_1
  3719 000019E6 31D2                    	xor	edx, edx ; 0
  3720 000019E8 668915[80210000]        	mov	[next_val_l], dx
  3721                                  	;mov	[next_val_r], dx
  3722                                  lff11s2_2_1:
  3723                                  	; bx = [previous_val_l]
  3724                                  	; ax = [previous_val_r]
  3725                                  	; [next_val_l]
  3726                                  	; dx = [next_val_r]
  3727 000019EF E803060000              	call	interpolating_5_16bit_stereo
  3728 000019F4 E3D0                    	jecxz	lff11s2_3
  3729                                  lff11s2_2_2:
  3730 000019F6 66AD                    	lodsw
  3731 000019F8 89C3                    	mov	ebx, eax
  3732 000019FA 66AD                    	lodsw
  3733 000019FC 8B16                    	mov	edx, [esi]
  3734 000019FE 668915[80210000]        	mov	[next_val_l], dx
  3735                                  	; 26/11/2023
  3736 00001A05 C1EA10                  	shr	edx, 16
  3737                                  	;mov	[next_val_r], dx
  3738 00001A08 49                      	dec	ecx
  3739 00001A09 7509                    	jnz	short lff11s2_2_3
  3740 00001A0B 31D2                    	xor	edx, edx ; 0
  3741 00001A0D 668915[80210000]        	mov	[next_val_l], dx
  3742                                  	;mov	[next_val_r], dx
  3743                                  lff11s2_2_3:
  3744 00001A14 E8E6060000               	call	interpolating_4_16bit_stereo
  3745 00001A19 E3AB                    	jecxz	lff11s2_3
  3746                                  	
  3747 00001A1B 4D                      	dec	ebp
  3748 00001A1C 74AF                    	jz	short lff11s2_9
  3749                                  
  3750 00001A1E 66AD                    	lodsw
  3751 00001A20 89C3                    	mov	ebx, eax
  3752 00001A22 66AD                    	lodsw
  3753 00001A24 8B16                    	mov	edx, [esi]
  3754 00001A26 668915[80210000]        	mov	[next_val_l], dx
  3755                                  	; 26/11/2023
  3756 00001A2D C1EA10                  	shr	edx, 16
  3757                                  	;mov	[next_val_r], dx
  3758 00001A30 49                      	dec	ecx
  3759 00001A31 7509                    	jnz	short lff11s2_2_4
  3760 00001A33 31D2                    	xor	edx, edx ; 0
  3761 00001A35 668915[80210000]        	mov	[next_val_l], dx
  3762                                  	;mov	[next_val_r], dx
  3763                                  lff11s2_2_4:
  3764 00001A3C E8BE060000               	call	interpolating_4_16bit_stereo
  3765 00001A41 E383                    	jecxz	lff11s2_3
  3766 00001A43 EB8D                    	jmp	short lff11s2_1
  3767                                  
  3768                                  ; .....................
  3769                                  
  3770                                  load_44khz_mono_8_bit:
  3771                                  	; 18/11/2023
  3772 00001A45 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3773                                  					; last of the file?
  3774 00001A4C 7402                    	jz	short lff44m_0		; no
  3775 00001A4E F9                      	stc
  3776 00001A4F C3                      	retn
  3777                                  
  3778                                  lff44m_0:
  3779                                  	; 01/12/2024
  3780                                  	; edi = audio buffer address
  3781 00001A50 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3782                                          ;mov	edx, [loadsize]
  3783                                  
  3784                                  	; esi = buffer address
  3785                                  	;; edx = buffer size
  3786                                  
  3787                                  	; load file into memory
  3788                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001A55 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001A5B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001A5D 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001A63 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001A68 CD40                <1>  int 40h
  3789 00001A6A 7250                    	jc	short lff44m_7 ; error !
  3790                                  
  3791                                  	; 01/12/2024
  3792 00001A6C A3[F87D0000]            	mov	[count], eax
  3793                                  	;;;
  3794                                  	; 07/12/2024
  3795                                  	;mov	edi, audio_buffer
  3796                                  	;;;
  3797 00001A71 21C0                    	and	eax, eax
  3798 00001A73 7505                    	jnz	short lff44m_8
  3799 00001A75 E98BF1FFFF              	jmp	lff44_eof
  3800                                  
  3801                                  lff44m_8:
  3802 00001A7A 89C1                    	mov	ecx, eax	; byte count
  3803                                  lff44m_9:
  3804 00001A7C BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3805 00001A81 C605[84210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3806                                  lff44m_1:
  3807                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3808                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3809 00001A88 AC                      	lodsb
  3810 00001A89 B280                    	mov	dl, 80h
  3811 00001A8B 49                      	dec	ecx
  3812 00001A8C 7402                    	jz	short lff44m_2_1
  3813 00001A8E 8A16                    	mov	dl, [esi]
  3814                                  lff44m_2_1:	
  3815                                  	; al = [previous_val]
  3816                                  	; dl = [next_val]
  3817 00001A90 E825020000              	call	interpolating_2_8bit_mono
  3818 00001A95 E320                    	jecxz	lff44m_3
  3819                                  lff44m_2_2:
  3820 00001A97 AC                      	lodsb
  3821 00001A98 2C80                    	sub	al, 80h
  3822 00001A9A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3823 00001A9E 66AB                    	stosw		; (L)
  3824 00001AA0 66AB                    	stosw		; (R)
  3825                                  
  3826 00001AA2 49                      	dec	ecx
  3827 00001AA3 7412                    	jz	short lff44m_3
  3828 00001AA5 4D                      	dec	ebp
  3829 00001AA6 75EF                    	jnz	short lff44m_2_2
  3830                                  	
  3831 00001AA8 FE0D[84210000]          	dec	byte [faz]
  3832 00001AAE 74CC                    	jz	short lff44m_9 
  3833 00001AB0 BD0B000000              	mov	ebp, 11
  3834 00001AB5 EBD1                    	jmp	short lff44m_1
  3835                                  
  3836                                  lff44m_3:
  3837                                  lff44s_3:
  3838 00001AB7 E931F1FFFF              	jmp	lff44_3	; padfill
  3839                                  		; (put zeros in the remain words of the buffer)
  3840                                  lff44m_7:
  3841                                  lff44s_7:
  3842 00001ABC E94DF1FFFF              	jmp	lff44_5  ; error
  3843                                  
  3844                                  load_44khz_stereo_8_bit:
  3845                                  	; 16/11/2023
  3846 00001AC1 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3847                                  					; last of the file?
  3848 00001AC8 7402                    	jz	short lff44s_0		; no
  3849 00001ACA F9                      	stc
  3850 00001ACB C3                      	retn
  3851                                  
  3852                                  lff44s_0:
  3853                                  	; 01/12/2024
  3854                                  	; edi = audio buffer address
  3855 00001ACC BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3856                                          ;mov	edx, [loadsize]
  3857                                  
  3858                                  	; esi = buffer address
  3859                                  	;; edx = buffer size
  3860                                  
  3861                                  	; load file into memory
  3862                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001AD1 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001AD7 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001AD9 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001ADF B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001AE4 CD40                <1>  int 40h
  3863 00001AE6 72D4                    	jc	short lff44s_7 ; error !
  3864                                  
  3865                                  	; 01/12/2024
  3866 00001AE8 A3[F87D0000]            	mov	[count], eax
  3867                                  	;;;
  3868                                  	; 07/12/2024
  3869                                  	;mov	edi, audio_buffer
  3870                                  	;;;
  3871 00001AED D1E8                    	shr	eax, 1
  3872 00001AEF 7505                    	jnz	short lff44s_8
  3873 00001AF1 E90FF1FFFF              	jmp	lff44_eof
  3874                                  
  3875                                  lff44s_8:
  3876 00001AF6 89C1                    	mov	ecx, eax	; word count
  3877                                  lff44s_9:
  3878 00001AF8 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3879 00001AFD C605[84210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3880                                  lff44s_1:
  3881                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3882                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3883 00001B04 66AD                    	lodsw
  3884 00001B06 66BA8080                	mov	dx, 8080h
  3885 00001B0A 49                      	dec	ecx
  3886 00001B0B 7403                    	jz	short lff44s_2_1
  3887 00001B0D 668B16                  	mov	dx, [esi]
  3888                                  lff44s_2_1:	
  3889                                  	; al = [previous_val_l]
  3890                                  	; ah = [previous_val_r]
  3891                                  	; dl = [next_val_l]
  3892                                  	; dh = [next_val_r]
  3893 00001B10 E8C2010000              	call	interpolating_2_8bit_stereo
  3894 00001B15 E3A0                    	jecxz	lff44s_3
  3895                                  lff44s_2_2:
  3896 00001B17 AC                      	lodsb
  3897 00001B18 2C80                    	sub	al, 80h
  3898 00001B1A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3899 00001B1E 66AB                    	stosw		; (L)
  3900 00001B20 AC                      	lodsb
  3901 00001B21 2C80                    	sub	al, 80h
  3902 00001B23 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3903 00001B27 66AB                    	stosw		; (R)
  3904                                  
  3905 00001B29 49                      	dec	ecx
  3906 00001B2A 748B                    	jz	short lff44s_3	
  3907 00001B2C 4D                      	dec	ebp
  3908 00001B2D 75E8                    	jnz	short lff44s_2_2
  3909                                  	
  3910 00001B2F FE0D[84210000]          	dec	byte [faz]
  3911 00001B35 74C1                    	jz	short lff44s_9 
  3912 00001B37 BD0B000000              	mov	ebp, 11
  3913 00001B3C EBC6                    	jmp	short lff44s_1
  3914                                  
  3915                                  load_44khz_mono_16_bit:
  3916                                  	; 18/11/2023
  3917 00001B3E F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3918                                  					; last of the file?
  3919 00001B45 7402                    	jz	short lff44m2_0		; no
  3920 00001B47 F9                      	stc
  3921 00001B48 C3                      	retn
  3922                                  
  3923                                  lff44m2_0:
  3924                                  	; 01/12/2024
  3925                                  	; edi = audio buffer address
  3926 00001B49 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3927                                          ;mov	edx, [loadsize]
  3928                                  
  3929                                  	; esi = buffer address
  3930                                  	;; edx = buffer size
  3931                                  
  3932                                  	; load file into memory
  3933                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001B4E 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001B54 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001B56 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001B5C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001B61 CD40                <1>  int 40h
  3934 00001B63 724D                    	jc	short lff44m2_7 ; error !
  3935                                  
  3936                                  	; 01/12/2024
  3937 00001B65 A3[F87D0000]            	mov	[count], eax
  3938                                  	;;;
  3939                                  	; 07/12/2024
  3940                                  	;mov	edi, audio_buffer
  3941                                  	;;;
  3942 00001B6A D1E8                    	shr	eax, 1
  3943 00001B6C 7505                    	jnz	short lff44m2_8
  3944 00001B6E E992F0FFFF              	jmp	lff44_eof
  3945                                  
  3946                                  lff44m2_8:
  3947 00001B73 89C1                    	mov	ecx, eax	; word count
  3948                                  lff44m2_9:
  3949 00001B75 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3950 00001B7A C605[84210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3951                                  lff44m2_1:
  3952                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3953                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3954 00001B81 66AD                    	lodsw
  3955 00001B83 31D2                    	xor	edx, edx
  3956 00001B85 49                      	dec	ecx
  3957 00001B86 7403                    	jz	short lff44m2_2_1
  3958 00001B88 668B16                  	mov	dx, [esi]
  3959                                  lff44m2_2_1:	
  3960                                  	; ax = [previous_val]
  3961                                  	; dx = [next_val]
  3962 00001B8B E80B020000              	call	interpolating_2_16bit_mono
  3963 00001B90 E31B                    	jecxz	lff44m2_3
  3964                                  lff44m2_2_2:
  3965 00001B92 66AD                    	lodsw
  3966 00001B94 66AB                    	stosw		; (L)eft Channel
  3967 00001B96 66AB                    	stosw		; (R)ight Channel
  3968                                  
  3969 00001B98 49                      	dec	ecx
  3970 00001B99 7412                    	jz	short lff44m2_3	
  3971 00001B9B 4D                      	dec	ebp
  3972 00001B9C 75F4                    	jnz	short lff44m2_2_2
  3973                                  	
  3974 00001B9E FE0D[84210000]          	dec	byte [faz]
  3975 00001BA4 74CF                    	jz	short lff44m2_9 
  3976 00001BA6 BD0B000000              	mov	ebp, 11
  3977 00001BAB EBD4                    	jmp	short lff44m2_1
  3978                                  
  3979                                  lff44m2_3:
  3980                                  lff44s2_3:
  3981 00001BAD E93BF0FFFF              	jmp	lff44_3	; padfill
  3982                                  		; (put zeros in the remain words of the buffer)
  3983                                  lff44m2_7:
  3984                                  lff44s2_7:
  3985 00001BB2 E957F0FFFF              	jmp	lff44_5  ; error
  3986                                  
  3987                                  load_44khz_stereo_16_bit:
  3988                                  	; 18/11/2023
  3989 00001BB7 F605[7E7D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3990                                  					; last of the file?
  3991 00001BBE 7402                    	jz	short lff44s2_0		; no
  3992 00001BC0 F9                      	stc
  3993 00001BC1 C3                      	retn
  3994                                  
  3995                                  lff44s2_0:
  3996                                  	; 01/12/2024
  3997                                  	; edi = audio buffer address
  3998 00001BC2 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3999                                          ;mov	edx, [loadsize]
  4000                                  
  4001                                  	; esi = buffer address
  4002                                  	;; edx = buffer size
  4003                                  
  4004                                  	; load file into memory
  4005                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001BC7 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001BCD 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001BCF 8B15[E87D0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001BD5 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001BDA CD40                <1>  int 40h
  4006 00001BDC 72D4                    	jc	short lff44s2_7 ; error !
  4007                                  
  4008                                  	; 01/12/2024
  4009 00001BDE A3[F87D0000]            	mov	[count], eax
  4010                                  	;;;
  4011                                  	; 07/12/2024
  4012                                  	;mov	edi, audio_buffer
  4013                                  	;;;
  4014 00001BE3 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4015 00001BE6 7505                    	jnz	short lff44s2_8
  4016 00001BE8 E918F0FFFF              	jmp	lff44_eof
  4017                                  
  4018                                  lff44s2_8:
  4019 00001BED 89C1                    	mov	ecx, eax	; dword count
  4020                                  lff44s2_9:
  4021 00001BEF BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4022 00001BF4 C605[84210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4023                                  lff44s2_1:
  4024                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4025                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4026 00001BFB 66AD                    	lodsw
  4027 00001BFD 89C3                    	mov	ebx, eax
  4028 00001BFF 66AD                    	lodsw
  4029                                  	;mov	dx, [esi]
  4030                                  	;mov	[next_val_l], dx
  4031                                  	;mov	dx, [esi+2]
  4032                                  	; 26/11/2023
  4033 00001C01 8B16                    	mov	edx, [esi]
  4034 00001C03 668915[80210000]        	mov	[next_val_l], dx
  4035 00001C0A C1EA10                  	shr	edx, 16
  4036 00001C0D 49                      	dec	ecx
  4037 00001C0E 7509                    	jnz	short lff44s2_2_1
  4038 00001C10 31D2                    	xor	edx, edx ; 0
  4039 00001C12 668915[80210000]        	mov	[next_val_l], dx
  4040                                  lff44s2_2_1:
  4041                                  	; bx = [previous_val_l]
  4042                                  	; ax = [previous_val_r]
  4043                                  	; [next_val_l]
  4044                                  	; dx = [next_val_r]
  4045 00001C19 E895010000              	call	interpolating_2_16bit_stereo
  4046 00001C1E E38D                    	jecxz	lff44s2_3
  4047                                  lff44s2_2_2:
  4048                                  	;movsw		; (L)eft Channel
  4049                                  	;movsw		; (R)ight Channel
  4050 00001C20 A5                      	movsd
  4051                                  
  4052 00001C21 49                      	dec	ecx
  4053 00001C22 7489                    	jz	short lff44s2_3	
  4054 00001C24 4D                      	dec	ebp
  4055 00001C25 75F9                    	jnz	short lff44s2_2_2
  4056                                  	
  4057 00001C27 FE0D[84210000]          	dec	byte [faz]
  4058 00001C2D 74C0                    	jz	short lff44s2_9 
  4059 00001C2F BD0B000000              	mov	ebp, 11
  4060 00001C34 EBC5                    	jmp	short lff44s2_1
  4061                                  
  4062                                  ; .....................
  4063                                  
  4064                                  interpolating_3_8bit_mono:
  4065                                  	; 16/11/2023
  4066                                  	; al = [previous_val]
  4067                                  	; dl = [next_val]
  4068                                  	; original-interpolated-interpolated
  4069 00001C36 88C3                    	mov	bl, al
  4070 00001C38 2C80                    	sub	al, 80h
  4071 00001C3A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4072 00001C3E 66AB                    	stosw		; original sample (L)
  4073 00001C40 66AB                    	stosw		; original sample (R)
  4074 00001C42 88D8                    	mov	al, bl
  4075 00001C44 00D0                    	add	al, dl
  4076 00001C46 D0D8                    	rcr	al, 1
  4077 00001C48 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4078 00001C4A 00D8                    	add	al, bl
  4079 00001C4C D0D8                    	rcr	al, 1
  4080 00001C4E 2C80                    	sub	al, 80h
  4081 00001C50 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4082 00001C54 66AB                    	stosw		; interpolated sample 1 (L)
  4083 00001C56 66AB                    	stosw		; interpolated sample 1 (R)
  4084 00001C58 88F8                    	mov	al, bh
  4085 00001C5A 00D0                    	add	al, dl	; [next_val]
  4086 00001C5C D0D8                    	rcr	al, 1
  4087 00001C5E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4088 00001C62 66AB                    	stosw		; interpolated sample 2 (L)
  4089 00001C64 66AB                    	stosw		; interpolated sample 2 (R)
  4090 00001C66 C3                      	retn
  4091                                  
  4092                                  interpolating_3_8bit_stereo:
  4093                                  	; 16/11/2023
  4094                                  	; al = [previous_val_l]
  4095                                  	; ah = [previous_val_r]
  4096                                  	; dl = [next_val_l]
  4097                                  	; dh = [next_val_r]
  4098                                  	; original-interpolated-interpolated
  4099 00001C67 89C3                    	mov	ebx, eax
  4100 00001C69 2C80                    	sub	al, 80h
  4101 00001C6B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4102 00001C6F 66AB                    	stosw		; original sample (L)
  4103 00001C71 88F8                    	mov	al, bh
  4104 00001C73 2C80                    	sub	al, 80h
  4105 00001C75 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4106 00001C79 66AB                    	stosw		; original sample (R)
  4107 00001C7B 88D8                    	mov	al, bl
  4108 00001C7D 00D0                    	add	al, dl	; [next_val_l]
  4109 00001C7F D0D8                    	rcr	al, 1
  4110 00001C81 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4111 00001C82 00D8                    	add	al, bl	; [previous_val_l]
  4112 00001C84 D0D8                    	rcr	al, 1
  4113 00001C86 2C80                    	sub	al, 80h
  4114 00001C88 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4115 00001C8C 66AB                    	stosw		; interpolated sample 1 (L)
  4116 00001C8E 88F8                    	mov	al, bh
  4117 00001C90 00F0                    	add	al, dh	; [next_val_r]
  4118 00001C92 D0D8                    	rcr	al, 1
  4119 00001C94 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4120 00001C95 00F8                    	add	al, bh	; [previous_val_r]
  4121 00001C97 D0D8                    	rcr	al, 1
  4122 00001C99 2C80                    	sub	al, 80h
  4123 00001C9B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4124 00001C9F 66AB                    	stosw		; interpolated sample 1 (R)
  4125 00001CA1 5B                      	pop	ebx ; **
  4126 00001CA2 58                      	pop	eax ; *
  4127 00001CA3 00D0                    	add	al, dl	; [next_val_l]
  4128 00001CA5 D0D8                    	rcr	al, 1
  4129 00001CA7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4130 00001CAB 66AB                    	stosw		; interpolated sample 2 (L)
  4131 00001CAD 88D8                    	mov	al, bl
  4132 00001CAF 00F0                    	add	al, dh	; [next_val_r]
  4133 00001CB1 D0D8                    	rcr	al, 1
  4134 00001CB3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4135 00001CB7 66AB                    	stosw		; interpolated sample 2 (R)
  4136 00001CB9 C3                      	retn
  4137                                  
  4138                                  interpolating_2_8bit_mono:
  4139                                  	; 16/11/2023
  4140                                  	; al = [previous_val]
  4141                                  	; dl = [next_val]
  4142                                  	; original-interpolated
  4143 00001CBA 88C3                    	mov	bl, al
  4144 00001CBC 2C80                    	sub	al, 80h
  4145 00001CBE 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4146 00001CC2 66AB                    	stosw		; original sample (L)
  4147 00001CC4 66AB                    	stosw		; original sample (R)
  4148 00001CC6 88D8                    	mov	al, bl
  4149 00001CC8 00D0                    	add	al, dl
  4150 00001CCA D0D8                    	rcr	al, 1
  4151 00001CCC 2C80                    	sub	al, 80h
  4152 00001CCE 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4153 00001CD2 66AB                    	stosw		; interpolated sample (L)
  4154 00001CD4 66AB                    	stosw		; interpolated sample (R)
  4155 00001CD6 C3                      	retn
  4156                                  
  4157                                  interpolating_2_8bit_stereo:
  4158                                  	; 16/11/2023
  4159                                  	; al = [previous_val_l]
  4160                                  	; ah = [previous_val_r]
  4161                                  	; dl = [next_val_l]
  4162                                  	; dh = [next_val_r]
  4163                                  	; original-interpolated
  4164 00001CD7 89C3                    	mov	ebx, eax
  4165 00001CD9 2C80                    	sub	al, 80h
  4166 00001CDB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4167 00001CDF 66AB                    	stosw		; original sample (L)
  4168 00001CE1 88F8                    	mov	al, bh
  4169 00001CE3 2C80                    	sub	al, 80h
  4170 00001CE5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4171 00001CE9 66AB                    	stosw		; original sample (R)
  4172 00001CEB 88D8                    	mov	al, bl	; [previous_val_l]
  4173 00001CED 00D0                    	add	al, dl	; [next_val_l]
  4174 00001CEF D0D8                    	rcr	al, 1
  4175 00001CF1 2C80                    	sub	al, 80h
  4176 00001CF3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4177 00001CF7 66AB                    	stosw		; interpolated sample (L)
  4178 00001CF9 88F8                    	mov	al, bh
  4179 00001CFB 00F0                    	add	al, dh	; [next_val_r]
  4180 00001CFD D0D8                    	rcr	al, 1
  4181 00001CFF 2C80                    	sub	al, 80h
  4182 00001D01 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4183 00001D05 66AB                    	stosw		; interpolated sample (R)
  4184 00001D07 C3                      	retn
  4185                                  
  4186                                  interpolating_3_16bit_mono:
  4187                                  	; 16/11/2023
  4188                                  	; ax = [previous_val]
  4189                                  	; dx = [next_val]
  4190                                  	; original-interpolated-interpolated
  4191                                  
  4192 00001D08 66AB                    	stosw		; original sample (L)
  4193 00001D0A 66AB                    	stosw		; original sample (R)
  4194 00001D0C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4195 00001D0F 50                      	push	eax ; *	; [previous_val]
  4196 00001D10 80C680                  	add	dh, 80h
  4197 00001D13 6601D0                  	add	ax, dx
  4198 00001D16 66D1D8                  	rcr	ax, 1
  4199 00001D19 5B                      	pop	ebx ; *
  4200 00001D1A 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4201 00001D1B 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4202 00001D1E 66D1D8                  	rcr	ax, 1
  4203 00001D21 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4204 00001D24 66AB                    	stosw 		; interpolated sample 1 (L)
  4205 00001D26 66AB                    	stosw		; interpolated sample 1 (R)
  4206 00001D28 89D8                    	mov	eax, ebx
  4207 00001D2A 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4208 00001D2D 66D1D8                  	rcr	ax, 1
  4209 00001D30 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4210 00001D33 66AB                    	stosw		; interpolated sample 2 (L)
  4211 00001D35 66AB                    	stosw		; interpolated sample 2 (R)
  4212 00001D37 C3                      	retn
  4213                                  
  4214                                  interpolating_3_16bit_stereo:
  4215                                  	; 16/11/2023
  4216                                  	; bx = [previous_val_l]
  4217                                  	; ax = [previous_val_r]
  4218                                  	; [next_val_l]
  4219                                  	; dx = [next_val_r]
  4220                                  	; original-interpolated-interpolated
  4221                                  
  4222 00001D38 93                      	xchg	eax, ebx
  4223 00001D39 66AB                    	stosw		; original sample (L)
  4224 00001D3B 93                      	xchg	eax, ebx
  4225 00001D3C 66AB                    	stosw		; original sample (R)
  4226 00001D3E 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4227 00001D41 50                      	push	eax ; *	; [previous_val_r]
  4228 00001D42 80C780                  	add	bh, 80h
  4229 00001D45 8005[81210000]80        	add	byte [next_val_l+1], 80h
  4230 00001D4C 66A1[80210000]          	mov	ax, [next_val_l]
  4231 00001D52 6601D8                  	add	ax, bx	; [previous_val_l]
  4232 00001D55 66D1D8                  	rcr	ax, 1
  4233 00001D58 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4234 00001D59 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4235 00001D5C 66D1D8                  	rcr	ax, 1
  4236 00001D5F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4237 00001D62 66AB                    	stosw 		; interpolated sample 1 (L)
  4238 00001D64 58                      	pop	eax  ; *
  4239 00001D65 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4240 00001D68 52                      	push	edx  ; * ; [next_val_r]
  4241 00001D69 92                      	xchg	eax, edx
  4242 00001D6A 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4243 00001D6D 66D1D8                  	rcr	ax, 1	; / 2
  4244 00001D70 50                      	push	eax ; ** ; interpolated middle (R)
  4245 00001D71 6601D0                  	add	ax, dx	; + [previous_val_r]
  4246 00001D74 66D1D8                  	rcr	ax, 1
  4247 00001D77 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4248 00001D7A 66AB                    	stosw 		; interpolated sample 1 (R)
  4249 00001D7C 66A1[80210000]          	mov	ax, [next_val_l]
  4250 00001D82 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4251 00001D85 66D1D8                  	rcr	ax, 1
  4252 00001D88 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4253 00001D8B 66AB                    	stosw 		; interpolated sample 2 (L)
  4254 00001D8D 58                      	pop	eax ; **
  4255 00001D8E 5A                      	pop	edx ; *
  4256 00001D8F 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4257 00001D92 66D1D8                  	rcr	ax, 1	; / 2
  4258 00001D95 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4259 00001D98 66AB                    	stosw 		; interpolated sample 2 (L)
  4260 00001D9A C3                      	retn
  4261                                  
  4262                                  interpolating_2_16bit_mono:
  4263                                  	; 16/11/2023
  4264                                  	; ax = [previous_val]
  4265                                  	; dx = [next_val]
  4266                                  	; original-interpolated
  4267                                  
  4268 00001D9B 66AB                    	stosw		; original sample (L)
  4269 00001D9D 66AB                    	stosw		; original sample (R)
  4270 00001D9F 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4271 00001DA2 80C680                  	add	dh, 80h
  4272 00001DA5 6601D0                  	add	ax, dx
  4273 00001DA8 66D1D8                  	rcr	ax, 1
  4274 00001DAB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4275 00001DAE 66AB                    	stosw		; interpolated sample (L)
  4276 00001DB0 66AB                    	stosw		; interpolated sample (R)
  4277 00001DB2 C3                      	retn
  4278                                  
  4279                                  interpolating_2_16bit_stereo:
  4280                                  	; 16/11/2023
  4281                                  	; bx = [previous_val_l]
  4282                                  	; ax = [previous_val_r]
  4283                                  	; [next_val_l]
  4284                                  	; dx = [next_val_r]
  4285                                  	; original-interpolated
  4286                                  
  4287 00001DB3 93                      	xchg	eax, ebx
  4288 00001DB4 66AB                    	stosw		; original sample (L)
  4289 00001DB6 93                      	xchg	eax, ebx
  4290 00001DB7 66AB                    	stosw		; original sample (R)
  4291 00001DB9 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4292 00001DBC 80C680                  	add	dh, 80h
  4293 00001DBF 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4294 00001DC2 66D1D8                  	rcr	ax, 1	; / 2
  4295 00001DC5 50                      	push	eax ; *	; interpolated sample (R)
  4296 00001DC6 66A1[80210000]          	mov	ax, [next_val_l]
  4297 00001DCC 80C480                  	add	ah, 80h
  4298 00001DCF 80C780                  	add	bh, 80h
  4299 00001DD2 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4300 00001DD5 66D1D8                  	rcr	ax, 1	; / 2
  4301 00001DD8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4302 00001DDB 66AB                    	stosw 		; interpolated sample (L)
  4303 00001DDD 58                      	pop	eax ; *	
  4304 00001DDE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4305 00001DE1 66AB                    	stosw 		; interpolated sample (R)
  4306 00001DE3 C3                      	retn
  4307                                  
  4308                                  interpolating_5_8bit_mono:
  4309                                  	; 17/11/2023
  4310                                  	; al = [previous_val]
  4311                                  	; dl = [next_val]
  4312                                  	; original-interpltd-interpltd-interpltd-interpltd
  4313 00001DE4 88C3                    	mov	bl, al
  4314 00001DE6 2C80                    	sub	al, 80h
  4315 00001DE8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4316 00001DEC 66AB                    	stosw		; original sample (L)
  4317 00001DEE 66AB                    	stosw		; original sample (R)
  4318 00001DF0 88D8                    	mov	al, bl
  4319 00001DF2 00D0                    	add	al, dl
  4320 00001DF4 D0D8                    	rcr	al, 1
  4321 00001DF6 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4322 00001DF8 00D8                    	add	al, bl  ; [previous_val]
  4323 00001DFA D0D8                    	rcr	al, 1 	
  4324 00001DFC 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4325 00001DFE 00D8                    	add	al, bl
  4326 00001E00 D0D8                    	rcr	al, 1
  4327 00001E02 2C80                    	sub	al, 80h
  4328 00001E04 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4329 00001E08 66AB                    	stosw		; interpolated sample 1 (L)
  4330 00001E0A 66AB                    	stosw		; interpolated sample 1 (R)
  4331 00001E0C 88F8                    	mov	al, bh
  4332 00001E0E 00F0                    	add	al, dh
  4333 00001E10 D0D8                    	rcr	al, 1
  4334 00001E12 2C80                    	sub	al, 80h
  4335 00001E14 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4336 00001E18 66AB                    	stosw		; interpolated sample 2 (L)
  4337 00001E1A 66AB                    	stosw		; interpolated sample 2 (R)
  4338 00001E1C 88F8                    	mov	al, bh
  4339 00001E1E 00D0                    	add	al, dl	; [next_val]
  4340 00001E20 D0D8                    	rcr	al, 1
  4341 00001E22 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4342 00001E24 00F8                    	add	al, bh
  4343 00001E26 D0D8                    	rcr	al, 1
  4344 00001E28 2C80                    	sub	al, 80h
  4345 00001E2A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4346 00001E2E 66AB                    	stosw		; interpolated sample 3 (L)
  4347 00001E30 66AB                    	stosw		; interpolated sample 3 (R)
  4348 00001E32 88F0                    	mov	al, dh
  4349 00001E34 00D0                    	add	al, dl
  4350 00001E36 D0D8                    	rcr	al, 1
  4351 00001E38 2C80                    	sub	al, 80h
  4352 00001E3A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4353 00001E3E 66AB                    	stosw		; interpolated sample 4 (L)
  4354 00001E40 66AB                    	stosw		; interpolated sample 4 (R)
  4355 00001E42 C3                      	retn
  4356                                  
  4357                                  interpolating_5_8bit_stereo:
  4358                                  	; 17/11/2023
  4359                                  	; al = [previous_val_l]
  4360                                  	; ah = [previous_val_r]
  4361                                  	; dl = [next_val_l]
  4362                                  	; dh = [next_val_r]
  4363                                  	; original-interpltd-interpltd-interpltd-interpltd
  4364 00001E43 89C3                    	mov	ebx, eax
  4365 00001E45 2C80                    	sub	al, 80h
  4366 00001E47 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4367 00001E4B 66AB                    	stosw		; original sample (L)
  4368 00001E4D 88F8                    	mov	al, bh
  4369 00001E4F 2C80                    	sub	al, 80h
  4370 00001E51 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4371 00001E55 66AB                    	stosw		; original sample (R)
  4372 00001E57 52                      	push	edx ; *
  4373 00001E58 88D8                    	mov	al, bl
  4374 00001E5A 00D0                    	add	al, dl	; [next_val_l]
  4375 00001E5C D0D8                    	rcr	al, 1
  4376 00001E5E 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4377 00001E5F 00D8                    	add	al, bl	; [previous_val_l]
  4378 00001E61 D0D8                    	rcr	al, 1
  4379 00001E63 86D8                    	xchg	al, bl
  4380 00001E65 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4381 00001E67 D0D8                    	rcr	al, 1
  4382 00001E69 2C80                    	sub	al, 80h
  4383 00001E6B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4384 00001E6F 66AB                    	stosw		; interpolated sample 1 (L)
  4385 00001E71 88F8                    	mov	al, bh
  4386 00001E73 00F0                    	add	al, dh	; [next_val_r]
  4387 00001E75 D0D8                    	rcr	al, 1
  4388 00001E77 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4389 00001E78 00F8                    	add	al, bh	; [previous_val_r]
  4390 00001E7A D0D8                    	rcr	al, 1
  4391 00001E7C 86F8                    	xchg	al, bh
  4392 00001E7E 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4393 00001E80 D0D8                    	rcr	al, 1
  4394 00001E82 2C80                    	sub	al, 80h
  4395 00001E84 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4396 00001E88 66AB                    	stosw		; interpolated sample 1 (R)
  4397 00001E8A 5A                      	pop	edx ; ***
  4398 00001E8B 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4399 00001E8C 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4400 00001E8E 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4401 00001E90 D0D8                    	rcr	al, 1
  4402 00001E92 2C80                    	sub	al, 80h
  4403 00001E94 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4404 00001E98 66AB                    	stosw		; interpolated sample 2 (L)
  4405 00001E9A 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4406 00001E9C 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4407 00001E9E 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4408 00001EA0 D0D8                    	rcr	al, 1
  4409 00001EA2 2C80                    	sub	al, 80h
  4410 00001EA4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4411 00001EA8 66AB                    	stosw		; interpolated sample 2 (R)
  4412 00001EAA 5A                      	pop	edx ; *
  4413 00001EAB 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4414 00001EAD 00D0                    	add	al, dl	; [next_val_l]
  4415 00001EAF D0D8                    	rcr	al, 1
  4416 00001EB1 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4417 00001EB3 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4418 00001EB5 D0D8                    	rcr	al, 1
  4419 00001EB7 2C80                    	sub	al, 80h
  4420 00001EB9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4421 00001EBD 66AB                    	stosw		; interpolated sample 3 (L)
  4422 00001EBF 88F8                    	mov	al, bh	
  4423 00001EC1 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4424 00001EC3 D0D8                    	rcr	al, 1
  4425 00001EC5 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4426 00001EC7 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4427 00001EC9 D0D8                    	rcr	al, 1
  4428 00001ECB 2C80                    	sub	al, 80h
  4429 00001ECD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4430 00001ED1 66AB                    	stosw		; interpolated sample 3 (R)
  4431 00001ED3 88D8                    	mov	al, bl
  4432 00001ED5 00D0                    	add	al, dl	; [next_val_l]
  4433 00001ED7 D0D8                    	rcr	al, 1
  4434 00001ED9 2C80                    	sub	al, 80h
  4435 00001EDB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4436 00001EDF 66AB                    	stosw		; interpolated sample 4 (L)
  4437 00001EE1 88F8                    	mov	al, bh
  4438 00001EE3 00F0                    	add	al, dh	; [next_val_r]
  4439 00001EE5 D0D8                    	rcr	al, 1
  4440 00001EE7 2C80                    	sub	al, 80h
  4441 00001EE9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4442 00001EED 66AB                    	stosw		; interpolated sample 4 (R)
  4443 00001EEF C3                      	retn
  4444                                  
  4445                                  interpolating_4_8bit_mono:
  4446                                  	; 17/11/2023
  4447                                  	; al = [previous_val]
  4448                                  	; dl = [next_val]
  4449                                  	; original-interpolated-interpolated-interpolated
  4450 00001EF0 88C3                    	mov	bl, al
  4451 00001EF2 2C80                    	sub	al, 80h
  4452 00001EF4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4453 00001EF8 66AB                    	stosw		; original sample (L)
  4454 00001EFA 66AB                    	stosw		; original sample (R)
  4455 00001EFC 88D8                    	mov	al, bl
  4456 00001EFE 00D0                    	add	al, dl	
  4457 00001F00 D0D8                    	rcr	al, 1
  4458 00001F02 86D8                    	xchg	al, bl  ; al = [previous_val]
  4459 00001F04 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4460 00001F06 D0D8                    	rcr	al, 1 	
  4461 00001F08 2C80                    	sub	al, 80h
  4462 00001F0A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4463 00001F0E 66AB                    	stosw		; interpolated sample 1 (L)
  4464 00001F10 66AB                    	stosw		; interpolated sample 1 (R)
  4465 00001F12 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4466 00001F14 2C80                    	sub	al, 80h
  4467 00001F16 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4468 00001F1A 66AB                    	stosw		; interpolated sample 2 (L)
  4469 00001F1C 66AB                    	stosw		; interpolated sample 2 (R)
  4470 00001F1E 88D8                    	mov	al, bl
  4471 00001F20 00D0                    	add	al, dl	; [next_val]
  4472 00001F22 D0D8                    	rcr	al, 1
  4473 00001F24 2C80                    	sub	al, 80h
  4474 00001F26 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4475 00001F2A 66AB                    	stosw		; interpolated sample 3 (L)
  4476 00001F2C 66AB                    	stosw		; interpolated sample 3 (R)
  4477 00001F2E C3                      	retn
  4478                                  
  4479                                  interpolating_4_8bit_stereo:
  4480                                  	; 17/11/2023
  4481                                  	; al = [previous_val_l]
  4482                                  	; ah = [previous_val_r]
  4483                                  	; dl = [next_val_l]
  4484                                  	; dh = [next_val_r]	
  4485                                  	; original-interpolated-interpolated-interpolated
  4486 00001F2F 89C3                    	mov	ebx, eax
  4487 00001F31 2C80                    	sub	al, 80h
  4488 00001F33 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4489 00001F37 66AB                    	stosw		; original sample (L)
  4490 00001F39 88F8                    	mov	al, bh
  4491 00001F3B 2C80                    	sub	al, 80h
  4492 00001F3D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4493 00001F41 66AB                    	stosw		; original sample (R)
  4494 00001F43 88D8                    	mov	al, bl
  4495 00001F45 00D0                    	add	al, dl	; [next_val_l]
  4496 00001F47 D0D8                    	rcr	al, 1
  4497 00001F49 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4498 00001F4B 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4499 00001F4D D0D8                    	rcr	al, 1
  4500 00001F4F 2C80                    	sub	al, 80h
  4501 00001F51 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4502 00001F55 66AB                    	stosw		; interpolated sample 1 (L)
  4503 00001F57 88F8                    	mov	al, bh
  4504 00001F59 00F0                    	add	al, dh	; [next_val_r]
  4505 00001F5B D0D8                    	rcr	al, 1
  4506 00001F5D 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4507 00001F5F 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4508 00001F61 D0D8                    	rcr	al, 1
  4509 00001F63 2C80                    	sub	al, 80h
  4510 00001F65 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4511 00001F69 66AB                    	stosw		; interpolated sample 1 (R)
  4512 00001F6B 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4513 00001F6D 2C80                    	sub	al, 80h
  4514 00001F6F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4515 00001F73 66AB                    	stosw		; interpolated sample 2 (L)
  4516 00001F75 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4517 00001F77 2C80                    	sub	al, 80h
  4518 00001F79 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4519 00001F7D 66AB                    	stosw		; interpolated sample 2 (L)
  4520 00001F7F 88D8                    	mov	al, bl
  4521 00001F81 00D0                    	add	al, dl	; [next_val_l]
  4522 00001F83 D0D8                    	rcr	al, 1
  4523 00001F85 2C80                    	sub	al, 80h
  4524 00001F87 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4525 00001F8B 66AB                    	stosw		; interpolated sample 3 (L)
  4526 00001F8D 88F8                    	mov	al, bh
  4527 00001F8F 00F0                    	add	al, dh	; [next_val_r]
  4528 00001F91 D0D8                    	rcr	al, 1
  4529 00001F93 2C80                    	sub	al, 80h
  4530 00001F95 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4531 00001F99 66AB                    	stosw		; interpolated sample 3 (R)
  4532 00001F9B C3                      	retn
  4533                                  
  4534                                  interpolating_5_16bit_mono:
  4535                                  	; 18/11/2023
  4536                                  	; ax = [previous_val]
  4537                                  	; dx = [next_val]
  4538                                  	; original-interpltd-interpltd-interpltd-interpltd
  4539 00001F9C 66AB                    	stosw		; original sample (L)
  4540 00001F9E 66AB                    	stosw		; original sample (R)
  4541 00001FA0 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4542 00001FA3 89C3                    	mov	ebx, eax ; [previous_val]
  4543 00001FA5 80C680                  	add	dh, 80h
  4544 00001FA8 6601D0                  	add	ax, dx
  4545 00001FAB 66D1D8                  	rcr	ax, 1
  4546 00001FAE 50                      	push	eax ; *	; interpolated middle (temporary)
  4547 00001FAF 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4548 00001FB2 66D1D8                  	rcr	ax, 1
  4549 00001FB5 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4550 00001FB6 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4551 00001FB9 66D1D8                  	rcr	ax, 1	
  4552 00001FBC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4553 00001FBF 66AB                    	stosw 		; interpolated sample 1 (L)
  4554 00001FC1 66AB                    	stosw		; interpolated sample 1 (R)
  4555 00001FC3 58                      	pop	eax ; **
  4556 00001FC4 5B                      	pop	ebx ; *
  4557 00001FC5 6601D8                  	add	ax, bx	; 1st quarter + middle
  4558 00001FC8 66D1D8                  	rcr	ax, 1	; / 2
  4559 00001FCB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4560 00001FCE 66AB                    	stosw		; interpolated sample 2 (L)
  4561 00001FD0 66AB                    	stosw		; interpolated sample 2 (R)
  4562 00001FD2 89D8                    	mov	eax, ebx
  4563 00001FD4 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4564 00001FD7 66D1D8                  	rcr	ax, 1
  4565 00001FDA 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4566 00001FDB 6601D8                  	add	ax, bx	; + interpolated middle
  4567 00001FDE 66D1D8                  	rcr	ax, 1
  4568 00001FE1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4569 00001FE4 66AB                    	stosw		; interpolated sample 3 (L)
  4570 00001FE6 66AB                    	stosw		; interpolated sample 3 (R)
  4571 00001FE8 58                      	pop	eax ; *	
  4572 00001FE9 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4573 00001FEC 66D1D8                  	rcr	ax, 1	; / 2
  4574 00001FEF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4575 00001FF2 66AB                    	stosw		; interpolated sample 4 (L)
  4576 00001FF4 66AB                    	stosw		; interpolated sample 4 (R)
  4577 00001FF6 C3                      	retn
  4578                                  
  4579                                  interpolating_5_16bit_stereo:
  4580                                  	; 18/11/2023
  4581                                  	; bx = [previous_val_l]
  4582                                  	; ax = [previous_val_r]
  4583                                  	; [next_val_l]
  4584                                  	; [next_val_r]
  4585                                  	; original-interpltd-interpltd-interpltd-interpltd
  4586 00001FF7 51                      	push	ecx ; !
  4587 00001FF8 93                      	xchg	eax, ebx
  4588 00001FF9 66AB                    	stosw		; original sample (L)
  4589 00001FFB 93                      	xchg	eax, ebx
  4590 00001FFC 66AB                    	stosw		; original sample (R)
  4591 00001FFE 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4592 00002001 50                      	push	eax ; *	; [previous_val_r]
  4593 00002002 80C780                  	add	bh, 80h
  4594 00002005 8005[81210000]80        	add	byte [next_val_l+1], 80h
  4595 0000200C 66A1[80210000]          	mov	ax, [next_val_l]
  4596 00002012 6601D8                  	add	ax, bx	; [previous_val_l]
  4597 00002015 66D1D8                  	rcr	ax, 1
  4598 00002018 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4599 0000201A 6601D8                  	add	ax, bx	
  4600 0000201D 66D1D8                  	rcr	ax, 1
  4601 00002020 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4602 00002022 6601D8                  	add	ax, bx	; [previous_val_l]
  4603 00002025 66D1D8                  	rcr	ax, 1
  4604 00002028 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4605 0000202B 66AB                    	stosw 		; interpolated sample 1 (L)
  4606 0000202D 89C8                    	mov	eax, ecx
  4607 0000202F 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4608 00002032 66D1D8                  	rcr	ax, 1	; / 2
  4609 00002035 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4610 00002037 5A                      	pop	edx ; *	; [previous_val_r]
  4611 00002038 89D0                    	mov	eax, edx
  4612 0000203A 8005[83210000]80        	add	byte [next_val_r+1], 80h
  4613 00002041 660305[82210000]        	add	ax, [next_val_r]
  4614 00002048 66D1D8                  	rcr	ax, 1
  4615 0000204B 50                      	push	eax ; *	; interpolated middle (R)
  4616 0000204C 6601D0                  	add	ax, dx
  4617 0000204F 66D1D8                  	rcr	ax, 1
  4618 00002052 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4619 00002053 6601D0                  	add	ax, dx	; [previous_val_r]
  4620 00002056 66D1D8                  	rcr	ax, 1
  4621 00002059 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4622 0000205C 66AB                    	stosw 		; interpolated sample 1 (R)
  4623 0000205E 89D8                    	mov	eax, ebx
  4624 00002060 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4625 00002063 66AB                    	stosw 		; interpolated sample 2 (L)
  4626 00002065 58                      	pop	eax ; **
  4627 00002066 5A                      	pop	edx ; *
  4628 00002067 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4629 0000206A 66D1D8                  	rcr	ax, 1	; / 2
  4630 0000206D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4631 00002070 66AB                    	stosw 		; interpolated sample 2 (R)
  4632 00002072 89C8                    	mov	eax, ecx
  4633 00002074 660305[80210000]        	add	ax, [next_val_l]
  4634 0000207B 66D1D8                  	rcr	ax, 1
  4635 0000207E 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4636 0000207F 6601C8                  	add	ax, cx	; interpolated middle (L)
  4637 00002082 66D1D8                  	rcr	ax, 1
  4638 00002085 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4639 00002088 66AB                    	stosw 		; interpolated sample 3 (L)
  4640 0000208A 89D0                    	mov	eax, edx
  4641 0000208C 660305[82210000]        	add	ax, [next_val_r]
  4642 00002093 66D1D8                  	rcr	ax, 1
  4643 00002096 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4644 00002097 6601D0                  	add	ax, dx	; interpolated middle (R)
  4645 0000209A 66D1D8                  	rcr	ax, 1
  4646 0000209D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4647 000020A0 66AB                    	stosw 		; interpolated sample 3 (R)
  4648 000020A2 5B                      	pop	ebx ; **
  4649 000020A3 58                      	pop	eax ; *
  4650 000020A4 660305[80210000]        	add	ax, [next_val_l]
  4651 000020AB 66D1D8                  	rcr	ax, 1
  4652 000020AE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4653 000020B1 66AB                    	stosw 		; interpolated sample 4 (L)
  4654 000020B3 89D8                    	mov	eax, ebx
  4655 000020B5 660305[82210000]        	add	ax, [next_val_r]
  4656 000020BC 66D1D8                  	rcr	ax, 1
  4657 000020BF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4658 000020C2 66AB                    	stosw 		; interpolated sample 4 (R)
  4659 000020C4 59                      	pop	ecx ; !
  4660 000020C5 C3                      	retn
  4661                                  
  4662                                  interpolating_4_16bit_mono:
  4663                                  	; 18/11/2023
  4664                                  	; ax = [previous_val]
  4665                                  	; dx = [next_val]
  4666                                  	; original-interpolated
  4667                                  
  4668 000020C6 66AB                    	stosw		; original sample (L)
  4669 000020C8 66AB                    	stosw		; original sample (R)
  4670 000020CA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4671 000020CD 89C3                    	mov	ebx, eax ; [previous_val]
  4672 000020CF 80C680                  	add	dh, 80h
  4673 000020D2 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4674 000020D5 66D1D8                  	rcr	ax, 1
  4675 000020D8 93                      	xchg	eax, ebx
  4676 000020D9 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4677 000020DC 66D1D8                  	rcr	ax, 1
  4678 000020DF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4679 000020E2 66AB                    	stosw 		; interpolated sample 1 (L)
  4680 000020E4 66AB                    	stosw		; interpolated sample 1 (R)
  4681 000020E6 89D8                    	mov	eax, ebx ; interpolated middle
  4682 000020E8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4683 000020EB 66AB                    	stosw 		; interpolated sample 2 (L)
  4684 000020ED 66AB                    	stosw		; interpolated sample 2 (R)
  4685 000020EF 89D8                    	mov	eax, ebx
  4686 000020F1 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4687 000020F4 66D1D8                  	rcr	ax, 1
  4688 000020F7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4689 000020FA 66AB                    	stosw		; interpolated sample 3 (L)
  4690 000020FC 66AB                    	stosw		; interpolated sample 3 (R)
  4691 000020FE C3                      	retn
  4692                                  
  4693                                  interpolating_4_16bit_stereo:
  4694                                  	; 18/11/2023
  4695                                  	; bx = [previous_val_l]
  4696                                  	; ax = [previous_val_r]
  4697                                  	; [next_val_l]
  4698                                  	; [next_val_r]
  4699                                  	; original-interpolated-interpolated-interpolated
  4700 000020FF 93                      	xchg	eax, ebx
  4701 00002100 66AB                    	stosw		; original sample (L)
  4702 00002102 93                      	xchg	eax, ebx
  4703 00002103 66AB                    	stosw		; original sample (R)
  4704 00002105 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4705 00002108 89C2                    	mov	edx, eax ; [previous_val_r]
  4706 0000210A 80C780                  	add	bh, 80h
  4707 0000210D 8005[81210000]80        	add	byte [next_val_l+1], 80h
  4708 00002114 66A1[80210000]          	mov	ax, [next_val_l]
  4709 0000211A 6601D8                  	add	ax, bx	; [previous_val_l]
  4710 0000211D 66D1D8                  	rcr	ax, 1
  4711 00002120 93                      	xchg	eax, ebx
  4712 00002121 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4713 00002124 66D1D8                  	rcr	ax, 1
  4714 00002127 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4715 0000212A 66AB                    	stosw 		; interpolated sample 1 (L)
  4716 0000212C 8005[83210000]80        	add	byte [next_val_r+1], 80h
  4717 00002133 89D0                    	mov	eax, edx ; [previous_val_r]
  4718 00002135 660305[82210000]        	add	ax, [next_val_r]
  4719 0000213C 66D1D8                  	rcr	ax, 1
  4720 0000213F 92                      	xchg	eax, edx
  4721 00002140 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4722 00002143 66D1D8                  	rcr	ax, 1
  4723 00002146 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4724 00002149 66AB                    	stosw 		; interpolated sample 1 (R)
  4725 0000214B 89D8                    	mov	eax, ebx
  4726 0000214D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4727 00002150 66AB                    	stosw 		; interpolated sample 2 (L)
  4728 00002152 89D0                    	mov	eax, edx
  4729 00002154 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4730 00002157 66AB                    	stosw 		; interpolated sample 2 (R)
  4731 00002159 89D8                    	mov	eax, ebx
  4732 0000215B 660305[80210000]        	add	ax, [next_val_l]
  4733 00002162 66D1D8                  	rcr	ax, 1
  4734 00002165 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4735 00002168 66AB                    	stosw 		; interpolated sample 3 (L)
  4736 0000216A 89D0                    	mov	eax, edx
  4737 0000216C 660305[82210000]        	add	ax, [next_val_r]
  4738 00002173 66D1D8                  	rcr	ax, 1
  4739 00002176 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4740 00002179 66AB                    	stosw 		; interpolated sample 3 (R)
  4741 0000217B C3                      	retn
  4742                                  
  4743                                  ; 13/11/2023
  4744                                  previous_val:
  4745 0000217C 0000                    previous_val_l: dw 0
  4746 0000217E 0000                    previous_val_r: dw 0
  4747                                  next_val:
  4748 00002180 0000                    next_val_l: dw 0
  4749 00002182 0000                    next_val_r: dw 0
  4750                                  
  4751                                  ; 16/11/2023
  4752 00002184 00                      faz:	db 0
  4753                                  
  4754                                  ; --------------------------------------------------------
  4755                                  ; --------------------------------------------------------
  4756                                  
  4757                                  ; 07/12/2024
  4758                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  4759                                  ;		'sysaudio' system call (23/08/2024)
  4760                                  ; 18/11/2024
  4761                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  4762                                  
  4763                                  ac97_stop: 
  4764                                  	; 18/11/2024
  4765 00002185 C605[407D0000]02        	mov	byte [stopped], 2
  4766                                  	; 07/12/2024
  4767                                  	sys	_audio, 0700h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000218C BB00070000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002191 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002196 CD40                <1>  int 40h
  4768 00002198 C3                      	retn
  4769                                  
  4770                                  ac97_pause:
  4771                                  	; 18/11/2024
  4772 00002199 C605[407D0000]01        	mov	byte [stopped], 1 ; paused
  4773                                  	; 07/12/2024
  4774                                  	sys	_audio, 0500h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000021A0 BB00050000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000021A5 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000021AA CD40                <1>  int 40h
  4775 000021AC C3                      	retn
  4776                                  
  4777                                  ac97_play: ; continue to play (after pause)
  4778                                  	; 18/11/2024
  4779 000021AD C605[407D0000]00        	mov	byte [stopped], 0
  4780                                  	; 07/12/2024	
  4781                                  	sys	_audio, 0600h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000021B4 BB00060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000021B9 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000021BE CD40                <1>  int 40h
  4782 000021C0 C3                      	retn
  4783                                  	
  4784                                  ; --------------------------------------------------------
  4785                                  ; 14/11/2024 - Erdogan Tan
  4786                                  ; --------------------------------------------------------
  4787                                  
  4788                                  	; 07/12/2024
  4789                                  	; 01/12/2024 (32bit registers)
  4790                                  	; 29/11/2024
  4791                                  checkUpdateEvents:
  4792 000021C1 E8E6010000              	call	check4keyboardstop
  4793 000021C6 7279                    	jc	short c4ue_ok
  4794                                  
  4795                                  	; 18/11/2024
  4796 000021C8 50                      	push	eax ; *
  4797 000021C9 09C0                    	or	eax, eax
  4798 000021CB 0F84F2000000            	jz	c4ue_cpt
  4799                                  
  4800                                  	; 18/11/2024
  4801 000021D1 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  4802 000021D3 7543                    	jne	short c4ue_chk_s
  4803 000021D5 803D[407D0000]00        	cmp	byte [stopped], 0
  4804 000021DC 7714                    	ja	short c4ue_chk_ps
  4805                                  	; pause
  4806 000021DE E8B6FFFFFF              	call	ac97_pause
  4807                                  	; 21/11/2024
  4808 000021E3 A0[417D0000]            	mov	al, [tLO]
  4809 000021E8 A2[427D0000]            	mov	byte [tLP], al
  4810 000021ED E9D1000000              	jmp	c4ue_cpt
  4811                                  c4ue_chk_ps:
  4812 000021F2 803D[407D0000]01        	cmp	byte [stopped], 1
  4813 000021F9 770A                    	ja	short c4ue_replay
  4814                                  	; continue to play (after a pause)
  4815 000021FB E8ADFFFFFF              	call	ac97_play 
  4816 00002200 E9BE000000              	jmp	c4ue_cpt
  4817                                  c4ue_replay:
  4818                                  	; 19/11/2024
  4819 00002205 58                      	pop	eax ; *
  4820 00002206 58                      	pop	eax ; return address
  4821                                  	; 07/02/2024
  4822                                  	;mov	al, [volume]
  4823                                  	;call	SetmasterVolume
  4824 00002207 C605[407D0000]00        	mov	byte [stopped], 0
  4825 0000220E E8A7040000              	call	move_to_beginning
  4826                                  	;jmp	PlayWav
  4827                                  	; 07/12/2024
  4828 00002213 E9D7E3FFFF              	jmp	RePlayWav
  4829                                  
  4830                                  c4ue_chk_s:
  4831 00002218 3C53                    	cmp	al, 'S'	; stop
  4832 0000221A 7526                    	jne	short c4ue_chk_fb
  4833 0000221C 803D[407D0000]00        	cmp	byte [stopped], 0
  4834 00002223 0F879A000000            	ja	c4ue_cpt ; Already stopped/paused
  4835 00002229 E857FFFFFF              	call	ac97_stop
  4836                                  	; 19/11/2024
  4837 0000222E C605[417D0000]00        	mov	byte [tLO], 0
  4838                                  	; 21/11/2024
  4839 00002235 C605[427D0000]30        	mov	byte [tLP], '0'
  4840 0000223C E982000000              	jmp	c4ue_cpt
  4841                                  
  4842                                  	; 01/12/2024
  4843                                  	; 18/11/2024
  4844                                  c4ue_ok:
  4845 00002241 C3                      	retn
  4846                                  
  4847                                  c4ue_chk_fb:
  4848                                  	; 17/11/2024
  4849 00002242 3C46                    	cmp	al, 'F'
  4850 00002244 7507                    	jne	short c4ue_chk_b
  4851 00002246 E847040000              	call 	Player_ProcessKey_Forwards
  4852 0000224B EB76                    	jmp	short c4ue_cpt
  4853                                  
  4854                                  c4ue_chk_b:
  4855 0000224D 3C42                    	cmp	al, 'B'
  4856                                  	;;jne	short c4ue_cpt
  4857                                  	; 19/11/2024
  4858 0000224F 7507                    	jne	short c4ue_chk_h
  4859 00002251 E838040000              	call 	Player_ProcessKey_Backwards
  4860 00002256 EB6B                    	jmp	short c4ue_cpt
  4861                                  
  4862                                  c4ue_chk_h:
  4863                                  	; 19/11/2024
  4864 00002258 3C48                    	cmp	al, 'H'
  4865 0000225A 7515                    	jne	short c4ue_chk_cr
  4866 0000225C C605[437D0000]00        	mov	byte [wleds], 0
  4867 00002263 E887E6FFFF              	call 	write_ac97_pci_dev_info
  4868                                  	;;;
  4869                                  	;24/12/2024 (wave lighting points option)
  4870 00002268 C605[4F7D0000]01        	mov	byte [p_mode], 1
  4871                                  	;;;
  4872                                  	;mov	dh, 24
  4873                                  	;mov	dl, 79
  4874                                  	;call	setCursorPosition
  4875                                  	; 21/12/2024
  4876 0000226F EB52                    	jmp	short c4ue_cpt
  4877                                  c4ue_chk_cr:
  4878                                  	;;;
  4879                                  	; 24/12/2024 (wave lighting points option)
  4880 00002271 8A25[437D0000]          	mov	ah, [wleds]
  4881 00002277 3C47                    	cmp	al, 'G'
  4882 00002279 7432                    	je	short c4ue_g
  4883                                  	;;;
  4884                                  	; 19/11/2024
  4885 0000227B 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  4886 0000227D 7544                    	jne	short c4ue_cpt
  4887                                  	;inc	byte [wleds]
  4888                                  	;jnz	short c4ue_cpt
  4889                                  	;inc	byte [wleds]
  4890                                  	;;;
  4891                                  	; 24/12/2024
  4892                                  	; 22/12/2024 (faster method)
  4893                                  	; (UpdateWaveLeds procedure turns off previously
  4894                                  	;  lighting wave leds only)
  4895                                  	;call	reset_wave_leds ; prepare all leds as turned off
  4896                                  	;;;
  4897                                  	; 23/11/2024
  4898 0000227F 31DB                    	xor	ebx, ebx
  4899                                  	; 24/12/2024 (wave lighting points option)
  4900 00002281 881D[4F7D0000]          	mov	[p_mode], bl ; 0
  4901                                  	;
  4902                                  	;mov	bl, [wleds]
  4903 00002287 88E3                    	mov	bl, ah ; 24/12/2024
  4904 00002289 FEC3                    	inc	bl
  4905 0000228B 80E30F                  	and	bl, 0Fh
  4906 0000228E 7501                    	jnz	short c4ue_sc
  4907 00002290 43                      	inc	ebx
  4908                                  c4ue_sc:
  4909 00002291 881D[437D0000]          	mov	[wleds], bl
  4910 00002297 D0EB                    	shr	bl, 1
  4911 00002299 8A83[DD3F0000]          	mov	al, [ebx+colors]
  4912                                  	; 24/12/2024
  4913 0000229F A2[E53F0000]            	mov	[ccolor], al
  4914 000022A4 7211                    	jc	short c4ue_g_@
  4915                                  	; 24/12/2024
  4916 000022A6 E859040000              	call	reset_wave_leds ; prepare all leds as turned off
  4917 000022AB EB16                    	jmp	short c4ue_cpt
  4918                                  	; 24/12/2024
  4919                                  c4ue_g:
  4920 000022AD 08E4                    	or	ah, ah	; byte [wleds]
  4921 000022AF 7506                    	jnz	short c4ue_g_@
  4922 000022B1 FE05[437D0000]          	inc	byte [wleds]	; force wave lighting ('G' key)
  4923                                  c4ue_g_@:
  4924                                  	; 24/12/2024 (wave lighting points option)
  4925 000022B7 C605[4F7D0000]01        	mov	byte [p_mode], 1
  4926 000022BE E826040000              	call	clear_window
  4927                                  	;;;
  4928                                  c4ue_cpt:
  4929                                  	; 24/12/2024
  4930                                  	; 18/11/2024
  4931 000022C3 59                      	pop	ecx ; *
  4932                                  	;;;
  4933                                  	; 24/12/2024 (skip wave lighting if data is not loaded yet)
  4934 000022C4 803D[D77D0000]00        	cmp	byte [SRB], 0
  4935 000022CB 7751                    	ja	short c4ue_vb_ok
  4936                                  	;;;
  4937                                  	; 01/12/2024 (TRDOS 386)
  4938                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second),
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000022CD BB04000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000022D2 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 000022D7 CD40                <1>  int 40h
  4939                                  	; 24/12/2024
  4940                                  	; 18/11/2024
  4941                                  	;pop	ecx ; *
  4942                                  	; 01/12/2024
  4943 000022D9 3B05[007E0000]          	cmp	eax, [timerticks]
  4944                                  	;je	short c4ue_ok
  4945                                  	; 18/11/2024
  4946 000022DF 7407                    	je	short c4ue_skip_utt
  4947                                  c4ue_utt:	
  4948                                  	; 01/12/2024
  4949 000022E1 A3[007E0000]            	mov	[timerticks], eax
  4950 000022E6 EB04                    	jmp	short c4ue_cpt_@
  4951                                  c4ue_skip_utt:
  4952                                  	; 18/11/2024
  4953 000022E8 21C9                    	and	ecx, ecx
  4954 000022EA 7432                    	jz	short c4ue_vb_ok
  4955                                  c4ue_cpt_@:
  4956                                  	; 18/11/2024
  4957 000022EC 803D[407D0000]00        	cmp	byte [stopped], 0
  4958 000022F3 7729                    	ja	short c4ue_vb_ok
  4959                                  	
  4960 000022F5 E8D7010000              	call	CalcProgressTime
  4961                                  
  4962                                  	;cmp	ax, [ProgressTime]
  4963                                  	; 01/12/2024
  4964 000022FA 3B05[F47D0000]          	cmp	eax, [ProgressTime]
  4965                                  	;je	short c4ue_vb_ok
  4966                                  			; same second, no need to update
  4967                                  	; 23/11/2024
  4968 00002300 7405                    	je	short c4ue_uvb
  4969                                  
  4970                                  	;call	UpdateProgressTime
  4971                                  	;call	UpdateProgressBar@
  4972 00002302 E8FB020000              	call	UpdateProgressBar
  4973                                  
  4974                                  	; 23/11/2024
  4975                                  c4ue_uvb:
  4976 00002307 803D[437D0000]00        	cmp	byte [wleds], 0
  4977 0000230E 760E                    	jna	short c4ue_vb_ok
  4978                                  
  4979                                  	; 24/12/2024 (wave points mode)
  4980 00002310 803D[4F7D0000]00        	cmp	byte [p_mode], 0
  4981 00002317 7706                    	ja	short c4ue_uwp
  4982                                  
  4983 00002319 E830040000              	call	UpdateWaveLeds
  4984                                  
  4985                                  c4ue_vb_ok:
  4986 0000231E C3                      	retn
  4987                                  
  4988                                  	; 22/12/2024
  4989                                  c4ue_uwp:
  4990                                  	;call	UpdateWavePoints
  4991                                  	;retn
  4992                                  
  4993                                  ; --------------------------------------------------------
  4994                                  ; 24/12/2024 - Erdogan Tan
  4995                                  ; --------------------------------------------------------
  4996                                  
  4997                                  	; 24/12/2024
  4998                                  UpdateWavePoints:
  4999 0000231F BE[40730000]            	mov	esi, prev_points
  5000 00002324 833E00                  	cmp	dword [esi], 0
  5001 00002327 740B                    	jz	short lights_off_ok
  5002 00002329 B980020000              	mov	ecx, 640
  5003                                  light_off:
  5004 0000232E AD                      	lodsd
  5005                                  	; eax = wave point (lighting point) address
  5006 0000232F C60000                  	mov	byte [eax], 0 ; black point (light off)
  5007 00002332 E2FA                    	loop	light_off	
  5008                                  lights_off_ok:
  5009 00002334 8A15[4D7D0000]          	mov	dl, [half_buffer]
  5010 0000233A 3815[4C7D0000]          	cmp	[pbuf_s], dl
  5011 00002340 7520                    	jne	short lights_on_2
  5012 00002342 8B1D[28730000]          	mov	ebx, [wpoints_dif]
  5013 00002348 8B35[487D0000]          	mov	esi, [pbuf_o]
  5014 0000234E 8B0D[EC7D0000]          	mov	ecx, [buffersize] ; bytes
  5015 00002354 29D9                    	sub	ecx, ebx ; sub ecx, [wpoints_dif]
  5016 00002356 01DE                    	add	esi, ebx
  5017 00002358 7204                    	jc	short lights_on_1
  5018 0000235A 39CE                    	cmp	esi, ecx
  5019 0000235C 760C                    	jna	short lights_on_3
  5020                                  lights_on_1:
  5021 0000235E 89CE                    	mov	esi, ecx
  5022 00002360 EB08                    	jmp	short lights_on_3
  5023                                  
  5024                                  lights_on_2:
  5025 00002362 8815[4C7D0000]          	mov	[pbuf_s], dl
  5026 00002368 31F6                    	xor	esi, esi ; 0
  5027                                  lights_on_3:
  5028 0000236A 8935[487D0000]          	mov	[pbuf_o], esi
  5029                                  	;
  5030 00002370 81C6[00800000]          	add	esi, audio_buffer
  5031 00002376 B980020000              	mov	ecx, 640
  5032 0000237B 89CD                    	mov	ebp, ecx
  5033                                  	; 26/12/2024
  5034                                  	;mov	bl, [ccolor]
  5035 0000237D BF[40730000]            	mov	edi, prev_points
  5036 00002382 8B1D[2C730000]          	mov	ebx, [graphstart] ; start (top) line
  5037                                  lights_on_4:
  5038 00002388 31C0                    	xor	eax, eax ; 0
  5039 0000238A 66AD                    	lodsw	; left
  5040 0000238C 80C480                  	add	ah, 80h
  5041 0000238F 89C2                    	mov	edx, eax
  5042 00002391 66AD                    	lodsw	; right
  5043                                  	;add	ax, dx
  5044 00002393 80C480                  	add	ah, 80h
  5045                                  	;shr	eax, 9	; 128 volume levels
  5046 00002396 01D0                    	add	eax, edx
  5047                                  	;shr	eax, 10	; (L+R/2) & 128 volume levels
  5048 00002398 C1E809                  	shr	eax, 9	; (L+R/2) & 256 volume levels
  5049 0000239B F7E5                    	mul	ebp	; * 640 (row)
  5050 0000239D 01D8                    	add	eax, ebx ; + column
  5051 0000239F 8A15[E53F0000]          	mov	dl, [ccolor]
  5052 000023A5 8810                    	mov	[eax], dl ; pixel (light on) color
  5053 000023A7 AB                      	stosd		; save light on addr in prev_points
  5054 000023A8 43                      	inc	ebx
  5055 000023A9 E2DD                    	loop	lights_on_4
  5056 000023AB C3                      	retn
  5057                                  
  5058                                  ; --------------------------------------------------------
  5059                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  5060                                  ; --------------------------------------------------------
  5061                                  
  5062                                  	; 07/12/2024
  5063                                  	; 01/12/2024 (TRDOS 386)
  5064                                  	; 29/11/2024
  5065                                  check4keyboardstop:
  5066                                  	; 19/05/2024
  5067                                  	; 08/11/2023
  5068                                  	; 04/11/2023
  5069 000023AC B401                    	mov	ah, 1
  5070                                  	;int	16h
  5071                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5072 000023AE CD32                    	int	32h
  5073                                  	;clc
  5074 000023B0 7433                    	jz	short _cksr
  5075                                  
  5076 000023B2 30E4                    	xor	ah, ah
  5077                                  	;int	16h
  5078                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5079 000023B4 CD32                    	int	32h
  5080                                  
  5081                                  	;;;
  5082                                  	; 19/05/2024 (change PCM out volume)
  5083 000023B6 3C2B                    	cmp	al, '+'
  5084 000023B8 750D                    	jne	short p_1
  5085                                  	
  5086 000023BA A0[03240000]            	mov	al, [volume]
  5087 000023BF 3C00                    	cmp	al, 0
  5088 000023C1 7624                    	jna	short p_3
  5089 000023C3 FEC8                    	dec	al
  5090 000023C5 EB0F                    	jmp	short p_2
  5091                                  p_1:
  5092 000023C7 3C2D                    	cmp	al, '-'
  5093 000023C9 751D                    	jne	short p_4
  5094                                  
  5095 000023CB A0[03240000]            	mov	al, [volume]
  5096 000023D0 3C1F                    	cmp	al, 31
  5097 000023D2 7313                    	jnb	short p_3
  5098 000023D4 FEC0                    	inc	al
  5099                                  p_2:
  5100 000023D6 A2[03240000]            	mov	[volume], al
  5101                                  	; 14/11/2024
  5102                                  	;call	SetPCMOutVolume
  5103                                  	; 15/11/2024 (QEMU)
  5104                                  	; 07/12/2024
  5105 000023DB E83FE3FFFF              	call	SetMasterVolume
  5106                                  	;call	UpdateVolume
  5107                                  	;;clc
  5108                                  	;retn
  5109 000023E0 E98D010000              	jmp	UpdateVolume
  5110                                  	;mov	ah, al
  5111                                  	;mov    dx, [NAMBAR]
  5112                                    	;;add   dx, CODEC_MASTER_VOL_REG
  5113                                  	;add	dx, CODEC_PCM_OUT_REG
  5114                                  	;out    dx, ax
  5115                                  	;
  5116                                  	;call   delay1_4ms
  5117                                          ;call   delay1_4ms
  5118                                          ;call   delay1_4ms
  5119                                          ;call   delay1_4ms
  5120                                  _cksr:		; 19/05/2024
  5121                                  	; 18/12/2024
  5122 000023E5 31C0                    	xor	eax, eax
  5123                                  	;clc
  5124                                  p_3:
  5125 000023E7 C3                      	retn
  5126                                  p_4:
  5127                                  	; 17/11/2024
  5128 000023E8 80FC01                  	cmp	ah, 01h  ; ESC
  5129 000023EB 7414                        	je	short p_q
  5130                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5131 000023ED 3C03                    	cmp	al, 03h  ; CTRL+C
  5132 000023EF 7410                    	je	short p_q
  5133                                  
  5134                                  	; 18/11/2024
  5135 000023F1 3C20                    	cmp	al, 20h
  5136 000023F3 740D                    	je	short p_r
  5137                                  
  5138                                  	; 19/11/2024
  5139 000023F5 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5140 000023F7 7409                    	je	short p_r
  5141                                  
  5142 000023F9 24DF                    	and	al, 0DFh
  5143                                  
  5144                                  	;cmp	al, 'B'
  5145                                  	;je	short p_r
  5146                                  	;cmp	al, 'F'
  5147                                  	;je	short p_r
  5148                                  
  5149 000023FB 3C51                    	cmp	al, 'Q'
  5150                                  	;je	short p_q
  5151 000023FD 7402                    	je	short p_quit ; 29/11/2024
  5152                                  
  5153 000023FF F8                      	clc
  5154 00002400 C3                      	retn
  5155                                  
  5156                                  	;;;
  5157                                  ;_cskr:	
  5158                                  p_q:
  5159                                  p_quit:
  5160 00002401 F9                      	stc
  5161                                  p_r:
  5162 00002402 C3                      	retn
  5163                                  
  5164                                  ; 29/05/2024
  5165                                  ; 19/05/2024
  5166 00002403 02                      volume: db	02h
  5167                                  
  5168                                  ; --------------------------------------------------------
  5169                                  
  5170                                  	; 22/12/2024
  5171                                  	; 21/12/2024
  5172                                  	; simulate cursor position in VGA (VESA VBE) mode
  5173                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5174                                  setCursorPosition:
  5175                                  	; dh = Row
  5176                                  	; dl = Column
  5177                                  	
  5178 00002404 31C0                    	xor	eax, eax
  5179 00002406 B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5180 00002408 F6E6                    	mul	dh
  5181 0000240A 6683C007                	add	ax, 7	; top margin
  5182 0000240E C1E010                  	shl	eax, 16
  5183 00002411 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5184 00002413 66C1E003                	shl	ax, 3
  5185                                  			; hw = row, ax = column
  5186 00002417 A3[34730000]            	mov	[screenpos], eax
  5187                                  	; 22/12/2024
  5188 0000241C 31C0                    	xor	eax, eax
  5189 0000241E C3                      	retn
  5190                                  	
  5191                                  ; --------------------------------------------------------
  5192                                  ; 14/11/2024
  5193                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5194                                  
  5195                                  ;; NAME:	SetTotalTime
  5196                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5197                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5198                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5199                                  ;; 		Output on the screen of the total time in seconds
  5200                                  
  5201                                  	; 01/12/2024 (32 bit registers)
  5202                                  SetTotalTime:
  5203                                  	;; Calculate total seconds in file
  5204                                  	;mov	ax, [DATA_SubchunkSize]
  5205                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5206                                  	;mov	bx, [WAVE_SampleRate]
  5207                                  	;div	bx
  5208                                  	;xor	dx, dx
  5209                                  	; 01/12/2024
  5210 0000241F A1[787D0000]            	mov	eax, [DATA_SubchunkSize]
  5211 00002424 0FB71D[687D0000]        	movzx	ebx, word [WAVE_SampleRate]
  5212 0000242B 31D2                    	xor	edx, edx
  5213 0000242D F7F3                    	div	ebx
  5214                                  
  5215                                  	;mov	bx, [WAVE_BlockAlign]
  5216                                  	;div	bx
  5217                                  	; 01/12/2024
  5218 0000242F 668B1D[707D0000]        	mov	bx, [WAVE_BlockAlign]
  5219 00002436 31D2                    	xor	edx, edx
  5220 00002438 F7F3                    	div	ebx
  5221                                  
  5222                                  	;mov	[TotalTime], ax
  5223 0000243A A3[F07D0000]            	mov	[TotalTime], eax
  5224                                  
  5225 0000243F B33C                    	mov	bl, 60
  5226 00002441 F6F3                    	div	bl
  5227                                  
  5228                                  	;; al = minutes, ah = seconds
  5229 00002443 50                      	push	eax ; **
  5230 00002444 50                      	push	eax ; *
  5231                                  
  5232                                  	;mov	dh, 24
  5233                                  	; 21/12/2024 (640*480)
  5234 00002445 B620                    	mov	dh, 32
  5235 00002447 B22A                    	mov	dl, 42
  5236 00002449 E8B6FFFFFF              	call	setCursorPosition
  5237                                  
  5238 0000244E 58                      	pop	eax ; *
  5239 0000244F 30E4                    	xor	ah, ah
  5240 00002451 BD02000000              	mov	ebp, 2
  5241 00002456 E812000000              	call	PrintNumber
  5242                                  	
  5243                                  	;mov	dh, 24
  5244                                  	; 21/12/2024 (640*480)
  5245 0000245B B620                    	mov	dh, 32
  5246 0000245D B22D                    	mov	dl, 45
  5247 0000245F E8A0FFFFFF              	call	setCursorPosition
  5248                                  
  5249 00002464 58                      	pop	eax ; **
  5250 00002465 88E0                    	mov	al, ah
  5251 00002467 30E4                    	xor	ah, ah
  5252                                  	; 21/12/2024
  5253 00002469 66BD0200                	mov	bp, 2
  5254                                  	;jmp	short PrintNumber
  5255                                  
  5256                                  ; --------------------------------------------------------
  5257                                  
  5258                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5259                                  	; 01/12/2024 (32bit registers)
  5260                                  PrintNumber:
  5261                                  	; eax = binary number
  5262                                  	; ebp = digits
  5263 0000246D 8B35[34730000]          	mov	esi, [screenpos]
  5264                                  		; hw = row, si = column
  5265 00002473 BB0A000000              	mov	ebx, 10
  5266 00002478 31C9                    	xor	ecx, ecx
  5267                                  printNumber_CutNumber:
  5268 0000247A 41                      	inc	ecx
  5269 0000247B 31D2                    	xor	edx, edx
  5270 0000247D F7F3                    	div	ebx
  5271 0000247F 52                      	push	edx
  5272 00002480 39E9                    	cmp	ecx, ebp
  5273 00002482 7402                    	je	short printNumber_printloop
  5274 00002484 EBF4                    	jmp	printNumber_CutNumber
  5275                                  
  5276                                  printNumber_printloop:
  5277 00002486 58                      	pop	eax
  5278                                  	; 21/12/2024
  5279                                  	; ebp = count of digits
  5280                                  	; eax <= 9
  5281                                  
  5282 00002487 0430                    	add	al, '0'
  5283                                  	
  5284                                  	; esi = pixel position (hw = row, si = column)
  5285                                  	; eax = al = character
  5286                                  	;call	write_character
  5287                                  	; 22/12/2024
  5288 00002489 E82A010000              	call	write_character_white
  5289                                  
  5290 0000248E 4D                      	dec	ebp
  5291 0000248F 7405                     	jz	short printNumber_ok
  5292 00002491 83C608                  	add	esi, 8	; next column
  5293 00002494 EBF0                    	jmp	short printNumber_printloop
  5294                                  printNumber_ok:
  5295 00002496 C3                      	retn
  5296                                  
  5297                                  ; --------------------------------------------------------
  5298                                  
  5299                                  	; 14/11/2024 - Erdogan Tan
  5300                                  SetProgressTime:
  5301                                  	;; Calculate playing/progress seconds in file
  5302 00002497 E835000000              	call	CalcProgressTime
  5303                                  
  5304                                  	; 01/12/2024 (32bit registers)
  5305                                  UpdateProgressTime:
  5306                                  	; eax = (new) progress time 
  5307                                  
  5308 0000249C A3[F47D0000]            	mov	[ProgressTime], eax
  5309                                  
  5310 000024A1 B33C                    	mov	bl, 60
  5311 000024A3 F6F3                    	div	bl
  5312                                  
  5313                                  	;; al = minutes, ah = seconds
  5314 000024A5 50                      	push	eax ; **
  5315 000024A6 50                      	push	eax ; *
  5316                                  
  5317                                  	;mov	dh, 24
  5318                                  	; 21/12/2024 (640*480)
  5319 000024A7 B620                    	mov	dh, 32
  5320 000024A9 B221                    	mov	dl, 33
  5321 000024AB E854FFFFFF              	call	setCursorPosition
  5322                                  
  5323 000024B0 58                      	pop	eax ; *
  5324 000024B1 30E4                    	xor	ah, ah
  5325 000024B3 BD02000000              	mov	ebp, 2
  5326 000024B8 E8B0FFFFFF              	call	PrintNumber
  5327                                  	
  5328                                  	;mov	dh, 24
  5329                                  	; 21/12/2024 (640*480)
  5330 000024BD B620                    	mov	dh, 32
  5331 000024BF B224                    	mov	dl, 36
  5332 000024C1 E83EFFFFFF              	call	setCursorPosition
  5333                                  
  5334 000024C6 58                      	pop	eax ; **
  5335 000024C7 88E0                    	mov	al, ah
  5336 000024C9 30E4                    	xor	ah, ah
  5337                                  	; 21/12/2024
  5338 000024CB 66BD0200                	mov	bp, 2
  5339 000024CF EB9C                    	jmp	short PrintNumber
  5340                                  
  5341                                  ; --------------------------------------------------------
  5342                                  
  5343                                  	; 01/12/2024 (32bit registers)
  5344                                  	; 17/11/2024
  5345                                  	; 14/11/2024
  5346                                  CalcProgressTime:
  5347                                  	;mov	ax, [LoadedDataBytes]
  5348                                  	;mov	dx, [LoadedDataBytes+2]
  5349                                  	;mov	bx, ax
  5350                                  	;or	bx, dx
  5351                                  	;jz	short cpt_ok
  5352                                  	; 01/12/2024
  5353 000024D1 A1[FC7D0000]            	mov	eax, [LoadedDataBytes]
  5354 000024D6 09C0                    	or	eax, eax
  5355 000024D8 7416                    	jz	short cpt_ok
  5356                                  
  5357                                  	;mov	bx, [WAVE_SampleRate]
  5358                                  	;div	bx
  5359                                  	;xor	dx, dx
  5360                                  	;mov	bx, [WAVE_BlockAlign]
  5361                                  	;div	bx
  5362                                  	; 01/12/2024
  5363 000024DA 0FB71D[687D0000]        	movzx	ebx, word [WAVE_SampleRate]
  5364 000024E1 31D2                    	xor	edx, edx
  5365 000024E3 F7F3                    	div	ebx
  5366 000024E5 31D2                    	xor	edx, edx
  5367 000024E7 668B1D[707D0000]        	mov	bx, [WAVE_BlockAlign]
  5368 000024EE F7F3                    	div	ebx
  5369                                  cpt_ok:
  5370                                  	; eax = (new) progress time
  5371 000024F0 C3                      	retn
  5372                                  
  5373                                  ; --------------------------------------------------------
  5374                                  ; 14/11/2024
  5375                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5376                                  
  5377                                  ;; DESCRIPTION: Update file information on template
  5378                                  ;; PARAMS:	WAVE parameters and other variables
  5379                                  ;; REGS:	AX(RW)
  5380                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5381                                  ;; RETURNS:	On-screen file info is updated.
  5382                                  
  5383                                  	; 01/12/2024 (32bit registers)
  5384                                  UpdateFileInfo:
  5385                                  	;; Print File Name
  5386                                  	;mov	dh, 9
  5387                                  	; 21/12/2024 (640*480 graphics display)
  5388 000024F1 B608                    	mov	dh, 8
  5389 000024F3 B217                    	mov	dl, 23
  5390 000024F5 E80AFFFFFF              	call	setCursorPosition
  5391                                  	
  5392 000024FA BE[847D0000]            	mov	esi, wav_file_name
  5393                                  	
  5394                                  	;;;
  5395                                  	; 14/11/2024
  5396                                  	; skip directory separators
  5397                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5398 000024FF 89F3                    	mov	ebx, esi
  5399                                  chk4_nxt_sep:
  5400 00002501 AC                      	lodsb
  5401 00002502 3C2F                    	cmp	al, '/'	; 14/12/2024
  5402 00002504 7406                    	je	short chg_fpos
  5403 00002506 20C0                    	and	al, al
  5404 00002508 7406                    	jz	short chg_fpos_ok
  5405 0000250A EBF5                    	jmp	short chk4_nxt_sep
  5406                                  chg_fpos:
  5407 0000250C 89F3                    	mov	ebx, esi
  5408 0000250E EBF1                    	jmp	short chk4_nxt_sep
  5409                                  chg_fpos_ok:
  5410 00002510 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5411                                  
  5412                                  	;;;
  5413                                  _fnl_chk:
  5414                                  	; 26/12/2024 (file name length limit -display-)
  5415                                  	;mov	ebx, 12
  5416 00002512 BB11000000              	mov	ebx, 17 ; ????????.wav?????
  5417 00002517 56                      	push	esi
  5418                                  _fnl_chk_loop:
  5419 00002518 AC                      	lodsb
  5420 00002519 20C0                    	and	al, al
  5421 0000251B 7406                    	jz	short _fnl_ok
  5422 0000251D 4B                       	dec	ebx
  5423 0000251E 75F8                    	jnz	short _fnl_chk_loop
  5424 00002520 C60600                  	mov	byte [esi], 0
  5425                                  _fnl_ok:
  5426 00002523 5E                      	pop	esi
  5427                                  	;;;
  5428                                  
  5429 00002524 E870000000              	call	PrintString
  5430                                  	
  5431                                  	;; Print Frequency
  5432                                  	;mov	dh, 10
  5433                                  	; 21/12/2024 (640*480 graphics display)
  5434 00002529 B609                    	mov	dh, 9
  5435 0000252B B217                    	mov	dl, 23
  5436 0000252D E8D2FEFFFF              	call	setCursorPosition
  5437                                  	;movzx	eax, word [WAVE_SampleRate]
  5438                                  	; 22/12/2024
  5439                                  	; eax = 0
  5440 00002532 66A1[687D0000]          	mov	ax, [WAVE_SampleRate]
  5441 00002538 BD05000000              	mov	ebp, 5
  5442 0000253D E82BFFFFFF              	call	PrintNumber
  5443                                  
  5444                                  	;; Print BitRate
  5445                                  	;mov	dh, 9
  5446                                  	; 21/12/2024 (640*480 graphics display)
  5447 00002542 B608                    	mov	dh, 8
  5448 00002544 B239                    	mov	dl, 57
  5449 00002546 E8B9FEFFFF              	call	setCursorPosition
  5450 0000254B 66A1[727D0000]          	mov	ax, [WAVE_BitsPerSample]
  5451 00002551 66BD0200                	mov	bp, 2
  5452 00002555 E813FFFFFF              	call	PrintNumber
  5453                                  
  5454                                  	;; Print Channel Number
  5455                                  	;mov	dh, 10
  5456                                  	; 21/12/2024 (640*480 graphics display)
  5457 0000255A B609                    	mov	dh, 9
  5458 0000255C B239                    	mov	dl, 57
  5459 0000255E E8A1FEFFFF              	call	setCursorPosition
  5460 00002563 66A1[667D0000]          	mov	ax, [WAVE_NumChannels]
  5461 00002569 66BD0100                	mov	bp, 1
  5462 0000256D E8FBFEFFFF              	call	PrintNumber
  5463                                  
  5464                                  	;call	UpdateVolume
  5465                                  	;retn
  5466                                  
  5467                                  ; --------------------------------------------------------
  5468                                  
  5469                                  	; 14/11/2024
  5470                                  UpdateVolume:
  5471                                  	;; Print Volume
  5472                                  	;mov	dh, 24
  5473                                  	; 21/12/2024 (640*480)
  5474 00002572 B620                    	mov	dh, 32
  5475 00002574 B24B                    	mov	dl, 75
  5476 00002576 E889FEFFFF              	call	setCursorPosition
  5477                                  	; 22/12/2024
  5478                                  	; eax = 0
  5479                                  
  5480 0000257B A0[03240000]            	mov	al, [volume]
  5481                                  
  5482 00002580 B364                    	mov	bl, 100
  5483 00002582 F6E3                    	mul	bl
  5484                                  
  5485 00002584 B31F                    	mov	bl, 31
  5486 00002586 F6F3                    	div	bl
  5487                                  
  5488                                  	;neg	ax
  5489                                  	;add	ax, 100	
  5490                                  	; 01/12/2024
  5491 00002588 B464                    	mov	ah, 100
  5492 0000258A 28C4                    	sub	ah, al
  5493 0000258C 0FB6C4                  	movzx	eax, ah
  5494                                  	;xor	ah, ah
  5495                                  	;mov	bp, 3
  5496 0000258F BD03000000              	mov	ebp, 3
  5497                                  	;call	PrintNumber
  5498                                  	;retn
  5499 00002594 E9D4FEFFFF              	jmp	PrintNumber	
  5500                                  
  5501                                  ; --------------------------------------------------------
  5502                                  
  5503                                  	; 21/12/2024
  5504                                  	; write text in VESA VBE graphics mode
  5505                                  PrintString:
  5506                                  	; esi = string address
  5507                                  printstr_loop:
  5508 00002599 31C0                    	xor	eax, eax
  5509 0000259B AC                      	lodsb
  5510 0000259C 08C0                    	or	al, al
  5511 0000259E 7417                    	jz	short printstr_ok
  5512                                  
  5513 000025A0 56                      	push	esi
  5514                                  
  5515 000025A1 8B35[34730000]          	mov	esi, [screenpos]
  5516                                  
  5517                                  	; esi = pixel position (hw = row, si = column)
  5518                                  	; eax = al = character
  5519                                  	;call	write_character
  5520                                  	; 22/12/2024
  5521 000025A7 E80C000000              	call	write_character_white
  5522                                  
  5523 000025AC 668305[34730000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5524                                  
  5525 000025B4 5E                      	pop	esi
  5526 000025B5 EBE2                    	jmp	short printstr_loop
  5527                                  
  5528                                  printstr_ok:
  5529 000025B7 C3                      	retn
  5530                                  
  5531                                  ; --------------------------------------------------------
  5532                                  
  5533                                  	; 21/12/2024
  5534                                  	; write character (at cursor position)
  5535                                  	; in graphics mode (640*480, 256 colors)
  5536                                  	; 22/12/2024
  5537                                  write_character_white:
  5538 000025B8 B90F000000              	mov	ecx, 0Fh
  5539                                  write_character:
  5540                                  	; esi = pixel position (hw = row, si = column)
  5541                                  	; eax = al = character
  5542                                  	; cl = color
  5543 000025BD 890D[38730000]          	mov	[wcolor], ecx ; 22/12/2024
  5544                                  
  5545                                  	; 22/12/2024
  5546 000025C3 50                      	push	eax
  5547                                  	; clear previous character pixels
  5548 000025C4 BF[CD3F0000]            	mov	edi, fillblock
  5549                                  	sys	_video, 020Fh, 0, 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000025C9 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000025CE B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000025D3 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000025D8 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000025DD CD40                <1>  int 40h
  5550 000025DF 58                      	pop	eax
  5551                                  
  5552 000025E0 C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5553 000025E3 BF[E84D0000]            	mov	edi, fontbuff2 ; start of user font data
  5554 000025E8 01C7                    	add	edi, eax
  5555                                  
  5556                                  	; 21/12/2024
  5557                                  	; NOTE:
  5558                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5559                                  	; system calls -in graphics mode-
  5560                                  	; because 8*16 pixel operations are faster
  5561                                  	;			than 8*14 pixel operations.
  5562                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5563                                  	; adding 2 empty lines))
  5564                                  	; (8*14 characters can be written via pixel operations)
  5565                                    	
  5566                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5567                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5568                                  	;sysvideo:
  5569                                  	;   function in BH
  5570                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5571                                  	;   sub function in BL
  5572                                  	;	0Fh: WRITE CHARACTER (FONT)
  5573                                  	;          CL = char's color (8 bit, 256 colors)
  5574                                  	;	If DH bit 7 = 1
  5575                                  	;	   USER FONT (from user buffer)
  5576                                  	;	         DL = 1 -> 8x16 pixel font
  5577                                   	;	   EDI = user's font buffer address
  5578                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5579                                  	;	   ESI = start position (row, column)
  5580                                  	;		(HW = row, SI = column)
  5581                                  	;;;;;;;;;;;;;;;;;
  5582                                  
  5583                                  	sys	_video, 020Fh, [wcolor], 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000025EA BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000025EF 8B0D[38730000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000025F5 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000025FA B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000025FF CD40                <1>  int 40h
  5584                                  
  5585 00002601 C3                      	retn
  5586                                  
  5587                                  ; --------------------------------------------------------
  5588                                  
  5589                                  	; 22/12/2024
  5590                                  	; 21/12/2024
  5591                                  	; (write chars in VESA VBE graphics mode)
  5592                                  	; 14/11/2024
  5593                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5594                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5595                                  
  5596                                  	;PROGRESSBAR_ROW equ 23
  5597                                  	; 21/12/2024 (640*480)
  5598                                  	PROGRESSBAR_ROW equ 31
  5599                                  
  5600                                  UpdateProgressBar:
  5601 00002602 E890FEFFFF              	call	SetProgressTime	; 14/11/2024
  5602                                  
  5603                                  	; 01/12/2024 (32bit registers)
  5604 00002607 A1[F47D0000]            	mov	eax, [ProgressTime]
  5605                                  UpdateProgressBar@:
  5606 0000260C BA50000000              	mov	edx, 80
  5607 00002611 F7E2                    	mul	edx
  5608 00002613 8B1D[F07D0000]          	mov	ebx, [TotalTime]
  5609 00002619 F7F3                    	div	ebx
  5610                                  
  5611                                  	; 22/12/2024
  5612                                  	; check progress bar indicator position if it is same 
  5613 0000261B 3A05[3D730000]          	cmp	al, [pbprev]
  5614 00002621 7430                    	je	short UpdateProgressBar_ok
  5615 00002623 A2[3D730000]            	mov	[pbprev], al
  5616                                  
  5617                                  UpdateProgressBar@@:
  5618                                  	;; Push for the 'Clean' part
  5619 00002628 50                      	push	eax ; **
  5620 00002629 50                      	push	eax ; *
  5621                                  
  5622                                  	;; Set cursor position
  5623 0000262A B61F                    	mov	dh, PROGRESSBAR_ROW
  5624 0000262C B200                    	mov	dl, 0
  5625 0000262E E8D1FDFFFF              	call	setCursorPosition
  5626                                  
  5627 00002633 58                      	pop	eax ; *
  5628 00002634 09C0                    	or	eax, eax
  5629 00002636 742D                    	jz	short UpdateProgressBar_Clean
  5630                                  
  5631                                  UpdateProgressBar_DrawProgress:
  5632                                  	; 22/12/2024
  5633                                  	; 21/12/2024
  5634                                  	; (write progress bar chars in graphics mode)
  5635                                  	;;;;
  5636 00002638 89C5                    	mov	ebp, eax
  5637 0000263A 50                      	push	eax ; ***
  5638 0000263B 8B35[34730000]          	mov	esi, [screenpos]
  5639                                  UpdateProgressBar_DrawProgress_@:
  5640 00002641 B8DF000000              	mov	eax, 223
  5641                                  	
  5642                                  	; esi = pixel position (hw = row, si = column)
  5643                                  	; eax = al = character
  5644                                  	;call	write_character
  5645                                  	; 22/12/2024
  5646 00002646 E86DFFFFFF              	call	write_character_white
  5647                                  
  5648 0000264B 4D                      	dec	ebp
  5649 0000264C 7406                    	jz	short UpdateProgressBar_DrawCursor
  5650                                  
  5651 0000264E 83C608                  	add	esi, 8 ; next column
  5652 00002651 EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5653                                  	;;;
  5654                                  
  5655                                  UpdateProgressBar_ok:
  5656 00002653 C3                      	retn
  5657                                  
  5658                                  UpdateProgressBar_DrawCursor:
  5659                                  	; 22/12/2024
  5660 00002654 5A                      	pop	edx ; ***
  5661 00002655 B61F                    	mov	dh, PROGRESSBAR_ROW
  5662 00002657 E8A8FDFFFF              	call	setCursorPosition
  5663                                  
  5664                                  	; 21/12/2024
  5665                                  	; (write progress bar character in graphics mode)
  5666                                  	;;;;
  5667                                  	;;;mov	eax, 223
  5668                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5669                                  	;;mov	eax, 223*16
  5670                                  	;;mov	edi, fontbuff2 ; start of user font data
  5671                                  	;;add	edi, eax
  5672                                  	;mov	edi, fontbuff2+(223*16)
  5673                                  	;
  5674                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5675                                  	; 22/12/2024
  5676                                  	;mov	eax, 223
  5677                                  	; eax = 0
  5678 0000265C B0DF                    	mov	al, 223
  5679 0000265E B10C                    	mov	cl, 0Ch ; red
  5680 00002660 E858FFFFFF              	call	write_character
  5681                                  	;;;;
  5682                                  
  5683                                  UpdateProgressBar_Clean:
  5684                                  	;pop	eax  ; **
  5685                                  	; 22/12/2024
  5686 00002665 5A                      	pop	edx  ; **
  5687                                  	; 21/12/2024
  5688 00002666 BD50000000              	mov	ebp, 80
  5689                                  	;sub	bp, ax
  5690 0000266B 6629D5                  	sub	bp, dx ; 22/12/2024
  5691 0000266E 74E3                    	jz	short UpdateProgressBar_ok
  5692                                  
  5693 00002670 B61F                    	mov	dh, PROGRESSBAR_ROW
  5694                                  	;mov	dl, al ; 22/12/2024
  5695 00002672 E88DFDFFFF              	call	setCursorPosition
  5696                                  
  5697                                  	; 21/12/2024
  5698                                  	; (write progress bar chars in graphics mode)
  5699                                  	;;;;
  5700 00002677 8B35[34730000]          	mov	esi, [screenpos]
  5701                                  UpdateProgressBar_Clean_@:
  5702                                  	;;;mov	eax, 223
  5703                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5704                                  	;;mov	eax, 223*16
  5705                                  	;mov	edi, fontbuff2 ; start of user font data
  5706                                  	;add	edi, eax
  5707                                  	;mov	edi, fontbuff2+(223*16)
  5708                                  	;
  5709                                  	;sys	_video, 020Fh, 08h, 8001h
  5710                                  	; 22/12/2024
  5711                                  	;mov	eax, 223
  5712                                  	; eax = 0
  5713 0000267D B0DF                    	mov	al, 223
  5714 0000267F B108                    	mov	cl, 08h ; gray (dark)
  5715 00002681 E837FFFFFF              	call	write_character
  5716                                  	;;;;
  5717                                  
  5718 00002686 4D                      	dec	ebp
  5719 00002687 74CA                    	jz	short UpdateProgressBar_ok
  5720                                  
  5721 00002689 83C608                  	add	esi, 8 ; next column
  5722 0000268C EBEF                    	jmp	short UpdateProgressBar_Clean_@
  5723                                  	;;;;
  5724                                  
  5725                                  ; --------------------------------------------------------
  5726                                  ; 17/11/2024
  5727                                  
  5728                                  Player_ProcessKey_Backwards:
  5729                                  	;; In order to go backwards 5 seconds:
  5730                                  	;; Update file pointer to the beginning, skip headers
  5731 0000268E B142                    	mov	cl, 'B'
  5732 00002690 EB02                    	jmp	short Player_ProcessKey_B_or_F
  5733                                  
  5734                                  Player_ProcessKey_Forwards:
  5735                                  	;; In order to fast-forward 5 seconds, set the file pointer
  5736                                  	;; to CUR_SEEK + 5 * Freq
  5737                                  
  5738 00002692 B146                    	mov	cl, 'F'
  5739                                  	;jmp	short Player_ProcessKey_B_or_F
  5740                                  
  5741                                  	; 01/12/2024 (32bit regsisters)
  5742                                  Player_ProcessKey_B_or_F:
  5743                                  	; 17/11/2024
  5744                                  	; 04/11/2024
  5745                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5746                                    
  5747                                  	; 04/11/2024
  5748 00002694 B805000000              	mov	eax, 5
  5749 00002699 0FB71D[707D0000]        	movzx	ebx, word [WAVE_BlockAlign]
  5750 000026A0 F7E3                    	mul	ebx
  5751 000026A2 668B1D[687D0000]        	mov	bx, [WAVE_SampleRate]
  5752 000026A9 F7E3                    	mul	ebx
  5753                                  	; eax = transfer byte count for 5 seconds
  5754                                  	
  5755                                  	; 17/11/2024
  5756 000026AB 80F942                  	cmp	cl, 'B'
  5757                                  	;mov	bx, [LoadedDataBytes]
  5758                                  	;mov	cx, [LoadedDataBytes+2]
  5759                                  	; 01/12/2024
  5760 000026AE 8B0D[FC7D0000]          	mov	ecx, [LoadedDataBytes]
  5761 000026B4 7508                    	jne	short move_forward ; cl = 'F'
  5762                                  move_backward:
  5763                                  	;sub	bx, ax
  5764                                  	;sbb	cx, dx
  5765 000026B6 29C1                    	sub	ecx, eax
  5766 000026B8 7316                    	jnc	short move_file_pointer
  5767                                  move_to_beginning:
  5768                                  	;xor	cx, cx ; 0
  5769                                  	;xor	bx, bx ; 0
  5770 000026BA 31C9                    	xor	ecx, ecx
  5771 000026BC EB12                    	jmp	short move_file_pointer
  5772                                  move_forward: 
  5773                                  	;add	bx, ax
  5774                                  	;adc	cx, dx
  5775 000026BE 01C1                    	add	ecx, eax
  5776 000026C0 7208                    	jc	short move_to_end
  5777                                  	;cmp	cx, [DATA_SubchunkSize+2]
  5778                                  	;ja	short move_to_end
  5779                                  	;jb	short move_file_pointer
  5780                                  	;cmp	bx, [DATA_SubchunkSize]
  5781                                  	;jna	short move_file_pointer
  5782 000026C2 3B0D[787D0000]          	cmp	ecx, [DATA_SubchunkSize]
  5783 000026C8 7606                    	jna	short move_file_pointer
  5784                                  move_to_end:
  5785                                  	;mov	bx, [DATA_SubchunkSize]
  5786                                  	;mov	cx, [DATA_SubchunkSize+2]
  5787 000026CA 8B0D[787D0000]          	mov	ecx, [DATA_SubchunkSize]
  5788                                  move_file_pointer:
  5789                                  	;mov	dx, bx    
  5790                                  	;mov	[LoadedDataBytes], dx
  5791                                  	;mov	[LoadedDataBytes+2], cx
  5792 000026D0 890D[FC7D0000]          	mov	[LoadedDataBytes], ecx
  5793                                  	;add	dx, 44 ; + header
  5794                                  	;adc	cx, 0
  5795 000026D6 83C12C                  	add	ecx, 44 
  5796                                  
  5797                                  	; seek
  5798                                  	;mov	bx, [filehandle]
  5799                                  	;mov	ax, 4200h
  5800                                  	;int	21h
  5801                                  	; 01/12/2024
  5802 000026D9 31D2                    	xor	edx, edx ; offset from beginning of the file
  5803                                  	; ecx = offset	
  5804                                  	; ebx = file handle
  5805                                  	; edx = 0
  5806                                  	sys	_seek, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000026DB 8B1D[807D0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000026E1 B813000000          <1>  mov eax, %1
    97                              <1> 
    98 000026E6 CD40                <1>  int 40h
  5807 000026E8 C3                      	retn
  5808                                  
  5809                                  ; --------------------------------------------------------
  5810                                  
  5811                                  	; 25/12/2024
  5812                                  	; 22/12/2024 (VESA VBE mode graphics) 
  5813                                  	; (640*480, 256 colors)
  5814                                  clear_window:
  5815 000026E9 8B3D[30730000]          	mov	edi, [LFB_ADDR]
  5816                                  	;add	edi, (13*80*8*14)
  5817                                  	; 25/12/2024
  5818 000026EF 81C7009A0100            	add	edi, 164*640
  5819 000026F5 29C0                    	sub	eax, eax
  5820                                  	;mov	ecx, (16*640*14)/4 ; 16 rows
  5821 000026F7 B900A00000              	mov	ecx, 64*640 ; 256 volume level points
  5822 000026FC F3AB                    	rep	stosd
  5823                                  	; 24/12/2024
  5824 000026FE A3[40730000]            	mov	[prev_points], eax ; 0
  5825                                  	;
  5826 00002703 C3                      	retn
  5827                                  
  5828                                  ; --------------------------------------------------------
  5829                                  
  5830                                  	; 22/12/2024
  5831                                  	; 21/12/2024
  5832                                  	; (simulate wave leds in graphics mode)
  5833                                  	; (640*480, 256 colors)
  5834                                  reset_wave_leds:
  5835                                  	; 22/12/2024
  5836 00002704 C705[E8710000]0000-     	mov	dword [prev_leds], 0
  5836 0000270C 0000               
  5837                                  	;
  5838 0000270E BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  5839 00002713 BE[E85D0000]            	mov	esi, wleds_addr
  5840                                  next_led:
  5841 00002718 AD                      	lodsd
  5842 00002719 89C7                    	mov	edi, eax
  5843 0000271B BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  5844 00002720 BB[C85D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5845                                  led_line:
  5846 00002725 8A23                    	mov	ah, [ebx]
  5847 00002727 B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  5848                                  next_pixel:
  5849 0000272C D0E4                    	shl	ah, 1
  5850 0000272E 7308                    	jnc	short skip_this
  5851 00002730 B008                    	mov	al, 8 ; gray
  5852 00002732 AA                      	stosb
  5853 00002733 49                      	dec	ecx
  5854 00002734 75F6                    	jnz	short next_pixel
  5855 00002736 EB06                    	jmp	short next_line
  5856                                  skip_this:
  5857 00002738 B000                    	mov	al, 0 ; black
  5858 0000273A AA                      	stosb
  5859 0000273B 49                      	dec	ecx
  5860 0000273C 75EE                    	jnz	short next_pixel
  5861                                  next_line:
  5862 0000273E 4A                      	dec	edx
  5863 0000273F 7504                    	jnz	short next_line_@
  5864 00002741 4D                      	dec	ebp
  5865 00002742 75D4                    	jnz	short next_led
  5866                                  	;clc	; 25/12/2024
  5867 00002744 C3                      	retn
  5868                                  next_line_@:
  5869                                  	; 22/12/2024
  5870 00002745 81C778020000            	add	edi, 640-8 ; next line
  5871 0000274B 43                      	inc	ebx
  5872 0000274C EBD7                    	jmp	short led_line	
  5873                                  
  5874                                  ; --------------------------------------------------------
  5875                                  
  5876                                  	; 22/12/2024 (graphics mode)
  5877                                  	; 09/12/2024
  5878                                  	; 19/11/2024
  5879                                  UpdateWaveLeds:
  5880                                  	; 23/11/2024
  5881                                  	;call	reset_wave_leds
  5882                                  	; 22/12/2024 (faster method, 80 against 80*16)
  5883                                  	; turn off previously lighting wave leds at first
  5884                                  	;;;
  5885 0000274E BE[E8710000]            	mov	esi, prev_leds
  5886 00002753 833E00                  	cmp	dword [esi], 0
  5887 00002756 7433                    	jz	short UpdateWaveLeds_ok
  5888 00002758 B950000000              	mov	ecx, 80
  5889                                  turn_off_led:
  5890 0000275D AD                      	lodsd
  5891 0000275E 89C7                    	mov	edi, eax
  5892                                  	; edi = wave led address
  5893 00002760 BD0E000000              	mov	ebp, 14
  5894 00002765 BB[C85D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5895 0000276A 31D2                    	xor	edx, edx
  5896 0000276C B008                    	mov	al, 8 ; gray (dark)
  5897                                  toffl_next_line:
  5898                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5899                                  	;mov	dl, 8
  5900 0000276E 88C2                    	mov	dl, al ; 8
  5901 00002770 8A23                    	mov	ah, [ebx]
  5902                                  toffl_next_pixel:
  5903 00002772 D0E4                    	shl	ah, 1
  5904 00002774 7310                    	jnc	short toffl_skip_this
  5905 00002776 AA                      	stosb
  5906                                  toffl_next_pixel_@:
  5907 00002777 4A                      	dec	edx
  5908 00002778 75F8                    	jnz	short toffl_next_pixel
  5909 0000277A 4D                      	dec	ebp
  5910 0000277B 740C                    	jz	short toffl_next_led
  5911 0000277D 81C778020000            	add	edi, 640-8 ; next line
  5912 00002783 43                      	inc	ebx
  5913 00002784 EBE8                    	jmp	short toffl_next_line
  5914                                  toffl_skip_this:
  5915 00002786 47                      	inc	edi
  5916 00002787 EBEE                    	jmp	short toffl_next_pixel_@
  5917                                  toffl_next_led:
  5918 00002789 E2D2                    	loop	turn_off_led
  5919                                  UpdateWaveLeds_ok:
  5920                                  	;;;
  5921                                  	; 09/12/2024
  5922                                  	;jmp	short turn_on_leds
  5923                                  
  5924                                  ; --------------------------------------------------------
  5925                                  
  5926                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  5927                                  	; 09/12/2024
  5928                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  5929                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  5930                                  	; 21/11/2024, 22/11/2024
  5931                                  	; 19/11/2024
  5932                                  turn_on_leds:
  5933                                  	; 09/12/2024
  5934                                  	; 07/12/2024
  5935 0000278B 8A15[4D7D0000]          	mov	dl, [half_buffer]
  5936                                  tol_@:
  5937                                  	; 07/12/2024
  5938 00002791 3815[4C7D0000]          	cmp	[pbuf_s], dl
  5939 00002797 7520                    	jne	short tol_ns_buf
  5940 00002799 8B1D[447D0000]          	mov	ebx, [wleds_dif]
  5941 0000279F 8B35[487D0000]          	mov	esi, [pbuf_o]
  5942 000027A5 8B0D[EC7D0000]          	mov	ecx, [buffersize] ; bytes
  5943 000027AB 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  5944 000027AD 01DE                    	add	esi, ebx
  5945 000027AF 7204                    	jc	short tol_o_@
  5946 000027B1 39CE                    	cmp	esi, ecx
  5947 000027B3 760C                    	jna	short tol_s_buf
  5948                                  tol_o_@:
  5949 000027B5 89CE                    	mov	esi, ecx
  5950 000027B7 EB08                    	jmp	short tol_s_buf
  5951                                  
  5952                                  tol_ns_buf:
  5953 000027B9 8815[4C7D0000]          	mov	[pbuf_s], dl
  5954 000027BF 31F6                    	xor	esi, esi ; 0
  5955                                  tol_s_buf:
  5956 000027C1 8935[487D0000]          	mov	[pbuf_o], esi
  5957                                  
  5958                                  tol_buf_@:
  5959                                  	; 07/12/2024
  5960 000027C7 81C6[00800000]          	add	esi, audio_buffer
  5961 000027CD B950000000              	mov	ecx, 80
  5962                                  	;xor	eax, eax ; 0
  5963 000027D2 BB[E85D0000]            	mov	ebx, wleds_addr
  5964                                  	; 22/12/2024
  5965 000027D7 BF[E8710000]            	mov	edi, prev_leds
  5966                                  tol_fill_c:
  5967 000027DC 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  5968 000027DE 66AD                    	lodsw	; left
  5969 000027E0 80C480                  	add	ah, 80h	; 24/12/2024
  5970 000027E3 89C2                    	mov	edx, eax
  5971 000027E5 66AD                    	lodsw	; right
  5972                                  	;add	ax, dx
  5973 000027E7 80C480                  	add	ah, 80h
  5974                                  	;; 21/12/2024 (16 volume levels)
  5975                                  	;shr	eax, 12
  5976                                  	; 24/12/2024
  5977 000027EA 01D0                    	add	eax, edx
  5978 000027EC C1E80D                  	shr	eax, 13	; (L+R/2) & 16 volume levels
  5979                                  
  5980 000027EF 53                      	push	ebx ; *
  5981                                  	; 01/12/2024
  5982 000027F0 C1E002                  	shl	eax, 2
  5983 000027F3 01C3                    	add	ebx, eax
  5984                                  	; 01/12/2024 (32bit address)
  5985                                  	;mov	edi, [ebx]
  5986                                  	; 22/12/2024
  5987 000027F5 8B03                    	mov	eax, [ebx]
  5988 000027F7 AB                      	stosd
  5989 000027F8 57                      	push	edi ; **
  5990 000027F9 89C7                    	mov	edi, eax
  5991                                  	;;;
  5992                                  	; 21/12/2024
  5993                                  	; (simulate wave leds in graphics mode)
  5994                                  	; (640*480, 256 colors)
  5995                                  turn_on_led:
  5996                                  	; edi = wave led address
  5997 000027FB BD0E000000              	mov	ebp, 14
  5998 00002800 BB[C85D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5999 00002805 A0[E53F0000]            	mov	al, [ccolor]
  6000                                  tol_next_line:
  6001 0000280A BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6002 0000280F 8A23                    	mov	ah, [ebx]
  6003                                  tol_next_pixel:
  6004 00002811 D0E4                    	shl	ah, 1
  6005 00002813 7310                    	jnc	short tol_skip_this
  6006 00002815 AA                      	stosb
  6007                                  tol_next_pixel_@:
  6008 00002816 4A                      	dec	edx
  6009 00002817 75F8                    	jnz	short tol_next_pixel
  6010 00002819 4D                      	dec	ebp
  6011 0000281A 740C                    	jz	short tol_next_led
  6012                                  	; 22/12/2024
  6013 0000281C 81C778020000            	add	edi, 640-8 ; next line
  6014 00002822 43                      	inc	ebx
  6015 00002823 EBE5                    	jmp	short tol_next_line
  6016                                  tol_skip_this:
  6017 00002825 47                      	inc	edi
  6018 00002826 EBEE                    	jmp	short tol_next_pixel_@
  6019                                  tol_next_led:
  6020                                  	; 22/12/2024
  6021 00002828 5F                      	pop	edi ; **
  6022                                  	;;;
  6023 00002829 5B                      	pop	ebx ; *
  6024 0000282A 83C340                  	add	ebx, 16*4
  6025 0000282D E2AD                    	loop	tol_fill_c
  6026                                  
  6027 0000282F C3                      	retn
  6028                                  
  6029                                  ; -------------------------------------------------------------
  6030                                  
  6031                                  ; -------------------------------------------------------------
  6032                                  ; ac97.inc (11/11/2023)
  6033                                  ; -------------------------------------------------------------
  6034                                  
  6035                                  ; special characters
  6036                                  LF      EQU 10
  6037                                  CR      EQU 13
  6038                                  
  6039                                  ; PCI stuff
  6040                                  
  6041                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  6042                                  
  6043                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  6044                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6045                                  SIS_VID		equ	1039h
  6046                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  6047                                  AMD_VID		equ	1022h
  6048                                  
  6049                                  ICH_DID         equ     2415h           ; ICH device ID
  6050                                  ICH0_DID        equ     2425h           ; ICH0
  6051                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  6052                                                                          ; they all should be compatible.
  6053                                  
  6054                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  6055                                  ICH3_DID	equ     2485h           ; ICH3
  6056                                  ICH4_DID        equ     24C5h           ; ICH4
  6057                                  ICH5_DID	equ     24D5h           ; ICH5
  6058                                  ICH6_DID	equ     266Eh           ; ICH6
  6059                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  6060                                  ESB631X_DID	equ     2698h           ; 631XESB
  6061                                  ICH7_DID	equ	27DEh		; ICH7
  6062                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6063                                  MX82440_DID	equ	7195h
  6064                                  SI7012_DID	equ	7012h
  6065                                  NFORCE_DID	equ	01B1h
  6066                                  NFORCE2_DID	equ	006Ah
  6067                                  AMD8111_DID	equ	746Dh
  6068                                  AMD768_DID	equ	7445h
  6069                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  6070                                  CK804_DID	equ	0059h
  6071                                  MCP04_DID	equ	003Ah
  6072                                  CK8_DID		equ	008Ah
  6073                                  NFORCE3_DID	equ	00DAh
  6074                                  CK8S_DID	equ	00EAh
  6075                                  
  6076                                  ; -------------------------------------------------------------
  6077                                  
  6078                                  ; 22/12/2024
  6079                                  align 4
  6080                                  
  6081                                  ; 13/11/2024
  6082                                  ; ('<<' to 'shl' conversion for FASM)
  6083                                  ;
  6084                                  ; 29/05/2024 (TRDOS 386)
  6085                                  ; 17/02/2017
  6086                                  ; Valid ICH device IDs
  6087                                  
  6088                                  valid_ids:
  6089                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  6090 00002830 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  6091 00002834 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  6092 00002838 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  6093 0000283C 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  6094 00002840 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  6095 00002844 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  6096 00002848 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  6097 0000284C 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  6098 00002850 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  6099 00002854 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  6100                                  	; 03/11/2023 - Erdogan Tan
  6101 00002858 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  6102 0000285C 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  6103 00002860 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  6104 00002864 DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  6105 00002868 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  6106 0000286C 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  6107 00002870 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  6108 00002874 DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  6109 00002878 DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  6110 0000287C DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  6111 00002880 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  6112                                  
  6113                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  6114                                  ; 13/11/2024
  6115                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  6116                                  
  6117 00002884 00000000                	dd 0
  6118                                  
  6119                                  Credits:
  6120 00002888 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  6120 00002891 6C6179657220666F72-
  6120 0000289A 205452444F53203338-
  6120 000028A3 36206279204572646F-
  6120 000028AC 67616E2054616E2E20 
  6121 000028B5 446563656D62657220-     	db 'December 2024.',10,13,0
  6121 000028BE 323032342E0A0D00   
  6122 000028C6 32362F31322F323032-     	db '26/12/2024', 10,13
  6122 000028CF 340A0D             
  6123                                  ; 15/11/2024
  6124                                  reset:
  6125 000028D2 00                      	db 0
  6126                                  
  6127                                  msgAudioCardInfo:
  6128 000028D3 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  6128 000028DC 204143393720284943-
  6128 000028E5 482920417564696F20-
  6128 000028EE 436F6E74726F6C6C65-
  6128 000028F7 722E0A0D00         
  6129                                  
  6130                                  	; 21/12/2024
  6131                                  msg_usage:
  6132 000028FC 75736167653A206470-     	db 'usage: dplaywav filename.wav',10,13,0
  6132 00002905 6C6179776176206669-
  6132 0000290E 6C656E616D652E7761-
  6132 00002917 760A0D00           
  6133                                  
  6134                                  noDevMsg:
  6135 0000291B 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  6135 00002924 61626C6520746F2066-
  6135 0000292D 696E64204143393720-
  6135 00002936 617564696F20646576-
  6135 0000293F 69636521           
  6136 00002943 0A0D00                  	db 10,13,0
  6137                                  
  6138                                  noFileErrMsg:
  6139 00002946 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  6139 0000294F 6C65206E6F7420666F-
  6139 00002958 756E642E0A0D00     
  6140                                  
  6141                                  ; 07/12/2024
  6142                                  trdos386_err_msg:
  6143 0000295F 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  6143 00002968 2053797374656D2063-
  6143 00002971 616C6C206572726F72-
  6143 0000297A 20210A0D00         
  6144                                  
  6145                                  ; 29/05/2024
  6146                                  ; 11/11/2023
  6147                                  msg_init_err:
  6148 0000297F 0D0A                    	db CR, LF
  6149 00002981 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6149 0000298A 726F6C6C65722F436F-
  6149 00002993 64656320696E697469-
  6149 0000299C 616C697A6174696F6E-
  6149 000029A5 206572726F722021   
  6150 000029AD 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6151                                  
  6152                                  ; 25/11/2023
  6153                                  msg_no_vra:
  6154 000029B0 0A0D                    	db 10,13
  6155 000029B2 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6155 000029BB 70706F72742021204F-
  6155 000029C4 6E6C79203438206B48-
  6155 000029CD 5A2073616D706C6520-
  6155 000029D6 726174652073757070-
  6155 000029DF 6F727465642021     
  6156 000029E6 0A0D00                  	db 10,13,0
  6157                                  
  6158                                  ; 19/11/2024
  6159                                  ; 03/06/2017
  6160                                  hex_chars:
  6161 000029E9 303132333435363738-     	db '0123456789ABCDEF', 0
  6161 000029F2 3941424344454600   
  6162                                  msgAC97Info:
  6163 000029FA 0D0A                    	db 0Dh, 0Ah
  6164 000029FC 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6164 00002A05 696F20436F6E74726F-
  6164 00002A0E 6C6C6572202620436F-
  6164 00002A17 64656320496E666F0D-
  6164 00002A20 0A                 
  6165 00002A21 2056656E646F722049-     	db ' Vendor ID: '
  6165 00002A2A 443A20             
  6166                                  msgVendorId:
  6167 00002A2D 303030306820446576-     	db '0000h Device ID: '
  6167 00002A36 6963652049443A20   
  6168                                  msgDevId:
  6169 00002A3E 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6170 00002A45 204275733A20            	db ' Bus: '
  6171                                  msgBusNo:
  6172 00002A4B 303068204465766963-     	db '00h Device: '
  6172 00002A54 653A20             
  6173                                  msgDevNo:
  6174 00002A57 3030682046756E6374-     	db '00h Function: '
  6174 00002A60 696F6E3A20         
  6175                                  msgFncNo:
  6176 00002A65 303068                  	db '00h'
  6177 00002A68 0D0A                    	db 0Dh, 0Ah
  6178 00002A6A 204E414D4241523A20      	db ' NAMBAR: '
  6179                                  msgNamBar:
  6180 00002A73 30303030682020          	db '0000h  '
  6181 00002A7A 4E41424D4241523A20      	db 'NABMBAR: '
  6182                                  msgNabmBar:
  6183 00002A83 303030306820204952-     	db '0000h  IRQ: '
  6183 00002A8C 513A20             
  6184                                  msgIRQ:
  6185 00002A8F 3030                    	dw 3030h
  6186 00002A91 0D0A00                  	db 0Dh, 0Ah, 0
  6187                                  ; 25/11/2023
  6188                                  msgVRAheader:
  6189 00002A94 205652412073757070-     	db ' VRA support: '
  6189 00002A9D 6F72743A20         
  6190 00002AA2 00                      	db 0	
  6191                                  msgVRAyes:
  6192 00002AA3 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6193                                  msgVRAno:
  6194 00002AA9 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6195 00002AAE 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6195 00002AB7 6C617465642073616D-
  6195 00002AC0 706C65207261746520-
  6195 00002AC9 706C6179696E67206D-
  6195 00002AD2 6574686F6429       
  6196 00002AD8 0D0A00                  	db 0Dh, 0Ah, 0
  6197                                  
  6198 00002ADB 90                      align 4
  6199                                  
  6200                                  ; -------------------------------------------------------------
  6201                                  
  6202                                  	; 21/12/2024
  6203                                  SplashScreen:
  6204 00002ADC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6204 00002AE5 202020202020202020-
  6204 00002AEE 202020202020202020-
  6204 00002AF7 202020202020202020-
  6204 00002B00 202020202020202020-
  6204 00002B09 202020202020202020-
  6204 00002B12 202020202020202020-
  6204 00002B1B 202020202020202020-
  6204 00002B24 2020202020DDDBDE   
  6205 00002B2C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6205 00002B35 202020202020202020-
  6205 00002B3E 202020202020202020-
  6205 00002B47 202020202020202020-
  6205 00002B50 202020202020202020-
  6205 00002B59 202020202020202020-
  6205 00002B62 202020202020202020-
  6205 00002B6B 202020202020202020-
  6205 00002B74 2020202020DDDBDE   
  6206 00002B7C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6206 00002B85 202020202020202020-
  6206 00002B8E 202020202020202020-
  6206 00002B97 202020202020202020-
  6206 00002BA0 202020202020202020-
  6206 00002BA9 202020202020202020-
  6206 00002BB2 202020202020202020-
  6206 00002BBB 202020202020202020-
  6206 00002BC4 2020202020DDDBDE   
  6207 00002BCC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6207 00002BD5 202020202020202020-
  6207 00002BDE 202020202020202020-
  6207 00002BE7 202020202020202020-
  6207 00002BF0 202020202020202020-
  6207 00002BF9 202020202020202020-
  6207 00002C02 202020202020202020-
  6207 00002C0B 202020202020202020-
  6207 00002C14 2020202020DDDBDE   
  6208 00002C1C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6208 00002C25 202020202020202020-
  6208 00002C2E 202020202020202020-
  6208 00002C37 202020202020202020-
  6208 00002C40 202020202020202020-
  6208 00002C49 202020202020202020-
  6208 00002C52 202020202020202020-
  6208 00002C5B 202020202020202020-
  6208 00002C64 2020202020DDDBDE   
  6209 00002C6C DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6209 00002C75 202020202020202020-
  6209 00002C7E 2020202020205F5F5F-
  6209 00002C87 5F5F5F5F2020205F5F-
  6209 00002C90 5F5F5F5F2020202020-
  6209 00002C99 2020205F5F5F5F5F5F-
  6209 00002CA2 5F2E20202020202020-
  6209 00002CAB 202020202020202020-
  6209 00002CB4 2020202020DDDBDE   
  6210 00002CBC DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6210 00002CC5 202020202020202020-
  6210 00002CCE 20202020207C202020-
  6210 00002CD7 202020205C202F2020-
  6210 00002CE0 5F5F20205C20202020-
  6210 00002CE9 20202F202020202020-
  6210 00002CF2 207C20202020202020-
  6210 00002CFB 202020202020202020-
  6210 00002D04 2020202020DDDBDE   
  6211 00002D0C DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6211 00002D15 202020202020202020-
  6211 00002D1E 20202020207C20202E-
  6211 00002D27 2D2D2E20207C20207C-
  6211 00002D30 20207C20207C202020-
  6211 00002D39 207C202020282D2D2D-
  6211 00002D42 2D6020202020202020-
  6211 00002D4B 202020202020202020-
  6211 00002D54 2020202020DDDBDE   
  6212 00002D5C DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6212 00002D65 202020202020202020-
  6212 00002D6E 20202020207C20207C-
  6212 00002D77 20207C20207C20207C-
  6212 00002D80 20207C20207C202020-
  6212 00002D89 20205C2020205C2020-
  6212 00002D92 202020202020202020-
  6212 00002D9B 202020202020202020-
  6212 00002DA4 2020202020DDDBDE   
  6213 00002DAC DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6213 00002DB5 202020202020202020-
  6213 00002DBE 20202020207C202027-
  6213 00002DC7 2D2D2720207C202060-
  6213 00002DD0 2D2D2720207C202E2D-
  6213 00002DD9 2D2D2D292020207C20-
  6213 00002DE2 202020202020202020-
  6213 00002DEB 202020202020202020-
  6213 00002DF4 2020202020DDDBDE   
  6214 00002DFC DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6214 00002E05 202020202020202020-
  6214 00002E0E 20202020207C5F5F5F-
  6214 00002E17 5F5F5F5F2F205C5F5F-
  6214 00002E20 5F5F5F5F2F20207C5F-
  6214 00002E29 5F5F5F5F5F5F2F2020-
  6214 00002E32 202020202020202020-
  6214 00002E3B 202020202020202020-
  6214 00002E44 2020202020DDDBDE   
  6215 00002E4C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6215 00002E55 202020202020202020-
  6215 00002E5E 202020202020202020-
  6215 00002E67 202020202020202020-
  6215 00002E70 202020202020202020-
  6215 00002E79 202020202020202020-
  6215 00002E82 202020202020202020-
  6215 00002E8B 202020202020202020-
  6215 00002E94 2020202020DDDBDE   
  6216 00002E9C DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6216 00002EA5 5F5F5F5F5F5F202020-
  6216 00002EAE 205F5F202020202020-
  6216 00002EB7 202020205F5F5F2020-
  6216 00002EC0 205F5F5F5F20202020-
  6216 00002EC9 5F5F5F5F20205F5F5F-
  6216 00002ED2 5F5F5F5F202E5F5F5F-
  6216 00002EDB 5F5F5F202020202020-
  6216 00002EE4 2020202020DDDBDE   
  6217 00002EEC DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6217 00002EF5 2020205F20205C2020-
  6217 00002EFE 7C20207C2020202020-
  6217 00002F07 2020202F2020205C20-
  6217 00002F10 205C2020205C20202F-
  6217 00002F19 2020202F207C202020-
  6217 00002F22 5F5F5F5F7C7C202020-
  6217 00002F2B 5F20205C2020202020-
  6217 00002F34 2020202020DDDBDE   
  6218 00002F3C DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6218 00002F45 20207C5F2920207C20-
  6218 00002F4E 7C20207C2020202020-
  6218 00002F57 20202F20205E20205C-
  6218 00002F60 20205C2020205C2F20-
  6218 00002F69 20202F20207C20207C-
  6218 00002F72 5F5F2020207C20207C-
  6218 00002F7B 5F2920207C20202020-
  6218 00002F84 2020202020DDDBDE   
  6219 00002F8C DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6219 00002F95 2020205F5F5F2F2020-
  6219 00002F9E 7C20207C2020202020-
  6219 00002FA7 202F20202F5F5C2020-
  6219 00002FB0 5C20205C5F20202020-
  6219 00002FB9 5F2F2020207C202020-
  6219 00002FC2 5F5F7C20207C202020-
  6219 00002FCB 2020202F2020202020-
  6219 00002FD4 2020202020DDDBDE   
  6220 00002FDC DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6220 00002FE5 20207C202020202020-
  6220 00002FEE 7C2020602D2D2D2D2E-
  6220 00002FF7 2F20205F5F5F5F5F20-
  6220 00003000 205C2020207C20207C-
  6220 00003009 20202020207C20207C-
  6220 00003012 5F5F5F5F207C20207C-
  6220 0000301B 5C20205C2D2D2D2D2E-
  6220 00003024 2020202020DDDBDE   
  6221 0000302C DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6221 00003035 205F7C202020202020-
  6221 0000303E 7C5F5F5F5F5F5F5F2F-
  6221 00003047 5F5F2F20202020205C-
  6221 00003050 5F5F5C20207C5F5F7C-
  6221 00003059 20202020207C5F5F5F-
  6221 00003062 5F5F5F5F7C7C205F7C-
  6221 0000306B 20602E5F5F5F5F5F7C-
  6221 00003074 2020202020DDDBDE   
  6222 0000307C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6222 00003085 202020202020202020-
  6222 0000308E 202020202020202020-
  6222 00003097 202020202020202020-
  6222 000030A0 202020202020202020-
  6222 000030A9 202020202020202020-
  6222 000030B2 202020202020202020-
  6222 000030BB 202020202020202020-
  6222 000030C4 2020202020DDDBDE   
  6223 000030CC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6223 000030D5 202020202020202020-
  6223 000030DE 202020202020202020-
  6223 000030E7 202020202020202020-
  6223 000030F0 202020202020202020-
  6223 000030F9 202020202020202020-
  6223 00003102 202020202020202020-
  6223 0000310B 202020202020202020-
  6223 00003114 2020202020DDDBDE   
  6224 0000311C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6224 00003125 202020202020202020-
  6224 0000312E 202020202020202020-
  6224 00003137 202020202020202020-
  6224 00003140 202020202020202020-
  6224 00003149 202020202020202020-
  6224 00003152 202020202020202020-
  6224 0000315B 202020202020202020-
  6224 00003164 2020202020DDDBDE   
  6225 0000316C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6225 00003175 202020202020202020-
  6225 0000317E 202020202020202020-
  6225 00003187 202020202020202020-
  6225 00003190 202020202020202020-
  6225 00003199 202020202020202020-
  6225 000031A2 202020202020202020-
  6225 000031AB 202020202020202020-
  6225 000031B4 2020202020DDDBDE   
  6226 000031BC DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6226 000031C5 202020202020202020-
  6226 000031CE 202020202020202020-
  6226 000031D7 202020202020202057-
  6226 000031E0 454C434F4D4520544F-
  6226 000031E9 202020202020202020-
  6226 000031F2 202020202020202020-
  6226 000031FB 202020202020202020-
  6226 00003204 2020202020DDDBDE   
  6227 0000320C DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6227 00003215 202020202020202020-
  6227 0000321E 202020202020202020-
  6227 00003227 202020202020202044-
  6227 00003230 4F5320504C41594552-
  6227 00003239 202020202020202020-
  6227 00003242 202020202020202020-
  6227 0000324B 202020202020202020-
  6227 00003254 2020202020DDDBDE   
  6228 0000325C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6228 00003265 202020202020202020-
  6228 0000326E 202020202020202020-
  6228 00003277 202020202020202020-
  6228 00003280 202020202020202020-
  6228 00003289 202020202020202020-
  6228 00003292 202020202020202020-
  6228 0000329B 202020202020202020-
  6228 000032A4 2020202020DDDBDE   
  6229 000032AC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6229 000032B5 202020202020202020-
  6229 000032BE 202020202020202020-
  6229 000032C7 202020202020202020-
  6229 000032D0 202020202020202020-
  6229 000032D9 202020202020202020-
  6229 000032E2 202020202020202020-
  6229 000032EB 202020202020202020-
  6229 000032F4 2020202020DDDBDE   
  6230 000032FC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6230 00003305 202020202020202020-
  6230 0000330E 202020202020202020-
  6230 00003317 202020202020202020-
  6230 00003320 202020202020202020-
  6230 00003329 202020202020202020-
  6230 00003332 202020202020202020-
  6230 0000333B 202020202020202020-
  6230 00003344 2020202020DDDBDE   
  6231 0000334C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6231 00003355 202020202020202020-
  6231 0000335E 202020202020202020-
  6231 00003367 202020202020202020-
  6231 00003370 202020202020202020-
  6231 00003379 202020202020202020-
  6231 00003382 202020202020202020-
  6231 0000338B 202020202020202020-
  6231 00003394 2020202020DDDBDE   
  6232 0000339C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6232 000033A5 202020202020202020-
  6232 000033AE 202020202020202020-
  6232 000033B7 202020202020202020-
  6232 000033C0 202020202020202020-
  6232 000033C9 202020202020202020-
  6232 000033D2 202020202020202020-
  6232 000033DB 202020202020202020-
  6232 000033E4 2020202020DDDBDE   
  6233 000033EC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6233 000033F5 202020202020202020-
  6233 000033FE 202020202020202020-
  6233 00003407 202020202020202020-
  6233 00003410 202020202020202020-
  6233 00003419 202020202020202020-
  6233 00003422 202020202020202020-
  6233 0000342B 202020202020202020-
  6233 00003434 2020202020DDDBDE   
  6234 0000343C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6234 00003445 202020202020202020-
  6234 0000344E 202020202020202020-
  6234 00003457 202020202020202020-
  6234 00003460 202020202020202020-
  6234 00003469 202020202020202020-
  6234 00003472 202020202020202020-
  6234 0000347B 202020202020202020-
  6234 00003484 2020202020DDDBDE   
  6235 0000348C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6235 00003495 202020202020202020-
  6235 0000349E 202020202020202020-
  6235 000034A7 202020202020202020-
  6235 000034B0 202020202020202020-
  6235 000034B9 202020202020202020-
  6235 000034C2 202020202020202020-
  6235 000034CB 202020202020202020-
  6235 000034D4 2020202020DDDBDE   
  6236 000034DC DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6236 000034E5 202020202020202020-
  6236 000034EE 202020202020202020-
  6236 000034F7 202020202020202020-
  6236 00003500 202020202020202020-
  6236 00003509 202020202020202020-
  6236 00003512 202020202020202020-
  6236 0000351B 202020202020202020-
  6236 00003524 2020202020DDDBDE   
  6237 0000352C DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6237 00003535 202020202020202020-
  6237 0000353E 202020202020202020-
  6237 00003547 202020202020202020-
  6237 00003550 202020202020202020-
  6237 00003559 202020202020202020-
  6237 00003562 202020202020202020-
  6237 0000356B 202020202020202020-
  6237 00003574 2020202020DDDBDE   
  6238 0000357C 00                      	db 0
  6239                                  
  6240                                  ; -------------------------------------------------------------
  6241                                  
  6242                                  	; 22/12/2024
  6243                                  	; 21/12/2024
  6244                                  PlayingScreen:
  6245 0000357D DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6245 00003586 DBDBDBDBDBDBDBDBDB-
  6245 0000358F DBDBDBDBDBDBDBDBDB-
  6245 00003598 DBDBDBDBDBDBDB2044-
  6245 000035A1 4F5320506C61796572-
  6245 000035AA 20DBDBDBDBDBDBDBDB-
  6245 000035B3 DBDBDBDBDBDBDBDBDB-
  6245 000035BC DBDBDBDBDBDBDBDBDB-
  6245 000035C5 DBDBDBDBDBDBDBDB   
  6246 000035CD C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6246 000035D6 CDCDCDCDCDCDCDCDCD-
  6246 000035DF CDCDCDCDCDCDCDCDCD-
  6246 000035E8 CDCDCDCDCDCDCDCDCD-
  6246 000035F1 CDCDCDCDCDCDCDCDCD-
  6246 000035FA CDCDCDCDCDCDCDCDCD-
  6246 00003603 CDCDCDCDCDCDCDCDCD-
  6246 0000360C CDCDCDCDCDCDCDCDCD-
  6246 00003615 CDCDCDCDCDCDCDBB   
  6247 0000361D BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6247 00003626 202020202020202020-
  6247 0000362F 202020202020202020-
  6247 00003638 202020202020202055-
  6247 00003641 736572204775696465-
  6247 0000364A 202020202020202020-
  6247 00003653 202020202020202020-
  6247 0000365C 202020202020202020-
  6247 00003665 20202020202020BA   
  6248 0000366D BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<H>             Hardware Info", 9 dup(32), 186
  6248 00003676 706163653E20202020-
  6248 0000367F 2020202020506C6179-
  6248 00003688 2F5061757365202020-
  6248 00003691 20202020203C483E20-
  6248 0000369A 202020202020202020-
  6248 000036A3 202020486172647761-
  6248 000036AC 726520496E666F2020-
  6248 000036B5 20202020202020BA   
  6249                                  	; 25/12/2024
  6250 000036BD BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>/<G>     Wave Lighting", 9 dup(32), 186
  6250 000036C6 3E2020202020202020-
  6250 000036CF 202020202053746F70-
  6250 000036D8 202020202020202020-
  6250 000036E1 20202020203C456E74-
  6250 000036EA 65723E2F3C473E2020-
  6250 000036F3 20202057617665204C-
  6250 000036FC 69676874696E672020-
  6250 00003705 20202020202020BA   
  6251 0000370D BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6251 00003716 3E2020202020202020-
  6251 0000371F 2020202020466F7277-
  6251 00003728 617264732020202020-
  6251 00003731 20202020203C2B3E2F-
  6251 0000373A 3C2D3E202020202020-
  6251 00003743 202020496E632F4465-
  6251 0000374C 6320566F6C756D6520-
  6251 00003755 20202020202020BA   
  6252 0000375D BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6252 00003766 3E2020202020202020-
  6252 0000376F 20202020204261636B-
  6252 00003778 776172647320202020-
  6252 00003781 20202020203C513E20-
  6252 0000378A 202020202020202020-
  6252 00003793 202020517569742050-
  6252 0000379C 726F6772616D202020-
  6252 000037A5 20202020202020BA   
  6253 000037AD CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6253 000037B6 CDCDCDCDCDCDCDCDCD-
  6253 000037BF CDCDCDCDCDCDCDCDCD-
  6253 000037C8 CDCDCDCDCDCDCDCDCD-
  6253 000037D1 CDCDCDCDCDCDCDCDCD-
  6253 000037DA CDCDCDCDCDCDCDCDCD-
  6253 000037E3 CDCDCDCDCDCDCDCDCD-
  6253 000037EC CDCDCDCDCDCDCDCDCD-
  6253 000037F5 CDCDCDCDCDCDCDB9   
  6254 000037FD BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6254 00003806 6C65204E616D65203A-
  6254 0000380F 202020202020202020-
  6254 00003818 202020202020202020-
  6254 00003821 20202020204269742D-
  6254 0000382A 5261746520203A2020-
  6254 00003833 202020302020426974-
  6254 0000383C 732020202020202020-
  6254 00003845 20202020202020BA   
  6255 0000384D BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6255 00003856 657175656E6379203A-
  6255 0000385F 202020202030202020-
  6255 00003868 2020487A2020202020-
  6255 00003871 2020202020232D4368-
  6255 0000387A 616E6E656C733A2020-
  6255 00003883 202020302020202020-
  6255 0000388C 202020202020202020-
  6255 00003895 20202020202020BA   
  6256 0000389D C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6256 000038A6 CDCDCDCDCDCDCDCDCD-
  6256 000038AF CDCDCDCDCDCDCDCDCD-
  6256 000038B8 CDCDCDCDCDCDCDCDCD-
  6256 000038C1 CDCDCDCDCDCDCDCDCD-
  6256 000038CA CDCDCDCDCDCDCDCDCD-
  6256 000038D3 CDCDCDCDCDCDCDCDCD-
  6256 000038DC CDCDCDCDCDCDCDCDCD-
  6256 000038E5 CDCDCDCDCDCDCDBC   
  6257 000038ED 202020202020202020-     	db  80 dup(32)
  6257 000038F6 202020202020202020-
  6257 000038FF 202020202020202020-
  6257 00003908 202020202020202020-
  6257 00003911 202020202020202020-
  6257 0000391A 202020202020202020-
  6257 00003923 202020202020202020-
  6257 0000392C 202020202020202020-
  6257 00003935 2020202020202020   
  6258                                  improper_samplerate_txt:
  6259                                  read_error_txt:
  6260 0000393D 202020202020202020-     	db  80 dup(32)
  6260 00003946 202020202020202020-
  6260 0000394F 202020202020202020-
  6260 00003958 202020202020202020-
  6260 00003961 202020202020202020-
  6260 0000396A 202020202020202020-
  6260 00003973 202020202020202020-
  6260 0000397C 202020202020202020-
  6260 00003985 2020202020202020   
  6261 0000398D 202020202020202020-     	db  80 dup(32)
  6261 00003996 202020202020202020-
  6261 0000399F 202020202020202020-
  6261 000039A8 202020202020202020-
  6261 000039B1 202020202020202020-
  6261 000039BA 202020202020202020-
  6261 000039C3 202020202020202020-
  6261 000039CC 202020202020202020-
  6261 000039D5 2020202020202020   
  6262 000039DD 202020202020202020-     	db  80 dup(32)
  6262 000039E6 202020202020202020-
  6262 000039EF 202020202020202020-
  6262 000039F8 202020202020202020-
  6262 00003A01 202020202020202020-
  6262 00003A0A 202020202020202020-
  6262 00003A13 202020202020202020-
  6262 00003A1C 202020202020202020-
  6262 00003A25 2020202020202020   
  6263 00003A2D 202020202020202020-     	db  80 dup(32)
  6263 00003A36 202020202020202020-
  6263 00003A3F 202020202020202020-
  6263 00003A48 202020202020202020-
  6263 00003A51 202020202020202020-
  6263 00003A5A 202020202020202020-
  6263 00003A63 202020202020202020-
  6263 00003A6C 202020202020202020-
  6263 00003A75 2020202020202020   
  6264 00003A7D 202020202020202020-     	db  80 dup(32)
  6264 00003A86 202020202020202020-
  6264 00003A8F 202020202020202020-
  6264 00003A98 202020202020202020-
  6264 00003AA1 202020202020202020-
  6264 00003AAA 202020202020202020-
  6264 00003AB3 202020202020202020-
  6264 00003ABC 202020202020202020-
  6264 00003AC5 2020202020202020   
  6265 00003ACD 202020202020202020-     	db  80 dup(32)
  6265 00003AD6 202020202020202020-
  6265 00003ADF 202020202020202020-
  6265 00003AE8 202020202020202020-
  6265 00003AF1 202020202020202020-
  6265 00003AFA 202020202020202020-
  6265 00003B03 202020202020202020-
  6265 00003B0C 202020202020202020-
  6265 00003B15 2020202020202020   
  6266 00003B1D 202020202020202020-     	db  80 dup(32)
  6266 00003B26 202020202020202020-
  6266 00003B2F 202020202020202020-
  6266 00003B38 202020202020202020-
  6266 00003B41 202020202020202020-
  6266 00003B4A 202020202020202020-
  6266 00003B53 202020202020202020-
  6266 00003B5C 202020202020202020-
  6266 00003B65 2020202020202020   
  6267 00003B6D 202020202020202020-     	db  80 dup(32)
  6267 00003B76 202020202020202020-
  6267 00003B7F 202020202020202020-
  6267 00003B88 202020202020202020-
  6267 00003B91 202020202020202020-
  6267 00003B9A 202020202020202020-
  6267 00003BA3 202020202020202020-
  6267 00003BAC 202020202020202020-
  6267 00003BB5 2020202020202020   
  6268 00003BBD 202020202020202020-     	db  80 dup(32)
  6268 00003BC6 202020202020202020-
  6268 00003BCF 202020202020202020-
  6268 00003BD8 202020202020202020-
  6268 00003BE1 202020202020202020-
  6268 00003BEA 202020202020202020-
  6268 00003BF3 202020202020202020-
  6268 00003BFC 202020202020202020-
  6268 00003C05 2020202020202020   
  6269 00003C0D 202020202020202020-     	db  80 dup(32)
  6269 00003C16 202020202020202020-
  6269 00003C1F 202020202020202020-
  6269 00003C28 202020202020202020-
  6269 00003C31 202020202020202020-
  6269 00003C3A 202020202020202020-
  6269 00003C43 202020202020202020-
  6269 00003C4C 202020202020202020-
  6269 00003C55 2020202020202020   
  6270 00003C5D 202020202020202020-     	db  80 dup(32)
  6270 00003C66 202020202020202020-
  6270 00003C6F 202020202020202020-
  6270 00003C78 202020202020202020-
  6270 00003C81 202020202020202020-
  6270 00003C8A 202020202020202020-
  6270 00003C93 202020202020202020-
  6270 00003C9C 202020202020202020-
  6270 00003CA5 2020202020202020   
  6271 00003CAD 202020202020202020-     	db  80 dup(32)
  6271 00003CB6 202020202020202020-
  6271 00003CBF 202020202020202020-
  6271 00003CC8 202020202020202020-
  6271 00003CD1 202020202020202020-
  6271 00003CDA 202020202020202020-
  6271 00003CE3 202020202020202020-
  6271 00003CEC 202020202020202020-
  6271 00003CF5 2020202020202020   
  6272 00003CFD 202020202020202020-     	db  80 dup(32)
  6272 00003D06 202020202020202020-
  6272 00003D0F 202020202020202020-
  6272 00003D18 202020202020202020-
  6272 00003D21 202020202020202020-
  6272 00003D2A 202020202020202020-
  6272 00003D33 202020202020202020-
  6272 00003D3C 202020202020202020-
  6272 00003D45 2020202020202020   
  6273 00003D4D 202020202020202020-     	db  80 dup(32)
  6273 00003D56 202020202020202020-
  6273 00003D5F 202020202020202020-
  6273 00003D68 202020202020202020-
  6273 00003D71 202020202020202020-
  6273 00003D7A 202020202020202020-
  6273 00003D83 202020202020202020-
  6273 00003D8C 202020202020202020-
  6273 00003D95 2020202020202020   
  6274 00003D9D 202020202020202020-     	db  80 dup(32)
  6274 00003DA6 202020202020202020-
  6274 00003DAF 202020202020202020-
  6274 00003DB8 202020202020202020-
  6274 00003DC1 202020202020202020-
  6274 00003DCA 202020202020202020-
  6274 00003DD3 202020202020202020-
  6274 00003DDC 202020202020202020-
  6274 00003DE5 2020202020202020   
  6275 00003DED 202020202020202020-     	db  80 dup(32)
  6275 00003DF6 202020202020202020-
  6275 00003DFF 202020202020202020-
  6275 00003E08 202020202020202020-
  6275 00003E11 202020202020202020-
  6275 00003E1A 202020202020202020-
  6275 00003E23 202020202020202020-
  6275 00003E2C 202020202020202020-
  6275 00003E35 2020202020202020   
  6276 00003E3D 202020202020202020-     	db  80 dup(32)
  6276 00003E46 202020202020202020-
  6276 00003E4F 202020202020202020-
  6276 00003E58 202020202020202020-
  6276 00003E61 202020202020202020-
  6276 00003E6A 202020202020202020-
  6276 00003E73 202020202020202020-
  6276 00003E7C 202020202020202020-
  6276 00003E85 2020202020202020   
  6277 00003E8D 202020202020202020-     	db  80 dup(32)
  6277 00003E96 202020202020202020-
  6277 00003E9F 202020202020202020-
  6277 00003EA8 202020202020202020-
  6277 00003EB1 202020202020202020-
  6277 00003EBA 202020202020202020-
  6277 00003EC3 202020202020202020-
  6277 00003ECC 202020202020202020-
  6277 00003ED5 2020202020202020   
  6278 00003EDD CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6278 00003EE6 CDCDCDCDCDCDCDCDCD-
  6278 00003EEF CDCDCDCDCDCDCDCDCD-
  6278 00003EF8 CDCDCDCDCDCDCDCDCD-
  6278 00003F01 CDCDCDCDCDCDCDCDCD-
  6278 00003F0A CDCDCDCDCDCDCDCDCD-
  6278 00003F13 CDCDCDCDCDCDCDCDCD-
  6278 00003F1C CDCDCDCDCDCDCDCDCD-
  6278 00003F25 CDCDCDCDCDCDCDCD   
  6279 00003F2D 202020202020202020-     	db  80 dup(32)
  6279 00003F36 202020202020202020-
  6279 00003F3F 202020202020202020-
  6279 00003F48 202020202020202020-
  6279 00003F51 202020202020202020-
  6279 00003F5A 202020202020202020-
  6279 00003F63 202020202020202020-
  6279 00003F6C 202020202020202020-
  6279 00003F75 2020202020202020   
  6280 00003F7D 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6280 00003F86 202020202020202020-
  6280 00003F8F 202020202020202020-
  6280 00003F98 20202020202030303A-
  6280 00003FA1 303020AEAF2030303A-
  6280 00003FAA 303020202020202020-
  6280 00003FB3 202020202020202020-
  6280 00003FBC 202020202020202056-
  6280 00003FC5 4F4C2030303025     
  6281 00003FCC 00                      	db 0
  6282                                  
  6283                                  ; -------------------------------------------------------------
  6284                                  
  6285                                  	; 22/12/2024
  6286                                  fillblock:
  6287 00003FCD FF<rep Eh>              	times 14 db 0FFh
  6288 00003FDB 0000                    	dw 0
  6289                                  
  6290                                  ; -------------------------------------------------------------
  6291                                  
  6292                                  ; 23/11/2024
  6293                                  colors:
  6294 00003FDD 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6295                                  	; white, cyan, green, red, yellow, blue, magenta
  6296 00003FE5 0B                      ccolor:	db 0Bh	; cyan
  6297                                  
  6298                                  EOF: 
  6299                                  
  6300                                  ; -------------------------------------------------------------
  6301                                  
  6302                                  bss:
  6303                                  
  6304                                  ABSOLUTE bss
  6305                                  
  6306 00003FE6 ????                    alignb 4
  6307                                  
  6308                                  ; 21/12/2024
  6309                                  fontbuff1:
  6310 00003FE8 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6311                                  fontbuff2:
  6312 00004DE8 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6313                                  
  6314                                  ; 11/12/2024
  6315                                  wleds_addr:
  6316 00005DE8 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6317                                  ; 22/12/2024
  6318                                  prev_leds:
  6319 000071E8 <res 140h>              	resd 80	; previous lighting leds
  6320                                  
  6321                                  ; 24/12/2024
  6322                                  wpoints_dif:	; wave lighting points factor (differential) 
  6323 00007328 ????????                	resd 1	; required bytes for 1/18 second wave lighting
  6324                                  graphstart:
  6325 0000732C ????????                	resd 1	; start (top) line/row for wave lighting points 	 
  6326                                  
  6327                                  LFB_ADDR:
  6328 00007330 ????????                	resd 1
  6329                                  ;nextrow:
  6330                                  	;resd 1
  6331                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6332 00007334 ????????                	resd 1
  6333 00007338 ????????                wcolor:	resd 1
  6334                                  ; 26/12/2024
  6335                                  ;tcolor: resb 1 ; text color
  6336                                  columns:
  6337 0000733C ??                      	resb 1
  6338 0000733D ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6339                                  
  6340 0000733E ????                    alignb 4
  6341                                  
  6342                                  bss_start:
  6343                                  
  6344                                  ; 24/12/2024
  6345                                  prev_points:
  6346 00007340 <res A00h>              	resd 640 ; previous wave points (which are lighting)	
  6347                                  
  6348                                  ; 18/11/2024
  6349                                  stopped:
  6350 00007D40 ??                      	resb 1
  6351 00007D41 ??                      tLO:	resb 1
  6352                                  ; 21/11/2024
  6353 00007D42 ??                      tLP:	resb 1
  6354                                  ; 19/11/2024
  6355 00007D43 ??                      wleds:	resb 1
  6356                                  wleds_dif:
  6357 00007D44 ????????                	resd 1
  6358 00007D48 ????????                pbuf_o:	resd 1
  6359                                  ; 07/12/2024
  6360 00007D4C ??                      pbuf_s:	resb 1
  6361                                  
  6362                                  ; 07/12/2024
  6363                                  ; 24/11/2024
  6364                                  half_buffer:
  6365 00007D4D ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6366                                  
  6367                                  ; 30/05/2024
  6368 00007D4E ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6369                                  
  6370                                  ; 24/12/2024
  6371 00007D4F ??                      p_mode: resb 1	; point mode (as alternative to LED mode)
  6372                                  
  6373                                  ; 30/11/2024
  6374                                  alignb 4
  6375                                  
  6376                                  ;;;;;;;;;;;;;;
  6377                                  ; 14/11/2024
  6378                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6379                                  WAVFILEHEADERbuff:
  6380                                  RIFF_ChunkID:
  6381 00007D50 ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6382                                  		; 0x52494646
  6383                                  RIFF_ChunkSize:
  6384 00007D54 ????????                	resd 1	; Represents total file size, not 
  6385                                          	; including the first 2 fields 
  6386                                  		; (Total_File_Size - 8), little-endian
  6387                                  RIFF_Format:
  6388 00007D58 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6389                                  		; 0x57415645
  6390                                  
  6391                                  ;; WAVE header parameters ("Sub-chunk")
  6392                                  WAVE_SubchunkID:
  6393 00007D5C ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6394                                  		; 0x666d7420
  6395                                  WAVE_SubchunkSize:
  6396 00007D60 ????????                	resd 1	; Represents total chunk size
  6397                                  WAVE_AudioFormat:
  6398 00007D64 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6399                                  		; of compression, not supported.
  6400                                  WAVE_NumChannels:
  6401 00007D66 ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6402                                  WAVE_SampleRate:
  6403 00007D68 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6404                                  WAVE_ByteRate:
  6405 00007D6C ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6406                                  WAVE_BlockAlign:
  6407 00007D70 ????                    	resw 1	; NumChannels * BytesPerSample
  6408                                  		; Number of bytes for one sample.
  6409                                  WAVE_BitsPerSample:
  6410 00007D72 ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6411                                  
  6412                                  ;; DATA header parameters
  6413                                  DATA_SubchunkID:
  6414 00007D74 ????????                	resd 1	; Must be equal to "data" - big-endian
  6415                                          	; 0x64617461
  6416                                  DATA_SubchunkSize:
  6417 00007D78 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6418                                          	; Number of bytes in the data.
  6419                                  ;;;;;;;;;;;;;;
  6420                                  
  6421                                  ; 15/11/2024
  6422                                  cursortype:
  6423 00007D7C ????                    	resw 1
  6424 00007D7E ??                      flags:	resb 1
  6425                                  ; 06/11/2023
  6426                                  ac97_int_ln_reg:
  6427 00007D7F ??                      	resb 1
  6428                                  filehandle:
  6429 00007D80 ????????                	resd 1
  6430                                  
  6431                                  ; 30/05/2024
  6432                                  wav_file_name:
  6433 00007D84 <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6434 00007DD4 ????                    	resw 1	; 30/11/2024
  6435                                  
  6436                                  ; 08/11/2023
  6437                                  ; 07/11/2023
  6438                                  fbs_shift:
  6439 00007DD6 ??                      	resb 1
  6440                                  ; 07/12/2024
  6441 00007DD7 ??                      SRB:	resb 1
  6442                                  
  6443                                  ; 12/11/2016 - Erdogan Tan
  6444                                  bus_dev_fn:
  6445 00007DD8 ????????                	resd 1
  6446                                  dev_vendor:
  6447 00007DDC ????????                	resd 1
  6448                                  
  6449                                  ; 17/02/2017
  6450                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6451                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6452                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6453                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6454 00007DE0 ????                    NAMBAR:	resw 1	; BAR for mixer
  6455                                  NABMBAR:
  6456 00007DE2 ????                    	resw 1	; BAR for bus master regs
  6457                                  
  6458                                  ; 15/11/2024
  6459                                  loadfromwavfile:
  6460 00007DE4 ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6461                                  loadsize:
  6462 00007DE8 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6463                                  buffersize:
  6464 00007DEC ????????                	resd 1	; 16 bit samples (not bytes)
  6465                                  		
  6466                                  ; 14/11/2024
  6467                                  TotalTime:
  6468 00007DF0 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6469                                  ProgressTime:
  6470 00007DF4 ????????                	resd 1
  6471 00007DF8 ????????                count:	resd 1	; byte count of one (wav file) read
  6472                                  LoadedDataBytes:
  6473 00007DFC ????????                	resd 1	; total read/load count
  6474                                  
  6475                                  timerticks:
  6476 00007E00 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6477                                  		; (in order to get the emulator/qemu to run correctly)
  6478                                  ; 14/11/2024	
  6479                                  bss_end:
  6480                                  
  6481                                  ; 02/12/2024
  6482 00007E04 <res 1FCh>              alignb 4096
  6483                                  
  6484                                  ; 07/12/2024
  6485                                  ; 26/11/2023
  6486                                  audio_buffer:
  6487 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6488                                  
  6489                                  ; 01/12/2024
  6490                                  ; 26/11/2023
  6491                                  temp_buffer:
  6492 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
