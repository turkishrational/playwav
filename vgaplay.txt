     1                                  ; ****************************************************************************
     2                                  ; vgaplay.s - TRDOS 386 (TRDOS v2.0.9) WAV PLAYER - VESA VBE Video Mode 101h
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; VGAPLAY.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 25/12/2024				- play music from multiple wav files -
     7                                  ;
     8                                  ; [ Last Modification: 18/01/2025 ]
     9                                  ;
    10                                  ; Modified from DPLAYWAV.PRG .wav player program by Erdogan Tan, 25/12/2024
    11                                  ;	    and AC97PLAY.PRG, 18/12/2024	
    12                                  ;
    13                                  ; ****************************************************************************
    14                                  ; nasm vgaplay.s -l vgaplay.txt -o VGAPLAY.PRG -Z error.txt
    15                                  
    16                                  ; dplayvga.s (25/12/2024) - play music from single wav file -
    17                                  ; ac97play.s (18/12/2024) - play music from multiple wav files -
    18                                  
    19                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    20                                  ; ------------------------------------------------------------
    21                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    22                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    23                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    24                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    25                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    26                                  
    27                                  ; ------------------------------------------------------------
    28                                  
    29                                  ; 30/11/2024
    30                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    31                                  ; 29/04/2016
    32                                  _ver 	equ 0
    33                                  _exit 	equ 1
    34                                  _fork 	equ 2
    35                                  _read 	equ 3
    36                                  _write	equ 4
    37                                  _open	equ 5
    38                                  _close 	equ 6
    39                                  _wait 	equ 7
    40                                  _creat 	equ 8
    41                                  _link 	equ 9
    42                                  _unlink	equ 10
    43                                  _exec	equ 11
    44                                  _chdir	equ 12
    45                                  _time 	equ 13
    46                                  _mkdir 	equ 14
    47                                  _chmod	equ 15
    48                                  _chown	equ 16
    49                                  _break	equ 17
    50                                  _stat	equ 18
    51                                  _seek	equ 19
    52                                  _tell 	equ 20
    53                                  _mount	equ 21
    54                                  _umount	equ 22
    55                                  _setuid	equ 23
    56                                  _getuid	equ 24
    57                                  _stime	equ 25
    58                                  _quit	equ 26
    59                                  _intr	equ 27
    60                                  _fstat	equ 28
    61                                  _emt 	equ 29
    62                                  _mdate 	equ 30
    63                                  _video 	equ 31
    64                                  _audio	equ 32
    65                                  _timer	equ 33
    66                                  _sleep	equ 34
    67                                  _msg    equ 35
    68                                  _geterr	equ 36
    69                                  _fpsave	equ 37
    70                                  _pri	equ 38
    71                                  _rele	equ 39
    72                                  _fff	equ 40
    73                                  _fnf	equ 41
    74                                  _alloc	equ 42
    75                                  _dalloc equ 43
    76                                  _calbac equ 44
    77                                  _dma	equ 45
    78                                  _stdio  equ 46
    79                                  
    80                                  ; ------------------------------------------------------------
    81                                  
    82                                  %macro sys 1-4
    83                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    84                                      ; 03/09/2015
    85                                      ; 13/04/2015
    86                                      ; Retro UNIX 386 v1 system call.
    87                                      %if %0 >= 2
    88                                          mov ebx, %2
    89                                          %if %0 >= 3
    90                                              mov ecx, %3
    91                                              %if %0 = 4
    92                                                 mov edx, %4
    93                                              %endif
    94                                          %endif
    95                                      %endif
    96                                      mov eax, %1
    97                                      ;int 30h
    98                                      int 40h ; TRDOS 386 (TRDOS v2.0)
    99                                  %endmacro
   100                                  
   101                                  ; Retro UNIX 386 v1 system call format:
   102                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   103                                  
   104                                  ; ------------------------------------------------------------
   105                                  
   106                                  ; player internal variables and other equates.
   107                                  BUFFERSIZE	equ 65536
   108                                  ENDOFFILE	equ 1		; flag for knowing end of file
   109                                  
   110                                  ; ------------------------------------------------------------
   111                                  
   112                                  [BITS 32] ; 32-bit intructions
   113                                  
   114                                  [ORG 0]
   115                                  
   116                                  START_CODE:
   117                                  	; Prints the Credits Text.
   118                                  	sys	_msg, Credits, 255, 0Bh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000000 BB[1C2A0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000005 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000000A BA0B000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000000F B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000014 CD40                <1>  int 40h
   119                                  
   120                                  	; clear bss
   121 00000016 BF[F0740000]            	mov	edi, bss_start
   122 0000001B B9B5020000              	mov	ecx, (bss_end - bss_start)/4
   123 00000020 31C0                    	xor	eax, eax
   124 00000022 F3AB                    	rep	stosd
   125                                  
   126                                  ; -------------------------------------------------------------
   127                                  
   128                                  	; 21/12/2024
   129                                  	; Detect (& Enable) AC'97 Audio Device
   130 00000024 E8A8080000              	call	DetectAC97
   131 00000029 731B                    	jnc	short ac97_hardware_ready
   132                                  
   133                                  	; 30/11/2024
   134                                  	; 30/05/2024
   135                                  _dev_not_ready:
   136                                  	; couldn't find the audio device!
   137                                  	sys	_msg, noDevMsg, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000002B BB[BE2A0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000030 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000035 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000003A B823000000          <1>  mov eax, %1
    97                              <1> 
    98 0000003F CD40                <1>  int 40h
   138 00000041 E99B050000                      jmp     Exit
   139                                  
   140                                  ac97_hardware_ready:
   141 00000046 E8220A0000              	call	write_audio_dev_info
   142                                  
   143                                  ; -------------------------------------------------------------
   144                                  
   145                                  	; 21/12/2024
   146                                  	;;;
   147                                  	; Read (copy) 8x14 system fonts
   148 0000004B BE[98410000]            	mov	esi, fontbuff1
   149                                  	sys	_video, 0C03h, 256, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000050 BB030C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000055 B900010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000005A BA00000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000005F B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000064 CD40                <1>  int 40h
   150                                  
   151                                  	; convert 8x14 fonts to 8x16 fonts
   152                                  	; by inserting 2 empty rows to each characters
   153                                  	;mov	esi, fontbuff1
   154 00000066 BF[984F0000]            	mov	edi, fontbuff2
   155                                  	; 18/02/2021
   156                                  	;mov	cx, 256
   157                                  fontconvert:
   158 0000006B 51                      	push	ecx
   159 0000006C 66B90E00                	mov	cx, 14
   160 00000070 F3A4                    	rep	movsb
   161 00000072 28C0                    	sub	al, al
   162 00000074 AA                      	stosb
   163 00000075 AA                      	stosb
   164 00000076 59                      	pop	ecx
   165 00000077 E2F2                    	loop	fontconvert
   166                                  	;;;
   167                                  
   168                                  ; ------------------------------------------------------------- 
   169                                  
   170                                  	; 21/12/2024
   171                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   172                                  	sys	_video, 08FFh, 101h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000079 BBFF080000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000007E B901010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000083 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000088 CD40                <1>  int 40h
   173 0000008A 09C0                    	or	eax, eax
   174 0000008C 0F844A050000            	jz	terminate    ; nothing to do				
   175                                  	;jz	trdos386_err ; write (OS) error msg and exit
   176                                  
   177                                  set_vesa_mode_101h_ok:
   178                                  	; linear frame buffer access
   179                                  	sys	_video, 06FFh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000092 BBFF060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000097 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000009C CD40                <1>  int 40h
   180 0000009E 21C0                    	and	eax, eax
   181 000000A0 0F8481050000            	jz	error_exit ; set text mode and write err msg
   182 000000A6 A3[E0740000]            	mov	[LFB_ADDR], eax
   183                                  
   184                                  ; -------------------------------------------------------------
   185                                  
   186                                  	; 25/12/2024
   187                                  	; 28/11/2024
   188                                  Player_InitalizePSP:
   189                                  	; 30/11/2024
   190                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   191                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   192                                  	;			.. argv0text, argv1text ..) 
   193                                  	; ---- argc, argv[] ----
   194 000000AB 89E6                    	mov	esi, esp
   195 000000AD AD                      	lodsd
   196 000000AE 83F802                  	cmp	eax, 2 ; two arguments 
   197                                  		; (program file name & mod file name)
   198 000000B1 0F8233050000            	jb	pmsg_usage ; nothing to do
   199                                  	;mov	[argc], al
   200 000000B7 C1E002                  	shl	eax, 2 ; *4
   201 000000BA 01E0                    	add	eax, esp
   202                                  	; eax = last argument's address pointer
   203 000000BC A3[407F0000]            	mov	[argvl], eax ; last wav file (argument)
   204 000000C1 8935[387F0000]          	mov	[argv], esi ; current argument (PRG file name)
   205 000000C7 AD                      	lodsd	; skip program (PRG) file name
   206 000000C8 8935[3C7F0000]          	mov	[argvf], esi ; 1st wav file (argument)
   207                                  
   208                                  	; 25/12/2024
   209                                  Player_ParseParameters:
   210                                  	; 30/11/2024
   211                                  	; 29/11/2024
   212                                  	; 18/12/2024
   213                                  	;mov	edx, wav_file_name
   214                                  	
   215                                  	; 26/12/2024
   216                                  	;cmp	byte [IsInSplash], 0
   217                                  	;jna	short check_p_command
   218                                  
   219 000000CE BA[72410000]            	mov	edx, SplashFileName
   220 000000D3 EB3E                    	jmp	short _1
   221                                  
   222                                  	; 25/12/2024
   223                                  check_p_command:
   224                                  	; 07/12/2024
   225 000000D5 8B35[387F0000]          	mov	esi, [argv]
   226                                  	;
   227 000000DB 803D[007F0000]50          	cmp	byte [command], 'P'
   228 000000E2 7410                    	je	short Player_ParsePreviousParameter
   229                                      
   230                                  	; 07/12/2024
   231                                  	; 30/11/2024
   232                                  	;mov	esi, [argv] ; current argument (wav file) ptr
   233 000000E4 83C604                  	add	esi, 4
   234 000000E7 3B35[407F0000]          	cmp	esi, [argvl] ; last argument (wav file) ptr
   235 000000ED 7610                    	jna	short Player_ParseNextParameter
   236                                  jmp_Player_Quit:
   237 000000EF E931050000              	jmp	Player_Quit
   238                                  
   239                                  Player_ParsePreviousParameter:
   240                                  	; 29/11/2024
   241                                  	;mov	byte [command], 0
   242                                  	; 30/11/2024
   243                                  	;mov	esi, [argv] ; 07/12/2024	
   244 000000F4 3B35[3C7F0000]          	cmp	esi, [argvf] ; first argument (wav file) ptr
   245 000000FA 7603                    	jna	short Player_ParseNextParameter
   246 000000FC 83EE04                  	sub	esi, 4
   247                                  Player_ParseNextParameter:
   248                                  	; 30/11/2024
   249 000000FF 8935[387F0000]          	mov	[argv], esi  ; set as current argument
   250                                  	; 01/12/2024
   251 00000105 8B36                    	mov	esi, [esi]
   252                                  	; 07/12/2024
   253                                  	;mov	ecx, esi
   254                                  	;mov	esi, [ecx]
   255                                  
   256                                  	; 29/11/2024
   257 00000107 E84D000000              	call	GetFileName
   258                                  	;jcxz	jmp_Player_Quit
   259 0000010C E3E1                    	jecxz	jmp_Player_Quit ; 30/11/2024
   260                                  
   261                                  	; 30/11/2024
   262                                  	; 28/11/2024
   263 0000010E BA[447F0000]            	mov	edx, wav_file_name
   264                                  	;;;
   265                                  _1:
   266                                  
   267                                  ; open the file
   268                                          ; open existing file
   269                                  	; 28/11/2024
   270                                  	;mov	edx, wav_file_name
   271 00000113 E80B080000                      call	openFile ; no error? ok.
   272 00000118 0F8383000000                    jnc	getwavparms	; 14/11/2024
   273                                  
   274                                  	; 28/11/2024
   275 0000011E 803D[71410000]00        	cmp	byte [IsInSplash], 0
   276 00000125 0F8799000000            	ja	Player_SplashScreen
   277                                  
   278                                  	; 29/11/2024
   279 0000012B 803D[017F0000]00        	cmp	byte [filecount], 0
   280 00000132 77A1                    	ja	short check_p_command
   281                                  
   282                                  	; 25/12/2024
   283                                  	; 21/12/2024
   284 00000134 E88B050000              	call	set_text_mode
   285                                  	; file not found!
   286                                  	; 30/11/2024
   287                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000139 BB[E92A0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000013E B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000143 BA0C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000148 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 0000014D CD40                <1>  int 40h
   288 0000014F E98D040000                      jmp     Exit
   289                                  
   290                                  _exit_:
   291 00000154 E983040000              	jmp	terminate
   292                                  
   293                                  ; -------------------------------------------------------------
   294                                  
   295                                  	; 26/12/2024
   296                                  	; 25/12/2024
   297                                  	; 30/11/2024 (32bit)
   298                                  	; 29/11/2024
   299                                  	; 30/05/2024
   300                                  GetFileName:
   301 00000159 BF[447F0000]            	mov	edi, wav_file_name 
   302                                  	; 30/11/2024
   303                                  	;mov	esi, [argv]
   304 0000015E 31C9                    	xor	ecx, ecx ; 0
   305                                  ScanName:
   306 00000160 AC                      	lodsb
   307                                  	;test	al, al
   308                                  	;jz	short a_4
   309                                  	; 29/11/2024
   310 00000161 3C0D                    	cmp	al, 0Dh
   311 00000163 7638                    	jna	short a_4
   312 00000165 3C20                    	cmp	al, 20h
   313 00000167 74F7                    	je	short ScanName	; scan start of name.
   314 00000169 AA                      	stosb
   315 0000016A B4FF                    	mov	ah, 0FFh
   316                                  	;;;
   317                                  	; 14/11/2024
   318                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   319                                  	;xor	ecx, ecx ; 0
   320                                  	;;;
   321                                  a_0:	
   322 0000016C FEC4                    	inc	ah
   323                                  a_1:
   324                                  	;;;
   325                                  	; 14/11/2024
   326 0000016E 41                      	inc	ecx
   327                                  	;;;
   328 0000016F AC                      	lodsb
   329 00000170 AA                      	stosb
   330 00000171 3C2E                    	cmp	al, '.'
   331 00000173 74F7                    	je	short a_0
   332                                  	; 29/11/2024
   333 00000175 3C20                    	cmp	al, 20h
   334                                  	;and	al, al
   335                                  	;jnz	short a_1
   336                                  	;;;
   337                                  	; 14/11/2024
   338 00000177 7613                    	jna	short a_3
   339 00000179 20E4                    	and	ah, ah
   340 0000017B 7406                    	jz	short a_2
   341 0000017D 3C2F                    	cmp	al, '/'	; 14/12/2024
   342 0000017F 7502                    	jne	short a_2
   343 00000181 B400                    	mov	ah, 0
   344                                  a_2:
   345 00000183 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   346 00000186 72E6                    	jb	short a_1
   347                                  	; 29/11/2024
   348 00000188 29C9                    	sub	ecx, ecx
   349 0000018A EB11                    	jmp	short a_4
   350                                  a_3:
   351                                  	; 29/11/2024
   352 0000018C 4F                      	dec	edi
   353                                  	;;;
   354 0000018D 08E4                    	or	ah, ah		; if period NOT found,
   355 0000018F 750C                    	jnz	short a_4 	; then add a .WAV extension.
   356                                  SetExt:
   357                                  	; 29/11/2024
   358                                  	;dec	edi
   359 00000191 C7072E574156            	mov	dword [edi], '.WAV'
   360                                  				; ! 64+12 is DOS limit
   361                                  				; but writing +4 must not
   362                                  				; destroy the following data	 
   363                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   364                                  	; 29/11/2024
   365 00000197 83C104                  	add	ecx, 4
   366 0000019A 83C704                  	add	edi, 4
   367                                  a_4:	
   368 0000019D C60700                  	mov	byte [edi], 0
   369                                  	; 30/11/2024
   370 000001A0 C3                      	retn
   371                                  
   372                                  ; -------------------------------------------------------------
   373                                  
   374                                  getwavparms:
   375                                  	; 14/11/2024
   376 000001A1 E8AF070000                     	call    getWAVParameters
   377 000001A6 72AC                    	jc	short _exit_		; nothing to do
   378                                  
   379                                  	; 17/11/2024
   380 000001A8 B304                    	mov	bl, 4
   381 000001AA 2A1D[247F0000]          	sub	bl, byte [WAVE_BlockAlign]
   382                                  			; = 0 for 16 bit stereo
   383                                  			; = 2 for 8 bit stereo or 16 bit mono
   384                                  			; = 3 for 8 bit mono	
   385                                  
   386 000001B0 D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   387                                  	; 15/11/2024
   388 000001B2 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   389 000001B5 881D[967F0000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   390                                  					; = 0 stereo and 16 bit
   391                                  					; = 1 mono or 8 bit
   392                                  
   393                                  ; -------------------------------------------------------------
   394                                  
   395                                  	; 25/12/2024
   396 000001BB 803D[71410000]00        	cmp 	byte [IsInSplash], 0
   397                                  	;jna	short StartPlay
   398                                  	; 27/12/2024
   399 000001C2 7672                    	jna	short StartPlay@
   400                                  
   401                                  ; -------------------------------------------------------------
   402                                  
   403                                  	; 26/12/2024
   404                                  Player_SplashScreen:
   405                                  	; 21/12/2024
   406                                  	;mov	byte [tcolor], 15
   407                                  _0:
   408 000001C4 E89C040000              	call	drawsplashscreen
   409                                  
   410                                  	; 21/12/2024
   411                                  	;;;
   412                                  	; set wave volume led addresses
   413 000001C9 8B1D[E0740000]          	mov	ebx, [LFB_ADDR]
   414 000001CF 81C300C70100            	add	ebx, (13*80*8*14)
   415 000001D5 BD50000000              	mov	ebp, 80
   416 000001DA BF[985F0000]            	mov	edi, wleds_addr
   417                                  wleds_sa_1:
   418 000001DF B90F000000              	mov	ecx, 15
   419                                  wleds_sa_2:
   420 000001E4 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   421 000001E9 F7E1                    	mul	ecx
   422 000001EB 01D8                    	add	eax, ebx
   423 000001ED AB                      	stosd
   424 000001EE E2F4                    	loop	wleds_sa_2
   425 000001F0 89D8                    	mov	eax, ebx
   426 000001F2 AB                      	stosd
   427 000001F3 83C308                  	add	ebx, 8
   428 000001F6 4D                      	dec	ebp
   429 000001F7 75E6                    	jnz	short wleds_sa_1
   430                                  	;;;
   431                                  
   432                                  	; 25/12/5024
   433                                  	; 28/11/2024 
   434 000001F9 833D[347F0000]FF        	cmp	dword [filehandle], -1
   435 00000200 7540                    	jne	short StartPlay
   436                                  
   437                                  	; 24/12/2024
   438                                  	; 07/12/2024
   439                                  	;;; wait for 3 seconds
   440                                  	sys	_time, 0 ; get time in unix epoch format
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000202 BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000207 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 0000020C CD40                <1>  int 40h
   441 0000020E 89C1                    	mov	ecx, eax
   442 00000210 83C103                  	add	ecx, 3
   443                                  _wait_3s:
   444 00000213 90                      	nop
   445                                  	sys	_time, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000214 BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000219 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 0000021E CD40                <1>  int 40h
   446 00000220 39C8                    	cmp	eax, ecx
   447 00000222 72EF                    	jb	short _wait_3s
   448                                  	;;;
   449                                  
   450                                  	; 25/12/2024
   451                                  	; 28/11/2024
   452 00000224 C605[71410000]00        	mov	byte [IsInSplash], 0
   453                                  	;mov	edx, wav_file_name
   454                                  	; 30/11/2024
   455 0000022B 8B35[3C7F0000]          	mov	esi, [argvf]
   456                                  	; 29/11/2024
   457 00000231 E9C9FEFFFF              	jmp	Player_ParseNextParameter
   458                                  
   459                                  ; -------------------------------------------------------------
   460                                  
   461                                  	; 27/12/2024
   462                                  StartPlay@:
   463                                  
   464                                  	; 27/12/2024 (Detect & Enable AC97 hardware again)
   465                                  	; (this is needed after disabling audio system)
   466                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
   467                                          sys	_audio, 0102h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000236 BB02010000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000023B B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000240 CD40                <1>  int 40h
   468                                  	; ignore error at this stage
   469                                  	;jc	short ac97_not_detected
   470                                  
   471                                  ; -------------------------------------------------------------
   472                                  
   473                                  	; 25/12/2024
   474                                  StartPlay:
   475 00000242 FE05[017F0000]          	inc	byte [filecount]
   476 00000248 C605[007F0000]00        	mov	byte [command], 0
   477                                  
   478                                  ; -------------------------------------------------------------
   479                                  
   480                                  	; 07/12/2024 (playwav9.s)
   481                                  
   482                                  	; 18/11/2023 (ich_wav4.asm)
   483                                  	; 13/11/2023 (ich_wav3.asm)
   484                                  
   485 0000024F 803D[FE7E0000]01        	cmp	byte [VRA], 1
   486 00000256 7226                    	jb	short chk_sample_rate
   487                                  
   488                                  playwav_48_khz:
   489 00000258 C705[A47F0000]-         	mov	dword [loadfromwavfile], loadFromFile
   489 0000025E [9F090000]         
   490                                  	;mov	dword [loadsize], 0 ; 65536
   491                                  	;;;
   492                                  	; 17/11/2024
   493                                  	;mov	word [buffersize], 32768
   494                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   495                                  	; 30/11/2024
   496                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   497                                  	; 07/12/2024
   498 00000262 B800000100              	mov	eax, BUFFERSIZE ; 65536
   499 00000267 A3[AC7F0000]            	mov	[buffersize], eax	; 16 bit samples
   500                                  	; 07/12/2024
   501                                  	;shl	eax, 1			; bytes
   502 0000026C 8A0D[967F0000]          	mov	cl, [fbs_shift]
   503 00000272 D3E8                    	shr	eax, cl 
   504                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   505 00000274 A3[A87F0000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   506                                  	;;;
   507                                  	;jmp	PlayNow ; 30/05/2024
   508                                  	; 07/12/2024
   509 00000279 E95F020000              	jmp	Player_Template
   510                                  
   511                                  chk_sample_rate:
   512                                  	; set conversion parameters
   513                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   514 0000027E 66A1[1C7F0000]          	mov	ax, [WAVE_SampleRate]
   515 00000284 663D80BB                	cmp	ax, 48000
   516 00000288 74CE                    	je	short playwav_48_khz
   517                                  chk_22khz:
   518 0000028A 663D2256                	cmp	ax, 22050
   519 0000028E 7545                    	jne	short chk_11khz
   520 00000290 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   521 00000297 7615                    	jna	short chk_22khz_1
   522 00000299 BB[09190000]            	mov	ebx, load_22khz_stereo_16_bit
   523 0000029E 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   524 000002A5 751A                    	jne	short chk_22khz_2
   525 000002A7 BB[7C180000]            	mov	ebx, load_22khz_mono_16_bit
   526 000002AC EB13                    	jmp	short chk_22khz_2
   527                                  chk_22khz_1:
   528 000002AE BB[F5170000]            	mov	ebx, load_22khz_stereo_8_bit
   529 000002B3 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   530 000002BA 7505                    	jne	short chk_22khz_2
   531 000002BC BB[6C170000]            	mov	ebx, load_22khz_mono_8_bit
   532                                  chk_22khz_2:
   533 000002C1 B85A1D0000              	mov	eax, 7514  ; (442*17)
   534 000002C6 BA25000000              	mov	edx, 37
   535 000002CB B911000000              	mov	ecx, 17
   536 000002D0 E9DB010000              	jmp	set_sizes
   537                                  chk_11khz:
   538 000002D5 663D112B                	cmp	ax, 11025
   539 000002D9 7545                    	jne	short chk_44khz
   540 000002DB 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   541 000002E2 7615                    	jna	short chk_11khz_1
   542 000002E4 BB[251B0000]            	mov	ebx, load_11khz_stereo_16_bit
   543 000002E9 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   544 000002F0 751A                    	jne	short chk_11khz_2
   545 000002F2 BB[AC1A0000]            	mov	ebx, load_11khz_mono_16_bit
   546 000002F7 EB13                    	jmp	short chk_11khz_2
   547                                  chk_11khz_1:
   548 000002F9 BB[321A0000]            	mov	ebx, load_11khz_stereo_8_bit
   549 000002FE 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1 
   550 00000305 7505                    	jne	short chk_11khz_2
   551 00000307 BB[BA190000]            	mov	ebx, load_11khz_mono_8_bit
   552                                  chk_11khz_2:
   553 0000030C B8AD0E0000              	mov	eax, 3757  ; (221*17)
   554 00000311 BA4A000000              	mov	edx, 74
   555 00000316 B911000000              	mov	ecx, 17
   556 0000031B E990010000              	jmp	set_sizes
   557                                  chk_44khz:
   558 00000320 663D44AC                	cmp	ax, 44100
   559 00000324 7545                    	jne	short chk_16khz
   560 00000326 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   561 0000032D 7615                    	jna	short chk_44khz_1
   562 0000032F BB[2C1D0000]            	mov	ebx, load_44khz_stereo_16_bit
   563 00000334 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   564 0000033B 751A                    	jne	short chk_44khz_2
   565 0000033D BB[B31C0000]            	mov	ebx, load_44khz_mono_16_bit
   566 00000342 EB13                    	jmp	short chk_44khz_2
   567                                  chk_44khz_1:
   568 00000344 BB[361C0000]            	mov	ebx, load_44khz_stereo_8_bit
   569 00000349 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   570 00000350 7505                    	jne	short chk_44khz_2
   571 00000352 BB[BA1B0000]            	mov	ebx, load_44khz_mono_8_bit
   572                                  chk_44khz_2:
   573                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   574 00000357 B8D93A0000              	mov	eax, 15065 ; (655*23)
   575                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   576                                  	;mov	ax, 14076 ; (612*23)
   577                                  	; 17/11/2024
   578                                  	;mov	ax, 12650 ; (550*23)
   579 0000035C BA19000000              	mov	edx, 25
   580 00000361 B917000000              	mov	ecx, 23
   581 00000366 E945010000              	jmp	set_sizes
   582                                  chk_16khz:
   583 0000036B 663D803E                	cmp	ax, 16000
   584 0000036F 7545                    	jne	short chk_8khz
   585 00000371 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   586 00000378 7615                    	jna	short chk_16khz_1
   587 0000037A BB[B1120000]            	mov	ebx, load_16khz_stereo_16_bit
   588 0000037F 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1 
   589 00000386 751A                    	jne	short chk_16khz_2
   590 00000388 BB[30120000]            	mov	ebx, load_16khz_mono_16_bit
   591 0000038D EB13                    	jmp	short chk_16khz_2
   592                                  chk_16khz_1:
   593 0000038F BB[76110000]            	mov	ebx, load_16khz_stereo_8_bit
   594 00000394 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   595 0000039B 7505                    	jne	short chk_16khz_2
   596 0000039D BB[F7100000]            	mov	ebx, load_16khz_mono_8_bit
   597                                  chk_16khz_2:
   598                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   599 000003A2 B855150000              	mov	eax, 5461
   600                                  	; 17/11/2024
   601                                  	;mov	ax, 5460
   602 000003A7 BA03000000              	mov	edx, 3
   603 000003AC B901000000              	mov	ecx, 1
   604 000003B1 E9FA000000              	jmp	set_sizes
   605                                  chk_8khz:
   606 000003B6 663D401F                	cmp	ax, 8000
   607 000003BA 7545                    	jne	short chk_24khz
   608 000003BC 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   609 000003C3 7615                    	jna	short chk_8khz_1
   610 000003C5 BB[AC0F0000]            	mov	ebx, load_8khz_stereo_16_bit
   611 000003CA 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   612 000003D1 751A                    	jne	short chk_8khz_2
   613 000003D3 BB[DC0E0000]            	mov	ebx, load_8khz_mono_16_bit
   614 000003D8 EB13                    	jmp	short chk_8khz_2
   615                                  chk_8khz_1:
   616 000003DA BB[AC0D0000]            	mov	ebx, load_8khz_stereo_8_bit
   617 000003DF 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1 
   618 000003E6 7505                    	jne	short chk_8khz_2
   619 000003E8 BB[C80C0000]            	mov	ebx, load_8khz_mono_8_bit
   620                                  chk_8khz_2:
   621 000003ED B8AA0A0000              	mov	eax, 2730
   622 000003F2 BA06000000              	mov	edx, 6
   623 000003F7 B901000000              	mov	ecx, 1
   624 000003FC E9AF000000              	jmp	set_sizes
   625                                  chk_24khz:
   626 00000401 663DC05D                	cmp	ax, 24000
   627 00000405 7563                    	jne	short chk_32khz
   628 00000407 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   629 0000040E 7615                    	jna	short chk_24khz_1
   630                                  	; 18/01/2025 (BugFix)
   631                                  	; bx -> ebx
   632 00000410 BB[DB140000]            	mov	ebx, load_24khz_stereo_16_bit
   633 00000415 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   634 0000041C 751A                    	jne	short chk_24khz_2
   635 0000041E BB[78140000]            	mov	ebx, load_24khz_mono_16_bit
   636 00000423 EB13                    	jmp	short chk_24khz_2
   637                                  chk_24khz_1:
   638 00000425 BB[EE130000]            	mov	ebx, load_24khz_stereo_8_bit
   639 0000042A 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1 
   640 00000431 7505                    	jne	short chk_24khz_2
   641 00000433 BB[87130000]            	mov	ebx, load_24khz_mono_8_bit
   642                                  chk_24khz_2:
   643                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   644 00000438 B800200000              	mov	eax, 8192
   645                                  	; 17/11/2024
   646                                  	;mov	ax, 8190
   647 0000043D BA02000000              	mov	edx, 2
   648 00000442 B901000000              	mov	ecx, 1
   649 00000447 EB67                    	jmp	short set_sizes
   650                                  
   651                                  	; 07/12/2024
   652                                  vra_needed:
   653                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   654                                  	; 13/11/2023
   655 00000449 58                      	pop	eax ; discard return address to the caller
   656                                  	; 30/05/2024
   657                                  vra_err:
   658                                  	; 21/12/2024
   659 0000044A E875020000              	call	set_text_mode
   660                                  	; 30/11/2024
   661                                  	sys	_msg, msg_no_vra, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000044F BB[532B0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000454 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000459 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000045E B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000463 CD40                <1>  int 40h
   662 00000465 E977010000              	jmp	Exit
   663                                  
   664                                  chk_32khz:
   665 0000046A 663D007D                	cmp	ax, 32000
   666 0000046E 75D9                    	jne	short vra_needed
   667 00000470 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   668 00000477 7615                    	jna	short chk_32khz_1
   669 00000479 BB[DC160000]            	mov	ebx, load_32khz_stereo_16_bit
   670 0000047E 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   671 00000485 751A                    	jne	short chk_32khz_2
   672 00000487 BB[72160000]            	mov	ebx, load_32khz_mono_16_bit
   673 0000048C EB13                    	jmp	short chk_32khz_2
   674                                  chk_32khz_1:
   675 0000048E BB[D5150000]            	mov	ebx, load_32khz_stereo_8_bit
   676 00000493 803D[1A7F0000]01        	cmp	byte [WAVE_NumChannels], 1
   677 0000049A 7505                    	jne	short chk_32khz_2
   678 0000049C BB[62150000]            	mov	ebx, load_32khz_mono_8_bit
   679                                  chk_32khz_2:
   680                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   681 000004A1 B8AA2A0000              	mov	eax, 10922
   682                                  	; 17/11/2024
   683                                  	;mov	ax, 10920
   684 000004A6 BA03000000              	mov	edx, 3
   685 000004AB B902000000              	mov	ecx, 2
   686                                  	;jmp	short set_sizes
   687                                  set_sizes:
   688                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   689                                  	;;;
   690                                  	; 17/11/2024
   691 000004B0 51                      	push	ecx
   692 000004B1 B102                    	mov	cl, 2
   693 000004B3 2A0D[967F0000]          	sub	cl, [fbs_shift]
   694                                  		; = 2 for 16 bit stereo
   695                                  		; = 1 for 16 bit mono or 8 bit stereo
   696                                  		; = 0 for 8 bit mono
   697 000004B9 D3E0                    	shl	eax, cl
   698 000004BB 59                      	pop	ecx	
   699 000004BC A3[A87F0000]            	mov	[loadsize], eax	; (one) read count in bytes
   700                                  	;;;
   701 000004C1 F7E2                    	mul	edx
   702 000004C3 83F901                  	cmp	ecx, 1
   703 000004C6 7402                    	je	short s_2
   704                                  s_1:
   705 000004C8 F7F1                    	div	ecx
   706                                  s_2:
   707                                  	;;;
   708                                  	; eax = byte count of (to be) converted samples 
   709                                  	
   710                                  	; 17/11/2024
   711                                  	;;;
   712 000004CA 8A0D[967F0000]          	mov	cl, [fbs_shift]
   713                                  
   714 000004D0 D3E0                    	shl	eax, cl
   715                                  		; *1 for 16 bit stereo
   716                                  		; *2 for 16 bit mono or 8 bit stereo
   717                                  		; *4 for for 8 bit mono
   718                                  	;;;
   719                                  
   720                                  	; eax = 16 bit stereo byte count (target buffer size)
   721                                  	
   722                                  	; 07/12/2024
   723                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   724 000004D2 A3[AC7F0000]            	mov	[buffersize], eax ; buffer size in bytes
   725 000004D7 891D[A47F0000]          	mov	[loadfromwavfile], ebx
   726                                  
   727                                  ; -------------------------------------------------------------
   728                                  
   729                                  Player_Template:
   730                                  
   731                                  	; 26/12/2024
   732 000004DD 803D[71410000]00        	cmp 	byte [IsInSplash], 0
   733 000004E4 7611                    	jna	short Player_Template_@
   734                                  
   735                                  	; 24/12/2024 (setting for wave lighting points)
   736 000004E6 A1[E0740000]            	mov	eax, [LFB_ADDR]
   737                                  	;add	eax, 228*640 ; wave graphics start (top) line/row
   738 000004EB 05009A0100              	add	eax, 164*640 ; 256 volume levels ; 24/12/2024
   739 000004F0 A3[DC740000]            	mov	[graphstart], eax
   740                                  
   741                                  	; 26/12/2024
   742 000004F5 EB14                    	jmp	short PlayNow
   743                                  
   744                                  Player_Template_@:
   745                                  	; 21/12/2024
   746 000004F7 E859010000              	call	clearscreen
   747 000004FC E870010000              	call	drawplayingscreen
   748                                  
   749                                  	; 14/11/2024
   750 00000501 E8AC200000              	call	SetTotalTime
   751 00000506 E879210000              	call	UpdateFileInfo
   752                                  
   753                                  ; -------------------------------------------------------------
   754                                  
   755                                  	; 21/12/2024 (VGA/LFB modifications)
   756                                  	; (Direct access/map to the LFB is already done here)
   757                                  	; ((this program is in VESA/VBE graphics mode here))
   758                                  PlayNow:
   759                                  	; 07/12/2024
   760                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000050B BB00020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000510 8B0D[AC7F0000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000516 BA[00800000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000051B B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000520 CD40                <1>  int 40h
   761 00000522 0F82FF000000            	jc	error_exit ; return to text mode and print err msg
   762                                  
   763                                  	; 01/06/2024
   764                                  	; Initialize Audio Device (bh = 3)
   765                                  	sys	_audio, 0301h, 0, audio_int_handler
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000528 BB01030000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000052D B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000532 BA[8B090000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000537 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000053C CD40                <1>  int 40h
   766                                  	;jc	short error_exit
   767 0000053E 0F82C3000000            	jc	init_err ; return to text mode and print err msg
   768                                  
   769                                  	; 30/05/2024
   770                                  	; playwav4.asm
   771                                  ;_2:	; 24/12/2024
   772                                  	;call	check4keyboardstop	; flush keyboard buffer
   773                                  	;jc	short _2		; 07/11/2023
   774                                  
   775                                  	;;;
   776                                  	; 26/12/2024
   777                                  	; 14/11/2024
   778                                  	;mov	al, 3	; 0 = max, 31 = min
   779                                  	; 15/11/2024
   780 00000544 E86E030000              	call	SetMasterVolume
   781                                  
   782                                  	; 26/12/2024
   783 00000549 803D[71410000]00        	cmp 	byte [IsInSplash], 0
   784 00000550 770A                    	ja	short _2
   785                                  
   786                                  	; 07/12/2024
   787                                  	;call	SetPCMOutVolume
   788 00000552 E8AE210000              	call	UpdateVolume
   789                                  	;;;
   790                                  	; 14/11/2024
   791 00000557 E839220000              	call	UpdateProgressBar
   792                                  	;;;
   793                                  
   794                                  	; 26/12/2024
   795                                  _2:
   796                                  
   797                                  ; play the .wav file. Most of the good stuff is in here.
   798                                  	
   799                                  	; 05/12/2024
   800 0000055C E86A010000              	call    PlayWav
   801                                  
   802                                  ; close the .wav file and exit.
   803                                  
   804                                  	; 25/12/2024
   805 00000561 E8D8030000              	call	closeFile
   806                                  
   807                                  	; 25/12/2024
   808                                  	;;;
   809                                  	; reset file loading and EOF parameters
   810                                  	; 18/12/2024
   811 00000566 C705[B87F0000]0000-     	mov	dword [count], 0
   811 0000056E 0000               
   812 00000570 C705[BC7F0000]0000-     	mov	dword [LoadedDataBytes], 0
   812 00000578 0000               
   813 0000057A C605[327F0000]00        	mov	byte [flags], 0
   814 00000581 C605[F07E0000]00        	mov	byte [stopped], 0
   815                                  	; 26/12/2024
   816 00000588 C605[FC7E0000]FF        	mov	byte [pbuf_s], 0FFh
   817                                  	;;;
   818                                  
   819                                  ;	cmp	byte [IsInSplash], 0
   820                                  ;	jna	short _6
   821                                  ;	mov	byte [IsInSplash], 0
   822                                  ;	mov	esi, [argvf]
   823                                  ;	jmp	Player_ParseNextParameter
   824                                  ;
   825                                  ;	; 29/11/2024
   826                                  ;_6:
   827                                  ;	cmp	byte [command], 'Q'
   828                                  ;	je	short _7	; 25/12/2024
   829                                  ;	jmp	check_p_command
   830                                  ;
   831                                  ;_7:
   832                                  	; 07/12/2024
   833                                  	;;;
   834                                  	; Stop Playing
   835                                  	;sys	_audio, 0700h
   836                                  	; Cancel callback service (for user)
   837                                  	sys	_audio, 0900h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000058F BB00090000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000594 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000599 CD40                <1>  int 40h
   838                                  	; Deallocate Audio Buffer (for user)
   839                                  	sys	_audio, 0A00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000059B BB000A0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000005A0 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000005A5 CD40                <1>  int 40h
   840                                  	; Disable Audio Device
   841                                  	sys	_audio, 0C00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000005A7 BB000C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000005AC B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000005B1 CD40                <1>  int 40h
   842                                  	;;;
   843                                  
   844                                  	; 27/12/2024
   845                                  	; 26/12/2024
   846 000005B3 803D[71410000]00        	cmp	byte [IsInSplash], 0
   847 000005BA 7612                    	jna	short _6
   848 000005BC C605[71410000]00        	mov	byte [IsInSplash], 0
   849 000005C3 8B35[3C7F0000]          	mov	esi, [argvf]
   850 000005C9 E931FBFFFF              	jmp	Player_ParseNextParameter
   851                                  _6:
   852 000005CE 803D[007F0000]51        	cmp	byte [command], 'Q'
   853 000005D5 7405                    	je	short terminate
   854 000005D7 E9F9FAFFFF              	jmp	check_p_command
   855                                  
   856                                  terminate:
   857 000005DC E8E3000000              	call	set_text_mode
   858                                  Exit:
   859                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000005E1 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 000005E6 CD40                <1>  int 40h
   860                                  halt:
   861 000005E8 EBFE                    	jmp	short halt
   862                                  
   863                                  ; -------------------------------------------------------------
   864                                  
   865                                  	; 30/05/2024
   866                                  pmsg_usage:
   867                                  	; 21/12/2024
   868 000005EA E8D5000000              	call	set_text_mode
   869                                  	; 01/12/2024
   870                                  	sys	_msg, msg_usage, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000005EF BB[8F2A0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000005F4 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000005F9 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000005FE B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000603 CD40                <1>  int 40h
   871 00000605 EBDA                    	jmp	short Exit
   872                                  
   873                                  ; -------------------------------------------------------------
   874                                  
   875                                  	; 30/05/2024
   876                                  init_err:
   877                                  	; 21/12/2024
   878 00000607 E8B8000000              	call	set_text_mode
   879                                  	; 01/12/2024
   880                                  	sys	_msg, msg_init_err, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000060C BB[222B0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000611 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000616 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000061B B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000620 CD40                <1>  int 40h
   881 00000622 EBBD                    	jmp	short Exit
   882                                  
   883                                  ; -------------------------------------------------------------
   884                                  
   885                                  	; 02/12/2024
   886                                  Player_Quit@:
   887 00000624 58                      	pop	eax ; return addr (call PlayWav@)
   888                                  	
   889                                  	; 29/11/2024
   890                                  Player_Quit:
   891 00000625 EBB5                    	jmp	 short terminate
   892                                  
   893                                  
   894                                  ; -------------------------------------------------------------
   895                                  
   896                                  	; 07/12/2024
   897                                  error_exit:
   898                                  	; 21/12/2024
   899 00000627 E898000000              	call	set_text_mode
   900                                  trdos386_error:
   901                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000062C BB[022B0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000631 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000636 BA0E000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000063B B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000640 CD40                <1>  int 40h
   902 00000642 EB9D                    	jmp	short Exit
   903                                  
   904                                  ; -------------------------------------------------------------
   905                                  
   906                                  	; 21/12/2024
   907                                  print_msg:
   908 00000644 B40E                    	mov	ah, 0Eh
   909 00000646 BB07000000              	mov	ebx, 7
   910                                  	;mov	bl, 7 ; char attribute & color
   911                                  p_next_chr:
   912 0000064B AC                      	lodsb
   913 0000064C 08C0                    	or	al, al
   914 0000064E 7404                    	jz	short p_retn ; retn
   915 00000650 CD31                    	int	31h
   916 00000652 EBF7                    	jmp	short p_next_chr
   917                                  p_retn:
   918 00000654 C3                      	retn
   919                                  
   920                                  ; -------------------------------------------------------------
   921                                  
   922                                  	; 21/12/2024
   923                                  clearscreen:
   924                                  	; fast clear
   925                                  	; 640*480, 256 colors
   926 00000655 8B3D[E0740000]          	mov	edi, [LFB_ADDR]
   927 0000065B B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   928 00000660 31C0                    	xor	eax, eax
   929 00000662 F3AB                    	rep	stosd
   930 00000664 C3                      	retn
   931                                  
   932                                  ; -------------------------------------------------------------
   933                                  
   934                                  	; 26/12/2024
   935                                  	; 21/12/2024
   936                                  drawsplashscreen:
   937 00000665 BD[802C0000]            	mov	ebp, SplashScreen
   938                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   939                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   940                                  	;mov	esi, 0 ; row 0, column 0
   941 0000066A BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   942 0000066F EB0A                    	jmp	short p_d_x
   943                                  drawplayingscreen:
   944 00000671 BD[21370000]            	mov	ebp, PlayingScreen
   945                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   946                                  	;mov	esi, 0 ; row 0, column 0
   947 00000676 BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   948                                  p_d_x:
   949 0000067B C605[EC740000]50        	mov	byte [columns], 80
   950                                  p_d_x_n:
   951 00000682 31D2                    	xor	edx, edx
   952 00000684 8A5500                  	mov	dl, [ebp]
   953 00000687 20D2                    	and	dl, dl
   954 00000689 7438                    	jz	short p_d_x_ok
   955 0000068B C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   956                                  
   957 0000068E BF[984F0000]            	mov	edi, fontbuff2 ; start of user font data
   958 00000693 01D7                    	add	edi, edx
   959                                  	
   960                                  	;; NOTE: Following system call writes fonts at
   961                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   962                                  	;; screen width as 640 pixels (instead of 320 pixels)
   963                                  	;; so 8Fh is sub function 0Fh (write char)
   964                                  	;; with 640 pixels screen witdh. 
   965                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   966                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   967                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   968                                  	;; region, the text is appeared on screen
   969                                  	;; while LFB is at C0000000h or E0000000h.)
   970                                  
   971                                  	;sys	_video, 018Fh, [tcolor], 8001h
   972                                  			;; use STD VGA video memory
   973                                  			;; (0A0000h)
   974                                  	;sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
   975                                  		 ; use LFB for current VBE mode
   976                                  		 ; for writing fonts on screen
   977                                  	; 26/12/2024
   978                                  	sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000695 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000069A B90F000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000069F BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000006A4 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000006A9 CD40                <1>  int 40h
   979                                  
   980 000006AB 45                      	inc	ebp
   981 000006AC 6683C608                	add	si, 8 ; next char pos
   982 000006B0 FE0D[EC740000]          	dec	byte [columns]
   983 000006B6 75CA                    	jnz	short p_d_x_n	; next column
   984 000006B8 6631F6                  	xor	si, si
   985                                  	;;add	esi, 00100000h	; next row ; 8*16
   986                                  	;add	esi, [nextrow]
   987 000006BB 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   988 000006C1 EBB8                    	jmp	short p_d_x
   989                                  p_d_x_ok:
   990 000006C3 C3                      	retn
   991                                  
   992                                  ; -------------------------------------------------------------
   993                                  
   994                                  	; 21/12/2024
   995                                  set_text_mode:
   996 000006C4 30E4                    	xor    ah, ah
   997 000006C6 B003                    	mov    al, 3                        
   998                                   	;int   10h ; al = 03h text mode, int 10 video
   999 000006C8 CD31                    	int    31h ; TRDOS 386 - Video interrupt
  1000 000006CA C3                      	retn
  1001                                  
  1002                                  ; -------------------------------------------------------------
  1003                                  
  1004                                  	; 07/12/2024 (playwav9.s)
  1005                                  	; 26/11/2023 (playwav8.s)
  1006                                  PlayWav:
  1007                                  	; 19/11/2024
  1008 000006CB C605[F37E0000]01        	mov	byte [wleds], 1
  1009                                  
  1010                                  	;;;
  1011                                  	; 09/12/2024
  1012 000006D2 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
  1013 000006D7 803D[FE7E0000]00        	cmp	byte [VRA], 0
  1014 000006DE 7614                    	jna	short _3 ; 48kHZ (interpolation)
  1015                                  	;;;
  1016                                  	; 01/12/2024 (32bit)
  1017                                  	;movzx	eax, word [WAVE_SampleRate]
  1018                                  	; 09/12/2024
  1019 000006E0 66A1[1C7F0000]          	mov	ax, [WAVE_SampleRate]
  1020 000006E6 B90A000000              	mov	ecx, 10
  1021 000006EB F7E1                    	mul	ecx
  1022 000006ED B1B6                    	mov	cl, 182
  1023 000006EF F7F1                    	div	ecx
  1024                                  	; ax = samples per 1/18.2 second
  1025                                  	;mov	cl, byte [WAVE_BlockAlign]
  1026                                  	; 09/12/2024 
  1027                                  	;mov	cl, 4 ; 16 bit, stereo
  1028                                  	;mul	ecx
  1029 000006F1 C1E002                  	shl	eax, 2 ; * 4
  1030                                  _3:
  1031 000006F4 A3[F47E0000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
  1032                                  				; for wave volume leds update
  1033                                  				; (byte stream per 1/18.2 second)
  1034                                  	;;;
  1035                                  	; 24/12/2024
  1036 000006F9 3D000A0000              	cmp	eax, 640*4 ; 640 samples (for 640 wave light points)
  1037 000006FE 7305                    	jnb	short _4
  1038 00000700 B8000A0000              	mov	eax, 640*4	
  1039                                  _4:
  1040 00000705 A3[D8740000]            	mov	[wpoints_dif], eax
  1041                                  	;;;
  1042                                  
  1043                                  RePlayWav:
  1044                                  	; 07/12/2024
  1045 0000070A BF[00800000]            	mov	edi, audio_buffer
  1046 0000070F FF15[A47F0000]          	call	dword [loadfromwavfile]
  1047 00000715 0F820CFFFFFF            	jc	error_exit
  1048                                  
  1049 0000071B C605[FD7E0000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
  1050                                  
  1051 00000722 A1[B87F0000]            	mov	eax, [count]
  1052 00000727 0105[BC7F0000]          	add	[LoadedDataBytes], eax
  1053                                  
  1054 0000072D F605[327F0000]01        	test    byte [flags], ENDOFFILE  ; end of file
  1055 00000734 752C                    	jnz	short _5 ; yes
  1056                                  			 ; bypass filling dma half buffer 2
  1057                                  
  1058                                  	; bh = 16 : update (current, first) dma half buffer
  1059                                  	; bl = 0  : then switch to the next (second) half buffer
  1060                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000736 BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000073B B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000740 CD40                <1>  int 40h
  1061                                  
  1062                                  	; 18/12/2024
  1063 00000742 C705[B87F0000]0000-     	mov	dword [count], 0
  1063 0000074A 0000               
  1064                                  
  1065                                  	; 07/12/2024
  1066 0000074C BF[00800000]            	mov	edi, audio_buffer
  1067 00000751 FF15[A47F0000]          	call	dword [loadfromwavfile]
  1068                                  	;jc	error_exit
  1069                                  	
  1070 00000757 A1[B87F0000]            	mov	eax, [count]
  1071 0000075C 0105[BC7F0000]          	add	[LoadedDataBytes], eax
  1072                                  _5:
  1073                                  	; 07/12/2024
  1074 00000762 668B0D[1C7F0000]         	mov	cx, [WAVE_SampleRate]
  1075 00000769 B303                    	mov	bl, 3	; 16 bit, stereo
  1076 0000076B B704                    	mov	bh, 4	; start to play
  1077                                  	sys	_audio
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000076D B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000772 CD40                <1>  int 40h
  1078                                  
  1079                                  	;;;
  1080                                  	; 26/12/2024
  1081                                  SplashLoop:
  1082 00000774 803D[71410000]00        	cmp	byte [IsInSplash], 0
  1083 0000077B 7648                    	jna	short _10
  1084                                  	;; skip 1st signal without sound data loading
  1085                                  	;nop
  1086                                  	;nop
  1087                                  	;nop
  1088                                  	;cmp	byte [SRB], 0
  1089                                  	;jna	short SplashLoop
  1090                                  	;mov	byte [SRB], 0
  1091                                  _8:
  1092 0000077D F605[327F0000]01        	test    byte [flags], ENDOFFILE  ; end of file
  1093 00000784 0F856E1B0000            	jnz	ac97_stop ; yes
  1094                                  
  1095                                  	; bh = 16 : update (current, first) dma half buffer
  1096                                  	; bl = 0  : then switch to the next (second) half buffer
  1097                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000078A BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000078F B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000794 CD40                <1>  int 40h
  1098                                  
  1099 00000796 803D[977F0000]00        	cmp	byte [SRB], 0
  1100 0000079D 7619                    	jna	short _9
  1101 0000079F C605[977F0000]00        	mov	byte [SRB], 0
  1102 000007A6 BF[00800000]            	mov	edi, audio_buffer
  1103 000007AB FF15[A47F0000]          	call	dword [loadfromwavfile]
  1104 000007B1 7305                    	jnc	short _9
  1105                                  	; end of file
  1106                                  	;call	ac97_stop
  1107                                  	;retn
  1108 000007B3 E9401B0000              	jmp	ac97_stop
  1109                                  _9:
  1110 000007B8 E8761D0000              	call	check4keyboardstop
  1111 000007BD 0F82B1000000            	jc	_exitt_
  1112 000007C3 EBB8                    	jmp	short _8
  1113                                  _10:
  1114                                  	; 26/12/2024
  1115 000007C5 803D[FF7E0000]00        	cmp	byte [p_mode], 0
  1116 000007CC 7705                    	ja	short tuneLoop
  1117                                  	;;;
  1118                                  
  1119                                  ; -------------------------------------------
  1120                                  
  1121                                  	; 22/12/2024
  1122                                   	; prepare all leds as turned off
  1123 000007CE E8C4200000              	call	reset_wave_leds
  1124                                  
  1125                                  ; -------------------------------------------
  1126                                  
  1127                                  	; 07/12/2024 (playwav9.s)
  1128                                  	; 01/12/2024 (32bit)
  1129                                  	; 29/11/2024
  1130                                  tuneLoop:
  1131                                  	; 30/05/2024
  1132                                  	; 18/11/2023 (ich_wav4.asm)
  1133                                  	; 08/11/2023
  1134                                  	; 06/11/2023
  1135                                  tLWait:
  1136                                  	; 18/11/2024
  1137 000007D3 803D[F07E0000]00        	cmp	byte [stopped], 0
  1138                                  	; 24/11/2024
  1139 000007DA 7641                    	jna	short tL1
  1140                                  
  1141                                  tLWait@:	; 21/11/2024
  1142                                  	;;;
  1143                                  	; 25/12/2024
  1144                                  	; 09/12/2024
  1145 000007DC 803D[F07E0000]03        	cmp	byte [stopped], 3
  1146 000007E3 0F838B000000            	jnb	_exitt_
  1147                                  	;;;
  1148 000007E9 E8461B0000              	call	checkUpdateEvents
  1149 000007EE 0F8280000000            	jc	_exitt_
  1150                                  	;;;
  1151                                  	; 25/12/2024
  1152                                  	; 29/11/2024
  1153 000007F4 803D[007F0000]4E        	cmp	byte [command], 'N'
  1154 000007FB 7477                    	je	_exitt_
  1155 000007FD 803D[007F0000]50        	cmp	byte [command], 'P'
  1156 00000804 746E                    	je	_exitt_
  1157                                  	;;;
  1158 00000806 803D[F17E0000]30        	cmp	byte [tLO], '0'
  1159 0000080D 74C4                    	je	short tLWait
  1160 0000080F E86A000000              	call	tLZ
  1161 00000814 C605[F17E0000]30        	mov	byte [tLO], '0'
  1162 0000081B EBB6                    	jmp	short tLWait
  1163                                  tL1:
  1164                                  	; 27/11/2024
  1165                                  	; Check AC'97 interrupt status
  1166 0000081D 803D[977F0000]00        	cmp	byte [SRB], 0
  1167 00000824 7709                    	ja	short tL3
  1168                                  tL2:
  1169 00000826 E8091B0000              	call	checkUpdateEvents
  1170 0000082B 7247                    	jc	_exitt_
  1171 0000082D EBA4                    	jmp	short tLWait
  1172                                  tL3:
  1173 0000082F 8035[FD7E0000]01        	xor	byte [half_buffer], 1
  1174                                  	; 07/12/2024
  1175 00000836 C605[977F0000]00        	mov	byte [SRB], 0
  1176                                  
  1177                                  	; 07/12/2024
  1178 0000083D BF[00800000]            	mov	edi, audio_buffer
  1179                                  	;call	loadFromFile
  1180                                  	; 18/11/2023
  1181                                  	;call	word [loadfromwavfile]
  1182                                  	; 01/12/2024
  1183 00000842 FF15[A47F0000]          	call	dword [loadfromwavfile]
  1184 00000848 722A                    	jc	short _exitt_	; end of file
  1185                                  
  1186                                  	; 07/12/2024
  1187                                  	;;;;
  1188                                  	; bh = 16 : update (current, first) dma half buffer
  1189                                  	; bl = 0  : then switch to the other half buffer
  1190                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000084A BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000084F B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000854 CD40                <1>  int 40h
  1191                                  	;;;;
  1192                                  
  1193                                  	; 26/11/2024
  1194 00000856 A0[FD7E0000]            	mov	al, [half_buffer]
  1195 0000085B 0431                    	add	al, '1'
  1196                                  	; 19/11/2024
  1197 0000085D A2[F17E0000]            	mov	[tLO], al
  1198 00000862 E819000000              	call	tL0
  1199                                  
  1200                                  	; 24/11/2024
  1201                                  	; 14/11/2024
  1202                                  	;mov	ax, [count]
  1203                                  	;add	[LoadedDataBytes], ax
  1204                                  	;adc	word [LoadedDataBytes+2], 0
  1205                                  	; 01/12/2024
  1206 00000867 A1[B87F0000]            	mov	eax, [count]
  1207 0000086C 0105[BC7F0000]          	add	[LoadedDataBytes], eax
  1208                                  
  1209                                  	; 07/12/2024 (playwav9.s)
  1210                                  	; 27/11/2024 (playwav9.asm)
  1211 00000872 EBB2                    	jmp	short tL2
  1212                                  
  1213                                  _exitt_:
  1214                                  	; 07/12/2024
  1215                                  	; Stop Playing
  1216                                  	;mov	byte [stopped], 2
  1217                                  	;sys	_audio, 0700h
  1218 00000874 E87F1A0000              	call	ac97_stop
  1219                                  
  1220                                  	;;;
  1221                                  	; 14/11/2024
  1222 00000879 E8171F0000              	call	UpdateProgressBar
  1223                                  	;;;
  1224                                  
  1225                                  	; 18/11/2024
  1226                                  tLZ:
  1227                                  	; 30/05/2024
  1228 0000087E B030                    	mov	al, '0'
  1229                                  
  1230                                  	;add	al, '0'
  1231                                  	;call	tL0
  1232                                  	;
  1233                                  	;retn
  1234                                  	; 06/11/2023
  1235                                  	;jmp	short tL0
  1236                                  	;retn
  1237                                  
  1238                                  	; 06/11/2023
  1239                                  tL0:
  1240                                  	; 29/05/2024 (TRDOS 386)
  1241                                  	; 08/11/2023
  1242                                  	; 05/11/2023
  1243                                  	; 17/02/2017 - Buffer switch test (temporary)
  1244                                  	; 06/11/2023
  1245                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1246                                  
  1247                                  	; 22/12/2024 (graphics mode modification)
  1248                                  	; (640*480, 256 colors)
  1249                                  	;;;
  1250                                  	;mov	ebp, 16
  1251 00000880 BD0E000000              	mov	ebp, 14
  1252 00000885 8B3D[E0740000]          	mov	edi, [LFB_ADDR]
  1253 0000088B 0FB6F0                  	movzx	esi, al
  1254 0000088E C1E604                  	shl	esi, 4 ; * 16
  1255 00000891 81C6[984F0000]          	add	esi, fontbuff2
  1256                                  tL0_1:
  1257 00000897 BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1258 0000089C 8A26                    	mov	ah, [esi]
  1259                                  tL0_2:
  1260 0000089E B00C                    	mov	al, 0Ch ; red
  1261 000008A0 D0E4                    	shl	ah, 1
  1262 000008A2 7302                    	jnc	short tL0_3
  1263 000008A4 B00E                    	mov	al, 0Eh ; yellow
  1264                                  tL0_3:
  1265 000008A6 AA                      	stosb
  1266 000008A7 4A                      	dec	edx
  1267 000008A8 75F4                    	jnz	short tL0_2
  1268 000008AA 4D                      	dec	ebp
  1269 000008AB 7409                    	jz	short tL0_4
  1270 000008AD 81C778020000            	add	edi, 640-8 ; next line
  1271 000008B3 46                      	inc	esi
  1272 000008B4 EBE1                    	jmp	short tL0_1
  1273                                  tL0_4:
  1274                                  	;;;
  1275 000008B6 C3                      	retn
  1276                                  
  1277                                  ; -------------------------------------------
  1278                                  
  1279                                  	; 26/12/2024
  1280                                  	; 07/12/2024
  1281                                  SetMasterVolume:
  1282 000008B7 A0[96250000]            	mov	al, [volume]
  1283                                  	; 26/12/2024
  1284                                  	;mov	[volume], al  ; max = 0, min = 31
  1285                                  
  1286 000008BC B41F                    	mov	ah, 31
  1287 000008BE 28C4                    	sub	ah, al
  1288 000008C0 88E0                    	mov	al, ah
  1289                                  
  1290                                  	; Set Master Volume Level (BL=0 or 80h)
  1291                                  	; 	for next playing (BL>=80h)
  1292                                  	;sys	_audio, 0B80h, eax
  1293                                  	sys	_audio, 0B00h, eax
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008C2 BB000B0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000008C7 89C1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008C9 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000008CE CD40                <1>  int 40h
  1294                                  	
  1295                                  setvolume_ok:
  1296                                  ac97_not_detected:
  1297 000008D0 C3                      	retn
  1298                                  
  1299                                  ; -------------------------------------------
  1300                                  
  1301                                  	; 07/12/2024 (playwav9.s)
  1302                                  DetectAC97:
  1303                                  DetectICH:
  1304                                  	; 25/11/2023 (playwav8.s)
  1305                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1306                                          sys	_audio, 0102h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008D1 BB02010000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008D6 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000008DB CD40                <1>  int 40h
  1307                                  	;jnc	short d_ac97_@
  1308                                  	;retn
  1309 000008DD 72F1                    	jc	short ac97_not_detected
  1310                                  d_ac97_@:
  1311                                  	; 07/12/2024 (playwav9.s)
  1312                                  	; 06/06/2017
  1313                                  	sys	_audio, 0E00h ; get audio controller info
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008DF BB000E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008E4 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000008E9 CD40                <1>  int 40h
  1314 000008EB 0F8236FDFFFF            	jc	error_exit ; 25/11/2023
  1315                                  
  1316                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1317                                  	;jne	_dev_not_ready	
  1318                                  
  1319                                  	; EAX = IRQ Number in AL
  1320                                  	;	Audio Device Number in AH 
  1321                                  	; EBX = DEV/VENDOR ID
  1322                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1323                                  	; ECX = BUS/DEV/FN 
  1324                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1325                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1326                                  	;      (Low word, DX = NAMBAR address)
  1327                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1328                                  
  1329 000008F1 891D[9C7F0000]          	mov	[dev_vendor], ebx
  1330 000008F7 890D[987F0000]          	mov	[bus_dev_fn], ecx
  1331                                  
  1332 000008FD 668915[A07F0000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1333                                  	;shr	edx, 16
  1334                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1335 00000904 8915[A07F0000]          	mov	[NAMBAR], edx
  1336                                  
  1337 0000090A A2[337F0000]            	mov	[ac97_int_ln_reg], al
  1338                                  
  1339                                  	; 07/12/2024
  1340                                  	; 01/06/2024
  1341                                  	; 25/11/2023
  1342                                  	; Get AC'97 Codec info
  1343                                  	; (Function 14, sub function 1)
  1344                                  	sys	_audio, 0E01h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000090F BB010E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000914 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000919 CD40                <1>  int 40h
  1345                                  	; Save Variable Rate Audio support bit
  1346 0000091B 2401                    	and	al, 1
  1347 0000091D A2[FE7E0000]            	mov	[VRA], al
  1348                                  
  1349                                  	;clc
  1350                                  
  1351 00000922 C3                      	retn
  1352                                  
  1353                                  ; ----------------------------------
  1354                                  	
  1355                                  	; 26/12/2024
  1356                                  	; 07/12/2024
  1357                                  	; 01/12/2024
  1358                                  	; 14/11/2024
  1359                                  	; INPUT: ds:dx = file name address
  1360                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1361                                  openFile:
  1362                                  	; 26/12/2024
  1363                                  	; 01/12/2024
  1364                                  	sys	_open, edx, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000923 89D3                <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000925 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000092A B805000000          <1>  mov eax, %1
    97                              <1> 
    98 0000092F CD40                <1>  int 40h
  1365                                  	; 07/12/2024
  1366                                  	;sys	_open, wav_file_name, 0
  1367 00000931 7305                    	jnc	short _of1
  1368                                  
  1369 00000933 B8FFFFFFFF              	mov	eax, -1
  1370                                  	; cf = 1 -> not found or access error
  1371                                  _of1:
  1372 00000938 A3[347F0000]            	mov	[filehandle], eax
  1373 0000093D C3                      	retn
  1374                                  
  1375                                  ; ----------------------------------
  1376                                  
  1377                                  ; close the currently open file
  1378                                  
  1379                                  	; 01/12/2024
  1380                                  	; 14/11/2024
  1381                                  	; INPUT: [filehandle] ; -1 = not open
  1382                                  	; OUTPUT: none
  1383                                  closeFile:
  1384 0000093E 833D[347F0000]FF        	cmp	dword [filehandle], -1
  1385 00000945 740D                    	jz	short _cf1
  1386                                  	; 01/12/2024
  1387                                  	sys	_close, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000947 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000094D B806000000          <1>  mov eax, %1
    97                              <1> 
    98 00000952 CD40                <1>  int 40h
  1388                                  	;mov 	dword [filehandle], -1
  1389                                  _cf1:
  1390 00000954 C3                      	retn
  1391                                  
  1392                                  ; ----------------------------------
  1393                                  
  1394                                  	; 01/12/2024
  1395                                  	; 14/11/2024 - Erdogan Tan
  1396                                  getWAVParameters:
  1397                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1398                                  ; entry: none - assumes file is already open
  1399                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1400                                  ;	cx = number of channels (mono=1, stereo=2)
  1401                                  ;	dx = bits per sample (8, 16)
  1402                                  ;	bx = number of bytes per sample (1 to 4)
  1403                                  
  1404                                          ;mov	dx, WAVFILEHEADERbuff
  1405                                  	;mov	bx, [filehandle]
  1406                                          ;mov	cx, 44			; 44 bytes
  1407                                  	;mov	ah, 3Fh
  1408                                          ;int	21h
  1409                                  	;jc	short gwavp_retn
  1410                                  	; 01/12/2024 (TRDOS 386)
  1411                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000955 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000095B B9[047F0000]        <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000960 BA2C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000965 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000096A CD40                <1>  int 40h
  1412 0000096C 721C                    	jc	short gwavp_retn
  1413                                  
  1414 0000096E 83F82C                  	cmp	eax, 44
  1415 00000971 7217                    	jb	short gwavp_retn
  1416                                  
  1417 00000973 813D[0C7F0000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1417 0000097B 5645               
  1418 0000097D 750A                    	jne	short gwavp_stc_retn
  1419                                  
  1420 0000097F 66833D[187F0000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1421                                  	;jne	short gwavp_stc_retn
  1422 00000987 7401                    	je	short gwavp_retn ; 15/11/2024
  1423                                  
  1424                                  	; 15/11/2024
  1425                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1426                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1427                                  	;mov	dx, [WAVE_BitsPerSample] 
  1428                                  					; return bits per sample value in DX
  1429                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1430                                  ;gwavp_retn:
  1431                                          ;retn
  1432                                  
  1433                                  gwavp_stc_retn:
  1434 00000989 F9                      	stc
  1435                                  gwavp_retn:
  1436 0000098A C3                      	retn
  1437                                  
  1438                                  ; --------------------------------------------------------
  1439                                  ; 07/12/2024
  1440                                  ; --------------------------------------------------------
  1441                                  ; ref: playwav8.s (04/06/2024)
  1442                                  
  1443                                  audio_int_handler:
  1444                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1445                                  
  1446                                  	; 07/12/2024
  1447                                  	;mov	al, [stopped]
  1448                                  	;cmp	al, 2
  1449                                  	;je	short _callback_retn
  1450                                  
  1451                                  	; 18/08/2020
  1452                                  	;mov	byte [SRB], 1
  1453                                  	; 07/12/2024
  1454 0000098B FE05[977F0000]          	inc	byte [SRB]
  1455                                  
  1456                                  ;_callback_retn:
  1457                                  	sys	_rele ; return from callback service 
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000991 B827000000          <1>  mov eax, %1
    97                              <1> 
    98 00000996 CD40                <1>  int 40h
  1458                                  	; we must not come here !
  1459                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000998 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 0000099D CD40                <1>  int 40h
  1460                                  
  1461                                  ; --------------------------------------------------------
  1462                                  ; 07/12/2024
  1463                                  ; --------------------------------------------------------
  1464                                  
  1465                                  ; /////
  1466                                  	; 14/12/2024
  1467                                  	; 07/12/2024
  1468                                  	; 01/12/2024
  1469                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1470                                  loadFromFile:
  1471                                  	; 07/11/2023
  1472                                  
  1473 0000099F F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1474                                  					; last of the file?
  1475 000009A6 7402                    	jz	short lff_0		; no
  1476 000009A8 F9                      	stc
  1477 000009A9 C3                      	retn
  1478                                  
  1479                                  lff_0:
  1480                                  	; 07/12/2024
  1481                                  	; 26/11/2023 (playwav8.s)
  1482                                  	;mov	edi, audio_buffer
  1483                                  
  1484                                  	; 01/12/2024 (TRDOS 386)
  1485                                  	; edi = audio buffer address
  1486                                  
  1487                                  	; 14/12/2024
  1488                                  	; 01/12/2024
  1489                                  	; 17/11/2024
  1490                                  	;mov	ebx, [filehandle]
  1491                                  	; 02/12/2024
  1492                                  	;mov	edx, [loadsize] 
  1493                                  
  1494                                  	; 17/11/2024
  1495 000009AA 803D[967F0000]00        	cmp	byte [fbs_shift], 0
  1496 000009B1 7677                    	jna	short lff_1 ; stereo, 16 bit
  1497                                  
  1498                                  lff_2:
  1499                                  	; 01/12/2024
  1500 000009B3 BE[00800100]            	mov	esi, temp_buffer 
  1501                                  	; 14/12/2024
  1502                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000009B8 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000009BE 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000009C0 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000009C6 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000009CB CD40                <1>  int 40h
  1503 000009CD 0F8289000000            	jc	lff_4 ; error !
  1504                                  
  1505                                  	; 01/12/2024
  1506                                  	; 14/11/2024
  1507 000009D3 A3[B87F0000]            	mov	[count], eax
  1508                                  
  1509                                  	; 01/12/2024
  1510 000009D8 21C0                    	and	eax, eax
  1511                                  	;jz	short lff_3
  1512                                  	; 14/12/2024
  1513 000009DA 0F8485000000            	jz	lff_10
  1514                                  
  1515 000009E0 8A1D[967F0000]          	mov	bl, [fbs_shift]
  1516                                  
  1517                                  	; 14/12/2024
  1518 000009E6 89FA                    	mov	edx, edi ; audio buffer start address
  1519                                  
  1520                                  	; 01/12/2024
  1521 000009E8 89C1                    	mov	ecx, eax
  1522 000009EA 803D[267F0000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1523 000009F1 751E                    	jne	short lff_7 ; 16 bit samples
  1524                                  	; 8 bit samples
  1525 000009F3 FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1526 000009F5 740E                    	jz	short lff_6 ; 8 bit, stereo
  1527                                  	; 01/12/2024 (32bit registers)
  1528                                  lff_5:
  1529                                  	; mono & 8 bit
  1530 000009F7 AC                      	lodsb
  1531 000009F8 2C80                    	sub	al, 80h ; 08/11/2023
  1532 000009FA C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1533 000009FD 66AB                    	stosw	; left channel
  1534 000009FF 66AB                    	stosw	; right channel
  1535 00000A01 E2F4                    	loop	lff_5
  1536 00000A03 EB16                    	jmp	short lff_9
  1537                                  lff_6:
  1538                                  	; stereo & 8 bit
  1539 00000A05 AC                      	lodsb
  1540 00000A06 2C80                    	sub	al, 80h ; 08/11/2023
  1541 00000A08 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1542 00000A0B 66AB                    	stosw
  1543 00000A0D E2F6                    	loop	lff_6
  1544 00000A0F EB0A                    	jmp	short lff_9
  1545                                  lff_7:
  1546 00000A11 D1E9                    	shr	ecx, 1 ; word count
  1547                                  lff_8:
  1548 00000A13 66AD                    	lodsw
  1549 00000A15 66AB                    	stosw	; left channel
  1550 00000A17 66AB                    	stosw	; right channel
  1551 00000A19 E2F8                    	loop	lff_8
  1552                                  lff_9:
  1553                                  	; 14/12/2024
  1554 00000A1B 89F8                    	mov	eax, edi
  1555 00000A1D 8B0D[AC7F0000]          	mov	ecx, [buffersize] 
  1556 00000A23 01D1                    	add	ecx, edx ; + buffer start address
  1557 00000A25 39C8                    	cmp	eax, ecx	
  1558 00000A27 7225                    	jb	short lff_3
  1559 00000A29 C3                      	retn
  1560                                  	
  1561                                  lff_1:  
  1562                                  	; 07/12/2024
  1563                                  	; 01/12/2024
  1564                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1565                                  	; 14/12/2024
  1566                                  	sys 	_read, [filehandle], edi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000A2A 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000A30 89F9                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000A32 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000A38 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000A3D CD40                <1>  int 40h
  1567                                  	; 07/11/2023
  1568 00000A3F 721B                    	jc	short lff_4 ; error !
  1569                                  
  1570                                  	; 01/12/2024
  1571                                  	; 14/11/2024
  1572 00000A41 A3[B87F0000]            	mov	[count], eax
  1573                                  
  1574                                  	; 02/12/2024
  1575 00000A46 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1576 00000A48 7411                    	je	short endLFF
  1577                                  	; edi = buffer (start) address
  1578 00000A4A 01C7                    	add	edi, eax
  1579 00000A4C 89D1                    	mov	ecx, edx
  1580                                  lff_3:
  1581                                  	;call	padfill			; blank pad the remainder
  1582                                  	; 21/12/2024
  1583                                  padfill:
  1584                                  	; 14/12/2024
  1585                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1586                                  	; 17/11/2024
  1587                                  	;   di = offset (to be filled with ZEROs)
  1588                                  	;   bp = buffer segment
  1589                                  	;   ax = di = number of bytes loaded
  1590                                  	;   cx = buffer size (> loaded bytes)	
  1591                                  	; 07/11/2023
  1592                                  	; 06/11/2023
  1593                                  	; 17/02/2017
  1594                                  	; 01/12/2024
  1595 00000A4E 29C1                    	sub	ecx, eax
  1596                                  	; 01/12/2024
  1597                                  	; 25/11/2024
  1598 00000A50 31C0                    	xor	eax, eax
  1599                                  	; 14/12/2024
  1600 00000A52 F3AA                    	rep	stosb
  1601                                  	; 21/12/2024
  1602                                  	;retn
  1603                                  	; ----------
  1604                                          ;clc				; don't exit with CY yet.
  1605 00000A54 800D[327F0000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1606                                  endLFF:
  1607 00000A5B C3                              retn
  1608                                  lff_4:
  1609                                  	; 08/11/2023
  1610 00000A5C B021                    	mov	al, '!'  ; error
  1611 00000A5E E81DFEFFFF              	call	tL0
  1612                                  
  1613                                  	; 01/12/2024
  1614 00000A63 31C0                    	xor	eax, eax
  1615                                  lff_10:
  1616                                  	; 14/12/2024
  1617 00000A65 8B0D[AC7F0000]          	mov	ecx, [buffersize]
  1618 00000A6B EBE1                    	jmp	short lff_3
  1619                                  
  1620                                  ; /////
  1621                                  
  1622                                  ; --------------------------------------------------------
  1623                                  ; --------------------------------------------------------
  1624                                  	
  1625                                  write_audio_dev_info:
  1626                                  	; 30/05/2024
  1627                                       	;sys_msg msgAudioCardInfo, 0Fh
  1628                                  	; 01/12/2024
  1629                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000A6D BB[662A0000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000A72 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000A77 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000A7C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000A81 CD40                <1>  int 40h
  1630 00000A83 C3                      	retn
  1631                                  
  1632                                  ; --------------------------------------------------------
  1633                                  
  1634                                  write_ac97_pci_dev_info:
  1635                                  	; 19/11/2024
  1636                                  	; 30/05/2024
  1637                                  	; 06/06/2017
  1638                                  	; 03/06/2017
  1639                                  	; BUS/DEV/FN
  1640                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1641                                  	; DEV/VENDOR
  1642                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1643                                  
  1644 00000A84 A1[9C7F0000]            	mov	eax, [dev_vendor]
  1645 00000A89 31DB                    	xor	ebx, ebx
  1646 00000A8B 88C3                    	mov	bl, al
  1647 00000A8D 88DA                    	mov	dl, bl
  1648 00000A8F 80E30F                  	and	bl, 0Fh
  1649 00000A92 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1650 00000A98 A2[D32B0000]            	mov	[msgVendorId+3], al
  1651 00000A9D 88D3                    	mov	bl, dl
  1652 00000A9F C0EB04                  	shr	bl, 4
  1653 00000AA2 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1654 00000AA8 A2[D22B0000]            	mov	[msgVendorId+2], al
  1655 00000AAD 88E3                    	mov	bl, ah
  1656 00000AAF 88DA                    	mov	dl, bl
  1657 00000AB1 80E30F                  	and	bl, 0Fh
  1658 00000AB4 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1659 00000ABA A2[D12B0000]            	mov	[msgVendorId+1], al
  1660 00000ABF 88D3                    	mov	bl, dl
  1661 00000AC1 C0EB04                  	shr	bl, 4
  1662 00000AC4 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1663 00000ACA A2[D02B0000]            	mov	[msgVendorId], al
  1664 00000ACF C1E810                  	shr	eax, 16
  1665 00000AD2 88C3                    	mov	bl, al
  1666 00000AD4 88DA                    	mov	dl, bl
  1667 00000AD6 80E30F                  	and	bl, 0Fh
  1668 00000AD9 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1669 00000ADF A2[E42B0000]            	mov	[msgDevId+3], al
  1670 00000AE4 88D3                    	mov	bl, dl
  1671 00000AE6 C0EB04                  	shr	bl, 4
  1672 00000AE9 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1673 00000AEF A2[E32B0000]            	mov	[msgDevId+2], al
  1674 00000AF4 88E3                    	mov	bl, ah
  1675 00000AF6 88DA                    	mov	dl, bl
  1676 00000AF8 80E30F                  	and	bl, 0Fh
  1677 00000AFB 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1678 00000B01 A2[E22B0000]            	mov	[msgDevId+1], al
  1679 00000B06 88D3                    	mov	bl, dl
  1680 00000B08 C0EB04                  	shr	bl, 4
  1681 00000B0B 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1682 00000B11 A2[E12B0000]            	mov	[msgDevId], al
  1683                                  
  1684 00000B16 A1[987F0000]            	mov	eax, [bus_dev_fn]
  1685 00000B1B C1E808                  	shr	eax, 8
  1686 00000B1E 88C3                    	mov	bl, al
  1687 00000B20 88DA                    	mov	dl, bl
  1688 00000B22 80E307                  	and	bl, 7 ; bit 0,1,2
  1689 00000B25 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1690 00000B2B A2[092C0000]            	mov	[msgFncNo+1], al
  1691 00000B30 88D3                    	mov	bl, dl
  1692 00000B32 C0EB03                  	shr	bl, 3
  1693 00000B35 88DA                    	mov	dl, bl
  1694 00000B37 80E30F                  	and	bl, 0Fh
  1695 00000B3A 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1696 00000B40 A2[FB2B0000]            	mov	[msgDevNo+1], al
  1697 00000B45 88D3                    	mov	bl, dl
  1698 00000B47 C0EB04                  	shr	bl, 4
  1699 00000B4A 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1700 00000B50 A2[FA2B0000]            	mov	[msgDevNo], al
  1701 00000B55 88E3                    	mov	bl, ah
  1702 00000B57 88DA                    	mov	dl, bl
  1703 00000B59 80E30F                  	and	bl, 0Fh
  1704 00000B5C 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1705 00000B62 A2[EF2B0000]            	mov	[msgBusNo+1], al
  1706 00000B67 88D3                    	mov	bl, dl
  1707 00000B69 C0EB04                  	shr	bl, 4
  1708 00000B6C 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1709 00000B72 A2[EE2B0000]            	mov	[msgBusNo], al
  1710                                  
  1711                                  	;mov	ax, [ac97_NamBar]
  1712 00000B77 66A1[A07F0000]          	mov	ax, [NAMBAR]
  1713 00000B7D 88C3                    	mov	bl, al
  1714 00000B7F 88DA                    	mov	dl, bl
  1715 00000B81 80E30F                  	and	bl, 0Fh
  1716 00000B84 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1717 00000B8A A2[192C0000]            	mov	[msgNamBar+3], al
  1718 00000B8F 88D3                    	mov	bl, dl
  1719 00000B91 C0EB04                  	shr	bl, 4
  1720 00000B94 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1721 00000B9A A2[182C0000]            	mov	[msgNamBar+2], al
  1722 00000B9F 88E3                    	mov	bl, ah
  1723 00000BA1 88DA                    	mov	dl, bl
  1724 00000BA3 80E30F                  	and	bl, 0Fh
  1725 00000BA6 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1726 00000BAC A2[172C0000]            	mov	[msgNamBar+1], al
  1727 00000BB1 88D3                    	mov	bl, dl
  1728 00000BB3 C0EB04                  	shr	bl, 4
  1729 00000BB6 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1730 00000BBC A2[162C0000]            	mov	[msgNamBar], al
  1731                                  
  1732                                  	;mov	ax, [ac97_NabmBar]
  1733 00000BC1 66A1[A27F0000]          	mov	ax, [NABMBAR]
  1734 00000BC7 88C3                    	mov	bl, al
  1735 00000BC9 88DA                    	mov	dl, bl
  1736 00000BCB 80E30F                  	and	bl, 0Fh
  1737 00000BCE 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1738 00000BD4 A2[292C0000]            	mov	[msgNabmBar+3], al
  1739 00000BD9 88D3                    	mov	bl, dl
  1740 00000BDB C0EB04                  	shr	bl, 4
  1741 00000BDE 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1742 00000BE4 A2[282C0000]            	mov	[msgNabmBar+2], al
  1743 00000BE9 88E3                    	mov	bl, ah
  1744 00000BEB 88DA                    	mov	dl, bl
  1745 00000BED 80E30F                  	and	bl, 0Fh
  1746 00000BF0 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1747 00000BF6 A2[272C0000]            	mov	[msgNabmBar+1], al
  1748 00000BFB 88D3                    	mov	bl, dl
  1749 00000BFD C0EB04                  	shr	bl, 4
  1750 00000C00 8A83[8C2B0000]          	mov	al, [hex_chars+ebx]
  1751 00000C06 A2[262C0000]            	mov	[msgNabmBar], al
  1752                                  
  1753 00000C0B 31C0                    	xor	eax, eax
  1754 00000C0D A0[337F0000]            	mov	al, [ac97_int_ln_reg]
  1755 00000C12 B10A                    	mov	cl, 10
  1756 00000C14 F6F1                    	div	cl
  1757                                  	; 23/11/2024
  1758                                  	;add	[msgIRQ], ax
  1759 00000C16 66053030                	add	ax, 3030h
  1760 00000C1A 66A3[322C0000]          	mov	[msgIRQ], ax
  1761                                  	;and	al, al
  1762 00000C20 3C30                    	cmp	al, 30h
  1763 00000C22 750D                    	jnz	short _w_ac97imsg_
  1764 00000C24 A0[332C0000]            	mov	al, byte [msgIRQ+1]
  1765 00000C29 B420                    	mov	ah, ' '
  1766 00000C2B 66A3[322C0000]          	mov	[msgIRQ], ax
  1767                                  _w_ac97imsg_:
  1768                                  	; 19/11/2024
  1769 00000C31 E8461C0000              	call 	clear_window
  1770 00000C36 B60D                    	mov	dh, 13
  1771 00000C38 B200                    	mov	dl, 0
  1772 00000C3A E858190000              	call	setCursorPosition
  1773                                  	;;;
  1774                                  	; 21/12/2024
  1775 00000C3F BD[9D2B0000]            	mov	ebp, msgAC97Info ; message
  1776                                  	; 22/12/2024
  1777                                  	;mov	cl, 07h ; color 
  1778 00000C44 E81F000000              	call	sys_gmsg
  1779                                  	;
  1780                                  	; 30/05/2024
  1781                                  write_VRA_info:
  1782                                  	; 21/12/2024
  1783 00000C49 BD[372C0000]            	mov	ebp, msgVRAheader ; message
  1784                                  	;mov	cl, 07h ; color 
  1785 00000C4E E815000000              	call	sys_gmsg
  1786                                  	;
  1787 00000C53 803D[FE7E0000]00        	cmp	byte [VRA], 0
  1788 00000C5A 7607                    	jna	short _w_VRAi_no
  1789                                  _w_VRAi_yes:
  1790 00000C5C BD[462C0000]            	mov	ebp, msgVRAyes
  1791 00000C61 EB05                    	jmp	short _w_VRAi_yn_msg
  1792                                  _w_VRAi_no:
  1793 00000C63 BD[4C2C0000]            	mov	ebp, msgVRAno
  1794                                  _w_VRAi_yn_msg:
  1795                                  	;mov	cl, 07h ; color 
  1796                                  	;call	sys_msg
  1797                                  	;retn
  1798                                  	;jmp	short sys_gmsg
  1799                                  	;;;
  1800                                  ; --------------------------------------------------------
  1801                                  
  1802                                  	; 22/12/2024
  1803                                  	;;;
  1804                                  	; 21/12/2024
  1805                                  	; (write message in VGA/VESA-VBE mode)
  1806                                  sys_gmsg:
  1807 00000C68 8A4500                  	mov	al, [ebp]
  1808 00000C6B 20C0                    	and	al, al
  1809 00000C6D 7458                    	jz	short sys_gmsg_ok
  1810 00000C6F 3C20                    	cmp	al, 20h
  1811 00000C71 731E                    	jnb	short sys_gmsg_3
  1812 00000C73 3C0D                    	cmp	al, CR ; 13
  1813 00000C75 750C                    	jne	short sys_gmsg_2
  1814                                  	; carriege return, move cursor to column 0
  1815 00000C77 66C705[E4740000]00-     	mov	word [screenpos], 0
  1815 00000C7F 00                 
  1816                                  sys_gmsg_1:
  1817 00000C80 45                      	inc	ebp
  1818 00000C81 EBE5                    	jmp	short sys_gmsg
  1819                                  sys_gmsg_2:
  1820 00000C83 3C0A                    	cmp	al, LF ; 10
  1821 00000C85 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1822                                  	; line feed, move cursor to next row
  1823 00000C87 668305[E6740000]10      	add	word [screenpos+2], 16
  1824 00000C8F EBEF                    	jmp	short sys_gmsg_1
  1825                                  sys_gmsg_3:
  1826 00000C91 8B35[E4740000]          	mov	esi, [screenpos]
  1827                                  		; hw = (cursor) row
  1828                                  		; si = (cursor) column
  1829 00000C97 B907000000              	mov	ecx, 07h ; gray (light)
  1830 00000C9C E8AF1A0000              	call	write_character
  1831 00000CA1 83C608                  	add	esi, 8
  1832                                  	;;;
  1833 00000CA4 6681FE8002              	cmp	si, 640
  1834 00000CA9 7213                    	jb	short sys_gmsg_5
  1835 00000CAB C1EE10                  	shr	esi, 16
  1836 00000CAE 6683C610                	add	si, 16
  1837 00000CB2 6681FEE001              	cmp	si, 480
  1838 00000CB7 7202                    	jb	short sys_gmsg_4
  1839 00000CB9 31F6                    	xor	esi, esi
  1840                                  sys_gmsg_4:
  1841 00000CBB C1E610                  	shl	esi, 16
  1842                                  	;;;
  1843                                  sys_gmsg_5:
  1844 00000CBE 8935[E4740000]          	mov	[screenpos], esi
  1845 00000CC4 45                      	inc	ebp
  1846 00000CC5 EBA1                    	jmp	short sys_gmsg
  1847                                  sys_gmsg_ok:
  1848 00000CC7 C3                      	retn
  1849                                  	;;;
  1850                                  
  1851                                  ; --------------------------------------------------------
  1852                                  
  1853                                  ; 07/12/2024 - playwav9.s
  1854                                  ; 01/12/2024 - ac97play.s
  1855                                  ; 29/05/2024
  1856                                  ; 26/11/2023
  1857                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1858                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1859                                  ; 14/11/2023
  1860                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1861                                  ; --------------------------------------------------------
  1862                                  
  1863                                  ;;Note:	At the end of every buffer load,
  1864                                  ;;	during buffer switch/swap, there will be discontinuity
  1865                                  ;;	between the last converted sample and the 1st sample
  1866                                  ;;	of the next buffer.
  1867                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1868                                  ;;	-To avoid this defect, the 1st sample of
  1869                                  ;;	the next buffer may be read from the wav file but
  1870                                  ;;	the file pointer would need to be set to 1 sample back
  1871                                  ;;	again via seek system call. Time comsumption problem! -
  1872                                  ;;
  1873                                  ;;	Erdogan Tan - 15/11/2023
  1874                                  ;;
  1875                                  ;;	((If entire wav data would be loaded at once.. conversion
  1876                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1877                                  ;;	64KB buffer limit is important also it is important
  1878                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1879                                  ;;	I have tested this program by using 2-30MB wav files.))
  1880                                  ;;
  1881                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1882                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1883                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1884                                  ;;			Realtek ALC850 codec.
  1885                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1886                                  
  1887                                  load_8khz_mono_8_bit:
  1888                                  	; 15/11/2023
  1889                                  	; 14/11/2023
  1890                                  	; 13/11/2023
  1891 00000CC8 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1892                                  					; last of the file?
  1893 00000CCF 7402                    	jz	short lff8m_0		; no
  1894 00000CD1 F9                      	stc
  1895 00000CD2 C3                      	retn
  1896                                  
  1897                                  lff8m_0:
  1898                                  	; 01/12/2024
  1899                                  	; edi = audio buffer address
  1900 00000CD3 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1901                                          ;mov	edx, [loadsize]
  1902                                  
  1903                                  	; esi = buffer address
  1904                                  	;; edx = buffer size
  1905                                  
  1906                                  	; load file into memory
  1907                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000CD8 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000CDE 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000CE0 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000CE6 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000CEB CD40                <1>  int 40h
  1908 00000CED 7305                    	jnc	short lff8m_6
  1909 00000CEF E9AF000000              	jmp	lff8m_5  ; error !
  1910                                  
  1911                                  lff8m_6:
  1912                                  	; 01/12/2024
  1913 00000CF4 A3[B87F0000]            	mov	[count], eax
  1914                                  	;;;
  1915                                  	; 07/12/2024
  1916                                  	;mov	edi, audio_buffer
  1917                                  	;;;
  1918 00000CF9 21C0                    	and	eax, eax
  1919 00000CFB 0F8499000000            	jz	lff8_eof
  1920                                  
  1921 00000D01 89C1                    	mov	ecx, eax		; byte count
  1922                                  lff8m_1:
  1923 00000D03 AC                      	lodsb
  1924 00000D04 A2[EF220000]            	mov	[previous_val], al
  1925 00000D09 2C80                    	sub	al, 80h
  1926 00000D0B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1927 00000D0F 66AB                    	stosw		; original sample (left channel)
  1928 00000D11 66AB                    	stosw		; original sample (right channel)
  1929                                  	;xor	eax, eax
  1930 00000D13 B080                    	mov	al, 80h
  1931 00000D15 49                      	dec	ecx
  1932 00000D16 7402                    	jz	short lff8m_2
  1933 00000D18 8A06                    	mov	al, [esi]
  1934                                  lff8m_2:
  1935                                  	;mov	[next_val], ax
  1936 00000D1A 88C7                    	mov	bh, al	; [next_val]
  1937 00000D1C 8A25[EF220000]          	mov	ah, [previous_val]
  1938 00000D22 00E0                    	add	al, ah	; [previous_val]
  1939 00000D24 D0D8                    	rcr	al, 1
  1940 00000D26 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1941 00000D28 00E0                    	add	al, ah	; [previous_val]
  1942 00000D2A D0D8                    	rcr	al, 1	
  1943 00000D2C 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1944 00000D2E 00E0                    	add	al, ah	; [previous_val]
  1945 00000D30 D0D8                    	rcr	al, 1
  1946 00000D32 2C80                    	sub	al, 80h
  1947 00000D34 66C1E008                	shl	ax, 8	
  1948 00000D38 66AB                    	stosw		; this is 1st interpolated sample (L)
  1949 00000D3A 66AB                    	stosw		; this is 1st interpolated sample (R)
  1950 00000D3C 88D8                    	mov	al, bl
  1951 00000D3E 00D0                    	add	al, dl
  1952 00000D40 D0D8                    	rcr	al, 1
  1953 00000D42 2C80                    	sub	al, 80h
  1954 00000D44 66C1E008                	shl	ax, 8
  1955 00000D48 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1956 00000D4A 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1957 00000D4C 88D0                    	mov	al, dl
  1958 00000D4E 2C80                    	sub	al, 80h
  1959 00000D50 66C1E008                	shl	ax, 8
  1960 00000D54 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1961 00000D56 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1962                                  	;mov	al, [next_val]
  1963 00000D58 88F8                    	mov	al, bh
  1964 00000D5A 00D0                    	add	al, dl
  1965 00000D5C D0D8                    	rcr	al, 1
  1966 00000D5E 88C3                    	mov	bl, al	; this is temporary interpolation value
  1967 00000D60 00D0                    	add	al, dl
  1968 00000D62 D0D8                    	rcr	al, 1
  1969 00000D64 2C80                    	sub	al, 80h
  1970 00000D66 66C1E008                	shl	ax, 8
  1971 00000D6A 66AB                    	stosw		; this is 4th interpolated sample (L)
  1972 00000D6C 66AB                    	stosw		; this is 4th interpolated sample (R)
  1973                                  	;mov	al, [next_val]
  1974 00000D6E 88F8                    	mov	al, bh
  1975 00000D70 00D8                    	add	al, bl
  1976 00000D72 D0D8                    	rcr	al, 1
  1977 00000D74 2C80                    	sub	al, 80h
  1978 00000D76 66C1E008                	shl	ax, 8
  1979 00000D7A 66AB                    	stosw		; this is 5th interpolated sample (L)
  1980 00000D7C 66AB                    	stosw		; this is 5th interpolated sample (R)
  1981                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1982 00000D7E 09C9                    	or	ecx, ecx
  1983 00000D80 7581                    	jnz	short lff8m_1
  1984                                  
  1985                                  	; --------------
  1986                                  
  1987                                  lff8s_3:
  1988                                  lff8m_3:
  1989                                  lff8s2_3:
  1990                                  lff8m2_3:
  1991                                  lff16s_3:
  1992                                  lff16m_3:
  1993                                  lff16s2_3:
  1994                                  lff16m2_3:
  1995                                  lff24_3:
  1996                                  lff32_3:
  1997                                  lff44_3:
  1998                                  lff22_3:
  1999                                  lff11_3:
  2000                                  	; 08/12/2024 (BugFix)
  2001                                  	; 31/05/2024 (BugFix)
  2002 00000D82 8B0D[AC7F0000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  2003                                  	;shl	ecx, 1	; byte count ; Bug !
  2004                                  	; 08/12/2024
  2005 00000D88 81C1[00800000]          	add	ecx, audio_buffer
  2006 00000D8E 29F9                    	sub	ecx, edi
  2007 00000D90 7607                    	jna	short lff8m_4
  2008                                  	;inc	ecx
  2009 00000D92 C1E902                  	shr	ecx, 2
  2010 00000D95 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  2011 00000D97 F3AB                    	rep	stosd
  2012                                  lff8m_4:
  2013                                  	; 31/05/2024 (BugFix)
  2014                                  	; cf=1 ; Bug !
  2015                                  	; 08/12/2024
  2016                                  	;clc
  2017 00000D99 C3                      	retn
  2018                                  
  2019                                  lff8_eof:
  2020                                  lff16_eof:
  2021                                  lff24_eof:
  2022                                  lff32_eof:
  2023                                  lff44_eof:
  2024                                  lff22_eof:
  2025                                  lff11_eof:
  2026                                  	; 15/11/2023
  2027 00000D9A C605[327F0000]01        	mov	byte [flags], ENDOFFILE
  2028 00000DA1 EBDF                    	jmp	short lff8m_3
  2029                                  
  2030                                  lff8s_5:
  2031                                  lff8m_5:
  2032                                  lff8s2_5:
  2033                                  lff8m2_5:
  2034                                  lff16s_5:
  2035                                  lff16m_5:
  2036                                  lff16s2_5:
  2037                                  lff16m2_5:
  2038                                  lff24_5:
  2039                                  lff32_5:
  2040                                  lff44_5:
  2041                                  lff22_5:
  2042                                  lff11_5:
  2043 00000DA3 B021                    	mov	al, '!'  ; error
  2044 00000DA5 E8D6FAFFFF              	call	tL0
  2045                                  	
  2046                                  	;jmp	short lff8m_3
  2047                                  	; 15/11/2023
  2048 00000DAA EBEE                    	jmp	lff8_eof
  2049                                  
  2050                                  	; --------------
  2051                                  
  2052                                  load_8khz_stereo_8_bit:
  2053                                  	; 15/11/2023
  2054                                  	; 14/11/2023
  2055                                  	; 13/11/2023
  2056 00000DAC F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2057                                  					; last of the file?
  2058 00000DB3 7402                    	jz	short lff8s_0		; no
  2059 00000DB5 F9                      	stc
  2060 00000DB6 C3                      	retn
  2061                                  
  2062                                  lff8s_0:
  2063                                  	; 01/12/2024
  2064                                  	; edi = audio buffer address
  2065 00000DB7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2066                                          ;mov	edx, [loadsize]
  2067                                  
  2068                                  	; esi = buffer address
  2069                                  	;; edx = buffer size
  2070                                  
  2071                                  	; load file into memory
  2072                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000DBC 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000DC2 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000DC4 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000DCA B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000DCF CD40                <1>  int 40h
  2073 00000DD1 72D0                    	jc	short lff8s_5 ; error !
  2074                                  
  2075                                  	; 01/12/2024
  2076 00000DD3 A3[B87F0000]            	mov	[count], eax
  2077                                  	;;;
  2078                                  	; 07/12/2024
  2079                                  	;mov	edi, audio_buffer
  2080                                  	;;;
  2081 00000DD8 D1E8                    	shr	eax, 1
  2082 00000DDA 74BE                    	jz	short lff8_eof
  2083                                  
  2084 00000DDC 89C1                    	mov	ecx, eax	; word count
  2085                                  lff8s_1:
  2086 00000DDE AC                      	lodsb
  2087 00000DDF A2[EF220000]            	mov	[previous_val_l], al
  2088 00000DE4 2C80                    	sub	al, 80h
  2089 00000DE6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2090 00000DEA 66AB                    	stosw		; original sample (L)
  2091 00000DEC AC                      	lodsb
  2092 00000DED A2[F1220000]            	mov	[previous_val_r], al
  2093 00000DF2 2C80                    	sub	al, 80h
  2094 00000DF4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2095 00000DF8 66AB                    	stosw		; original sample (R)
  2096                                  
  2097                                  	;xor	eax, eax
  2098 00000DFA 66B88080                	mov	ax, 8080h
  2099 00000DFE 49                      	dec	ecx
  2100 00000DFF 7403                    	jz	short lff8s_2
  2101                                  		; convert 8 bit sample to 16 bit sample
  2102 00000E01 668B06                  	mov	ax, [esi]
  2103                                  lff8s_2:
  2104 00000E04 A2[F3220000]            	mov	[next_val_l], al
  2105 00000E09 8825[F5220000]          	mov	[next_val_r], ah
  2106 00000E0F 8A25[EF220000]          	mov	ah, [previous_val_l]
  2107 00000E15 00E0                    	add	al, ah
  2108 00000E17 D0D8                    	rcr	al, 1
  2109 00000E19 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  2110 00000E1B 00E0                    	add	al, ah
  2111 00000E1D D0D8                    	rcr	al, 1
  2112 00000E1F 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  2113 00000E21 00E0                    	add	al, ah
  2114 00000E23 D0D8                    	rcr	al, 1
  2115 00000E25 2C80                    	sub	al, 80h
  2116 00000E27 66C1E008                	shl	ax, 8
  2117 00000E2B 66AB                    	stosw		; this is 1st interpolated sample (L)
  2118 00000E2D A0[F5220000]            	mov	al, [next_val_r]
  2119 00000E32 8A25[F1220000]          	mov	ah, [previous_val_r]
  2120 00000E38 00E0                    	add	al, ah
  2121 00000E3A D0D8                    	rcr	al, 1
  2122 00000E3C 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  2123 00000E3E 00E0                    	add	al, ah
  2124 00000E40 D0D8                    	rcr	al, 1
  2125 00000E42 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  2126 00000E44 00E0                    	add	al, ah
  2127 00000E46 D0D8                    	rcr	al, 1
  2128 00000E48 2C80                    	sub	al, 80h
  2129 00000E4A 66C1E008                	shl	ax, 8
  2130 00000E4E 66AB                    	stosw		; this is 1st interpolated sample (R)
  2131 00000E50 88D8                    	mov	al, bl
  2132 00000E52 00D0                    	add	al, dl
  2133 00000E54 D0D8                    	rcr	al, 1
  2134 00000E56 2C80                    	sub	al, 80h
  2135 00000E58 66C1E008                	shl	ax, 8
  2136 00000E5C 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2137 00000E5E 88F8                    	mov	al, bh
  2138 00000E60 00F0                    	add	al, dh
  2139 00000E62 D0D8                    	rcr	al, 1
  2140 00000E64 2C80                    	sub	al, 80h
  2141 00000E66 66C1E008                	shl	ax, 8
  2142 00000E6A 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2143 00000E6C 88D0                    	mov	al, dl
  2144 00000E6E 2C80                    	sub	al, 80h
  2145 00000E70 66C1E008                	shl	ax, 8
  2146 00000E74 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2147 00000E76 88F0                    	mov	al, dh
  2148 00000E78 2C80                    	sub	al, 80h
  2149 00000E7A 66C1E008                	shl	ax, 8
  2150 00000E7E 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2151 00000E80 A0[F3220000]            	mov	al, [next_val_l]
  2152 00000E85 00D0                    	add	al, dl
  2153 00000E87 D0D8                    	rcr	al, 1
  2154 00000E89 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  2155 00000E8B 00D0                    	add	al, dl
  2156 00000E8D D0D8                    	rcr	al, 1
  2157 00000E8F 2C80                    	sub	al, 80h
  2158 00000E91 66C1E008                	shl	ax, 8
  2159 00000E95 66AB                    	stosw		; this is 4th interpolated sample (L)
  2160 00000E97 A0[F5220000]            	mov	al, [next_val_r]
  2161 00000E9C 00F0                    	add	al, dh
  2162 00000E9E D0D8                    	rcr	al, 1
  2163 00000EA0 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  2164 00000EA2 00F0                    	add	al, dh
  2165 00000EA4 D0D8                    	rcr	al, 1
  2166 00000EA6 2C80                    	sub	al, 80h
  2167 00000EA8 66C1E008                	shl	ax, 8
  2168 00000EAC 66AB                    	stosw		; this is 4th interpolated sample (R)
  2169 00000EAE A0[F3220000]            	mov	al, [next_val_l]
  2170 00000EB3 00D8                    	add	al, bl
  2171 00000EB5 D0D8                    	rcr	al, 1
  2172 00000EB7 2C80                    	sub	al, 80h
  2173 00000EB9 66C1E008                	shl	ax, 8
  2174 00000EBD 66AB                    	stosw		; this is 5th interpolated sample (L)
  2175 00000EBF A0[F5220000]            	mov	al, [next_val_r]
  2176 00000EC4 00F8                    	add	al, bh
  2177 00000EC6 D0D8                    	rcr	al, 1
  2178 00000EC8 2C80                    	sub	al, 80h
  2179 00000ECA 66C1E008                	shl	ax, 8
  2180 00000ECE 66AB                    	stosw		; this is 5th interpolated sample (R)
  2181                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2182 00000ED0 E305                    	jecxz	lff8s_6
  2183 00000ED2 E907FFFFFF              	jmp	lff8s_1
  2184                                  lff8s_6:
  2185 00000ED7 E9A6FEFFFF              	jmp	lff8s_3
  2186                                  
  2187                                  load_8khz_mono_16_bit:
  2188                                  	; 13/11/2023
  2189 00000EDC F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2190                                  					; last of the file?
  2191 00000EE3 7402                    	jz	short lff8m2_0		; no
  2192 00000EE5 F9                      	stc
  2193 00000EE6 C3                      	retn
  2194                                  
  2195                                  lff8m2_0:
  2196                                  	; 01/12/2024
  2197                                  	; edi = audio buffer address
  2198 00000EE7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2199                                          ;mov	edx, [loadsize]
  2200                                  
  2201                                  	; esi = buffer address
  2202                                  	;; edx = buffer size
  2203                                  
  2204                                  	; load file into memory
  2205                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000EEC 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000EF2 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000EF4 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000EFA B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000EFF CD40                <1>  int 40h
  2206 00000F01 0F82A0000000            	jc	lff8m2_7 ; error !
  2207                                  
  2208                                  	; 01/12/2024
  2209 00000F07 A3[B87F0000]            	mov	[count], eax
  2210                                  	;;;
  2211                                  	; 07/12/2024
  2212                                  	;mov	edi, audio_buffer
  2213                                  	;;;
  2214 00000F0C D1E8                    	shr	eax, 1
  2215 00000F0E 7505                    	jnz	short lff8m2_8
  2216 00000F10 E985FEFFFF              	jmp	lff8_eof
  2217                                  
  2218                                  lff8m2_8:
  2219 00000F15 89C1                    	mov	ecx, eax	; word count
  2220                                  lff8m2_1:
  2221 00000F17 66AD                    	lodsw
  2222 00000F19 66AB                    	stosw		; original sample (left channel)
  2223 00000F1B 66AB                    	stosw		; original sample (right channel)
  2224 00000F1D 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2225 00000F20 66A3[EF220000]          	mov	[previous_val], ax
  2226 00000F26 31C0                    	xor	eax, eax
  2227 00000F28 49                      	dec	ecx
  2228 00000F29 7403                    	jz	short lff8m2_2
  2229 00000F2B 668B06                  	mov	ax, [esi]
  2230                                  lff8m2_2:
  2231 00000F2E 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  2232 00000F31 89C5                    	mov	ebp, eax	; [next_val]
  2233 00000F33 660305[EF220000]        	add	ax, [previous_val]
  2234 00000F3A 66D1D8                  	rcr	ax, 1
  2235 00000F3D 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  2236 00000F3F 660305[EF220000]        	add	ax, [previous_val]
  2237 00000F46 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  2238 00000F49 89C3                    	mov	ebx, eax 		
  2239 00000F4B 660305[EF220000]        	add	ax, [previous_val]
  2240 00000F52 66D1D8                  	rcr	ax, 1
  2241 00000F55 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2242 00000F58 66AB                    	stosw		; this is 1st interpolated sample (L)
  2243 00000F5A 66AB                    	stosw		; this is 1st interpolated sample (R)
  2244 00000F5C 89D8                    	mov	eax, ebx
  2245 00000F5E 6601D0                  	add	ax, dx
  2246 00000F61 66D1D8                  	rcr	ax, 1
  2247 00000F64 80EC80                  	sub	ah, 80h
  2248 00000F67 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2249 00000F69 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2250 00000F6B 89D0                    	mov	eax, edx
  2251 00000F6D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2252 00000F70 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2253 00000F72 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2254 00000F74 89E8                    	mov	eax, ebp
  2255 00000F76 6601D0                  	add	ax, dx
  2256 00000F79 66D1D8                  	rcr	ax, 1
  2257 00000F7C 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2258 00000F7E 6601D0                  	add	ax, dx
  2259 00000F81 66D1D8                  	rcr	ax, 1
  2260 00000F84 80EC80                  	sub	ah, 80h
  2261 00000F87 66AB                    	stosw		; this is 4th interpolated sample (L)
  2262 00000F89 66AB                    	stosw		; this is 4th interpolated sample (R)
  2263 00000F8B 89E8                    	mov	eax, ebp
  2264 00000F8D 6601D8                  	add	ax, bx
  2265 00000F90 66D1D8                  	rcr	ax, 1
  2266 00000F93 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2267 00000F96 66AB                    	stosw		; this is 5th interpolated sample (L)
  2268 00000F98 66AB                    	stosw		; this is 5th interpolated sample (R)
  2269                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2270 00000F9A 09C9                    	or	ecx, ecx
  2271 00000F9C 0F8575FFFFFF            	jnz	lff8m2_1
  2272 00000FA2 E9DBFDFFFF              	jmp	lff8m2_3
  2273                                  
  2274                                  lff8m2_7:
  2275                                  lff8s2_7:
  2276 00000FA7 E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2277                                  
  2278                                  load_8khz_stereo_16_bit:
  2279                                  	; 16/11/2023
  2280                                  	; 15/11/2023
  2281                                  	; 13/11/2023
  2282 00000FAC F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2283                                  					; last of the file?
  2284 00000FB3 7402                    	jz	short lff8s2_0		; no
  2285 00000FB5 F9                      	stc
  2286 00000FB6 C3                      	retn
  2287                                  
  2288                                  lff8s2_0:
  2289                                  	; 01/12/2024
  2290                                  	; edi = audio buffer address
  2291 00000FB7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2292                                          ;mov	edx, [loadsize]
  2293                                  
  2294                                  	; esi = buffer address
  2295                                  	;; edx = buffer size
  2296                                  
  2297                                  	; load file into memory
  2298                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000FBC 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000FC2 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000FC4 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000FCA B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000FCF CD40                <1>  int 40h
  2299 00000FD1 72D4                    	jc	short lff8s2_7 ; error !
  2300                                  
  2301                                  	; 01/12/2024
  2302 00000FD3 A3[B87F0000]            	mov	[count], eax
  2303                                  	;;;
  2304                                  	; 07/12/2024
  2305                                  	;mov	edi, audio_buffer
  2306                                  	;;;
  2307 00000FD8 C1E802                  	shr	eax, 2
  2308 00000FDB 7505                    	jnz	short lff8s2_8
  2309 00000FDD E9B8FDFFFF              	jmp	lff8_eof
  2310                                  
  2311                                  lff8s2_8:
  2312 00000FE2 89C1                    	mov	ecx, eax ; dword count
  2313                                  lff8s2_1:
  2314 00000FE4 66AD                    	lodsw
  2315 00000FE6 66AB                    	stosw		; original sample (L)
  2316                                  	; 15/11/2023
  2317 00000FE8 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2318 00000FEB 66A3[EF220000]          	mov	[previous_val_l], ax
  2319 00000FF1 66AD                    	lodsw
  2320 00000FF3 66AB                    	stosw		; original sample (R)
  2321 00000FF5 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2322 00000FF8 66A3[F1220000]          	mov	[previous_val_r], ax
  2323 00000FFE 31D2                    	xor	edx, edx
  2324 00001000 31C0                    	xor	eax, eax
  2325                                  	; 16/11/2023
  2326 00001002 49                      	dec	ecx
  2327 00001003 7407                    	jz	short lff8s2_2
  2328 00001005 668B06                  	mov	ax, [esi]
  2329 00001008 668B5602                	mov	dx, [esi+2]
  2330                                  lff8s2_2:
  2331 0000100C 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2332 0000100F 66A3[F3220000]          	mov	[next_val_l], ax
  2333 00001015 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2334 00001018 668915[F5220000]        	mov	[next_val_r], dx
  2335 0000101F 660305[EF220000]        	add	ax, [previous_val_l]
  2336 00001026 66D1D8                  	rcr	ax, 1
  2337 00001029 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2338 0000102B 660305[EF220000]        	add	ax, [previous_val_l]
  2339 00001032 66D1D8                  	rcr	ax, 1	
  2340 00001035 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2341 00001037 660305[EF220000]        	add	ax, [previous_val_l]
  2342 0000103E 66D1D8                  	rcr	ax, 1
  2343 00001041 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2344 00001044 66AB                    	stosw		; this is 1st interpolated sample (L)
  2345 00001046 66A1[F5220000]          	mov	ax, [next_val_r]
  2346 0000104C 660305[F1220000]        	add	ax, [previous_val_r]
  2347 00001053 66D1D8                  	rcr	ax, 1
  2348 00001056 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2349 00001058 660305[F1220000]        	add	ax, [previous_val_r]
  2350 0000105F 66D1D8                  	rcr	ax, 1
  2351 00001062 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2352 00001063 660305[F1220000]        	add	ax, [previous_val_r]
  2353 0000106A 66D1D8                  	rcr	ax, 1
  2354 0000106D 80EC80                  	sub	ah, 80h
  2355 00001070 66AB                    	stosw		; this is 1st interpolated sample (R)
  2356 00001072 89D8                    	mov	eax, ebx
  2357 00001074 6601D0                  	add	ax, dx
  2358 00001077 66D1D8                  	rcr	ax, 1
  2359 0000107A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2360 0000107D 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2361 0000107F 58                      	pop	eax ; *
  2362 00001080 6601E8                  	add	ax, bp
  2363 00001083 66D1D8                  	rcr	ax, 1
  2364 00001086 80EC80                  	sub	ah, 80h
  2365 00001089 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2366 0000108B 89D0                    	mov	eax, edx
  2367 0000108D 80EC80                  	sub	ah, 80h
  2368 00001090 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2369 00001092 89E8                    	mov	eax, ebp
  2370 00001094 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2371 00001097 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2372 00001099 66A1[F3220000]          	mov	ax, [next_val_l]
  2373 0000109F 6601D0                  	add	ax, dx
  2374 000010A2 66D1D8                  	rcr	ax, 1
  2375 000010A5 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2376 000010A7 6601D0                  	add	ax, dx
  2377 000010AA 66D1D8                  	rcr	ax, 1
  2378 000010AD 80EC80                  	sub	ah, 80h
  2379 000010B0 66AB                    	stosw		; this is 4th interpolated sample (L)
  2380 000010B2 66A1[F5220000]          	mov	ax, [next_val_r]
  2381 000010B8 6601E8                  	add	ax, bp
  2382 000010BB 66D1D8                  	rcr	ax, 1
  2383 000010BE 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2384 000010BF 6601E8                  	add	ax, bp
  2385 000010C2 66D1D8                  	rcr	ax, 1
  2386 000010C5 80EC80                  	sub	ah, 80h
  2387 000010C8 66AB                    	stosw		; this is 4th interpolated sample (R)
  2388 000010CA 66A1[F3220000]          	mov	ax, [next_val_l]
  2389 000010D0 6601D8                  	add	ax, bx
  2390 000010D3 66D1D8                  	rcr	ax, 1
  2391 000010D6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2392 000010D9 66AB                    	stosw		; this is 5th interpolated sample (L)
  2393 000010DB 58                      	pop	eax ; **
  2394 000010DC 660305[F5220000]        	add	ax, [next_val_r]
  2395 000010E3 66D1D8                  	rcr	ax, 1
  2396 000010E6 80EC80                  	sub	ah, 80h
  2397 000010E9 66AB                    	stosw		; this is 5th interpolated sample (R)
  2398                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2399 000010EB E305                    	jecxz	lff8_s2_9
  2400 000010ED E9F2FEFFFF              	jmp	lff8s2_1
  2401                                  lff8_s2_9:
  2402 000010F2 E98BFCFFFF              	jmp	lff8s2_3
  2403                                  
  2404                                  ; .....................
  2405                                  
  2406                                  load_16khz_mono_8_bit:
  2407                                  	; 14/11/2023
  2408                                  	; 13/11/2023
  2409 000010F7 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2410                                  					; last of the file?
  2411 000010FE 7402                    	jz	short lff16m_0		; no
  2412 00001100 F9                      	stc
  2413 00001101 C3                      	retn
  2414                                  
  2415                                  lff16m_0:
  2416                                  	; 01/12/2024
  2417                                  	; edi = audio buffer address
  2418 00001102 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2419                                          ;mov	edx, [loadsize]
  2420                                  
  2421                                  	; esi = buffer address
  2422                                  	;; edx = buffer size
  2423                                  
  2424                                  	; load file into memory
  2425                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001107 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000110D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000110F 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001115 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000111A CD40                <1>  int 40h
  2426 0000111C 7253                    	jc	short lff16m_7 ; error !
  2427                                  
  2428                                  	; 01/12/2024
  2429 0000111E A3[B87F0000]            	mov	[count], eax
  2430                                  	;;;
  2431                                  	; 07/12/2024
  2432                                  	;mov	edi, audio_buffer
  2433                                  	;;;
  2434 00001123 21C0                    	and	eax, eax
  2435 00001125 7505                    	jnz	short lff16m_8
  2436 00001127 E96EFCFFFF              	jmp	lff16_eof
  2437                                  
  2438                                  lff16m_8:
  2439 0000112C 89C1                    	mov	ecx, eax		; byte count
  2440                                  lff16m_1:
  2441 0000112E AC                      	lodsb
  2442                                  	;mov	[previous_val], al
  2443 0000112F 88C3                    	mov	bl, al
  2444 00001131 2C80                    	sub	al, 80h
  2445 00001133 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2446 00001137 66AB                    	stosw		; original sample (left channel)
  2447 00001139 66AB                    	stosw		; original sample (right channel)
  2448                                  	;xor	ax, ax
  2449                                  	; 14/11/22023
  2450 0000113B B080                    	mov	al, 80h
  2451 0000113D 49                      	dec	ecx
  2452 0000113E 7402                    	jz	short lff16m_2
  2453 00001140 8A06                    	mov	al, [esi]
  2454                                  lff16m_2:
  2455                                  	;mov	[next_val], al
  2456 00001142 88C7                    	mov	bh, al
  2457                                  	;add	al, [previous_val]
  2458 00001144 00D8                    	add	al, bl
  2459 00001146 D0D8                    	rcr	al, 1
  2460 00001148 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2461                                  	;add	al, [previous_val]
  2462 0000114A 00D8                    	add	al, bl
  2463 0000114C D0D8                    	rcr	al, 1
  2464 0000114E 2C80                    	sub	al, 80h
  2465 00001150 66C1E008                	shl	ax, 8
  2466 00001154 66AB                    	stosw		; this is 1st interpolated sample (L)
  2467 00001156 66AB                    	stosw		; this is 1st interpolated sample (R)
  2468                                  	;mov	al, [next_val]
  2469 00001158 88F8                    	mov	al, bh
  2470 0000115A 00D0                    	add	al, dl
  2471 0000115C D0D8                    	rcr	al, 1
  2472 0000115E 2C80                    	sub	al, 80h
  2473 00001160 66C1E008                	shl	ax, 8
  2474 00001164 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2475 00001166 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2476                                  	
  2477                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2478 00001168 09C9                    	or	ecx, ecx
  2479 0000116A 75C2                    	jnz	short lff16m_1
  2480 0000116C E911FCFFFF              	jmp	lff16m_3
  2481                                  
  2482                                  lff16m_7:
  2483                                  lff16s_7:
  2484 00001171 E92DFCFFFF              	jmp	lff16m_5  ; error
  2485                                  
  2486                                  load_16khz_stereo_8_bit:
  2487                                  	; 14/11/2023
  2488                                  	; 13/11/2023
  2489 00001176 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2490                                  					; last of the file?
  2491 0000117D 7402                    	jz	short lff16s_0		; no
  2492 0000117F F9                      	stc
  2493 00001180 C3                      	retn
  2494                                  
  2495                                  lff16s_0:
  2496                                  	; 01/12/2024
  2497                                  	; edi = audio buffer address
  2498 00001181 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2499                                          ;mov	edx, [loadsize]
  2500                                  
  2501                                  	; esi = buffer address
  2502                                  	;; edx = buffer size
  2503                                  
  2504                                  	; load file into memory
  2505                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001186 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000118C 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000118E 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001194 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001199 CD40                <1>  int 40h
  2506 0000119B 72D4                    	jc	short lff16s_7 ; error !
  2507                                  
  2508                                  	; 01/12/2024
  2509 0000119D A3[B87F0000]            	mov	[count], eax
  2510                                  	;;;
  2511                                  	; 07/12/2024
  2512                                  	;mov	edi, audio_buffer
  2513                                  	;;;
  2514 000011A2 D1E8                    	shr	eax, 1
  2515 000011A4 7505                    	jnz	short lff16s_8
  2516 000011A6 E9EFFBFFFF              	jmp	lff16_eof
  2517                                  
  2518                                  lff16s_8:
  2519 000011AB 89C1                    	mov	ecx, eax	; word count
  2520                                  lff16s_1:
  2521 000011AD AC                      	lodsb
  2522 000011AE A2[EF220000]            	mov	[previous_val_l], al
  2523 000011B3 2C80                    	sub	al, 80h
  2524 000011B5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2525 000011B9 66AB                    	stosw		; original sample (L)
  2526 000011BB AC                      	lodsb
  2527 000011BC A2[F1220000]            	mov	[previous_val_r], al
  2528 000011C1 2C80                    	sub	al, 80h
  2529 000011C3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2530 000011C7 66AB                    	stosw		; original sample (R)
  2531                                  
  2532                                  	;xor	eax, eax
  2533 000011C9 66B88080                	mov	ax, 8080h
  2534 000011CD 49                      	dec	ecx
  2535 000011CE 7403                    	jz	short lff16s_2
  2536                                  		; convert 8 bit sample to 16 bit sample
  2537 000011D0 668B06                  	mov	ax, [esi]
  2538                                  lff16s_2:
  2539                                  	;mov	[next_val_l], al
  2540                                  	;mov	[next_val_r], ah
  2541 000011D3 89C3                    	mov	ebx, eax
  2542 000011D5 0205[EF220000]          	add	al, [previous_val_l]
  2543 000011DB D0D8                    	rcr	al, 1
  2544 000011DD 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2545 000011DF 0205[EF220000]          	add	al, [previous_val_l]
  2546 000011E5 D0D8                    	rcr	al, 1
  2547 000011E7 2C80                    	sub	al, 80h
  2548 000011E9 66C1E008                	shl	ax, 8
  2549 000011ED 66AB                    	stosw		; this is 1st interpolated sample (L)
  2550 000011EF 88F8                    	mov	al, bh	; [next_val_r]
  2551 000011F1 0205[F1220000]          	add	al, [previous_val_r]
  2552 000011F7 D0D8                    	rcr	al, 1
  2553 000011F9 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2554 000011FB 0205[F1220000]          	add	al, [previous_val_r]
  2555 00001201 D0D8                    	rcr	al, 1
  2556 00001203 2C80                    	sub	al, 80h
  2557 00001205 66C1E008                	shl	ax, 8
  2558 00001209 66AB                    	stosw		; this is 1st interpolated sample (R)
  2559 0000120B 88D0                    	mov	al, dl
  2560 0000120D 00D8                    	add	al, bl	; [next_val_l]
  2561 0000120F D0D8                    	rcr	al, 1
  2562 00001211 2C80                    	sub	al, 80h
  2563 00001213 66C1E008                	shl	ax, 8
  2564 00001217 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2565 00001219 88F0                    	mov	al, dh
  2566 0000121B 00F8                    	add	al, bh	; [next_val_r]
  2567 0000121D D0D8                    	rcr	al, 1
  2568 0000121F 2C80                    	sub	al, 80h
  2569 00001221 66C1E008                	shl	ax, 8
  2570 00001225 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2571                                  	
  2572                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2573 00001227 09C9                    	or	ecx, ecx
  2574 00001229 7582                    	jnz	short lff16s_1
  2575 0000122B E952FBFFFF              	jmp	lff16s_3
  2576                                  
  2577                                  load_16khz_mono_16_bit:
  2578                                  	; 15/11/2023
  2579                                  	; 13/11/2023
  2580 00001230 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2581                                  					; last of the file?
  2582 00001237 7402                    	jz	short lff16m2_0		; no
  2583 00001239 F9                      	stc
  2584 0000123A C3                      	retn
  2585                                  
  2586                                  lff16m2_0:
  2587                                  	; 01/12/2024
  2588                                  	; edi = audio buffer address
  2589 0000123B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2590                                          ;mov	edx, [loadsize]
  2591                                  
  2592                                  	; esi = buffer address
  2593                                  	;; edx = buffer size
  2594                                  
  2595                                  	; load file into memory
  2596                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001240 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001246 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001248 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000124E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001253 CD40                <1>  int 40h
  2597 00001255 7255                    	jc	short lff16m2_7 ; error !
  2598                                  
  2599                                  	; 01/12/2024
  2600 00001257 A3[B87F0000]            	mov	[count], eax
  2601                                  	;;;
  2602                                  	; 07/12/2024
  2603                                  	;mov	edi, audio_buffer
  2604                                  	;;;
  2605 0000125C D1E8                    	shr	eax, 1
  2606 0000125E 7505                    	jnz	short lff16m2_8
  2607 00001260 E935FBFFFF              	jmp	lff16_eof
  2608                                  
  2609                                  lff16m2_8:
  2610 00001265 89C1                    	mov	ecx, eax  ; word count
  2611                                  lff16m2_1:
  2612 00001267 66AD                    	lodsw
  2613 00001269 66AB                    	stosw		; original sample (left channel)
  2614 0000126B 66AB                    	stosw		; original sample (right channel)
  2615 0000126D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2616                                  	;mov	[previous_val], ax
  2617 00001270 89C3                    	mov	ebx, eax
  2618 00001272 31C0                    	xor	eax, eax
  2619 00001274 49                      	dec	ecx
  2620 00001275 7403                    	jz	short lff16m2_2
  2621 00001277 668B06                  	mov	ax, [esi]
  2622                                  lff16m2_2:
  2623 0000127A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2624 0000127D 89C5                    	mov	ebp, eax	; [next_val]
  2625                                  	;add	ax, [previous_val]
  2626 0000127F 6601D8                  	add	ax, bx
  2627 00001282 66D1D8                  	rcr	ax, 1
  2628 00001285 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2629                                  	;add	ax, [previous_val]
  2630 00001287 6601D8                  	add	ax, bx
  2631 0000128A 66D1D8                  	rcr	ax, 1
  2632 0000128D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2633 00001290 66AB                    	stosw		; this is 1st interpolated sample (L)
  2634 00001292 66AB                    	stosw		; this is 1st interpolated sample (R)
  2635 00001294 89E8                    	mov	eax, ebp
  2636 00001296 6601D0                  	add	ax, dx
  2637 00001299 66D1D8                  	rcr	ax, 1
  2638 0000129C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2639 0000129F 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2640 000012A1 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2641                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2642 000012A3 09C9                    	or	ecx, ecx
  2643 000012A5 75C0                    	jnz	short lff16m2_1
  2644 000012A7 E9D6FAFFFF              	jmp	lff16m2_3
  2645                                  
  2646                                  lff16m2_7:
  2647                                  lff16s2_7:
  2648 000012AC E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2649                                  
  2650                                  load_16khz_stereo_16_bit:
  2651                                  	; 16/11/2023
  2652                                  	; 15/11/2023
  2653                                  	; 13/11/2023
  2654 000012B1 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2655                                  					; last of the file?
  2656 000012B8 7402                    	jz	short lff16s2_0		; no
  2657 000012BA F9                      	stc
  2658 000012BB C3                      	retn
  2659                                  
  2660                                  lff16s2_0:
  2661                                  	; 01/12/2024
  2662                                  	; edi = audio buffer address
  2663 000012BC BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2664                                          ;mov	edx, [loadsize]
  2665                                  
  2666                                  	; esi = buffer address
  2667                                  	;; edx = buffer size
  2668                                  
  2669                                  	; load file into memory
  2670                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000012C1 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000012C7 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000012C9 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000012CF B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000012D4 CD40                <1>  int 40h
  2671 000012D6 72D4                    	jc	short lff16s2_7 ; error !
  2672                                  
  2673                                  	; 01/12/2024
  2674 000012D8 A3[B87F0000]            	mov	[count], eax
  2675                                  	;;;
  2676                                  	; 07/12/2024
  2677                                  	;mov	edi, audio_buffer
  2678                                  	;;;
  2679 000012DD C1E802                  	shr	eax, 2
  2680 000012E0 7505                    	jnz	short lff16s2_8
  2681 000012E2 E9B3FAFFFF              	jmp	lff16_eof
  2682                                  
  2683                                  lff16s2_8:
  2684 000012E7 89C1                    	mov	ecx, eax  ; dword count
  2685                                  lff16s2_1:
  2686 000012E9 66AD                    	lodsw
  2687 000012EB 66AB                    	stosw		; original sample (L)
  2688 000012ED 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2689 000012F0 66A3[EF220000]          	mov	[previous_val_l], ax
  2690 000012F6 66AD                    	lodsw
  2691 000012F8 66AB                    	stosw		; original sample (R)
  2692 000012FA 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2693 000012FD 66A3[F1220000]          	mov	[previous_val_r], ax
  2694 00001303 31D2                    	xor	edx, edx
  2695 00001305 31C0                    	xor	eax, eax
  2696                                  	; 16/11/2023
  2697 00001307 49                      	dec	ecx
  2698 00001308 7407                    	jz	short lff16s2_2
  2699 0000130A 668B06                  	mov	ax, [esi]
  2700 0000130D 668B5602                	mov	dx, [esi+2]
  2701                                  lff16s2_2:
  2702 00001311 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2703                                  	;mov	[next_val_l], ax
  2704 00001314 89C5                    	mov	ebp, eax
  2705 00001316 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2706 00001319 668915[F5220000]        	mov	[next_val_r], dx
  2707 00001320 660305[EF220000]        	add	ax, [previous_val_l]
  2708 00001327 66D1D8                  	rcr	ax, 1
  2709 0000132A 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2710 0000132C 660305[EF220000]        	add	ax, [previous_val_l]
  2711 00001333 66D1D8                  	rcr	ax, 1
  2712 00001336 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2713 00001339 66AB                    	stosw		; this is 1st interpolated sample (L)
  2714 0000133B 66A1[F5220000]          	mov	ax, [next_val_r]
  2715 00001341 660305[F1220000]        	add	ax, [previous_val_r]
  2716 00001348 66D1D8                  	rcr	ax, 1
  2717 0000134B 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2718 0000134D 660305[F1220000]        	add	ax, [previous_val_r]
  2719 00001354 66D1D8                  	rcr	ax, 1
  2720 00001357 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2721 0000135A 66AB                    	stosw		; this is 1st interpolated sample (R)
  2722                                  	;mov	ax, [next_val_l]
  2723 0000135C 89E8                    	mov	eax, ebp
  2724 0000135E 6601D0                  	add	ax, dx
  2725 00001361 66D1D8                  	rcr	ax, 1
  2726 00001364 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2727 00001367 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2728 00001369 66A1[F5220000]          	mov	ax, [next_val_r]
  2729 0000136F 6601D8                  	add	ax, bx
  2730 00001372 66D1D8                  	rcr	ax, 1
  2731 00001375 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2732 00001378 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2733                                  	
  2734                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2735 0000137A 09C9                    	or	ecx, ecx
  2736 0000137C 0F8567FFFFFF            	jnz	lff16s2_1
  2737 00001382 E9FBF9FFFF              	jmp	lff16s2_3
  2738                                  
  2739                                  ; .....................
  2740                                  
  2741                                  load_24khz_mono_8_bit:
  2742                                  	; 15/11/2023
  2743 00001387 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2744                                  					; last of the file?
  2745 0000138E 7402                    	jz	short lff24m_0		; no
  2746 00001390 F9                      	stc
  2747 00001391 C3                      	retn
  2748                                  
  2749                                  lff24m_0:
  2750                                  	; 01/12/2024
  2751                                  	; edi = audio buffer address
  2752 00001392 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2753                                          ;mov	edx, [loadsize]
  2754                                  
  2755                                  	; esi = buffer address
  2756                                  	;; edx = buffer size
  2757                                  
  2758                                  	; load file into memory
  2759                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001397 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000139D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000139F 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000013A5 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000013AA CD40                <1>  int 40h
  2760 000013AC 723B                    	jc	short lff24m_7 ; error !
  2761                                  
  2762                                  	; 01/12/2024
  2763 000013AE A3[B87F0000]            	mov	[count], eax
  2764                                  	;;;
  2765                                  	; 07/12/2024
  2766                                  	;mov	edi, audio_buffer
  2767                                  	;;;
  2768 000013B3 21C0                    	and	eax, eax
  2769 000013B5 7505                    	jnz	short lff24m_8
  2770 000013B7 E9DEF9FFFF              	jmp	lff24_eof
  2771                                  
  2772                                  lff24m_8:
  2773 000013BC 89C1                    	mov	ecx, eax	; byte count
  2774                                  lff24m_1:
  2775 000013BE AC                      	lodsb
  2776                                  	;mov	[previous_val], al
  2777 000013BF 88C3                    	mov	bl, al
  2778 000013C1 2C80                    	sub	al, 80h
  2779 000013C3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2780 000013C7 66AB                    	stosw		; original sample (left channel)
  2781 000013C9 66AB                    	stosw		; original sample (right channel)
  2782                                  	;xor	eax, eax
  2783 000013CB B080                    	mov	al, 80h
  2784 000013CD 49                      	dec	ecx
  2785 000013CE 7402                    	jz	short lff24m_2
  2786 000013D0 8A06                    	mov	al, [esi]
  2787                                  lff24m_2:
  2788                                  	;;mov	[next_val], al
  2789                                  	;mov	bh, al
  2790                                  	;add	al, [previous_val]
  2791 000013D2 00D8                    	add	al, bl
  2792 000013D4 D0D8                    	rcr	al, 1
  2793 000013D6 2C80                    	sub	al, 80h
  2794 000013D8 66C1E008                	shl	ax, 8
  2795 000013DC 66AB                    	stosw		; this is interpolated sample (L)
  2796 000013DE 66AB                    	stosw		; this is interpolated sample (R)
  2797                                  	
  2798                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2799 000013E0 09C9                    	or	ecx, ecx
  2800 000013E2 75DA                    	jnz	short lff24m_1
  2801 000013E4 E999F9FFFF              	jmp	lff24_3
  2802                                  
  2803                                  lff24m_7:
  2804                                  lff24s_7:
  2805 000013E9 E9B5F9FFFF              	jmp	lff24_5  ; error
  2806                                  
  2807                                  load_24khz_stereo_8_bit:
  2808                                  	; 15/11/2023
  2809 000013EE F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2810                                  					; last of the file?
  2811 000013F5 7402                    	jz	short lff24s_0		; no
  2812 000013F7 F9                      	stc
  2813 000013F8 C3                      	retn
  2814                                  
  2815                                  lff24s_0:
  2816                                  	; 01/12/2024
  2817                                  	; edi = audio buffer address
  2818 000013F9 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2819                                          ;mov	edx, [loadsize]
  2820                                  
  2821                                  	; esi = buffer address
  2822                                  	;; edx = buffer size
  2823                                  
  2824                                  	; load file into memory
  2825                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000013FE 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001404 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001406 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000140C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001411 CD40                <1>  int 40h
  2826 00001413 72D4                    	jc	short lff24s_7 ; error !
  2827                                  
  2828                                  	; 01/12/2024
  2829 00001415 A3[B87F0000]            	mov	[count], eax
  2830                                  	;;;
  2831                                  	; 07/12/2024
  2832                                  	;mov	edi, audio_buffer
  2833                                  	;;;
  2834 0000141A D1E8                    	shr	eax, 1
  2835 0000141C 7505                    	jnz	short lff24s_8
  2836 0000141E E977F9FFFF              	jmp	lff24_eof
  2837                                  
  2838                                  lff24s_8:
  2839 00001423 89C1                    	mov	ecx, eax  ; word count
  2840                                  lff24s_1:
  2841 00001425 AC                      	lodsb
  2842 00001426 A2[EF220000]            	mov	[previous_val_l], al
  2843 0000142B 2C80                    	sub	al, 80h
  2844 0000142D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2845 00001431 66AB                    	stosw		; original sample (L)
  2846 00001433 AC                      	lodsb
  2847 00001434 A2[F1220000]            	mov	[previous_val_r], al
  2848 00001439 2C80                    	sub	al, 80h
  2849 0000143B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2850 0000143F 66AB                    	stosw		; original sample (R)
  2851                                  
  2852                                  	;xor	eax, eax
  2853 00001441 66B88080                	mov	ax, 8080h
  2854 00001445 49                      	dec	ecx
  2855 00001446 7403                    	jz	short lff24s_2
  2856                                  		; convert 8 bit sample to 16 bit sample
  2857 00001448 668B06                  	mov	ax, [esi]
  2858                                  lff24s_2:
  2859                                  	;;mov	[next_val_l], al
  2860                                  	;;mov	[next_val_r], ah
  2861                                  	;mov	bx, ax
  2862 0000144B 88E7                    	mov	bh, ah
  2863 0000144D 0205[EF220000]          	add	al, [previous_val_l]
  2864 00001453 D0D8                    	rcr	al, 1
  2865                                  	;mov	dl, al
  2866 00001455 2C80                    	sub	al, 80h
  2867 00001457 66C1E008                	shl	ax, 8
  2868 0000145B 66AB                    	stosw		; this is interpolated sample (L)
  2869 0000145D 88F8                    	mov	al, bh	; [next_val_r]
  2870 0000145F 0205[F1220000]          	add	al, [previous_val_r]
  2871 00001465 D0D8                    	rcr	al, 1
  2872                                  	;mov	dh, al
  2873 00001467 2C80                    	sub	al, 80h
  2874 00001469 66C1E008                	shl	ax, 8
  2875 0000146D 66AB                    	stosw		; this is interpolated sample (R)
  2876                                  		
  2877                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2878 0000146F 09C9                    	or	ecx, ecx
  2879 00001471 75B2                    	jnz	short lff24s_1
  2880 00001473 E90AF9FFFF              	jmp	lff24_3
  2881                                  
  2882                                  load_24khz_mono_16_bit:
  2883                                  	; 15/11/2023
  2884 00001478 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2885                                  					; last of the file?
  2886 0000147F 7402                    	jz	short lff24m2_0		; no
  2887 00001481 F9                      	stc
  2888 00001482 C3                      	retn
  2889                                  
  2890                                  lff24m2_0:
  2891                                  	; 01/12/2024
  2892                                  	; edi = audio buffer address
  2893 00001483 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2894                                          ;mov	edx, [loadsize]
  2895                                  
  2896                                  	; esi = buffer address
  2897                                  	;; edx = buffer size
  2898                                  
  2899                                  	; load file into memory
  2900                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001488 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000148E 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001490 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001496 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000149B CD40                <1>  int 40h
  2901 0000149D 7237                    	jc	short lff24m2_7 ; error !
  2902                                  
  2903                                  	; 01/12/2024
  2904 0000149F A3[B87F0000]            	mov	[count], eax
  2905                                  	;;;
  2906                                  	; 07/12/2024
  2907                                  	;mov	edi, audio_buffer
  2908                                  	;;;
  2909 000014A4 D1E8                    	shr	eax, 1
  2910 000014A6 7505                    	jnz	short lff24m2_8
  2911 000014A8 E9EDF8FFFF              	jmp	lff24_eof
  2912                                  
  2913                                  lff24m2_8:
  2914 000014AD 89C1                    	mov	ecx, eax  ; word count
  2915                                  lff24m2_1:
  2916 000014AF 66AD                    	lodsw
  2917 000014B1 66AB                    	stosw		; original sample (left channel)
  2918 000014B3 66AB                    	stosw		; original sample (right channel)
  2919 000014B5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2920                                  	;mov	[previous_val], ax
  2921                                  	;mov	ebx, eax
  2922                                  	;xor	eax, eax
  2923 000014B8 31DB                    	xor	ebx, ebx
  2924 000014BA 49                      	dec	ecx
  2925 000014BB 7403                    	jz	short lff24m2_2
  2926                                  	;mov	ax, [esi]
  2927 000014BD 668B1E                  	mov	bx, [esi]
  2928                                  lff24m2_2:
  2929                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2930                                  	;mov	ebp, eax	; [next_val]
  2931                                  	;add	ax, [previous_val]
  2932                                  	; ax = [previous_val]
  2933                                  	; bx = [next_val]
  2934 000014C0 6601D8                  	add	ax, bx
  2935 000014C3 66D1D8                  	rcr	ax, 1
  2936 000014C6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2937 000014C9 66AB                    	stosw		; this is interpolated sample (L)
  2938 000014CB 66AB                    	stosw		; this is interpolated sample (R)
  2939                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2940 000014CD 09C9                    	or	ecx, ecx
  2941 000014CF 75DE                    	jnz	short lff24m2_1
  2942 000014D1 E9ACF8FFFF              	jmp	lff24_3
  2943                                  
  2944                                  lff24m2_7:
  2945                                  lff24s2_7:
  2946 000014D6 E9C8F8FFFF              	jmp	lff24_5  ; error
  2947                                  
  2948                                  load_24khz_stereo_16_bit:
  2949                                  	; 16/11/2023
  2950                                  	; 15/11/2023
  2951 000014DB F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2952                                  					; last of the file?
  2953 000014E2 7402                    	jz	short lff24s2_0		; no
  2954 000014E4 F9                      	stc
  2955 000014E5 C3                      	retn
  2956                                  
  2957                                  lff24s2_0:
  2958                                  	; 01/12/2024
  2959                                  	; edi = audio buffer address
  2960 000014E6 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2961                                          ;mov	edx, [loadsize]
  2962                                  
  2963                                  	; esi = buffer address
  2964                                  	;; edx = buffer size
  2965                                  
  2966                                  	; load file into memory
  2967                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000014EB 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000014F1 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000014F3 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000014F9 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000014FE CD40                <1>  int 40h
  2968 00001500 72D4                    	jc	short lff24s2_7 ; error !
  2969                                  
  2970                                  	; 01/12/2024
  2971 00001502 A3[B87F0000]            	mov	[count], eax
  2972                                  	;;;
  2973                                  	; 07/12/2024
  2974                                  	;mov	edi, audio_buffer
  2975                                  	;;;
  2976 00001507 C1E802                  	shr	eax, 2
  2977 0000150A 7505                    	jnz	short lff24s2_8
  2978 0000150C E989F8FFFF              	jmp	lff24_eof
  2979                                  
  2980                                  lff24s2_8:
  2981 00001511 89C1                    	mov	ecx, eax  ; dword count
  2982                                  lff24s2_1:
  2983 00001513 66AD                    	lodsw
  2984 00001515 66AB                    	stosw		; original sample (L)
  2985 00001517 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2986 0000151A 66A3[EF220000]          	mov	[previous_val_l], ax
  2987 00001520 66AD                    	lodsw
  2988 00001522 66AB                    	stosw		; original sample (R)
  2989 00001524 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2990                                  	;mov	[previous_val_r], ax
  2991 00001527 89C3                    	mov	ebx, eax
  2992 00001529 31D2                    	xor	edx, edx
  2993 0000152B 31C0                    	xor	eax, eax
  2994                                  	; 16/11/2023
  2995 0000152D 49                      	dec	ecx
  2996 0000152E 7407                    	jz	short lff24s2_2
  2997 00001530 668B06                  	mov	ax, [esi]
  2998 00001533 668B5602                	mov	dx, [esi+2]
  2999                                  lff24s2_2:
  3000 00001537 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3001                                  	;;mov	[next_val_l], ax
  3002                                  	;mov	ebp, eax
  3003 0000153A 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3004                                  	;mov	[next_val_r], dx
  3005 0000153D 660305[EF220000]        	add	ax, [previous_val_l]
  3006 00001544 66D1D8                  	rcr	ax, 1
  3007 00001547 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3008 0000154A 66AB                    	stosw		; this is interpolated sample (L)
  3009                                  	;mov	ax, [next_val_r]
  3010 0000154C 89D0                    	mov	eax, edx
  3011                                  	;add	ax, [previous_val_r]
  3012 0000154E 6601D8                  	add	ax, bx
  3013 00001551 66D1D8                  	rcr	ax, 1
  3014 00001554 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3015 00001557 66AB                    	stosw		; this is interpolated sample (R)
  3016                                  	
  3017                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3018 00001559 09C9                    	or	ecx, ecx
  3019 0000155B 75B6                    	jnz	short lff24s2_1
  3020 0000155D E920F8FFFF              	jmp	lff24_3
  3021                                  
  3022                                  ; .....................
  3023                                  
  3024                                  load_32khz_mono_8_bit:
  3025                                  	; 15/11/2023
  3026 00001562 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3027                                  					; last of the file?
  3028 00001569 7402                    	jz	short lff32m_0		; no
  3029 0000156B F9                      	stc
  3030 0000156C C3                      	retn
  3031                                  
  3032                                  lff32m_0:
  3033                                  	; 01/12/2024
  3034                                  	; edi = audio buffer address
  3035 0000156D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3036                                          ;mov	edx, [loadsize]
  3037                                  
  3038                                  	; esi = buffer address
  3039                                  	;; edx = buffer size
  3040                                  
  3041                                  	; load file into memory
  3042                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001572 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001578 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000157A 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001580 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001585 CD40                <1>  int 40h
  3043 00001587 7247                    	jc	short lff32m_7 ; error !
  3044                                  
  3045                                  	; 01/12/2024
  3046 00001589 A3[B87F0000]            	mov	[count], eax
  3047                                  	;;;
  3048                                  	; 07/12/2024
  3049                                  	;mov	edi, audio_buffer
  3050                                  	;;;
  3051 0000158E 21C0                    	and	eax, eax
  3052 00001590 7505                    	jnz	short lff32m_8
  3053 00001592 E903F8FFFF              	jmp	lff32_eof
  3054                                  
  3055                                  lff32m_8:
  3056 00001597 89C1                    	mov	ecx, eax	; byte count
  3057                                  lff32m_1:
  3058 00001599 AC                      	lodsb
  3059                                  	;mov	[previous_val], al
  3060 0000159A 88C3                    	mov	bl, al
  3061 0000159C 2C80                    	sub	al, 80h
  3062 0000159E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3063 000015A2 66AB                    	stosw		; original sample (left channel)
  3064 000015A4 66AB                    	stosw		; original sample (right channel)
  3065                                  	;xor	eax, eax
  3066 000015A6 B080                    	mov	al, 80h
  3067 000015A8 49                      	dec	ecx
  3068 000015A9 7402                    	jz	short lff32m_2
  3069 000015AB 8A06                    	mov	al, [esi]
  3070                                  lff32m_2:
  3071                                  	;;mov	[next_val], al
  3072                                  	;mov	bh, al
  3073                                  	;add	al, [previous_val]
  3074 000015AD 00D8                    	add	al, bl
  3075 000015AF D0D8                    	rcr	al, 1
  3076 000015B1 2C80                    	sub	al, 80h
  3077 000015B3 66C1E008                	shl	ax, 8
  3078 000015B7 66AB                    	stosw		; this is interpolated sample (L)
  3079 000015B9 66AB                    	stosw		; this is interpolated sample (R)
  3080                                  	
  3081                                  	; different than 8-16-24 kHZ !
  3082                                  	; 'original-interpolated-original' trio samples
  3083 000015BB E30E                    	jecxz	lff32m_3
  3084                                  
  3085 000015BD AC                      	lodsb
  3086 000015BE 2C80                    	sub	al, 80h
  3087 000015C0 66C1E008                	shl	ax, 8
  3088 000015C4 66AB                    	stosw		; original sample (left channel)
  3089 000015C6 66AB                    	stosw		; original sample (right channel)
  3090                                  
  3091                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3092 000015C8 49                      	dec	ecx
  3093 000015C9 75CE                    	jnz	short lff32m_1
  3094                                  lff32m_3:
  3095 000015CB E9B2F7FFFF              	jmp	lff32_3
  3096                                  
  3097                                  lff32m_7:
  3098                                  lff32s_7:
  3099 000015D0 E9CEF7FFFF              	jmp	lff32_5  ; error
  3100                                  
  3101                                  load_32khz_stereo_8_bit:
  3102                                  	; 15/11/2023
  3103 000015D5 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3104                                  					; last of the file?
  3105 000015DC 7402                    	jz	short lff32s_0		; no
  3106 000015DE F9                      	stc
  3107 000015DF C3                      	retn
  3108                                  
  3109                                  lff32s_0:
  3110                                  	; 01/12/2024
  3111                                  	; edi = audio buffer address
  3112 000015E0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3113                                          ;mov	edx, [loadsize]
  3114                                  
  3115                                  	; esi = buffer address
  3116                                  	;; edx = buffer size
  3117                                  
  3118                                  	; load file into memory
  3119                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000015E5 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000015EB 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000015ED 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000015F3 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000015F8 CD40                <1>  int 40h
  3120 000015FA 72D4                    	jc	short lff32s_7 ; error !
  3121                                  
  3122                                  	; 01/12/2024
  3123 000015FC A3[B87F0000]            	mov	[count], eax
  3124                                  	;;;
  3125                                  	; 07/12/2024
  3126                                  	;mov	edi, audio_buffer
  3127                                  	;;;
  3128 00001601 D1E8                    	shr	eax, 1
  3129 00001603 7505                    	jnz	short lff32s_8
  3130 00001605 E990F7FFFF              	jmp	lff32_eof
  3131                                  
  3132                                  lff32s_8:
  3133 0000160A 89C1                    	mov	ecx, eax  ; word count
  3134                                  lff32s_1:
  3135 0000160C AC                      	lodsb
  3136 0000160D A2[EF220000]            	mov	[previous_val_l], al
  3137 00001612 2C80                    	sub	al, 80h
  3138 00001614 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3139 00001618 66AB                    	stosw		; original sample (L)
  3140 0000161A AC                      	lodsb
  3141 0000161B A2[F1220000]            	mov	[previous_val_r], al
  3142 00001620 2C80                    	sub	al, 80h
  3143 00001622 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3144 00001626 66AB                    	stosw		; original sample (R)
  3145                                  
  3146                                  	;xor	eax, eax
  3147 00001628 66B88080                	mov	ax, 8080h
  3148 0000162C 49                      	dec	ecx
  3149 0000162D 7403                    	jz	short lff32s_2
  3150                                  		; convert 8 bit sample to 16 bit sample
  3151 0000162F 668B06                  	mov	ax, [esi]
  3152                                  lff32s_2:
  3153                                  	;;mov	[next_val_l], al
  3154                                  	;;mov	[next_val_r], ah
  3155                                  	;mov	bx, ax
  3156 00001632 88E7                    	mov	bh, ah
  3157 00001634 0205[EF220000]          	add	al, [previous_val_l]
  3158 0000163A D0D8                    	rcr	al, 1
  3159                                  	;mov	dl, al
  3160 0000163C 2C80                    	sub	al, 80h
  3161 0000163E 66C1E008                	shl	ax, 8
  3162 00001642 66AB                    	stosw		; this is interpolated sample (L)
  3163 00001644 88F8                    	mov	al, bh	; [next_val_r]
  3164 00001646 0205[F1220000]          	add	al, [previous_val_r]
  3165 0000164C D0D8                    	rcr	al, 1
  3166                                  	;mov	dh, al
  3167 0000164E 2C80                    	sub	al, 80h
  3168 00001650 66C1E008                	shl	ax, 8
  3169 00001654 66AB                    	stosw		; this is interpolated sample (R)
  3170                                  
  3171                                  	; different than 8-16-24 kHZ !
  3172                                  	; 'original-interpolated-original' trio samples
  3173 00001656 E315                    	jecxz	lff32s_3
  3174                                  
  3175 00001658 AC                      	lodsb
  3176 00001659 2C80                    	sub	al, 80h
  3177 0000165B 66C1E008                	shl	ax, 8
  3178 0000165F 66AB                    	stosw		; original sample (left channel)
  3179                                  
  3180 00001661 AC                      	lodsb
  3181 00001662 2C80                    	sub	al, 80h
  3182 00001664 66C1E008                	shl	ax, 8
  3183 00001668 66AB                    	stosw		; original sample (right channel)
  3184                                  		
  3185                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3186 0000166A 49                      	dec	ecx
  3187 0000166B 759F                    	jnz	short lff32s_1
  3188                                  lff32s_3:
  3189 0000166D E910F7FFFF              	jmp	lff32_3
  3190                                  
  3191                                  load_32khz_mono_16_bit:
  3192                                  	; 15/11/2023
  3193 00001672 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3194                                  					; last of the file?
  3195 00001679 7402                    	jz	short lff32m2_0		; no
  3196 0000167B F9                      	stc
  3197 0000167C C3                      	retn
  3198                                  
  3199                                  lff32m2_0:
  3200                                  	; 01/12/2024
  3201                                  	; edi = audio buffer address
  3202 0000167D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3203                                          ;mov	edx, [loadsize]
  3204                                  
  3205                                  	; esi = buffer address
  3206                                  	;; edx = buffer size
  3207                                  
  3208                                  	; load file into memory
  3209                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001682 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001688 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000168A 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001690 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001695 CD40                <1>  int 40h
  3210 00001697 723E                    	jc	short lff32m2_7 ; error !
  3211                                  
  3212                                  	; 01/12/2024
  3213 00001699 A3[B87F0000]            	mov	[count], eax
  3214                                  	;;;
  3215                                  	; 07/12/2024
  3216                                  	;mov	edi, audio_buffer
  3217                                  	;;;
  3218 0000169E D1E8                    	shr	eax, 1
  3219 000016A0 7505                    	jnz	short lff32m2_8
  3220 000016A2 E9F3F6FFFF              	jmp	lff32_eof
  3221                                  
  3222                                  lff32m2_8:
  3223 000016A7 89C1                    	mov	ecx, eax  ; word count
  3224                                  lff32m2_1:
  3225 000016A9 66AD                    	lodsw
  3226 000016AB 66AB                    	stosw		; original sample (left channel)
  3227 000016AD 66AB                    	stosw		; original sample (right channel)
  3228 000016AF 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3229                                  	;mov	[previous_val], ax
  3230                                  	;mov	ebx, eax
  3231                                  	;xor	eax, eax
  3232 000016B2 31DB                    	xor	ebx, ebx
  3233 000016B4 49                      	dec	ecx
  3234 000016B5 7403                    	jz	short lff32m2_2
  3235                                  	;mov	ax, [esi]
  3236 000016B7 668B1E                  	mov	bx, [esi]
  3237                                  lff32m2_2:
  3238                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  3239                                  	;mov	ebp, eax ; [next_val]
  3240                                  	;add	ax, [previous_val]
  3241                                  	; ax = [previous_val]
  3242                                  	; bx = [next_val]
  3243 000016BA 6601D8                  	add	ax, bx
  3244 000016BD 66D1D8                  	rcr	ax, 1
  3245 000016C0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3246 000016C3 66AB                    	stosw		; this is interpolated sample (L)
  3247 000016C5 66AB                    	stosw		; this is interpolated sample (R)
  3248                                  
  3249                                  	; different than 8-16-24 kHZ !
  3250                                  	; 'original-interpolated-original' trio samples 
  3251 000016C7 E309                    	jecxz	lff32m2_3
  3252                                  
  3253 000016C9 66AD                    	lodsw
  3254 000016CB 66AB                    	stosw		; original sample (left channel)
  3255 000016CD 66AB                    	stosw		; original sample (right channel)
  3256                                  
  3257                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3258 000016CF 49                      	dec	ecx
  3259 000016D0 75D7                    	jnz	short lff32m2_1
  3260                                  lff32m2_3:
  3261 000016D2 E9ABF6FFFF              	jmp	lff32_3
  3262                                  
  3263                                  lff32m2_7:
  3264                                  lff32s2_7:
  3265 000016D7 E9C7F6FFFF              	jmp	lff32_5  ; error
  3266                                  
  3267                                  load_32khz_stereo_16_bit:
  3268                                  	; 16/11/2023
  3269                                  	; 15/11/2023
  3270 000016DC F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3271                                  					; last of the file?
  3272 000016E3 7402                    	jz	short lff32s2_0		; no
  3273 000016E5 F9                      	stc
  3274 000016E6 C3                      	retn
  3275                                  
  3276                                  lff32s2_0:
  3277                                  	; 01/12/2024
  3278                                  	; edi = audio buffer address
  3279 000016E7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3280                                          ;mov	edx, [loadsize]
  3281                                  
  3282                                  	; esi = buffer address
  3283                                  	;; edx = buffer size
  3284                                  
  3285                                  	; load file into memory
  3286                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000016EC 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000016F2 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000016F4 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000016FA B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000016FF CD40                <1>  int 40h
  3287 00001701 72D4                    	jc	short lff32s2_7 ; error !
  3288                                  
  3289                                  	; 01/12/2024
  3290 00001703 A3[B87F0000]            	mov	[count], eax
  3291                                  	;;;
  3292                                  	; 07/12/2024
  3293                                  	;mov	edi, audio_buffer
  3294                                  	;;;
  3295 00001708 C1E802                  	shr	eax, 2
  3296 0000170B 7505                    	jnz	short lff32s2_8
  3297 0000170D E988F6FFFF              	jmp	lff32_eof
  3298                                  
  3299                                  lff32s2_8:
  3300 00001712 89C1                    	mov	ecx, eax ; dword count
  3301                                  lff32s2_1:
  3302 00001714 66AD                    	lodsw
  3303 00001716 66AB                    	stosw		; original sample (L)
  3304 00001718 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3305 0000171B 66A3[EF220000]          	mov	[previous_val_l], ax
  3306 00001721 66AD                    	lodsw
  3307 00001723 66AB                    	stosw		; original sample (R)
  3308 00001725 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3309                                  	;mov	[previous_val_r], ax
  3310 00001728 89C3                    	mov	ebx, eax
  3311 0000172A 31D2                    	xor	edx, edx
  3312 0000172C 31C0                    	xor	eax, eax
  3313                                  	; 16/11/2023
  3314 0000172E 49                      	dec	ecx
  3315 0000172F 7407                    	jz	short lff32s2_2
  3316 00001731 668B06                  	mov	ax, [esi]
  3317 00001734 668B5602                	mov	dx, [esi+2]
  3318                                  lff32s2_2:
  3319 00001738 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3320                                  	;;mov	[next_val_l], ax
  3321                                  	;mov	ebp, eax
  3322 0000173B 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3323                                  	;mov	[next_val_r], dx
  3324 0000173E 660305[EF220000]        	add	ax, [previous_val_l]
  3325 00001745 66D1D8                  	rcr	ax, 1
  3326 00001748 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3327 0000174B 66AB                    	stosw		; this is interpolated sample (L)
  3328                                  	;mov	ax, [next_val_r]
  3329 0000174D 89D0                    	mov	eax, edx
  3330                                  	;add	ax, [previous_val_r]
  3331 0000174F 6601D8                  	add	ax, bx
  3332 00001752 66D1D8                  	rcr	ax, 1
  3333 00001755 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3334 00001758 66AB                    	stosw		; this is interpolated sample (R)
  3335                                  
  3336                                  	; different than 8-16-24 kHZ !
  3337                                  	; 'original-interpolated-original' trio samples
  3338 0000175A E30B                    	jecxz	lff32s2_3
  3339                                  
  3340 0000175C 66AD                    	lodsw
  3341 0000175E 66AB                    	stosw	; original sample (L)
  3342 00001760 66AD                    	lodsw
  3343 00001762 66AB                    	stosw	; original sample (R)
  3344                                  	
  3345                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3346 00001764 49                      	dec	ecx
  3347 00001765 75AD                    	jnz	short lff32s2_1
  3348                                  lff32s2_3:
  3349 00001767 E916F6FFFF              	jmp	lff32_3
  3350                                  
  3351                                  ; .....................
  3352                                  
  3353                                  load_22khz_mono_8_bit:
  3354                                  	; 16/11/2023
  3355 0000176C F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3356                                  					; last of the file?
  3357 00001773 7402                    	jz	short lff22m_0		; no
  3358 00001775 F9                      	stc
  3359 00001776 C3                      	retn
  3360                                  
  3361                                  lff22m_0:
  3362                                  	; 01/12/2024
  3363                                  	; edi = audio buffer address
  3364 00001777 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3365                                          ;mov	edx, [loadsize]
  3366                                  
  3367                                  	; esi = buffer address
  3368                                  	;; edx = buffer size
  3369                                  
  3370                                  	; load file into memory
  3371                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000177C 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001782 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001784 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000178A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000178F CD40                <1>  int 40h
  3372 00001791 725D                    	jc	short lff22m_7 ; error !
  3373                                  
  3374                                  	; 01/12/2024
  3375 00001793 A3[B87F0000]            	mov	[count], eax
  3376                                  	;;;
  3377                                  	; 07/12/2024
  3378                                  	;mov	edi, audio_buffer
  3379                                  	;;;
  3380 00001798 21C0                    	and	eax, eax
  3381 0000179A 7505                    	jnz	short lff22m_8
  3382 0000179C E9F9F5FFFF              	jmp	lff22_eof
  3383                                  
  3384                                  lff22m_8:
  3385 000017A1 89C1                    	mov	ecx, eax	; byte count
  3386                                  lff22m_9:
  3387 000017A3 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3388 000017A8 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3389                                  lff22m_1:
  3390                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3391 000017AF AC                      	lodsb
  3392 000017B0 B280                    	mov	dl, 80h
  3393 000017B2 49                      	dec	ecx
  3394 000017B3 7402                    	jz	short lff22m_2_1
  3395 000017B5 8A16                    	mov	dl, [esi]
  3396                                  lff22m_2_1:	
  3397                                  	; al = [previous_val]
  3398                                  	; dl = [next_val]
  3399 000017B7 E8EF050000              	call	interpolating_3_8bit_mono ; 1 of 17
  3400 000017BC E32D                    	jecxz	lff22m_3
  3401                                  lff22m_2_2:
  3402 000017BE AC                      	lodsb
  3403 000017BF B280                    	mov	dl, 80h
  3404 000017C1 49                      	dec	ecx
  3405 000017C2 7402                    	jz	short lff22m_2_3
  3406 000017C4 8A16                    	mov	dl, [esi]
  3407                                  lff22m_2_3:
  3408 000017C6 E864060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3409 000017CB E31E                    	jecxz	lff22m_3
  3410 000017CD 4D                      	dec	ebp
  3411 000017CE 75EE                    	jnz	short lff22m_2_2
  3412                                  
  3413 000017D0 A0[F7220000]            	mov	al, [faz]
  3414 000017D5 FEC8                    	dec	al
  3415 000017D7 74CA                    	jz	short lff22m_9
  3416 000017D9 FE0D[F7220000]          	dec	byte [faz]
  3417 000017DF BD04000000              	mov	ebp, 4
  3418 000017E4 FEC8                    	dec	al
  3419 000017E6 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3420 000017E8 45                      	inc	ebp ; 5
  3421 000017E9 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3422                                  
  3423                                  lff22m_3:
  3424                                  lff22s_3:
  3425 000017EB E992F5FFFF              	jmp	lff22_3	; padfill
  3426                                  		; (put zeros in the remain words of the buffer)
  3427                                  lff22m_7:
  3428                                  lff22s_7:
  3429 000017F0 E9AEF5FFFF              	jmp	lff22_5  ; error
  3430                                  
  3431                                  load_22khz_stereo_8_bit:
  3432                                  	; 16/11/2023
  3433 000017F5 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3434                                  					; last of the file?
  3435 000017FC 7402                    	jz	short lff22s_0		; no
  3436 000017FE F9                      	stc
  3437 000017FF C3                      	retn
  3438                                  
  3439                                  lff22s_0:
  3440                                  	; 01/12/2024
  3441                                  	; edi = audio buffer address
  3442 00001800 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3443                                          ;mov	edx, [loadsize]
  3444                                  
  3445                                  	; esi = buffer address
  3446                                  	;; edx = buffer size
  3447                                  
  3448                                  	; load file into memory
  3449                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001805 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000180B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000180D 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001813 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001818 CD40                <1>  int 40h
  3450 0000181A 72D4                    	jc	short lff22s_7 ; error !
  3451                                  
  3452                                  	; 01/12/2024
  3453 0000181C A3[B87F0000]            	mov	[count], eax
  3454                                  	;;;
  3455                                  	; 07/12/2024
  3456                                  	;mov	edi, audio_buffer
  3457                                  	;;;
  3458 00001821 D1E8                    	shr	eax, 1
  3459 00001823 7505                    	jnz	short lff22s_8
  3460 00001825 E970F5FFFF              	jmp	lff22_eof
  3461                                  
  3462                                  lff22s_8:
  3463 0000182A 89C1                    	mov	ecx, eax	; word count
  3464                                  lff22s_9:
  3465 0000182C BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3466 00001831 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3467                                  lff22s_1:
  3468                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3469 00001838 66AD                    	lodsw
  3470 0000183A 66BA8080                	mov	dx, 8080h
  3471 0000183E 49                      	dec	ecx
  3472 0000183F 7403                    	jz	short lff22s_2_1
  3473 00001841 668B16                  	mov	dx, [esi]
  3474                                  lff22s_2_1:	
  3475                                  	; al = [previous_val_l]
  3476                                  	; ah = [previous_val_r]
  3477                                  	; dl = [next_val_l]
  3478                                  	; dh = [next_val_r]
  3479 00001844 E893050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3480 00001849 E3A0                    	jecxz	lff22s_3
  3481                                  lff22s_2_2:
  3482 0000184B 66AD                    	lodsw
  3483 0000184D 66BA8080                	mov	dx, 8080h
  3484 00001851 49                      	dec	ecx
  3485 00001852 7403                    	jz	short lff22s_2_3
  3486 00001854 668B16                  	mov	dx, [esi]
  3487                                  lff22s_2_3:
  3488 00001857 E8F0050000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3489 0000185C E38D                    	jecxz	lff22s_3
  3490 0000185E 4D                      	dec	ebp
  3491 0000185F 75EA                    	jnz	short lff22s_2_2
  3492                                  
  3493 00001861 A0[F7220000]            	mov	al, [faz]
  3494 00001866 FEC8                    	dec	al
  3495 00001868 74C2                    	jz	short lff22s_9
  3496 0000186A FE0D[F7220000]          	dec	byte [faz]
  3497 00001870 BD04000000              	mov	ebp, 4
  3498 00001875 FEC8                    	dec	al
  3499 00001877 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3500 00001879 45                      	inc	ebp ; 5
  3501 0000187A EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3502                                  
  3503                                  load_22khz_mono_16_bit:
  3504                                  	; 16/11/2023
  3505 0000187C F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3506                                  					; last of the file?
  3507 00001883 7402                    	jz	short lff22m2_0		; no
  3508 00001885 F9                      	stc
  3509 00001886 C3                      	retn
  3510                                  
  3511                                  lff22m2_0:
  3512                                  	; 01/12/2024
  3513                                  	; edi = audio buffer address
  3514 00001887 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3515                                          ;mov	edx, [loadsize]
  3516                                  
  3517                                  	; esi = buffer address
  3518                                  	;; edx = buffer size
  3519                                  
  3520                                  	; load file into memory
  3521                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000188C 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001892 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001894 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000189A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000189F CD40                <1>  int 40h
  3522 000018A1 7261                    	jc	short lff22m2_7 ; error !
  3523                                  
  3524                                  	; 01/12/2024
  3525 000018A3 A3[B87F0000]            	mov	[count], eax
  3526                                  	;;;
  3527                                  	; 07/12/2024
  3528                                  	;mov	edi, audio_buffer
  3529                                  	;;;
  3530 000018A8 D1E8                    	shr	eax, 1
  3531 000018AA 7505                    	jnz	short lff22m2_8
  3532 000018AC E9E9F4FFFF              	jmp	lff22_eof
  3533                                  
  3534                                  lff22m2_8:
  3535 000018B1 89C1                    	mov	ecx, eax	; word count
  3536                                  lff22m2_9:
  3537 000018B3 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3538 000018B8 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3539                                  lff22m2_1:
  3540                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3541 000018BF 66AD                    	lodsw
  3542 000018C1 31D2                    	xor	edx, edx
  3543 000018C3 49                      	dec	ecx
  3544 000018C4 7403                    	jz	short lff22m2_2_1
  3545 000018C6 668B16                  	mov	dx, [esi]
  3546                                  lff22m2_2_1:	
  3547                                  	; ax = [previous_val]
  3548                                  	; dx = [next_val]
  3549 000018C9 E8AF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3550 000018CE E32F                    	jecxz	lff22m2_3
  3551                                  lff22m2_2_2:
  3552 000018D0 66AD                    	lodsw
  3553 000018D2 31D2                    	xor	edx, edx
  3554 000018D4 49                      	dec	ecx
  3555 000018D5 7403                    	jz	short lff22m2_2_3
  3556 000018D7 668B16                  	mov	dx, [esi]
  3557                                  lff22m2_2_3:
  3558 000018DA E831060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3559 000018DF E31E                    	jecxz	lff22m2_3
  3560 000018E1 4D                      	dec	ebp
  3561 000018E2 75EC                    	jnz	short lff22m2_2_2
  3562                                  
  3563 000018E4 A0[F7220000]            	mov	al, [faz]
  3564 000018E9 FEC8                    	dec	al
  3565 000018EB 74C6                    	jz	short lff22m2_9
  3566 000018ED FE0D[F7220000]          	dec	byte [faz]
  3567 000018F3 BD04000000              	mov	ebp, 4
  3568 000018F8 FEC8                    	dec	al
  3569 000018FA 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3570 000018FC 45                      	inc	ebp ; 5
  3571 000018FD EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3572                                  
  3573                                  lff22m2_3:
  3574                                  lff22s2_3:
  3575 000018FF E97EF4FFFF              	jmp	lff22_3	; padfill
  3576                                  		; (put zeros in the remain words of the buffer)
  3577                                  lff22m2_7:
  3578                                  lff22s2_7:
  3579 00001904 E99AF4FFFF              	jmp	lff22_5  ; error
  3580                                  
  3581                                  load_22khz_stereo_16_bit:
  3582                                  	; 16/11/2023
  3583 00001909 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3584                                  					; last of the file?
  3585 00001910 7402                    	jz	short lff22s2_0		; no
  3586 00001912 F9                      	stc
  3587 00001913 C3                      	retn
  3588                                  
  3589                                  lff22s2_0:
  3590                                  	; 01/12/2024
  3591                                  	; edi = audio buffer address
  3592 00001914 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3593                                          ;mov	edx, [loadsize]
  3594                                  
  3595                                  	; esi = buffer address
  3596                                  	;; edx = buffer size
  3597                                  
  3598                                  	; load file into memory
  3599                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001919 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000191F 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001921 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001927 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000192C CD40                <1>  int 40h
  3600 0000192E 72D4                    	jc	short lff22s2_7 ; error !
  3601                                  
  3602                                  	; 01/12/2024
  3603 00001930 A3[B87F0000]            	mov	[count], eax
  3604                                  	;;;
  3605                                  	; 07/12/2024
  3606                                  	;mov	edi, audio_buffer
  3607                                  	;;;
  3608 00001935 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3609 00001938 7505                    	jnz	short lff22s2_8
  3610 0000193A E95BF4FFFF              	jmp	lff22_eof
  3611                                  
  3612                                  lff22s2_8:
  3613 0000193F 89C1                    	mov	ecx, eax	; dword count
  3614                                  lff22s2_9:
  3615 00001941 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3616 00001946 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3617                                  lff22s2_1:
  3618                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3619 0000194D 66AD                    	lodsw
  3620 0000194F 89C3                    	mov	ebx, eax
  3621 00001951 66AD                    	lodsw
  3622 00001953 8B16                    	mov	edx, [esi]
  3623 00001955 668915[F3220000]        	mov	[next_val_l], dx
  3624                                  	; 26/11/2023
  3625 0000195C C1EA10                  	shr	edx, 16
  3626 0000195F 49                      	dec	ecx
  3627 00001960 7509                    	jnz	short lff22s2_2_1
  3628 00001962 31D2                    	xor	edx, edx ; 0
  3629 00001964 668915[F3220000]        	mov	[next_val_l], dx
  3630                                  lff22s2_2_1:
  3631                                  	; bx = [previous_val_l]
  3632                                  	; ax = [previous_val_r]
  3633                                  	; [next_val_l]
  3634                                  	; dx = [next_val_r]
  3635 0000196B E83D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3636 00001970 E38D                    	jecxz	lff22s2_3
  3637                                  lff22s2_2_2:
  3638 00001972 66AD                    	lodsw
  3639 00001974 89C3                    	mov	ebx, eax
  3640 00001976 66AD                    	lodsw
  3641 00001978 8B16                    	mov	edx, [esi]
  3642 0000197A 668915[F3220000]        	mov	[next_val_l], dx
  3643                                  	; 26/11/2023
  3644 00001981 C1EA10                  	shr	edx, 16
  3645 00001984 49                      	dec	ecx
  3646 00001985 7509                    	jnz	short lff22s2_2_3
  3647 00001987 31D2                    	xor	edx, edx ; 0
  3648 00001989 668915[F3220000]        	mov	[next_val_l], dx
  3649                                  lff22s2_2_3:
  3650 00001990 E893050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3651 00001995 E31E                    	jecxz	lff22s2_2_4
  3652                                  
  3653 00001997 4D                      	dec	ebp
  3654 00001998 75D8                    	jnz	short lff22s2_2_2
  3655                                  
  3656 0000199A A0[F7220000]            	mov	al, [faz]
  3657 0000199F FEC8                    	dec	al
  3658 000019A1 749E                    	jz	short lff22s2_9
  3659 000019A3 FE0D[F7220000]          	dec	byte [faz]
  3660 000019A9 BD04000000              	mov	ebp, 4
  3661 000019AE FEC8                    	dec	al
  3662 000019B0 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3663 000019B2 45                      	inc	ebp ; 5
  3664 000019B3 EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3665                                  
  3666                                  lff22s2_2_4:
  3667                                  	; 26/11/2023
  3668 000019B5 E9C8F3FFFF              	jmp	lff22_3	; padfill
  3669                                  
  3670                                  ; .....................
  3671                                  
  3672                                  load_11khz_mono_8_bit:
  3673                                  	; 18/11/2023
  3674 000019BA F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3675                                  					; last of the file?
  3676 000019C1 7402                    	jz	short lff11m_0		; no
  3677 000019C3 F9                      	stc
  3678 000019C4 C3                      	retn
  3679                                  
  3680                                  lff11m_0:
  3681                                  	; 01/12/2024
  3682                                  	; edi = audio buffer address
  3683 000019C5 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3684                                          ;mov	edx, [loadsize]
  3685                                  
  3686                                  	; esi = buffer address
  3687                                  	;; edx = buffer size
  3688                                  
  3689                                  	; load file into memory
  3690                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000019CA 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000019D0 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000019D2 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000019D8 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000019DD CD40                <1>  int 40h
  3691 000019DF 7247                    	jc	short lff11m_7 ; error !
  3692                                  
  3693                                  	; 01/12/2024
  3694 000019E1 A3[B87F0000]            	mov	[count], eax
  3695                                  	;;;
  3696                                  	; 07/12/2024
  3697                                  	;mov	edi, audio_buffer
  3698                                  	;;;
  3699 000019E6 21C0                    	and	eax, eax
  3700 000019E8 7505                    	jnz	short lff11m_8
  3701 000019EA E9ABF3FFFF              	jmp	lff11_eof
  3702                                  
  3703                                  lff11m_8:
  3704 000019EF 89C1                    	mov	ecx, eax		; byte count
  3705                                  lff11m_9:
  3706 000019F1 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3707                                  lff11m_1:
  3708                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3709 000019F6 AC                      	lodsb
  3710 000019F7 B280                    	mov	dl, 80h
  3711 000019F9 49                      	dec	ecx
  3712 000019FA 7402                    	jz	short lff11m_2_1
  3713 000019FC 8A16                    	mov	dl, [esi]
  3714                                  lff11m_2_1:	
  3715                                  	; al = [previous_val]
  3716                                  	; dl = [next_val]
  3717 000019FE E854050000              	call	interpolating_5_8bit_mono
  3718 00001A03 E328                    	jecxz	lff11m_3
  3719                                  lff11m_2_2:
  3720 00001A05 AC                      	lodsb
  3721 00001A06 B280                    	mov	dl, 80h
  3722 00001A08 49                      	dec	ecx
  3723 00001A09 7402                    	jz	short lff11m_2_3
  3724 00001A0B 8A16                    	mov	dl, [esi]
  3725                                  lff11m_2_3:
  3726 00001A0D E851060000               	call	interpolating_4_8bit_mono
  3727 00001A12 E319                    	jecxz	lff11m_3
  3728                                  
  3729 00001A14 4D                      	dec	ebp
  3730 00001A15 74DA                    	jz	short lff11m_9
  3731                                  
  3732 00001A17 AC                      	lodsb
  3733 00001A18 B280                    	mov	dl, 80h
  3734 00001A1A 49                      	dec	ecx
  3735 00001A1B 7402                    	jz	short lff11m_2_4
  3736 00001A1D 8A16                    	mov	dl, [esi]
  3737                                  lff11m_2_4:
  3738 00001A1F E83F060000              	call	interpolating_4_8bit_mono
  3739 00001A24 E307                    	jecxz	lff11m_3
  3740 00001A26 EBCE                    	jmp	short lff11m_1
  3741                                  
  3742                                  lff11m_7:
  3743                                  lff11s_7:
  3744 00001A28 E976F3FFFF              	jmp	lff11_5  ; error
  3745                                  
  3746                                  lff11m_3:
  3747                                  lff11s_3:
  3748 00001A2D E950F3FFFF              	jmp	lff11_3	; padfill
  3749                                  		; (put zeros in the remain words of the buffer)
  3750                                  
  3751                                  load_11khz_stereo_8_bit:
  3752                                  	; 18/11/2023
  3753 00001A32 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3754                                  					; last of the file?
  3755 00001A39 7402                    	jz	short lff11s_0		; no
  3756 00001A3B F9                      	stc
  3757 00001A3C C3                      	retn
  3758                                  
  3759                                  lff11s_0:
  3760                                  	; 01/12/2024
  3761                                  	; edi = audio buffer address
  3762 00001A3D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3763                                          ;mov	edx, [loadsize]
  3764                                  
  3765                                  	; esi = buffer address
  3766                                  	;; edx = buffer size
  3767                                  
  3768                                  	; load file into memory
  3769                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001A42 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001A48 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001A4A 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001A50 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001A55 CD40                <1>  int 40h
  3770 00001A57 72CF                    	jc	short lff11s_7 ; error !
  3771                                  
  3772                                  	; 01/12/2024
  3773 00001A59 A3[B87F0000]            	mov	[count], eax
  3774                                  	;;;
  3775                                  	; 07/12/2024
  3776                                  	;mov	edi, audio_buffer
  3777                                  	;;;
  3778 00001A5E D1E8                    	shr	eax, 1
  3779 00001A60 7505                    	jnz	short lff11s_8
  3780 00001A62 E933F3FFFF              	jmp	lff11_eof
  3781                                  
  3782                                  lff11s_8:
  3783 00001A67 89C1                    	mov	ecx, eax	; word count
  3784                                  lff11s_9:
  3785 00001A69 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3786                                  lff11s_1:
  3787                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3788 00001A6E 66AD                    	lodsw
  3789 00001A70 66BA8080                	mov	dx, 8080h
  3790 00001A74 49                      	dec	ecx
  3791 00001A75 7403                    	jz	short lff11s_2_1
  3792 00001A77 668B16                  	mov	dx, [esi]
  3793                                  lff11s_2_1:	
  3794                                  	; al = [previous_val_l]
  3795                                  	; ah = [previous_val_r]
  3796                                  	; dl = [next_val_l]
  3797                                  	; dh = [next_val_r]
  3798 00001A7A E837050000              	call	interpolating_5_8bit_stereo
  3799 00001A7F E3AC                    	jecxz	lff11s_3
  3800                                  lff11s_2_2:
  3801 00001A81 66AD                    	lodsw
  3802 00001A83 66BA8080                	mov	dx, 8080h
  3803 00001A87 49                      	dec	ecx
  3804 00001A88 7403                    	jz	short lff11s_2_3
  3805 00001A8A 668B16                  	mov	dx, [esi]
  3806                                  lff11s_2_3:
  3807 00001A8D E810060000               	call	interpolating_4_8bit_stereo
  3808 00001A92 E399                    	jecxz	lff11s_3
  3809                                  	
  3810 00001A94 4D                      	dec	ebp
  3811 00001A95 74D2                    	jz	short lff11s_9
  3812                                  
  3813 00001A97 66AD                    	lodsw
  3814 00001A99 66BA8080                	mov	dx, 8080h
  3815 00001A9D 49                      	dec	ecx
  3816 00001A9E 7403                    	jz	short lff11s_2_4
  3817 00001AA0 668B16                  	mov	dx, [esi]
  3818                                  lff11s_2_4:
  3819 00001AA3 E8FA050000              	call	interpolating_4_8bit_stereo
  3820 00001AA8 E383                    	jecxz	lff11s_3
  3821 00001AAA EBC2                    	jmp	short lff11s_1
  3822                                  
  3823                                  load_11khz_mono_16_bit:
  3824                                  	; 18/11/2023
  3825 00001AAC F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3826                                  					; last of the file?
  3827 00001AB3 7402                    	jz	short lff11m2_0		; no
  3828 00001AB5 F9                      	stc
  3829 00001AB6 C3                      	retn
  3830                                  
  3831                                  lff11m2_0:
  3832                                  	; 01/12/2024
  3833                                  	; edi = audio buffer address
  3834 00001AB7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3835                                          ;mov	edx, [loadsize]
  3836                                  
  3837                                  	; esi = buffer address
  3838                                  	;; edx = buffer size
  3839                                  
  3840                                  	; load file into memory
  3841                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001ABC 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001AC2 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001AC4 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001ACA B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001ACF CD40                <1>  int 40h
  3842 00001AD1 724D                    	jc	short lff11m2_7 ; error !
  3843                                  
  3844                                  	; 01/12/2024
  3845 00001AD3 A3[B87F0000]            	mov	[count], eax
  3846                                  	;;;
  3847                                  	; 07/12/2024
  3848                                  	;mov	edi, audio_buffer
  3849                                  	;;;
  3850 00001AD8 D1E8                    	shr	eax, 1
  3851 00001ADA 7505                    	jnz	short lff11m2_8
  3852 00001ADC E9B9F2FFFF              	jmp	lff11_eof
  3853                                  
  3854                                  lff11m2_8:
  3855 00001AE1 89C1                    	mov	ecx, eax	; word count
  3856                                  lff11m2_9:
  3857 00001AE3 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3858                                  lff11m2_1:
  3859                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3860 00001AE8 66AD                    	lodsw
  3861 00001AEA 31D2                    	xor	edx, edx
  3862 00001AEC 49                      	dec	ecx
  3863 00001AED 7403                    	jz	short lff11m2_2_1
  3864 00001AEF 668B16                  	mov	dx, [esi]
  3865                                  lff11m2_2_1:	
  3866                                  	; ax = [previous_val]
  3867                                  	; dx = [next_val]
  3868 00001AF2 E818060000              	call	interpolating_5_16bit_mono
  3869 00001AF7 E362                    	jecxz	lff11m2_3
  3870                                  lff11m2_2_2:
  3871 00001AF9 66AD                    	lodsw
  3872 00001AFB 31D2                    	xor	edx, edx
  3873 00001AFD 49                      	dec	ecx
  3874 00001AFE 7403                    	jz	short lff11m2_2_3
  3875 00001B00 668B16                  	mov	dx, [esi]
  3876                                  lff11m2_2_3:
  3877 00001B03 E831070000               	call	interpolating_4_16bit_mono
  3878 00001B08 E351                    	jecxz	lff11m2_3
  3879                                  
  3880 00001B0A 4D                      	dec	ebp
  3881 00001B0B 74D6                    	jz	short lff11m2_9
  3882                                  
  3883 00001B0D 66AD                    	lodsw
  3884 00001B0F 31D2                    	xor	edx, edx
  3885 00001B11 49                      	dec	ecx
  3886 00001B12 7403                    	jz	short lff11m2_2_4
  3887 00001B14 668B16                  	mov	dx, [esi]
  3888                                  lff11m2_2_4:
  3889 00001B17 E81D070000               	call	interpolating_4_16bit_mono
  3890 00001B1C E33D                    	jecxz	lff11m2_3
  3891 00001B1E EBC8                    	jmp	short lff11m2_1
  3892                                  
  3893                                  lff11m2_7:
  3894                                  lff11s2_7:
  3895 00001B20 E97EF2FFFF              	jmp	lff11_5  ; error
  3896                                  
  3897                                  load_11khz_stereo_16_bit:
  3898                                  	; 18/01/2025
  3899                                  	; 18/11/2023
  3900 00001B25 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3901                                  					; last of the file?
  3902 00001B2C 7402                    	jz	short lff11s2_0		; no
  3903 00001B2E F9                      	stc
  3904 00001B2F C3                      	retn
  3905                                  
  3906                                  lff11s2_0:
  3907                                  	; 01/12/2024
  3908                                  	; edi = audio buffer address
  3909 00001B30 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3910                                          ;mov	edx, [loadsize]
  3911                                  
  3912                                  	; esi = buffer address
  3913                                  	;; edx = buffer size
  3914                                  
  3915                                  	; load file into memory
  3916                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001B35 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001B3B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001B3D 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001B43 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001B48 CD40                <1>  int 40h
  3917 00001B4A 72D4                    	jc	short lff11s2_7 ; error !
  3918                                  
  3919                                  	; 01/12/2024
  3920 00001B4C A3[B87F0000]            	mov	[count], eax
  3921                                  	;;;
  3922                                  	; 07/12/2024
  3923                                  	;mov	edi, audio_buffer
  3924                                  	;;;
  3925 00001B51 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3926 00001B54 750A                    	jnz	short lff11s2_8
  3927 00001B56 E93FF2FFFF              	jmp	lff11_eof
  3928                                  
  3929                                  lff11m2_3:
  3930                                  lff11s2_3:
  3931 00001B5B E922F2FFFF              	jmp	lff11_3	; padfill
  3932                                  		; (put zeros in the remain words of the buffer)
  3933                                  
  3934                                  lff11s2_8:
  3935 00001B60 89C1                    	mov	ecx, eax	; dword count
  3936                                  lff11s2_9:
  3937 00001B62 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3938                                  lff11s2_1:
  3939                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3940 00001B67 66AD                    	lodsw
  3941 00001B69 89C3                    	mov	ebx, eax
  3942 00001B6B 66AD                    	lodsw
  3943 00001B6D 8B16                    	mov	edx, [esi]
  3944                                  	; 18/01/2025
  3945                                  	;mov	[next_val_l], edx
  3946                                  	; 26/11/2023
  3947                                  	;shr	edx, 16
  3948                                  	;mov	[next_val_r], dx
  3949 00001B6F 49                      	dec	ecx
  3950 00001B70 7502                    	jnz	short lff11s2_2_1
  3951 00001B72 31D2                    	xor	edx, edx ; 0
  3952                                  	;mov	[next_val_l], dx
  3953                                  	;mov	[next_val_r], dx
  3954                                  lff11s2_2_1:
  3955                                  	; bx = [previous_val_l]
  3956                                  	; ax = [previous_val_r]
  3957                                  	; [next_val_l]
  3958                                  	; dx = [next_val_r]
  3959                                  	;;;
  3960                                  	; 18/01/2025 (BugFix)
  3961 00001B74 8915[F3220000]          	mov	[next_val_l], edx
  3962                                  	;;;
  3963 00001B7A E8EB050000              	call	interpolating_5_16bit_stereo
  3964 00001B7F E3DA                    	jecxz	lff11s2_3
  3965                                  lff11s2_2_2:
  3966 00001B81 66AD                    	lodsw
  3967 00001B83 89C3                    	mov	ebx, eax
  3968 00001B85 66AD                    	lodsw
  3969 00001B87 8B16                    	mov	edx, [esi]
  3970                                  	; 18/01/2025
  3971                                  	;mov	[next_val_l], dx
  3972                                  	; 26/11/2023
  3973                                  	;shr	edx, 16
  3974                                  	;mov	[next_val_r], dx
  3975 00001B89 49                      	dec	ecx
  3976 00001B8A 7502                    	jnz	short lff11s2_2_3
  3977 00001B8C 31D2                    	xor	edx, edx ; 0
  3978                                  	;mov	[next_val_l], dx
  3979                                  	;mov	[next_val_r], dx
  3980                                  lff11s2_2_3:
  3981                                  	;;;
  3982                                  	; 18/01/2025 (BugFix)
  3983 00001B8E 8915[F3220000]          	mov	[next_val_l], edx
  3984                                  	;;;
  3985 00001B94 E8D9060000              	call	interpolating_4_16bit_stereo
  3986 00001B99 E3C0                    	jecxz	lff11s2_3
  3987                                  	
  3988 00001B9B 4D                      	dec	ebp
  3989 00001B9C 74C4                    	jz	short lff11s2_9
  3990                                  
  3991 00001B9E 66AD                    	lodsw
  3992 00001BA0 89C3                    	mov	ebx, eax
  3993 00001BA2 66AD                    	lodsw
  3994 00001BA4 8B16                    	mov	edx, [esi]
  3995                                  	; 18/01/2025
  3996                                  	;mov	[next_val_l], dx
  3997                                  	; 26/11/2023
  3998                                  	;shr	edx, 16
  3999                                  	;mov	[next_val_r], dx
  4000 00001BA6 49                      	dec	ecx
  4001 00001BA7 7502                    	jnz	short lff11s2_2_4
  4002 00001BA9 31D2                    	xor	edx, edx ; 0
  4003                                  	;mov	[next_val_l], dx
  4004                                  	;mov	[next_val_r], dx
  4005                                  lff11s2_2_4:
  4006                                  	;;;
  4007                                  	; 18/01/2025 (BugFix)
  4008 00001BAB 8915[F3220000]          	mov	[next_val_l], edx
  4009                                  	;;;
  4010 00001BB1 E8BC060000               	call	interpolating_4_16bit_stereo
  4011 00001BB6 E3A3                    	jecxz	lff11s2_3
  4012 00001BB8 EBAD                    	jmp	short lff11s2_1
  4013                                  
  4014                                  ; .....................
  4015                                  
  4016                                  load_44khz_mono_8_bit:
  4017                                  	; 18/11/2023
  4018 00001BBA F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4019                                  					; last of the file?
  4020 00001BC1 7402                    	jz	short lff44m_0		; no
  4021 00001BC3 F9                      	stc
  4022 00001BC4 C3                      	retn
  4023                                  
  4024                                  lff44m_0:
  4025                                  	; 01/12/2024
  4026                                  	; edi = audio buffer address
  4027 00001BC5 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4028                                          ;mov	edx, [loadsize]
  4029                                  
  4030                                  	; esi = buffer address
  4031                                  	;; edx = buffer size
  4032                                  
  4033                                  	; load file into memory
  4034                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001BCA 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001BD0 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001BD2 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001BD8 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001BDD CD40                <1>  int 40h
  4035 00001BDF 7250                    	jc	short lff44m_7 ; error !
  4036                                  
  4037                                  	; 01/12/2024
  4038 00001BE1 A3[B87F0000]            	mov	[count], eax
  4039                                  	;;;
  4040                                  	; 07/12/2024
  4041                                  	;mov	edi, audio_buffer
  4042                                  	;;;
  4043 00001BE6 21C0                    	and	eax, eax
  4044 00001BE8 7505                    	jnz	short lff44m_8
  4045 00001BEA E9ABF1FFFF              	jmp	lff44_eof
  4046                                  
  4047                                  lff44m_8:
  4048 00001BEF 89C1                    	mov	ecx, eax	; byte count
  4049                                  lff44m_9:
  4050 00001BF1 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4051 00001BF6 C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phases
  4052                                  lff44m_1:
  4053                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4054                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4055 00001BFD AC                      	lodsb
  4056 00001BFE B280                    	mov	dl, 80h
  4057 00001C00 49                      	dec	ecx
  4058 00001C01 7402                    	jz	short lff44m_2_1
  4059 00001C03 8A16                    	mov	dl, [esi]
  4060                                  lff44m_2_1:	
  4061                                  	; al = [previous_val]
  4062                                  	; dl = [next_val]
  4063 00001C05 E825020000              	call	interpolating_2_8bit_mono
  4064 00001C0A E320                    	jecxz	lff44m_3
  4065                                  lff44m_2_2:
  4066 00001C0C AC                      	lodsb
  4067 00001C0D 2C80                    	sub	al, 80h
  4068 00001C0F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4069 00001C13 66AB                    	stosw		; (L)
  4070 00001C15 66AB                    	stosw		; (R)
  4071                                  
  4072 00001C17 49                      	dec	ecx
  4073 00001C18 7412                    	jz	short lff44m_3
  4074 00001C1A 4D                      	dec	ebp
  4075 00001C1B 75EF                    	jnz	short lff44m_2_2
  4076                                  	
  4077 00001C1D FE0D[F7220000]          	dec	byte [faz]
  4078 00001C23 74CC                    	jz	short lff44m_9 
  4079 00001C25 BD0B000000              	mov	ebp, 11
  4080 00001C2A EBD1                    	jmp	short lff44m_1
  4081                                  
  4082                                  lff44m_3:
  4083                                  lff44s_3:
  4084 00001C2C E951F1FFFF              	jmp	lff44_3	; padfill
  4085                                  		; (put zeros in the remain words of the buffer)
  4086                                  lff44m_7:
  4087                                  lff44s_7:
  4088 00001C31 E96DF1FFFF              	jmp	lff44_5  ; error
  4089                                  
  4090                                  load_44khz_stereo_8_bit:
  4091                                  	; 16/11/2023
  4092 00001C36 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4093                                  					; last of the file?
  4094 00001C3D 7402                    	jz	short lff44s_0		; no
  4095 00001C3F F9                      	stc
  4096 00001C40 C3                      	retn
  4097                                  
  4098                                  lff44s_0:
  4099                                  	; 01/12/2024
  4100                                  	; edi = audio buffer address
  4101 00001C41 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4102                                          ;mov	edx, [loadsize]
  4103                                  
  4104                                  	; esi = buffer address
  4105                                  	;; edx = buffer size
  4106                                  
  4107                                  	; load file into memory
  4108                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001C46 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001C4C 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001C4E 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001C54 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001C59 CD40                <1>  int 40h
  4109 00001C5B 72D4                    	jc	short lff44s_7 ; error !
  4110                                  
  4111                                  	; 01/12/2024
  4112 00001C5D A3[B87F0000]            	mov	[count], eax
  4113                                  	;;;
  4114                                  	; 07/12/2024
  4115                                  	;mov	edi, audio_buffer
  4116                                  	;;;
  4117 00001C62 D1E8                    	shr	eax, 1
  4118 00001C64 7505                    	jnz	short lff44s_8
  4119 00001C66 E92FF1FFFF              	jmp	lff44_eof
  4120                                  
  4121                                  lff44s_8:
  4122 00001C6B 89C1                    	mov	ecx, eax	; word count
  4123                                  lff44s_9:
  4124 00001C6D BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4125 00001C72 C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4126                                  lff44s_1:
  4127                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4128                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4129 00001C79 66AD                    	lodsw
  4130 00001C7B 66BA8080                	mov	dx, 8080h
  4131 00001C7F 49                      	dec	ecx
  4132 00001C80 7403                    	jz	short lff44s_2_1
  4133 00001C82 668B16                  	mov	dx, [esi]
  4134                                  lff44s_2_1:	
  4135                                  	; al = [previous_val_l]
  4136                                  	; ah = [previous_val_r]
  4137                                  	; dl = [next_val_l]
  4138                                  	; dh = [next_val_r]
  4139 00001C85 E8C2010000              	call	interpolating_2_8bit_stereo
  4140 00001C8A E3A0                    	jecxz	lff44s_3
  4141                                  lff44s_2_2:
  4142 00001C8C AC                      	lodsb
  4143 00001C8D 2C80                    	sub	al, 80h
  4144 00001C8F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4145 00001C93 66AB                    	stosw		; (L)
  4146 00001C95 AC                      	lodsb
  4147 00001C96 2C80                    	sub	al, 80h
  4148 00001C98 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4149 00001C9C 66AB                    	stosw		; (R)
  4150                                  
  4151 00001C9E 49                      	dec	ecx
  4152 00001C9F 748B                    	jz	short lff44s_3	
  4153 00001CA1 4D                      	dec	ebp
  4154 00001CA2 75E8                    	jnz	short lff44s_2_2
  4155                                  	
  4156 00001CA4 FE0D[F7220000]          	dec	byte [faz]
  4157 00001CAA 74C1                    	jz	short lff44s_9 
  4158 00001CAC BD0B000000              	mov	ebp, 11
  4159 00001CB1 EBC6                    	jmp	short lff44s_1
  4160                                  
  4161                                  load_44khz_mono_16_bit:
  4162                                  	; 18/11/2023
  4163 00001CB3 F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4164                                  					; last of the file?
  4165 00001CBA 7402                    	jz	short lff44m2_0		; no
  4166 00001CBC F9                      	stc
  4167 00001CBD C3                      	retn
  4168                                  
  4169                                  lff44m2_0:
  4170                                  	; 01/12/2024
  4171                                  	; edi = audio buffer address
  4172 00001CBE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4173                                          ;mov	edx, [loadsize]
  4174                                  
  4175                                  	; esi = buffer address
  4176                                  	;; edx = buffer size
  4177                                  
  4178                                  	; load file into memory
  4179                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001CC3 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001CC9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001CCB 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001CD1 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001CD6 CD40                <1>  int 40h
  4180 00001CD8 724D                    	jc	short lff44m2_7 ; error !
  4181                                  
  4182                                  	; 01/12/2024
  4183 00001CDA A3[B87F0000]            	mov	[count], eax
  4184                                  	;;;
  4185                                  	; 07/12/2024
  4186                                  	;mov	edi, audio_buffer
  4187                                  	;;;
  4188 00001CDF D1E8                    	shr	eax, 1
  4189 00001CE1 7505                    	jnz	short lff44m2_8
  4190 00001CE3 E9B2F0FFFF              	jmp	lff44_eof
  4191                                  
  4192                                  lff44m2_8:
  4193 00001CE8 89C1                    	mov	ecx, eax	; word count
  4194                                  lff44m2_9:
  4195 00001CEA BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4196 00001CEF C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phases
  4197                                  lff44m2_1:
  4198                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4199                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4200 00001CF6 66AD                    	lodsw
  4201 00001CF8 31D2                    	xor	edx, edx
  4202 00001CFA 49                      	dec	ecx
  4203 00001CFB 7403                    	jz	short lff44m2_2_1
  4204 00001CFD 668B16                  	mov	dx, [esi]
  4205                                  lff44m2_2_1:	
  4206                                  	; ax = [previous_val]
  4207                                  	; dx = [next_val]
  4208 00001D00 E80B020000              	call	interpolating_2_16bit_mono
  4209 00001D05 E31B                    	jecxz	lff44m2_3
  4210                                  lff44m2_2_2:
  4211 00001D07 66AD                    	lodsw
  4212 00001D09 66AB                    	stosw		; (L)eft Channel
  4213 00001D0B 66AB                    	stosw		; (R)ight Channel
  4214                                  
  4215 00001D0D 49                      	dec	ecx
  4216 00001D0E 7412                    	jz	short lff44m2_3	
  4217 00001D10 4D                      	dec	ebp
  4218 00001D11 75F4                    	jnz	short lff44m2_2_2
  4219                                  	
  4220 00001D13 FE0D[F7220000]          	dec	byte [faz]
  4221 00001D19 74CF                    	jz	short lff44m2_9 
  4222 00001D1B BD0B000000              	mov	ebp, 11
  4223 00001D20 EBD4                    	jmp	short lff44m2_1
  4224                                  
  4225                                  lff44m2_3:
  4226                                  lff44s2_3:
  4227 00001D22 E95BF0FFFF              	jmp	lff44_3	; padfill
  4228                                  		; (put zeros in the remain words of the buffer)
  4229                                  lff44m2_7:
  4230                                  lff44s2_7:
  4231 00001D27 E977F0FFFF              	jmp	lff44_5  ; error
  4232                                  
  4233                                  load_44khz_stereo_16_bit:
  4234                                  	; 18/11/2023
  4235 00001D2C F605[327F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4236                                  					; last of the file?
  4237 00001D33 7402                    	jz	short lff44s2_0		; no
  4238 00001D35 F9                      	stc
  4239 00001D36 C3                      	retn
  4240                                  
  4241                                  lff44s2_0:
  4242                                  	; 01/12/2024
  4243                                  	; edi = audio buffer address
  4244 00001D37 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4245                                          ;mov	edx, [loadsize]
  4246                                  
  4247                                  	; esi = buffer address
  4248                                  	;; edx = buffer size
  4249                                  
  4250                                  	; load file into memory
  4251                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001D3C 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001D42 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001D44 8B15[A87F0000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001D4A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001D4F CD40                <1>  int 40h
  4252 00001D51 72D4                    	jc	short lff44s2_7 ; error !
  4253                                  
  4254                                  	; 01/12/2024
  4255 00001D53 A3[B87F0000]            	mov	[count], eax
  4256                                  	;;;
  4257                                  	; 07/12/2024
  4258                                  	;mov	edi, audio_buffer
  4259                                  	;;;
  4260 00001D58 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4261 00001D5B 7505                    	jnz	short lff44s2_8
  4262 00001D5D E938F0FFFF              	jmp	lff44_eof
  4263                                  
  4264                                  lff44s2_8:
  4265 00001D62 89C1                    	mov	ecx, eax	; dword count
  4266                                  lff44s2_9:
  4267 00001D64 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4268 00001D69 C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4269                                  lff44s2_1:
  4270                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4271                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4272 00001D70 66AD                    	lodsw
  4273 00001D72 89C3                    	mov	ebx, eax
  4274 00001D74 66AD                    	lodsw
  4275                                  	;mov	dx, [esi]
  4276                                  	;mov	[next_val_l], dx
  4277                                  	;mov	dx, [esi+2]
  4278                                  	; 26/11/2023
  4279 00001D76 8B16                    	mov	edx, [esi]
  4280 00001D78 668915[F3220000]        	mov	[next_val_l], dx
  4281 00001D7F C1EA10                  	shr	edx, 16
  4282 00001D82 49                      	dec	ecx
  4283 00001D83 7509                    	jnz	short lff44s2_2_1
  4284 00001D85 31D2                    	xor	edx, edx ; 0
  4285 00001D87 668915[F3220000]        	mov	[next_val_l], dx
  4286                                  lff44s2_2_1:
  4287                                  	; bx = [previous_val_l]
  4288                                  	; ax = [previous_val_r]
  4289                                  	; [next_val_l]
  4290                                  	; dx = [next_val_r]
  4291 00001D8E E895010000              	call	interpolating_2_16bit_stereo
  4292 00001D93 E38D                    	jecxz	lff44s2_3
  4293                                  lff44s2_2_2:
  4294                                  	;movsw		; (L)eft Channel
  4295                                  	;movsw		; (R)ight Channel
  4296 00001D95 A5                      	movsd
  4297                                  
  4298 00001D96 49                      	dec	ecx
  4299 00001D97 7489                    	jz	short lff44s2_3	
  4300 00001D99 4D                      	dec	ebp
  4301 00001D9A 75F9                    	jnz	short lff44s2_2_2
  4302                                  	
  4303 00001D9C FE0D[F7220000]          	dec	byte [faz]
  4304 00001DA2 74C0                    	jz	short lff44s2_9 
  4305 00001DA4 BD0B000000              	mov	ebp, 11
  4306 00001DA9 EBC5                    	jmp	short lff44s2_1
  4307                                  
  4308                                  ; .....................
  4309                                  
  4310                                  interpolating_3_8bit_mono:
  4311                                  	; 16/11/2023
  4312                                  	; al = [previous_val]
  4313                                  	; dl = [next_val]
  4314                                  	; original-interpolated-interpolated
  4315 00001DAB 88C3                    	mov	bl, al
  4316 00001DAD 2C80                    	sub	al, 80h
  4317 00001DAF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4318 00001DB3 66AB                    	stosw		; original sample (L)
  4319 00001DB5 66AB                    	stosw		; original sample (R)
  4320 00001DB7 88D8                    	mov	al, bl
  4321 00001DB9 00D0                    	add	al, dl
  4322 00001DBB D0D8                    	rcr	al, 1
  4323 00001DBD 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4324 00001DBF 00D8                    	add	al, bl
  4325 00001DC1 D0D8                    	rcr	al, 1
  4326 00001DC3 2C80                    	sub	al, 80h
  4327 00001DC5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4328 00001DC9 66AB                    	stosw		; interpolated sample 1 (L)
  4329 00001DCB 66AB                    	stosw		; interpolated sample 1 (R)
  4330 00001DCD 88F8                    	mov	al, bh
  4331 00001DCF 00D0                    	add	al, dl	; [next_val]
  4332 00001DD1 D0D8                    	rcr	al, 1
  4333 00001DD3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4334 00001DD7 66AB                    	stosw		; interpolated sample 2 (L)
  4335 00001DD9 66AB                    	stosw		; interpolated sample 2 (R)
  4336 00001DDB C3                      	retn
  4337                                  
  4338                                  interpolating_3_8bit_stereo:
  4339                                  	; 16/11/2023
  4340                                  	; al = [previous_val_l]
  4341                                  	; ah = [previous_val_r]
  4342                                  	; dl = [next_val_l]
  4343                                  	; dh = [next_val_r]
  4344                                  	; original-interpolated-interpolated
  4345 00001DDC 89C3                    	mov	ebx, eax
  4346 00001DDE 2C80                    	sub	al, 80h
  4347 00001DE0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4348 00001DE4 66AB                    	stosw		; original sample (L)
  4349 00001DE6 88F8                    	mov	al, bh
  4350 00001DE8 2C80                    	sub	al, 80h
  4351 00001DEA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4352 00001DEE 66AB                    	stosw		; original sample (R)
  4353 00001DF0 88D8                    	mov	al, bl
  4354 00001DF2 00D0                    	add	al, dl	; [next_val_l]
  4355 00001DF4 D0D8                    	rcr	al, 1
  4356 00001DF6 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4357 00001DF7 00D8                    	add	al, bl	; [previous_val_l]
  4358 00001DF9 D0D8                    	rcr	al, 1
  4359 00001DFB 2C80                    	sub	al, 80h
  4360 00001DFD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4361 00001E01 66AB                    	stosw		; interpolated sample 1 (L)
  4362 00001E03 88F8                    	mov	al, bh
  4363 00001E05 00F0                    	add	al, dh	; [next_val_r]
  4364 00001E07 D0D8                    	rcr	al, 1
  4365 00001E09 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4366 00001E0A 00F8                    	add	al, bh	; [previous_val_r]
  4367 00001E0C D0D8                    	rcr	al, 1
  4368 00001E0E 2C80                    	sub	al, 80h
  4369 00001E10 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4370 00001E14 66AB                    	stosw		; interpolated sample 1 (R)
  4371 00001E16 5B                      	pop	ebx ; **
  4372 00001E17 58                      	pop	eax ; *
  4373 00001E18 00D0                    	add	al, dl	; [next_val_l]
  4374 00001E1A D0D8                    	rcr	al, 1
  4375 00001E1C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4376 00001E20 66AB                    	stosw		; interpolated sample 2 (L)
  4377 00001E22 88D8                    	mov	al, bl
  4378 00001E24 00F0                    	add	al, dh	; [next_val_r]
  4379 00001E26 D0D8                    	rcr	al, 1
  4380 00001E28 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4381 00001E2C 66AB                    	stosw		; interpolated sample 2 (R)
  4382 00001E2E C3                      	retn
  4383                                  
  4384                                  interpolating_2_8bit_mono:
  4385                                  	; 16/11/2023
  4386                                  	; al = [previous_val]
  4387                                  	; dl = [next_val]
  4388                                  	; original-interpolated
  4389 00001E2F 88C3                    	mov	bl, al
  4390 00001E31 2C80                    	sub	al, 80h
  4391 00001E33 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4392 00001E37 66AB                    	stosw		; original sample (L)
  4393 00001E39 66AB                    	stosw		; original sample (R)
  4394 00001E3B 88D8                    	mov	al, bl
  4395 00001E3D 00D0                    	add	al, dl
  4396 00001E3F D0D8                    	rcr	al, 1
  4397 00001E41 2C80                    	sub	al, 80h
  4398 00001E43 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4399 00001E47 66AB                    	stosw		; interpolated sample (L)
  4400 00001E49 66AB                    	stosw		; interpolated sample (R)
  4401 00001E4B C3                      	retn
  4402                                  
  4403                                  interpolating_2_8bit_stereo:
  4404                                  	; 16/11/2023
  4405                                  	; al = [previous_val_l]
  4406                                  	; ah = [previous_val_r]
  4407                                  	; dl = [next_val_l]
  4408                                  	; dh = [next_val_r]
  4409                                  	; original-interpolated
  4410 00001E4C 89C3                    	mov	ebx, eax
  4411 00001E4E 2C80                    	sub	al, 80h
  4412 00001E50 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4413 00001E54 66AB                    	stosw		; original sample (L)
  4414 00001E56 88F8                    	mov	al, bh
  4415 00001E58 2C80                    	sub	al, 80h
  4416 00001E5A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4417 00001E5E 66AB                    	stosw		; original sample (R)
  4418 00001E60 88D8                    	mov	al, bl	; [previous_val_l]
  4419 00001E62 00D0                    	add	al, dl	; [next_val_l]
  4420 00001E64 D0D8                    	rcr	al, 1
  4421 00001E66 2C80                    	sub	al, 80h
  4422 00001E68 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4423 00001E6C 66AB                    	stosw		; interpolated sample (L)
  4424 00001E6E 88F8                    	mov	al, bh
  4425 00001E70 00F0                    	add	al, dh	; [next_val_r]
  4426 00001E72 D0D8                    	rcr	al, 1
  4427 00001E74 2C80                    	sub	al, 80h
  4428 00001E76 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4429 00001E7A 66AB                    	stosw		; interpolated sample (R)
  4430 00001E7C C3                      	retn
  4431                                  
  4432                                  interpolating_3_16bit_mono:
  4433                                  	; 16/11/2023
  4434                                  	; ax = [previous_val]
  4435                                  	; dx = [next_val]
  4436                                  	; original-interpolated-interpolated
  4437                                  
  4438 00001E7D 66AB                    	stosw		; original sample (L)
  4439 00001E7F 66AB                    	stosw		; original sample (R)
  4440 00001E81 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4441 00001E84 50                      	push	eax ; *	; [previous_val]
  4442 00001E85 80C680                  	add	dh, 80h
  4443 00001E88 6601D0                  	add	ax, dx
  4444 00001E8B 66D1D8                  	rcr	ax, 1
  4445 00001E8E 5B                      	pop	ebx ; *
  4446 00001E8F 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4447 00001E90 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4448 00001E93 66D1D8                  	rcr	ax, 1
  4449 00001E96 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4450 00001E99 66AB                    	stosw 		; interpolated sample 1 (L)
  4451 00001E9B 66AB                    	stosw		; interpolated sample 1 (R)
  4452 00001E9D 89D8                    	mov	eax, ebx
  4453 00001E9F 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4454 00001EA2 66D1D8                  	rcr	ax, 1
  4455 00001EA5 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4456 00001EA8 66AB                    	stosw		; interpolated sample 2 (L)
  4457 00001EAA 66AB                    	stosw		; interpolated sample 2 (R)
  4458 00001EAC C3                      	retn
  4459                                  
  4460                                  interpolating_3_16bit_stereo:
  4461                                  	; 16/11/2023
  4462                                  	; bx = [previous_val_l]
  4463                                  	; ax = [previous_val_r]
  4464                                  	; [next_val_l]
  4465                                  	; dx = [next_val_r]
  4466                                  	; original-interpolated-interpolated
  4467                                  
  4468 00001EAD 93                      	xchg	eax, ebx
  4469 00001EAE 66AB                    	stosw		; original sample (L)
  4470 00001EB0 93                      	xchg	eax, ebx
  4471 00001EB1 66AB                    	stosw		; original sample (R)
  4472 00001EB3 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4473 00001EB6 50                      	push	eax ; *	; [previous_val_r]
  4474 00001EB7 80C780                  	add	bh, 80h
  4475 00001EBA 8005[F4220000]80        	add	byte [next_val_l+1], 80h
  4476 00001EC1 66A1[F3220000]          	mov	ax, [next_val_l]
  4477 00001EC7 6601D8                  	add	ax, bx	; [previous_val_l]
  4478 00001ECA 66D1D8                  	rcr	ax, 1
  4479 00001ECD 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4480 00001ECE 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4481 00001ED1 66D1D8                  	rcr	ax, 1
  4482 00001ED4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4483 00001ED7 66AB                    	stosw 		; interpolated sample 1 (L)
  4484 00001ED9 58                      	pop	eax  ; *
  4485 00001EDA 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4486 00001EDD 52                      	push	edx  ; * ; [next_val_r]
  4487 00001EDE 92                      	xchg	eax, edx
  4488 00001EDF 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4489 00001EE2 66D1D8                  	rcr	ax, 1	; / 2
  4490 00001EE5 50                      	push	eax ; ** ; interpolated middle (R)
  4491 00001EE6 6601D0                  	add	ax, dx	; + [previous_val_r]
  4492 00001EE9 66D1D8                  	rcr	ax, 1
  4493 00001EEC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4494 00001EEF 66AB                    	stosw 		; interpolated sample 1 (R)
  4495 00001EF1 66A1[F3220000]          	mov	ax, [next_val_l]
  4496 00001EF7 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4497 00001EFA 66D1D8                  	rcr	ax, 1
  4498 00001EFD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4499 00001F00 66AB                    	stosw 		; interpolated sample 2 (L)
  4500 00001F02 58                      	pop	eax ; **
  4501 00001F03 5A                      	pop	edx ; *
  4502 00001F04 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4503 00001F07 66D1D8                  	rcr	ax, 1	; / 2
  4504 00001F0A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4505 00001F0D 66AB                    	stosw 		; interpolated sample 2 (L)
  4506 00001F0F C3                      	retn
  4507                                  
  4508                                  interpolating_2_16bit_mono:
  4509                                  	; 16/11/2023
  4510                                  	; ax = [previous_val]
  4511                                  	; dx = [next_val]
  4512                                  	; original-interpolated
  4513                                  
  4514 00001F10 66AB                    	stosw		; original sample (L)
  4515 00001F12 66AB                    	stosw		; original sample (R)
  4516 00001F14 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4517 00001F17 80C680                  	add	dh, 80h
  4518 00001F1A 6601D0                  	add	ax, dx
  4519 00001F1D 66D1D8                  	rcr	ax, 1
  4520 00001F20 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4521 00001F23 66AB                    	stosw		; interpolated sample (L)
  4522 00001F25 66AB                    	stosw		; interpolated sample (R)
  4523 00001F27 C3                      	retn
  4524                                  
  4525                                  interpolating_2_16bit_stereo:
  4526                                  	; 18/01/2025
  4527                                  	; 16/11/2023
  4528                                  	; bx = [previous_val_l]
  4529                                  	; ax = [previous_val_r]
  4530                                  	; [next_val_l]
  4531                                  	; dx = [next_val_r]
  4532                                  	; original-interpolated
  4533                                  
  4534 00001F28 93                      	xchg	eax, ebx
  4535 00001F29 66AB                    	stosw		; original sample (L)
  4536 00001F2B 93                      	xchg	eax, ebx
  4537 00001F2C 66AB                    	stosw		; original sample (R)
  4538 00001F2E 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4539 00001F31 80C680                  	add	dh, 80h
  4540 00001F34 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4541 00001F37 66D1D8                  	rcr	ax, 1	; / 2
  4542                                  	; 18/01/2025
  4543 00001F3A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4544                                  	;push	eax ; *	; interpolated sample (R)
  4545                                  	; 18/01/2025
  4546 00001F3D C1E010                  	shl	eax, 16
  4547 00001F40 66A1[F3220000]          	mov	ax, [next_val_l]
  4548 00001F46 80C480                  	add	ah, 80h
  4549 00001F49 80C780                  	add	bh, 80h
  4550 00001F4C 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4551 00001F4F 66D1D8                  	rcr	ax, 1	; / 2
  4552 00001F52 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4553                                  	; 18/01/2025
  4554                                  	;stosw 		; interpolated sample (L)
  4555                                  	;pop	eax ; *	
  4556                                  	;sub	ah, 80h	; -32768 to +32767 format again
  4557                                  	;stosw 		; interpolated sample (R)
  4558                                  	; 18/01/2025
  4559 00001F55 AB                      	stosd
  4560 00001F56 C3                      	retn
  4561                                  
  4562                                  interpolating_5_8bit_mono:
  4563                                  	; 17/11/2023
  4564                                  	; al = [previous_val]
  4565                                  	; dl = [next_val]
  4566                                  	; original-interpltd-interpltd-interpltd-interpltd
  4567 00001F57 88C3                    	mov	bl, al
  4568 00001F59 2C80                    	sub	al, 80h
  4569 00001F5B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4570 00001F5F 66AB                    	stosw		; original sample (L)
  4571 00001F61 66AB                    	stosw		; original sample (R)
  4572 00001F63 88D8                    	mov	al, bl
  4573 00001F65 00D0                    	add	al, dl
  4574 00001F67 D0D8                    	rcr	al, 1
  4575 00001F69 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4576 00001F6B 00D8                    	add	al, bl  ; [previous_val]
  4577 00001F6D D0D8                    	rcr	al, 1 	
  4578 00001F6F 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4579 00001F71 00D8                    	add	al, bl
  4580 00001F73 D0D8                    	rcr	al, 1
  4581 00001F75 2C80                    	sub	al, 80h
  4582 00001F77 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4583 00001F7B 66AB                    	stosw		; interpolated sample 1 (L)
  4584 00001F7D 66AB                    	stosw		; interpolated sample 1 (R)
  4585 00001F7F 88F8                    	mov	al, bh
  4586 00001F81 00F0                    	add	al, dh
  4587 00001F83 D0D8                    	rcr	al, 1
  4588 00001F85 2C80                    	sub	al, 80h
  4589 00001F87 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4590 00001F8B 66AB                    	stosw		; interpolated sample 2 (L)
  4591 00001F8D 66AB                    	stosw		; interpolated sample 2 (R)
  4592 00001F8F 88F8                    	mov	al, bh
  4593 00001F91 00D0                    	add	al, dl	; [next_val]
  4594 00001F93 D0D8                    	rcr	al, 1
  4595 00001F95 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4596 00001F97 00F8                    	add	al, bh
  4597 00001F99 D0D8                    	rcr	al, 1
  4598 00001F9B 2C80                    	sub	al, 80h
  4599 00001F9D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4600 00001FA1 66AB                    	stosw		; interpolated sample 3 (L)
  4601 00001FA3 66AB                    	stosw		; interpolated sample 3 (R)
  4602 00001FA5 88F0                    	mov	al, dh
  4603 00001FA7 00D0                    	add	al, dl
  4604 00001FA9 D0D8                    	rcr	al, 1
  4605 00001FAB 2C80                    	sub	al, 80h
  4606 00001FAD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4607 00001FB1 66AB                    	stosw		; interpolated sample 4 (L)
  4608 00001FB3 66AB                    	stosw		; interpolated sample 4 (R)
  4609 00001FB5 C3                      	retn
  4610                                  
  4611                                  interpolating_5_8bit_stereo:
  4612                                  	; 17/11/2023
  4613                                  	; al = [previous_val_l]
  4614                                  	; ah = [previous_val_r]
  4615                                  	; dl = [next_val_l]
  4616                                  	; dh = [next_val_r]
  4617                                  	; original-interpltd-interpltd-interpltd-interpltd
  4618 00001FB6 89C3                    	mov	ebx, eax
  4619 00001FB8 2C80                    	sub	al, 80h
  4620 00001FBA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4621 00001FBE 66AB                    	stosw		; original sample (L)
  4622 00001FC0 88F8                    	mov	al, bh
  4623 00001FC2 2C80                    	sub	al, 80h
  4624 00001FC4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4625 00001FC8 66AB                    	stosw		; original sample (R)
  4626 00001FCA 52                      	push	edx ; *
  4627 00001FCB 88D8                    	mov	al, bl
  4628 00001FCD 00D0                    	add	al, dl	; [next_val_l]
  4629 00001FCF D0D8                    	rcr	al, 1
  4630 00001FD1 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4631 00001FD2 00D8                    	add	al, bl	; [previous_val_l]
  4632 00001FD4 D0D8                    	rcr	al, 1
  4633 00001FD6 86D8                    	xchg	al, bl
  4634 00001FD8 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4635 00001FDA D0D8                    	rcr	al, 1
  4636 00001FDC 2C80                    	sub	al, 80h
  4637 00001FDE 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4638 00001FE2 66AB                    	stosw		; interpolated sample 1 (L)
  4639 00001FE4 88F8                    	mov	al, bh
  4640 00001FE6 00F0                    	add	al, dh	; [next_val_r]
  4641 00001FE8 D0D8                    	rcr	al, 1
  4642 00001FEA 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4643 00001FEB 00F8                    	add	al, bh	; [previous_val_r]
  4644 00001FED D0D8                    	rcr	al, 1
  4645 00001FEF 86F8                    	xchg	al, bh
  4646 00001FF1 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4647 00001FF3 D0D8                    	rcr	al, 1
  4648 00001FF5 2C80                    	sub	al, 80h
  4649 00001FF7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4650 00001FFB 66AB                    	stosw		; interpolated sample 1 (R)
  4651 00001FFD 5A                      	pop	edx ; ***
  4652 00001FFE 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4653 00001FFF 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4654 00002001 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4655 00002003 D0D8                    	rcr	al, 1
  4656 00002005 2C80                    	sub	al, 80h
  4657 00002007 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4658 0000200B 66AB                    	stosw		; interpolated sample 2 (L)
  4659 0000200D 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4660 0000200F 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4661 00002011 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4662 00002013 D0D8                    	rcr	al, 1
  4663 00002015 2C80                    	sub	al, 80h
  4664 00002017 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4665 0000201B 66AB                    	stosw		; interpolated sample 2 (R)
  4666 0000201D 5A                      	pop	edx ; *
  4667 0000201E 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4668 00002020 00D0                    	add	al, dl	; [next_val_l]
  4669 00002022 D0D8                    	rcr	al, 1
  4670 00002024 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4671 00002026 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4672 00002028 D0D8                    	rcr	al, 1
  4673 0000202A 2C80                    	sub	al, 80h
  4674 0000202C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4675 00002030 66AB                    	stosw		; interpolated sample 3 (L)
  4676 00002032 88F8                    	mov	al, bh	
  4677 00002034 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4678 00002036 D0D8                    	rcr	al, 1
  4679 00002038 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4680 0000203A 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4681 0000203C D0D8                    	rcr	al, 1
  4682 0000203E 2C80                    	sub	al, 80h
  4683 00002040 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4684 00002044 66AB                    	stosw		; interpolated sample 3 (R)
  4685 00002046 88D8                    	mov	al, bl
  4686 00002048 00D0                    	add	al, dl	; [next_val_l]
  4687 0000204A D0D8                    	rcr	al, 1
  4688 0000204C 2C80                    	sub	al, 80h
  4689 0000204E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4690 00002052 66AB                    	stosw		; interpolated sample 4 (L)
  4691 00002054 88F8                    	mov	al, bh
  4692 00002056 00F0                    	add	al, dh	; [next_val_r]
  4693 00002058 D0D8                    	rcr	al, 1
  4694 0000205A 2C80                    	sub	al, 80h
  4695 0000205C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4696 00002060 66AB                    	stosw		; interpolated sample 4 (R)
  4697 00002062 C3                      	retn
  4698                                  
  4699                                  interpolating_4_8bit_mono:
  4700                                  	; 17/11/2023
  4701                                  	; al = [previous_val]
  4702                                  	; dl = [next_val]
  4703                                  	; original-interpolated-interpolated-interpolated
  4704 00002063 88C3                    	mov	bl, al
  4705 00002065 2C80                    	sub	al, 80h
  4706 00002067 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4707 0000206B 66AB                    	stosw		; original sample (L)
  4708 0000206D 66AB                    	stosw		; original sample (R)
  4709 0000206F 88D8                    	mov	al, bl
  4710 00002071 00D0                    	add	al, dl	
  4711 00002073 D0D8                    	rcr	al, 1
  4712 00002075 86D8                    	xchg	al, bl  ; al = [previous_val]
  4713 00002077 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4714 00002079 D0D8                    	rcr	al, 1 	
  4715 0000207B 2C80                    	sub	al, 80h
  4716 0000207D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4717 00002081 66AB                    	stosw		; interpolated sample 1 (L)
  4718 00002083 66AB                    	stosw		; interpolated sample 1 (R)
  4719 00002085 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4720 00002087 2C80                    	sub	al, 80h
  4721 00002089 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4722 0000208D 66AB                    	stosw		; interpolated sample 2 (L)
  4723 0000208F 66AB                    	stosw		; interpolated sample 2 (R)
  4724 00002091 88D8                    	mov	al, bl
  4725 00002093 00D0                    	add	al, dl	; [next_val]
  4726 00002095 D0D8                    	rcr	al, 1
  4727 00002097 2C80                    	sub	al, 80h
  4728 00002099 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4729 0000209D 66AB                    	stosw		; interpolated sample 3 (L)
  4730 0000209F 66AB                    	stosw		; interpolated sample 3 (R)
  4731 000020A1 C3                      	retn
  4732                                  
  4733                                  interpolating_4_8bit_stereo:
  4734                                  	; 17/11/2023
  4735                                  	; al = [previous_val_l]
  4736                                  	; ah = [previous_val_r]
  4737                                  	; dl = [next_val_l]
  4738                                  	; dh = [next_val_r]	
  4739                                  	; original-interpolated-interpolated-interpolated
  4740 000020A2 89C3                    	mov	ebx, eax
  4741 000020A4 2C80                    	sub	al, 80h
  4742 000020A6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4743 000020AA 66AB                    	stosw		; original sample (L)
  4744 000020AC 88F8                    	mov	al, bh
  4745 000020AE 2C80                    	sub	al, 80h
  4746 000020B0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4747 000020B4 66AB                    	stosw		; original sample (R)
  4748 000020B6 88D8                    	mov	al, bl
  4749 000020B8 00D0                    	add	al, dl	; [next_val_l]
  4750 000020BA D0D8                    	rcr	al, 1
  4751 000020BC 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4752 000020BE 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4753 000020C0 D0D8                    	rcr	al, 1
  4754 000020C2 2C80                    	sub	al, 80h
  4755 000020C4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4756 000020C8 66AB                    	stosw		; interpolated sample 1 (L)
  4757 000020CA 88F8                    	mov	al, bh
  4758 000020CC 00F0                    	add	al, dh	; [next_val_r]
  4759 000020CE D0D8                    	rcr	al, 1
  4760 000020D0 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4761 000020D2 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4762 000020D4 D0D8                    	rcr	al, 1
  4763 000020D6 2C80                    	sub	al, 80h
  4764 000020D8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4765 000020DC 66AB                    	stosw		; interpolated sample 1 (R)
  4766 000020DE 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4767 000020E0 2C80                    	sub	al, 80h
  4768 000020E2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4769 000020E6 66AB                    	stosw		; interpolated sample 2 (L)
  4770 000020E8 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4771 000020EA 2C80                    	sub	al, 80h
  4772 000020EC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4773 000020F0 66AB                    	stosw		; interpolated sample 2 (L)
  4774 000020F2 88D8                    	mov	al, bl
  4775 000020F4 00D0                    	add	al, dl	; [next_val_l]
  4776 000020F6 D0D8                    	rcr	al, 1
  4777 000020F8 2C80                    	sub	al, 80h
  4778 000020FA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4779 000020FE 66AB                    	stosw		; interpolated sample 3 (L)
  4780 00002100 88F8                    	mov	al, bh
  4781 00002102 00F0                    	add	al, dh	; [next_val_r]
  4782 00002104 D0D8                    	rcr	al, 1
  4783 00002106 2C80                    	sub	al, 80h
  4784 00002108 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4785 0000210C 66AB                    	stosw		; interpolated sample 3 (R)
  4786 0000210E C3                      	retn
  4787                                  
  4788                                  interpolating_5_16bit_mono:
  4789                                  	; 18/11/2023
  4790                                  	; ax = [previous_val]
  4791                                  	; dx = [next_val]
  4792                                  	; original-interpltd-interpltd-interpltd-interpltd
  4793 0000210F 66AB                    	stosw		; original sample (L)
  4794 00002111 66AB                    	stosw		; original sample (R)
  4795 00002113 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4796 00002116 89C3                    	mov	ebx, eax ; [previous_val]
  4797 00002118 80C680                  	add	dh, 80h
  4798 0000211B 6601D0                  	add	ax, dx
  4799 0000211E 66D1D8                  	rcr	ax, 1
  4800 00002121 50                      	push	eax ; *	; interpolated middle (temporary)
  4801 00002122 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4802 00002125 66D1D8                  	rcr	ax, 1
  4803 00002128 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4804 00002129 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4805 0000212C 66D1D8                  	rcr	ax, 1	
  4806 0000212F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4807 00002132 66AB                    	stosw 		; interpolated sample 1 (L)
  4808 00002134 66AB                    	stosw		; interpolated sample 1 (R)
  4809 00002136 58                      	pop	eax ; **
  4810 00002137 5B                      	pop	ebx ; *
  4811 00002138 6601D8                  	add	ax, bx	; 1st quarter + middle
  4812 0000213B 66D1D8                  	rcr	ax, 1	; / 2
  4813 0000213E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4814 00002141 66AB                    	stosw		; interpolated sample 2 (L)
  4815 00002143 66AB                    	stosw		; interpolated sample 2 (R)
  4816 00002145 89D8                    	mov	eax, ebx
  4817 00002147 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4818 0000214A 66D1D8                  	rcr	ax, 1
  4819 0000214D 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4820 0000214E 6601D8                  	add	ax, bx	; + interpolated middle
  4821 00002151 66D1D8                  	rcr	ax, 1
  4822 00002154 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4823 00002157 66AB                    	stosw		; interpolated sample 3 (L)
  4824 00002159 66AB                    	stosw		; interpolated sample 3 (R)
  4825 0000215B 58                      	pop	eax ; *	
  4826 0000215C 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4827 0000215F 66D1D8                  	rcr	ax, 1	; / 2
  4828 00002162 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4829 00002165 66AB                    	stosw		; interpolated sample 4 (L)
  4830 00002167 66AB                    	stosw		; interpolated sample 4 (R)
  4831 00002169 C3                      	retn
  4832                                  
  4833                                  interpolating_5_16bit_stereo:
  4834                                  	; 18/11/2023
  4835                                  	; bx = [previous_val_l]
  4836                                  	; ax = [previous_val_r]
  4837                                  	; [next_val_l]
  4838                                  	; [next_val_r]
  4839                                  	; original-interpltd-interpltd-interpltd-interpltd
  4840 0000216A 51                      	push	ecx ; !
  4841 0000216B 93                      	xchg	eax, ebx
  4842 0000216C 66AB                    	stosw		; original sample (L)
  4843 0000216E 93                      	xchg	eax, ebx
  4844 0000216F 66AB                    	stosw		; original sample (R)
  4845 00002171 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4846 00002174 50                      	push	eax ; *	; [previous_val_r]
  4847 00002175 80C780                  	add	bh, 80h
  4848 00002178 8005[F4220000]80        	add	byte [next_val_l+1], 80h
  4849 0000217F 66A1[F3220000]          	mov	ax, [next_val_l]
  4850 00002185 6601D8                  	add	ax, bx	; [previous_val_l]
  4851 00002188 66D1D8                  	rcr	ax, 1
  4852 0000218B 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4853 0000218D 6601D8                  	add	ax, bx	
  4854 00002190 66D1D8                  	rcr	ax, 1
  4855 00002193 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4856 00002195 6601D8                  	add	ax, bx	; [previous_val_l]
  4857 00002198 66D1D8                  	rcr	ax, 1
  4858 0000219B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4859 0000219E 66AB                    	stosw 		; interpolated sample 1 (L)
  4860 000021A0 89C8                    	mov	eax, ecx
  4861 000021A2 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4862 000021A5 66D1D8                  	rcr	ax, 1	; / 2
  4863 000021A8 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4864 000021AA 5A                      	pop	edx ; *	; [previous_val_r]
  4865 000021AB 89D0                    	mov	eax, edx
  4866 000021AD 8005[F6220000]80        	add	byte [next_val_r+1], 80h
  4867 000021B4 660305[F5220000]        	add	ax, [next_val_r]
  4868 000021BB 66D1D8                  	rcr	ax, 1
  4869 000021BE 50                      	push	eax ; *	; interpolated middle (R)
  4870 000021BF 6601D0                  	add	ax, dx
  4871 000021C2 66D1D8                  	rcr	ax, 1
  4872 000021C5 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4873 000021C6 6601D0                  	add	ax, dx	; [previous_val_r]
  4874 000021C9 66D1D8                  	rcr	ax, 1
  4875 000021CC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4876 000021CF 66AB                    	stosw 		; interpolated sample 1 (R)
  4877 000021D1 89D8                    	mov	eax, ebx
  4878 000021D3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4879 000021D6 66AB                    	stosw 		; interpolated sample 2 (L)
  4880 000021D8 58                      	pop	eax ; **
  4881 000021D9 5A                      	pop	edx ; *
  4882 000021DA 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4883 000021DD 66D1D8                  	rcr	ax, 1	; / 2
  4884 000021E0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4885 000021E3 66AB                    	stosw 		; interpolated sample 2 (R)
  4886 000021E5 89C8                    	mov	eax, ecx
  4887 000021E7 660305[F3220000]        	add	ax, [next_val_l]
  4888 000021EE 66D1D8                  	rcr	ax, 1
  4889 000021F1 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4890 000021F2 6601C8                  	add	ax, cx	; interpolated middle (L)
  4891 000021F5 66D1D8                  	rcr	ax, 1
  4892 000021F8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4893 000021FB 66AB                    	stosw 		; interpolated sample 3 (L)
  4894 000021FD 89D0                    	mov	eax, edx
  4895 000021FF 660305[F5220000]        	add	ax, [next_val_r]
  4896 00002206 66D1D8                  	rcr	ax, 1
  4897 00002209 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4898 0000220A 6601D0                  	add	ax, dx	; interpolated middle (R)
  4899 0000220D 66D1D8                  	rcr	ax, 1
  4900 00002210 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4901 00002213 66AB                    	stosw 		; interpolated sample 3 (R)
  4902 00002215 5B                      	pop	ebx ; **
  4903 00002216 58                      	pop	eax ; *
  4904 00002217 660305[F3220000]        	add	ax, [next_val_l]
  4905 0000221E 66D1D8                  	rcr	ax, 1
  4906 00002221 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4907 00002224 66AB                    	stosw 		; interpolated sample 4 (L)
  4908 00002226 89D8                    	mov	eax, ebx
  4909 00002228 660305[F5220000]        	add	ax, [next_val_r]
  4910 0000222F 66D1D8                  	rcr	ax, 1
  4911 00002232 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4912 00002235 66AB                    	stosw 		; interpolated sample 4 (R)
  4913 00002237 59                      	pop	ecx ; !
  4914 00002238 C3                      	retn
  4915                                  
  4916                                  interpolating_4_16bit_mono:
  4917                                  	; 18/11/2023
  4918                                  	; ax = [previous_val]
  4919                                  	; dx = [next_val]
  4920                                  	; original-interpolated
  4921                                  
  4922 00002239 66AB                    	stosw		; original sample (L)
  4923 0000223B 66AB                    	stosw		; original sample (R)
  4924 0000223D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4925 00002240 89C3                    	mov	ebx, eax ; [previous_val]
  4926 00002242 80C680                  	add	dh, 80h
  4927 00002245 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4928 00002248 66D1D8                  	rcr	ax, 1
  4929 0000224B 93                      	xchg	eax, ebx
  4930 0000224C 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4931 0000224F 66D1D8                  	rcr	ax, 1
  4932 00002252 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4933 00002255 66AB                    	stosw 		; interpolated sample 1 (L)
  4934 00002257 66AB                    	stosw		; interpolated sample 1 (R)
  4935 00002259 89D8                    	mov	eax, ebx ; interpolated middle
  4936 0000225B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4937 0000225E 66AB                    	stosw 		; interpolated sample 2 (L)
  4938 00002260 66AB                    	stosw		; interpolated sample 2 (R)
  4939 00002262 89D8                    	mov	eax, ebx
  4940 00002264 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4941 00002267 66D1D8                  	rcr	ax, 1
  4942 0000226A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4943 0000226D 66AB                    	stosw		; interpolated sample 3 (L)
  4944 0000226F 66AB                    	stosw		; interpolated sample 3 (R)
  4945 00002271 C3                      	retn
  4946                                  
  4947                                  interpolating_4_16bit_stereo:
  4948                                  	; 18/11/2023
  4949                                  	; bx = [previous_val_l]
  4950                                  	; ax = [previous_val_r]
  4951                                  	; [next_val_l]
  4952                                  	; [next_val_r]
  4953                                  	; original-interpolated-interpolated-interpolated
  4954 00002272 93                      	xchg	eax, ebx
  4955 00002273 66AB                    	stosw		; original sample (L)
  4956 00002275 93                      	xchg	eax, ebx
  4957 00002276 66AB                    	stosw		; original sample (R)
  4958 00002278 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4959 0000227B 89C2                    	mov	edx, eax ; [previous_val_r]
  4960 0000227D 80C780                  	add	bh, 80h
  4961 00002280 8005[F4220000]80        	add	byte [next_val_l+1], 80h
  4962 00002287 66A1[F3220000]          	mov	ax, [next_val_l]
  4963 0000228D 6601D8                  	add	ax, bx	; [previous_val_l]
  4964 00002290 66D1D8                  	rcr	ax, 1
  4965 00002293 93                      	xchg	eax, ebx
  4966 00002294 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4967 00002297 66D1D8                  	rcr	ax, 1
  4968 0000229A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4969 0000229D 66AB                    	stosw 		; interpolated sample 1 (L)
  4970 0000229F 8005[F6220000]80        	add	byte [next_val_r+1], 80h
  4971 000022A6 89D0                    	mov	eax, edx ; [previous_val_r]
  4972 000022A8 660305[F5220000]        	add	ax, [next_val_r]
  4973 000022AF 66D1D8                  	rcr	ax, 1
  4974 000022B2 92                      	xchg	eax, edx
  4975 000022B3 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4976 000022B6 66D1D8                  	rcr	ax, 1
  4977 000022B9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4978 000022BC 66AB                    	stosw 		; interpolated sample 1 (R)
  4979 000022BE 89D8                    	mov	eax, ebx
  4980 000022C0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4981 000022C3 66AB                    	stosw 		; interpolated sample 2 (L)
  4982 000022C5 89D0                    	mov	eax, edx
  4983 000022C7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4984 000022CA 66AB                    	stosw 		; interpolated sample 2 (R)
  4985 000022CC 89D8                    	mov	eax, ebx
  4986 000022CE 660305[F3220000]        	add	ax, [next_val_l]
  4987 000022D5 66D1D8                  	rcr	ax, 1
  4988 000022D8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4989 000022DB 66AB                    	stosw 		; interpolated sample 3 (L)
  4990 000022DD 89D0                    	mov	eax, edx
  4991 000022DF 660305[F5220000]        	add	ax, [next_val_r]
  4992 000022E6 66D1D8                  	rcr	ax, 1
  4993 000022E9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4994 000022EC 66AB                    	stosw 		; interpolated sample 3 (R)
  4995 000022EE C3                      	retn
  4996                                  
  4997                                  ; 13/11/2023
  4998                                  previous_val:
  4999 000022EF 0000                    previous_val_l: dw 0
  5000 000022F1 0000                    previous_val_r: dw 0
  5001                                  next_val:
  5002 000022F3 0000                    next_val_l: dw 0
  5003 000022F5 0000                    next_val_r: dw 0
  5004                                  
  5005                                  ; 16/11/2023
  5006 000022F7 00                      faz:	db 0
  5007                                  
  5008                                  ; --------------------------------------------------------
  5009                                  ; --------------------------------------------------------
  5010                                  
  5011                                  ; 07/12/2024
  5012                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  5013                                  ;		'sysaudio' system call (23/08/2024)
  5014                                  ; 18/11/2024
  5015                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  5016                                  
  5017                                  ac97_stop: 
  5018                                  	; 18/11/2024
  5019 000022F8 C605[F07E0000]02        	mov	byte [stopped], 2
  5020                                  	; 07/12/2024
  5021                                  	sys	_audio, 0700h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000022FF BB00070000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002304 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002309 CD40                <1>  int 40h
  5022 0000230B C3                      	retn
  5023                                  
  5024                                  ac97_pause:
  5025                                  	; 18/11/2024
  5026 0000230C C605[F07E0000]01        	mov	byte [stopped], 1 ; paused
  5027                                  	; 07/12/2024
  5028                                  	sys	_audio, 0500h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002313 BB00050000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002318 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000231D CD40                <1>  int 40h
  5029 0000231F C3                      	retn
  5030                                  
  5031                                  ac97_play: ; continue to play (after pause)
  5032                                  	; 18/11/2024
  5033 00002320 C605[F07E0000]00        	mov	byte [stopped], 0
  5034                                  	; 07/12/2024	
  5035                                  	sys	_audio, 0600h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002327 BB00060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000232C B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002331 CD40                <1>  int 40h
  5036 00002333 C3                      	retn
  5037                                  	
  5038                                  ; --------------------------------------------------------
  5039                                  ; 14/11/2024 - Erdogan Tan
  5040                                  ; --------------------------------------------------------
  5041                                  
  5042                                  	; 07/12/2024
  5043                                  	; 01/12/2024 (32bit registers)
  5044                                  	; 29/11/2024
  5045                                  checkUpdateEvents:
  5046 00002334 E8FA010000              	call	check4keyboardstop
  5047 00002339 7279                    	jc	short c4ue_ok
  5048                                  
  5049                                  	; 18/11/2024
  5050 0000233B 50                      	push	eax ; *
  5051 0000233C 09C0                    	or	eax, eax
  5052 0000233E 0F8406010000            	jz	c4ue_cpt
  5053                                  
  5054                                  	; 18/11/2024
  5055 00002344 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  5056 00002346 7543                    	jne	short c4ue_chk_s
  5057 00002348 803D[F07E0000]00        	cmp	byte [stopped], 0
  5058 0000234F 7714                    	ja	short c4ue_chk_ps
  5059                                  	; pause
  5060 00002351 E8B6FFFFFF              	call	ac97_pause
  5061                                  	; 21/11/2024
  5062 00002356 A0[F17E0000]            	mov	al, [tLO]
  5063 0000235B A2[F27E0000]            	mov	byte [tLP], al
  5064 00002360 E9E5000000              	jmp	c4ue_cpt
  5065                                  c4ue_chk_ps:
  5066 00002365 803D[F07E0000]01        	cmp	byte [stopped], 1
  5067 0000236C 770A                    	ja	short c4ue_replay
  5068                                  	; continue to play (after a pause)
  5069 0000236E E8ADFFFFFF              	call	ac97_play 
  5070 00002373 E9D2000000              	jmp	c4ue_cpt
  5071                                  c4ue_replay:
  5072                                  	; 19/11/2024
  5073 00002378 58                      	pop	eax ; *
  5074 00002379 58                      	pop	eax ; return address
  5075                                  	; 07/02/2024
  5076                                  	;mov	al, [volume]
  5077                                  	;call	SetmasterVolume
  5078 0000237A C605[F07E0000]00        	mov	byte [stopped], 0
  5079 00002381 E8C7040000              	call	move_to_beginning
  5080                                  	;jmp	PlayWav
  5081                                  	; 07/12/2024
  5082 00002386 E97FE3FFFF              	jmp	RePlayWav
  5083                                  
  5084                                  c4ue_chk_s:
  5085 0000238B 3C53                    	cmp	al, 'S'	; stop
  5086 0000238D 7526                    	jne	short c4ue_chk_fb
  5087 0000238F 803D[F07E0000]00        	cmp	byte [stopped], 0
  5088 00002396 0F87AE000000            	ja	c4ue_cpt ; Already stopped/paused
  5089 0000239C E857FFFFFF              	call	ac97_stop
  5090                                  	; 19/11/2024
  5091 000023A1 C605[F17E0000]00        	mov	byte [tLO], 0
  5092                                  	; 21/11/2024
  5093 000023A8 C605[F27E0000]30        	mov	byte [tLP], '0'
  5094 000023AF E996000000              	jmp	c4ue_cpt
  5095                                  
  5096                                  	; 01/12/2024
  5097                                  	; 18/11/2024
  5098                                  c4ue_ok:
  5099 000023B4 C3                      	retn
  5100                                  
  5101                                  c4ue_chk_fb:
  5102                                  	; 17/11/2024
  5103 000023B5 3C46                    	cmp	al, 'F'
  5104 000023B7 750A                    	jne	short c4ue_chk_b
  5105 000023B9 E867040000              	call 	Player_ProcessKey_Forwards
  5106 000023BE E987000000              	jmp	c4ue_cpt
  5107                                  
  5108                                  c4ue_chk_b:
  5109 000023C3 3C42                    	cmp	al, 'B'
  5110                                  	;;jne	short c4ue_cpt
  5111                                  	; 19/11/2024
  5112                                  	;jne	short c4ue_chk_h
  5113                                  	; 25/12/2024
  5114                                  	; 29/11/2024
  5115 000023C5 7507                    	jne	short c4ue_chk_n
  5116 000023C7 E855040000              	call 	Player_ProcessKey_Backwards
  5117 000023CC EB7C                    	jmp	short c4ue_cpt
  5118                                  
  5119                                  	;;;
  5120                                  	; 25/12/2024
  5121                                  	; 29/11/2024
  5122                                  c4ue_chk_n:
  5123 000023CE 3C4E                    	cmp	al, 'N'
  5124 000023D0 7404                    	je	short c4ue_nps
  5125                                  c4ue_chk_p:
  5126 000023D2 3C50                    	cmp	al, 'P'
  5127 000023D4 7509                    	jne	short c4ue_chk_h
  5128                                  c4ue_nps:
  5129 000023D6 C605[F07E0000]03        	mov	byte [stopped], 3
  5130 000023DD EB6B                    	jmp	short c4ue_cpt
  5131                                  	;;;
  5132                                  
  5133                                  c4ue_chk_h:
  5134                                  	; 19/11/2024
  5135 000023DF 3C48                    	cmp	al, 'H'
  5136 000023E1 7515                    	jne	short c4ue_chk_cr
  5137 000023E3 C605[F37E0000]00        	mov	byte [wleds], 0
  5138 000023EA E895E6FFFF              	call 	write_ac97_pci_dev_info
  5139                                  	;;;
  5140                                  	;24/12/2024 (wave lighting points option)
  5141 000023EF C605[FF7E0000]01        	mov	byte [p_mode], 1
  5142                                  	;;;
  5143                                  	;mov	dh, 24
  5144                                  	;mov	dl, 79
  5145                                  	;call	setCursorPosition
  5146                                  	; 21/12/2024
  5147 000023F6 EB52                    	jmp	short c4ue_cpt
  5148                                  c4ue_chk_cr:
  5149                                  	;;;
  5150                                  	; 24/12/2024 (wave lighting points option)
  5151 000023F8 8A25[F37E0000]          	mov	ah, [wleds]
  5152 000023FE 3C47                    	cmp	al, 'G'
  5153 00002400 7432                    	je	short c4ue_g
  5154                                  ;	;;;
  5155                                  ;	; 26/12/2024
  5156                                  ;	cmp	al, 'T'
  5157                                  ;	jne	short c4ue_chk_cr_@
  5158                                  ;	inc	byte [tcolor]
  5159                                  ;	and 	byte [tcolor], 0Fh
  5160                                  ;	jnz	short c4ue_cpt
  5161                                  ;	inc	byte [tcolor]
  5162                                  ;	jmp	short c4ue_cpt
  5163                                  ;c4ue_chk_cr_@:
  5164                                  ;	;;;
  5165                                  	; 19/11/2024
  5166 00002402 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  5167 00002404 7544                    	jne	short c4ue_cpt
  5168                                  	;inc	byte [wleds]
  5169                                  	;jnz	short c4ue_cpt
  5170                                  	;inc	byte [wleds]
  5171                                  	;;;
  5172                                  	; 24/12/2024
  5173                                  	; 22/12/2024 (faster method)
  5174                                  	; (UpdateWaveLeds procedure turns off previously
  5175                                  	;  lighting wave leds only)
  5176                                  	;call	reset_wave_leds ; prepare all leds as turned off
  5177                                  	;;;
  5178                                  	; 23/11/2024
  5179 00002406 31DB                    	xor	ebx, ebx
  5180                                  	; 24/12/2024 (wave lighting points option)
  5181 00002408 881D[FF7E0000]          	mov	[p_mode], bl ; 0
  5182                                  	;
  5183                                  	;mov	bl, [wleds]
  5184 0000240E 88E3                    	mov	bl, ah ; 24/12/2024
  5185 00002410 FEC3                    	inc	bl
  5186 00002412 80E30F                  	and	bl, 0Fh
  5187 00002415 7501                    	jnz	short c4ue_sc
  5188 00002417 43                      	inc	ebx
  5189                                  c4ue_sc:
  5190 00002418 881D[F37E0000]          	mov	[wleds], bl
  5191 0000241E D0EB                    	shr	bl, 1
  5192 00002420 8A83[8D410000]          	mov	al, [ebx+colors]
  5193                                  	; 24/12/2024
  5194 00002426 A2[95410000]            	mov	[ccolor], al
  5195 0000242B 7211                    	jc	short c4ue_g_@
  5196                                  	; 24/12/2024
  5197 0000242D E865040000              	call	reset_wave_leds ; prepare all leds as turned off
  5198 00002432 EB16                    	jmp	short c4ue_cpt
  5199                                  	; 24/12/2024
  5200                                  c4ue_g:
  5201 00002434 08E4                    	or	ah, ah	; byte [wleds]
  5202 00002436 7506                    	jnz	short c4ue_g_@
  5203 00002438 FE05[F37E0000]          	inc	byte [wleds]	; force wave lighting ('G' key)
  5204                                  c4ue_g_@:
  5205                                  	; 24/12/2024 (wave lighting points option)
  5206 0000243E C605[FF7E0000]01        	mov	byte [p_mode], 1
  5207 00002445 E832040000              	call	clear_window
  5208                                  	;;;
  5209                                  c4ue_cpt:
  5210                                  	; 24/12/2024
  5211                                  	; 18/11/2024
  5212 0000244A 59                      	pop	ecx ; *
  5213                                  	;;;
  5214                                  	; 24/12/2024 (skip wave lighting if data is not loaded yet)
  5215 0000244B 803D[977F0000]00        	cmp	byte [SRB], 0
  5216 00002452 7751                    	ja	short c4ue_vb_ok
  5217                                  	;;;
  5218                                  	; 01/12/2024 (TRDOS 386)
  5219                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second),
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002454 BB04000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002459 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 0000245E CD40                <1>  int 40h
  5220                                  	; 24/12/2024
  5221                                  	; 18/11/2024
  5222                                  	;pop	ecx ; *
  5223                                  	; 01/12/2024
  5224 00002460 3B05[C07F0000]          	cmp	eax, [timerticks]
  5225                                  	;je	short c4ue_ok
  5226                                  	; 18/11/2024
  5227 00002466 7407                    	je	short c4ue_skip_utt
  5228                                  c4ue_utt:	
  5229                                  	; 01/12/2024
  5230 00002468 A3[C07F0000]            	mov	[timerticks], eax
  5231 0000246D EB04                    	jmp	short c4ue_cpt_@
  5232                                  c4ue_skip_utt:
  5233                                  	; 18/11/2024
  5234 0000246F 21C9                    	and	ecx, ecx
  5235 00002471 7432                    	jz	short c4ue_vb_ok
  5236                                  c4ue_cpt_@:
  5237                                  	; 18/11/2024
  5238 00002473 803D[F07E0000]00        	cmp	byte [stopped], 0
  5239 0000247A 7729                    	ja	short c4ue_vb_ok
  5240                                  	
  5241 0000247C E8E3010000              	call	CalcProgressTime
  5242                                  
  5243                                  	;cmp	ax, [ProgressTime]
  5244                                  	; 01/12/2024
  5245 00002481 3B05[B47F0000]          	cmp	eax, [ProgressTime]
  5246                                  	;je	short c4ue_vb_ok
  5247                                  			; same second, no need to update
  5248                                  	; 23/11/2024
  5249 00002487 7405                    	je	short c4ue_uvb
  5250                                  
  5251                                  	;call	UpdateProgressTime
  5252                                  	;call	UpdateProgressBar@
  5253 00002489 E807030000              	call	UpdateProgressBar
  5254                                  
  5255                                  	; 23/11/2024
  5256                                  c4ue_uvb:
  5257 0000248E 803D[F37E0000]00        	cmp	byte [wleds], 0
  5258 00002495 760E                    	jna	short c4ue_vb_ok
  5259                                  
  5260                                  	; 24/12/2024 (wave points mode)
  5261 00002497 803D[FF7E0000]00        	cmp	byte [p_mode], 0
  5262 0000249E 7706                    	ja	short c4ue_uwp
  5263                                  
  5264 000024A0 E83C040000              	call	UpdateWaveLeds
  5265                                  
  5266                                  c4ue_vb_ok:
  5267 000024A5 C3                      	retn
  5268                                  
  5269                                  	; 22/12/2024
  5270                                  c4ue_uwp:
  5271                                  	;call	UpdateWavePoints
  5272                                  	;retn
  5273                                  
  5274                                  ; --------------------------------------------------------
  5275                                  ; 24/12/2024 - Erdogan Tan
  5276                                  ; --------------------------------------------------------
  5277                                  
  5278                                  	; 26/12/2024
  5279                                  	; 24/12/2024
  5280                                  UpdateWavePoints:
  5281 000024A6 BE[F0740000]            	mov	esi, prev_points
  5282 000024AB 833E00                  	cmp	dword [esi], 0
  5283 000024AE 740B                    	jz	short lights_off_ok
  5284 000024B0 B980020000              	mov	ecx, 640
  5285                                  light_off:
  5286 000024B5 AD                      	lodsd
  5287                                  	; eax = wave point (lighting point) address
  5288 000024B6 C60000                  	mov	byte [eax], 0 ; black point (light off)
  5289 000024B9 E2FA                    	loop	light_off	
  5290                                  lights_off_ok:
  5291 000024BB 8A15[FD7E0000]          	mov	dl, [half_buffer]
  5292 000024C1 3815[FC7E0000]          	cmp	[pbuf_s], dl
  5293 000024C7 7520                    	jne	short lights_on_2
  5294 000024C9 8B1D[D8740000]          	mov	ebx, [wpoints_dif]
  5295 000024CF 8B35[F87E0000]          	mov	esi, [pbuf_o]
  5296 000024D5 8B0D[AC7F0000]          	mov	ecx, [buffersize] ; bytes
  5297 000024DB 29D9                    	sub	ecx, ebx ; sub ecx, [wpoints_dif]
  5298 000024DD 01DE                    	add	esi, ebx
  5299 000024DF 7204                    	jc	short lights_on_1
  5300 000024E1 39CE                    	cmp	esi, ecx
  5301 000024E3 760C                    	jna	short lights_on_3
  5302                                  lights_on_1:
  5303 000024E5 89CE                    	mov	esi, ecx
  5304 000024E7 EB08                    	jmp	short lights_on_3
  5305                                  
  5306                                  lights_on_2:
  5307 000024E9 8815[FC7E0000]          	mov	[pbuf_s], dl
  5308 000024EF 31F6                    	xor	esi, esi ; 0
  5309                                  lights_on_3:
  5310 000024F1 8935[F87E0000]          	mov	[pbuf_o], esi
  5311                                  	;
  5312 000024F7 81C6[00800000]          	add	esi, audio_buffer
  5313 000024FD B980020000              	mov	ecx, 640
  5314 00002502 89CD                    	mov	ebp, ecx
  5315                                  	; 26/12/2024
  5316 00002504 BF[F0740000]            	mov	edi, prev_points
  5317 00002509 8B1D[DC740000]          	mov	ebx, [graphstart] ; start (top) line
  5318                                  lights_on_4:
  5319 0000250F 31C0                    	xor	eax, eax ; 0
  5320 00002511 66AD                    	lodsw	; left
  5321 00002513 80C480                  	add	ah, 80h
  5322 00002516 89C2                    	mov	edx, eax
  5323 00002518 66AD                    	lodsw	; right
  5324                                  	;add	ax, dx
  5325 0000251A 80C480                  	add	ah, 80h
  5326                                  	;shr	eax, 9	; 128 volume levels
  5327 0000251D 01D0                    	add	eax, edx
  5328                                  	;shr	eax, 10	; (L+R/2) & 128 volume levels
  5329 0000251F C1E809                  	shr	eax, 9	; (L+R/2) & 256 volume levels
  5330 00002522 F7E5                    	mul	ebp	; * 640 (row)
  5331 00002524 01D8                    	add	eax, ebx ; + column
  5332 00002526 8A15[95410000]          	mov	dl, [ccolor]
  5333 0000252C 8810                    	mov	[eax], dl ; pixel (light on) color
  5334 0000252E AB                      	stosd		; save light on addr in prev_points
  5335 0000252F 43                      	inc	ebx
  5336 00002530 E2DD                    	loop	lights_on_4
  5337 00002532 C3                      	retn
  5338                                  
  5339                                  ; --------------------------------------------------------
  5340                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  5341                                  ; --------------------------------------------------------
  5342                                  
  5343                                  	; 25/12/2024
  5344                                  	; 07/12/2024
  5345                                  	; 01/12/2024 (TRDOS 386)
  5346                                  	; 29/11/2024
  5347                                  check4keyboardstop:
  5348                                  	; 19/05/2024
  5349                                  	; 08/11/2023
  5350                                  	; 04/11/2023
  5351 00002533 B401                    	mov	ah, 1
  5352                                  	;int	16h
  5353                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5354 00002535 CD32                    	int	32h
  5355                                  	;clc
  5356 00002537 7433                    	jz	short _cksr
  5357                                  
  5358 00002539 30E4                    	xor	ah, ah
  5359                                  	;int	16h
  5360                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5361 0000253B CD32                    	int	32h
  5362                                  
  5363                                  	; 25/12/2024
  5364                                  	; 29/11/2024
  5365                                  	;mov	[command], al
  5366                                  
  5367                                  	;;;
  5368                                  	; 19/05/2024 (change PCM out volume)
  5369 0000253D 3C2B                    	cmp	al, '+'
  5370 0000253F 750D                    	jne	short p_1
  5371                                  	
  5372 00002541 A0[96250000]            	mov	al, [volume]
  5373 00002546 3C00                    	cmp	al, 0
  5374 00002548 7624                    	jna	short p_3
  5375 0000254A FEC8                    	dec	al
  5376 0000254C EB0F                    	jmp	short p_2
  5377                                  p_1:
  5378 0000254E 3C2D                    	cmp	al, '-'
  5379 00002550 751D                    	jne	short p_4
  5380                                  
  5381 00002552 A0[96250000]            	mov	al, [volume]
  5382 00002557 3C1F                    	cmp	al, 31
  5383 00002559 7313                    	jnb	short p_3
  5384 0000255B FEC0                    	inc	al
  5385                                  p_2:
  5386 0000255D A2[96250000]            	mov	[volume], al
  5387                                  	; 14/11/2024
  5388                                  	;call	SetPCMOutVolume
  5389                                  	; 15/11/2024 (QEMU)
  5390                                  	; 07/12/2024
  5391 00002562 E850E3FFFF              	call	SetMasterVolume
  5392                                  	;call	UpdateVolume
  5393                                  	;;clc
  5394                                  	;retn
  5395 00002567 E999010000              	jmp	UpdateVolume
  5396                                  	;mov	ah, al
  5397                                  	;mov    dx, [NAMBAR]
  5398                                    	;;add   dx, CODEC_MASTER_VOL_REG
  5399                                  	;add	dx, CODEC_PCM_OUT_REG
  5400                                  	;out    dx, ax
  5401                                  	;
  5402                                  	;call   delay1_4ms
  5403                                          ;call   delay1_4ms
  5404                                          ;call   delay1_4ms
  5405                                          ;call   delay1_4ms
  5406                                  _cksr:		; 19/05/2024
  5407                                  	; 18/12/2024
  5408 0000256C 31C0                    	xor	eax, eax
  5409                                  	;clc
  5410                                  p_3:
  5411 0000256E C3                      	retn
  5412                                  p_4:
  5413                                  	; 17/11/2024
  5414 0000256F 80FC01                  	cmp	ah, 01h  ; ESC
  5415 00002572 7419                        	je	short p_q
  5416                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5417 00002574 3C03                    	cmp	al, 03h  ; CTRL+C
  5418 00002576 7415                    	je	short p_q
  5419                                  
  5420                                  	; 18/11/2024
  5421 00002578 3C20                    	cmp	al, 20h
  5422 0000257A 7419                    	je	short p_r
  5423                                  
  5424                                  	; 19/11/2024
  5425 0000257C 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5426 0000257E 7415                    	je	short p_r
  5427                                  
  5428 00002580 24DF                    	and	al, 0DFh
  5429                                  
  5430                                  	; 25/12/2024
  5431                                  	; 29/11/2024
  5432 00002582 A2[007F0000]            	mov	[command], al
  5433                                  
  5434                                  	;cmp	al, 'B'
  5435                                  	;je	short p_r
  5436                                  	;cmp	al, 'F'
  5437                                  	;je	short p_r
  5438                                  
  5439                                  	; 29/11/2024
  5440                                  	;cmp	al, 'N'
  5441                                  	;je	short p_r
  5442                                  	;cmp	al, 'P'
  5443                                  	;je	short p_r
  5444                                  
  5445 00002587 3C51                    	cmp	al, 'Q'
  5446                                  	;je	short p_q
  5447 00002589 7409                    	je	short p_quit ; 29/11/2024
  5448                                  
  5449 0000258B F8                      	clc
  5450 0000258C C3                      	retn
  5451                                  
  5452                                  	;;;
  5453                                  ;_cskr:	
  5454                                  p_q:
  5455                                  	; 27/12/2024
  5456 0000258D C605[007F0000]51        	mov	byte [command], 'Q'
  5457                                  p_quit:
  5458 00002594 F9                      	stc
  5459                                  p_r:
  5460 00002595 C3                      	retn
  5461                                  
  5462                                  ; 29/05/2024
  5463                                  ; 19/05/2024
  5464                                  volume: 
  5465                                  	;db	02h
  5466                                  ; 26/12/2024
  5467 00002596 03                      	db	03h
  5468                                  
  5469                                  ; --------------------------------------------------------
  5470                                  
  5471                                  	; 22/12/2024
  5472                                  	; 21/12/2024
  5473                                  	; simulate cursor position in VGA (VESA VBE) mode
  5474                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5475                                  setCursorPosition:
  5476                                  	; dh = Row
  5477                                  	; dl = Column
  5478                                  	
  5479 00002597 31C0                    	xor	eax, eax
  5480 00002599 B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5481 0000259B F6E6                    	mul	dh
  5482 0000259D 6683C007                	add	ax, 7	; top margin
  5483 000025A1 C1E010                  	shl	eax, 16
  5484 000025A4 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5485 000025A6 66C1E003                	shl	ax, 3
  5486                                  			; hw = row, ax = column
  5487 000025AA A3[E4740000]            	mov	[screenpos], eax
  5488                                  	; 22/12/2024
  5489 000025AF 31C0                    	xor	eax, eax
  5490 000025B1 C3                      	retn
  5491                                  	
  5492                                  ; --------------------------------------------------------
  5493                                  ; 14/11/2024
  5494                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5495                                  
  5496                                  ;; NAME:	SetTotalTime
  5497                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5498                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5499                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5500                                  ;; 		Output on the screen of the total time in seconds
  5501                                  
  5502                                  	; 01/12/2024 (32 bit registers)
  5503                                  SetTotalTime:
  5504                                  	;; Calculate total seconds in file
  5505                                  	;mov	ax, [DATA_SubchunkSize]
  5506                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5507                                  	;mov	bx, [WAVE_SampleRate]
  5508                                  	;div	bx
  5509                                  	;xor	dx, dx
  5510                                  	; 01/12/2024
  5511 000025B2 A1[2C7F0000]            	mov	eax, [DATA_SubchunkSize]
  5512 000025B7 0FB71D[1C7F0000]        	movzx	ebx, word [WAVE_SampleRate]
  5513 000025BE 31D2                    	xor	edx, edx
  5514 000025C0 F7F3                    	div	ebx
  5515                                  
  5516                                  	;mov	bx, [WAVE_BlockAlign]
  5517                                  	;div	bx
  5518                                  	; 01/12/2024
  5519 000025C2 668B1D[247F0000]        	mov	bx, [WAVE_BlockAlign]
  5520 000025C9 31D2                    	xor	edx, edx
  5521 000025CB F7F3                    	div	ebx
  5522                                  
  5523                                  	;mov	[TotalTime], ax
  5524 000025CD A3[B07F0000]            	mov	[TotalTime], eax
  5525                                  
  5526 000025D2 B33C                    	mov	bl, 60
  5527 000025D4 F6F3                    	div	bl
  5528                                  
  5529                                  	;; al = minutes, ah = seconds
  5530 000025D6 50                      	push	eax ; **
  5531 000025D7 50                      	push	eax ; *
  5532                                  
  5533                                  	;mov	dh, 24
  5534                                  	; 21/12/2024 (640*480)
  5535 000025D8 B620                    	mov	dh, 32
  5536 000025DA B22A                    	mov	dl, 42
  5537 000025DC E8B6FFFFFF              	call	setCursorPosition
  5538                                  
  5539 000025E1 58                      	pop	eax ; *
  5540 000025E2 30E4                    	xor	ah, ah
  5541 000025E4 BD02000000              	mov	ebp, 2
  5542 000025E9 E812000000              	call	PrintNumber
  5543                                  	
  5544                                  	;mov	dh, 24
  5545                                  	; 21/12/2024 (640*480)
  5546 000025EE B620                    	mov	dh, 32
  5547 000025F0 B22D                    	mov	dl, 45
  5548 000025F2 E8A0FFFFFF              	call	setCursorPosition
  5549                                  
  5550 000025F7 58                      	pop	eax ; **
  5551 000025F8 88E0                    	mov	al, ah
  5552 000025FA 30E4                    	xor	ah, ah
  5553                                  	; 21/12/2024
  5554 000025FC 66BD0200                	mov	bp, 2
  5555                                  	;jmp	short PrintNumber
  5556                                  
  5557                                  ; --------------------------------------------------------
  5558                                  
  5559                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5560                                  	; 01/12/2024 (32bit registers)
  5561                                  PrintNumber:
  5562                                  	; eax = binary number
  5563                                  	; ebp = digits
  5564 00002600 8B35[E4740000]          	mov	esi, [screenpos]
  5565                                  		; hw = row, si = column
  5566 00002606 BB0A000000              	mov	ebx, 10
  5567 0000260B 31C9                    	xor	ecx, ecx
  5568                                  printNumber_CutNumber:
  5569 0000260D 41                      	inc	ecx
  5570 0000260E 31D2                    	xor	edx, edx
  5571 00002610 F7F3                    	div	ebx
  5572 00002612 52                      	push	edx
  5573 00002613 39E9                    	cmp	ecx, ebp
  5574 00002615 7402                    	je	short printNumber_printloop
  5575 00002617 EBF4                    	jmp	printNumber_CutNumber
  5576                                  
  5577                                  printNumber_printloop:
  5578 00002619 58                      	pop	eax
  5579                                  	; 21/12/2024
  5580                                  	; ebp = count of digits
  5581                                  	; eax <= 9
  5582                                  
  5583 0000261A 0430                    	add	al, '0'
  5584                                  	
  5585                                  	; esi = pixel position (hw = row, si = column)
  5586                                  	; eax = al = character
  5587                                  	;call	write_character
  5588                                  	; 22/12/2024
  5589 0000261C E82A010000              	call	write_character_white
  5590                                  
  5591 00002621 4D                      	dec	ebp
  5592 00002622 7405                     	jz	short printNumber_ok
  5593 00002624 83C608                  	add	esi, 8	; next column
  5594 00002627 EBF0                    	jmp	short printNumber_printloop
  5595                                  printNumber_ok:
  5596 00002629 C3                      	retn
  5597                                  
  5598                                  ; --------------------------------------------------------
  5599                                  
  5600                                  	; 14/11/2024 - Erdogan Tan
  5601                                  SetProgressTime:
  5602                                  	;; Calculate playing/progress seconds in file
  5603 0000262A E835000000              	call	CalcProgressTime
  5604                                  
  5605                                  	; 01/12/2024 (32bit registers)
  5606                                  UpdateProgressTime:
  5607                                  	; eax = (new) progress time 
  5608                                  
  5609 0000262F A3[B47F0000]            	mov	[ProgressTime], eax
  5610                                  
  5611 00002634 B33C                    	mov	bl, 60
  5612 00002636 F6F3                    	div	bl
  5613                                  
  5614                                  	;; al = minutes, ah = seconds
  5615 00002638 50                      	push	eax ; **
  5616 00002639 50                      	push	eax ; *
  5617                                  
  5618                                  	;mov	dh, 24
  5619                                  	; 21/12/2024 (640*480)
  5620 0000263A B620                    	mov	dh, 32
  5621 0000263C B221                    	mov	dl, 33
  5622 0000263E E854FFFFFF              	call	setCursorPosition
  5623                                  
  5624 00002643 58                      	pop	eax ; *
  5625 00002644 30E4                    	xor	ah, ah
  5626 00002646 BD02000000              	mov	ebp, 2
  5627 0000264B E8B0FFFFFF              	call	PrintNumber
  5628                                  	
  5629                                  	;mov	dh, 24
  5630                                  	; 21/12/2024 (640*480)
  5631 00002650 B620                    	mov	dh, 32
  5632 00002652 B224                    	mov	dl, 36
  5633 00002654 E83EFFFFFF              	call	setCursorPosition
  5634                                  
  5635 00002659 58                      	pop	eax ; **
  5636 0000265A 88E0                    	mov	al, ah
  5637 0000265C 30E4                    	xor	ah, ah
  5638                                  	; 21/12/2024
  5639 0000265E 66BD0200                	mov	bp, 2
  5640 00002662 EB9C                    	jmp	short PrintNumber
  5641                                  
  5642                                  ; --------------------------------------------------------
  5643                                  
  5644                                  	; 01/12/2024 (32bit registers)
  5645                                  	; 17/11/2024
  5646                                  	; 14/11/2024
  5647                                  CalcProgressTime:
  5648                                  	;mov	ax, [LoadedDataBytes]
  5649                                  	;mov	dx, [LoadedDataBytes+2]
  5650                                  	;mov	bx, ax
  5651                                  	;or	bx, dx
  5652                                  	;jz	short cpt_ok
  5653                                  	; 01/12/2024
  5654 00002664 A1[BC7F0000]            	mov	eax, [LoadedDataBytes]
  5655 00002669 09C0                    	or	eax, eax
  5656 0000266B 7416                    	jz	short cpt_ok
  5657                                  
  5658                                  	;mov	bx, [WAVE_SampleRate]
  5659                                  	;div	bx
  5660                                  	;xor	dx, dx
  5661                                  	;mov	bx, [WAVE_BlockAlign]
  5662                                  	;div	bx
  5663                                  	; 01/12/2024
  5664 0000266D 0FB71D[1C7F0000]        	movzx	ebx, word [WAVE_SampleRate]
  5665 00002674 31D2                    	xor	edx, edx
  5666 00002676 F7F3                    	div	ebx
  5667 00002678 31D2                    	xor	edx, edx
  5668 0000267A 668B1D[247F0000]        	mov	bx, [WAVE_BlockAlign]
  5669 00002681 F7F3                    	div	ebx
  5670                                  cpt_ok:
  5671                                  	; eax = (new) progress time
  5672 00002683 C3                      	retn
  5673                                  
  5674                                  ; --------------------------------------------------------
  5675                                  ; 14/11/2024
  5676                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5677                                  
  5678                                  ;; DESCRIPTION: Update file information on template
  5679                                  ;; PARAMS:	WAVE parameters and other variables
  5680                                  ;; REGS:	AX(RW)
  5681                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5682                                  ;; RETURNS:	On-screen file info is updated.
  5683                                  
  5684                                  	; 01/12/2024 (32bit registers)
  5685                                  UpdateFileInfo:
  5686                                  	;; Print File Name
  5687                                  	;mov	dh, 9
  5688                                  	; 21/12/2024 (640*480 graphics display)
  5689 00002684 B608                    	mov	dh, 8
  5690 00002686 B217                    	mov	dl, 23
  5691 00002688 E80AFFFFFF              	call	setCursorPosition
  5692                                  	
  5693 0000268D BE[447F0000]            	mov	esi, wav_file_name
  5694                                  	
  5695                                  	;;;
  5696                                  	; 14/11/2024
  5697                                  	; skip directory separators
  5698                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5699 00002692 89F3                    	mov	ebx, esi
  5700                                  chk4_nxt_sep:
  5701 00002694 AC                      	lodsb
  5702 00002695 3C2F                    	cmp	al, '/'	; 14/12/2024
  5703 00002697 7406                    	je	short chg_fpos
  5704 00002699 20C0                    	and	al, al
  5705 0000269B 7406                    	jz	short chg_fpos_ok
  5706 0000269D EBF5                    	jmp	short chk4_nxt_sep
  5707                                  chg_fpos:
  5708 0000269F 89F3                    	mov	ebx, esi
  5709 000026A1 EBF1                    	jmp	short chk4_nxt_sep
  5710                                  chg_fpos_ok:
  5711 000026A3 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5712                                  	;;;
  5713                                  _fnl_chk:
  5714                                  	; 26/12/2024 (file name length limit -display-)
  5715                                  	;mov	ebx, 12
  5716 000026A5 BB11000000              	mov	ebx, 17 ; ????????.wav?????
  5717 000026AA 56                      	push	esi
  5718                                  _fnl_chk_loop:
  5719 000026AB AC                      	lodsb
  5720 000026AC 20C0                    	and	al, al
  5721 000026AE 7406                    	jz	short _fnl_ok
  5722 000026B0 4B                       	dec	ebx
  5723 000026B1 75F8                    	jnz	short _fnl_chk_loop
  5724 000026B3 C60600                  	mov	byte [esi], 0
  5725                                  _fnl_ok:
  5726 000026B6 5E                      	pop	esi
  5727                                  	;;;
  5728                                  
  5729 000026B7 E870000000              	call	PrintString
  5730                                  	
  5731                                  	;; Print Frequency
  5732                                  	;mov	dh, 10
  5733                                  	; 21/12/2024 (640*480 graphics display)
  5734 000026BC B609                    	mov	dh, 9
  5735 000026BE B217                    	mov	dl, 23
  5736 000026C0 E8D2FEFFFF              	call	setCursorPosition
  5737                                  	;movzx	eax, word [WAVE_SampleRate]
  5738                                  	; 22/12/2024
  5739                                  	; eax = 0
  5740 000026C5 66A1[1C7F0000]          	mov	ax, [WAVE_SampleRate]
  5741 000026CB BD05000000              	mov	ebp, 5
  5742 000026D0 E82BFFFFFF              	call	PrintNumber
  5743                                  
  5744                                  	;; Print BitRate
  5745                                  	;mov	dh, 9
  5746                                  	; 21/12/2024 (640*480 graphics display)
  5747 000026D5 B608                    	mov	dh, 8
  5748 000026D7 B239                    	mov	dl, 57
  5749 000026D9 E8B9FEFFFF              	call	setCursorPosition
  5750 000026DE 66A1[267F0000]          	mov	ax, [WAVE_BitsPerSample]
  5751 000026E4 66BD0200                	mov	bp, 2
  5752 000026E8 E813FFFFFF              	call	PrintNumber
  5753                                  
  5754                                  	;; Print Channel Number
  5755                                  	;mov	dh, 10
  5756                                  	; 21/12/2024 (640*480 graphics display)
  5757 000026ED B609                    	mov	dh, 9
  5758 000026EF B239                    	mov	dl, 57
  5759 000026F1 E8A1FEFFFF              	call	setCursorPosition
  5760 000026F6 66A1[1A7F0000]          	mov	ax, [WAVE_NumChannels]
  5761 000026FC 66BD0100                	mov	bp, 1
  5762 00002700 E8FBFEFFFF              	call	PrintNumber
  5763                                  
  5764                                  	;call	UpdateVolume
  5765                                  	;retn
  5766                                  
  5767                                  ; --------------------------------------------------------
  5768                                  
  5769                                  	; 14/11/2024
  5770                                  UpdateVolume:
  5771                                  	;; Print Volume
  5772                                  	;mov	dh, 24
  5773                                  	; 21/12/2024 (640*480)
  5774 00002705 B620                    	mov	dh, 32
  5775 00002707 B24B                    	mov	dl, 75
  5776 00002709 E889FEFFFF              	call	setCursorPosition
  5777                                  	; 22/12/2024
  5778                                  	; eax = 0
  5779                                  
  5780 0000270E A0[96250000]            	mov	al, [volume]
  5781                                  
  5782 00002713 B364                    	mov	bl, 100
  5783 00002715 F6E3                    	mul	bl
  5784                                  
  5785 00002717 B31F                    	mov	bl, 31
  5786 00002719 F6F3                    	div	bl
  5787                                  
  5788                                  	;neg	ax
  5789                                  	;add	ax, 100	
  5790                                  	; 01/12/2024
  5791 0000271B B464                    	mov	ah, 100
  5792 0000271D 28C4                    	sub	ah, al
  5793 0000271F 0FB6C4                  	movzx	eax, ah
  5794                                  	;xor	ah, ah
  5795                                  	;mov	bp, 3
  5796 00002722 BD03000000              	mov	ebp, 3
  5797                                  	;call	PrintNumber
  5798                                  	;retn
  5799 00002727 E9D4FEFFFF              	jmp	PrintNumber	
  5800                                  
  5801                                  ; --------------------------------------------------------
  5802                                  
  5803                                  	; 21/12/2024
  5804                                  	; write text in VESA VBE graphics mode
  5805                                  PrintString:
  5806                                  	; esi = string address
  5807                                  printstr_loop:
  5808 0000272C 31C0                    	xor	eax, eax
  5809 0000272E AC                      	lodsb
  5810 0000272F 08C0                    	or	al, al
  5811 00002731 7417                    	jz	short printstr_ok
  5812                                  
  5813 00002733 56                      	push	esi
  5814                                  
  5815 00002734 8B35[E4740000]          	mov	esi, [screenpos]
  5816                                  
  5817                                  	; esi = pixel position (hw = row, si = column)
  5818                                  	; eax = al = character
  5819                                  	;call	write_character
  5820                                  	; 22/12/2024
  5821 0000273A E80C000000              	call	write_character_white
  5822                                  
  5823 0000273F 668305[E4740000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5824                                  
  5825 00002747 5E                      	pop	esi
  5826 00002748 EBE2                    	jmp	short printstr_loop
  5827                                  
  5828                                  printstr_ok:
  5829 0000274A C3                      	retn
  5830                                  
  5831                                  ; --------------------------------------------------------
  5832                                  
  5833                                  	; 21/12/2024
  5834                                  	; write character (at cursor position)
  5835                                  	; in graphics mode (640*480, 256 colors)
  5836                                  	; 22/12/2024
  5837                                  write_character_white:
  5838 0000274B B90F000000              	mov	ecx, 0Fh
  5839                                  	; 26/12/2024
  5840                                  	;movzx	ecx, byte [tcolor]
  5841                                  write_character:
  5842                                  	; esi = pixel position (hw = row, si = column)
  5843                                  	; eax = al = character
  5844                                  	; cl = color
  5845 00002750 890D[E8740000]          	mov	[wcolor], ecx ; 22/12/2024
  5846                                  
  5847                                  	; 22/12/2024
  5848 00002756 50                      	push	eax
  5849                                  	; clear previous character pixels
  5850 00002757 BF[7D410000]            	mov	edi, fillblock
  5851                                  	sys	_video, 020Fh, 0, 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000275C BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00002761 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00002766 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000276B B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00002770 CD40                <1>  int 40h
  5852 00002772 58                      	pop	eax
  5853                                  
  5854 00002773 C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5855 00002776 BF[984F0000]            	mov	edi, fontbuff2 ; start of user font data
  5856 0000277B 01C7                    	add	edi, eax
  5857                                  
  5858                                  	; 21/12/2024
  5859                                  	; NOTE:
  5860                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5861                                  	; system calls -in graphics mode-
  5862                                  	; because 8*16 pixel operations are faster
  5863                                  	;			than 8*14 pixel operations.
  5864                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5865                                  	; adding 2 empty lines))
  5866                                  	; (8*14 characters can be written via pixel operations)
  5867                                    	
  5868                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5869                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5870                                  	;sysvideo:
  5871                                  	;   function in BH
  5872                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5873                                  	;   sub function in BL
  5874                                  	;	0Fh: WRITE CHARACTER (FONT)
  5875                                  	;          CL = char's color (8 bit, 256 colors)
  5876                                  	;	If DH bit 7 = 1
  5877                                  	;	   USER FONT (from user buffer)
  5878                                  	;	         DL = 1 -> 8x16 pixel font
  5879                                   	;	   EDI = user's font buffer address
  5880                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5881                                  	;	   ESI = start position (row, column)
  5882                                  	;		(HW = row, SI = column)
  5883                                  	;;;;;;;;;;;;;;;;;
  5884                                  
  5885                                  	sys	_video, 020Fh, [wcolor], 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000277D BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00002782 8B0D[E8740000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00002788 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000278D B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00002792 CD40                <1>  int 40h
  5886                                  
  5887 00002794 C3                      	retn
  5888                                  
  5889                                  ; --------------------------------------------------------
  5890                                  
  5891                                  	; 22/12/2024
  5892                                  	; 21/12/2024
  5893                                  	; (write chars in VESA VBE graphics mode)
  5894                                  	; 14/11/2024
  5895                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5896                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5897                                  
  5898                                  	;PROGRESSBAR_ROW equ 23
  5899                                  	; 21/12/2024 (640*480)
  5900                                  	PROGRESSBAR_ROW equ 31
  5901                                  
  5902                                  UpdateProgressBar:
  5903 00002795 E890FEFFFF              	call	SetProgressTime	; 14/11/2024
  5904                                  
  5905                                  	; 01/12/2024 (32bit registers)
  5906 0000279A A1[B47F0000]            	mov	eax, [ProgressTime]
  5907                                  UpdateProgressBar@:
  5908 0000279F BA50000000              	mov	edx, 80
  5909 000027A4 F7E2                    	mul	edx
  5910 000027A6 8B1D[B07F0000]          	mov	ebx, [TotalTime]
  5911 000027AC F7F3                    	div	ebx
  5912                                  
  5913                                  	; 22/12/2024
  5914                                  	; check progress bar indicator position if it is same 
  5915 000027AE 3A05[ED740000]          	cmp	al, [pbprev]
  5916 000027B4 7430                    	je	short UpdateProgressBar_ok
  5917 000027B6 A2[ED740000]            	mov	[pbprev], al
  5918                                  
  5919                                  UpdateProgressBar@@:
  5920                                  	;; Push for the 'Clean' part
  5921 000027BB 50                      	push	eax ; **
  5922 000027BC 50                      	push	eax ; *
  5923                                  
  5924                                  	;; Set cursor position
  5925 000027BD B61F                    	mov	dh, PROGRESSBAR_ROW
  5926 000027BF B200                    	mov	dl, 0
  5927 000027C1 E8D1FDFFFF              	call	setCursorPosition
  5928                                  
  5929 000027C6 58                      	pop	eax ; *
  5930 000027C7 09C0                    	or	eax, eax
  5931 000027C9 742D                    	jz	short UpdateProgressBar_Clean
  5932                                  
  5933                                  UpdateProgressBar_DrawProgress:
  5934                                  	; 22/12/2024
  5935                                  	; 21/12/2024
  5936                                  	; (write progress bar chars in graphics mode)
  5937                                  	;;;;
  5938 000027CB 89C5                    	mov	ebp, eax
  5939 000027CD 50                      	push	eax ; ***
  5940 000027CE 8B35[E4740000]          	mov	esi, [screenpos]
  5941                                  UpdateProgressBar_DrawProgress_@:
  5942 000027D4 B8DF000000              	mov	eax, 223
  5943                                  	
  5944                                  	; esi = pixel position (hw = row, si = column)
  5945                                  	; eax = al = character
  5946                                  	;call	write_character
  5947                                  	; 22/12/2024
  5948 000027D9 E86DFFFFFF              	call	write_character_white
  5949                                  
  5950 000027DE 4D                      	dec	ebp
  5951 000027DF 7406                    	jz	short UpdateProgressBar_DrawCursor
  5952                                  
  5953 000027E1 83C608                  	add	esi, 8 ; next column
  5954 000027E4 EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5955                                  	;;;
  5956                                  
  5957                                  UpdateProgressBar_ok:
  5958 000027E6 C3                      	retn
  5959                                  
  5960                                  UpdateProgressBar_DrawCursor:
  5961                                  	; 22/12/2024
  5962 000027E7 5A                      	pop	edx ; ***
  5963 000027E8 B61F                    	mov	dh, PROGRESSBAR_ROW
  5964 000027EA E8A8FDFFFF              	call	setCursorPosition
  5965                                  
  5966                                  	; 21/12/2024
  5967                                  	; (write progress bar character in graphics mode)
  5968                                  	;;;;
  5969                                  	;;;mov	eax, 223
  5970                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5971                                  	;;mov	eax, 223*16
  5972                                  	;;mov	edi, fontbuff2 ; start of user font data
  5973                                  	;;add	edi, eax
  5974                                  	;mov	edi, fontbuff2+(223*16)
  5975                                  	;
  5976                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5977                                  	; 22/12/2024
  5978                                  	;mov	eax, 223
  5979                                  	; eax = 0
  5980 000027EF B0DF                    	mov	al, 223
  5981 000027F1 B10C                    	mov	cl, 0Ch ; red
  5982 000027F3 E858FFFFFF              	call	write_character
  5983                                  	;;;;
  5984                                  
  5985                                  UpdateProgressBar_Clean:
  5986                                  	;pop	eax  ; **
  5987                                  	; 22/12/2024
  5988 000027F8 5A                      	pop	edx  ; **
  5989                                  	; 21/12/2024
  5990 000027F9 BD50000000              	mov	ebp, 80
  5991                                  	;sub	bp, ax
  5992 000027FE 6629D5                  	sub	bp, dx ; 22/12/2024
  5993 00002801 74E3                    	jz	short UpdateProgressBar_ok
  5994                                  
  5995 00002803 B61F                    	mov	dh, PROGRESSBAR_ROW
  5996                                  	;mov	dl, al ; 22/12/2024
  5997 00002805 E88DFDFFFF              	call	setCursorPosition
  5998                                  
  5999                                  	; 21/12/2024
  6000                                  	; (write progress bar chars in graphics mode)
  6001                                  	;;;;
  6002 0000280A 8B35[E4740000]          	mov	esi, [screenpos]
  6003                                  UpdateProgressBar_Clean_@:
  6004                                  	;;;mov	eax, 223
  6005                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  6006                                  	;;mov	eax, 223*16
  6007                                  	;mov	edi, fontbuff2 ; start of user font data
  6008                                  	;add	edi, eax
  6009                                  	;mov	edi, fontbuff2+(223*16)
  6010                                  	;
  6011                                  	;sys	_video, 020Fh, 08h, 8001h
  6012                                  	; 22/12/2024
  6013                                  	;mov	eax, 223
  6014                                  	; eax = 0
  6015 00002810 B0DF                    	mov	al, 223
  6016 00002812 B108                    	mov	cl, 08h ; gray (dark)
  6017 00002814 E837FFFFFF              	call	write_character
  6018                                  	;;;;
  6019                                  
  6020 00002819 4D                      	dec	ebp
  6021 0000281A 74CA                    	jz	short UpdateProgressBar_ok
  6022                                  
  6023 0000281C 83C608                  	add	esi, 8 ; next column
  6024 0000281F EBEF                    	jmp	short UpdateProgressBar_Clean_@
  6025                                  	;;;;
  6026                                  
  6027                                  ; --------------------------------------------------------
  6028                                  ; 17/11/2024
  6029                                  
  6030                                  Player_ProcessKey_Backwards:
  6031                                  	;; In order to go backwards 5 seconds:
  6032                                  	;; Update file pointer to the beginning, skip headers
  6033 00002821 B142                    	mov	cl, 'B'
  6034 00002823 EB02                    	jmp	short Player_ProcessKey_B_or_F
  6035                                  
  6036                                  Player_ProcessKey_Forwards:
  6037                                  	;; In order to fast-forward 5 seconds, set the file pointer
  6038                                  	;; to CUR_SEEK + 5 * Freq
  6039                                  
  6040 00002825 B146                    	mov	cl, 'F'
  6041                                  	;jmp	short Player_ProcessKey_B_or_F
  6042                                  
  6043                                  	; 01/12/2024 (32bit regsisters)
  6044                                  Player_ProcessKey_B_or_F:
  6045                                  	; 17/11/2024
  6046                                  	; 04/11/2024
  6047                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  6048                                    
  6049                                  	; 04/11/2024
  6050 00002827 B805000000              	mov	eax, 5
  6051 0000282C 0FB71D[247F0000]        	movzx	ebx, word [WAVE_BlockAlign]
  6052 00002833 F7E3                    	mul	ebx
  6053 00002835 668B1D[1C7F0000]        	mov	bx, [WAVE_SampleRate]
  6054 0000283C F7E3                    	mul	ebx
  6055                                  	; eax = transfer byte count for 5 seconds
  6056                                  	
  6057                                  	; 17/11/2024
  6058 0000283E 80F942                  	cmp	cl, 'B'
  6059                                  	;mov	bx, [LoadedDataBytes]
  6060                                  	;mov	cx, [LoadedDataBytes+2]
  6061                                  	; 01/12/2024
  6062 00002841 8B0D[BC7F0000]          	mov	ecx, [LoadedDataBytes]
  6063 00002847 7508                    	jne	short move_forward ; cl = 'F'
  6064                                  move_backward:
  6065                                  	;sub	bx, ax
  6066                                  	;sbb	cx, dx
  6067 00002849 29C1                    	sub	ecx, eax
  6068 0000284B 7316                    	jnc	short move_file_pointer
  6069                                  move_to_beginning:
  6070                                  	;xor	cx, cx ; 0
  6071                                  	;xor	bx, bx ; 0
  6072 0000284D 31C9                    	xor	ecx, ecx
  6073 0000284F EB12                    	jmp	short move_file_pointer
  6074                                  move_forward: 
  6075                                  	;add	bx, ax
  6076                                  	;adc	cx, dx
  6077 00002851 01C1                    	add	ecx, eax
  6078 00002853 7208                    	jc	short move_to_end
  6079                                  	;cmp	cx, [DATA_SubchunkSize+2]
  6080                                  	;ja	short move_to_end
  6081                                  	;jb	short move_file_pointer
  6082                                  	;cmp	bx, [DATA_SubchunkSize]
  6083                                  	;jna	short move_file_pointer
  6084 00002855 3B0D[2C7F0000]          	cmp	ecx, [DATA_SubchunkSize]
  6085 0000285B 7606                    	jna	short move_file_pointer
  6086                                  move_to_end:
  6087                                  	;mov	bx, [DATA_SubchunkSize]
  6088                                  	;mov	cx, [DATA_SubchunkSize+2]
  6089 0000285D 8B0D[2C7F0000]          	mov	ecx, [DATA_SubchunkSize]
  6090                                  move_file_pointer:
  6091                                  	;mov	dx, bx    
  6092                                  	;mov	[LoadedDataBytes], dx
  6093                                  	;mov	[LoadedDataBytes+2], cx
  6094 00002863 890D[BC7F0000]          	mov	[LoadedDataBytes], ecx
  6095                                  	;add	dx, 44 ; + header
  6096                                  	;adc	cx, 0
  6097 00002869 83C12C                  	add	ecx, 44 
  6098                                  
  6099                                  	; seek
  6100                                  	;mov	bx, [filehandle]
  6101                                  	;mov	ax, 4200h
  6102                                  	;int	21h
  6103                                  	; 01/12/2024
  6104 0000286C 31D2                    	xor	edx, edx ; offset from beginning of the file
  6105                                  	; ecx = offset	
  6106                                  	; ebx = file handle
  6107                                  	; edx = 0
  6108                                  	sys	_seek, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000286E 8B1D[347F0000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002874 B813000000          <1>  mov eax, %1
    97                              <1> 
    98 00002879 CD40                <1>  int 40h
  6109 0000287B C3                      	retn
  6110                                  
  6111                                  ; --------------------------------------------------------
  6112                                  
  6113                                  	; 25/12/2024
  6114                                  	; 22/12/2024 (VESA VBE mode graphics) 
  6115                                  	; (640*480, 256 colors)
  6116                                  clear_window:
  6117 0000287C 8B3D[E0740000]          	mov	edi, [LFB_ADDR]
  6118                                  	;add	edi, (13*80*8*14)
  6119                                  	; 25/12/2024
  6120 00002882 81C7009A0100            	add	edi, 164*640
  6121 00002888 29C0                    	sub	eax, eax
  6122                                  	;mov	ecx, (16*640*14)/4 ; 16 rows
  6123 0000288A B900A00000              	mov	ecx, 64*640 ; 256 volume level points
  6124 0000288F F3AB                    	rep	stosd
  6125                                  	; 24/12/2024
  6126 00002891 A3[F0740000]            	mov	[prev_points], eax ; 0
  6127                                  	;
  6128 00002896 C3                      	retn
  6129                                  
  6130                                  ; --------------------------------------------------------
  6131                                  
  6132                                  	; 22/12/2024
  6133                                  	; 21/12/2024
  6134                                  	; (simulate wave leds in graphics mode)
  6135                                  	; (640*480, 256 colors)
  6136                                  reset_wave_leds:
  6137                                  	; 22/12/2024
  6138 00002897 C705[98730000]0000-     	mov	dword [prev_leds], 0
  6138 0000289F 0000               
  6139                                  	;
  6140 000028A1 BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  6141 000028A6 BE[985F0000]            	mov	esi, wleds_addr
  6142                                  next_led:
  6143 000028AB AD                      	lodsd
  6144 000028AC 89C7                    	mov	edi, eax
  6145 000028AE BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  6146 000028B3 BB[785F0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6147                                  led_line:
  6148 000028B8 8A23                    	mov	ah, [ebx]
  6149 000028BA B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  6150                                  next_pixel:
  6151 000028BF D0E4                    	shl	ah, 1
  6152 000028C1 7308                    	jnc	short skip_this
  6153 000028C3 B008                    	mov	al, 8 ; gray
  6154 000028C5 AA                      	stosb
  6155 000028C6 49                      	dec	ecx
  6156 000028C7 75F6                    	jnz	short next_pixel
  6157 000028C9 EB06                    	jmp	short next_line
  6158                                  skip_this:
  6159 000028CB B000                    	mov	al, 0 ; black
  6160 000028CD AA                      	stosb
  6161 000028CE 49                      	dec	ecx
  6162 000028CF 75EE                    	jnz	short next_pixel
  6163                                  next_line:
  6164 000028D1 4A                      	dec	edx
  6165 000028D2 7504                    	jnz	short next_line_@
  6166 000028D4 4D                      	dec	ebp
  6167 000028D5 75D4                    	jnz	short next_led
  6168                                  	;clc	; 25/12/2024
  6169 000028D7 C3                      	retn
  6170                                  next_line_@:
  6171                                  	; 22/12/2024
  6172 000028D8 81C778020000            	add	edi, 640-8 ; next line
  6173 000028DE 43                      	inc	ebx
  6174 000028DF EBD7                    	jmp	short led_line	
  6175                                  
  6176                                  ; --------------------------------------------------------
  6177                                  
  6178                                  	; 22/12/2024 (graphics mode)
  6179                                  	; 09/12/2024
  6180                                  	; 19/11/2024
  6181                                  UpdateWaveLeds:
  6182                                  	; 23/11/2024
  6183                                  	;call	reset_wave_leds
  6184                                  	; 22/12/2024 (faster method, 80 against 80*16)
  6185                                  	; turn off previously lighting wave leds at first
  6186                                  	;;;
  6187 000028E1 BE[98730000]            	mov	esi, prev_leds
  6188 000028E6 833E00                  	cmp	dword [esi], 0
  6189 000028E9 7433                    	jz	short UpdateWaveLeds_ok
  6190 000028EB B950000000              	mov	ecx, 80
  6191                                  turn_off_led:
  6192 000028F0 AD                      	lodsd
  6193 000028F1 89C7                    	mov	edi, eax
  6194                                  	; edi = wave led address
  6195 000028F3 BD0E000000              	mov	ebp, 14
  6196 000028F8 BB[785F0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6197 000028FD 31D2                    	xor	edx, edx
  6198 000028FF B008                    	mov	al, 8 ; gray (dark)
  6199                                  toffl_next_line:
  6200                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6201                                  	;mov	dl, 8
  6202 00002901 88C2                    	mov	dl, al ; 8
  6203 00002903 8A23                    	mov	ah, [ebx]
  6204                                  toffl_next_pixel:
  6205 00002905 D0E4                    	shl	ah, 1
  6206 00002907 7310                    	jnc	short toffl_skip_this
  6207 00002909 AA                      	stosb
  6208                                  toffl_next_pixel_@:
  6209 0000290A 4A                      	dec	edx
  6210 0000290B 75F8                    	jnz	short toffl_next_pixel
  6211 0000290D 4D                      	dec	ebp
  6212 0000290E 740C                    	jz	short toffl_next_led
  6213 00002910 81C778020000            	add	edi, 640-8 ; next line
  6214 00002916 43                      	inc	ebx
  6215 00002917 EBE8                    	jmp	short toffl_next_line
  6216                                  toffl_skip_this:
  6217 00002919 47                      	inc	edi
  6218 0000291A EBEE                    	jmp	short toffl_next_pixel_@
  6219                                  toffl_next_led:
  6220 0000291C E2D2                    	loop	turn_off_led
  6221                                  UpdateWaveLeds_ok:
  6222                                  	;;;
  6223                                  	; 09/12/2024
  6224                                  	;jmp	short turn_on_leds
  6225                                  
  6226                                  ; --------------------------------------------------------
  6227                                  
  6228                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  6229                                  	; 09/12/2024
  6230                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  6231                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  6232                                  	; 21/11/2024, 22/11/2024
  6233                                  	; 19/11/2024
  6234                                  turn_on_leds:
  6235                                  	; 09/12/2024
  6236                                  	; 07/12/2024
  6237 0000291E 8A15[FD7E0000]          	mov	dl, [half_buffer]
  6238                                  tol_@:
  6239                                  	; 07/12/2024
  6240 00002924 3815[FC7E0000]          	cmp	[pbuf_s], dl
  6241 0000292A 7520                    	jne	short tol_ns_buf
  6242 0000292C 8B1D[F47E0000]          	mov	ebx, [wleds_dif]
  6243 00002932 8B35[F87E0000]          	mov	esi, [pbuf_o]
  6244 00002938 8B0D[AC7F0000]          	mov	ecx, [buffersize] ; bytes
  6245 0000293E 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  6246 00002940 01DE                    	add	esi, ebx
  6247 00002942 7204                    	jc	short tol_o_@
  6248 00002944 39CE                    	cmp	esi, ecx
  6249 00002946 760C                    	jna	short tol_s_buf
  6250                                  tol_o_@:
  6251 00002948 89CE                    	mov	esi, ecx
  6252 0000294A EB08                    	jmp	short tol_s_buf
  6253                                  
  6254                                  tol_ns_buf:
  6255 0000294C 8815[FC7E0000]          	mov	[pbuf_s], dl
  6256 00002952 31F6                    	xor	esi, esi ; 0
  6257                                  tol_s_buf:
  6258 00002954 8935[F87E0000]          	mov	[pbuf_o], esi
  6259                                  
  6260                                  tol_buf_@:
  6261                                  	; 07/12/2024
  6262 0000295A 81C6[00800000]          	add	esi, audio_buffer
  6263 00002960 B950000000              	mov	ecx, 80
  6264                                  	;xor	eax, eax ; 0
  6265 00002965 BB[985F0000]            	mov	ebx, wleds_addr
  6266                                  	; 22/12/2024
  6267 0000296A BF[98730000]            	mov	edi, prev_leds
  6268                                  tol_fill_c:
  6269 0000296F 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  6270 00002971 66AD                    	lodsw	; left
  6271 00002973 80C480                  	add	ah, 80h	; 24/12/2024
  6272 00002976 89C2                    	mov	edx, eax
  6273 00002978 66AD                    	lodsw	; right
  6274                                  	;add	ax, dx
  6275 0000297A 80C480                  	add	ah, 80h
  6276                                  	;; 21/12/2024 (16 volume levels)
  6277                                  	;shr	eax, 12
  6278                                  	; 24/12/2024
  6279 0000297D 01D0                    	add	eax, edx
  6280 0000297F C1E80D                  	shr	eax, 13	; (L+R/2) & 16 volume levels
  6281                                  
  6282 00002982 53                      	push	ebx ; *
  6283                                  	; 01/12/2024
  6284 00002983 C1E002                  	shl	eax, 2
  6285 00002986 01C3                    	add	ebx, eax
  6286                                  	; 01/12/2024 (32bit address)
  6287                                  	;mov	edi, [ebx]
  6288                                  	; 22/12/2024
  6289 00002988 8B03                    	mov	eax, [ebx]
  6290 0000298A AB                      	stosd
  6291 0000298B 57                      	push	edi ; **
  6292 0000298C 89C7                    	mov	edi, eax
  6293                                  	;;;
  6294                                  	; 21/12/2024
  6295                                  	; (simulate wave leds in graphics mode)
  6296                                  	; (640*480, 256 colors)
  6297                                  turn_on_led:
  6298                                  	; edi = wave led address
  6299 0000298E BD0E000000              	mov	ebp, 14
  6300 00002993 BB[785F0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6301 00002998 A0[95410000]            	mov	al, [ccolor]
  6302                                  tol_next_line:
  6303 0000299D BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6304 000029A2 8A23                    	mov	ah, [ebx]
  6305                                  tol_next_pixel:
  6306 000029A4 D0E4                    	shl	ah, 1
  6307 000029A6 7310                    	jnc	short tol_skip_this
  6308 000029A8 AA                      	stosb
  6309                                  tol_next_pixel_@:
  6310 000029A9 4A                      	dec	edx
  6311 000029AA 75F8                    	jnz	short tol_next_pixel
  6312 000029AC 4D                      	dec	ebp
  6313 000029AD 740C                    	jz	short tol_next_led
  6314                                  	; 22/12/2024
  6315 000029AF 81C778020000            	add	edi, 640-8 ; next line
  6316 000029B5 43                      	inc	ebx
  6317 000029B6 EBE5                    	jmp	short tol_next_line
  6318                                  tol_skip_this:
  6319 000029B8 47                      	inc	edi
  6320 000029B9 EBEE                    	jmp	short tol_next_pixel_@
  6321                                  tol_next_led:
  6322                                  	; 22/12/2024
  6323 000029BB 5F                      	pop	edi ; **
  6324                                  	;;;
  6325 000029BC 5B                      	pop	ebx ; *
  6326 000029BD 83C340                  	add	ebx, 16*4
  6327 000029C0 E2AD                    	loop	tol_fill_c
  6328                                  
  6329 000029C2 C3                      	retn
  6330                                  
  6331                                  ; -------------------------------------------------------------
  6332                                  
  6333                                  ; -------------------------------------------------------------
  6334                                  ; ac97.inc (11/11/2023)
  6335                                  ; -------------------------------------------------------------
  6336                                  
  6337                                  ; special characters
  6338                                  LF      EQU 10
  6339                                  CR      EQU 13
  6340                                  
  6341                                  ; PCI stuff
  6342                                  
  6343                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  6344                                  
  6345                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  6346                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6347                                  SIS_VID		equ	1039h
  6348                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  6349                                  AMD_VID		equ	1022h
  6350                                  
  6351                                  ICH_DID         equ     2415h           ; ICH device ID
  6352                                  ICH0_DID        equ     2425h           ; ICH0
  6353                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  6354                                                                          ; they all should be compatible.
  6355                                  
  6356                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  6357                                  ICH3_DID	equ     2485h           ; ICH3
  6358                                  ICH4_DID        equ     24C5h           ; ICH4
  6359                                  ICH5_DID	equ     24D5h           ; ICH5
  6360                                  ICH6_DID	equ     266Eh           ; ICH6
  6361                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  6362                                  ESB631X_DID	equ     2698h           ; 631XESB
  6363                                  ICH7_DID	equ	27DEh		; ICH7
  6364                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6365                                  MX82440_DID	equ	7195h
  6366                                  SI7012_DID	equ	7012h
  6367                                  NFORCE_DID	equ	01B1h
  6368                                  NFORCE2_DID	equ	006Ah
  6369                                  AMD8111_DID	equ	746Dh
  6370                                  AMD768_DID	equ	7445h
  6371                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  6372                                  CK804_DID	equ	0059h
  6373                                  MCP04_DID	equ	003Ah
  6374                                  CK8_DID		equ	008Ah
  6375                                  NFORCE3_DID	equ	00DAh
  6376                                  CK8S_DID	equ	00EAh
  6377                                  
  6378                                  ; -------------------------------------------------------------
  6379                                  
  6380                                  ; 22/12/2024
  6381 000029C3 90                      align 4
  6382                                  
  6383                                  ; 13/11/2024
  6384                                  ; ('<<' to 'shl' conversion for FASM)
  6385                                  ;
  6386                                  ; 29/05/2024 (TRDOS 386)
  6387                                  ; 17/02/2017
  6388                                  ; Valid ICH device IDs
  6389                                  
  6390                                  valid_ids:
  6391                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  6392 000029C4 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  6393 000029C8 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  6394 000029CC 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  6395 000029D0 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  6396 000029D4 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  6397 000029D8 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  6398 000029DC 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  6399 000029E0 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  6400 000029E4 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  6401 000029E8 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  6402                                  	; 03/11/2023 - Erdogan Tan
  6403 000029EC 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  6404 000029F0 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  6405 000029F4 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  6406 000029F8 DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  6407 000029FC 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  6408 00002A00 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  6409 00002A04 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  6410 00002A08 DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  6411 00002A0C DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  6412 00002A10 DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  6413 00002A14 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  6414                                  
  6415                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  6416                                  ; 13/11/2024
  6417                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  6418                                  
  6419 00002A18 00000000                	dd 0
  6420                                  
  6421                                  Credits:
  6422 00002A1C 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  6422 00002A25 6C6179657220666F72-
  6422 00002A2E 205452444F53203338-
  6422 00002A37 36206279204572646F-
  6422 00002A40 67616E2054616E2E20 
  6423                                  	;db 'December 2024.', 10,13,0
  6424 00002A49 4A616E756172792032-     	db 'January 2025.', 10,13,0
  6424 00002A52 3032352E0A0D00     
  6425                                  	;db '27/12/2024', 10,13
  6426 00002A59 31382F30312F323032-     	db '18/01/2025', 10,13
  6426 00002A62 350A0D             
  6427                                  ; 15/11/2024
  6428                                  reset:
  6429 00002A65 00                      	db 0
  6430                                  
  6431                                  msgAudioCardInfo:
  6432 00002A66 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  6432 00002A6F 204143393720284943-
  6432 00002A78 482920417564696F20-
  6432 00002A81 436F6E74726F6C6C65-
  6432 00002A8A 722E0A0D00         
  6433                                  
  6434                                  	; 25/12/2024
  6435                                  msg_usage:
  6436 00002A8F 75736167653A205647-     	db 'usage: VGAPLAY <FileName1> <FileName2> <...>',10,13,0
  6436 00002A98 41504C4159203C4669-
  6436 00002AA1 6C654E616D65313E20-
  6436 00002AAA 3C46696C654E616D65-
  6436 00002AB3 323E203C2E2E2E3E0A-
  6436 00002ABC 0D00               
  6437                                  
  6438                                  noDevMsg:
  6439 00002ABE 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  6439 00002AC7 61626C6520746F2066-
  6439 00002AD0 696E64204143393720-
  6439 00002AD9 617564696F20646576-
  6439 00002AE2 69636521           
  6440 00002AE6 0A0D00                  	db 10,13,0
  6441                                  
  6442                                  noFileErrMsg:
  6443 00002AE9 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  6443 00002AF2 6C65206E6F7420666F-
  6443 00002AFB 756E642E0A0D00     
  6444                                  
  6445                                  ; 07/12/2024
  6446                                  trdos386_err_msg:
  6447 00002B02 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  6447 00002B0B 2053797374656D2063-
  6447 00002B14 616C6C206572726F72-
  6447 00002B1D 20210A0D00         
  6448                                  
  6449                                  ; 29/05/2024
  6450                                  ; 11/11/2023
  6451                                  msg_init_err:
  6452 00002B22 0D0A                    	db CR, LF
  6453 00002B24 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6453 00002B2D 726F6C6C65722F436F-
  6453 00002B36 64656320696E697469-
  6453 00002B3F 616C697A6174696F6E-
  6453 00002B48 206572726F722021   
  6454 00002B50 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6455                                  
  6456                                  ; 25/11/2023
  6457                                  msg_no_vra:
  6458 00002B53 0A0D                    	db 10,13
  6459 00002B55 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6459 00002B5E 70706F72742021204F-
  6459 00002B67 6E6C79203438206B48-
  6459 00002B70 5A2073616D706C6520-
  6459 00002B79 726174652073757070-
  6459 00002B82 6F727465642021     
  6460 00002B89 0A0D00                  	db 10,13,0
  6461                                  
  6462                                  ; 19/11/2024
  6463                                  ; 03/06/2017
  6464                                  hex_chars:
  6465 00002B8C 303132333435363738-     	db '0123456789ABCDEF', 0
  6465 00002B95 3941424344454600   
  6466                                  msgAC97Info:
  6467 00002B9D 0D0A                    	db 0Dh, 0Ah
  6468 00002B9F 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6468 00002BA8 696F20436F6E74726F-
  6468 00002BB1 6C6C6572202620436F-
  6468 00002BBA 64656320496E666F0D-
  6468 00002BC3 0A                 
  6469 00002BC4 2056656E646F722049-     	db ' Vendor ID: '
  6469 00002BCD 443A20             
  6470                                  msgVendorId:
  6471 00002BD0 303030306820446576-     	db '0000h Device ID: '
  6471 00002BD9 6963652049443A20   
  6472                                  msgDevId:
  6473 00002BE1 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6474 00002BE8 204275733A20            	db ' Bus: '
  6475                                  msgBusNo:
  6476 00002BEE 303068204465766963-     	db '00h Device: '
  6476 00002BF7 653A20             
  6477                                  msgDevNo:
  6478 00002BFA 3030682046756E6374-     	db '00h Function: '
  6478 00002C03 696F6E3A20         
  6479                                  msgFncNo:
  6480 00002C08 303068                  	db '00h'
  6481 00002C0B 0D0A                    	db 0Dh, 0Ah
  6482 00002C0D 204E414D4241523A20      	db ' NAMBAR: '
  6483                                  msgNamBar:
  6484 00002C16 30303030682020          	db '0000h  '
  6485 00002C1D 4E41424D4241523A20      	db 'NABMBAR: '
  6486                                  msgNabmBar:
  6487 00002C26 303030306820204952-     	db '0000h  IRQ: '
  6487 00002C2F 513A20             
  6488                                  msgIRQ:
  6489 00002C32 3030                    	dw 3030h
  6490 00002C34 0D0A00                  	db 0Dh, 0Ah, 0
  6491                                  ; 25/11/2023
  6492                                  msgVRAheader:
  6493 00002C37 205652412073757070-     	db ' VRA support: '
  6493 00002C40 6F72743A20         
  6494 00002C45 00                      	db 0	
  6495                                  msgVRAyes:
  6496 00002C46 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6497                                  msgVRAno:
  6498 00002C4C 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6499 00002C51 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6499 00002C5A 6C617465642073616D-
  6499 00002C63 706C65207261746520-
  6499 00002C6C 706C6179696E67206D-
  6499 00002C75 6574686F6429       
  6500 00002C7B 0D0A00                  	db 0Dh, 0Ah, 0
  6501                                  
  6502 00002C7E 90<rep 2h>              align 4
  6503                                  
  6504                                  ; -------------------------------------------------------------
  6505                                  
  6506                                  	; 21/12/2024
  6507                                  SplashScreen:
  6508 00002C80 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6508 00002C89 202020202020202020-
  6508 00002C92 202020202020202020-
  6508 00002C9B 202020202020202020-
  6508 00002CA4 202020202020202020-
  6508 00002CAD 202020202020202020-
  6508 00002CB6 202020202020202020-
  6508 00002CBF 202020202020202020-
  6508 00002CC8 2020202020DDDBDE   
  6509 00002CD0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6509 00002CD9 202020202020202020-
  6509 00002CE2 202020202020202020-
  6509 00002CEB 202020202020202020-
  6509 00002CF4 202020202020202020-
  6509 00002CFD 202020202020202020-
  6509 00002D06 202020202020202020-
  6509 00002D0F 202020202020202020-
  6509 00002D18 2020202020DDDBDE   
  6510 00002D20 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6510 00002D29 202020202020202020-
  6510 00002D32 202020202020202020-
  6510 00002D3B 202020202020202020-
  6510 00002D44 202020202020202020-
  6510 00002D4D 202020202020202020-
  6510 00002D56 202020202020202020-
  6510 00002D5F 202020202020202020-
  6510 00002D68 2020202020DDDBDE   
  6511 00002D70 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6511 00002D79 202020202020202020-
  6511 00002D82 202020202020202020-
  6511 00002D8B 202020202020202020-
  6511 00002D94 202020202020202020-
  6511 00002D9D 202020202020202020-
  6511 00002DA6 202020202020202020-
  6511 00002DAF 202020202020202020-
  6511 00002DB8 2020202020DDDBDE   
  6512 00002DC0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6512 00002DC9 202020202020202020-
  6512 00002DD2 202020202020202020-
  6512 00002DDB 202020202020202020-
  6512 00002DE4 202020202020202020-
  6512 00002DED 202020202020202020-
  6512 00002DF6 202020202020202020-
  6512 00002DFF 202020202020202020-
  6512 00002E08 2020202020DDDBDE   
  6513 00002E10 DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6513 00002E19 202020202020202020-
  6513 00002E22 2020202020205F5F5F-
  6513 00002E2B 5F5F5F5F2020205F5F-
  6513 00002E34 5F5F5F5F2020202020-
  6513 00002E3D 2020205F5F5F5F5F5F-
  6513 00002E46 5F2E20202020202020-
  6513 00002E4F 202020202020202020-
  6513 00002E58 2020202020DDDBDE   
  6514 00002E60 DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6514 00002E69 202020202020202020-
  6514 00002E72 20202020207C202020-
  6514 00002E7B 202020205C202F2020-
  6514 00002E84 5F5F20205C20202020-
  6514 00002E8D 20202F202020202020-
  6514 00002E96 207C20202020202020-
  6514 00002E9F 202020202020202020-
  6514 00002EA8 2020202020DDDBDE   
  6515 00002EB0 DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6515 00002EB9 202020202020202020-
  6515 00002EC2 20202020207C20202E-
  6515 00002ECB 2D2D2E20207C20207C-
  6515 00002ED4 20207C20207C202020-
  6515 00002EDD 207C202020282D2D2D-
  6515 00002EE6 2D6020202020202020-
  6515 00002EEF 202020202020202020-
  6515 00002EF8 2020202020DDDBDE   
  6516 00002F00 DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6516 00002F09 202020202020202020-
  6516 00002F12 20202020207C20207C-
  6516 00002F1B 20207C20207C20207C-
  6516 00002F24 20207C20207C202020-
  6516 00002F2D 20205C2020205C2020-
  6516 00002F36 202020202020202020-
  6516 00002F3F 202020202020202020-
  6516 00002F48 2020202020DDDBDE   
  6517 00002F50 DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6517 00002F59 202020202020202020-
  6517 00002F62 20202020207C202027-
  6517 00002F6B 2D2D2720207C202060-
  6517 00002F74 2D2D2720207C202E2D-
  6517 00002F7D 2D2D2D292020207C20-
  6517 00002F86 202020202020202020-
  6517 00002F8F 202020202020202020-
  6517 00002F98 2020202020DDDBDE   
  6518 00002FA0 DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6518 00002FA9 202020202020202020-
  6518 00002FB2 20202020207C5F5F5F-
  6518 00002FBB 5F5F5F5F2F205C5F5F-
  6518 00002FC4 5F5F5F5F2F20207C5F-
  6518 00002FCD 5F5F5F5F5F5F2F2020-
  6518 00002FD6 202020202020202020-
  6518 00002FDF 202020202020202020-
  6518 00002FE8 2020202020DDDBDE   
  6519 00002FF0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6519 00002FF9 202020202020202020-
  6519 00003002 202020202020202020-
  6519 0000300B 202020202020202020-
  6519 00003014 202020202020202020-
  6519 0000301D 202020202020202020-
  6519 00003026 202020202020202020-
  6519 0000302F 202020202020202020-
  6519 00003038 2020202020DDDBDE   
  6520 00003040 DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6520 00003049 5F5F5F5F5F5F202020-
  6520 00003052 205F5F202020202020-
  6520 0000305B 202020205F5F5F2020-
  6520 00003064 205F5F5F5F20202020-
  6520 0000306D 5F5F5F5F20205F5F5F-
  6520 00003076 5F5F5F5F202E5F5F5F-
  6520 0000307F 5F5F5F202020202020-
  6520 00003088 2020202020DDDBDE   
  6521 00003090 DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6521 00003099 2020205F20205C2020-
  6521 000030A2 7C20207C2020202020-
  6521 000030AB 2020202F2020205C20-
  6521 000030B4 205C2020205C20202F-
  6521 000030BD 2020202F207C202020-
  6521 000030C6 5F5F5F5F7C7C202020-
  6521 000030CF 5F20205C2020202020-
  6521 000030D8 2020202020DDDBDE   
  6522 000030E0 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6522 000030E9 20207C5F2920207C20-
  6522 000030F2 7C20207C2020202020-
  6522 000030FB 20202F20205E20205C-
  6522 00003104 20205C2020205C2F20-
  6522 0000310D 20202F20207C20207C-
  6522 00003116 5F5F2020207C20207C-
  6522 0000311F 5F2920207C20202020-
  6522 00003128 2020202020DDDBDE   
  6523 00003130 DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6523 00003139 2020205F5F5F2F2020-
  6523 00003142 7C20207C2020202020-
  6523 0000314B 202F20202F5F5C2020-
  6523 00003154 5C20205C5F20202020-
  6523 0000315D 5F2F2020207C202020-
  6523 00003166 5F5F7C20207C202020-
  6523 0000316F 2020202F2020202020-
  6523 00003178 2020202020DDDBDE   
  6524 00003180 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6524 00003189 20207C202020202020-
  6524 00003192 7C2020602D2D2D2D2E-
  6524 0000319B 2F20205F5F5F5F5F20-
  6524 000031A4 205C2020207C20207C-
  6524 000031AD 20202020207C20207C-
  6524 000031B6 5F5F5F5F207C20207C-
  6524 000031BF 5C20205C2D2D2D2D2E-
  6524 000031C8 2020202020DDDBDE   
  6525 000031D0 DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6525 000031D9 205F7C202020202020-
  6525 000031E2 7C5F5F5F5F5F5F5F2F-
  6525 000031EB 5F5F2F20202020205C-
  6525 000031F4 5F5F5C20207C5F5F7C-
  6525 000031FD 20202020207C5F5F5F-
  6525 00003206 5F5F5F5F7C7C205F7C-
  6525 0000320F 20602E5F5F5F5F5F7C-
  6525 00003218 2020202020DDDBDE   
  6526 00003220 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6526 00003229 202020202020202020-
  6526 00003232 202020202020202020-
  6526 0000323B 202020202020202020-
  6526 00003244 202020202020202020-
  6526 0000324D 202020202020202020-
  6526 00003256 202020202020202020-
  6526 0000325F 202020202020202020-
  6526 00003268 2020202020DDDBDE   
  6527 00003270 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6527 00003279 202020202020202020-
  6527 00003282 202020202020202020-
  6527 0000328B 202020202020202020-
  6527 00003294 202020202020202020-
  6527 0000329D 202020202020202020-
  6527 000032A6 202020202020202020-
  6527 000032AF 202020202020202020-
  6527 000032B8 2020202020DDDBDE   
  6528 000032C0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6528 000032C9 202020202020202020-
  6528 000032D2 202020202020202020-
  6528 000032DB 202020202020202020-
  6528 000032E4 202020202020202020-
  6528 000032ED 202020202020202020-
  6528 000032F6 202020202020202020-
  6528 000032FF 202020202020202020-
  6528 00003308 2020202020DDDBDE   
  6529 00003310 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6529 00003319 202020202020202020-
  6529 00003322 202020202020202020-
  6529 0000332B 202020202020202020-
  6529 00003334 202020202020202020-
  6529 0000333D 202020202020202020-
  6529 00003346 202020202020202020-
  6529 0000334F 202020202020202020-
  6529 00003358 2020202020DDDBDE   
  6530 00003360 DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6530 00003369 202020202020202020-
  6530 00003372 202020202020202020-
  6530 0000337B 202020202020202057-
  6530 00003384 454C434F4D4520544F-
  6530 0000338D 202020202020202020-
  6530 00003396 202020202020202020-
  6530 0000339F 202020202020202020-
  6530 000033A8 2020202020DDDBDE   
  6531 000033B0 DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6531 000033B9 202020202020202020-
  6531 000033C2 202020202020202020-
  6531 000033CB 202020202020202044-
  6531 000033D4 4F5320504C41594552-
  6531 000033DD 202020202020202020-
  6531 000033E6 202020202020202020-
  6531 000033EF 202020202020202020-
  6531 000033F8 2020202020DDDBDE   
  6532 00003400 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6532 00003409 202020202020202020-
  6532 00003412 202020202020202020-
  6532 0000341B 202020202020202020-
  6532 00003424 202020202020202020-
  6532 0000342D 202020202020202020-
  6532 00003436 202020202020202020-
  6532 0000343F 202020202020202020-
  6532 00003448 2020202020DDDBDE   
  6533 00003450 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6533 00003459 202020202020202020-
  6533 00003462 202020202020202020-
  6533 0000346B 202020202020202020-
  6533 00003474 202020202020202020-
  6533 0000347D 202020202020202020-
  6533 00003486 202020202020202020-
  6533 0000348F 202020202020202020-
  6533 00003498 2020202020DDDBDE   
  6534 000034A0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6534 000034A9 202020202020202020-
  6534 000034B2 202020202020202020-
  6534 000034BB 202020202020202020-
  6534 000034C4 202020202020202020-
  6534 000034CD 202020202020202020-
  6534 000034D6 202020202020202020-
  6534 000034DF 202020202020202020-
  6534 000034E8 2020202020DDDBDE   
  6535 000034F0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6535 000034F9 202020202020202020-
  6535 00003502 202020202020202020-
  6535 0000350B 202020202020202020-
  6535 00003514 202020202020202020-
  6535 0000351D 202020202020202020-
  6535 00003526 202020202020202020-
  6535 0000352F 202020202020202020-
  6535 00003538 2020202020DDDBDE   
  6536 00003540 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6536 00003549 202020202020202020-
  6536 00003552 202020202020202020-
  6536 0000355B 202020202020202020-
  6536 00003564 202020202020202020-
  6536 0000356D 202020202020202020-
  6536 00003576 202020202020202020-
  6536 0000357F 202020202020202020-
  6536 00003588 2020202020DDDBDE   
  6537 00003590 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6537 00003599 202020202020202020-
  6537 000035A2 202020202020202020-
  6537 000035AB 202020202020202020-
  6537 000035B4 202020202020202020-
  6537 000035BD 202020202020202020-
  6537 000035C6 202020202020202020-
  6537 000035CF 202020202020202020-
  6537 000035D8 2020202020DDDBDE   
  6538 000035E0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6538 000035E9 202020202020202020-
  6538 000035F2 202020202020202020-
  6538 000035FB 202020202020202020-
  6538 00003604 202020202020202020-
  6538 0000360D 202020202020202020-
  6538 00003616 202020202020202020-
  6538 0000361F 202020202020202020-
  6538 00003628 2020202020DDDBDE   
  6539 00003630 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6539 00003639 202020202020202020-
  6539 00003642 202020202020202020-
  6539 0000364B 202020202020202020-
  6539 00003654 202020202020202020-
  6539 0000365D 202020202020202020-
  6539 00003666 202020202020202020-
  6539 0000366F 202020202020202020-
  6539 00003678 2020202020DDDBDE   
  6540 00003680 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6540 00003689 202020202020202020-
  6540 00003692 202020202020202020-
  6540 0000369B 202020202020202020-
  6540 000036A4 202020202020202020-
  6540 000036AD 202020202020202020-
  6540 000036B6 202020202020202020-
  6540 000036BF 202020202020202020-
  6540 000036C8 2020202020DDDBDE   
  6541 000036D0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6541 000036D9 202020202020202020-
  6541 000036E2 202020202020202020-
  6541 000036EB 202020202020202020-
  6541 000036F4 202020202020202020-
  6541 000036FD 202020202020202020-
  6541 00003706 202020202020202020-
  6541 0000370F 202020202020202020-
  6541 00003718 2020202020DDDBDE   
  6542 00003720 00                      	db 0
  6543                                  
  6544                                  ; -------------------------------------------------------------
  6545                                  
  6546                                  	; 25/12/2024
  6547                                  PlayingScreen:
  6548 00003721 DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6548 0000372A DBDBDBDBDBDBDBDBDB-
  6548 00003733 DBDBDBDBDBDBDBDBDB-
  6548 0000373C DBDBDBDBDBDBDB2044-
  6548 00003745 4F5320506C61796572-
  6548 0000374E 20DBDBDBDBDBDBDBDB-
  6548 00003757 DBDBDBDBDBDBDBDBDB-
  6548 00003760 DBDBDBDBDBDBDBDBDB-
  6548 00003769 DBDBDBDBDBDBDBDB   
  6549 00003771 C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6549 0000377A CDCDCDCDCDCDCDCDCD-
  6549 00003783 CDCDCDCDCDCDCDCDCD-
  6549 0000378C CDCDCDCDCDCDCDCDCD-
  6549 00003795 CDCDCDCDCDCDCDCDCD-
  6549 0000379E CDCDCDCDCDCDCDCDCD-
  6549 000037A7 CDCDCDCDCDCDCDCDCD-
  6549 000037B0 CDCDCDCDCDCDCDCDCD-
  6549 000037B9 CDCDCDCDCDCDCDBB   
  6550 000037C1 BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6550 000037CA 202020202020202020-
  6550 000037D3 202020202020202020-
  6550 000037DC 202020202020202055-
  6550 000037E5 736572204775696465-
  6550 000037EE 202020202020202020-
  6550 000037F7 202020202020202020-
  6550 00003800 202020202020202020-
  6550 00003809 20202020202020BA   
  6551 00003811 BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<N>/<P>         Next/Previous", 9 dup(32), 186
  6551 0000381A 706163653E20202020-
  6551 00003823 2020202020506C6179-
  6551 0000382C 2F5061757365202020-
  6551 00003835 20202020203C4E3E2F-
  6551 0000383E 3C503E202020202020-
  6551 00003847 2020204E6578742F50-
  6551 00003850 726576696F75732020-
  6551 00003859 20202020202020BA   
  6552 00003861 BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>/<G>     Wave Lighting", 9 dup(32), 186
  6552 0000386A 3E2020202020202020-
  6552 00003873 202020202053746F70-
  6552 0000387C 202020202020202020-
  6552 00003885 20202020203C456E74-
  6552 0000388E 65723E2F3C473E2020-
  6552 00003897 20202057617665204C-
  6552 000038A0 69676874696E672020-
  6552 000038A9 20202020202020BA   
  6553 000038B1 BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6553 000038BA 3E2020202020202020-
  6553 000038C3 2020202020466F7277-
  6553 000038CC 617264732020202020-
  6553 000038D5 20202020203C2B3E2F-
  6553 000038DE 3C2D3E202020202020-
  6553 000038E7 202020496E632F4465-
  6553 000038F0 6320566F6C756D6520-
  6553 000038F9 20202020202020BA   
  6554 00003901 BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6554 0000390A 3E2020202020202020-
  6554 00003913 20202020204261636B-
  6554 0000391C 776172647320202020-
  6554 00003925 20202020203C513E20-
  6554 0000392E 202020202020202020-
  6554 00003937 202020517569742050-
  6554 00003940 726F6772616D202020-
  6554 00003949 20202020202020BA   
  6555 00003951 CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6555 0000395A CDCDCDCDCDCDCDCDCD-
  6555 00003963 CDCDCDCDCDCDCDCDCD-
  6555 0000396C CDCDCDCDCDCDCDCDCD-
  6555 00003975 CDCDCDCDCDCDCDCDCD-
  6555 0000397E CDCDCDCDCDCDCDCDCD-
  6555 00003987 CDCDCDCDCDCDCDCDCD-
  6555 00003990 CDCDCDCDCDCDCDCDCD-
  6555 00003999 CDCDCDCDCDCDCDB9   
  6556 000039A1 BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6556 000039AA 6C65204E616D65203A-
  6556 000039B3 202020202020202020-
  6556 000039BC 202020202020202020-
  6556 000039C5 20202020204269742D-
  6556 000039CE 5261746520203A2020-
  6556 000039D7 202020302020426974-
  6556 000039E0 732020202020202020-
  6556 000039E9 20202020202020BA   
  6557 000039F1 BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6557 000039FA 657175656E6379203A-
  6557 00003A03 202020202030202020-
  6557 00003A0C 2020487A2020202020-
  6557 00003A15 2020202020232D4368-
  6557 00003A1E 616E6E656C733A2020-
  6557 00003A27 202020302020202020-
  6557 00003A30 202020202020202020-
  6557 00003A39 20202020202020BA   
  6558 00003A41 C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6558 00003A4A CDCDCDCDCDCDCDCDCD-
  6558 00003A53 CDCDCDCDCDCDCDCDCD-
  6558 00003A5C CDCDCDCDCDCDCDCDCD-
  6558 00003A65 CDCDCDCDCDCDCDCDCD-
  6558 00003A6E CDCDCDCDCDCDCDCDCD-
  6558 00003A77 CDCDCDCDCDCDCDCDCD-
  6558 00003A80 CDCDCDCDCDCDCDCDCD-
  6558 00003A89 CDCDCDCDCDCDCDBC   
  6559 00003A91 202020202020202020-     	db  80 dup(32)
  6559 00003A9A 202020202020202020-
  6559 00003AA3 202020202020202020-
  6559 00003AAC 202020202020202020-
  6559 00003AB5 202020202020202020-
  6559 00003ABE 202020202020202020-
  6559 00003AC7 202020202020202020-
  6559 00003AD0 202020202020202020-
  6559 00003AD9 2020202020202020   
  6560                                  improper_samplerate_txt:
  6561                                  read_error_txt:
  6562 00003AE1 202020202020202020-     	db  80 dup(32)
  6562 00003AEA 202020202020202020-
  6562 00003AF3 202020202020202020-
  6562 00003AFC 202020202020202020-
  6562 00003B05 202020202020202020-
  6562 00003B0E 202020202020202020-
  6562 00003B17 202020202020202020-
  6562 00003B20 202020202020202020-
  6562 00003B29 2020202020202020   
  6563 00003B31 202020202020202020-     	db  80 dup(32)
  6563 00003B3A 202020202020202020-
  6563 00003B43 202020202020202020-
  6563 00003B4C 202020202020202020-
  6563 00003B55 202020202020202020-
  6563 00003B5E 202020202020202020-
  6563 00003B67 202020202020202020-
  6563 00003B70 202020202020202020-
  6563 00003B79 2020202020202020   
  6564 00003B81 202020202020202020-     	db  80 dup(32)
  6564 00003B8A 202020202020202020-
  6564 00003B93 202020202020202020-
  6564 00003B9C 202020202020202020-
  6564 00003BA5 202020202020202020-
  6564 00003BAE 202020202020202020-
  6564 00003BB7 202020202020202020-
  6564 00003BC0 202020202020202020-
  6564 00003BC9 2020202020202020   
  6565 00003BD1 202020202020202020-     	db  80 dup(32)
  6565 00003BDA 202020202020202020-
  6565 00003BE3 202020202020202020-
  6565 00003BEC 202020202020202020-
  6565 00003BF5 202020202020202020-
  6565 00003BFE 202020202020202020-
  6565 00003C07 202020202020202020-
  6565 00003C10 202020202020202020-
  6565 00003C19 2020202020202020   
  6566 00003C21 202020202020202020-     	db  80 dup(32)
  6566 00003C2A 202020202020202020-
  6566 00003C33 202020202020202020-
  6566 00003C3C 202020202020202020-
  6566 00003C45 202020202020202020-
  6566 00003C4E 202020202020202020-
  6566 00003C57 202020202020202020-
  6566 00003C60 202020202020202020-
  6566 00003C69 2020202020202020   
  6567 00003C71 202020202020202020-     	db  80 dup(32)
  6567 00003C7A 202020202020202020-
  6567 00003C83 202020202020202020-
  6567 00003C8C 202020202020202020-
  6567 00003C95 202020202020202020-
  6567 00003C9E 202020202020202020-
  6567 00003CA7 202020202020202020-
  6567 00003CB0 202020202020202020-
  6567 00003CB9 2020202020202020   
  6568 00003CC1 202020202020202020-     	db  80 dup(32)
  6568 00003CCA 202020202020202020-
  6568 00003CD3 202020202020202020-
  6568 00003CDC 202020202020202020-
  6568 00003CE5 202020202020202020-
  6568 00003CEE 202020202020202020-
  6568 00003CF7 202020202020202020-
  6568 00003D00 202020202020202020-
  6568 00003D09 2020202020202020   
  6569 00003D11 202020202020202020-     	db  80 dup(32)
  6569 00003D1A 202020202020202020-
  6569 00003D23 202020202020202020-
  6569 00003D2C 202020202020202020-
  6569 00003D35 202020202020202020-
  6569 00003D3E 202020202020202020-
  6569 00003D47 202020202020202020-
  6569 00003D50 202020202020202020-
  6569 00003D59 2020202020202020   
  6570 00003D61 202020202020202020-     	db  80 dup(32)
  6570 00003D6A 202020202020202020-
  6570 00003D73 202020202020202020-
  6570 00003D7C 202020202020202020-
  6570 00003D85 202020202020202020-
  6570 00003D8E 202020202020202020-
  6570 00003D97 202020202020202020-
  6570 00003DA0 202020202020202020-
  6570 00003DA9 2020202020202020   
  6571 00003DB1 202020202020202020-     	db  80 dup(32)
  6571 00003DBA 202020202020202020-
  6571 00003DC3 202020202020202020-
  6571 00003DCC 202020202020202020-
  6571 00003DD5 202020202020202020-
  6571 00003DDE 202020202020202020-
  6571 00003DE7 202020202020202020-
  6571 00003DF0 202020202020202020-
  6571 00003DF9 2020202020202020   
  6572 00003E01 202020202020202020-     	db  80 dup(32)
  6572 00003E0A 202020202020202020-
  6572 00003E13 202020202020202020-
  6572 00003E1C 202020202020202020-
  6572 00003E25 202020202020202020-
  6572 00003E2E 202020202020202020-
  6572 00003E37 202020202020202020-
  6572 00003E40 202020202020202020-
  6572 00003E49 2020202020202020   
  6573 00003E51 202020202020202020-     	db  80 dup(32)
  6573 00003E5A 202020202020202020-
  6573 00003E63 202020202020202020-
  6573 00003E6C 202020202020202020-
  6573 00003E75 202020202020202020-
  6573 00003E7E 202020202020202020-
  6573 00003E87 202020202020202020-
  6573 00003E90 202020202020202020-
  6573 00003E99 2020202020202020   
  6574 00003EA1 202020202020202020-     	db  80 dup(32)
  6574 00003EAA 202020202020202020-
  6574 00003EB3 202020202020202020-
  6574 00003EBC 202020202020202020-
  6574 00003EC5 202020202020202020-
  6574 00003ECE 202020202020202020-
  6574 00003ED7 202020202020202020-
  6574 00003EE0 202020202020202020-
  6574 00003EE9 2020202020202020   
  6575 00003EF1 202020202020202020-     	db  80 dup(32)
  6575 00003EFA 202020202020202020-
  6575 00003F03 202020202020202020-
  6575 00003F0C 202020202020202020-
  6575 00003F15 202020202020202020-
  6575 00003F1E 202020202020202020-
  6575 00003F27 202020202020202020-
  6575 00003F30 202020202020202020-
  6575 00003F39 2020202020202020   
  6576 00003F41 202020202020202020-     	db  80 dup(32)
  6576 00003F4A 202020202020202020-
  6576 00003F53 202020202020202020-
  6576 00003F5C 202020202020202020-
  6576 00003F65 202020202020202020-
  6576 00003F6E 202020202020202020-
  6576 00003F77 202020202020202020-
  6576 00003F80 202020202020202020-
  6576 00003F89 2020202020202020   
  6577 00003F91 202020202020202020-     	db  80 dup(32)
  6577 00003F9A 202020202020202020-
  6577 00003FA3 202020202020202020-
  6577 00003FAC 202020202020202020-
  6577 00003FB5 202020202020202020-
  6577 00003FBE 202020202020202020-
  6577 00003FC7 202020202020202020-
  6577 00003FD0 202020202020202020-
  6577 00003FD9 2020202020202020   
  6578 00003FE1 202020202020202020-     	db  80 dup(32)
  6578 00003FEA 202020202020202020-
  6578 00003FF3 202020202020202020-
  6578 00003FFC 202020202020202020-
  6578 00004005 202020202020202020-
  6578 0000400E 202020202020202020-
  6578 00004017 202020202020202020-
  6578 00004020 202020202020202020-
  6578 00004029 2020202020202020   
  6579 00004031 202020202020202020-     	db  80 dup(32)
  6579 0000403A 202020202020202020-
  6579 00004043 202020202020202020-
  6579 0000404C 202020202020202020-
  6579 00004055 202020202020202020-
  6579 0000405E 202020202020202020-
  6579 00004067 202020202020202020-
  6579 00004070 202020202020202020-
  6579 00004079 2020202020202020   
  6580 00004081 CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6580 0000408A CDCDCDCDCDCDCDCDCD-
  6580 00004093 CDCDCDCDCDCDCDCDCD-
  6580 0000409C CDCDCDCDCDCDCDCDCD-
  6580 000040A5 CDCDCDCDCDCDCDCDCD-
  6580 000040AE CDCDCDCDCDCDCDCDCD-
  6580 000040B7 CDCDCDCDCDCDCDCDCD-
  6580 000040C0 CDCDCDCDCDCDCDCDCD-
  6580 000040C9 CDCDCDCDCDCDCDCD   
  6581 000040D1 202020202020202020-     	db  80 dup(32)
  6581 000040DA 202020202020202020-
  6581 000040E3 202020202020202020-
  6581 000040EC 202020202020202020-
  6581 000040F5 202020202020202020-
  6581 000040FE 202020202020202020-
  6581 00004107 202020202020202020-
  6581 00004110 202020202020202020-
  6581 00004119 2020202020202020   
  6582 00004121 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6582 0000412A 202020202020202020-
  6582 00004133 202020202020202020-
  6582 0000413C 20202020202030303A-
  6582 00004145 303020AEAF2030303A-
  6582 0000414E 303020202020202020-
  6582 00004157 202020202020202020-
  6582 00004160 202020202020202056-
  6582 00004169 4F4C2030303025     
  6583 00004170 00                      	db 0
  6584                                  
  6585                                  ; 25/12/2024
  6586                                  ; 28/11/2024
  6587                                  IsInSplash:
  6588 00004171 01                      	db 1
  6589                                  
  6590                                  SplashFileName:
  6591 00004172 53504C4153482E5741-     	db "SPLASH.WAV", 0
  6591 0000417B 5600               
  6592                                  
  6593                                  ; -------------------------------------------------------------
  6594                                  
  6595                                  	; 22/12/2024
  6596                                  fillblock:
  6597 0000417D FF<rep Eh>              	times 14 db 0FFh
  6598 0000418B 0000                    	dw 0
  6599                                  
  6600                                  ; -------------------------------------------------------------
  6601                                  
  6602                                  ; 23/11/2024
  6603                                  colors:
  6604 0000418D 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6605                                  	; white, cyan, green, red, yellow, blue, magenta
  6606 00004195 0B                      ccolor:	db 0Bh	; cyan
  6607                                  
  6608                                  EOF: 
  6609                                  
  6610                                  ; -------------------------------------------------------------
  6611                                  
  6612                                  bss:
  6613                                  
  6614                                  ABSOLUTE bss
  6615                                  
  6616 00004196 ????                    alignb 4
  6617                                  
  6618                                  ; 21/12/2024
  6619                                  fontbuff1:
  6620 00004198 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6621                                  fontbuff2:
  6622 00004F98 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6623                                  
  6624                                  ; 11/12/2024
  6625                                  wleds_addr:
  6626 00005F98 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6627                                  ; 22/12/2024
  6628                                  prev_leds:
  6629 00007398 <res 140h>              	resd 80	; previous lighting leds
  6630                                  
  6631                                  ; 24/12/2024
  6632                                  wpoints_dif:	; wave lighting points factor (differential) 
  6633 000074D8 ????????                	resd 1	; required bytes for 1/18 second wave lighting
  6634                                  graphstart:
  6635 000074DC ????????                	resd 1	; start (top) line/row for wave lighting points 	 
  6636                                  
  6637                                  LFB_ADDR:
  6638 000074E0 ????????                	resd 1
  6639                                  ;nextrow:
  6640                                  	;resd 1
  6641                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6642 000074E4 ????????                	resd 1
  6643 000074E8 ????????                wcolor:	resd 1
  6644                                  ; 26/12/2024
  6645                                  ;tcolor: resb 1 ; text color
  6646                                  columns:
  6647 000074EC ??                      	resb 1
  6648 000074ED ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6649                                  
  6650 000074EE ????                    alignb 4
  6651                                  
  6652                                  bss_start:
  6653                                  
  6654                                  ; 24/12/2024
  6655                                  prev_points:
  6656 000074F0 <res A00h>              	resd 640 ; previous wave points (which are lighting)	
  6657                                  
  6658                                  ; 18/11/2024
  6659                                  stopped:
  6660 00007EF0 ??                      	resb 1
  6661 00007EF1 ??                      tLO:	resb 1
  6662                                  ; 21/11/2024
  6663 00007EF2 ??                      tLP:	resb 1
  6664                                  ; 19/11/2024
  6665 00007EF3 ??                      wleds:	resb 1
  6666                                  wleds_dif:
  6667 00007EF4 ????????                	resd 1
  6668 00007EF8 ????????                pbuf_o:	resd 1
  6669                                  ; 07/12/2024
  6670 00007EFC ??                      pbuf_s:	resb 1
  6671                                  
  6672                                  ; 07/12/2024
  6673                                  ; 24/11/2024
  6674                                  half_buffer:
  6675 00007EFD ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6676                                  
  6677                                  ; 30/05/2024
  6678 00007EFE ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6679                                  
  6680                                  ; 24/12/2024
  6681 00007EFF ??                      p_mode: resb 1	; point mode (as alternative to LED mode)
  6682                                  
  6683                                  ; 25/12/2024
  6684                                  ; 29/11/2024
  6685                                  command:
  6686 00007F00 ??                      	resb 1
  6687                                  filecount:
  6688 00007F01 ??                      	resb 1
  6689                                  
  6690                                  ; 30/11/2024
  6691 00007F02 ????                    alignb 4
  6692                                  
  6693                                  ;;;;;;;;;;;;;;
  6694                                  ; 14/11/2024
  6695                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6696                                  WAVFILEHEADERbuff:
  6697                                  RIFF_ChunkID:
  6698 00007F04 ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6699                                  		; 0x52494646
  6700                                  RIFF_ChunkSize:
  6701 00007F08 ????????                	resd 1	; Represents total file size, not 
  6702                                          	; including the first 2 fields 
  6703                                  		; (Total_File_Size - 8), little-endian
  6704                                  RIFF_Format:
  6705 00007F0C ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6706                                  		; 0x57415645
  6707                                  
  6708                                  ;; WAVE header parameters ("Sub-chunk")
  6709                                  WAVE_SubchunkID:
  6710 00007F10 ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6711                                  		; 0x666d7420
  6712                                  WAVE_SubchunkSize:
  6713 00007F14 ????????                	resd 1	; Represents total chunk size
  6714                                  WAVE_AudioFormat:
  6715 00007F18 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6716                                  		; of compression, not supported.
  6717                                  WAVE_NumChannels:
  6718 00007F1A ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6719                                  WAVE_SampleRate:
  6720 00007F1C ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6721                                  WAVE_ByteRate:
  6722 00007F20 ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6723                                  WAVE_BlockAlign:
  6724 00007F24 ????                    	resw 1	; NumChannels * BytesPerSample
  6725                                  		; Number of bytes for one sample.
  6726                                  WAVE_BitsPerSample:
  6727 00007F26 ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6728                                  
  6729                                  ;; DATA header parameters
  6730                                  DATA_SubchunkID:
  6731 00007F28 ????????                	resd 1	; Must be equal to "data" - big-endian
  6732                                          	; 0x64617461
  6733                                  DATA_SubchunkSize:
  6734 00007F2C ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6735                                          	; Number of bytes in the data.
  6736                                  ;;;;;;;;;;;;;;
  6737                                  
  6738                                  ; 15/11/2024
  6739                                  cursortype:
  6740 00007F30 ????                    	resw 1
  6741 00007F32 ??                      flags:	resb 1
  6742                                  ; 06/11/2023
  6743                                  ac97_int_ln_reg:
  6744 00007F33 ??                      	resb 1
  6745                                  filehandle:
  6746 00007F34 ????????                	resd 1
  6747                                  
  6748                                  ; 25/12/2024
  6749                                  ; 30/11/2024
  6750                                  ;argc:	resb 1	; argument count
  6751 00007F38 ????????                argv:	resd 1	; current argument (wav file) ptr
  6752 00007F3C ????????                argvf:	resd 1	; 1st argument (wav file) ptr
  6753 00007F40 ????????                argvl:	resd 1	; last argument (wav file) ptr
  6754                                  
  6755                                  ; 30/05/2024
  6756                                  wav_file_name:
  6757 00007F44 <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6758 00007F94 ????                    	resw 1	; 30/11/2024
  6759                                  
  6760                                  ; 08/11/2023
  6761                                  ; 07/11/2023
  6762                                  fbs_shift:
  6763 00007F96 ??                      	resb 1
  6764                                  ; 07/12/2024
  6765 00007F97 ??                      SRB:	resb 1
  6766                                  
  6767                                  ; 12/11/2016 - Erdogan Tan
  6768                                  bus_dev_fn:
  6769 00007F98 ????????                	resd 1
  6770                                  dev_vendor:
  6771 00007F9C ????????                	resd 1
  6772                                  
  6773                                  ; 17/02/2017
  6774                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6775                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6776                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6777                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6778 00007FA0 ????                    NAMBAR:	resw 1	; BAR for mixer
  6779                                  NABMBAR:
  6780 00007FA2 ????                    	resw 1	; BAR for bus master regs
  6781                                  
  6782                                  ; 15/11/2024
  6783                                  loadfromwavfile:
  6784 00007FA4 ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6785                                  loadsize:
  6786 00007FA8 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6787                                  buffersize:
  6788 00007FAC ????????                	resd 1	; 16 bit samples (not bytes)
  6789                                  		
  6790                                  ; 14/11/2024
  6791                                  TotalTime:
  6792 00007FB0 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6793                                  ProgressTime:
  6794 00007FB4 ????????                	resd 1
  6795 00007FB8 ????????                count:	resd 1	; byte count of one (wav file) read
  6796                                  LoadedDataBytes:
  6797 00007FBC ????????                	resd 1	; total read/load count
  6798                                  
  6799                                  timerticks:
  6800 00007FC0 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6801                                  		; (in order to get the emulator/qemu to run correctly)
  6802                                  ; 14/11/2024	
  6803                                  bss_end:
  6804                                  
  6805                                  ; 02/12/2024
  6806 00007FC4 <res 3Ch>               alignb 4096
  6807                                  
  6808                                  ; 07/12/2024
  6809                                  ; 26/11/2023
  6810                                  audio_buffer:
  6811 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6812                                  
  6813                                  ; 01/12/2024
  6814                                  ; 26/11/2023
  6815                                  temp_buffer:
  6816 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
