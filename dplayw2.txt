     1                                  ; ****************************************************************************
     2                                  ; dplaywav2.s - TRDOS 386 (TRDOS v2.0.9) WAV PLAYER - VESA VBE Video Mode 101h
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; DPLAYWAV2.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 28/12/2024
     7                                  ;
     8                                  ; [ Last Modification: 18/01/2025 ]
     9                                  ;
    10                                  ; Modified from DPLAYWAV.PRG .wav player program by Erdogan Tan, 26/12/2024
    11                                  ;
    12                                  ; ****************************************************************************
    13                                  ; nasm dplayw2.s -l dplayw2.txt -o DPLAYW2.PRG -Z error.txt
    14                                  
    15                                  ; 28/12/2024
    16                                  ; dplayw2.s : DMA buffer tracking (instead of user's audio buffer)
    17                                  
    18                                  ; Draw graphics by using 'sysvideo' bx=0305h
    19                                  ; and display text by using bx=010Fh
    20                                  
    21                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    22                                  ; ------------------------------------------------------------
    23                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    24                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    25                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    26                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    27                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    28                                  
    29                                  ; ------------------------------------------------------------
    30                                  
    31                                  ; 30/11/2024
    32                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    33                                  ; 29/04/2016
    34                                  _ver 	equ 0
    35                                  _exit 	equ 1
    36                                  _fork 	equ 2
    37                                  _read 	equ 3
    38                                  _write	equ 4
    39                                  _open	equ 5
    40                                  _close 	equ 6
    41                                  _wait 	equ 7
    42                                  _creat 	equ 8
    43                                  _link 	equ 9
    44                                  _unlink	equ 10
    45                                  _exec	equ 11
    46                                  _chdir	equ 12
    47                                  _time 	equ 13
    48                                  _mkdir 	equ 14
    49                                  _chmod	equ 15
    50                                  _chown	equ 16
    51                                  _break	equ 17
    52                                  _stat	equ 18
    53                                  _seek	equ 19
    54                                  _tell 	equ 20
    55                                  _mount	equ 21
    56                                  _umount	equ 22
    57                                  _setuid	equ 23
    58                                  _getuid	equ 24
    59                                  _stime	equ 25
    60                                  _quit	equ 26
    61                                  _intr	equ 27
    62                                  _fstat	equ 28
    63                                  _emt 	equ 29
    64                                  _mdate 	equ 30
    65                                  _video 	equ 31
    66                                  _audio	equ 32
    67                                  _timer	equ 33
    68                                  _sleep	equ 34
    69                                  _msg    equ 35
    70                                  _geterr	equ 36
    71                                  _fpsave	equ 37
    72                                  _pri	equ 38
    73                                  _rele	equ 39
    74                                  _fff	equ 40
    75                                  _fnf	equ 41
    76                                  _alloc	equ 42
    77                                  _dalloc equ 43
    78                                  _calbac equ 44
    79                                  _dma	equ 45
    80                                  _stdio  equ 46
    81                                  
    82                                  ; ------------------------------------------------------------
    83                                  
    84                                  %macro sys 1-4
    85                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    86                                      ; 03/09/2015
    87                                      ; 13/04/2015
    88                                      ; Retro UNIX 386 v1 system call.
    89                                      %if %0 >= 2
    90                                          mov ebx, %2
    91                                          %if %0 >= 3
    92                                              mov ecx, %3
    93                                              %if %0 = 4
    94                                                 mov edx, %4
    95                                              %endif
    96                                          %endif
    97                                      %endif
    98                                      mov eax, %1
    99                                      ;int 30h
   100                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   101                                  %endmacro
   102                                  
   103                                  ; Retro UNIX 386 v1 system call format:
   104                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   105                                  
   106                                  ; ------------------------------------------------------------
   107                                  
   108                                  ; player internal variables and other equates.
   109                                  BUFFERSIZE	equ 65536
   110                                  ENDOFFILE	equ 1		; flag for knowing end of file
   111                                  
   112                                  ; ------------------------------------------------------------
   113                                  
   114                                  [BITS 32] ; 32-bit intructions
   115                                  
   116                                  [ORG 0]
   117                                  
   118                                  START_CODE:
   119                                  	; Prints the Credits Text.
   120                                  	sys	_msg, Credits, 255, 0Bh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000000 BB[40280000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000005 B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000000A BA0B000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000000F B823000000          <1>  mov eax, %1
    99                              <1> 
   100 00000014 CD40                <1>  int 40h
   121                                  
   122                                  	; clear bss
   123 00000016 BF[F8720000]            	mov	edi, bss_start
   124 0000001B B9B1020000              	mov	ecx, (bss_end - bss_start)/4
   125 00000020 31C0                    	xor	eax, eax
   126 00000022 F3AB                    	rep	stosd
   127                                  
   128                                  ; -------------------------------------------------------------
   129                                  
   130                                  	; 21/12/2024
   131                                  	; Detect (& Enable) AC'97 Audio Device
   132 00000024 E812070000              	call	DetectAC97
   133 00000029 731B                    	jnc	short ac97_hardware_ready
   134                                  
   135                                  	; 30/11/2024
   136                                  	; 30/05/2024
   137                                  _dev_not_ready:
   138                                  	; couldn't find the audio device!
   139                                  	sys	_msg, noDevMsg, 255, 0Fh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000002B BB[D2280000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000030 B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000035 BA0F000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000003A B823000000          <1>  mov eax, %1
    99                              <1> 
   100 0000003F CD40                <1>  int 40h
   140 00000041 E982040000                      jmp     Exit
   141                                  
   142                                  ac97_hardware_ready:
   143 00000046 E88F080000              	call	write_audio_dev_info
   144                                  
   145                                  ; -------------------------------------------------------------
   146                                  
   147                                  	; 21/12/2024
   148                                  	;;;
   149                                  	; Read (copy) 8x14 system fonts
   150 0000004B BE[A03F0000]            	mov	esi, fontbuff1
   151                                  	sys	_video, 0C03h, 256, 0
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000050 BB030C0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000055 B900010000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000005A BA00000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000005F B81F000000          <1>  mov eax, %1
    99                              <1> 
   100 00000064 CD40                <1>  int 40h
   152                                  
   153                                  	; convert 8x14 fonts to 8x16 fonts
   154                                  	; by inserting 2 empty rows to each characters
   155                                  	;mov	esi, fontbuff1
   156 00000066 BF[A04D0000]            	mov	edi, fontbuff2
   157                                  	; 18/02/2021
   158                                  	;mov	cx, 256
   159                                  fontconvert:
   160 0000006B 51                      	push	ecx
   161 0000006C 66B90E00                	mov	cx, 14
   162 00000070 F3A4                    	rep	movsb
   163 00000072 28C0                    	sub	al, al
   164 00000074 AA                      	stosb
   165 00000075 AA                      	stosb
   166 00000076 59                      	pop	ecx
   167 00000077 E2F2                    	loop	fontconvert
   168                                  	;;;
   169                                  
   170                                  ; ------------------------------------------------------------- 
   171                                  
   172                                  	; 21/12/2024
   173                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   174                                  	sys	_video, 08FFh, 101h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000079 BBFF080000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000007E B901010000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000083 B81F000000          <1>  mov eax, %1
    99                              <1> 
   100 00000088 CD40                <1>  int 40h
   175 0000008A 09C0                    	or	eax, eax
   176 0000008C 0F8431040000            	jz	terminate    ; nothing to do				
   177                                  	;jz	trdos386_err ; write (OS) error msg and exit
   178                                  
   179                                  set_vesa_mode_101h_ok:
   180                                  	; linear frame buffer access
   181                                  	sys	_video, 06FFh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000092 BBFF060000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000097 B81F000000          <1>  mov eax, %1
    99                              <1> 
   100 0000009C CD40                <1>  int 40h
   182 0000009E 21C0                    	and	eax, eax
   183 000000A0 0F8468040000            	jz	error_exit ; set text mode and write err msg
   184 000000A6 A3[E8720000]            	mov	[LFB_ADDR], eax
   185                                  
   186                                  ; -------------------------------------------------------------
   187                                  
   188                                  	; 07/12/2024
   189                                  GetFileName_@:
   190                                  	; 30/11/2024
   191                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   192                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   193                                  	;			.. argv0text, argv1text ..) 
   194                                  	; ---- argc, argv[] ----
   195 000000AB 89E6                    	mov	esi, esp
   196 000000AD AD                      	lodsd
   197 000000AE 83F802                  	cmp	eax, 2 ; two arguments 
   198                                  		; (program file name & mod file name)
   199 000000B1 0F821A040000            	jb	pmsg_usage ; nothing to do
   200                                  	; 07/12/2024
   201 000000B7 AD                      	lodsd	; skip program (PRG) file name
   202                                  
   203                                  	; 30/11/2024 (32bit)
   204                                  	; 29/11/2024
   205                                  	; 30/05/2024
   206                                  GetFileName:
   207 000000B8 BF[3C7D0000]            	mov	edi, wav_file_name 
   208                                  	; 07/12/2024
   209 000000BD 8B36                    	mov	esi, [esi]
   210 000000BF 31C9                    	xor	ecx, ecx ; 0
   211                                  ScanName:
   212 000000C1 AC                      	lodsb
   213                                  	;test	al, al
   214                                  	;jz	short a_4
   215                                  	; 29/11/2024
   216 000000C2 3C0D                    	cmp	al, 0Dh
   217 000000C4 7638                    	jna	short a_4
   218 000000C6 3C20                    	cmp	al, 20h
   219 000000C8 74F7                    	je	short ScanName	; scan start of name.
   220 000000CA AA                      	stosb
   221 000000CB B4FF                    	mov	ah, 0FFh
   222                                  	;;;
   223                                  	; 14/11/2024
   224                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   225                                  	;xor	ecx, ecx ; 0
   226                                  	;;;
   227                                  a_0:	
   228 000000CD FEC4                    	inc	ah
   229                                  a_1:
   230                                  	;;;
   231                                  	; 14/11/2024
   232 000000CF 41                      	inc	ecx
   233                                  	;;;
   234 000000D0 AC                      	lodsb
   235 000000D1 AA                      	stosb
   236 000000D2 3C2E                    	cmp	al, '.'
   237 000000D4 74F7                    	je	short a_0
   238                                  	; 29/11/2024
   239 000000D6 3C20                    	cmp	al, 20h
   240                                  	;and	al, al
   241                                  	;jnz	short a_1
   242                                  	;;;
   243                                  	; 14/11/2024
   244 000000D8 7613                    	jna	short a_3
   245 000000DA 20E4                    	and	ah, ah
   246 000000DC 7406                    	jz	short a_2
   247 000000DE 3C2F                    	cmp	al, '/'	; 14/12/2024
   248 000000E0 7502                    	jne	short a_2
   249 000000E2 B400                    	mov	ah, 0
   250                                  a_2:
   251 000000E4 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   252 000000E7 72E6                    	jb	short a_1
   253                                  	; 29/11/2024
   254 000000E9 29C9                    	sub	ecx, ecx
   255 000000EB EB11                    	jmp	short a_4
   256                                  a_3:
   257                                  	; 29/11/2024
   258 000000ED 4F                      	dec	edi
   259                                  	;;;
   260 000000EE 08E4                    	or	ah, ah		; if period NOT found,
   261 000000F0 750C                    	jnz	short a_4 	; then add a .WAV extension.
   262                                  SetExt:
   263                                  	; 29/11/2024
   264                                  	;dec	edi
   265 000000F2 C7072E574156            	mov	dword [edi], '.WAV'
   266                                  				; ! 64+12 is DOS limit
   267                                  				; but writing +4 must not
   268                                  				; destroy the following data	 
   269                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   270                                  	; 29/11/2024
   271 000000F8 83C104                  	add	ecx, 4
   272 000000FB 83C704                  	add	edi, 4
   273                                  a_4:	
   274 000000FE C60700                  	mov	byte [edi], 0
   275                                  
   276                                          ; open existing file
   277                                  	; 28/11/2024
   278                                  	;mov	edx, wav_file_name
   279 00000101 E887060000                      call    openFile ; no error? ok.
   280 00000106 7325                            jnc     short getwavparms
   281                                  
   282                                  	; 21/12/2024
   283 00000108 E89E040000              	call	set_text_mode
   284                                  	; file not found!
   285                                  	; 30/11/2024
   286                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000010D BB[FD280000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000112 B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000117 BA0C000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000011C B823000000          <1>  mov eax, %1
    99                              <1> 
   100 00000121 CD40                <1>  int 40h
   287 00000123 E9A0030000                      jmp     Exit
   288                                  
   289                                  _exit_:
   290 00000128 E996030000              	jmp	terminate
   291                                  
   292                                  ; -------------------------------------------------------------
   293                                  
   294                                  getwavparms:
   295                                  	; 14/11/2024
   296 0000012D E890060000                     	call    getWAVParameters
   297 00000132 72F4                    	jc	short _exit_		; nothing to do
   298                                  
   299                                  	; 17/11/2024
   300 00000134 B304                    	mov	bl, 4
   301 00000136 2A1D[287D0000]          	sub	bl, byte [WAVE_BlockAlign]
   302                                  			; = 0 for 16 bit stereo
   303                                  			; = 2 for 8 bit stereo or 16 bit mono
   304                                  			; = 3 for 8 bit mono	
   305                                  
   306 0000013C D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   307                                  	; 15/11/2024
   308 0000013E 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   309 00000141 881D[8E7D0000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   310                                  					; = 0 stereo and 16 bit
   311                                  					; = 1 mono or 8 bit
   312                                  
   313                                  ; -------------------------------------------------------------
   314                                  
   315                                  	; 26/12/2024
   316                                  	; 21/12/2024
   317                                  	;mov	byte [tcolor], 15
   318                                  
   319                                  Player_SplashScreen:
   320                                  _0:
   321 00000147 E800040000              	call	drawsplashscreen
   322                                  
   323                                  	; 21/12/2024
   324                                  	;;;
   325                                  	; set wave volume led addresses
   326 0000014C 8B1D[E8720000]          	mov	ebx, [LFB_ADDR]
   327 00000152 81C300C70100            	add	ebx, (13*80*8*14)
   328 00000158 BD50000000              	mov	ebp, 80
   329 0000015D BF[A05D0000]            	mov	edi, wleds_addr
   330                                  wleds_sa_1:
   331 00000162 B90F000000              	mov	ecx, 15
   332                                  wleds_sa_2:
   333 00000167 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   334 0000016C F7E1                    	mul	ecx
   335 0000016E 01D8                    	add	eax, ebx
   336 00000170 AB                      	stosd
   337 00000171 E2F4                    	loop	wleds_sa_2
   338 00000173 89D8                    	mov	eax, ebx
   339 00000175 AB                      	stosd
   340 00000176 83C308                  	add	ebx, 8
   341 00000179 4D                      	dec	ebp
   342 0000017A 75E6                    	jnz	short wleds_sa_1
   343                                  	;;;
   344                                  
   345                                  	; 24/12/2024
   346                                  	; 07/12/2024
   347                                  	;;; wait for 3 seconds
   348                                  	sys	_time, 0 ; get time in unix epoch format
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000017C BB00000000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000181 B80D000000          <1>  mov eax, %1
    99                              <1> 
   100 00000186 CD40                <1>  int 40h
   349 00000188 89C1                    	mov	ecx, eax
   350 0000018A 83C103                  	add	ecx, 3
   351                                  _wait_3s:
   352 0000018D 90                      	nop
   353                                  	sys	_time, 0
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000018E BB00000000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000193 B80D000000          <1>  mov eax, %1
    99                              <1> 
   100 00000198 CD40                <1>  int 40h
   354 0000019A 39C8                    	cmp	eax, ecx
   355 0000019C 72EF                    	jb	short _wait_3s
   356                                  	;;;
   357                                  
   358                                  ; -------------------------------------------------------------
   359                                  
   360                                  	; 07/12/2024 (playwav9.s)
   361                                  
   362                                  	; 18/11/2023 (ich_wav4.asm)
   363                                  	; 13/11/2023 (ich_wav3.asm)
   364                                  
   365 0000019E 803D[067D0000]01        	cmp	byte [VRA], 1
   366 000001A5 7226                    	jb	short chk_sample_rate
   367                                  
   368                                  playwav_48_khz:
   369 000001A7 C705[9C7D0000]-         	mov	dword [loadfromwavfile], loadFromFile
   369 000001AD [0C080000]         
   370                                  	;mov	dword [loadsize], 0 ; 65536
   371                                  	;;;
   372                                  	; 17/11/2024
   373                                  	;mov	word [buffersize], 32768
   374                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   375                                  	; 30/11/2024
   376                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   377                                  	; 07/12/2024
   378 000001B1 B800000100              	mov	eax, BUFFERSIZE ; 65536
   379 000001B6 A3[A47D0000]            	mov	[buffersize], eax	; 16 bit samples
   380                                  	; 07/12/2024
   381                                  	;shl	eax, 1			; bytes
   382 000001BB 8A0D[8E7D0000]          	mov	cl, [fbs_shift]
   383 000001C1 D3E8                    	shr	eax, cl 
   384                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   385 000001C3 A3[A07D0000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   386                                  	;;;
   387                                  	;jmp	PlayNow ; 30/05/2024
   388                                  	; 07/12/2024
   389 000001C8 E95F020000              	jmp	Player_Template
   390                                  
   391                                  chk_sample_rate:
   392                                  	; set conversion parameters
   393                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   394 000001CD 66A1[207D0000]          	mov	ax, [WAVE_SampleRate]
   395 000001D3 663D80BB                	cmp	ax, 48000
   396 000001D7 74CE                    	je	short playwav_48_khz
   397                                  chk_22khz:
   398 000001D9 663D2256                	cmp	ax, 22050
   399 000001DD 7545                    	jne	short chk_11khz
   400 000001DF 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   401 000001E6 7615                    	jna	short chk_22khz_1
   402 000001E8 BB[76170000]            	mov	ebx, load_22khz_stereo_16_bit
   403 000001ED 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   404 000001F4 751A                    	jne	short chk_22khz_2
   405 000001F6 BB[E9160000]            	mov	ebx, load_22khz_mono_16_bit
   406 000001FB EB13                    	jmp	short chk_22khz_2
   407                                  chk_22khz_1:
   408 000001FD BB[62160000]            	mov	ebx, load_22khz_stereo_8_bit
   409 00000202 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   410 00000209 7505                    	jne	short chk_22khz_2
   411 0000020B BB[D9150000]            	mov	ebx, load_22khz_mono_8_bit
   412                                  chk_22khz_2:
   413 00000210 B85A1D0000              	mov	eax, 7514  ; (442*17)
   414 00000215 BA25000000              	mov	edx, 37
   415 0000021A B911000000              	mov	ecx, 17
   416 0000021F E9DB010000              	jmp	set_sizes
   417                                  chk_11khz:
   418 00000224 663D112B                	cmp	ax, 11025
   419 00000228 7545                    	jne	short chk_44khz
   420 0000022A 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   421 00000231 7615                    	jna	short chk_11khz_1
   422 00000233 BB[92190000]            	mov	ebx, load_11khz_stereo_16_bit
   423 00000238 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   424 0000023F 751A                    	jne	short chk_11khz_2
   425 00000241 BB[19190000]            	mov	ebx, load_11khz_mono_16_bit
   426 00000246 EB13                    	jmp	short chk_11khz_2
   427                                  chk_11khz_1:
   428 00000248 BB[9F180000]            	mov	ebx, load_11khz_stereo_8_bit
   429 0000024D 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   430 00000254 7505                    	jne	short chk_11khz_2
   431 00000256 BB[27180000]            	mov	ebx, load_11khz_mono_8_bit
   432                                  chk_11khz_2:
   433 0000025B B8AD0E0000              	mov	eax, 3757  ; (221*17)
   434 00000260 BA4A000000              	mov	edx, 74
   435 00000265 B911000000              	mov	ecx, 17
   436 0000026A E990010000              	jmp	set_sizes
   437                                  chk_44khz:
   438 0000026F 663D44AC                	cmp	ax, 44100
   439 00000273 7545                    	jne	short chk_16khz
   440 00000275 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   441 0000027C 7615                    	jna	short chk_44khz_1
   442 0000027E BB[991B0000]            	mov	ebx, load_44khz_stereo_16_bit
   443 00000283 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   444 0000028A 751A                    	jne	short chk_44khz_2
   445 0000028C BB[201B0000]            	mov	ebx, load_44khz_mono_16_bit
   446 00000291 EB13                    	jmp	short chk_44khz_2
   447                                  chk_44khz_1:
   448 00000293 BB[A31A0000]            	mov	ebx, load_44khz_stereo_8_bit
   449 00000298 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   450 0000029F 7505                    	jne	short chk_44khz_2
   451 000002A1 BB[271A0000]            	mov	ebx, load_44khz_mono_8_bit
   452                                  chk_44khz_2:
   453                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   454 000002A6 B8D93A0000              	mov	eax, 15065 ; (655*23)
   455                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   456                                  	;mov	ax, 14076 ; (612*23)
   457                                  	; 17/11/2024
   458                                  	;mov	ax, 12650 ; (550*23)
   459 000002AB BA19000000              	mov	edx, 25
   460 000002B0 B917000000              	mov	ecx, 23
   461 000002B5 E945010000              	jmp	set_sizes
   462                                  chk_16khz:
   463 000002BA 663D803E                	cmp	ax, 16000
   464 000002BE 7545                    	jne	short chk_8khz
   465 000002C0 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   466 000002C7 7615                    	jna	short chk_16khz_1
   467 000002C9 BB[1E110000]            	mov	ebx, load_16khz_stereo_16_bit
   468 000002CE 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   469 000002D5 751A                    	jne	short chk_16khz_2
   470 000002D7 BB[9D100000]            	mov	ebx, load_16khz_mono_16_bit
   471 000002DC EB13                    	jmp	short chk_16khz_2
   472                                  chk_16khz_1:
   473 000002DE BB[E30F0000]            	mov	ebx, load_16khz_stereo_8_bit
   474 000002E3 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   475 000002EA 7505                    	jne	short chk_16khz_2
   476 000002EC BB[640F0000]            	mov	ebx, load_16khz_mono_8_bit
   477                                  chk_16khz_2:
   478                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   479 000002F1 B855150000              	mov	eax, 5461
   480                                  	; 17/11/2024
   481                                  	;mov	ax, 5460
   482 000002F6 BA03000000              	mov	edx, 3
   483 000002FB B901000000              	mov	ecx, 1
   484 00000300 E9FA000000              	jmp	set_sizes
   485                                  chk_8khz:
   486 00000305 663D401F                	cmp	ax, 8000
   487 00000309 7545                    	jne	short chk_24khz
   488 0000030B 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   489 00000312 7615                    	jna	short chk_8khz_1
   490 00000314 BB[190E0000]            	mov	ebx, load_8khz_stereo_16_bit
   491 00000319 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   492 00000320 751A                    	jne	short chk_8khz_2
   493 00000322 BB[490D0000]            	mov	ebx, load_8khz_mono_16_bit
   494 00000327 EB13                    	jmp	short chk_8khz_2
   495                                  chk_8khz_1:
   496 00000329 BB[190C0000]            	mov	ebx, load_8khz_stereo_8_bit
   497 0000032E 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   498 00000335 7505                    	jne	short chk_8khz_2
   499 00000337 BB[350B0000]            	mov	ebx, load_8khz_mono_8_bit
   500                                  chk_8khz_2:
   501 0000033C B8AA0A0000              	mov	eax, 2730
   502 00000341 BA06000000              	mov	edx, 6
   503 00000346 B901000000              	mov	ecx, 1
   504 0000034B E9AF000000              	jmp	set_sizes
   505                                  chk_24khz:
   506 00000350 663DC05D                	cmp	ax, 24000
   507 00000354 7563                    	jne	short chk_32khz
   508 00000356 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   509 0000035D 7615                    	jna	short chk_24khz_1
   510                                  	; 18/01/2025 (BugFix)
   511                                  	; bx -> ebx
   512 0000035F BB[48130000]            	mov	ebx, load_24khz_stereo_16_bit
   513 00000364 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   514 0000036B 751A                    	jne	short chk_24khz_2
   515 0000036D BB[E5120000]            	mov	ebx, load_24khz_mono_16_bit
   516 00000372 EB13                    	jmp	short chk_24khz_2
   517                                  chk_24khz_1:
   518 00000374 BB[5B120000]            	mov	ebx, load_24khz_stereo_8_bit
   519 00000379 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1 
   520 00000380 7505                    	jne	short chk_24khz_2
   521 00000382 BB[F4110000]            	mov	ebx, load_24khz_mono_8_bit
   522                                  chk_24khz_2:
   523                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   524 00000387 B800200000              	mov	eax, 8192
   525                                  	; 17/11/2024
   526                                  	;mov	ax, 8190
   527 0000038C BA02000000              	mov	edx, 2
   528 00000391 B901000000              	mov	ecx, 1
   529 00000396 EB67                    	jmp	short set_sizes
   530                                  
   531                                  	; 07/12/2024
   532                                  vra_needed:
   533                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   534                                  	; 13/11/2023
   535 00000398 58                      	pop	eax ; discard return address to the caller
   536                                  	; 30/05/2024
   537                                  vra_err:
   538                                  	; 21/12/2024
   539 00000399 E80D020000              	call	set_text_mode
   540                                  	; 30/11/2024
   541                                  	sys	_msg, msg_no_vra, 255, 0Fh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000039E BB[67290000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000003A3 B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000003A8 BA0F000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000003AD B823000000          <1>  mov eax, %1
    99                              <1> 
   100 000003B2 CD40                <1>  int 40h
   542 000003B4 E90F010000              	jmp	Exit
   543                                  
   544                                  chk_32khz:
   545 000003B9 663D007D                	cmp	ax, 32000
   546 000003BD 75D9                    	jne	short vra_needed
   547 000003BF 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   548 000003C6 7615                    	jna	short chk_32khz_1
   549 000003C8 BB[49150000]            	mov	ebx, load_32khz_stereo_16_bit
   550 000003CD 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   551 000003D4 751A                    	jne	short chk_32khz_2
   552 000003D6 BB[DF140000]            	mov	ebx, load_32khz_mono_16_bit
   553 000003DB EB13                    	jmp	short chk_32khz_2
   554                                  chk_32khz_1:
   555 000003DD BB[42140000]            	mov	ebx, load_32khz_stereo_8_bit
   556 000003E2 803D[1E7D0000]01        	cmp	byte [WAVE_NumChannels], 1
   557 000003E9 7505                    	jne	short chk_32khz_2
   558 000003EB BB[CF130000]            	mov	ebx, load_32khz_mono_8_bit
   559                                  chk_32khz_2:
   560                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   561 000003F0 B8AA2A0000              	mov	eax, 10922
   562                                  	; 17/11/2024
   563                                  	;mov	ax, 10920
   564 000003F5 BA03000000              	mov	edx, 3
   565 000003FA B902000000              	mov	ecx, 2
   566                                  	;jmp	short set_sizes
   567                                  set_sizes:
   568                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   569                                  	;;;
   570                                  	; 17/11/2024
   571 000003FF 51                      	push	ecx
   572 00000400 B102                    	mov	cl, 2
   573 00000402 2A0D[8E7D0000]          	sub	cl, [fbs_shift]
   574                                  		; = 2 for 16 bit stereo
   575                                  		; = 1 for 16 bit mono or 8 bit stereo
   576                                  		; = 0 for 8 bit mono
   577 00000408 D3E0                    	shl	eax, cl
   578 0000040A 59                      	pop	ecx	
   579 0000040B A3[A07D0000]            	mov	[loadsize], eax	; (one) read count in bytes
   580                                  	;;;
   581 00000410 F7E2                    	mul	edx
   582 00000412 83F901                  	cmp	ecx, 1
   583 00000415 7402                    	je	short s_2
   584                                  s_1:
   585 00000417 F7F1                    	div	ecx
   586                                  s_2:
   587                                  	;;;
   588                                  	; eax = byte count of (to be) converted samples 
   589                                  	
   590                                  	; 17/11/2024
   591                                  	;;;
   592 00000419 8A0D[8E7D0000]          	mov	cl, [fbs_shift]
   593                                  
   594 0000041F D3E0                    	shl	eax, cl
   595                                  		; *1 for 16 bit stereo
   596                                  		; *2 for 16 bit mono or 8 bit stereo
   597                                  		; *4 for for 8 bit mono
   598                                  	;;;
   599                                  
   600                                  	; eax = 16 bit stereo byte count (target buffer size)
   601                                  	
   602                                  	; 07/12/2024
   603                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   604 00000421 A3[A47D0000]            	mov	[buffersize], eax ; buffer size in bytes
   605 00000426 891D[9C7D0000]          	mov	[loadfromwavfile], ebx
   606                                  
   607                                  ; -------------------------------------------------------------
   608                                  
   609                                  Player_Template:
   610                                  	; 21/12/2024
   611 0000042C E80B010000              	call	clearscreen
   612 00000431 E822010000              	call	drawplayingscreen
   613                                  
   614                                  	; 14/11/2024
   615 00000436 E89A1F0000              	call	SetTotalTime
   616 0000043B E867200000              	call	UpdateFileInfo
   617                                  
   618                                  ; -------------------------------------------------------------
   619                                  
   620                                  StartPlay:
   621                                  	; 21/12/2024 (VGA/LFB modifications)
   622                                  	; (Direct access/map to the LFB is already done here)
   623                                  	; ((this program is in VESA/VBE graphics mode here))
   624                                  PlayNow:
   625                                  	; 07/12/2024
   626                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000440 BB00020000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000445 8B0D[A47D0000]      <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000044B BA[00800000]        <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000450 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000455 CD40                <1>  int 40h
   627 00000457 0F82B1000000            	jc	error_exit ; return to text mode and print err msg
   628                                  
   629                                  	; 01/06/2024
   630                                  	; Initialize Audio Device (bh = 3)
   631                                  	sys	_audio, 0301h, 0, audio_int_handler
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000045D BB01030000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000462 B900000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000467 BA[F8070000]        <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000046C B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000471 CD40                <1>  int 40h
   632                                  	;jc	short error_exit
   633 00000473 7279                    	jc	init_err ; return to text mode and print err msg
   634                                  
   635                                  	;;;
   636                                  	; 14/11/2024
   637 00000475 B003                    	mov	al, 3	; 0 = max, 31 = min
   638                                  	; 15/11/2024
   639 00000477 E8A5020000              	call	SetMasterVolume
   640                                  	; 07/12/2024
   641                                  	;call	SetPCMOutVolume
   642 0000047C E8A7200000              	call	UpdateVolume
   643                                  	;;;
   644                                  	;
   645                                  	; 14/11/2024
   646 00000481 E832210000              	call	UpdateProgressBar
   647                                  	;;;
   648                                  
   649                                   	; 30/05/2024
   650                                  	; playwav4.asm
   651                                  ;_2:	; 24/12/2024
   652                                  	;call	check4keyboardstop	; flush keyboard buffer
   653                                  	;jc	short _2		; 07/11/2023
   654                                  
   655                                  	; 24/12/2024 (setting for wave lighting points)
   656 00000486 A1[E8720000]            	mov	eax, [LFB_ADDR]
   657                                  	;add	eax, 228*640 ; wave graphics start (top) line/row
   658 0000048B 05009A0100              	add	eax, 164*640 ; 256 volume levels ; 24/12/2024
   659 00000490 A3[E4720000]            	mov	[graphstart], eax
   660                                  
   661                                  ; play the .wav file. Most of the good stuff is in here.
   662                                  	
   663                                  	; 05/12/2024
   664 00000495 E818010000              	call    PlayWav
   665                                  
   666                                  ; close the .wav file and exit.
   667                                  
   668                                  	; 07/12/2024
   669                                  	;;;
   670                                  	; Stop Playing
   671                                  	;sys	_audio, 0700h
   672                                  	; Cancel callback service (for user)
   673                                  	sys	_audio, 0900h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000049A BB00090000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000049F B820000000          <1>  mov eax, %1
    99                              <1> 
   100 000004A4 CD40                <1>  int 40h
   674                                  	; Deallocate Audio Buffer (for user)
   675                                  	sys	_audio, 0A00h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000004A6 BB000A0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000004AB B820000000          <1>  mov eax, %1
    99                              <1> 
   100 000004B0 CD40                <1>  int 40h
   676                                  	; Disable Audio Device
   677                                  	sys	_audio, 0C00h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000004B2 BB000C0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000004B7 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 000004BC CD40                <1>  int 40h
   678                                  	;;;
   679                                  
   680                                  	; 25/12/2024
   681 000004BE E8E8020000              	call	closeFile
   682                                  
   683                                  terminate:
   684 000004C3 E8E3000000              	call	set_text_mode
   685                                  Exit:
   686                                  	sys	_exit
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90                              <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000004C8 B801000000          <1>  mov eax, %1
    99                              <1> 
   100 000004CD CD40                <1>  int 40h
   687                                  halt:
   688 000004CF EBFE                    	jmp	short halt
   689                                  
   690                                  ; -------------------------------------------------------------
   691                                  
   692                                  	; 30/05/2024
   693                                  pmsg_usage:
   694                                  	; 21/12/2024
   695 000004D1 E8D5000000              	call	set_text_mode
   696                                  	; 01/12/2024
   697                                  	sys	_msg, msg_usage, 255, 0Fh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000004D6 BB[B3280000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000004DB B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000004E0 BA0F000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000004E5 B823000000          <1>  mov eax, %1
    99                              <1> 
   100 000004EA CD40                <1>  int 40h
   698 000004EC EBDA                    	jmp	short Exit
   699                                  
   700                                  ; -------------------------------------------------------------
   701                                  
   702                                  	; 30/05/2024
   703                                  init_err:
   704                                  	; 21/12/2024
   705 000004EE E8B8000000              	call	set_text_mode
   706                                  	; 01/12/2024
   707                                  	sys	_msg, msg_init_err, 255, 0Fh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000004F3 BB[36290000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000004F8 B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000004FD BA0F000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000502 B823000000          <1>  mov eax, %1
    99                              <1> 
   100 00000507 CD40                <1>  int 40h
   708 00000509 EBBD                    	jmp	short Exit
   709                                  
   710                                  ; -------------------------------------------------------------
   711                                  
   712                                  	; 02/12/2024
   713                                  Player_Quit@:
   714 0000050B 58                      	pop	eax ; return addr (call PlayWav@)
   715                                  	
   716                                  	; 29/11/2024
   717                                  Player_Quit:
   718 0000050C EBB5                    	jmp	 short terminate
   719                                  
   720                                  
   721                                  ; -------------------------------------------------------------
   722                                  
   723                                  	; 07/12/2024
   724                                  error_exit:
   725                                  	; 21/12/2024
   726 0000050E E898000000              	call	set_text_mode
   727                                  trdos386_error:
   728                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000513 BB[16290000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000518 B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000051D BA0E000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000522 B823000000          <1>  mov eax, %1
    99                              <1> 
   100 00000527 CD40                <1>  int 40h
   729 00000529 EB9D                    	jmp	short Exit
   730                                  
   731                                  ; -------------------------------------------------------------
   732                                  
   733                                  	; 21/12/2024
   734                                  print_msg:
   735 0000052B B40E                    	mov	ah, 0Eh
   736 0000052D BB07000000              	mov	ebx, 7
   737                                  	;mov	bl, 7 ; char attribute & color
   738                                  p_next_chr:
   739 00000532 AC                      	lodsb
   740 00000533 08C0                    	or	al, al
   741 00000535 7404                    	jz	short p_retn ; retn
   742 00000537 CD31                    	int	31h
   743 00000539 EBF7                    	jmp	short p_next_chr
   744                                  p_retn:
   745 0000053B C3                      	retn
   746                                  
   747                                  ; -------------------------------------------------------------
   748                                  
   749                                  	; 21/12/2024
   750                                  clearscreen:
   751                                  	; fast clear
   752                                  	; 640*480, 256 colors
   753 0000053C 8B3D[E8720000]          	mov	edi, [LFB_ADDR]
   754 00000542 B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   755 00000547 31C0                    	xor	eax, eax
   756 00000549 F3AB                    	rep	stosd
   757 0000054B C3                      	retn
   758                                  
   759                                  ; -------------------------------------------------------------
   760                                  
   761                                  	; 21/12/2024
   762                                  drawsplashscreen:
   763 0000054C BD[942A0000]            	mov	ebp, SplashScreen
   764                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   765                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   766                                  	;mov	esi, 0 ; row 0, column 0
   767 00000551 BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   768 00000556 EB0A                    	jmp	short p_d_x
   769                                  drawplayingscreen:
   770 00000558 BD[35350000]            	mov	ebp, PlayingScreen
   771                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   772                                  	;mov	esi, 0 ; row 0, column 0
   773 0000055D BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   774                                  p_d_x:
   775 00000562 C605[F4720000]50        	mov	byte [columns], 80
   776                                  p_d_x_n:
   777 00000569 31D2                    	xor	edx, edx
   778 0000056B 8A5500                  	mov	dl, [ebp]
   779 0000056E 20D2                    	and	dl, dl
   780 00000570 7438                    	jz	short p_d_x_ok
   781 00000572 C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   782                                  
   783 00000575 BF[A04D0000]            	mov	edi, fontbuff2 ; start of user font data
   784 0000057A 01D7                    	add	edi, edx
   785                                  	
   786                                  	;; NOTE: Following system call writes fonts at
   787                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   788                                  	;; screen width as 640 pixels (instead of 320 pixels)
   789                                  	;; so 8Fh is sub function 0Fh (write char)
   790                                  	;; with 640 pixels screen witdh. 
   791                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   792                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   793                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   794                                  	;; region, the text is appeared on screen
   795                                  	;; while LFB is at C0000000h or E0000000h.)
   796                                  
   797                                  	;sys	_video, 018Fh, [tcolor], 8001h
   798                                  			;; use STD VGA video memory
   799                                  			;; (0A0000h)
   800                                  	;sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
   801                                  		 ; use LFB for current VBE mode
   802                                  		 ; for writing fonts on screen
   803                                  	; 26/12/2024
   804                                  	sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000057C BB0F020000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000581 B90F000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000586 BA01800000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000058B B81F000000          <1>  mov eax, %1
    99                              <1> 
   100 00000590 CD40                <1>  int 40h
   805                                  
   806 00000592 45                      	inc	ebp
   807 00000593 6683C608                	add	si, 8 ; next char pos
   808 00000597 FE0D[F4720000]          	dec	byte [columns]
   809 0000059D 75CA                    	jnz	short p_d_x_n	; next column
   810 0000059F 6631F6                  	xor	si, si
   811                                  	;;add	esi, 00100000h	; next row ; 8*16
   812                                  	;add	esi, [nextrow]
   813 000005A2 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   814 000005A8 EBB8                    	jmp	short p_d_x
   815                                  p_d_x_ok:
   816 000005AA C3                      	retn
   817                                  
   818                                  ; -------------------------------------------------------------
   819                                  
   820                                  	; 21/12/2024
   821                                  set_text_mode:
   822 000005AB 30E4                    	xor    ah, ah
   823 000005AD B003                    	mov    al, 3                        
   824                                   	;int   10h ; al = 03h text mode, int 10 video
   825 000005AF CD31                    	int    31h ; TRDOS 386 - Video interrupt
   826 000005B1 C3                      	retn
   827                                  
   828                                  ; -------------------------------------------------------------
   829                                  
   830                                  	; 07/12/2024 (playwav9.s)
   831                                  	; 26/11/2023 (playwav8.s)
   832                                  PlayWav:
   833                                  	; 19/11/2024
   834 000005B2 C605[FB7C0000]01        	mov	byte [wleds], 1
   835                                  
   836                                  	;;;
   837                                  	; 09/12/2024
   838 000005B9 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
   839 000005BE 803D[067D0000]00        	cmp	byte [VRA], 0
   840 000005C5 7614                    	jna	short _3 ; 48kHZ (interpolation)
   841                                  	;;;
   842                                  	; 01/12/2024 (32bit)
   843                                  	;movzx	eax, word [WAVE_SampleRate]
   844                                  	; 09/12/2024
   845 000005C7 66A1[207D0000]          	mov	ax, [WAVE_SampleRate]
   846 000005CD B90A000000              	mov	ecx, 10
   847 000005D2 F7E1                    	mul	ecx
   848 000005D4 B1B6                    	mov	cl, 182
   849 000005D6 F7F1                    	div	ecx
   850                                  	; ax = samples per 1/18.2 second
   851                                  	;mov	cl, byte [WAVE_BlockAlign]
   852                                  	; 09/12/2024 
   853                                  	;mov	cl, 4 ; 16 bit, stereo
   854                                  	;mul	ecx
   855 000005D8 C1E002                  	shl	eax, 2 ; * 4
   856                                  _3:
   857 000005DB A3[FC7C0000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
   858                                  				; for wave volume leds update
   859                                  				; (byte stream per 1/18.2 second)
   860                                  	;;;
   861                                  	; 24/12/2024
   862 000005E0 3D000A0000              	cmp	eax, 640*4 ; 640 samples (for 640 wave light points)
   863 000005E5 7305                    	jnb	short _4
   864 000005E7 B8000A0000              	mov	eax, 640*4	
   865                                  _4:
   866 000005EC A3[E0720000]            	mov	[wpoints_dif], eax
   867                                  	;;;
   868                                  
   869                                  RePlayWav:
   870                                  	; 07/12/2024
   871 000005F1 BF[00800000]            	mov	edi, audio_buffer
   872 000005F6 FF15[9C7D0000]          	call	dword [loadfromwavfile]
   873 000005FC 0F820CFFFFFF            	jc	error_exit
   874                                  
   875 00000602 C605[057D0000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
   876                                  
   877 00000609 A1[B07D0000]            	mov	eax, [count]
   878 0000060E 0105[B47D0000]          	add	[LoadedDataBytes], eax
   879                                  
   880 00000614 F605[367D0000]01        	test    byte [flags], ENDOFFILE  ; end of file
   881 0000061B 752C                    	jnz	short _5 ; yes
   882                                  			 ; bypass filling dma half buffer 2
   883                                  
   884                                  	; bh = 16 : update (current, first) dma half buffer
   885                                  	; bl = 0  : then switch to the next (second) half buffer
   886                                  	sys	_audio, 1000h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000061D BB00100000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000622 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000627 CD40                <1>  int 40h
   887                                  
   888                                  	; 18/12/2024
   889 00000629 C705[B07D0000]0000-     	mov	dword [count], 0
   889 00000631 0000               
   890                                  
   891                                  	; 07/12/2024
   892 00000633 BF[00800000]            	mov	edi, audio_buffer
   893 00000638 FF15[9C7D0000]          	call	dword [loadfromwavfile]
   894                                  	;jc	error_exit
   895                                  	
   896 0000063E A1[B07D0000]            	mov	eax, [count]
   897 00000643 0105[B47D0000]          	add	[LoadedDataBytes], eax
   898                                  _5:
   899                                  	; 07/12/2024
   900 00000649 668B0D[207D0000]         	mov	cx, [WAVE_SampleRate]
   901 00000650 B303                    	mov	bl, 3	; 16 bit, stereo
   902 00000652 B704                    	mov	bh, 4	; start to play
   903                                  	sys	_audio
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90                              <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000654 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000659 CD40                <1>  int 40h
   904                                  
   905                                  ; -------------------------------------------
   906                                  
   907                                  	; 22/12/2024
   908                                   	; prepare all leds as turned off
   909 0000065B E85A200000              	call	reset_wave_leds
   910                                  
   911                                  ; -------------------------------------------
   912                                  
   913                                  	; 07/12/2024 (playwav9.s)
   914                                  	; 01/12/2024 (32bit)
   915                                  	; 29/11/2024
   916                                  tuneLoop:
   917                                  	; 30/05/2024
   918                                  	; 18/11/2023 (ich_wav4.asm)
   919                                  	; 08/11/2023
   920                                  	; 06/11/2023
   921                                  tLWait:
   922                                  	; 18/11/2024
   923 00000660 803D[F87C0000]00        	cmp	byte [stopped], 0
   924                                  	; 24/11/2024
   925 00000667 761E                    	jna	short tL1
   926                                  
   927                                  tLWait@:	; 21/11/2024
   928 00000669 E8331B0000              	call	checkUpdateEvents
   929 0000066E 726E                    	jc	_exitt_
   930 00000670 803D[F97C0000]30        	cmp	byte [tLO], '0'
   931 00000677 74E7                    	je	short tLWait
   932 00000679 E86A000000              	call	tLZ
   933 0000067E C605[F97C0000]30        	mov	byte [tLO], '0'
   934 00000685 EBD9                    	jmp	short tLWait
   935                                  tL1:
   936                                  	; 27/11/2024
   937                                  	; Check AC'97 interrupt status
   938 00000687 803D[8F7D0000]00        	cmp	byte [SRB], 0
   939 0000068E 7709                    	ja	short tL3
   940                                  tL2:
   941 00000690 E80C1B0000              	call	checkUpdateEvents
   942 00000695 7247                    	jc	_exitt_
   943 00000697 EBC7                    	jmp	short tLWait
   944                                  tL3:
   945 00000699 8035[057D0000]01        	xor	byte [half_buffer], 1
   946                                  	; 07/12/2024
   947 000006A0 C605[8F7D0000]00        	mov	byte [SRB], 0
   948                                  
   949                                  	; 07/12/2024
   950 000006A7 BF[00800000]            	mov	edi, audio_buffer
   951                                  	;call	loadFromFile
   952                                  	; 18/11/2023
   953                                  	;call	word [loadfromwavfile]
   954                                  	; 01/12/2024
   955 000006AC FF15[9C7D0000]          	call	dword [loadfromwavfile]
   956 000006B2 722A                    	jc	short _exitt_	; end of file
   957                                  
   958                                  	; 07/12/2024
   959                                  	;;;;
   960                                  	; bh = 16 : update (current, first) dma half buffer
   961                                  	; bl = 0  : then switch to the other half buffer
   962                                  	sys	_audio, 1000h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000006B4 BB00100000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000006B9 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 000006BE CD40                <1>  int 40h
   963                                  	;;;;
   964                                  
   965                                  	; 26/11/2024
   966 000006C0 A0[057D0000]            	mov	al, [half_buffer]
   967 000006C5 0431                    	add	al, '1'
   968                                  	; 19/11/2024
   969 000006C7 A2[F97C0000]            	mov	[tLO], al
   970 000006CC E819000000              	call	tL0
   971                                  
   972                                  	; 24/11/2024
   973                                  	; 14/11/2024
   974                                  	;mov	ax, [count]
   975                                  	;add	[LoadedDataBytes], ax
   976                                  	;adc	word [LoadedDataBytes+2], 0
   977                                  	; 01/12/2024
   978 000006D1 A1[B07D0000]            	mov	eax, [count]
   979 000006D6 0105[B47D0000]          	add	[LoadedDataBytes], eax
   980                                  
   981                                  	; 07/12/2024 (playwav9.s)
   982                                  	; 27/11/2024 (playwav9.asm)
   983 000006DC EBB2                    	jmp	short tL2
   984                                  
   985                                  _exitt_:
   986                                  	; 07/12/2024
   987                                  	; Stop Playing
   988                                  	;mov	byte [stopped], 2
   989                                  	;sys	_audio, 0700h
   990 000006DE E8821A0000              	call	ac97_stop
   991                                  
   992                                  	;;;
   993                                  	; 14/11/2024
   994 000006E3 E8D01E0000              	call	UpdateProgressBar
   995                                  	;;;
   996                                  
   997                                  	; 18/11/2024
   998                                  tLZ:
   999                                  	; 30/05/2024
  1000 000006E8 B030                    	mov	al, '0'
  1001                                  
  1002                                  	;add	al, '0'
  1003                                  	;call	tL0
  1004                                  	;
  1005                                  	;retn
  1006                                  	; 06/11/2023
  1007                                  	;jmp	short tL0
  1008                                  	;retn
  1009                                  
  1010                                  	; 06/11/2023
  1011                                  tL0:
  1012                                  	; 29/05/2024 (TRDOS 386)
  1013                                  	; 08/11/2023
  1014                                  	; 05/11/2023
  1015                                  	; 17/02/2017 - Buffer switch test (temporary)
  1016                                  	; 06/11/2023
  1017                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1018                                  
  1019                                  	; 22/12/2024 (graphics mode modification)
  1020                                  	; (640*480, 256 colors)
  1021                                  	;;;
  1022                                  	;mov	ebp, 16
  1023 000006EA BD0E000000              	mov	ebp, 14
  1024 000006EF 8B3D[E8720000]          	mov	edi, [LFB_ADDR]
  1025 000006F5 0FB6F0                  	movzx	esi, al
  1026 000006F8 C1E604                  	shl	esi, 4 ; * 16
  1027 000006FB 81C6[A04D0000]          	add	esi, fontbuff2
  1028                                  tL0_1:
  1029 00000701 BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1030 00000706 8A26                    	mov	ah, [esi]
  1031                                  tL0_2:
  1032 00000708 B00C                    	mov	al, 0Ch ; red
  1033 0000070A D0E4                    	shl	ah, 1
  1034 0000070C 7302                    	jnc	short tL0_3
  1035 0000070E B00E                    	mov	al, 0Eh ; yellow
  1036                                  tL0_3:
  1037 00000710 AA                      	stosb
  1038 00000711 4A                      	dec	edx
  1039 00000712 75F4                    	jnz	short tL0_2
  1040 00000714 4D                      	dec	ebp
  1041 00000715 7409                    	jz	short tL0_4
  1042 00000717 81C778020000            	add	edi, 640-8 ; next line
  1043 0000071D 46                      	inc	esi
  1044 0000071E EBE1                    	jmp	short tL0_1
  1045                                  tL0_4:
  1046                                  	;;;
  1047 00000720 C3                      	retn
  1048                                  
  1049                                  ; -------------------------------------------
  1050                                  
  1051                                  	; 07/12/2024
  1052                                  SetMasterVolume:
  1053                                  	;cmp	al, 31
  1054                                  	;ja	short setvolume_ok
  1055 00000721 A2[B9230000]            	mov	[volume], al  ; max = 0, min = 31
  1056                                  
  1057 00000726 B41F                    	mov	ah, 31
  1058 00000728 28C4                    	sub	ah, al
  1059 0000072A 88E0                    	mov	al, ah
  1060                                  
  1061                                  	; Set Master Volume Level (BL=0 or 80h)
  1062                                  	; 	for next playing (BL>=80h)
  1063                                  	;sys	_audio, 0B80h, eax
  1064                                  	sys	_audio, 0B00h, eax
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000072C BB000B0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000731 89C1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000733 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000738 CD40                <1>  int 40h
  1065                                  	
  1066                                  setvolume_ok:
  1067                                  ac97_not_detected:
  1068 0000073A C3                      	retn
  1069                                  
  1070                                  ; -------------------------------------------
  1071                                  
  1072                                  	; 07/12/2024 (playwav9.s)
  1073                                  DetectAC97:
  1074                                  DetectICH:
  1075                                  	; 25/11/2023 (playwav8.s)
  1076                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1077                                          sys	_audio, 0102h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000073B BB02010000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000740 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000745 CD40                <1>  int 40h
  1078                                  	;jnc	short d_ac97_@
  1079                                  	;retn
  1080 00000747 72F1                    	jc	short ac97_not_detected
  1081                                  d_ac97_@:
  1082                                  	; 07/12/2024 (playwav9.s)
  1083                                  	; 06/06/2017
  1084                                  	sys	_audio, 0E00h ; get audio controller info
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000749 BB000E0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000074E B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000753 CD40                <1>  int 40h
  1085 00000755 0F82B3FDFFFF            	jc	error_exit ; 25/11/2023
  1086                                  
  1087                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1088                                  	;jne	_dev_not_ready	
  1089                                  
  1090                                  	; EAX = IRQ Number in AL
  1091                                  	;	Audio Device Number in AH 
  1092                                  	; EBX = DEV/VENDOR ID
  1093                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1094                                  	; ECX = BUS/DEV/FN 
  1095                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1096                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1097                                  	;      (Low word, DX = NAMBAR address)
  1098                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1099                                  
  1100 0000075B 891D[947D0000]          	mov	[dev_vendor], ebx
  1101 00000761 890D[907D0000]          	mov	[bus_dev_fn], ecx
  1102                                  
  1103 00000767 668915[987D0000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1104                                  	;shr	edx, 16
  1105                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1106 0000076E 8915[987D0000]          	mov	[NAMBAR], edx
  1107                                  
  1108 00000774 A2[377D0000]            	mov	[ac97_int_ln_reg], al
  1109                                  
  1110                                  	; 07/12/2024
  1111                                  	; 01/06/2024
  1112                                  	; 25/11/2023
  1113                                  	; Get AC'97 Codec info
  1114                                  	; (Function 14, sub function 1)
  1115                                  	sys	_audio, 0E01h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000779 BB010E0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000077E B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00000783 CD40                <1>  int 40h
  1116                                  	; Save Variable Rate Audio support bit
  1117 00000785 2401                    	and	al, 1
  1118 00000787 A2[067D0000]            	mov	[VRA], al
  1119                                  
  1120                                  	;clc
  1121                                  
  1122 0000078C C3                      	retn
  1123                                  
  1124                                  ; ----------------------------------
  1125                                  	
  1126                                  	; 01/12/2024
  1127                                  	; 14/11/2024
  1128                                  	; INPUT: ds:dx = file name address
  1129                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1130                                  openFile:
  1131                                  	;mov	ax, 3D00h	; open File for read
  1132                                  	;int	21h
  1133                                  	;jnc	short _of1
  1134                                  	; 01/12/2024 (TRDOS 386)
  1135                                  	;sys	_open, edx, 0
  1136                                  	; 07/12/2024
  1137                                  	sys	_open, wav_file_name, 0
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000078D BB[3C7D0000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000792 B900000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000797 B805000000          <1>  mov eax, %1
    99                              <1> 
   100 0000079C CD40                <1>  int 40h
  1138 0000079E 7305                    	jnc	short _of1
  1139                                  
  1140 000007A0 B8FFFFFFFF              	mov	eax, -1
  1141                                  	; cf = 1 -> not found or access error
  1142                                  _of1:
  1143 000007A5 A3[387D0000]            	mov	[filehandle], eax
  1144 000007AA C3                      	retn
  1145                                  
  1146                                  ; ----------------------------------
  1147                                  
  1148                                  ; close the currently open file
  1149                                  
  1150                                  	; 01/12/2024
  1151                                  	; 14/11/2024
  1152                                  	; INPUT: [filehandle] ; -1 = not open
  1153                                  	; OUTPUT: none
  1154                                  closeFile:
  1155 000007AB 833D[387D0000]FF        	cmp	dword [filehandle], -1
  1156 000007B2 740D                    	jz	short _cf1
  1157                                  	;mov	bx, [filehandle]  
  1158                                  	;mov	ax, 3E00h
  1159                                          ;int	21h              ; close file
  1160                                  	; 01/12/2024
  1161                                  	sys	_close, [filehandle]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000007B4 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000007BA B806000000          <1>  mov eax, %1
    99                              <1> 
   100 000007BF CD40                <1>  int 40h
  1162                                  	;mov 	dword [filehandle], -1
  1163                                  _cf1:
  1164 000007C1 C3                      	retn
  1165                                  
  1166                                  ; ----------------------------------
  1167                                  
  1168                                  	; 01/12/2024
  1169                                  	; 14/11/2024 - Erdogan Tan
  1170                                  getWAVParameters:
  1171                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1172                                  ; entry: none - assumes file is already open
  1173                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1174                                  ;	cx = number of channels (mono=1, stereo=2)
  1175                                  ;	dx = bits per sample (8, 16)
  1176                                  ;	bx = number of bytes per sample (1 to 4)
  1177                                  
  1178                                          ;mov	dx, WAVFILEHEADERbuff
  1179                                  	;mov	bx, [filehandle]
  1180                                          ;mov	cx, 44			; 44 bytes
  1181                                  	;mov	ah, 3Fh
  1182                                          ;int	21h
  1183                                  	;jc	short gwavp_retn
  1184                                  	; 01/12/2024 (TRDOS 386)
  1185                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000007C2 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000007C8 B9[087D0000]        <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000007CD BA2C000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000007D2 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000007D7 CD40                <1>  int 40h
  1186 000007D9 721C                    	jc	short gwavp_retn
  1187                                  
  1188 000007DB 83F82C                  	cmp	eax, 44
  1189 000007DE 7217                    	jb	short gwavp_retn
  1190                                  
  1191 000007E0 813D[107D0000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1191 000007E8 5645               
  1192 000007EA 750A                    	jne	short gwavp_stc_retn
  1193                                  
  1194 000007EC 66833D[1C7D0000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1195                                  	;jne	short gwavp_stc_retn
  1196 000007F4 7401                    	je	short gwavp_retn ; 15/11/2024
  1197                                  
  1198                                  	; 15/11/2024
  1199                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1200                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1201                                  	;mov	dx, [WAVE_BitsPerSample] 
  1202                                  					; return bits per sample value in DX
  1203                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1204                                  ;gwavp_retn:
  1205                                          ;retn
  1206                                  
  1207                                  gwavp_stc_retn:
  1208 000007F6 F9                      	stc
  1209                                  gwavp_retn:
  1210 000007F7 C3                      	retn
  1211                                  
  1212                                  ; --------------------------------------------------------
  1213                                  ; 07/12/2024
  1214                                  ; --------------------------------------------------------
  1215                                  ; ref: playwav8.s (04/06/2024)
  1216                                  
  1217                                  audio_int_handler:
  1218                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1219                                  
  1220                                  	; 07/12/2024
  1221                                  	;mov	al, [stopped]
  1222                                  	;cmp	al, 2
  1223                                  	;je	short _callback_retn
  1224                                  
  1225                                  	; 18/08/2020
  1226                                  	;mov	byte [SRB], 1
  1227                                  	; 07/12/2024
  1228 000007F8 FE05[8F7D0000]          	inc	byte [SRB]
  1229                                  
  1230                                  ;_callback_retn:
  1231                                  	sys	_rele ; return from callback service 
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90                              <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000007FE B827000000          <1>  mov eax, %1
    99                              <1> 
   100 00000803 CD40                <1>  int 40h
  1232                                  	; we must not come here !
  1233                                  	sys	_exit
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90                              <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000805 B801000000          <1>  mov eax, %1
    99                              <1> 
   100 0000080A CD40                <1>  int 40h
  1234                                  
  1235                                  ; --------------------------------------------------------
  1236                                  ; 07/12/2024
  1237                                  ; --------------------------------------------------------
  1238                                  
  1239                                  ; /////
  1240                                  	; 14/12/2024
  1241                                  	; 07/12/2024
  1242                                  	; 01/12/2024
  1243                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1244                                  loadFromFile:
  1245                                  	; 07/11/2023
  1246                                  
  1247 0000080C F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1248                                  					; last of the file?
  1249 00000813 7402                    	jz	short lff_0		; no
  1250 00000815 F9                      	stc
  1251 00000816 C3                      	retn
  1252                                  
  1253                                  lff_0:
  1254                                  	; 07/12/2024
  1255                                  	; 26/11/2023 (playwav8.s)
  1256                                  	;mov	edi, audio_buffer
  1257                                  
  1258                                  	; 01/12/2024 (TRDOS 386)
  1259                                  	; edi = audio buffer address
  1260                                  
  1261                                  	; 14/12/2024
  1262                                  	; 01/12/2024
  1263                                  	; 17/11/2024
  1264                                  	;mov	ebx, [filehandle]
  1265                                  	; 02/12/2024
  1266                                  	;mov	edx, [loadsize] 
  1267                                  
  1268                                  	; 17/11/2024
  1269 00000817 803D[8E7D0000]00        	cmp	byte [fbs_shift], 0
  1270 0000081E 7677                    	jna	short lff_1 ; stereo, 16 bit
  1271                                  
  1272                                  lff_2:
  1273                                  	; 01/12/2024
  1274 00000820 BE[00800100]            	mov	esi, temp_buffer 
  1275                                  	; 14/12/2024
  1276                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000825 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000082B 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000082D 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000833 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00000838 CD40                <1>  int 40h
  1277 0000083A 0F8289000000            	jc	lff_4 ; error !
  1278                                  
  1279                                  	; 01/12/2024
  1280                                  	; 14/11/2024
  1281 00000840 A3[B07D0000]            	mov	[count], eax
  1282                                  
  1283                                  	; 01/12/2024
  1284 00000845 21C0                    	and	eax, eax
  1285                                  	;jz	short lff_3
  1286                                  	; 14/12/2024
  1287 00000847 0F8485000000            	jz	lff_10
  1288                                  
  1289 0000084D 8A1D[8E7D0000]          	mov	bl, [fbs_shift]
  1290                                  
  1291                                  	; 14/12/2024
  1292 00000853 89FA                    	mov	edx, edi ; audio buffer start address
  1293                                  
  1294                                  	; 01/12/2024
  1295 00000855 89C1                    	mov	ecx, eax
  1296 00000857 803D[2A7D0000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1297 0000085E 751E                    	jne	short lff_7 ; 16 bit samples
  1298                                  	; 8 bit samples
  1299 00000860 FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1300 00000862 740E                    	jz	short lff_6 ; 8 bit, stereo
  1301                                  	; 01/12/2024 (32bit registers)
  1302                                  lff_5:
  1303                                  	; mono & 8 bit
  1304 00000864 AC                      	lodsb
  1305 00000865 2C80                    	sub	al, 80h ; 08/11/2023
  1306 00000867 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1307 0000086A 66AB                    	stosw	; left channel
  1308 0000086C 66AB                    	stosw	; right channel
  1309 0000086E E2F4                    	loop	lff_5
  1310 00000870 EB16                    	jmp	short lff_9
  1311                                  lff_6:
  1312                                  	; stereo & 8 bit
  1313 00000872 AC                      	lodsb
  1314 00000873 2C80                    	sub	al, 80h ; 08/11/2023
  1315 00000875 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1316 00000878 66AB                    	stosw
  1317 0000087A E2F6                    	loop	lff_6
  1318 0000087C EB0A                    	jmp	short lff_9
  1319                                  lff_7:
  1320 0000087E D1E9                    	shr	ecx, 1 ; word count
  1321                                  lff_8:
  1322 00000880 66AD                    	lodsw
  1323 00000882 66AB                    	stosw	; left channel
  1324 00000884 66AB                    	stosw	; right channel
  1325 00000886 E2F8                    	loop	lff_8
  1326                                  lff_9:
  1327                                  	; 14/12/2024
  1328 00000888 89F8                    	mov	eax, edi
  1329 0000088A 8B0D[A47D0000]          	mov	ecx, [buffersize] 
  1330 00000890 01D1                    	add	ecx, edx ; + buffer start address
  1331 00000892 39C8                    	cmp	eax, ecx	
  1332 00000894 7225                    	jb	short lff_3
  1333 00000896 C3                      	retn
  1334                                  	
  1335                                  lff_1:  
  1336                                  	; 07/12/2024
  1337                                  	; 01/12/2024
  1338                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1339                                  	; 14/12/2024
  1340                                  	sys 	_read, [filehandle], edi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000897 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000089D 89F9                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000089F 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000008A5 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000008AA CD40                <1>  int 40h
  1341                                  	; 07/11/2023
  1342 000008AC 721B                    	jc	short lff_4 ; error !
  1343                                  
  1344                                  	; 01/12/2024
  1345                                  	; 14/11/2024
  1346 000008AE A3[B07D0000]            	mov	[count], eax
  1347                                  
  1348                                  	; 02/12/2024
  1349 000008B3 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1350 000008B5 7411                    	je	short endLFF
  1351                                  	; edi = buffer (start) address
  1352 000008B7 01C7                    	add	edi, eax
  1353 000008B9 89D1                    	mov	ecx, edx
  1354                                  lff_3:
  1355                                  	;call	padfill			; blank pad the remainder
  1356                                  	; 21/12/2024
  1357                                  padfill:
  1358                                  	; 14/12/2024
  1359                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1360                                  	; 17/11/2024
  1361                                  	;   di = offset (to be filled with ZEROs)
  1362                                  	;   bp = buffer segment
  1363                                  	;   ax = di = number of bytes loaded
  1364                                  	;   cx = buffer size (> loaded bytes)	
  1365                                  	; 07/11/2023
  1366                                  	; 06/11/2023
  1367                                  	; 17/02/2017
  1368                                  	; 01/12/2024
  1369 000008BB 29C1                    	sub	ecx, eax
  1370                                  	; 01/12/2024
  1371                                  	; 25/11/2024
  1372 000008BD 31C0                    	xor	eax, eax
  1373                                  	; 14/12/2024
  1374 000008BF F3AA                    	rep	stosb
  1375                                  	; 21/12/2024
  1376                                  	;retn
  1377                                  	; ----------
  1378                                          ;clc				; don't exit with CY yet.
  1379 000008C1 800D[367D0000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1380                                  endLFF:
  1381 000008C8 C3                              retn
  1382                                  lff_4:
  1383                                  	; 08/11/2023
  1384 000008C9 B021                    	mov	al, '!'  ; error
  1385 000008CB E81AFEFFFF              	call	tL0
  1386                                  
  1387                                  	; 01/12/2024
  1388 000008D0 31C0                    	xor	eax, eax
  1389                                  lff_10:
  1390                                  	; 14/12/2024
  1391 000008D2 8B0D[A47D0000]          	mov	ecx, [buffersize]
  1392 000008D8 EBE1                    	jmp	short lff_3
  1393                                  
  1394                                  ; /////
  1395                                  
  1396                                  ; --------------------------------------------------------
  1397                                  ; --------------------------------------------------------
  1398                                  	
  1399                                  write_audio_dev_info:
  1400                                  	; 30/05/2024
  1401                                       	;sys_msg msgAudioCardInfo, 0Fh
  1402                                  	; 01/12/2024
  1403                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000008DA BB[8A280000]        <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000008DF B9FF000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000008E4 BA0F000000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000008E9 B823000000          <1>  mov eax, %1
    99                              <1> 
   100 000008EE CD40                <1>  int 40h
  1404 000008F0 C3                      	retn
  1405                                  
  1406                                  ; --------------------------------------------------------
  1407                                  
  1408                                  write_ac97_pci_dev_info:
  1409                                  	; 19/11/2024
  1410                                  	; 30/05/2024
  1411                                  	; 06/06/2017
  1412                                  	; 03/06/2017
  1413                                  	; BUS/DEV/FN
  1414                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1415                                  	; DEV/VENDOR
  1416                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1417                                  
  1418 000008F1 A1[947D0000]            	mov	eax, [dev_vendor]
  1419 000008F6 31DB                    	xor	ebx, ebx
  1420 000008F8 88C3                    	mov	bl, al
  1421 000008FA 88DA                    	mov	dl, bl
  1422 000008FC 80E30F                  	and	bl, 0Fh
  1423 000008FF 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1424 00000905 A2[E7290000]            	mov	[msgVendorId+3], al
  1425 0000090A 88D3                    	mov	bl, dl
  1426 0000090C C0EB04                  	shr	bl, 4
  1427 0000090F 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1428 00000915 A2[E6290000]            	mov	[msgVendorId+2], al
  1429 0000091A 88E3                    	mov	bl, ah
  1430 0000091C 88DA                    	mov	dl, bl
  1431 0000091E 80E30F                  	and	bl, 0Fh
  1432 00000921 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1433 00000927 A2[E5290000]            	mov	[msgVendorId+1], al
  1434 0000092C 88D3                    	mov	bl, dl
  1435 0000092E C0EB04                  	shr	bl, 4
  1436 00000931 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1437 00000937 A2[E4290000]            	mov	[msgVendorId], al
  1438 0000093C C1E810                  	shr	eax, 16
  1439 0000093F 88C3                    	mov	bl, al
  1440 00000941 88DA                    	mov	dl, bl
  1441 00000943 80E30F                  	and	bl, 0Fh
  1442 00000946 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1443 0000094C A2[F8290000]            	mov	[msgDevId+3], al
  1444 00000951 88D3                    	mov	bl, dl
  1445 00000953 C0EB04                  	shr	bl, 4
  1446 00000956 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1447 0000095C A2[F7290000]            	mov	[msgDevId+2], al
  1448 00000961 88E3                    	mov	bl, ah
  1449 00000963 88DA                    	mov	dl, bl
  1450 00000965 80E30F                  	and	bl, 0Fh
  1451 00000968 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1452 0000096E A2[F6290000]            	mov	[msgDevId+1], al
  1453 00000973 88D3                    	mov	bl, dl
  1454 00000975 C0EB04                  	shr	bl, 4
  1455 00000978 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1456 0000097E A2[F5290000]            	mov	[msgDevId], al
  1457                                  
  1458 00000983 A1[907D0000]            	mov	eax, [bus_dev_fn]
  1459 00000988 C1E808                  	shr	eax, 8
  1460 0000098B 88C3                    	mov	bl, al
  1461 0000098D 88DA                    	mov	dl, bl
  1462 0000098F 80E307                  	and	bl, 7 ; bit 0,1,2
  1463 00000992 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1464 00000998 A2[1D2A0000]            	mov	[msgFncNo+1], al
  1465 0000099D 88D3                    	mov	bl, dl
  1466 0000099F C0EB03                  	shr	bl, 3
  1467 000009A2 88DA                    	mov	dl, bl
  1468 000009A4 80E30F                  	and	bl, 0Fh
  1469 000009A7 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1470 000009AD A2[0F2A0000]            	mov	[msgDevNo+1], al
  1471 000009B2 88D3                    	mov	bl, dl
  1472 000009B4 C0EB04                  	shr	bl, 4
  1473 000009B7 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1474 000009BD A2[0E2A0000]            	mov	[msgDevNo], al
  1475 000009C2 88E3                    	mov	bl, ah
  1476 000009C4 88DA                    	mov	dl, bl
  1477 000009C6 80E30F                  	and	bl, 0Fh
  1478 000009C9 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1479 000009CF A2[032A0000]            	mov	[msgBusNo+1], al
  1480 000009D4 88D3                    	mov	bl, dl
  1481 000009D6 C0EB04                  	shr	bl, 4
  1482 000009D9 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1483 000009DF A2[022A0000]            	mov	[msgBusNo], al
  1484                                  
  1485                                  	;mov	ax, [ac97_NamBar]
  1486 000009E4 66A1[987D0000]          	mov	ax, [NAMBAR]
  1487 000009EA 88C3                    	mov	bl, al
  1488 000009EC 88DA                    	mov	dl, bl
  1489 000009EE 80E30F                  	and	bl, 0Fh
  1490 000009F1 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1491 000009F7 A2[2D2A0000]            	mov	[msgNamBar+3], al
  1492 000009FC 88D3                    	mov	bl, dl
  1493 000009FE C0EB04                  	shr	bl, 4
  1494 00000A01 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1495 00000A07 A2[2C2A0000]            	mov	[msgNamBar+2], al
  1496 00000A0C 88E3                    	mov	bl, ah
  1497 00000A0E 88DA                    	mov	dl, bl
  1498 00000A10 80E30F                  	and	bl, 0Fh
  1499 00000A13 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1500 00000A19 A2[2B2A0000]            	mov	[msgNamBar+1], al
  1501 00000A1E 88D3                    	mov	bl, dl
  1502 00000A20 C0EB04                  	shr	bl, 4
  1503 00000A23 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1504 00000A29 A2[2A2A0000]            	mov	[msgNamBar], al
  1505                                  
  1506                                  	;mov	ax, [ac97_NabmBar]
  1507 00000A2E 66A1[9A7D0000]          	mov	ax, [NABMBAR]
  1508 00000A34 88C3                    	mov	bl, al
  1509 00000A36 88DA                    	mov	dl, bl
  1510 00000A38 80E30F                  	and	bl, 0Fh
  1511 00000A3B 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1512 00000A41 A2[3D2A0000]            	mov	[msgNabmBar+3], al
  1513 00000A46 88D3                    	mov	bl, dl
  1514 00000A48 C0EB04                  	shr	bl, 4
  1515 00000A4B 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1516 00000A51 A2[3C2A0000]            	mov	[msgNabmBar+2], al
  1517 00000A56 88E3                    	mov	bl, ah
  1518 00000A58 88DA                    	mov	dl, bl
  1519 00000A5A 80E30F                  	and	bl, 0Fh
  1520 00000A5D 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1521 00000A63 A2[3B2A0000]            	mov	[msgNabmBar+1], al
  1522 00000A68 88D3                    	mov	bl, dl
  1523 00000A6A C0EB04                  	shr	bl, 4
  1524 00000A6D 8A83[A0290000]          	mov	al, [hex_chars+ebx]
  1525 00000A73 A2[3A2A0000]            	mov	[msgNabmBar], al
  1526                                  
  1527 00000A78 31C0                    	xor	eax, eax
  1528 00000A7A A0[377D0000]            	mov	al, [ac97_int_ln_reg]
  1529 00000A7F B10A                    	mov	cl, 10
  1530 00000A81 F6F1                    	div	cl
  1531                                  	; 23/11/2024
  1532                                  	;add	[msgIRQ], ax
  1533 00000A83 66053030                	add	ax, 3030h
  1534 00000A87 66A3[462A0000]          	mov	[msgIRQ], ax
  1535                                  	;and	al, al
  1536 00000A8D 3C30                    	cmp	al, 30h
  1537 00000A8F 750D                    	jnz	short _w_ac97imsg_
  1538 00000A91 A0[472A0000]            	mov	al, byte [msgIRQ+1]
  1539 00000A96 B420                    	mov	ah, ' '
  1540 00000A98 66A3[462A0000]          	mov	[msgIRQ], ax
  1541                                  _w_ac97imsg_:
  1542                                  	; 19/11/2024
  1543 00000A9E E8FC1B0000              	call 	clear_window
  1544 00000AA3 B60D                    	mov	dh, 13
  1545 00000AA5 B200                    	mov	dl, 0
  1546 00000AA7 E80E190000              	call	setCursorPosition
  1547                                  	;;;
  1548                                  	; 21/12/2024
  1549 00000AAC BD[B1290000]            	mov	ebp, msgAC97Info ; message
  1550                                  	; 22/12/2024
  1551                                  	;mov	cl, 07h ; color 
  1552 00000AB1 E81F000000              	call	sys_gmsg
  1553                                  	;
  1554                                  	; 30/05/2024
  1555                                  write_VRA_info:
  1556                                  	; 21/12/2024
  1557 00000AB6 BD[4B2A0000]            	mov	ebp, msgVRAheader ; message
  1558                                  	;mov	cl, 07h ; color 
  1559 00000ABB E815000000              	call	sys_gmsg
  1560                                  	;
  1561 00000AC0 803D[067D0000]00        	cmp	byte [VRA], 0
  1562 00000AC7 7607                    	jna	short _w_VRAi_no
  1563                                  _w_VRAi_yes:
  1564 00000AC9 BD[5A2A0000]            	mov	ebp, msgVRAyes
  1565 00000ACE EB05                    	jmp	short _w_VRAi_yn_msg
  1566                                  _w_VRAi_no:
  1567 00000AD0 BD[602A0000]            	mov	ebp, msgVRAno
  1568                                  _w_VRAi_yn_msg:
  1569                                  	;mov	cl, 07h ; color 
  1570                                  	;call	sys_msg
  1571                                  	;retn
  1572                                  	;jmp	short sys_gmsg
  1573                                  	;;;
  1574                                  ; --------------------------------------------------------
  1575                                  
  1576                                  	; 22/12/2024
  1577                                  	;;;
  1578                                  	; 21/12/2024
  1579                                  	; (write message in VGA/VESA-VBE mode)
  1580                                  sys_gmsg:
  1581 00000AD5 8A4500                  	mov	al, [ebp]
  1582 00000AD8 20C0                    	and	al, al
  1583 00000ADA 7458                    	jz	short sys_gmsg_ok
  1584 00000ADC 3C20                    	cmp	al, 20h
  1585 00000ADE 731E                    	jnb	short sys_gmsg_3
  1586 00000AE0 3C0D                    	cmp	al, CR ; 13
  1587 00000AE2 750C                    	jne	short sys_gmsg_2
  1588                                  	; carriege return, move cursor to column 0
  1589 00000AE4 66C705[EC720000]00-     	mov	word [screenpos], 0
  1589 00000AEC 00                 
  1590                                  sys_gmsg_1:
  1591 00000AED 45                      	inc	ebp
  1592 00000AEE EBE5                    	jmp	short sys_gmsg
  1593                                  sys_gmsg_2:
  1594 00000AF0 3C0A                    	cmp	al, LF ; 10
  1595 00000AF2 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1596                                  	; line feed, move cursor to next row
  1597 00000AF4 668305[EE720000]10      	add	word [screenpos+2], 16
  1598 00000AFC EBEF                    	jmp	short sys_gmsg_1
  1599                                  sys_gmsg_3:
  1600 00000AFE 8B35[EC720000]          	mov	esi, [screenpos]
  1601                                  		; hw = (cursor) row
  1602                                  		; si = (cursor) column
  1603 00000B04 B907000000              	mov	ecx, 07h ; gray (light)
  1604 00000B09 E8651A0000              	call	write_character
  1605 00000B0E 83C608                  	add	esi, 8
  1606                                  	;;;
  1607 00000B11 6681FE8002              	cmp	si, 640
  1608 00000B16 7213                    	jb	short sys_gmsg_5
  1609 00000B18 C1EE10                  	shr	esi, 16
  1610 00000B1B 6683C610                	add	si, 16
  1611 00000B1F 6681FEE001              	cmp	si, 480
  1612 00000B24 7202                    	jb	short sys_gmsg_4
  1613 00000B26 31F6                    	xor	esi, esi
  1614                                  sys_gmsg_4:
  1615 00000B28 C1E610                  	shl	esi, 16
  1616                                  	;;;
  1617                                  sys_gmsg_5:
  1618 00000B2B 8935[EC720000]          	mov	[screenpos], esi
  1619 00000B31 45                      	inc	ebp
  1620 00000B32 EBA1                    	jmp	short sys_gmsg
  1621                                  sys_gmsg_ok:
  1622 00000B34 C3                      	retn
  1623                                  	;;;
  1624                                  
  1625                                  ; --------------------------------------------------------
  1626                                  
  1627                                  ; 07/12/2024 - playwav9.s
  1628                                  ; 01/12/2024 - ac97play.s
  1629                                  ; 29/05/2024
  1630                                  ; 26/11/2023
  1631                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1632                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1633                                  ; 14/11/2023
  1634                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1635                                  ; --------------------------------------------------------
  1636                                  
  1637                                  ;;Note:	At the end of every buffer load,
  1638                                  ;;	during buffer switch/swap, there will be discontinuity
  1639                                  ;;	between the last converted sample and the 1st sample
  1640                                  ;;	of the next buffer.
  1641                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1642                                  ;;	-To avoid this defect, the 1st sample of
  1643                                  ;;	the next buffer may be read from the wav file but
  1644                                  ;;	the file pointer would need to be set to 1 sample back
  1645                                  ;;	again via seek system call. Time comsumption problem! -
  1646                                  ;;
  1647                                  ;;	Erdogan Tan - 15/11/2023
  1648                                  ;;
  1649                                  ;;	((If entire wav data would be loaded at once.. conversion
  1650                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1651                                  ;;	64KB buffer limit is important also it is important
  1652                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1653                                  ;;	I have tested this program by using 2-30MB wav files.))
  1654                                  ;;
  1655                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1656                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1657                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1658                                  ;;			Realtek ALC850 codec.
  1659                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1660                                  
  1661                                  load_8khz_mono_8_bit:
  1662                                  	; 15/11/2023
  1663                                  	; 14/11/2023
  1664                                  	; 13/11/2023
  1665 00000B35 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1666                                  					; last of the file?
  1667 00000B3C 7402                    	jz	short lff8m_0		; no
  1668 00000B3E F9                      	stc
  1669 00000B3F C3                      	retn
  1670                                  
  1671                                  lff8m_0:
  1672                                  	; 01/12/2024
  1673                                  	; edi = audio buffer address
  1674 00000B40 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1675                                          ;mov	edx, [loadsize]
  1676                                  
  1677                                  	; esi = buffer address
  1678                                  	;; edx = buffer size
  1679                                  
  1680                                  	; load file into memory
  1681                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000B45 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000B4B 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000B4D 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000B53 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00000B58 CD40                <1>  int 40h
  1682 00000B5A 7305                    	jnc	short lff8m_6
  1683 00000B5C E9AF000000              	jmp	lff8m_5  ; error !
  1684                                  
  1685                                  lff8m_6:
  1686                                  	; 01/12/2024
  1687 00000B61 A3[B07D0000]            	mov	[count], eax
  1688                                  	;;;
  1689                                  	; 07/12/2024
  1690                                  	;mov	edi, audio_buffer
  1691                                  	;;;
  1692 00000B66 21C0                    	and	eax, eax
  1693 00000B68 0F8499000000            	jz	lff8_eof
  1694                                  
  1695 00000B6E 89C1                    	mov	ecx, eax		; byte count
  1696                                  lff8m_1:
  1697 00000B70 AC                      	lodsb
  1698 00000B71 A2[5C210000]            	mov	[previous_val], al
  1699 00000B76 2C80                    	sub	al, 80h
  1700 00000B78 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1701 00000B7C 66AB                    	stosw		; original sample (left channel)
  1702 00000B7E 66AB                    	stosw		; original sample (right channel)
  1703                                  	;xor	eax, eax
  1704 00000B80 B080                    	mov	al, 80h
  1705 00000B82 49                      	dec	ecx
  1706 00000B83 7402                    	jz	short lff8m_2
  1707 00000B85 8A06                    	mov	al, [esi]
  1708                                  lff8m_2:
  1709                                  	;mov	[next_val], ax
  1710 00000B87 88C7                    	mov	bh, al	; [next_val]
  1711 00000B89 8A25[5C210000]          	mov	ah, [previous_val]
  1712 00000B8F 00E0                    	add	al, ah	; [previous_val]
  1713 00000B91 D0D8                    	rcr	al, 1
  1714 00000B93 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1715 00000B95 00E0                    	add	al, ah	; [previous_val]
  1716 00000B97 D0D8                    	rcr	al, 1	
  1717 00000B99 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1718 00000B9B 00E0                    	add	al, ah	; [previous_val]
  1719 00000B9D D0D8                    	rcr	al, 1
  1720 00000B9F 2C80                    	sub	al, 80h
  1721 00000BA1 66C1E008                	shl	ax, 8	
  1722 00000BA5 66AB                    	stosw		; this is 1st interpolated sample (L)
  1723 00000BA7 66AB                    	stosw		; this is 1st interpolated sample (R)
  1724 00000BA9 88D8                    	mov	al, bl
  1725 00000BAB 00D0                    	add	al, dl
  1726 00000BAD D0D8                    	rcr	al, 1
  1727 00000BAF 2C80                    	sub	al, 80h
  1728 00000BB1 66C1E008                	shl	ax, 8
  1729 00000BB5 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1730 00000BB7 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1731 00000BB9 88D0                    	mov	al, dl
  1732 00000BBB 2C80                    	sub	al, 80h
  1733 00000BBD 66C1E008                	shl	ax, 8
  1734 00000BC1 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1735 00000BC3 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1736                                  	;mov	al, [next_val]
  1737 00000BC5 88F8                    	mov	al, bh
  1738 00000BC7 00D0                    	add	al, dl
  1739 00000BC9 D0D8                    	rcr	al, 1
  1740 00000BCB 88C3                    	mov	bl, al	; this is temporary interpolation value
  1741 00000BCD 00D0                    	add	al, dl
  1742 00000BCF D0D8                    	rcr	al, 1
  1743 00000BD1 2C80                    	sub	al, 80h
  1744 00000BD3 66C1E008                	shl	ax, 8
  1745 00000BD7 66AB                    	stosw		; this is 4th interpolated sample (L)
  1746 00000BD9 66AB                    	stosw		; this is 4th interpolated sample (R)
  1747                                  	;mov	al, [next_val]
  1748 00000BDB 88F8                    	mov	al, bh
  1749 00000BDD 00D8                    	add	al, bl
  1750 00000BDF D0D8                    	rcr	al, 1
  1751 00000BE1 2C80                    	sub	al, 80h
  1752 00000BE3 66C1E008                	shl	ax, 8
  1753 00000BE7 66AB                    	stosw		; this is 5th interpolated sample (L)
  1754 00000BE9 66AB                    	stosw		; this is 5th interpolated sample (R)
  1755                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1756 00000BEB 09C9                    	or	ecx, ecx
  1757 00000BED 7581                    	jnz	short lff8m_1
  1758                                  
  1759                                  	; --------------
  1760                                  
  1761                                  lff8s_3:
  1762                                  lff8m_3:
  1763                                  lff8s2_3:
  1764                                  lff8m2_3:
  1765                                  lff16s_3:
  1766                                  lff16m_3:
  1767                                  lff16s2_3:
  1768                                  lff16m2_3:
  1769                                  lff24_3:
  1770                                  lff32_3:
  1771                                  lff44_3:
  1772                                  lff22_3:
  1773                                  lff11_3:
  1774                                  	; 08/12/2024 (BugFix)
  1775                                  	; 31/05/2024 (BugFix)
  1776 00000BEF 8B0D[A47D0000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  1777                                  	;shl	ecx, 1	; byte count ; Bug !
  1778                                  	; 08/12/2024
  1779 00000BF5 81C1[00800000]          	add	ecx, audio_buffer
  1780 00000BFB 29F9                    	sub	ecx, edi
  1781 00000BFD 7607                    	jna	short lff8m_4
  1782                                  	;inc	ecx
  1783 00000BFF C1E902                  	shr	ecx, 2
  1784 00000C02 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  1785 00000C04 F3AB                    	rep	stosd
  1786                                  lff8m_4:
  1787                                  	; 31/05/2024 (BugFix)
  1788                                  	; cf=1 ; Bug !
  1789                                  	; 08/12/2024
  1790                                  	;clc
  1791 00000C06 C3                      	retn
  1792                                  
  1793                                  lff8_eof:
  1794                                  lff16_eof:
  1795                                  lff24_eof:
  1796                                  lff32_eof:
  1797                                  lff44_eof:
  1798                                  lff22_eof:
  1799                                  lff11_eof:
  1800                                  	; 15/11/2023
  1801 00000C07 C605[367D0000]01        	mov	byte [flags], ENDOFFILE
  1802 00000C0E EBDF                    	jmp	short lff8m_3
  1803                                  
  1804                                  lff8s_5:
  1805                                  lff8m_5:
  1806                                  lff8s2_5:
  1807                                  lff8m2_5:
  1808                                  lff16s_5:
  1809                                  lff16m_5:
  1810                                  lff16s2_5:
  1811                                  lff16m2_5:
  1812                                  lff24_5:
  1813                                  lff32_5:
  1814                                  lff44_5:
  1815                                  lff22_5:
  1816                                  lff11_5:
  1817 00000C10 B021                    	mov	al, '!'  ; error
  1818 00000C12 E8D3FAFFFF              	call	tL0
  1819                                  	
  1820                                  	;jmp	short lff8m_3
  1821                                  	; 15/11/2023
  1822 00000C17 EBEE                    	jmp	lff8_eof
  1823                                  
  1824                                  	; --------------
  1825                                  
  1826                                  load_8khz_stereo_8_bit:
  1827                                  	; 15/11/2023
  1828                                  	; 14/11/2023
  1829                                  	; 13/11/2023
  1830 00000C19 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1831                                  					; last of the file?
  1832 00000C20 7402                    	jz	short lff8s_0		; no
  1833 00000C22 F9                      	stc
  1834 00000C23 C3                      	retn
  1835                                  
  1836                                  lff8s_0:
  1837                                  	; 01/12/2024
  1838                                  	; edi = audio buffer address
  1839 00000C24 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1840                                          ;mov	edx, [loadsize]
  1841                                  
  1842                                  	; esi = buffer address
  1843                                  	;; edx = buffer size
  1844                                  
  1845                                  	; load file into memory
  1846                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000C29 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000C2F 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000C31 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000C37 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00000C3C CD40                <1>  int 40h
  1847 00000C3E 72D0                    	jc	short lff8s_5 ; error !
  1848                                  
  1849                                  	; 01/12/2024
  1850 00000C40 A3[B07D0000]            	mov	[count], eax
  1851                                  	;;;
  1852                                  	; 07/12/2024
  1853                                  	;mov	edi, audio_buffer
  1854                                  	;;;
  1855 00000C45 D1E8                    	shr	eax, 1
  1856 00000C47 74BE                    	jz	short lff8_eof
  1857                                  
  1858 00000C49 89C1                    	mov	ecx, eax	; word count
  1859                                  lff8s_1:
  1860 00000C4B AC                      	lodsb
  1861 00000C4C A2[5C210000]            	mov	[previous_val_l], al
  1862 00000C51 2C80                    	sub	al, 80h
  1863 00000C53 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1864 00000C57 66AB                    	stosw		; original sample (L)
  1865 00000C59 AC                      	lodsb
  1866 00000C5A A2[5E210000]            	mov	[previous_val_r], al
  1867 00000C5F 2C80                    	sub	al, 80h
  1868 00000C61 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1869 00000C65 66AB                    	stosw		; original sample (R)
  1870                                  
  1871                                  	;xor	eax, eax
  1872 00000C67 66B88080                	mov	ax, 8080h
  1873 00000C6B 49                      	dec	ecx
  1874 00000C6C 7403                    	jz	short lff8s_2
  1875                                  		; convert 8 bit sample to 16 bit sample
  1876 00000C6E 668B06                  	mov	ax, [esi]
  1877                                  lff8s_2:
  1878 00000C71 A2[60210000]            	mov	[next_val_l], al
  1879 00000C76 8825[62210000]          	mov	[next_val_r], ah
  1880 00000C7C 8A25[5C210000]          	mov	ah, [previous_val_l]
  1881 00000C82 00E0                    	add	al, ah
  1882 00000C84 D0D8                    	rcr	al, 1
  1883 00000C86 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  1884 00000C88 00E0                    	add	al, ah
  1885 00000C8A D0D8                    	rcr	al, 1
  1886 00000C8C 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1887 00000C8E 00E0                    	add	al, ah
  1888 00000C90 D0D8                    	rcr	al, 1
  1889 00000C92 2C80                    	sub	al, 80h
  1890 00000C94 66C1E008                	shl	ax, 8
  1891 00000C98 66AB                    	stosw		; this is 1st interpolated sample (L)
  1892 00000C9A A0[62210000]            	mov	al, [next_val_r]
  1893 00000C9F 8A25[5E210000]          	mov	ah, [previous_val_r]
  1894 00000CA5 00E0                    	add	al, ah
  1895 00000CA7 D0D8                    	rcr	al, 1
  1896 00000CA9 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  1897 00000CAB 00E0                    	add	al, ah
  1898 00000CAD D0D8                    	rcr	al, 1
  1899 00000CAF 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1900 00000CB1 00E0                    	add	al, ah
  1901 00000CB3 D0D8                    	rcr	al, 1
  1902 00000CB5 2C80                    	sub	al, 80h
  1903 00000CB7 66C1E008                	shl	ax, 8
  1904 00000CBB 66AB                    	stosw		; this is 1st interpolated sample (R)
  1905 00000CBD 88D8                    	mov	al, bl
  1906 00000CBF 00D0                    	add	al, dl
  1907 00000CC1 D0D8                    	rcr	al, 1
  1908 00000CC3 2C80                    	sub	al, 80h
  1909 00000CC5 66C1E008                	shl	ax, 8
  1910 00000CC9 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1911 00000CCB 88F8                    	mov	al, bh
  1912 00000CCD 00F0                    	add	al, dh
  1913 00000CCF D0D8                    	rcr	al, 1
  1914 00000CD1 2C80                    	sub	al, 80h
  1915 00000CD3 66C1E008                	shl	ax, 8
  1916 00000CD7 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1917 00000CD9 88D0                    	mov	al, dl
  1918 00000CDB 2C80                    	sub	al, 80h
  1919 00000CDD 66C1E008                	shl	ax, 8
  1920 00000CE1 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1921 00000CE3 88F0                    	mov	al, dh
  1922 00000CE5 2C80                    	sub	al, 80h
  1923 00000CE7 66C1E008                	shl	ax, 8
  1924 00000CEB 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1925 00000CED A0[60210000]            	mov	al, [next_val_l]
  1926 00000CF2 00D0                    	add	al, dl
  1927 00000CF4 D0D8                    	rcr	al, 1
  1928 00000CF6 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1929 00000CF8 00D0                    	add	al, dl
  1930 00000CFA D0D8                    	rcr	al, 1
  1931 00000CFC 2C80                    	sub	al, 80h
  1932 00000CFE 66C1E008                	shl	ax, 8
  1933 00000D02 66AB                    	stosw		; this is 4th interpolated sample (L)
  1934 00000D04 A0[62210000]            	mov	al, [next_val_r]
  1935 00000D09 00F0                    	add	al, dh
  1936 00000D0B D0D8                    	rcr	al, 1
  1937 00000D0D 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1938 00000D0F 00F0                    	add	al, dh
  1939 00000D11 D0D8                    	rcr	al, 1
  1940 00000D13 2C80                    	sub	al, 80h
  1941 00000D15 66C1E008                	shl	ax, 8
  1942 00000D19 66AB                    	stosw		; this is 4th interpolated sample (R)
  1943 00000D1B A0[60210000]            	mov	al, [next_val_l]
  1944 00000D20 00D8                    	add	al, bl
  1945 00000D22 D0D8                    	rcr	al, 1
  1946 00000D24 2C80                    	sub	al, 80h
  1947 00000D26 66C1E008                	shl	ax, 8
  1948 00000D2A 66AB                    	stosw		; this is 5th interpolated sample (L)
  1949 00000D2C A0[62210000]            	mov	al, [next_val_r]
  1950 00000D31 00F8                    	add	al, bh
  1951 00000D33 D0D8                    	rcr	al, 1
  1952 00000D35 2C80                    	sub	al, 80h
  1953 00000D37 66C1E008                	shl	ax, 8
  1954 00000D3B 66AB                    	stosw		; this is 5th interpolated sample (R)
  1955                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1956 00000D3D E305                    	jecxz	lff8s_6
  1957 00000D3F E907FFFFFF              	jmp	lff8s_1
  1958                                  lff8s_6:
  1959 00000D44 E9A6FEFFFF              	jmp	lff8s_3
  1960                                  
  1961                                  load_8khz_mono_16_bit:
  1962                                  	; 13/11/2023
  1963 00000D49 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1964                                  					; last of the file?
  1965 00000D50 7402                    	jz	short lff8m2_0		; no
  1966 00000D52 F9                      	stc
  1967 00000D53 C3                      	retn
  1968                                  
  1969                                  lff8m2_0:
  1970                                  	; 01/12/2024
  1971                                  	; edi = audio buffer address
  1972 00000D54 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1973                                          ;mov	edx, [loadsize]
  1974                                  
  1975                                  	; esi = buffer address
  1976                                  	;; edx = buffer size
  1977                                  
  1978                                  	; load file into memory
  1979                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000D59 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000D5F 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000D61 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000D67 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00000D6C CD40                <1>  int 40h
  1980 00000D6E 0F82A0000000            	jc	lff8m2_7 ; error !
  1981                                  
  1982                                  	; 01/12/2024
  1983 00000D74 A3[B07D0000]            	mov	[count], eax
  1984                                  	;;;
  1985                                  	; 07/12/2024
  1986                                  	;mov	edi, audio_buffer
  1987                                  	;;;
  1988 00000D79 D1E8                    	shr	eax, 1
  1989 00000D7B 7505                    	jnz	short lff8m2_8
  1990 00000D7D E985FEFFFF              	jmp	lff8_eof
  1991                                  
  1992                                  lff8m2_8:
  1993 00000D82 89C1                    	mov	ecx, eax	; word count
  1994                                  lff8m2_1:
  1995 00000D84 66AD                    	lodsw
  1996 00000D86 66AB                    	stosw		; original sample (left channel)
  1997 00000D88 66AB                    	stosw		; original sample (right channel)
  1998 00000D8A 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1999 00000D8D 66A3[5C210000]          	mov	[previous_val], ax
  2000 00000D93 31C0                    	xor	eax, eax
  2001 00000D95 49                      	dec	ecx
  2002 00000D96 7403                    	jz	short lff8m2_2
  2003 00000D98 668B06                  	mov	ax, [esi]
  2004                                  lff8m2_2:
  2005 00000D9B 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  2006 00000D9E 89C5                    	mov	ebp, eax	; [next_val]
  2007 00000DA0 660305[5C210000]        	add	ax, [previous_val]
  2008 00000DA7 66D1D8                  	rcr	ax, 1
  2009 00000DAA 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  2010 00000DAC 660305[5C210000]        	add	ax, [previous_val]
  2011 00000DB3 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  2012 00000DB6 89C3                    	mov	ebx, eax 		
  2013 00000DB8 660305[5C210000]        	add	ax, [previous_val]
  2014 00000DBF 66D1D8                  	rcr	ax, 1
  2015 00000DC2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2016 00000DC5 66AB                    	stosw		; this is 1st interpolated sample (L)
  2017 00000DC7 66AB                    	stosw		; this is 1st interpolated sample (R)
  2018 00000DC9 89D8                    	mov	eax, ebx
  2019 00000DCB 6601D0                  	add	ax, dx
  2020 00000DCE 66D1D8                  	rcr	ax, 1
  2021 00000DD1 80EC80                  	sub	ah, 80h
  2022 00000DD4 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2023 00000DD6 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2024 00000DD8 89D0                    	mov	eax, edx
  2025 00000DDA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2026 00000DDD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2027 00000DDF 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2028 00000DE1 89E8                    	mov	eax, ebp
  2029 00000DE3 6601D0                  	add	ax, dx
  2030 00000DE6 66D1D8                  	rcr	ax, 1
  2031 00000DE9 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2032 00000DEB 6601D0                  	add	ax, dx
  2033 00000DEE 66D1D8                  	rcr	ax, 1
  2034 00000DF1 80EC80                  	sub	ah, 80h
  2035 00000DF4 66AB                    	stosw		; this is 4th interpolated sample (L)
  2036 00000DF6 66AB                    	stosw		; this is 4th interpolated sample (R)
  2037 00000DF8 89E8                    	mov	eax, ebp
  2038 00000DFA 6601D8                  	add	ax, bx
  2039 00000DFD 66D1D8                  	rcr	ax, 1
  2040 00000E00 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2041 00000E03 66AB                    	stosw		; this is 5th interpolated sample (L)
  2042 00000E05 66AB                    	stosw		; this is 5th interpolated sample (R)
  2043                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2044 00000E07 09C9                    	or	ecx, ecx
  2045 00000E09 0F8575FFFFFF            	jnz	lff8m2_1
  2046 00000E0F E9DBFDFFFF              	jmp	lff8m2_3
  2047                                  
  2048                                  lff8m2_7:
  2049                                  lff8s2_7:
  2050 00000E14 E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2051                                  
  2052                                  load_8khz_stereo_16_bit:
  2053                                  	; 16/11/2023
  2054                                  	; 15/11/2023
  2055                                  	; 13/11/2023
  2056 00000E19 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2057                                  					; last of the file?
  2058 00000E20 7402                    	jz	short lff8s2_0		; no
  2059 00000E22 F9                      	stc
  2060 00000E23 C3                      	retn
  2061                                  
  2062                                  lff8s2_0:
  2063                                  	; 01/12/2024
  2064                                  	; edi = audio buffer address
  2065 00000E24 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2066                                          ;mov	edx, [loadsize]
  2067                                  
  2068                                  	; esi = buffer address
  2069                                  	;; edx = buffer size
  2070                                  
  2071                                  	; load file into memory
  2072                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000E29 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000E2F 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000E31 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000E37 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00000E3C CD40                <1>  int 40h
  2073 00000E3E 72D4                    	jc	short lff8s2_7 ; error !
  2074                                  
  2075                                  	; 01/12/2024
  2076 00000E40 A3[B07D0000]            	mov	[count], eax
  2077                                  	;;;
  2078                                  	; 07/12/2024
  2079                                  	;mov	edi, audio_buffer
  2080                                  	;;;
  2081 00000E45 C1E802                  	shr	eax, 2
  2082 00000E48 7505                    	jnz	short lff8s2_8
  2083 00000E4A E9B8FDFFFF              	jmp	lff8_eof
  2084                                  
  2085                                  lff8s2_8:
  2086 00000E4F 89C1                    	mov	ecx, eax ; dword count
  2087                                  lff8s2_1:
  2088 00000E51 66AD                    	lodsw
  2089 00000E53 66AB                    	stosw		; original sample (L)
  2090                                  	; 15/11/2023
  2091 00000E55 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2092 00000E58 66A3[5C210000]          	mov	[previous_val_l], ax
  2093 00000E5E 66AD                    	lodsw
  2094 00000E60 66AB                    	stosw		; original sample (R)
  2095 00000E62 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2096 00000E65 66A3[5E210000]          	mov	[previous_val_r], ax
  2097 00000E6B 31D2                    	xor	edx, edx
  2098 00000E6D 31C0                    	xor	eax, eax
  2099                                  	; 16/11/2023
  2100 00000E6F 49                      	dec	ecx
  2101 00000E70 7407                    	jz	short lff8s2_2
  2102 00000E72 668B06                  	mov	ax, [esi]
  2103 00000E75 668B5602                	mov	dx, [esi+2]
  2104                                  lff8s2_2:
  2105 00000E79 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2106 00000E7C 66A3[60210000]          	mov	[next_val_l], ax
  2107 00000E82 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2108 00000E85 668915[62210000]        	mov	[next_val_r], dx
  2109 00000E8C 660305[5C210000]        	add	ax, [previous_val_l]
  2110 00000E93 66D1D8                  	rcr	ax, 1
  2111 00000E96 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2112 00000E98 660305[5C210000]        	add	ax, [previous_val_l]
  2113 00000E9F 66D1D8                  	rcr	ax, 1	
  2114 00000EA2 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2115 00000EA4 660305[5C210000]        	add	ax, [previous_val_l]
  2116 00000EAB 66D1D8                  	rcr	ax, 1
  2117 00000EAE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2118 00000EB1 66AB                    	stosw		; this is 1st interpolated sample (L)
  2119 00000EB3 66A1[62210000]          	mov	ax, [next_val_r]
  2120 00000EB9 660305[5E210000]        	add	ax, [previous_val_r]
  2121 00000EC0 66D1D8                  	rcr	ax, 1
  2122 00000EC3 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2123 00000EC5 660305[5E210000]        	add	ax, [previous_val_r]
  2124 00000ECC 66D1D8                  	rcr	ax, 1
  2125 00000ECF 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2126 00000ED0 660305[5E210000]        	add	ax, [previous_val_r]
  2127 00000ED7 66D1D8                  	rcr	ax, 1
  2128 00000EDA 80EC80                  	sub	ah, 80h
  2129 00000EDD 66AB                    	stosw		; this is 1st interpolated sample (R)
  2130 00000EDF 89D8                    	mov	eax, ebx
  2131 00000EE1 6601D0                  	add	ax, dx
  2132 00000EE4 66D1D8                  	rcr	ax, 1
  2133 00000EE7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2134 00000EEA 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2135 00000EEC 58                      	pop	eax ; *
  2136 00000EED 6601E8                  	add	ax, bp
  2137 00000EF0 66D1D8                  	rcr	ax, 1
  2138 00000EF3 80EC80                  	sub	ah, 80h
  2139 00000EF6 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2140 00000EF8 89D0                    	mov	eax, edx
  2141 00000EFA 80EC80                  	sub	ah, 80h
  2142 00000EFD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2143 00000EFF 89E8                    	mov	eax, ebp
  2144 00000F01 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2145 00000F04 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2146 00000F06 66A1[60210000]          	mov	ax, [next_val_l]
  2147 00000F0C 6601D0                  	add	ax, dx
  2148 00000F0F 66D1D8                  	rcr	ax, 1
  2149 00000F12 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2150 00000F14 6601D0                  	add	ax, dx
  2151 00000F17 66D1D8                  	rcr	ax, 1
  2152 00000F1A 80EC80                  	sub	ah, 80h
  2153 00000F1D 66AB                    	stosw		; this is 4th interpolated sample (L)
  2154 00000F1F 66A1[62210000]          	mov	ax, [next_val_r]
  2155 00000F25 6601E8                  	add	ax, bp
  2156 00000F28 66D1D8                  	rcr	ax, 1
  2157 00000F2B 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2158 00000F2C 6601E8                  	add	ax, bp
  2159 00000F2F 66D1D8                  	rcr	ax, 1
  2160 00000F32 80EC80                  	sub	ah, 80h
  2161 00000F35 66AB                    	stosw		; this is 4th interpolated sample (R)
  2162 00000F37 66A1[60210000]          	mov	ax, [next_val_l]
  2163 00000F3D 6601D8                  	add	ax, bx
  2164 00000F40 66D1D8                  	rcr	ax, 1
  2165 00000F43 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2166 00000F46 66AB                    	stosw		; this is 5th interpolated sample (L)
  2167 00000F48 58                      	pop	eax ; **
  2168 00000F49 660305[62210000]        	add	ax, [next_val_r]
  2169 00000F50 66D1D8                  	rcr	ax, 1
  2170 00000F53 80EC80                  	sub	ah, 80h
  2171 00000F56 66AB                    	stosw		; this is 5th interpolated sample (R)
  2172                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2173 00000F58 E305                    	jecxz	lff8_s2_9
  2174 00000F5A E9F2FEFFFF              	jmp	lff8s2_1
  2175                                  lff8_s2_9:
  2176 00000F5F E98BFCFFFF              	jmp	lff8s2_3
  2177                                  
  2178                                  ; .....................
  2179                                  
  2180                                  load_16khz_mono_8_bit:
  2181                                  	; 14/11/2023
  2182                                  	; 13/11/2023
  2183 00000F64 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2184                                  					; last of the file?
  2185 00000F6B 7402                    	jz	short lff16m_0		; no
  2186 00000F6D F9                      	stc
  2187 00000F6E C3                      	retn
  2188                                  
  2189                                  lff16m_0:
  2190                                  	; 01/12/2024
  2191                                  	; edi = audio buffer address
  2192 00000F6F BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2193                                          ;mov	edx, [loadsize]
  2194                                  
  2195                                  	; esi = buffer address
  2196                                  	;; edx = buffer size
  2197                                  
  2198                                  	; load file into memory
  2199                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000F74 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000F7A 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000F7C 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00000F82 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00000F87 CD40                <1>  int 40h
  2200 00000F89 7253                    	jc	short lff16m_7 ; error !
  2201                                  
  2202                                  	; 01/12/2024
  2203 00000F8B A3[B07D0000]            	mov	[count], eax
  2204                                  	;;;
  2205                                  	; 07/12/2024
  2206                                  	;mov	edi, audio_buffer
  2207                                  	;;;
  2208 00000F90 21C0                    	and	eax, eax
  2209 00000F92 7505                    	jnz	short lff16m_8
  2210 00000F94 E96EFCFFFF              	jmp	lff16_eof
  2211                                  
  2212                                  lff16m_8:
  2213 00000F99 89C1                    	mov	ecx, eax		; byte count
  2214                                  lff16m_1:
  2215 00000F9B AC                      	lodsb
  2216                                  	;mov	[previous_val], al
  2217 00000F9C 88C3                    	mov	bl, al
  2218 00000F9E 2C80                    	sub	al, 80h
  2219 00000FA0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2220 00000FA4 66AB                    	stosw		; original sample (left channel)
  2221 00000FA6 66AB                    	stosw		; original sample (right channel)
  2222                                  	;xor	ax, ax
  2223                                  	; 14/11/22023
  2224 00000FA8 B080                    	mov	al, 80h
  2225 00000FAA 49                      	dec	ecx
  2226 00000FAB 7402                    	jz	short lff16m_2
  2227 00000FAD 8A06                    	mov	al, [esi]
  2228                                  lff16m_2:
  2229                                  	;mov	[next_val], al
  2230 00000FAF 88C7                    	mov	bh, al
  2231                                  	;add	al, [previous_val]
  2232 00000FB1 00D8                    	add	al, bl
  2233 00000FB3 D0D8                    	rcr	al, 1
  2234 00000FB5 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2235                                  	;add	al, [previous_val]
  2236 00000FB7 00D8                    	add	al, bl
  2237 00000FB9 D0D8                    	rcr	al, 1
  2238 00000FBB 2C80                    	sub	al, 80h
  2239 00000FBD 66C1E008                	shl	ax, 8
  2240 00000FC1 66AB                    	stosw		; this is 1st interpolated sample (L)
  2241 00000FC3 66AB                    	stosw		; this is 1st interpolated sample (R)
  2242                                  	;mov	al, [next_val]
  2243 00000FC5 88F8                    	mov	al, bh
  2244 00000FC7 00D0                    	add	al, dl
  2245 00000FC9 D0D8                    	rcr	al, 1
  2246 00000FCB 2C80                    	sub	al, 80h
  2247 00000FCD 66C1E008                	shl	ax, 8
  2248 00000FD1 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2249 00000FD3 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2250                                  	
  2251                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2252 00000FD5 09C9                    	or	ecx, ecx
  2253 00000FD7 75C2                    	jnz	short lff16m_1
  2254 00000FD9 E911FCFFFF              	jmp	lff16m_3
  2255                                  
  2256                                  lff16m_7:
  2257                                  lff16s_7:
  2258 00000FDE E92DFCFFFF              	jmp	lff16m_5  ; error
  2259                                  
  2260                                  load_16khz_stereo_8_bit:
  2261                                  	; 14/11/2023
  2262                                  	; 13/11/2023
  2263 00000FE3 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2264                                  					; last of the file?
  2265 00000FEA 7402                    	jz	short lff16s_0		; no
  2266 00000FEC F9                      	stc
  2267 00000FED C3                      	retn
  2268                                  
  2269                                  lff16s_0:
  2270                                  	; 01/12/2024
  2271                                  	; edi = audio buffer address
  2272 00000FEE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2273                                          ;mov	edx, [loadsize]
  2274                                  
  2275                                  	; esi = buffer address
  2276                                  	;; edx = buffer size
  2277                                  
  2278                                  	; load file into memory
  2279                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00000FF3 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00000FF9 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00000FFB 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001001 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001006 CD40                <1>  int 40h
  2280 00001008 72D4                    	jc	short lff16s_7 ; error !
  2281                                  
  2282                                  	; 01/12/2024
  2283 0000100A A3[B07D0000]            	mov	[count], eax
  2284                                  	;;;
  2285                                  	; 07/12/2024
  2286                                  	;mov	edi, audio_buffer
  2287                                  	;;;
  2288 0000100F D1E8                    	shr	eax, 1
  2289 00001011 7505                    	jnz	short lff16s_8
  2290 00001013 E9EFFBFFFF              	jmp	lff16_eof
  2291                                  
  2292                                  lff16s_8:
  2293 00001018 89C1                    	mov	ecx, eax	; word count
  2294                                  lff16s_1:
  2295 0000101A AC                      	lodsb
  2296 0000101B A2[5C210000]            	mov	[previous_val_l], al
  2297 00001020 2C80                    	sub	al, 80h
  2298 00001022 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2299 00001026 66AB                    	stosw		; original sample (L)
  2300 00001028 AC                      	lodsb
  2301 00001029 A2[5E210000]            	mov	[previous_val_r], al
  2302 0000102E 2C80                    	sub	al, 80h
  2303 00001030 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2304 00001034 66AB                    	stosw		; original sample (R)
  2305                                  
  2306                                  	;xor	eax, eax
  2307 00001036 66B88080                	mov	ax, 8080h
  2308 0000103A 49                      	dec	ecx
  2309 0000103B 7403                    	jz	short lff16s_2
  2310                                  		; convert 8 bit sample to 16 bit sample
  2311 0000103D 668B06                  	mov	ax, [esi]
  2312                                  lff16s_2:
  2313                                  	;mov	[next_val_l], al
  2314                                  	;mov	[next_val_r], ah
  2315 00001040 89C3                    	mov	ebx, eax
  2316 00001042 0205[5C210000]          	add	al, [previous_val_l]
  2317 00001048 D0D8                    	rcr	al, 1
  2318 0000104A 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2319 0000104C 0205[5C210000]          	add	al, [previous_val_l]
  2320 00001052 D0D8                    	rcr	al, 1
  2321 00001054 2C80                    	sub	al, 80h
  2322 00001056 66C1E008                	shl	ax, 8
  2323 0000105A 66AB                    	stosw		; this is 1st interpolated sample (L)
  2324 0000105C 88F8                    	mov	al, bh	; [next_val_r]
  2325 0000105E 0205[5E210000]          	add	al, [previous_val_r]
  2326 00001064 D0D8                    	rcr	al, 1
  2327 00001066 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2328 00001068 0205[5E210000]          	add	al, [previous_val_r]
  2329 0000106E D0D8                    	rcr	al, 1
  2330 00001070 2C80                    	sub	al, 80h
  2331 00001072 66C1E008                	shl	ax, 8
  2332 00001076 66AB                    	stosw		; this is 1st interpolated sample (R)
  2333 00001078 88D0                    	mov	al, dl
  2334 0000107A 00D8                    	add	al, bl	; [next_val_l]
  2335 0000107C D0D8                    	rcr	al, 1
  2336 0000107E 2C80                    	sub	al, 80h
  2337 00001080 66C1E008                	shl	ax, 8
  2338 00001084 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2339 00001086 88F0                    	mov	al, dh
  2340 00001088 00F8                    	add	al, bh	; [next_val_r]
  2341 0000108A D0D8                    	rcr	al, 1
  2342 0000108C 2C80                    	sub	al, 80h
  2343 0000108E 66C1E008                	shl	ax, 8
  2344 00001092 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2345                                  	
  2346                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2347 00001094 09C9                    	or	ecx, ecx
  2348 00001096 7582                    	jnz	short lff16s_1
  2349 00001098 E952FBFFFF              	jmp	lff16s_3
  2350                                  
  2351                                  load_16khz_mono_16_bit:
  2352                                  	; 15/11/2023
  2353                                  	; 13/11/2023
  2354 0000109D F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2355                                  					; last of the file?
  2356 000010A4 7402                    	jz	short lff16m2_0		; no
  2357 000010A6 F9                      	stc
  2358 000010A7 C3                      	retn
  2359                                  
  2360                                  lff16m2_0:
  2361                                  	; 01/12/2024
  2362                                  	; edi = audio buffer address
  2363 000010A8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2364                                          ;mov	edx, [loadsize]
  2365                                  
  2366                                  	; esi = buffer address
  2367                                  	;; edx = buffer size
  2368                                  
  2369                                  	; load file into memory
  2370                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000010AD 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000010B3 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000010B5 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000010BB B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000010C0 CD40                <1>  int 40h
  2371 000010C2 7255                    	jc	short lff16m2_7 ; error !
  2372                                  
  2373                                  	; 01/12/2024
  2374 000010C4 A3[B07D0000]            	mov	[count], eax
  2375                                  	;;;
  2376                                  	; 07/12/2024
  2377                                  	;mov	edi, audio_buffer
  2378                                  	;;;
  2379 000010C9 D1E8                    	shr	eax, 1
  2380 000010CB 7505                    	jnz	short lff16m2_8
  2381 000010CD E935FBFFFF              	jmp	lff16_eof
  2382                                  
  2383                                  lff16m2_8:
  2384 000010D2 89C1                    	mov	ecx, eax  ; word count
  2385                                  lff16m2_1:
  2386 000010D4 66AD                    	lodsw
  2387 000010D6 66AB                    	stosw		; original sample (left channel)
  2388 000010D8 66AB                    	stosw		; original sample (right channel)
  2389 000010DA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2390                                  	;mov	[previous_val], ax
  2391 000010DD 89C3                    	mov	ebx, eax
  2392 000010DF 31C0                    	xor	eax, eax
  2393 000010E1 49                      	dec	ecx
  2394 000010E2 7403                    	jz	short lff16m2_2
  2395 000010E4 668B06                  	mov	ax, [esi]
  2396                                  lff16m2_2:
  2397 000010E7 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2398 000010EA 89C5                    	mov	ebp, eax	; [next_val]
  2399                                  	;add	ax, [previous_val]
  2400 000010EC 6601D8                  	add	ax, bx
  2401 000010EF 66D1D8                  	rcr	ax, 1
  2402 000010F2 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2403                                  	;add	ax, [previous_val]
  2404 000010F4 6601D8                  	add	ax, bx
  2405 000010F7 66D1D8                  	rcr	ax, 1
  2406 000010FA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2407 000010FD 66AB                    	stosw		; this is 1st interpolated sample (L)
  2408 000010FF 66AB                    	stosw		; this is 1st interpolated sample (R)
  2409 00001101 89E8                    	mov	eax, ebp
  2410 00001103 6601D0                  	add	ax, dx
  2411 00001106 66D1D8                  	rcr	ax, 1
  2412 00001109 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2413 0000110C 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2414 0000110E 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2415                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2416 00001110 09C9                    	or	ecx, ecx
  2417 00001112 75C0                    	jnz	short lff16m2_1
  2418 00001114 E9D6FAFFFF              	jmp	lff16m2_3
  2419                                  
  2420                                  lff16m2_7:
  2421                                  lff16s2_7:
  2422 00001119 E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2423                                  
  2424                                  load_16khz_stereo_16_bit:
  2425                                  	; 16/11/2023
  2426                                  	; 15/11/2023
  2427                                  	; 13/11/2023
  2428 0000111E F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2429                                  					; last of the file?
  2430 00001125 7402                    	jz	short lff16s2_0		; no
  2431 00001127 F9                      	stc
  2432 00001128 C3                      	retn
  2433                                  
  2434                                  lff16s2_0:
  2435                                  	; 01/12/2024
  2436                                  	; edi = audio buffer address
  2437 00001129 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2438                                          ;mov	edx, [loadsize]
  2439                                  
  2440                                  	; esi = buffer address
  2441                                  	;; edx = buffer size
  2442                                  
  2443                                  	; load file into memory
  2444                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000112E 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001134 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001136 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000113C B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001141 CD40                <1>  int 40h
  2445 00001143 72D4                    	jc	short lff16s2_7 ; error !
  2446                                  
  2447                                  	; 01/12/2024
  2448 00001145 A3[B07D0000]            	mov	[count], eax
  2449                                  	;;;
  2450                                  	; 07/12/2024
  2451                                  	;mov	edi, audio_buffer
  2452                                  	;;;
  2453 0000114A C1E802                  	shr	eax, 2
  2454 0000114D 7505                    	jnz	short lff16s2_8
  2455 0000114F E9B3FAFFFF              	jmp	lff16_eof
  2456                                  
  2457                                  lff16s2_8:
  2458 00001154 89C1                    	mov	ecx, eax  ; dword count
  2459                                  lff16s2_1:
  2460 00001156 66AD                    	lodsw
  2461 00001158 66AB                    	stosw		; original sample (L)
  2462 0000115A 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2463 0000115D 66A3[5C210000]          	mov	[previous_val_l], ax
  2464 00001163 66AD                    	lodsw
  2465 00001165 66AB                    	stosw		; original sample (R)
  2466 00001167 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2467 0000116A 66A3[5E210000]          	mov	[previous_val_r], ax
  2468 00001170 31D2                    	xor	edx, edx
  2469 00001172 31C0                    	xor	eax, eax
  2470                                  	; 16/11/2023
  2471 00001174 49                      	dec	ecx
  2472 00001175 7407                    	jz	short lff16s2_2
  2473 00001177 668B06                  	mov	ax, [esi]
  2474 0000117A 668B5602                	mov	dx, [esi+2]
  2475                                  lff16s2_2:
  2476 0000117E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2477                                  	;mov	[next_val_l], ax
  2478 00001181 89C5                    	mov	ebp, eax
  2479 00001183 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2480 00001186 668915[62210000]        	mov	[next_val_r], dx
  2481 0000118D 660305[5C210000]        	add	ax, [previous_val_l]
  2482 00001194 66D1D8                  	rcr	ax, 1
  2483 00001197 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2484 00001199 660305[5C210000]        	add	ax, [previous_val_l]
  2485 000011A0 66D1D8                  	rcr	ax, 1
  2486 000011A3 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2487 000011A6 66AB                    	stosw		; this is 1st interpolated sample (L)
  2488 000011A8 66A1[62210000]          	mov	ax, [next_val_r]
  2489 000011AE 660305[5E210000]        	add	ax, [previous_val_r]
  2490 000011B5 66D1D8                  	rcr	ax, 1
  2491 000011B8 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2492 000011BA 660305[5E210000]        	add	ax, [previous_val_r]
  2493 000011C1 66D1D8                  	rcr	ax, 1
  2494 000011C4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2495 000011C7 66AB                    	stosw		; this is 1st interpolated sample (R)
  2496                                  	;mov	ax, [next_val_l]
  2497 000011C9 89E8                    	mov	eax, ebp
  2498 000011CB 6601D0                  	add	ax, dx
  2499 000011CE 66D1D8                  	rcr	ax, 1
  2500 000011D1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2501 000011D4 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2502 000011D6 66A1[62210000]          	mov	ax, [next_val_r]
  2503 000011DC 6601D8                  	add	ax, bx
  2504 000011DF 66D1D8                  	rcr	ax, 1
  2505 000011E2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2506 000011E5 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2507                                  	
  2508                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2509 000011E7 09C9                    	or	ecx, ecx
  2510 000011E9 0F8567FFFFFF            	jnz	lff16s2_1
  2511 000011EF E9FBF9FFFF              	jmp	lff16s2_3
  2512                                  
  2513                                  ; .....................
  2514                                  
  2515                                  load_24khz_mono_8_bit:
  2516                                  	; 15/11/2023
  2517 000011F4 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2518                                  					; last of the file?
  2519 000011FB 7402                    	jz	short lff24m_0		; no
  2520 000011FD F9                      	stc
  2521 000011FE C3                      	retn
  2522                                  
  2523                                  lff24m_0:
  2524                                  	; 01/12/2024
  2525                                  	; edi = audio buffer address
  2526 000011FF BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2527                                          ;mov	edx, [loadsize]
  2528                                  
  2529                                  	; esi = buffer address
  2530                                  	;; edx = buffer size
  2531                                  
  2532                                  	; load file into memory
  2533                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001204 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000120A 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000120C 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001212 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001217 CD40                <1>  int 40h
  2534 00001219 723B                    	jc	short lff24m_7 ; error !
  2535                                  
  2536                                  	; 01/12/2024
  2537 0000121B A3[B07D0000]            	mov	[count], eax
  2538                                  	;;;
  2539                                  	; 07/12/2024
  2540                                  	;mov	edi, audio_buffer
  2541                                  	;;;
  2542 00001220 21C0                    	and	eax, eax
  2543 00001222 7505                    	jnz	short lff24m_8
  2544 00001224 E9DEF9FFFF              	jmp	lff24_eof
  2545                                  
  2546                                  lff24m_8:
  2547 00001229 89C1                    	mov	ecx, eax	; byte count
  2548                                  lff24m_1:
  2549 0000122B AC                      	lodsb
  2550                                  	;mov	[previous_val], al
  2551 0000122C 88C3                    	mov	bl, al
  2552 0000122E 2C80                    	sub	al, 80h
  2553 00001230 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2554 00001234 66AB                    	stosw		; original sample (left channel)
  2555 00001236 66AB                    	stosw		; original sample (right channel)
  2556                                  	;xor	eax, eax
  2557 00001238 B080                    	mov	al, 80h
  2558 0000123A 49                      	dec	ecx
  2559 0000123B 7402                    	jz	short lff24m_2
  2560 0000123D 8A06                    	mov	al, [esi]
  2561                                  lff24m_2:
  2562                                  	;;mov	[next_val], al
  2563                                  	;mov	bh, al
  2564                                  	;add	al, [previous_val]
  2565 0000123F 00D8                    	add	al, bl
  2566 00001241 D0D8                    	rcr	al, 1
  2567 00001243 2C80                    	sub	al, 80h
  2568 00001245 66C1E008                	shl	ax, 8
  2569 00001249 66AB                    	stosw		; this is interpolated sample (L)
  2570 0000124B 66AB                    	stosw		; this is interpolated sample (R)
  2571                                  	
  2572                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2573 0000124D 09C9                    	or	ecx, ecx
  2574 0000124F 75DA                    	jnz	short lff24m_1
  2575 00001251 E999F9FFFF              	jmp	lff24_3
  2576                                  
  2577                                  lff24m_7:
  2578                                  lff24s_7:
  2579 00001256 E9B5F9FFFF              	jmp	lff24_5  ; error
  2580                                  
  2581                                  load_24khz_stereo_8_bit:
  2582                                  	; 15/11/2023
  2583 0000125B F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2584                                  					; last of the file?
  2585 00001262 7402                    	jz	short lff24s_0		; no
  2586 00001264 F9                      	stc
  2587 00001265 C3                      	retn
  2588                                  
  2589                                  lff24s_0:
  2590                                  	; 01/12/2024
  2591                                  	; edi = audio buffer address
  2592 00001266 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2593                                          ;mov	edx, [loadsize]
  2594                                  
  2595                                  	; esi = buffer address
  2596                                  	;; edx = buffer size
  2597                                  
  2598                                  	; load file into memory
  2599                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000126B 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001271 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001273 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001279 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 0000127E CD40                <1>  int 40h
  2600 00001280 72D4                    	jc	short lff24s_7 ; error !
  2601                                  
  2602                                  	; 01/12/2024
  2603 00001282 A3[B07D0000]            	mov	[count], eax
  2604                                  	;;;
  2605                                  	; 07/12/2024
  2606                                  	;mov	edi, audio_buffer
  2607                                  	;;;
  2608 00001287 D1E8                    	shr	eax, 1
  2609 00001289 7505                    	jnz	short lff24s_8
  2610 0000128B E977F9FFFF              	jmp	lff24_eof
  2611                                  
  2612                                  lff24s_8:
  2613 00001290 89C1                    	mov	ecx, eax  ; word count
  2614                                  lff24s_1:
  2615 00001292 AC                      	lodsb
  2616 00001293 A2[5C210000]            	mov	[previous_val_l], al
  2617 00001298 2C80                    	sub	al, 80h
  2618 0000129A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2619 0000129E 66AB                    	stosw		; original sample (L)
  2620 000012A0 AC                      	lodsb
  2621 000012A1 A2[5E210000]            	mov	[previous_val_r], al
  2622 000012A6 2C80                    	sub	al, 80h
  2623 000012A8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2624 000012AC 66AB                    	stosw		; original sample (R)
  2625                                  
  2626                                  	;xor	eax, eax
  2627 000012AE 66B88080                	mov	ax, 8080h
  2628 000012B2 49                      	dec	ecx
  2629 000012B3 7403                    	jz	short lff24s_2
  2630                                  		; convert 8 bit sample to 16 bit sample
  2631 000012B5 668B06                  	mov	ax, [esi]
  2632                                  lff24s_2:
  2633                                  	;;mov	[next_val_l], al
  2634                                  	;;mov	[next_val_r], ah
  2635                                  	;mov	bx, ax
  2636 000012B8 88E7                    	mov	bh, ah
  2637 000012BA 0205[5C210000]          	add	al, [previous_val_l]
  2638 000012C0 D0D8                    	rcr	al, 1
  2639                                  	;mov	dl, al
  2640 000012C2 2C80                    	sub	al, 80h
  2641 000012C4 66C1E008                	shl	ax, 8
  2642 000012C8 66AB                    	stosw		; this is interpolated sample (L)
  2643 000012CA 88F8                    	mov	al, bh	; [next_val_r]
  2644 000012CC 0205[5E210000]          	add	al, [previous_val_r]
  2645 000012D2 D0D8                    	rcr	al, 1
  2646                                  	;mov	dh, al
  2647 000012D4 2C80                    	sub	al, 80h
  2648 000012D6 66C1E008                	shl	ax, 8
  2649 000012DA 66AB                    	stosw		; this is interpolated sample (R)
  2650                                  		
  2651                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2652 000012DC 09C9                    	or	ecx, ecx
  2653 000012DE 75B2                    	jnz	short lff24s_1
  2654 000012E0 E90AF9FFFF              	jmp	lff24_3
  2655                                  
  2656                                  load_24khz_mono_16_bit:
  2657                                  	; 15/11/2023
  2658 000012E5 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2659                                  					; last of the file?
  2660 000012EC 7402                    	jz	short lff24m2_0		; no
  2661 000012EE F9                      	stc
  2662 000012EF C3                      	retn
  2663                                  
  2664                                  lff24m2_0:
  2665                                  	; 01/12/2024
  2666                                  	; edi = audio buffer address
  2667 000012F0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2668                                          ;mov	edx, [loadsize]
  2669                                  
  2670                                  	; esi = buffer address
  2671                                  	;; edx = buffer size
  2672                                  
  2673                                  	; load file into memory
  2674                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000012F5 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000012FB 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000012FD 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001303 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001308 CD40                <1>  int 40h
  2675 0000130A 7237                    	jc	short lff24m2_7 ; error !
  2676                                  
  2677                                  	; 01/12/2024
  2678 0000130C A3[B07D0000]            	mov	[count], eax
  2679                                  	;;;
  2680                                  	; 07/12/2024
  2681                                  	;mov	edi, audio_buffer
  2682                                  	;;;
  2683 00001311 D1E8                    	shr	eax, 1
  2684 00001313 7505                    	jnz	short lff24m2_8
  2685 00001315 E9EDF8FFFF              	jmp	lff24_eof
  2686                                  
  2687                                  lff24m2_8:
  2688 0000131A 89C1                    	mov	ecx, eax  ; word count
  2689                                  lff24m2_1:
  2690 0000131C 66AD                    	lodsw
  2691 0000131E 66AB                    	stosw		; original sample (left channel)
  2692 00001320 66AB                    	stosw		; original sample (right channel)
  2693 00001322 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2694                                  	;mov	[previous_val], ax
  2695                                  	;mov	ebx, eax
  2696                                  	;xor	eax, eax
  2697 00001325 31DB                    	xor	ebx, ebx
  2698 00001327 49                      	dec	ecx
  2699 00001328 7403                    	jz	short lff24m2_2
  2700                                  	;mov	ax, [esi]
  2701 0000132A 668B1E                  	mov	bx, [esi]
  2702                                  lff24m2_2:
  2703                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2704                                  	;mov	ebp, eax	; [next_val]
  2705                                  	;add	ax, [previous_val]
  2706                                  	; ax = [previous_val]
  2707                                  	; bx = [next_val]
  2708 0000132D 6601D8                  	add	ax, bx
  2709 00001330 66D1D8                  	rcr	ax, 1
  2710 00001333 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2711 00001336 66AB                    	stosw		; this is interpolated sample (L)
  2712 00001338 66AB                    	stosw		; this is interpolated sample (R)
  2713                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2714 0000133A 09C9                    	or	ecx, ecx
  2715 0000133C 75DE                    	jnz	short lff24m2_1
  2716 0000133E E9ACF8FFFF              	jmp	lff24_3
  2717                                  
  2718                                  lff24m2_7:
  2719                                  lff24s2_7:
  2720 00001343 E9C8F8FFFF              	jmp	lff24_5  ; error
  2721                                  
  2722                                  load_24khz_stereo_16_bit:
  2723                                  	; 16/11/2023
  2724                                  	; 15/11/2023
  2725 00001348 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2726                                  					; last of the file?
  2727 0000134F 7402                    	jz	short lff24s2_0		; no
  2728 00001351 F9                      	stc
  2729 00001352 C3                      	retn
  2730                                  
  2731                                  lff24s2_0:
  2732                                  	; 01/12/2024
  2733                                  	; edi = audio buffer address
  2734 00001353 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2735                                          ;mov	edx, [loadsize]
  2736                                  
  2737                                  	; esi = buffer address
  2738                                  	;; edx = buffer size
  2739                                  
  2740                                  	; load file into memory
  2741                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001358 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000135E 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001360 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001366 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 0000136B CD40                <1>  int 40h
  2742 0000136D 72D4                    	jc	short lff24s2_7 ; error !
  2743                                  
  2744                                  	; 01/12/2024
  2745 0000136F A3[B07D0000]            	mov	[count], eax
  2746                                  	;;;
  2747                                  	; 07/12/2024
  2748                                  	;mov	edi, audio_buffer
  2749                                  	;;;
  2750 00001374 C1E802                  	shr	eax, 2
  2751 00001377 7505                    	jnz	short lff24s2_8
  2752 00001379 E989F8FFFF              	jmp	lff24_eof
  2753                                  
  2754                                  lff24s2_8:
  2755 0000137E 89C1                    	mov	ecx, eax  ; dword count
  2756                                  lff24s2_1:
  2757 00001380 66AD                    	lodsw
  2758 00001382 66AB                    	stosw		; original sample (L)
  2759 00001384 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2760 00001387 66A3[5C210000]          	mov	[previous_val_l], ax
  2761 0000138D 66AD                    	lodsw
  2762 0000138F 66AB                    	stosw		; original sample (R)
  2763 00001391 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2764                                  	;mov	[previous_val_r], ax
  2765 00001394 89C3                    	mov	ebx, eax
  2766 00001396 31D2                    	xor	edx, edx
  2767 00001398 31C0                    	xor	eax, eax
  2768                                  	; 16/11/2023
  2769 0000139A 49                      	dec	ecx
  2770 0000139B 7407                    	jz	short lff24s2_2
  2771 0000139D 668B06                  	mov	ax, [esi]
  2772 000013A0 668B5602                	mov	dx, [esi+2]
  2773                                  lff24s2_2:
  2774 000013A4 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2775                                  	;;mov	[next_val_l], ax
  2776                                  	;mov	ebp, eax
  2777 000013A7 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2778                                  	;mov	[next_val_r], dx
  2779 000013AA 660305[5C210000]        	add	ax, [previous_val_l]
  2780 000013B1 66D1D8                  	rcr	ax, 1
  2781 000013B4 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2782 000013B7 66AB                    	stosw		; this is interpolated sample (L)
  2783                                  	;mov	ax, [next_val_r]
  2784 000013B9 89D0                    	mov	eax, edx
  2785                                  	;add	ax, [previous_val_r]
  2786 000013BB 6601D8                  	add	ax, bx
  2787 000013BE 66D1D8                  	rcr	ax, 1
  2788 000013C1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2789 000013C4 66AB                    	stosw		; this is interpolated sample (R)
  2790                                  	
  2791                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2792 000013C6 09C9                    	or	ecx, ecx
  2793 000013C8 75B6                    	jnz	short lff24s2_1
  2794 000013CA E920F8FFFF              	jmp	lff24_3
  2795                                  
  2796                                  ; .....................
  2797                                  
  2798                                  load_32khz_mono_8_bit:
  2799                                  	; 15/11/2023
  2800 000013CF F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2801                                  					; last of the file?
  2802 000013D6 7402                    	jz	short lff32m_0		; no
  2803 000013D8 F9                      	stc
  2804 000013D9 C3                      	retn
  2805                                  
  2806                                  lff32m_0:
  2807                                  	; 01/12/2024
  2808                                  	; edi = audio buffer address
  2809 000013DA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2810                                          ;mov	edx, [loadsize]
  2811                                  
  2812                                  	; esi = buffer address
  2813                                  	;; edx = buffer size
  2814                                  
  2815                                  	; load file into memory
  2816                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000013DF 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000013E5 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000013E7 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000013ED B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000013F2 CD40                <1>  int 40h
  2817 000013F4 7247                    	jc	short lff32m_7 ; error !
  2818                                  
  2819                                  	; 01/12/2024
  2820 000013F6 A3[B07D0000]            	mov	[count], eax
  2821                                  	;;;
  2822                                  	; 07/12/2024
  2823                                  	;mov	edi, audio_buffer
  2824                                  	;;;
  2825 000013FB 21C0                    	and	eax, eax
  2826 000013FD 7505                    	jnz	short lff32m_8
  2827 000013FF E903F8FFFF              	jmp	lff32_eof
  2828                                  
  2829                                  lff32m_8:
  2830 00001404 89C1                    	mov	ecx, eax	; byte count
  2831                                  lff32m_1:
  2832 00001406 AC                      	lodsb
  2833                                  	;mov	[previous_val], al
  2834 00001407 88C3                    	mov	bl, al
  2835 00001409 2C80                    	sub	al, 80h
  2836 0000140B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2837 0000140F 66AB                    	stosw		; original sample (left channel)
  2838 00001411 66AB                    	stosw		; original sample (right channel)
  2839                                  	;xor	eax, eax
  2840 00001413 B080                    	mov	al, 80h
  2841 00001415 49                      	dec	ecx
  2842 00001416 7402                    	jz	short lff32m_2
  2843 00001418 8A06                    	mov	al, [esi]
  2844                                  lff32m_2:
  2845                                  	;;mov	[next_val], al
  2846                                  	;mov	bh, al
  2847                                  	;add	al, [previous_val]
  2848 0000141A 00D8                    	add	al, bl
  2849 0000141C D0D8                    	rcr	al, 1
  2850 0000141E 2C80                    	sub	al, 80h
  2851 00001420 66C1E008                	shl	ax, 8
  2852 00001424 66AB                    	stosw		; this is interpolated sample (L)
  2853 00001426 66AB                    	stosw		; this is interpolated sample (R)
  2854                                  	
  2855                                  	; different than 8-16-24 kHZ !
  2856                                  	; 'original-interpolated-original' trio samples
  2857 00001428 E30E                    	jecxz	lff32m_3
  2858                                  
  2859 0000142A AC                      	lodsb
  2860 0000142B 2C80                    	sub	al, 80h
  2861 0000142D 66C1E008                	shl	ax, 8
  2862 00001431 66AB                    	stosw		; original sample (left channel)
  2863 00001433 66AB                    	stosw		; original sample (right channel)
  2864                                  
  2865                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2866 00001435 49                      	dec	ecx
  2867 00001436 75CE                    	jnz	short lff32m_1
  2868                                  lff32m_3:
  2869 00001438 E9B2F7FFFF              	jmp	lff32_3
  2870                                  
  2871                                  lff32m_7:
  2872                                  lff32s_7:
  2873 0000143D E9CEF7FFFF              	jmp	lff32_5  ; error
  2874                                  
  2875                                  load_32khz_stereo_8_bit:
  2876                                  	; 15/11/2023
  2877 00001442 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2878                                  					; last of the file?
  2879 00001449 7402                    	jz	short lff32s_0		; no
  2880 0000144B F9                      	stc
  2881 0000144C C3                      	retn
  2882                                  
  2883                                  lff32s_0:
  2884                                  	; 01/12/2024
  2885                                  	; edi = audio buffer address
  2886 0000144D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2887                                          ;mov	edx, [loadsize]
  2888                                  
  2889                                  	; esi = buffer address
  2890                                  	;; edx = buffer size
  2891                                  
  2892                                  	; load file into memory
  2893                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001452 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001458 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000145A 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001460 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001465 CD40                <1>  int 40h
  2894 00001467 72D4                    	jc	short lff32s_7 ; error !
  2895                                  
  2896                                  	; 01/12/2024
  2897 00001469 A3[B07D0000]            	mov	[count], eax
  2898                                  	;;;
  2899                                  	; 07/12/2024
  2900                                  	;mov	edi, audio_buffer
  2901                                  	;;;
  2902 0000146E D1E8                    	shr	eax, 1
  2903 00001470 7505                    	jnz	short lff32s_8
  2904 00001472 E990F7FFFF              	jmp	lff32_eof
  2905                                  
  2906                                  lff32s_8:
  2907 00001477 89C1                    	mov	ecx, eax  ; word count
  2908                                  lff32s_1:
  2909 00001479 AC                      	lodsb
  2910 0000147A A2[5C210000]            	mov	[previous_val_l], al
  2911 0000147F 2C80                    	sub	al, 80h
  2912 00001481 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2913 00001485 66AB                    	stosw		; original sample (L)
  2914 00001487 AC                      	lodsb
  2915 00001488 A2[5E210000]            	mov	[previous_val_r], al
  2916 0000148D 2C80                    	sub	al, 80h
  2917 0000148F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2918 00001493 66AB                    	stosw		; original sample (R)
  2919                                  
  2920                                  	;xor	eax, eax
  2921 00001495 66B88080                	mov	ax, 8080h
  2922 00001499 49                      	dec	ecx
  2923 0000149A 7403                    	jz	short lff32s_2
  2924                                  		; convert 8 bit sample to 16 bit sample
  2925 0000149C 668B06                  	mov	ax, [esi]
  2926                                  lff32s_2:
  2927                                  	;;mov	[next_val_l], al
  2928                                  	;;mov	[next_val_r], ah
  2929                                  	;mov	bx, ax
  2930 0000149F 88E7                    	mov	bh, ah
  2931 000014A1 0205[5C210000]          	add	al, [previous_val_l]
  2932 000014A7 D0D8                    	rcr	al, 1
  2933                                  	;mov	dl, al
  2934 000014A9 2C80                    	sub	al, 80h
  2935 000014AB 66C1E008                	shl	ax, 8
  2936 000014AF 66AB                    	stosw		; this is interpolated sample (L)
  2937 000014B1 88F8                    	mov	al, bh	; [next_val_r]
  2938 000014B3 0205[5E210000]          	add	al, [previous_val_r]
  2939 000014B9 D0D8                    	rcr	al, 1
  2940                                  	;mov	dh, al
  2941 000014BB 2C80                    	sub	al, 80h
  2942 000014BD 66C1E008                	shl	ax, 8
  2943 000014C1 66AB                    	stosw		; this is interpolated sample (R)
  2944                                  
  2945                                  	; different than 8-16-24 kHZ !
  2946                                  	; 'original-interpolated-original' trio samples
  2947 000014C3 E315                    	jecxz	lff32s_3
  2948                                  
  2949 000014C5 AC                      	lodsb
  2950 000014C6 2C80                    	sub	al, 80h
  2951 000014C8 66C1E008                	shl	ax, 8
  2952 000014CC 66AB                    	stosw		; original sample (left channel)
  2953                                  
  2954 000014CE AC                      	lodsb
  2955 000014CF 2C80                    	sub	al, 80h
  2956 000014D1 66C1E008                	shl	ax, 8
  2957 000014D5 66AB                    	stosw		; original sample (right channel)
  2958                                  		
  2959                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2960 000014D7 49                      	dec	ecx
  2961 000014D8 759F                    	jnz	short lff32s_1
  2962                                  lff32s_3:
  2963 000014DA E910F7FFFF              	jmp	lff32_3
  2964                                  
  2965                                  load_32khz_mono_16_bit:
  2966                                  	; 15/11/2023
  2967 000014DF F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2968                                  					; last of the file?
  2969 000014E6 7402                    	jz	short lff32m2_0		; no
  2970 000014E8 F9                      	stc
  2971 000014E9 C3                      	retn
  2972                                  
  2973                                  lff32m2_0:
  2974                                  	; 01/12/2024
  2975                                  	; edi = audio buffer address
  2976 000014EA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2977                                          ;mov	edx, [loadsize]
  2978                                  
  2979                                  	; esi = buffer address
  2980                                  	;; edx = buffer size
  2981                                  
  2982                                  	; load file into memory
  2983                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000014EF 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000014F5 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000014F7 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000014FD B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001502 CD40                <1>  int 40h
  2984 00001504 723E                    	jc	short lff32m2_7 ; error !
  2985                                  
  2986                                  	; 01/12/2024
  2987 00001506 A3[B07D0000]            	mov	[count], eax
  2988                                  	;;;
  2989                                  	; 07/12/2024
  2990                                  	;mov	edi, audio_buffer
  2991                                  	;;;
  2992 0000150B D1E8                    	shr	eax, 1
  2993 0000150D 7505                    	jnz	short lff32m2_8
  2994 0000150F E9F3F6FFFF              	jmp	lff32_eof
  2995                                  
  2996                                  lff32m2_8:
  2997 00001514 89C1                    	mov	ecx, eax  ; word count
  2998                                  lff32m2_1:
  2999 00001516 66AD                    	lodsw
  3000 00001518 66AB                    	stosw		; original sample (left channel)
  3001 0000151A 66AB                    	stosw		; original sample (right channel)
  3002 0000151C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3003                                  	;mov	[previous_val], ax
  3004                                  	;mov	ebx, eax
  3005                                  	;xor	eax, eax
  3006 0000151F 31DB                    	xor	ebx, ebx
  3007 00001521 49                      	dec	ecx
  3008 00001522 7403                    	jz	short lff32m2_2
  3009                                  	;mov	ax, [esi]
  3010 00001524 668B1E                  	mov	bx, [esi]
  3011                                  lff32m2_2:
  3012                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  3013                                  	;mov	ebp, eax ; [next_val]
  3014                                  	;add	ax, [previous_val]
  3015                                  	; ax = [previous_val]
  3016                                  	; bx = [next_val]
  3017 00001527 6601D8                  	add	ax, bx
  3018 0000152A 66D1D8                  	rcr	ax, 1
  3019 0000152D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3020 00001530 66AB                    	stosw		; this is interpolated sample (L)
  3021 00001532 66AB                    	stosw		; this is interpolated sample (R)
  3022                                  
  3023                                  	; different than 8-16-24 kHZ !
  3024                                  	; 'original-interpolated-original' trio samples 
  3025 00001534 E309                    	jecxz	lff32m2_3
  3026                                  
  3027 00001536 66AD                    	lodsw
  3028 00001538 66AB                    	stosw		; original sample (left channel)
  3029 0000153A 66AB                    	stosw		; original sample (right channel)
  3030                                  
  3031                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3032 0000153C 49                      	dec	ecx
  3033 0000153D 75D7                    	jnz	short lff32m2_1
  3034                                  lff32m2_3:
  3035 0000153F E9ABF6FFFF              	jmp	lff32_3
  3036                                  
  3037                                  lff32m2_7:
  3038                                  lff32s2_7:
  3039 00001544 E9C7F6FFFF              	jmp	lff32_5  ; error
  3040                                  
  3041                                  load_32khz_stereo_16_bit:
  3042                                  	; 16/11/2023
  3043                                  	; 15/11/2023
  3044 00001549 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3045                                  					; last of the file?
  3046 00001550 7402                    	jz	short lff32s2_0		; no
  3047 00001552 F9                      	stc
  3048 00001553 C3                      	retn
  3049                                  
  3050                                  lff32s2_0:
  3051                                  	; 01/12/2024
  3052                                  	; edi = audio buffer address
  3053 00001554 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3054                                          ;mov	edx, [loadsize]
  3055                                  
  3056                                  	; esi = buffer address
  3057                                  	;; edx = buffer size
  3058                                  
  3059                                  	; load file into memory
  3060                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001559 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000155F 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001561 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001567 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 0000156C CD40                <1>  int 40h
  3061 0000156E 72D4                    	jc	short lff32s2_7 ; error !
  3062                                  
  3063                                  	; 01/12/2024
  3064 00001570 A3[B07D0000]            	mov	[count], eax
  3065                                  	;;;
  3066                                  	; 07/12/2024
  3067                                  	;mov	edi, audio_buffer
  3068                                  	;;;
  3069 00001575 C1E802                  	shr	eax, 2
  3070 00001578 7505                    	jnz	short lff32s2_8
  3071 0000157A E988F6FFFF              	jmp	lff32_eof
  3072                                  
  3073                                  lff32s2_8:
  3074 0000157F 89C1                    	mov	ecx, eax ; dword count
  3075                                  lff32s2_1:
  3076 00001581 66AD                    	lodsw
  3077 00001583 66AB                    	stosw		; original sample (L)
  3078 00001585 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3079 00001588 66A3[5C210000]          	mov	[previous_val_l], ax
  3080 0000158E 66AD                    	lodsw
  3081 00001590 66AB                    	stosw		; original sample (R)
  3082 00001592 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3083                                  	;mov	[previous_val_r], ax
  3084 00001595 89C3                    	mov	ebx, eax
  3085 00001597 31D2                    	xor	edx, edx
  3086 00001599 31C0                    	xor	eax, eax
  3087                                  	; 16/11/2023
  3088 0000159B 49                      	dec	ecx
  3089 0000159C 7407                    	jz	short lff32s2_2
  3090 0000159E 668B06                  	mov	ax, [esi]
  3091 000015A1 668B5602                	mov	dx, [esi+2]
  3092                                  lff32s2_2:
  3093 000015A5 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3094                                  	;;mov	[next_val_l], ax
  3095                                  	;mov	ebp, eax
  3096 000015A8 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3097                                  	;mov	[next_val_r], dx
  3098 000015AB 660305[5C210000]        	add	ax, [previous_val_l]
  3099 000015B2 66D1D8                  	rcr	ax, 1
  3100 000015B5 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3101 000015B8 66AB                    	stosw		; this is interpolated sample (L)
  3102                                  	;mov	ax, [next_val_r]
  3103 000015BA 89D0                    	mov	eax, edx
  3104                                  	;add	ax, [previous_val_r]
  3105 000015BC 6601D8                  	add	ax, bx
  3106 000015BF 66D1D8                  	rcr	ax, 1
  3107 000015C2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3108 000015C5 66AB                    	stosw		; this is interpolated sample (R)
  3109                                  
  3110                                  	; different than 8-16-24 kHZ !
  3111                                  	; 'original-interpolated-original' trio samples
  3112 000015C7 E30B                    	jecxz	lff32s2_3
  3113                                  
  3114 000015C9 66AD                    	lodsw
  3115 000015CB 66AB                    	stosw	; original sample (L)
  3116 000015CD 66AD                    	lodsw
  3117 000015CF 66AB                    	stosw	; original sample (R)
  3118                                  	
  3119                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3120 000015D1 49                      	dec	ecx
  3121 000015D2 75AD                    	jnz	short lff32s2_1
  3122                                  lff32s2_3:
  3123 000015D4 E916F6FFFF              	jmp	lff32_3
  3124                                  
  3125                                  ; .....................
  3126                                  
  3127                                  load_22khz_mono_8_bit:
  3128                                  	; 16/11/2023
  3129 000015D9 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3130                                  					; last of the file?
  3131 000015E0 7402                    	jz	short lff22m_0		; no
  3132 000015E2 F9                      	stc
  3133 000015E3 C3                      	retn
  3134                                  
  3135                                  lff22m_0:
  3136                                  	; 01/12/2024
  3137                                  	; edi = audio buffer address
  3138 000015E4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3139                                          ;mov	edx, [loadsize]
  3140                                  
  3141                                  	; esi = buffer address
  3142                                  	;; edx = buffer size
  3143                                  
  3144                                  	; load file into memory
  3145                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000015E9 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000015EF 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000015F1 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000015F7 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000015FC CD40                <1>  int 40h
  3146 000015FE 725D                    	jc	short lff22m_7 ; error !
  3147                                  
  3148                                  	; 01/12/2024
  3149 00001600 A3[B07D0000]            	mov	[count], eax
  3150                                  	;;;
  3151                                  	; 07/12/2024
  3152                                  	;mov	edi, audio_buffer
  3153                                  	;;;
  3154 00001605 21C0                    	and	eax, eax
  3155 00001607 7505                    	jnz	short lff22m_8
  3156 00001609 E9F9F5FFFF              	jmp	lff22_eof
  3157                                  
  3158                                  lff22m_8:
  3159 0000160E 89C1                    	mov	ecx, eax	; byte count
  3160                                  lff22m_9:
  3161 00001610 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3162 00001615 C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3163                                  lff22m_1:
  3164                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3165 0000161C AC                      	lodsb
  3166 0000161D B280                    	mov	dl, 80h
  3167 0000161F 49                      	dec	ecx
  3168 00001620 7402                    	jz	short lff22m_2_1
  3169 00001622 8A16                    	mov	dl, [esi]
  3170                                  lff22m_2_1:	
  3171                                  	; al = [previous_val]
  3172                                  	; dl = [next_val]
  3173 00001624 E8EF050000              	call	interpolating_3_8bit_mono ; 1 of 17
  3174 00001629 E32D                    	jecxz	lff22m_3
  3175                                  lff22m_2_2:
  3176 0000162B AC                      	lodsb
  3177 0000162C B280                    	mov	dl, 80h
  3178 0000162E 49                      	dec	ecx
  3179 0000162F 7402                    	jz	short lff22m_2_3
  3180 00001631 8A16                    	mov	dl, [esi]
  3181                                  lff22m_2_3:
  3182 00001633 E864060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3183 00001638 E31E                    	jecxz	lff22m_3
  3184 0000163A 4D                      	dec	ebp
  3185 0000163B 75EE                    	jnz	short lff22m_2_2
  3186                                  
  3187 0000163D A0[64210000]            	mov	al, [faz]
  3188 00001642 FEC8                    	dec	al
  3189 00001644 74CA                    	jz	short lff22m_9
  3190 00001646 FE0D[64210000]          	dec	byte [faz]
  3191 0000164C BD04000000              	mov	ebp, 4
  3192 00001651 FEC8                    	dec	al
  3193 00001653 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3194 00001655 45                      	inc	ebp ; 5
  3195 00001656 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3196                                  
  3197                                  lff22m_3:
  3198                                  lff22s_3:
  3199 00001658 E992F5FFFF              	jmp	lff22_3	; padfill
  3200                                  		; (put zeros in the remain words of the buffer)
  3201                                  lff22m_7:
  3202                                  lff22s_7:
  3203 0000165D E9AEF5FFFF              	jmp	lff22_5  ; error
  3204                                  
  3205                                  load_22khz_stereo_8_bit:
  3206                                  	; 16/11/2023
  3207 00001662 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3208                                  					; last of the file?
  3209 00001669 7402                    	jz	short lff22s_0		; no
  3210 0000166B F9                      	stc
  3211 0000166C C3                      	retn
  3212                                  
  3213                                  lff22s_0:
  3214                                  	; 01/12/2024
  3215                                  	; edi = audio buffer address
  3216 0000166D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3217                                          ;mov	edx, [loadsize]
  3218                                  
  3219                                  	; esi = buffer address
  3220                                  	;; edx = buffer size
  3221                                  
  3222                                  	; load file into memory
  3223                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001672 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001678 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000167A 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001680 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001685 CD40                <1>  int 40h
  3224 00001687 72D4                    	jc	short lff22s_7 ; error !
  3225                                  
  3226                                  	; 01/12/2024
  3227 00001689 A3[B07D0000]            	mov	[count], eax
  3228                                  	;;;
  3229                                  	; 07/12/2024
  3230                                  	;mov	edi, audio_buffer
  3231                                  	;;;
  3232 0000168E D1E8                    	shr	eax, 1
  3233 00001690 7505                    	jnz	short lff22s_8
  3234 00001692 E970F5FFFF              	jmp	lff22_eof
  3235                                  
  3236                                  lff22s_8:
  3237 00001697 89C1                    	mov	ecx, eax	; word count
  3238                                  lff22s_9:
  3239 00001699 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3240 0000169E C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3241                                  lff22s_1:
  3242                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3243 000016A5 66AD                    	lodsw
  3244 000016A7 66BA8080                	mov	dx, 8080h
  3245 000016AB 49                      	dec	ecx
  3246 000016AC 7403                    	jz	short lff22s_2_1
  3247 000016AE 668B16                  	mov	dx, [esi]
  3248                                  lff22s_2_1:	
  3249                                  	; al = [previous_val_l]
  3250                                  	; ah = [previous_val_r]
  3251                                  	; dl = [next_val_l]
  3252                                  	; dh = [next_val_r]
  3253 000016B1 E893050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3254 000016B6 E3A0                    	jecxz	lff22s_3
  3255                                  lff22s_2_2:
  3256 000016B8 66AD                    	lodsw
  3257 000016BA 66BA8080                	mov	dx, 8080h
  3258 000016BE 49                      	dec	ecx
  3259 000016BF 7403                    	jz	short lff22s_2_3
  3260 000016C1 668B16                  	mov	dx, [esi]
  3261                                  lff22s_2_3:
  3262 000016C4 E8F0050000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3263 000016C9 E38D                    	jecxz	lff22s_3
  3264 000016CB 4D                      	dec	ebp
  3265 000016CC 75EA                    	jnz	short lff22s_2_2
  3266                                  
  3267 000016CE A0[64210000]            	mov	al, [faz]
  3268 000016D3 FEC8                    	dec	al
  3269 000016D5 74C2                    	jz	short lff22s_9
  3270 000016D7 FE0D[64210000]          	dec	byte [faz]
  3271 000016DD BD04000000              	mov	ebp, 4
  3272 000016E2 FEC8                    	dec	al
  3273 000016E4 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3274 000016E6 45                      	inc	ebp ; 5
  3275 000016E7 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3276                                  
  3277                                  load_22khz_mono_16_bit:
  3278                                  	; 16/11/2023
  3279 000016E9 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3280                                  					; last of the file?
  3281 000016F0 7402                    	jz	short lff22m2_0		; no
  3282 000016F2 F9                      	stc
  3283 000016F3 C3                      	retn
  3284                                  
  3285                                  lff22m2_0:
  3286                                  	; 01/12/2024
  3287                                  	; edi = audio buffer address
  3288 000016F4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3289                                          ;mov	edx, [loadsize]
  3290                                  
  3291                                  	; esi = buffer address
  3292                                  	;; edx = buffer size
  3293                                  
  3294                                  	; load file into memory
  3295                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000016F9 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000016FF 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001701 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001707 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 0000170C CD40                <1>  int 40h
  3296 0000170E 7261                    	jc	short lff22m2_7 ; error !
  3297                                  
  3298                                  	; 01/12/2024
  3299 00001710 A3[B07D0000]            	mov	[count], eax
  3300                                  	;;;
  3301                                  	; 07/12/2024
  3302                                  	;mov	edi, audio_buffer
  3303                                  	;;;
  3304 00001715 D1E8                    	shr	eax, 1
  3305 00001717 7505                    	jnz	short lff22m2_8
  3306 00001719 E9E9F4FFFF              	jmp	lff22_eof
  3307                                  
  3308                                  lff22m2_8:
  3309 0000171E 89C1                    	mov	ecx, eax	; word count
  3310                                  lff22m2_9:
  3311 00001720 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3312 00001725 C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3313                                  lff22m2_1:
  3314                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3315 0000172C 66AD                    	lodsw
  3316 0000172E 31D2                    	xor	edx, edx
  3317 00001730 49                      	dec	ecx
  3318 00001731 7403                    	jz	short lff22m2_2_1
  3319 00001733 668B16                  	mov	dx, [esi]
  3320                                  lff22m2_2_1:	
  3321                                  	; ax = [previous_val]
  3322                                  	; dx = [next_val]
  3323 00001736 E8AF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3324 0000173B E32F                    	jecxz	lff22m2_3
  3325                                  lff22m2_2_2:
  3326 0000173D 66AD                    	lodsw
  3327 0000173F 31D2                    	xor	edx, edx
  3328 00001741 49                      	dec	ecx
  3329 00001742 7403                    	jz	short lff22m2_2_3
  3330 00001744 668B16                  	mov	dx, [esi]
  3331                                  lff22m2_2_3:
  3332 00001747 E831060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3333 0000174C E31E                    	jecxz	lff22m2_3
  3334 0000174E 4D                      	dec	ebp
  3335 0000174F 75EC                    	jnz	short lff22m2_2_2
  3336                                  
  3337 00001751 A0[64210000]            	mov	al, [faz]
  3338 00001756 FEC8                    	dec	al
  3339 00001758 74C6                    	jz	short lff22m2_9
  3340 0000175A FE0D[64210000]          	dec	byte [faz]
  3341 00001760 BD04000000              	mov	ebp, 4
  3342 00001765 FEC8                    	dec	al
  3343 00001767 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3344 00001769 45                      	inc	ebp ; 5
  3345 0000176A EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3346                                  
  3347                                  lff22m2_3:
  3348                                  lff22s2_3:
  3349 0000176C E97EF4FFFF              	jmp	lff22_3	; padfill
  3350                                  		; (put zeros in the remain words of the buffer)
  3351                                  lff22m2_7:
  3352                                  lff22s2_7:
  3353 00001771 E99AF4FFFF              	jmp	lff22_5  ; error
  3354                                  
  3355                                  load_22khz_stereo_16_bit:
  3356                                  	; 16/11/2023
  3357 00001776 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3358                                  					; last of the file?
  3359 0000177D 7402                    	jz	short lff22s2_0		; no
  3360 0000177F F9                      	stc
  3361 00001780 C3                      	retn
  3362                                  
  3363                                  lff22s2_0:
  3364                                  	; 01/12/2024
  3365                                  	; edi = audio buffer address
  3366 00001781 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3367                                          ;mov	edx, [loadsize]
  3368                                  
  3369                                  	; esi = buffer address
  3370                                  	;; edx = buffer size
  3371                                  
  3372                                  	; load file into memory
  3373                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001786 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000178C 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000178E 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001794 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001799 CD40                <1>  int 40h
  3374 0000179B 72D4                    	jc	short lff22s2_7 ; error !
  3375                                  
  3376                                  	; 01/12/2024
  3377 0000179D A3[B07D0000]            	mov	[count], eax
  3378                                  	;;;
  3379                                  	; 07/12/2024
  3380                                  	;mov	edi, audio_buffer
  3381                                  	;;;
  3382 000017A2 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3383 000017A5 7505                    	jnz	short lff22s2_8
  3384 000017A7 E95BF4FFFF              	jmp	lff22_eof
  3385                                  
  3386                                  lff22s2_8:
  3387 000017AC 89C1                    	mov	ecx, eax	; dword count
  3388                                  lff22s2_9:
  3389 000017AE BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3390 000017B3 C605[64210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3391                                  lff22s2_1:
  3392                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3393 000017BA 66AD                    	lodsw
  3394 000017BC 89C3                    	mov	ebx, eax
  3395 000017BE 66AD                    	lodsw
  3396 000017C0 8B16                    	mov	edx, [esi]
  3397 000017C2 668915[60210000]        	mov	[next_val_l], dx
  3398                                  	; 26/11/2023
  3399 000017C9 C1EA10                  	shr	edx, 16
  3400 000017CC 49                      	dec	ecx
  3401 000017CD 7509                    	jnz	short lff22s2_2_1
  3402 000017CF 31D2                    	xor	edx, edx ; 0
  3403 000017D1 668915[60210000]        	mov	[next_val_l], dx
  3404                                  lff22s2_2_1:
  3405                                  	; bx = [previous_val_l]
  3406                                  	; ax = [previous_val_r]
  3407                                  	; [next_val_l]
  3408                                  	; dx = [next_val_r]
  3409 000017D8 E83D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3410 000017DD E38D                    	jecxz	lff22s2_3
  3411                                  lff22s2_2_2:
  3412 000017DF 66AD                    	lodsw
  3413 000017E1 89C3                    	mov	ebx, eax
  3414 000017E3 66AD                    	lodsw
  3415 000017E5 8B16                    	mov	edx, [esi]
  3416 000017E7 668915[60210000]        	mov	[next_val_l], dx
  3417                                  	; 26/11/2023
  3418 000017EE C1EA10                  	shr	edx, 16
  3419 000017F1 49                      	dec	ecx
  3420 000017F2 7509                    	jnz	short lff22s2_2_3
  3421 000017F4 31D2                    	xor	edx, edx ; 0
  3422 000017F6 668915[60210000]        	mov	[next_val_l], dx
  3423                                  lff22s2_2_3:
  3424 000017FD E893050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3425 00001802 E31E                    	jecxz	lff22s2_2_4
  3426                                  
  3427 00001804 4D                      	dec	ebp
  3428 00001805 75D8                    	jnz	short lff22s2_2_2
  3429                                  
  3430 00001807 A0[64210000]            	mov	al, [faz]
  3431 0000180C FEC8                    	dec	al
  3432 0000180E 749E                    	jz	short lff22s2_9
  3433 00001810 FE0D[64210000]          	dec	byte [faz]
  3434 00001816 BD04000000              	mov	ebp, 4
  3435 0000181B FEC8                    	dec	al
  3436 0000181D 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3437 0000181F 45                      	inc	ebp ; 5
  3438 00001820 EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3439                                  
  3440                                  lff22s2_2_4:
  3441                                  	; 26/11/2023
  3442 00001822 E9C8F3FFFF              	jmp	lff22_3	; padfill
  3443                                  
  3444                                  ; .....................
  3445                                  
  3446                                  load_11khz_mono_8_bit:
  3447                                  	; 18/11/2023
  3448 00001827 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3449                                  					; last of the file?
  3450 0000182E 7402                    	jz	short lff11m_0		; no
  3451 00001830 F9                      	stc
  3452 00001831 C3                      	retn
  3453                                  
  3454                                  lff11m_0:
  3455                                  	; 01/12/2024
  3456                                  	; edi = audio buffer address
  3457 00001832 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3458                                          ;mov	edx, [loadsize]
  3459                                  
  3460                                  	; esi = buffer address
  3461                                  	;; edx = buffer size
  3462                                  
  3463                                  	; load file into memory
  3464                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001837 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000183D 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 0000183F 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001845 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 0000184A CD40                <1>  int 40h
  3465 0000184C 7247                    	jc	short lff11m_7 ; error !
  3466                                  
  3467                                  	; 01/12/2024
  3468 0000184E A3[B07D0000]            	mov	[count], eax
  3469                                  	;;;
  3470                                  	; 07/12/2024
  3471                                  	;mov	edi, audio_buffer
  3472                                  	;;;
  3473 00001853 21C0                    	and	eax, eax
  3474 00001855 7505                    	jnz	short lff11m_8
  3475 00001857 E9ABF3FFFF              	jmp	lff11_eof
  3476                                  
  3477                                  lff11m_8:
  3478 0000185C 89C1                    	mov	ecx, eax		; byte count
  3479                                  lff11m_9:
  3480 0000185E BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3481                                  lff11m_1:
  3482                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3483 00001863 AC                      	lodsb
  3484 00001864 B280                    	mov	dl, 80h
  3485 00001866 49                      	dec	ecx
  3486 00001867 7402                    	jz	short lff11m_2_1
  3487 00001869 8A16                    	mov	dl, [esi]
  3488                                  lff11m_2_1:	
  3489                                  	; al = [previous_val]
  3490                                  	; dl = [next_val]
  3491 0000186B E854050000              	call	interpolating_5_8bit_mono
  3492 00001870 E328                    	jecxz	lff11m_3
  3493                                  lff11m_2_2:
  3494 00001872 AC                      	lodsb
  3495 00001873 B280                    	mov	dl, 80h
  3496 00001875 49                      	dec	ecx
  3497 00001876 7402                    	jz	short lff11m_2_3
  3498 00001878 8A16                    	mov	dl, [esi]
  3499                                  lff11m_2_3:
  3500 0000187A E851060000               	call	interpolating_4_8bit_mono
  3501 0000187F E319                    	jecxz	lff11m_3
  3502                                  
  3503 00001881 4D                      	dec	ebp
  3504 00001882 74DA                    	jz	short lff11m_9
  3505                                  
  3506 00001884 AC                      	lodsb
  3507 00001885 B280                    	mov	dl, 80h
  3508 00001887 49                      	dec	ecx
  3509 00001888 7402                    	jz	short lff11m_2_4
  3510 0000188A 8A16                    	mov	dl, [esi]
  3511                                  lff11m_2_4:
  3512 0000188C E83F060000              	call	interpolating_4_8bit_mono
  3513 00001891 E307                    	jecxz	lff11m_3
  3514 00001893 EBCE                    	jmp	short lff11m_1
  3515                                  
  3516                                  lff11m_7:
  3517                                  lff11s_7:
  3518 00001895 E976F3FFFF              	jmp	lff11_5  ; error
  3519                                  
  3520                                  lff11m_3:
  3521                                  lff11s_3:
  3522 0000189A E950F3FFFF              	jmp	lff11_3	; padfill
  3523                                  		; (put zeros in the remain words of the buffer)
  3524                                  
  3525                                  load_11khz_stereo_8_bit:
  3526                                  	; 18/11/2023
  3527 0000189F F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3528                                  					; last of the file?
  3529 000018A6 7402                    	jz	short lff11s_0		; no
  3530 000018A8 F9                      	stc
  3531 000018A9 C3                      	retn
  3532                                  
  3533                                  lff11s_0:
  3534                                  	; 01/12/2024
  3535                                  	; edi = audio buffer address
  3536 000018AA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3537                                          ;mov	edx, [loadsize]
  3538                                  
  3539                                  	; esi = buffer address
  3540                                  	;; edx = buffer size
  3541                                  
  3542                                  	; load file into memory
  3543                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000018AF 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000018B5 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000018B7 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000018BD B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000018C2 CD40                <1>  int 40h
  3544 000018C4 72CF                    	jc	short lff11s_7 ; error !
  3545                                  
  3546                                  	; 01/12/2024
  3547 000018C6 A3[B07D0000]            	mov	[count], eax
  3548                                  	;;;
  3549                                  	; 07/12/2024
  3550                                  	;mov	edi, audio_buffer
  3551                                  	;;;
  3552 000018CB D1E8                    	shr	eax, 1
  3553 000018CD 7505                    	jnz	short lff11s_8
  3554 000018CF E933F3FFFF              	jmp	lff11_eof
  3555                                  
  3556                                  lff11s_8:
  3557 000018D4 89C1                    	mov	ecx, eax	; word count
  3558                                  lff11s_9:
  3559 000018D6 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3560                                  lff11s_1:
  3561                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3562 000018DB 66AD                    	lodsw
  3563 000018DD 66BA8080                	mov	dx, 8080h
  3564 000018E1 49                      	dec	ecx
  3565 000018E2 7403                    	jz	short lff11s_2_1
  3566 000018E4 668B16                  	mov	dx, [esi]
  3567                                  lff11s_2_1:	
  3568                                  	; al = [previous_val_l]
  3569                                  	; ah = [previous_val_r]
  3570                                  	; dl = [next_val_l]
  3571                                  	; dh = [next_val_r]
  3572 000018E7 E837050000              	call	interpolating_5_8bit_stereo
  3573 000018EC E3AC                    	jecxz	lff11s_3
  3574                                  lff11s_2_2:
  3575 000018EE 66AD                    	lodsw
  3576 000018F0 66BA8080                	mov	dx, 8080h
  3577 000018F4 49                      	dec	ecx
  3578 000018F5 7403                    	jz	short lff11s_2_3
  3579 000018F7 668B16                  	mov	dx, [esi]
  3580                                  lff11s_2_3:
  3581 000018FA E810060000               	call	interpolating_4_8bit_stereo
  3582 000018FF E399                    	jecxz	lff11s_3
  3583                                  	
  3584 00001901 4D                      	dec	ebp
  3585 00001902 74D2                    	jz	short lff11s_9
  3586                                  
  3587 00001904 66AD                    	lodsw
  3588 00001906 66BA8080                	mov	dx, 8080h
  3589 0000190A 49                      	dec	ecx
  3590 0000190B 7403                    	jz	short lff11s_2_4
  3591 0000190D 668B16                  	mov	dx, [esi]
  3592                                  lff11s_2_4:
  3593 00001910 E8FA050000              	call	interpolating_4_8bit_stereo
  3594 00001915 E383                    	jecxz	lff11s_3
  3595 00001917 EBC2                    	jmp	short lff11s_1
  3596                                  
  3597                                  load_11khz_mono_16_bit:
  3598                                  	; 18/11/2023
  3599 00001919 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3600                                  					; last of the file?
  3601 00001920 7402                    	jz	short lff11m2_0		; no
  3602 00001922 F9                      	stc
  3603 00001923 C3                      	retn
  3604                                  
  3605                                  lff11m2_0:
  3606                                  	; 01/12/2024
  3607                                  	; edi = audio buffer address
  3608 00001924 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3609                                          ;mov	edx, [loadsize]
  3610                                  
  3611                                  	; esi = buffer address
  3612                                  	;; edx = buffer size
  3613                                  
  3614                                  	; load file into memory
  3615                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001929 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000192F 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001931 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001937 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 0000193C CD40                <1>  int 40h
  3616 0000193E 724D                    	jc	short lff11m2_7 ; error !
  3617                                  
  3618                                  	; 01/12/2024
  3619 00001940 A3[B07D0000]            	mov	[count], eax
  3620                                  	;;;
  3621                                  	; 07/12/2024
  3622                                  	;mov	edi, audio_buffer
  3623                                  	;;;
  3624 00001945 D1E8                    	shr	eax, 1
  3625 00001947 7505                    	jnz	short lff11m2_8
  3626 00001949 E9B9F2FFFF              	jmp	lff11_eof
  3627                                  
  3628                                  lff11m2_8:
  3629 0000194E 89C1                    	mov	ecx, eax	; word count
  3630                                  lff11m2_9:
  3631 00001950 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3632                                  lff11m2_1:
  3633                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3634 00001955 66AD                    	lodsw
  3635 00001957 31D2                    	xor	edx, edx
  3636 00001959 49                      	dec	ecx
  3637 0000195A 7403                    	jz	short lff11m2_2_1
  3638 0000195C 668B16                  	mov	dx, [esi]
  3639                                  lff11m2_2_1:	
  3640                                  	; ax = [previous_val]
  3641                                  	; dx = [next_val]
  3642 0000195F E818060000              	call	interpolating_5_16bit_mono
  3643 00001964 E362                    	jecxz	lff11m2_3
  3644                                  lff11m2_2_2:
  3645 00001966 66AD                    	lodsw
  3646 00001968 31D2                    	xor	edx, edx
  3647 0000196A 49                      	dec	ecx
  3648 0000196B 7403                    	jz	short lff11m2_2_3
  3649 0000196D 668B16                  	mov	dx, [esi]
  3650                                  lff11m2_2_3:
  3651 00001970 E831070000               	call	interpolating_4_16bit_mono
  3652 00001975 E351                    	jecxz	lff11m2_3
  3653                                  
  3654 00001977 4D                      	dec	ebp
  3655 00001978 74D6                    	jz	short lff11m2_9
  3656                                  
  3657 0000197A 66AD                    	lodsw
  3658 0000197C 31D2                    	xor	edx, edx
  3659 0000197E 49                      	dec	ecx
  3660 0000197F 7403                    	jz	short lff11m2_2_4
  3661 00001981 668B16                  	mov	dx, [esi]
  3662                                  lff11m2_2_4:
  3663 00001984 E81D070000               	call	interpolating_4_16bit_mono
  3664 00001989 E33D                    	jecxz	lff11m2_3
  3665 0000198B EBC8                    	jmp	short lff11m2_1
  3666                                  
  3667                                  lff11m2_7:
  3668                                  lff11s2_7:
  3669 0000198D E97EF2FFFF              	jmp	lff11_5  ; error
  3670                                  
  3671                                  load_11khz_stereo_16_bit:
  3672                                  	; 18/01/2025
  3673                                  	; 18/11/2023
  3674 00001992 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3675                                  					; last of the file?
  3676 00001999 7402                    	jz	short lff11s2_0		; no
  3677 0000199B F9                      	stc
  3678 0000199C C3                      	retn
  3679                                  
  3680                                  lff11s2_0:
  3681                                  	; 01/12/2024
  3682                                  	; edi = audio buffer address
  3683 0000199D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3684                                          ;mov	edx, [loadsize]
  3685                                  
  3686                                  	; esi = buffer address
  3687                                  	;; edx = buffer size
  3688                                  
  3689                                  	; load file into memory
  3690                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000019A2 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000019A8 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000019AA 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000019B0 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 000019B5 CD40                <1>  int 40h
  3691 000019B7 72D4                    	jc	short lff11s2_7 ; error !
  3692                                  
  3693                                  	; 01/12/2024
  3694 000019B9 A3[B07D0000]            	mov	[count], eax
  3695                                  	;;;
  3696                                  	; 07/12/2024
  3697                                  	;mov	edi, audio_buffer
  3698                                  	;;;
  3699 000019BE C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3700 000019C1 750A                    	jnz	short lff11s2_8
  3701 000019C3 E93FF2FFFF              	jmp	lff11_eof
  3702                                  
  3703                                  lff11m2_3:
  3704                                  lff11s2_3:
  3705 000019C8 E922F2FFFF              	jmp	lff11_3	; padfill
  3706                                  		; (put zeros in the remain words of the buffer)
  3707                                  
  3708                                  lff11s2_8:
  3709 000019CD 89C1                    	mov	ecx, eax	; dword count
  3710                                  lff11s2_9:
  3711 000019CF BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3712                                  lff11s2_1:
  3713                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3714 000019D4 66AD                    	lodsw
  3715 000019D6 89C3                    	mov	ebx, eax
  3716 000019D8 66AD                    	lodsw
  3717 000019DA 8B16                    	mov	edx, [esi]
  3718                                  	; 18/01/2025
  3719                                  	;mov	[next_val_l], edx
  3720                                  	; 26/11/2023
  3721                                  	;shr	edx, 16
  3722                                  	;mov	[next_val_r], dx
  3723 000019DC 49                      	dec	ecx
  3724 000019DD 7502                    	jnz	short lff11s2_2_1
  3725 000019DF 31D2                    	xor	edx, edx ; 0
  3726                                  	;mov	[next_val_l], dx
  3727                                  	;mov	[next_val_r], dx
  3728                                  lff11s2_2_1:
  3729                                  	; bx = [previous_val_l]
  3730                                  	; ax = [previous_val_r]
  3731                                  	; [next_val_l]
  3732                                  	; dx = [next_val_r]
  3733                                  	;;;
  3734                                  	; 18/01/2025 (BugFix)
  3735 000019E1 8915[60210000]          	mov	[next_val_l], edx
  3736                                  	;;;
  3737 000019E7 E8EB050000              	call	interpolating_5_16bit_stereo
  3738 000019EC E3DA                    	jecxz	lff11s2_3
  3739                                  lff11s2_2_2:
  3740 000019EE 66AD                    	lodsw
  3741 000019F0 89C3                    	mov	ebx, eax
  3742 000019F2 66AD                    	lodsw
  3743 000019F4 8B16                    	mov	edx, [esi]
  3744                                  	; 18/01/2025
  3745                                  	;mov	[next_val_l], dx
  3746                                  	; 26/11/2023
  3747                                  	;shr	edx, 16
  3748                                  	;mov	[next_val_r], dx
  3749 000019F6 49                      	dec	ecx
  3750 000019F7 7502                    	jnz	short lff11s2_2_3
  3751 000019F9 31D2                    	xor	edx, edx ; 0
  3752                                  	;mov	[next_val_l], dx
  3753                                  	;mov	[next_val_r], dx
  3754                                  lff11s2_2_3:
  3755                                  	;;;
  3756                                  	; 18/01/2025 (BugFix)
  3757 000019FB 8915[60210000]          	mov	[next_val_l], edx
  3758                                  	;;;
  3759 00001A01 E8D9060000              	call	interpolating_4_16bit_stereo
  3760 00001A06 E3C0                    	jecxz	lff11s2_3
  3761                                  	
  3762 00001A08 4D                      	dec	ebp
  3763 00001A09 74C4                    	jz	short lff11s2_9
  3764                                  
  3765 00001A0B 66AD                    	lodsw
  3766 00001A0D 89C3                    	mov	ebx, eax
  3767 00001A0F 66AD                    	lodsw
  3768 00001A11 8B16                    	mov	edx, [esi]
  3769                                  	; 18/01/2025
  3770                                  	;mov	[next_val_l], dx
  3771                                  	; 26/11/2023
  3772                                  	;shr	edx, 16
  3773                                  	;mov	[next_val_r], dx
  3774 00001A13 49                      	dec	ecx
  3775 00001A14 7502                    	jnz	short lff11s2_2_4
  3776 00001A16 31D2                    	xor	edx, edx ; 0
  3777                                  	;mov	[next_val_l], dx
  3778                                  	;mov	[next_val_r], dx
  3779                                  lff11s2_2_4:
  3780                                  	;;;
  3781                                  	; 18/01/2025 (BugFix)
  3782 00001A18 8915[60210000]          	mov	[next_val_l], edx
  3783                                  	;;;
  3784 00001A1E E8BC060000               	call	interpolating_4_16bit_stereo
  3785 00001A23 E3A3                    	jecxz	lff11s2_3
  3786 00001A25 EBAD                    	jmp	short lff11s2_1
  3787                                  
  3788                                  ; .....................
  3789                                  
  3790                                  load_44khz_mono_8_bit:
  3791                                  	; 18/11/2023
  3792 00001A27 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3793                                  					; last of the file?
  3794 00001A2E 7402                    	jz	short lff44m_0		; no
  3795 00001A30 F9                      	stc
  3796 00001A31 C3                      	retn
  3797                                  
  3798                                  lff44m_0:
  3799                                  	; 01/12/2024
  3800                                  	; edi = audio buffer address
  3801 00001A32 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3802                                          ;mov	edx, [loadsize]
  3803                                  
  3804                                  	; esi = buffer address
  3805                                  	;; edx = buffer size
  3806                                  
  3807                                  	; load file into memory
  3808                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001A37 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001A3D 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001A3F 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001A45 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001A4A CD40                <1>  int 40h
  3809 00001A4C 7250                    	jc	short lff44m_7 ; error !
  3810                                  
  3811                                  	; 01/12/2024
  3812 00001A4E A3[B07D0000]            	mov	[count], eax
  3813                                  	;;;
  3814                                  	; 07/12/2024
  3815                                  	;mov	edi, audio_buffer
  3816                                  	;;;
  3817 00001A53 21C0                    	and	eax, eax
  3818 00001A55 7505                    	jnz	short lff44m_8
  3819 00001A57 E9ABF1FFFF              	jmp	lff44_eof
  3820                                  
  3821                                  lff44m_8:
  3822 00001A5C 89C1                    	mov	ecx, eax	; byte count
  3823                                  lff44m_9:
  3824 00001A5E BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3825 00001A63 C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3826                                  lff44m_1:
  3827                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3828                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3829 00001A6A AC                      	lodsb
  3830 00001A6B B280                    	mov	dl, 80h
  3831 00001A6D 49                      	dec	ecx
  3832 00001A6E 7402                    	jz	short lff44m_2_1
  3833 00001A70 8A16                    	mov	dl, [esi]
  3834                                  lff44m_2_1:	
  3835                                  	; al = [previous_val]
  3836                                  	; dl = [next_val]
  3837 00001A72 E825020000              	call	interpolating_2_8bit_mono
  3838 00001A77 E320                    	jecxz	lff44m_3
  3839                                  lff44m_2_2:
  3840 00001A79 AC                      	lodsb
  3841 00001A7A 2C80                    	sub	al, 80h
  3842 00001A7C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3843 00001A80 66AB                    	stosw		; (L)
  3844 00001A82 66AB                    	stosw		; (R)
  3845                                  
  3846 00001A84 49                      	dec	ecx
  3847 00001A85 7412                    	jz	short lff44m_3
  3848 00001A87 4D                      	dec	ebp
  3849 00001A88 75EF                    	jnz	short lff44m_2_2
  3850                                  	
  3851 00001A8A FE0D[64210000]          	dec	byte [faz]
  3852 00001A90 74CC                    	jz	short lff44m_9 
  3853 00001A92 BD0B000000              	mov	ebp, 11
  3854 00001A97 EBD1                    	jmp	short lff44m_1
  3855                                  
  3856                                  lff44m_3:
  3857                                  lff44s_3:
  3858 00001A99 E951F1FFFF              	jmp	lff44_3	; padfill
  3859                                  		; (put zeros in the remain words of the buffer)
  3860                                  lff44m_7:
  3861                                  lff44s_7:
  3862 00001A9E E96DF1FFFF              	jmp	lff44_5  ; error
  3863                                  
  3864                                  load_44khz_stereo_8_bit:
  3865                                  	; 16/11/2023
  3866 00001AA3 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3867                                  					; last of the file?
  3868 00001AAA 7402                    	jz	short lff44s_0		; no
  3869 00001AAC F9                      	stc
  3870 00001AAD C3                      	retn
  3871                                  
  3872                                  lff44s_0:
  3873                                  	; 01/12/2024
  3874                                  	; edi = audio buffer address
  3875 00001AAE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3876                                          ;mov	edx, [loadsize]
  3877                                  
  3878                                  	; esi = buffer address
  3879                                  	;; edx = buffer size
  3880                                  
  3881                                  	; load file into memory
  3882                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001AB3 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001AB9 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001ABB 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001AC1 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001AC6 CD40                <1>  int 40h
  3883 00001AC8 72D4                    	jc	short lff44s_7 ; error !
  3884                                  
  3885                                  	; 01/12/2024
  3886 00001ACA A3[B07D0000]            	mov	[count], eax
  3887                                  	;;;
  3888                                  	; 07/12/2024
  3889                                  	;mov	edi, audio_buffer
  3890                                  	;;;
  3891 00001ACF D1E8                    	shr	eax, 1
  3892 00001AD1 7505                    	jnz	short lff44s_8
  3893 00001AD3 E92FF1FFFF              	jmp	lff44_eof
  3894                                  
  3895                                  lff44s_8:
  3896 00001AD8 89C1                    	mov	ecx, eax	; word count
  3897                                  lff44s_9:
  3898 00001ADA BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3899 00001ADF C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3900                                  lff44s_1:
  3901                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3902                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3903 00001AE6 66AD                    	lodsw
  3904 00001AE8 66BA8080                	mov	dx, 8080h
  3905 00001AEC 49                      	dec	ecx
  3906 00001AED 7403                    	jz	short lff44s_2_1
  3907 00001AEF 668B16                  	mov	dx, [esi]
  3908                                  lff44s_2_1:	
  3909                                  	; al = [previous_val_l]
  3910                                  	; ah = [previous_val_r]
  3911                                  	; dl = [next_val_l]
  3912                                  	; dh = [next_val_r]
  3913 00001AF2 E8C2010000              	call	interpolating_2_8bit_stereo
  3914 00001AF7 E3A0                    	jecxz	lff44s_3
  3915                                  lff44s_2_2:
  3916 00001AF9 AC                      	lodsb
  3917 00001AFA 2C80                    	sub	al, 80h
  3918 00001AFC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3919 00001B00 66AB                    	stosw		; (L)
  3920 00001B02 AC                      	lodsb
  3921 00001B03 2C80                    	sub	al, 80h
  3922 00001B05 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3923 00001B09 66AB                    	stosw		; (R)
  3924                                  
  3925 00001B0B 49                      	dec	ecx
  3926 00001B0C 748B                    	jz	short lff44s_3	
  3927 00001B0E 4D                      	dec	ebp
  3928 00001B0F 75E8                    	jnz	short lff44s_2_2
  3929                                  	
  3930 00001B11 FE0D[64210000]          	dec	byte [faz]
  3931 00001B17 74C1                    	jz	short lff44s_9 
  3932 00001B19 BD0B000000              	mov	ebp, 11
  3933 00001B1E EBC6                    	jmp	short lff44s_1
  3934                                  
  3935                                  load_44khz_mono_16_bit:
  3936                                  	; 18/11/2023
  3937 00001B20 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3938                                  					; last of the file?
  3939 00001B27 7402                    	jz	short lff44m2_0		; no
  3940 00001B29 F9                      	stc
  3941 00001B2A C3                      	retn
  3942                                  
  3943                                  lff44m2_0:
  3944                                  	; 01/12/2024
  3945                                  	; edi = audio buffer address
  3946 00001B2B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3947                                          ;mov	edx, [loadsize]
  3948                                  
  3949                                  	; esi = buffer address
  3950                                  	;; edx = buffer size
  3951                                  
  3952                                  	; load file into memory
  3953                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001B30 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001B36 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001B38 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001B3E B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001B43 CD40                <1>  int 40h
  3954 00001B45 724D                    	jc	short lff44m2_7 ; error !
  3955                                  
  3956                                  	; 01/12/2024
  3957 00001B47 A3[B07D0000]            	mov	[count], eax
  3958                                  	;;;
  3959                                  	; 07/12/2024
  3960                                  	;mov	edi, audio_buffer
  3961                                  	;;;
  3962 00001B4C D1E8                    	shr	eax, 1
  3963 00001B4E 7505                    	jnz	short lff44m2_8
  3964 00001B50 E9B2F0FFFF              	jmp	lff44_eof
  3965                                  
  3966                                  lff44m2_8:
  3967 00001B55 89C1                    	mov	ecx, eax	; word count
  3968                                  lff44m2_9:
  3969 00001B57 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3970 00001B5C C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3971                                  lff44m2_1:
  3972                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3973                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3974 00001B63 66AD                    	lodsw
  3975 00001B65 31D2                    	xor	edx, edx
  3976 00001B67 49                      	dec	ecx
  3977 00001B68 7403                    	jz	short lff44m2_2_1
  3978 00001B6A 668B16                  	mov	dx, [esi]
  3979                                  lff44m2_2_1:	
  3980                                  	; ax = [previous_val]
  3981                                  	; dx = [next_val]
  3982 00001B6D E80B020000              	call	interpolating_2_16bit_mono
  3983 00001B72 E31B                    	jecxz	lff44m2_3
  3984                                  lff44m2_2_2:
  3985 00001B74 66AD                    	lodsw
  3986 00001B76 66AB                    	stosw		; (L)eft Channel
  3987 00001B78 66AB                    	stosw		; (R)ight Channel
  3988                                  
  3989 00001B7A 49                      	dec	ecx
  3990 00001B7B 7412                    	jz	short lff44m2_3	
  3991 00001B7D 4D                      	dec	ebp
  3992 00001B7E 75F4                    	jnz	short lff44m2_2_2
  3993                                  	
  3994 00001B80 FE0D[64210000]          	dec	byte [faz]
  3995 00001B86 74CF                    	jz	short lff44m2_9 
  3996 00001B88 BD0B000000              	mov	ebp, 11
  3997 00001B8D EBD4                    	jmp	short lff44m2_1
  3998                                  
  3999                                  lff44m2_3:
  4000                                  lff44s2_3:
  4001 00001B8F E95BF0FFFF              	jmp	lff44_3	; padfill
  4002                                  		; (put zeros in the remain words of the buffer)
  4003                                  lff44m2_7:
  4004                                  lff44s2_7:
  4005 00001B94 E977F0FFFF              	jmp	lff44_5  ; error
  4006                                  
  4007                                  load_44khz_stereo_16_bit:
  4008                                  	; 18/11/2023
  4009 00001B99 F605[367D0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4010                                  					; last of the file?
  4011 00001BA0 7402                    	jz	short lff44s2_0		; no
  4012 00001BA2 F9                      	stc
  4013 00001BA3 C3                      	retn
  4014                                  
  4015                                  lff44s2_0:
  4016                                  	; 01/12/2024
  4017                                  	; edi = audio buffer address
  4018 00001BA4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4019                                          ;mov	edx, [loadsize]
  4020                                  
  4021                                  	; esi = buffer address
  4022                                  	;; edx = buffer size
  4023                                  
  4024                                  	; load file into memory
  4025                                  	sys 	_read, [filehandle], esi, [loadsize]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00001BA9 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00001BAF 89F1                <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00001BB1 8B15[A07D0000]      <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00001BB7 B803000000          <1>  mov eax, %1
    99                              <1> 
   100 00001BBC CD40                <1>  int 40h
  4026 00001BBE 72D4                    	jc	short lff44s2_7 ; error !
  4027                                  
  4028                                  	; 01/12/2024
  4029 00001BC0 A3[B07D0000]            	mov	[count], eax
  4030                                  	;;;
  4031                                  	; 07/12/2024
  4032                                  	;mov	edi, audio_buffer
  4033                                  	;;;
  4034 00001BC5 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4035 00001BC8 7505                    	jnz	short lff44s2_8
  4036 00001BCA E938F0FFFF              	jmp	lff44_eof
  4037                                  
  4038                                  lff44s2_8:
  4039 00001BCF 89C1                    	mov	ecx, eax	; dword count
  4040                                  lff44s2_9:
  4041 00001BD1 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4042 00001BD6 C605[64210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4043                                  lff44s2_1:
  4044                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4045                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4046 00001BDD 66AD                    	lodsw
  4047 00001BDF 89C3                    	mov	ebx, eax
  4048 00001BE1 66AD                    	lodsw
  4049                                  	;mov	dx, [esi]
  4050                                  	;mov	[next_val_l], dx
  4051                                  	;mov	dx, [esi+2]
  4052                                  	; 26/11/2023
  4053 00001BE3 8B16                    	mov	edx, [esi]
  4054 00001BE5 668915[60210000]        	mov	[next_val_l], dx
  4055 00001BEC C1EA10                  	shr	edx, 16
  4056 00001BEF 49                      	dec	ecx
  4057 00001BF0 7509                    	jnz	short lff44s2_2_1
  4058 00001BF2 31D2                    	xor	edx, edx ; 0
  4059 00001BF4 668915[60210000]        	mov	[next_val_l], dx
  4060                                  lff44s2_2_1:
  4061                                  	; bx = [previous_val_l]
  4062                                  	; ax = [previous_val_r]
  4063                                  	; [next_val_l]
  4064                                  	; dx = [next_val_r]
  4065 00001BFB E895010000              	call	interpolating_2_16bit_stereo
  4066 00001C00 E38D                    	jecxz	lff44s2_3
  4067                                  lff44s2_2_2:
  4068                                  	;movsw		; (L)eft Channel
  4069                                  	;movsw		; (R)ight Channel
  4070 00001C02 A5                      	movsd
  4071                                  
  4072 00001C03 49                      	dec	ecx
  4073 00001C04 7489                    	jz	short lff44s2_3	
  4074 00001C06 4D                      	dec	ebp
  4075 00001C07 75F9                    	jnz	short lff44s2_2_2
  4076                                  	
  4077 00001C09 FE0D[64210000]          	dec	byte [faz]
  4078 00001C0F 74C0                    	jz	short lff44s2_9 
  4079 00001C11 BD0B000000              	mov	ebp, 11
  4080 00001C16 EBC5                    	jmp	short lff44s2_1
  4081                                  
  4082                                  ; .....................
  4083                                  
  4084                                  interpolating_3_8bit_mono:
  4085                                  	; 16/11/2023
  4086                                  	; al = [previous_val]
  4087                                  	; dl = [next_val]
  4088                                  	; original-interpolated-interpolated
  4089 00001C18 88C3                    	mov	bl, al
  4090 00001C1A 2C80                    	sub	al, 80h
  4091 00001C1C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4092 00001C20 66AB                    	stosw		; original sample (L)
  4093 00001C22 66AB                    	stosw		; original sample (R)
  4094 00001C24 88D8                    	mov	al, bl
  4095 00001C26 00D0                    	add	al, dl
  4096 00001C28 D0D8                    	rcr	al, 1
  4097 00001C2A 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4098 00001C2C 00D8                    	add	al, bl
  4099 00001C2E D0D8                    	rcr	al, 1
  4100 00001C30 2C80                    	sub	al, 80h
  4101 00001C32 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4102 00001C36 66AB                    	stosw		; interpolated sample 1 (L)
  4103 00001C38 66AB                    	stosw		; interpolated sample 1 (R)
  4104 00001C3A 88F8                    	mov	al, bh
  4105 00001C3C 00D0                    	add	al, dl	; [next_val]
  4106 00001C3E D0D8                    	rcr	al, 1
  4107 00001C40 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4108 00001C44 66AB                    	stosw		; interpolated sample 2 (L)
  4109 00001C46 66AB                    	stosw		; interpolated sample 2 (R)
  4110 00001C48 C3                      	retn
  4111                                  
  4112                                  interpolating_3_8bit_stereo:
  4113                                  	; 16/11/2023
  4114                                  	; al = [previous_val_l]
  4115                                  	; ah = [previous_val_r]
  4116                                  	; dl = [next_val_l]
  4117                                  	; dh = [next_val_r]
  4118                                  	; original-interpolated-interpolated
  4119 00001C49 89C3                    	mov	ebx, eax
  4120 00001C4B 2C80                    	sub	al, 80h
  4121 00001C4D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4122 00001C51 66AB                    	stosw		; original sample (L)
  4123 00001C53 88F8                    	mov	al, bh
  4124 00001C55 2C80                    	sub	al, 80h
  4125 00001C57 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4126 00001C5B 66AB                    	stosw		; original sample (R)
  4127 00001C5D 88D8                    	mov	al, bl
  4128 00001C5F 00D0                    	add	al, dl	; [next_val_l]
  4129 00001C61 D0D8                    	rcr	al, 1
  4130 00001C63 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4131 00001C64 00D8                    	add	al, bl	; [previous_val_l]
  4132 00001C66 D0D8                    	rcr	al, 1
  4133 00001C68 2C80                    	sub	al, 80h
  4134 00001C6A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4135 00001C6E 66AB                    	stosw		; interpolated sample 1 (L)
  4136 00001C70 88F8                    	mov	al, bh
  4137 00001C72 00F0                    	add	al, dh	; [next_val_r]
  4138 00001C74 D0D8                    	rcr	al, 1
  4139 00001C76 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4140 00001C77 00F8                    	add	al, bh	; [previous_val_r]
  4141 00001C79 D0D8                    	rcr	al, 1
  4142 00001C7B 2C80                    	sub	al, 80h
  4143 00001C7D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4144 00001C81 66AB                    	stosw		; interpolated sample 1 (R)
  4145 00001C83 5B                      	pop	ebx ; **
  4146 00001C84 58                      	pop	eax ; *
  4147 00001C85 00D0                    	add	al, dl	; [next_val_l]
  4148 00001C87 D0D8                    	rcr	al, 1
  4149 00001C89 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4150 00001C8D 66AB                    	stosw		; interpolated sample 2 (L)
  4151 00001C8F 88D8                    	mov	al, bl
  4152 00001C91 00F0                    	add	al, dh	; [next_val_r]
  4153 00001C93 D0D8                    	rcr	al, 1
  4154 00001C95 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4155 00001C99 66AB                    	stosw		; interpolated sample 2 (R)
  4156 00001C9B C3                      	retn
  4157                                  
  4158                                  interpolating_2_8bit_mono:
  4159                                  	; 16/11/2023
  4160                                  	; al = [previous_val]
  4161                                  	; dl = [next_val]
  4162                                  	; original-interpolated
  4163 00001C9C 88C3                    	mov	bl, al
  4164 00001C9E 2C80                    	sub	al, 80h
  4165 00001CA0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4166 00001CA4 66AB                    	stosw		; original sample (L)
  4167 00001CA6 66AB                    	stosw		; original sample (R)
  4168 00001CA8 88D8                    	mov	al, bl
  4169 00001CAA 00D0                    	add	al, dl
  4170 00001CAC D0D8                    	rcr	al, 1
  4171 00001CAE 2C80                    	sub	al, 80h
  4172 00001CB0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4173 00001CB4 66AB                    	stosw		; interpolated sample (L)
  4174 00001CB6 66AB                    	stosw		; interpolated sample (R)
  4175 00001CB8 C3                      	retn
  4176                                  
  4177                                  interpolating_2_8bit_stereo:
  4178                                  	; 16/11/2023
  4179                                  	; al = [previous_val_l]
  4180                                  	; ah = [previous_val_r]
  4181                                  	; dl = [next_val_l]
  4182                                  	; dh = [next_val_r]
  4183                                  	; original-interpolated
  4184 00001CB9 89C3                    	mov	ebx, eax
  4185 00001CBB 2C80                    	sub	al, 80h
  4186 00001CBD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4187 00001CC1 66AB                    	stosw		; original sample (L)
  4188 00001CC3 88F8                    	mov	al, bh
  4189 00001CC5 2C80                    	sub	al, 80h
  4190 00001CC7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4191 00001CCB 66AB                    	stosw		; original sample (R)
  4192 00001CCD 88D8                    	mov	al, bl	; [previous_val_l]
  4193 00001CCF 00D0                    	add	al, dl	; [next_val_l]
  4194 00001CD1 D0D8                    	rcr	al, 1
  4195 00001CD3 2C80                    	sub	al, 80h
  4196 00001CD5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4197 00001CD9 66AB                    	stosw		; interpolated sample (L)
  4198 00001CDB 88F8                    	mov	al, bh
  4199 00001CDD 00F0                    	add	al, dh	; [next_val_r]
  4200 00001CDF D0D8                    	rcr	al, 1
  4201 00001CE1 2C80                    	sub	al, 80h
  4202 00001CE3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4203 00001CE7 66AB                    	stosw		; interpolated sample (R)
  4204 00001CE9 C3                      	retn
  4205                                  
  4206                                  interpolating_3_16bit_mono:
  4207                                  	; 16/11/2023
  4208                                  	; ax = [previous_val]
  4209                                  	; dx = [next_val]
  4210                                  	; original-interpolated-interpolated
  4211                                  
  4212 00001CEA 66AB                    	stosw		; original sample (L)
  4213 00001CEC 66AB                    	stosw		; original sample (R)
  4214 00001CEE 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4215 00001CF1 50                      	push	eax ; *	; [previous_val]
  4216 00001CF2 80C680                  	add	dh, 80h
  4217 00001CF5 6601D0                  	add	ax, dx
  4218 00001CF8 66D1D8                  	rcr	ax, 1
  4219 00001CFB 5B                      	pop	ebx ; *
  4220 00001CFC 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4221 00001CFD 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4222 00001D00 66D1D8                  	rcr	ax, 1
  4223 00001D03 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4224 00001D06 66AB                    	stosw 		; interpolated sample 1 (L)
  4225 00001D08 66AB                    	stosw		; interpolated sample 1 (R)
  4226 00001D0A 89D8                    	mov	eax, ebx
  4227 00001D0C 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4228 00001D0F 66D1D8                  	rcr	ax, 1
  4229 00001D12 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4230 00001D15 66AB                    	stosw		; interpolated sample 2 (L)
  4231 00001D17 66AB                    	stosw		; interpolated sample 2 (R)
  4232 00001D19 C3                      	retn
  4233                                  
  4234                                  interpolating_3_16bit_stereo:
  4235                                  	; 16/11/2023
  4236                                  	; bx = [previous_val_l]
  4237                                  	; ax = [previous_val_r]
  4238                                  	; [next_val_l]
  4239                                  	; dx = [next_val_r]
  4240                                  	; original-interpolated-interpolated
  4241                                  
  4242 00001D1A 93                      	xchg	eax, ebx
  4243 00001D1B 66AB                    	stosw		; original sample (L)
  4244 00001D1D 93                      	xchg	eax, ebx
  4245 00001D1E 66AB                    	stosw		; original sample (R)
  4246 00001D20 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4247 00001D23 50                      	push	eax ; *	; [previous_val_r]
  4248 00001D24 80C780                  	add	bh, 80h
  4249 00001D27 8005[61210000]80        	add	byte [next_val_l+1], 80h
  4250 00001D2E 66A1[60210000]          	mov	ax, [next_val_l]
  4251 00001D34 6601D8                  	add	ax, bx	; [previous_val_l]
  4252 00001D37 66D1D8                  	rcr	ax, 1
  4253 00001D3A 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4254 00001D3B 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4255 00001D3E 66D1D8                  	rcr	ax, 1
  4256 00001D41 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4257 00001D44 66AB                    	stosw 		; interpolated sample 1 (L)
  4258 00001D46 58                      	pop	eax  ; *
  4259 00001D47 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4260 00001D4A 52                      	push	edx  ; * ; [next_val_r]
  4261 00001D4B 92                      	xchg	eax, edx
  4262 00001D4C 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4263 00001D4F 66D1D8                  	rcr	ax, 1	; / 2
  4264 00001D52 50                      	push	eax ; ** ; interpolated middle (R)
  4265 00001D53 6601D0                  	add	ax, dx	; + [previous_val_r]
  4266 00001D56 66D1D8                  	rcr	ax, 1
  4267 00001D59 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4268 00001D5C 66AB                    	stosw 		; interpolated sample 1 (R)
  4269 00001D5E 66A1[60210000]          	mov	ax, [next_val_l]
  4270 00001D64 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4271 00001D67 66D1D8                  	rcr	ax, 1
  4272 00001D6A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4273 00001D6D 66AB                    	stosw 		; interpolated sample 2 (L)
  4274 00001D6F 58                      	pop	eax ; **
  4275 00001D70 5A                      	pop	edx ; *
  4276 00001D71 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4277 00001D74 66D1D8                  	rcr	ax, 1	; / 2
  4278 00001D77 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4279 00001D7A 66AB                    	stosw 		; interpolated sample 2 (L)
  4280 00001D7C C3                      	retn
  4281                                  
  4282                                  interpolating_2_16bit_mono:
  4283                                  	; 16/11/2023
  4284                                  	; ax = [previous_val]
  4285                                  	; dx = [next_val]
  4286                                  	; original-interpolated
  4287                                  
  4288 00001D7D 66AB                    	stosw		; original sample (L)
  4289 00001D7F 66AB                    	stosw		; original sample (R)
  4290 00001D81 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4291 00001D84 80C680                  	add	dh, 80h
  4292 00001D87 6601D0                  	add	ax, dx
  4293 00001D8A 66D1D8                  	rcr	ax, 1
  4294 00001D8D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4295 00001D90 66AB                    	stosw		; interpolated sample (L)
  4296 00001D92 66AB                    	stosw		; interpolated sample (R)
  4297 00001D94 C3                      	retn
  4298                                  
  4299                                  interpolating_2_16bit_stereo:
  4300                                  	; 18/01/2025
  4301                                  	; 16/11/2023
  4302                                  	; bx = [previous_val_l]
  4303                                  	; ax = [previous_val_r]
  4304                                  	; [next_val_l]
  4305                                  	; dx = [next_val_r]
  4306                                  	; original-interpolated
  4307                                  
  4308 00001D95 93                      	xchg	eax, ebx
  4309 00001D96 66AB                    	stosw		; original sample (L)
  4310 00001D98 93                      	xchg	eax, ebx
  4311 00001D99 66AB                    	stosw		; original sample (R)
  4312 00001D9B 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4313 00001D9E 80C680                  	add	dh, 80h
  4314 00001DA1 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4315 00001DA4 66D1D8                  	rcr	ax, 1	; / 2
  4316                                  	; 18/01/2025
  4317 00001DA7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4318                                  	;push	eax ; *	; interpolated sample (R)
  4319                                  	; 18/01/2025
  4320 00001DAA C1E010                  	shl	eax, 16
  4321 00001DAD 66A1[60210000]          	mov	ax, [next_val_l]
  4322 00001DB3 80C480                  	add	ah, 80h
  4323 00001DB6 80C780                  	add	bh, 80h
  4324 00001DB9 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4325 00001DBC 66D1D8                  	rcr	ax, 1	; / 2
  4326 00001DBF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4327                                  	; 18/01/2025
  4328                                  	;stosw 		; interpolated sample (L)
  4329                                  	;pop	eax ; *	
  4330                                  	;sub	ah, 80h	; -32768 to +32767 format again
  4331                                  	;stosw 		; interpolated sample (R)
  4332                                  	; 18/01/2025
  4333 00001DC2 AB                      	stosd
  4334 00001DC3 C3                      	retn
  4335                                  
  4336                                  interpolating_5_8bit_mono:
  4337                                  	; 17/11/2023
  4338                                  	; al = [previous_val]
  4339                                  	; dl = [next_val]
  4340                                  	; original-interpltd-interpltd-interpltd-interpltd
  4341 00001DC4 88C3                    	mov	bl, al
  4342 00001DC6 2C80                    	sub	al, 80h
  4343 00001DC8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4344 00001DCC 66AB                    	stosw		; original sample (L)
  4345 00001DCE 66AB                    	stosw		; original sample (R)
  4346 00001DD0 88D8                    	mov	al, bl
  4347 00001DD2 00D0                    	add	al, dl
  4348 00001DD4 D0D8                    	rcr	al, 1
  4349 00001DD6 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4350 00001DD8 00D8                    	add	al, bl  ; [previous_val]
  4351 00001DDA D0D8                    	rcr	al, 1 	
  4352 00001DDC 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4353 00001DDE 00D8                    	add	al, bl
  4354 00001DE0 D0D8                    	rcr	al, 1
  4355 00001DE2 2C80                    	sub	al, 80h
  4356 00001DE4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4357 00001DE8 66AB                    	stosw		; interpolated sample 1 (L)
  4358 00001DEA 66AB                    	stosw		; interpolated sample 1 (R)
  4359 00001DEC 88F8                    	mov	al, bh
  4360 00001DEE 00F0                    	add	al, dh
  4361 00001DF0 D0D8                    	rcr	al, 1
  4362 00001DF2 2C80                    	sub	al, 80h
  4363 00001DF4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4364 00001DF8 66AB                    	stosw		; interpolated sample 2 (L)
  4365 00001DFA 66AB                    	stosw		; interpolated sample 2 (R)
  4366 00001DFC 88F8                    	mov	al, bh
  4367 00001DFE 00D0                    	add	al, dl	; [next_val]
  4368 00001E00 D0D8                    	rcr	al, 1
  4369 00001E02 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4370 00001E04 00F8                    	add	al, bh
  4371 00001E06 D0D8                    	rcr	al, 1
  4372 00001E08 2C80                    	sub	al, 80h
  4373 00001E0A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4374 00001E0E 66AB                    	stosw		; interpolated sample 3 (L)
  4375 00001E10 66AB                    	stosw		; interpolated sample 3 (R)
  4376 00001E12 88F0                    	mov	al, dh
  4377 00001E14 00D0                    	add	al, dl
  4378 00001E16 D0D8                    	rcr	al, 1
  4379 00001E18 2C80                    	sub	al, 80h
  4380 00001E1A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4381 00001E1E 66AB                    	stosw		; interpolated sample 4 (L)
  4382 00001E20 66AB                    	stosw		; interpolated sample 4 (R)
  4383 00001E22 C3                      	retn
  4384                                  
  4385                                  interpolating_5_8bit_stereo:
  4386                                  	; 17/11/2023
  4387                                  	; al = [previous_val_l]
  4388                                  	; ah = [previous_val_r]
  4389                                  	; dl = [next_val_l]
  4390                                  	; dh = [next_val_r]
  4391                                  	; original-interpltd-interpltd-interpltd-interpltd
  4392 00001E23 89C3                    	mov	ebx, eax
  4393 00001E25 2C80                    	sub	al, 80h
  4394 00001E27 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4395 00001E2B 66AB                    	stosw		; original sample (L)
  4396 00001E2D 88F8                    	mov	al, bh
  4397 00001E2F 2C80                    	sub	al, 80h
  4398 00001E31 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4399 00001E35 66AB                    	stosw		; original sample (R)
  4400 00001E37 52                      	push	edx ; *
  4401 00001E38 88D8                    	mov	al, bl
  4402 00001E3A 00D0                    	add	al, dl	; [next_val_l]
  4403 00001E3C D0D8                    	rcr	al, 1
  4404 00001E3E 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4405 00001E3F 00D8                    	add	al, bl	; [previous_val_l]
  4406 00001E41 D0D8                    	rcr	al, 1
  4407 00001E43 86D8                    	xchg	al, bl
  4408 00001E45 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4409 00001E47 D0D8                    	rcr	al, 1
  4410 00001E49 2C80                    	sub	al, 80h
  4411 00001E4B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4412 00001E4F 66AB                    	stosw		; interpolated sample 1 (L)
  4413 00001E51 88F8                    	mov	al, bh
  4414 00001E53 00F0                    	add	al, dh	; [next_val_r]
  4415 00001E55 D0D8                    	rcr	al, 1
  4416 00001E57 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4417 00001E58 00F8                    	add	al, bh	; [previous_val_r]
  4418 00001E5A D0D8                    	rcr	al, 1
  4419 00001E5C 86F8                    	xchg	al, bh
  4420 00001E5E 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4421 00001E60 D0D8                    	rcr	al, 1
  4422 00001E62 2C80                    	sub	al, 80h
  4423 00001E64 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4424 00001E68 66AB                    	stosw		; interpolated sample 1 (R)
  4425 00001E6A 5A                      	pop	edx ; ***
  4426 00001E6B 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4427 00001E6C 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4428 00001E6E 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4429 00001E70 D0D8                    	rcr	al, 1
  4430 00001E72 2C80                    	sub	al, 80h
  4431 00001E74 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4432 00001E78 66AB                    	stosw		; interpolated sample 2 (L)
  4433 00001E7A 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4434 00001E7C 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4435 00001E7E 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4436 00001E80 D0D8                    	rcr	al, 1
  4437 00001E82 2C80                    	sub	al, 80h
  4438 00001E84 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4439 00001E88 66AB                    	stosw		; interpolated sample 2 (R)
  4440 00001E8A 5A                      	pop	edx ; *
  4441 00001E8B 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4442 00001E8D 00D0                    	add	al, dl	; [next_val_l]
  4443 00001E8F D0D8                    	rcr	al, 1
  4444 00001E91 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4445 00001E93 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4446 00001E95 D0D8                    	rcr	al, 1
  4447 00001E97 2C80                    	sub	al, 80h
  4448 00001E99 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4449 00001E9D 66AB                    	stosw		; interpolated sample 3 (L)
  4450 00001E9F 88F8                    	mov	al, bh	
  4451 00001EA1 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4452 00001EA3 D0D8                    	rcr	al, 1
  4453 00001EA5 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4454 00001EA7 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4455 00001EA9 D0D8                    	rcr	al, 1
  4456 00001EAB 2C80                    	sub	al, 80h
  4457 00001EAD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4458 00001EB1 66AB                    	stosw		; interpolated sample 3 (R)
  4459 00001EB3 88D8                    	mov	al, bl
  4460 00001EB5 00D0                    	add	al, dl	; [next_val_l]
  4461 00001EB7 D0D8                    	rcr	al, 1
  4462 00001EB9 2C80                    	sub	al, 80h
  4463 00001EBB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4464 00001EBF 66AB                    	stosw		; interpolated sample 4 (L)
  4465 00001EC1 88F8                    	mov	al, bh
  4466 00001EC3 00F0                    	add	al, dh	; [next_val_r]
  4467 00001EC5 D0D8                    	rcr	al, 1
  4468 00001EC7 2C80                    	sub	al, 80h
  4469 00001EC9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4470 00001ECD 66AB                    	stosw		; interpolated sample 4 (R)
  4471 00001ECF C3                      	retn
  4472                                  
  4473                                  interpolating_4_8bit_mono:
  4474                                  	; 17/11/2023
  4475                                  	; al = [previous_val]
  4476                                  	; dl = [next_val]
  4477                                  	; original-interpolated-interpolated-interpolated
  4478 00001ED0 88C3                    	mov	bl, al
  4479 00001ED2 2C80                    	sub	al, 80h
  4480 00001ED4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4481 00001ED8 66AB                    	stosw		; original sample (L)
  4482 00001EDA 66AB                    	stosw		; original sample (R)
  4483 00001EDC 88D8                    	mov	al, bl
  4484 00001EDE 00D0                    	add	al, dl	
  4485 00001EE0 D0D8                    	rcr	al, 1
  4486 00001EE2 86D8                    	xchg	al, bl  ; al = [previous_val]
  4487 00001EE4 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4488 00001EE6 D0D8                    	rcr	al, 1 	
  4489 00001EE8 2C80                    	sub	al, 80h
  4490 00001EEA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4491 00001EEE 66AB                    	stosw		; interpolated sample 1 (L)
  4492 00001EF0 66AB                    	stosw		; interpolated sample 1 (R)
  4493 00001EF2 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4494 00001EF4 2C80                    	sub	al, 80h
  4495 00001EF6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4496 00001EFA 66AB                    	stosw		; interpolated sample 2 (L)
  4497 00001EFC 66AB                    	stosw		; interpolated sample 2 (R)
  4498 00001EFE 88D8                    	mov	al, bl
  4499 00001F00 00D0                    	add	al, dl	; [next_val]
  4500 00001F02 D0D8                    	rcr	al, 1
  4501 00001F04 2C80                    	sub	al, 80h
  4502 00001F06 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4503 00001F0A 66AB                    	stosw		; interpolated sample 3 (L)
  4504 00001F0C 66AB                    	stosw		; interpolated sample 3 (R)
  4505 00001F0E C3                      	retn
  4506                                  
  4507                                  interpolating_4_8bit_stereo:
  4508                                  	; 17/11/2023
  4509                                  	; al = [previous_val_l]
  4510                                  	; ah = [previous_val_r]
  4511                                  	; dl = [next_val_l]
  4512                                  	; dh = [next_val_r]	
  4513                                  	; original-interpolated-interpolated-interpolated
  4514 00001F0F 89C3                    	mov	ebx, eax
  4515 00001F11 2C80                    	sub	al, 80h
  4516 00001F13 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4517 00001F17 66AB                    	stosw		; original sample (L)
  4518 00001F19 88F8                    	mov	al, bh
  4519 00001F1B 2C80                    	sub	al, 80h
  4520 00001F1D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4521 00001F21 66AB                    	stosw		; original sample (R)
  4522 00001F23 88D8                    	mov	al, bl
  4523 00001F25 00D0                    	add	al, dl	; [next_val_l]
  4524 00001F27 D0D8                    	rcr	al, 1
  4525 00001F29 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4526 00001F2B 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4527 00001F2D D0D8                    	rcr	al, 1
  4528 00001F2F 2C80                    	sub	al, 80h
  4529 00001F31 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4530 00001F35 66AB                    	stosw		; interpolated sample 1 (L)
  4531 00001F37 88F8                    	mov	al, bh
  4532 00001F39 00F0                    	add	al, dh	; [next_val_r]
  4533 00001F3B D0D8                    	rcr	al, 1
  4534 00001F3D 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4535 00001F3F 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4536 00001F41 D0D8                    	rcr	al, 1
  4537 00001F43 2C80                    	sub	al, 80h
  4538 00001F45 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4539 00001F49 66AB                    	stosw		; interpolated sample 1 (R)
  4540 00001F4B 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4541 00001F4D 2C80                    	sub	al, 80h
  4542 00001F4F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4543 00001F53 66AB                    	stosw		; interpolated sample 2 (L)
  4544 00001F55 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4545 00001F57 2C80                    	sub	al, 80h
  4546 00001F59 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4547 00001F5D 66AB                    	stosw		; interpolated sample 2 (L)
  4548 00001F5F 88D8                    	mov	al, bl
  4549 00001F61 00D0                    	add	al, dl	; [next_val_l]
  4550 00001F63 D0D8                    	rcr	al, 1
  4551 00001F65 2C80                    	sub	al, 80h
  4552 00001F67 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4553 00001F6B 66AB                    	stosw		; interpolated sample 3 (L)
  4554 00001F6D 88F8                    	mov	al, bh
  4555 00001F6F 00F0                    	add	al, dh	; [next_val_r]
  4556 00001F71 D0D8                    	rcr	al, 1
  4557 00001F73 2C80                    	sub	al, 80h
  4558 00001F75 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4559 00001F79 66AB                    	stosw		; interpolated sample 3 (R)
  4560 00001F7B C3                      	retn
  4561                                  
  4562                                  interpolating_5_16bit_mono:
  4563                                  	; 18/11/2023
  4564                                  	; ax = [previous_val]
  4565                                  	; dx = [next_val]
  4566                                  	; original-interpltd-interpltd-interpltd-interpltd
  4567 00001F7C 66AB                    	stosw		; original sample (L)
  4568 00001F7E 66AB                    	stosw		; original sample (R)
  4569 00001F80 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4570 00001F83 89C3                    	mov	ebx, eax ; [previous_val]
  4571 00001F85 80C680                  	add	dh, 80h
  4572 00001F88 6601D0                  	add	ax, dx
  4573 00001F8B 66D1D8                  	rcr	ax, 1
  4574 00001F8E 50                      	push	eax ; *	; interpolated middle (temporary)
  4575 00001F8F 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4576 00001F92 66D1D8                  	rcr	ax, 1
  4577 00001F95 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4578 00001F96 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4579 00001F99 66D1D8                  	rcr	ax, 1	
  4580 00001F9C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4581 00001F9F 66AB                    	stosw 		; interpolated sample 1 (L)
  4582 00001FA1 66AB                    	stosw		; interpolated sample 1 (R)
  4583 00001FA3 58                      	pop	eax ; **
  4584 00001FA4 5B                      	pop	ebx ; *
  4585 00001FA5 6601D8                  	add	ax, bx	; 1st quarter + middle
  4586 00001FA8 66D1D8                  	rcr	ax, 1	; / 2
  4587 00001FAB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4588 00001FAE 66AB                    	stosw		; interpolated sample 2 (L)
  4589 00001FB0 66AB                    	stosw		; interpolated sample 2 (R)
  4590 00001FB2 89D8                    	mov	eax, ebx
  4591 00001FB4 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4592 00001FB7 66D1D8                  	rcr	ax, 1
  4593 00001FBA 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4594 00001FBB 6601D8                  	add	ax, bx	; + interpolated middle
  4595 00001FBE 66D1D8                  	rcr	ax, 1
  4596 00001FC1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4597 00001FC4 66AB                    	stosw		; interpolated sample 3 (L)
  4598 00001FC6 66AB                    	stosw		; interpolated sample 3 (R)
  4599 00001FC8 58                      	pop	eax ; *	
  4600 00001FC9 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4601 00001FCC 66D1D8                  	rcr	ax, 1	; / 2
  4602 00001FCF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4603 00001FD2 66AB                    	stosw		; interpolated sample 4 (L)
  4604 00001FD4 66AB                    	stosw		; interpolated sample 4 (R)
  4605 00001FD6 C3                      	retn
  4606                                  
  4607                                  interpolating_5_16bit_stereo:
  4608                                  	; 18/11/2023
  4609                                  	; bx = [previous_val_l]
  4610                                  	; ax = [previous_val_r]
  4611                                  	; [next_val_l]
  4612                                  	; [next_val_r]
  4613                                  	; original-interpltd-interpltd-interpltd-interpltd
  4614 00001FD7 51                      	push	ecx ; !
  4615 00001FD8 93                      	xchg	eax, ebx
  4616 00001FD9 66AB                    	stosw		; original sample (L)
  4617 00001FDB 93                      	xchg	eax, ebx
  4618 00001FDC 66AB                    	stosw		; original sample (R)
  4619 00001FDE 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4620 00001FE1 50                      	push	eax ; *	; [previous_val_r]
  4621 00001FE2 80C780                  	add	bh, 80h
  4622 00001FE5 8005[61210000]80        	add	byte [next_val_l+1], 80h
  4623 00001FEC 66A1[60210000]          	mov	ax, [next_val_l]
  4624 00001FF2 6601D8                  	add	ax, bx	; [previous_val_l]
  4625 00001FF5 66D1D8                  	rcr	ax, 1
  4626 00001FF8 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4627 00001FFA 6601D8                  	add	ax, bx	
  4628 00001FFD 66D1D8                  	rcr	ax, 1
  4629 00002000 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4630 00002002 6601D8                  	add	ax, bx	; [previous_val_l]
  4631 00002005 66D1D8                  	rcr	ax, 1
  4632 00002008 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4633 0000200B 66AB                    	stosw 		; interpolated sample 1 (L)
  4634 0000200D 89C8                    	mov	eax, ecx
  4635 0000200F 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4636 00002012 66D1D8                  	rcr	ax, 1	; / 2
  4637 00002015 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4638 00002017 5A                      	pop	edx ; *	; [previous_val_r]
  4639 00002018 89D0                    	mov	eax, edx
  4640 0000201A 8005[63210000]80        	add	byte [next_val_r+1], 80h
  4641 00002021 660305[62210000]        	add	ax, [next_val_r]
  4642 00002028 66D1D8                  	rcr	ax, 1
  4643 0000202B 50                      	push	eax ; *	; interpolated middle (R)
  4644 0000202C 6601D0                  	add	ax, dx
  4645 0000202F 66D1D8                  	rcr	ax, 1
  4646 00002032 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4647 00002033 6601D0                  	add	ax, dx	; [previous_val_r]
  4648 00002036 66D1D8                  	rcr	ax, 1
  4649 00002039 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4650 0000203C 66AB                    	stosw 		; interpolated sample 1 (R)
  4651 0000203E 89D8                    	mov	eax, ebx
  4652 00002040 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4653 00002043 66AB                    	stosw 		; interpolated sample 2 (L)
  4654 00002045 58                      	pop	eax ; **
  4655 00002046 5A                      	pop	edx ; *
  4656 00002047 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4657 0000204A 66D1D8                  	rcr	ax, 1	; / 2
  4658 0000204D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4659 00002050 66AB                    	stosw 		; interpolated sample 2 (R)
  4660 00002052 89C8                    	mov	eax, ecx
  4661 00002054 660305[60210000]        	add	ax, [next_val_l]
  4662 0000205B 66D1D8                  	rcr	ax, 1
  4663 0000205E 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4664 0000205F 6601C8                  	add	ax, cx	; interpolated middle (L)
  4665 00002062 66D1D8                  	rcr	ax, 1
  4666 00002065 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4667 00002068 66AB                    	stosw 		; interpolated sample 3 (L)
  4668 0000206A 89D0                    	mov	eax, edx
  4669 0000206C 660305[62210000]        	add	ax, [next_val_r]
  4670 00002073 66D1D8                  	rcr	ax, 1
  4671 00002076 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4672 00002077 6601D0                  	add	ax, dx	; interpolated middle (R)
  4673 0000207A 66D1D8                  	rcr	ax, 1
  4674 0000207D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4675 00002080 66AB                    	stosw 		; interpolated sample 3 (R)
  4676 00002082 5B                      	pop	ebx ; **
  4677 00002083 58                      	pop	eax ; *
  4678 00002084 660305[60210000]        	add	ax, [next_val_l]
  4679 0000208B 66D1D8                  	rcr	ax, 1
  4680 0000208E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4681 00002091 66AB                    	stosw 		; interpolated sample 4 (L)
  4682 00002093 89D8                    	mov	eax, ebx
  4683 00002095 660305[62210000]        	add	ax, [next_val_r]
  4684 0000209C 66D1D8                  	rcr	ax, 1
  4685 0000209F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4686 000020A2 66AB                    	stosw 		; interpolated sample 4 (R)
  4687 000020A4 59                      	pop	ecx ; !
  4688 000020A5 C3                      	retn
  4689                                  
  4690                                  interpolating_4_16bit_mono:
  4691                                  	; 18/11/2023
  4692                                  	; ax = [previous_val]
  4693                                  	; dx = [next_val]
  4694                                  	; original-interpolated
  4695                                  
  4696 000020A6 66AB                    	stosw		; original sample (L)
  4697 000020A8 66AB                    	stosw		; original sample (R)
  4698 000020AA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4699 000020AD 89C3                    	mov	ebx, eax ; [previous_val]
  4700 000020AF 80C680                  	add	dh, 80h
  4701 000020B2 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4702 000020B5 66D1D8                  	rcr	ax, 1
  4703 000020B8 93                      	xchg	eax, ebx
  4704 000020B9 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4705 000020BC 66D1D8                  	rcr	ax, 1
  4706 000020BF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4707 000020C2 66AB                    	stosw 		; interpolated sample 1 (L)
  4708 000020C4 66AB                    	stosw		; interpolated sample 1 (R)
  4709 000020C6 89D8                    	mov	eax, ebx ; interpolated middle
  4710 000020C8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4711 000020CB 66AB                    	stosw 		; interpolated sample 2 (L)
  4712 000020CD 66AB                    	stosw		; interpolated sample 2 (R)
  4713 000020CF 89D8                    	mov	eax, ebx
  4714 000020D1 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4715 000020D4 66D1D8                  	rcr	ax, 1
  4716 000020D7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4717 000020DA 66AB                    	stosw		; interpolated sample 3 (L)
  4718 000020DC 66AB                    	stosw		; interpolated sample 3 (R)
  4719 000020DE C3                      	retn
  4720                                  
  4721                                  interpolating_4_16bit_stereo:
  4722                                  	; 18/11/2023
  4723                                  	; bx = [previous_val_l]
  4724                                  	; ax = [previous_val_r]
  4725                                  	; [next_val_l]
  4726                                  	; [next_val_r]
  4727                                  	; original-interpolated-interpolated-interpolated
  4728 000020DF 93                      	xchg	eax, ebx
  4729 000020E0 66AB                    	stosw		; original sample (L)
  4730 000020E2 93                      	xchg	eax, ebx
  4731 000020E3 66AB                    	stosw		; original sample (R)
  4732 000020E5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4733 000020E8 89C2                    	mov	edx, eax ; [previous_val_r]
  4734 000020EA 80C780                  	add	bh, 80h
  4735 000020ED 8005[61210000]80        	add	byte [next_val_l+1], 80h
  4736 000020F4 66A1[60210000]          	mov	ax, [next_val_l]
  4737 000020FA 6601D8                  	add	ax, bx	; [previous_val_l]
  4738 000020FD 66D1D8                  	rcr	ax, 1
  4739 00002100 93                      	xchg	eax, ebx
  4740 00002101 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4741 00002104 66D1D8                  	rcr	ax, 1
  4742 00002107 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4743 0000210A 66AB                    	stosw 		; interpolated sample 1 (L)
  4744 0000210C 8005[63210000]80        	add	byte [next_val_r+1], 80h
  4745 00002113 89D0                    	mov	eax, edx ; [previous_val_r]
  4746 00002115 660305[62210000]        	add	ax, [next_val_r]
  4747 0000211C 66D1D8                  	rcr	ax, 1
  4748 0000211F 92                      	xchg	eax, edx
  4749 00002120 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4750 00002123 66D1D8                  	rcr	ax, 1
  4751 00002126 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4752 00002129 66AB                    	stosw 		; interpolated sample 1 (R)
  4753 0000212B 89D8                    	mov	eax, ebx
  4754 0000212D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4755 00002130 66AB                    	stosw 		; interpolated sample 2 (L)
  4756 00002132 89D0                    	mov	eax, edx
  4757 00002134 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4758 00002137 66AB                    	stosw 		; interpolated sample 2 (R)
  4759 00002139 89D8                    	mov	eax, ebx
  4760 0000213B 660305[60210000]        	add	ax, [next_val_l]
  4761 00002142 66D1D8                  	rcr	ax, 1
  4762 00002145 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4763 00002148 66AB                    	stosw 		; interpolated sample 3 (L)
  4764 0000214A 89D0                    	mov	eax, edx
  4765 0000214C 660305[62210000]        	add	ax, [next_val_r]
  4766 00002153 66D1D8                  	rcr	ax, 1
  4767 00002156 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4768 00002159 66AB                    	stosw 		; interpolated sample 3 (R)
  4769 0000215B C3                      	retn
  4770                                  
  4771                                  ; 13/11/2023
  4772                                  previous_val:
  4773 0000215C 0000                    previous_val_l: dw 0
  4774 0000215E 0000                    previous_val_r: dw 0
  4775                                  next_val:
  4776 00002160 0000                    next_val_l: dw 0
  4777 00002162 0000                    next_val_r: dw 0
  4778                                  
  4779                                  ; 16/11/2023
  4780 00002164 00                      faz:	db 0
  4781                                  
  4782                                  ; --------------------------------------------------------
  4783                                  ; --------------------------------------------------------
  4784                                  
  4785                                  ; 07/12/2024
  4786                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  4787                                  ;		'sysaudio' system call (23/08/2024)
  4788                                  ; 18/11/2024
  4789                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  4790                                  
  4791                                  ac97_stop: 
  4792                                  	; 18/11/2024
  4793 00002165 C605[F87C0000]02        	mov	byte [stopped], 2
  4794                                  	; 07/12/2024
  4795                                  	sys	_audio, 0700h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000216C BB00070000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00002171 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 00002176 CD40                <1>  int 40h
  4796 00002178 C3                      	retn
  4797                                  
  4798                                  ac97_pause:
  4799                                  	; 18/11/2024
  4800 00002179 C605[F87C0000]01        	mov	byte [stopped], 1 ; paused
  4801                                  	; 07/12/2024
  4802                                  	sys	_audio, 0500h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00002180 BB00050000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00002185 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 0000218A CD40                <1>  int 40h
  4803 0000218C C3                      	retn
  4804                                  
  4805                                  ac97_play: ; continue to play (after pause)
  4806                                  	; 18/11/2024
  4807 0000218D C605[F87C0000]00        	mov	byte [stopped], 0
  4808                                  	; 07/12/2024	
  4809                                  	sys	_audio, 0600h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00002194 BB00060000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00002199 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 0000219E CD40                <1>  int 40h
  4810 000021A0 C3                      	retn
  4811                                  	
  4812                                  ; --------------------------------------------------------
  4813                                  ; 14/11/2024 - Erdogan Tan
  4814                                  ; --------------------------------------------------------
  4815                                  
  4816                                  	; 07/12/2024
  4817                                  	; 01/12/2024 (32bit registers)
  4818                                  	; 29/11/2024
  4819                                  checkUpdateEvents:
  4820 000021A1 E8BC010000              	call	check4keyboardstop
  4821 000021A6 7279                    	jc	short c4ue_ok
  4822                                  
  4823                                  	; 18/11/2024
  4824 000021A8 50                      	push	eax ; *
  4825 000021A9 09C0                    	or	eax, eax
  4826 000021AB 0F84F2000000            	jz	c4ue_cpt
  4827                                  
  4828                                  	; 18/11/2024
  4829 000021B1 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  4830 000021B3 7543                    	jne	short c4ue_chk_s
  4831 000021B5 803D[F87C0000]00        	cmp	byte [stopped], 0
  4832 000021BC 7714                    	ja	short c4ue_chk_ps
  4833                                  	; pause
  4834 000021BE E8B6FFFFFF              	call	ac97_pause
  4835                                  	; 21/11/2024
  4836 000021C3 A0[F97C0000]            	mov	al, [tLO]
  4837 000021C8 A2[FA7C0000]            	mov	byte [tLP], al
  4838 000021CD E9D1000000              	jmp	c4ue_cpt
  4839                                  c4ue_chk_ps:
  4840 000021D2 803D[F87C0000]01        	cmp	byte [stopped], 1
  4841 000021D9 770A                    	ja	short c4ue_replay
  4842                                  	; continue to play (after a pause)
  4843 000021DB E8ADFFFFFF              	call	ac97_play 
  4844 000021E0 E9BE000000              	jmp	c4ue_cpt
  4845                                  c4ue_replay:
  4846                                  	; 19/11/2024
  4847 000021E5 58                      	pop	eax ; *
  4848 000021E6 58                      	pop	eax ; return address
  4849                                  	; 07/02/2024
  4850                                  	;mov	al, [volume]
  4851                                  	;call	SetmasterVolume
  4852 000021E7 C605[F87C0000]00        	mov	byte [stopped], 0
  4853 000021EE E87D040000              	call	move_to_beginning
  4854                                  	;jmp	PlayWav
  4855                                  	; 07/12/2024
  4856 000021F3 E9F9E3FFFF              	jmp	RePlayWav
  4857                                  
  4858                                  c4ue_chk_s:
  4859 000021F8 3C53                    	cmp	al, 'S'	; stop
  4860 000021FA 7526                    	jne	short c4ue_chk_fb
  4861 000021FC 803D[F87C0000]00        	cmp	byte [stopped], 0
  4862 00002203 0F879A000000            	ja	c4ue_cpt ; Already stopped/paused
  4863 00002209 E857FFFFFF              	call	ac97_stop
  4864                                  	; 19/11/2024
  4865 0000220E C605[F97C0000]00        	mov	byte [tLO], 0
  4866                                  	; 21/11/2024
  4867 00002215 C605[FA7C0000]30        	mov	byte [tLP], '0'
  4868 0000221C E982000000              	jmp	c4ue_cpt
  4869                                  
  4870                                  	; 01/12/2024
  4871                                  	; 18/11/2024
  4872                                  c4ue_ok:
  4873 00002221 C3                      	retn
  4874                                  
  4875                                  c4ue_chk_fb:
  4876                                  	; 17/11/2024
  4877 00002222 3C46                    	cmp	al, 'F'
  4878 00002224 7507                    	jne	short c4ue_chk_b
  4879 00002226 E81D040000              	call 	Player_ProcessKey_Forwards
  4880 0000222B EB76                    	jmp	short c4ue_cpt
  4881                                  
  4882                                  c4ue_chk_b:
  4883 0000222D 3C42                    	cmp	al, 'B'
  4884                                  	;;jne	short c4ue_cpt
  4885                                  	; 19/11/2024
  4886 0000222F 7507                    	jne	short c4ue_chk_h
  4887 00002231 E80E040000              	call 	Player_ProcessKey_Backwards
  4888 00002236 EB6B                    	jmp	short c4ue_cpt
  4889                                  
  4890                                  c4ue_chk_h:
  4891                                  	; 19/11/2024
  4892 00002238 3C48                    	cmp	al, 'H'
  4893 0000223A 7515                    	jne	short c4ue_chk_cr
  4894 0000223C C605[FB7C0000]00        	mov	byte [wleds], 0
  4895 00002243 E8A9E6FFFF              	call 	write_ac97_pci_dev_info
  4896                                  	;;;
  4897                                  	;24/12/2024 (wave lighting points option)
  4898 00002248 C605[077D0000]01        	mov	byte [p_mode], 1
  4899                                  	;;;
  4900                                  	;mov	dh, 24
  4901                                  	;mov	dl, 79
  4902                                  	;call	setCursorPosition
  4903                                  	; 21/12/2024
  4904 0000224F EB52                    	jmp	short c4ue_cpt
  4905                                  c4ue_chk_cr:
  4906                                  	;;;
  4907                                  	; 24/12/2024 (wave lighting points option)
  4908 00002251 8A25[FB7C0000]          	mov	ah, [wleds]
  4909 00002257 3C47                    	cmp	al, 'G'
  4910 00002259 7432                    	je	short c4ue_g
  4911                                  	;;;
  4912                                  	; 19/11/2024
  4913 0000225B 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  4914 0000225D 7544                    	jne	short c4ue_cpt
  4915                                  	;inc	byte [wleds]
  4916                                  	;jnz	short c4ue_cpt
  4917                                  	;inc	byte [wleds]
  4918                                  	;;;
  4919                                  	; 24/12/2024
  4920                                  	; 22/12/2024 (faster method)
  4921                                  	; (UpdateWaveLeds procedure turns off previously
  4922                                  	;  lighting wave leds only)
  4923                                  	;call	reset_wave_leds ; prepare all leds as turned off
  4924                                  	;;;
  4925                                  	; 23/11/2024
  4926 0000225F 31DB                    	xor	ebx, ebx
  4927                                  	; 24/12/2024 (wave lighting points option)
  4928 00002261 881D[077D0000]          	mov	[p_mode], bl ; 0
  4929                                  	;
  4930                                  	;mov	bl, [wleds]
  4931 00002267 88E3                    	mov	bl, ah ; 24/12/2024
  4932 00002269 FEC3                    	inc	bl
  4933 0000226B 80E30F                  	and	bl, 0Fh
  4934 0000226E 7501                    	jnz	short c4ue_sc
  4935 00002270 43                      	inc	ebx
  4936                                  c4ue_sc:
  4937 00002271 881D[FB7C0000]          	mov	[wleds], bl
  4938 00002277 D0EB                    	shr	bl, 1
  4939 00002279 8A83[953F0000]          	mov	al, [ebx+colors]
  4940                                  	; 24/12/2024
  4941 0000227F A2[9D3F0000]            	mov	[ccolor], al
  4942 00002284 7211                    	jc	short c4ue_g_@
  4943                                  	; 24/12/2024
  4944 00002286 E82F040000              	call	reset_wave_leds ; prepare all leds as turned off
  4945 0000228B EB16                    	jmp	short c4ue_cpt
  4946                                  	; 24/12/2024
  4947                                  c4ue_g:
  4948 0000228D 08E4                    	or	ah, ah	; byte [wleds]
  4949 0000228F 7506                    	jnz	short c4ue_g_@
  4950 00002291 FE05[FB7C0000]          	inc	byte [wleds]	; force wave lighting ('G' key)
  4951                                  c4ue_g_@:
  4952                                  	; 24/12/2024 (wave lighting points option)
  4953 00002297 C605[077D0000]01        	mov	byte [p_mode], 1
  4954 0000229E E8FC030000              	call	clear_window
  4955                                  	;;;
  4956                                  c4ue_cpt:
  4957                                  	; 24/12/2024
  4958                                  	; 18/11/2024
  4959 000022A3 59                      	pop	ecx ; *
  4960                                  	;;;
  4961                                  	; 24/12/2024 (skip wave lighting if data is not loaded yet)
  4962 000022A4 803D[8F7D0000]00        	cmp	byte [SRB], 0
  4963 000022AB 7751                    	ja	short c4ue_vb_ok
  4964                                  	;;;
  4965                                  	; 01/12/2024 (TRDOS 386)
  4966                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second),
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000022AD BB04000000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000022B2 B80D000000          <1>  mov eax, %1
    99                              <1> 
   100 000022B7 CD40                <1>  int 40h
  4967                                  	; 24/12/2024
  4968                                  	; 18/11/2024
  4969                                  	;pop	ecx ; *
  4970                                  	; 01/12/2024
  4971 000022B9 3B05[B87D0000]          	cmp	eax, [timerticks]
  4972                                  	;je	short c4ue_ok
  4973                                  	; 18/11/2024
  4974 000022BF 7407                    	je	short c4ue_skip_utt
  4975                                  c4ue_utt:	
  4976                                  	; 01/12/2024
  4977 000022C1 A3[B87D0000]            	mov	[timerticks], eax
  4978 000022C6 EB04                    	jmp	short c4ue_cpt_@
  4979                                  c4ue_skip_utt:
  4980                                  	; 18/11/2024
  4981 000022C8 21C9                    	and	ecx, ecx
  4982 000022CA 7432                    	jz	short c4ue_vb_ok
  4983                                  c4ue_cpt_@:
  4984                                  	; 18/11/2024
  4985 000022CC 803D[F87C0000]00        	cmp	byte [stopped], 0
  4986 000022D3 7729                    	ja	short c4ue_vb_ok
  4987                                  	
  4988 000022D5 E8AD010000              	call	CalcProgressTime
  4989                                  
  4990                                  	;cmp	ax, [ProgressTime]
  4991                                  	; 01/12/2024
  4992 000022DA 3B05[AC7D0000]          	cmp	eax, [ProgressTime]
  4993                                  	;je	short c4ue_vb_ok
  4994                                  			; same second, no need to update
  4995                                  	; 23/11/2024
  4996 000022E0 7405                    	je	short c4ue_uvb
  4997                                  
  4998                                  	;call	UpdateProgressTime
  4999                                  	;call	UpdateProgressBar@
  5000 000022E2 E8D1020000              	call	UpdateProgressBar
  5001                                  
  5002                                  	; 23/11/2024
  5003                                  c4ue_uvb:
  5004 000022E7 803D[FB7C0000]00        	cmp	byte [wleds], 0
  5005 000022EE 760E                    	jna	short c4ue_vb_ok
  5006                                  
  5007                                  	; 24/12/2024 (wave points mode)
  5008 000022F0 803D[077D0000]00        	cmp	byte [p_mode], 0
  5009 000022F7 7706                    	ja	short c4ue_uwp
  5010                                  
  5011 000022F9 E806040000              	call	UpdateWaveLeds
  5012                                  
  5013                                  c4ue_vb_ok:
  5014 000022FE C3                      	retn
  5015                                  
  5016                                  	; 22/12/2024
  5017                                  c4ue_uwp:
  5018                                  	;call	UpdateWavePoints
  5019                                  	;retn
  5020                                  
  5021                                  ; --------------------------------------------------------
  5022                                  ; 24/12/2024 - Erdogan Tan
  5023                                  ; --------------------------------------------------------
  5024                                  
  5025                                  	; 28/12/2024 (dplayw2.s)
  5026                                  	; 27/12/2024 (DMA Buffer Tracking) (vgaplay2.s)
  5027                                  	; 26/12/2024
  5028                                  	; 24/12/2024
  5029                                  UpdateWavePoints:
  5030 000022FF BE[F8720000]            	mov	esi, prev_points
  5031 00002304 833E00                  	cmp	dword [esi], 0
  5032 00002307 740B                    	jz	short lights_off_ok
  5033 00002309 B980020000              	mov	ecx, 640
  5034                                  light_off:
  5035 0000230E AD                      	lodsd
  5036                                  	; eax = wave point (lighting point) address
  5037 0000230F C60000                  	mov	byte [eax], 0 ; black point (light off)
  5038 00002312 E2FA                    	loop	light_off
  5039                                  
  5040                                  lights_off_ok:
  5041                                  	; 27/12/2024
  5042                                  	; ref: modplay8.s (02/06/2024)
  5043                                  	; ----------------------------
  5044                                  	; Get Current Sound Data (in DMA buffer) ((320 bytes))
  5045                                  	; 23/06/2017
  5046                                  	; 22/06/2017
  5047                                  	; bh = 15, get current sound data/samples
  5048                                  	; bl = 0, for PCM OUT
  5049                                  	; ecx = count of sample/data bytes (1 to 4096)
  5050                                  	; edx = destination buffer address
  5051                                  	;	(page aligned address is better)
  5052                                  
  5053 00002314 BE[00800200]            	mov	esi, g_buff
  5054                                  
  5055                                  	sys	_audio, 0F00h, 640*4, esi ; 27/12/2024
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00002319 BB000F0000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 0000231E B9000A0000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00002323 89F2                <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00002325 B820000000          <1>  mov eax, %1
    99                              <1> 
   100 0000232A CD40                <1>  int 40h
  5056                                  	;jnc	short lgbuff_ok
  5057                                  	; clear g_buff content
  5058                                  	;mov	edi, esi
  5059                                  	;sub	eax, eax
  5060                                  	;shr	ecx, 2
  5061                                  	;rep	stosd
  5062                                  	;mov	ecx, 640
  5063                                  ;lgbuff_ok:
  5064                                  
  5065 0000232C B980020000              	mov	ecx, 640
  5066 00002331 89CD                    	mov	ebp, ecx
  5067                                  	; 26/12/2024
  5068 00002333 BF[F8720000]            	mov	edi, prev_points
  5069 00002338 8B1D[E4720000]          	mov	ebx, [graphstart] ; start (top) line
  5070                                  lights_on_4:
  5071 0000233E 31C0                    	xor	eax, eax ; 0
  5072 00002340 66AD                    	lodsw	; left
  5073 00002342 80C480                  	add	ah, 80h
  5074 00002345 89C2                    	mov	edx, eax
  5075 00002347 66AD                    	lodsw	; right
  5076                                  	;add	ax, dx
  5077 00002349 80C480                  	add	ah, 80h
  5078                                  	;shr	eax, 9	; 128 volume levels
  5079 0000234C 01D0                    	add	eax, edx
  5080                                  	;shr	eax, 10	; (L+R/2) & 128 volume levels
  5081 0000234E C1E809                  	shr	eax, 9	; (L+R/2) & 256 volume levels
  5082 00002351 F7E5                    	mul	ebp	; * 640 (row)
  5083 00002353 01D8                    	add	eax, ebx ; + column
  5084 00002355 8A15[9D3F0000]          	mov	dl, [ccolor]
  5085 0000235B 8810                    	mov	[eax], dl ; pixel (light on) color
  5086 0000235D AB                      	stosd		; save light on addr in prev_points
  5087 0000235E 43                      	inc	ebx
  5088 0000235F E2DD                    	loop	lights_on_4
  5089 00002361 C3                      	retn
  5090                                  
  5091                                  ; --------------------------------------------------------
  5092                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  5093                                  ; --------------------------------------------------------
  5094                                  
  5095                                  	; 07/12/2024
  5096                                  	; 01/12/2024 (TRDOS 386)
  5097                                  	; 29/11/2024
  5098                                  check4keyboardstop:
  5099                                  	; 19/05/2024
  5100                                  	; 08/11/2023
  5101                                  	; 04/11/2023
  5102 00002362 B401                    	mov	ah, 1
  5103                                  	;int	16h
  5104                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5105 00002364 CD32                    	int	32h
  5106                                  	;clc
  5107 00002366 7433                    	jz	short _cksr
  5108                                  
  5109 00002368 30E4                    	xor	ah, ah
  5110                                  	;int	16h
  5111                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5112 0000236A CD32                    	int	32h
  5113                                  
  5114                                  	;;;
  5115                                  	; 19/05/2024 (change PCM out volume)
  5116 0000236C 3C2B                    	cmp	al, '+'
  5117 0000236E 750D                    	jne	short p_1
  5118                                  	
  5119 00002370 A0[B9230000]            	mov	al, [volume]
  5120 00002375 3C00                    	cmp	al, 0
  5121 00002377 7624                    	jna	short p_3
  5122 00002379 FEC8                    	dec	al
  5123 0000237B EB0F                    	jmp	short p_2
  5124                                  p_1:
  5125 0000237D 3C2D                    	cmp	al, '-'
  5126 0000237F 751D                    	jne	short p_4
  5127                                  
  5128 00002381 A0[B9230000]            	mov	al, [volume]
  5129 00002386 3C1F                    	cmp	al, 31
  5130 00002388 7313                    	jnb	short p_3
  5131 0000238A FEC0                    	inc	al
  5132                                  p_2:
  5133 0000238C A2[B9230000]            	mov	[volume], al
  5134                                  	; 14/11/2024
  5135                                  	;call	SetPCMOutVolume
  5136                                  	; 15/11/2024 (QEMU)
  5137                                  	; 07/12/2024
  5138 00002391 E88BE3FFFF              	call	SetMasterVolume
  5139                                  	;call	UpdateVolume
  5140                                  	;;clc
  5141                                  	;retn
  5142 00002396 E98D010000              	jmp	UpdateVolume
  5143                                  	;mov	ah, al
  5144                                  	;mov    dx, [NAMBAR]
  5145                                    	;;add   dx, CODEC_MASTER_VOL_REG
  5146                                  	;add	dx, CODEC_PCM_OUT_REG
  5147                                  	;out    dx, ax
  5148                                  	;
  5149                                  	;call   delay1_4ms
  5150                                          ;call   delay1_4ms
  5151                                          ;call   delay1_4ms
  5152                                          ;call   delay1_4ms
  5153                                  _cksr:		; 19/05/2024
  5154                                  	; 18/12/2024
  5155 0000239B 31C0                    	xor	eax, eax
  5156                                  	;clc
  5157                                  p_3:
  5158 0000239D C3                      	retn
  5159                                  p_4:
  5160                                  	; 17/11/2024
  5161 0000239E 80FC01                  	cmp	ah, 01h  ; ESC
  5162 000023A1 7414                        	je	short p_q
  5163                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5164 000023A3 3C03                    	cmp	al, 03h  ; CTRL+C
  5165 000023A5 7410                    	je	short p_q
  5166                                  
  5167                                  	; 18/11/2024
  5168 000023A7 3C20                    	cmp	al, 20h
  5169 000023A9 740D                    	je	short p_r
  5170                                  
  5171                                  	; 19/11/2024
  5172 000023AB 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5173 000023AD 7409                    	je	short p_r
  5174                                  
  5175 000023AF 24DF                    	and	al, 0DFh
  5176                                  
  5177                                  	;cmp	al, 'B'
  5178                                  	;je	short p_r
  5179                                  	;cmp	al, 'F'
  5180                                  	;je	short p_r
  5181                                  
  5182 000023B1 3C51                    	cmp	al, 'Q'
  5183                                  	;je	short p_q
  5184 000023B3 7402                    	je	short p_quit ; 29/11/2024
  5185                                  
  5186 000023B5 F8                      	clc
  5187 000023B6 C3                      	retn
  5188                                  
  5189                                  	;;;
  5190                                  ;_cskr:	
  5191                                  p_q:
  5192                                  p_quit:
  5193 000023B7 F9                      	stc
  5194                                  p_r:
  5195 000023B8 C3                      	retn
  5196                                  
  5197                                  ; 29/05/2024
  5198                                  ; 19/05/2024
  5199 000023B9 02                      volume: db	02h
  5200                                  
  5201                                  ; --------------------------------------------------------
  5202                                  
  5203                                  	; 22/12/2024
  5204                                  	; 21/12/2024
  5205                                  	; simulate cursor position in VGA (VESA VBE) mode
  5206                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5207                                  setCursorPosition:
  5208                                  	; dh = Row
  5209                                  	; dl = Column
  5210                                  	
  5211 000023BA 31C0                    	xor	eax, eax
  5212 000023BC B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5213 000023BE F6E6                    	mul	dh
  5214 000023C0 6683C007                	add	ax, 7	; top margin
  5215 000023C4 C1E010                  	shl	eax, 16
  5216 000023C7 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5217 000023C9 66C1E003                	shl	ax, 3
  5218                                  			; hw = row, ax = column
  5219 000023CD A3[EC720000]            	mov	[screenpos], eax
  5220                                  	; 22/12/2024
  5221 000023D2 31C0                    	xor	eax, eax
  5222 000023D4 C3                      	retn
  5223                                  	
  5224                                  ; --------------------------------------------------------
  5225                                  ; 14/11/2024
  5226                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5227                                  
  5228                                  ;; NAME:	SetTotalTime
  5229                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5230                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5231                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5232                                  ;; 		Output on the screen of the total time in seconds
  5233                                  
  5234                                  	; 01/12/2024 (32 bit registers)
  5235                                  SetTotalTime:
  5236                                  	;; Calculate total seconds in file
  5237                                  	;mov	ax, [DATA_SubchunkSize]
  5238                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5239                                  	;mov	bx, [WAVE_SampleRate]
  5240                                  	;div	bx
  5241                                  	;xor	dx, dx
  5242                                  	; 01/12/2024
  5243 000023D5 A1[307D0000]            	mov	eax, [DATA_SubchunkSize]
  5244 000023DA 0FB71D[207D0000]        	movzx	ebx, word [WAVE_SampleRate]
  5245 000023E1 31D2                    	xor	edx, edx
  5246 000023E3 F7F3                    	div	ebx
  5247                                  
  5248                                  	;mov	bx, [WAVE_BlockAlign]
  5249                                  	;div	bx
  5250                                  	; 01/12/2024
  5251 000023E5 668B1D[287D0000]        	mov	bx, [WAVE_BlockAlign]
  5252 000023EC 31D2                    	xor	edx, edx
  5253 000023EE F7F3                    	div	ebx
  5254                                  
  5255                                  	;mov	[TotalTime], ax
  5256 000023F0 A3[A87D0000]            	mov	[TotalTime], eax
  5257                                  
  5258 000023F5 B33C                    	mov	bl, 60
  5259 000023F7 F6F3                    	div	bl
  5260                                  
  5261                                  	;; al = minutes, ah = seconds
  5262 000023F9 50                      	push	eax ; **
  5263 000023FA 50                      	push	eax ; *
  5264                                  
  5265                                  	;mov	dh, 24
  5266                                  	; 21/12/2024 (640*480)
  5267 000023FB B620                    	mov	dh, 32
  5268 000023FD B22A                    	mov	dl, 42
  5269 000023FF E8B6FFFFFF              	call	setCursorPosition
  5270                                  
  5271 00002404 58                      	pop	eax ; *
  5272 00002405 30E4                    	xor	ah, ah
  5273 00002407 BD02000000              	mov	ebp, 2
  5274 0000240C E812000000              	call	PrintNumber
  5275                                  	
  5276                                  	;mov	dh, 24
  5277                                  	; 21/12/2024 (640*480)
  5278 00002411 B620                    	mov	dh, 32
  5279 00002413 B22D                    	mov	dl, 45
  5280 00002415 E8A0FFFFFF              	call	setCursorPosition
  5281                                  
  5282 0000241A 58                      	pop	eax ; **
  5283 0000241B 88E0                    	mov	al, ah
  5284 0000241D 30E4                    	xor	ah, ah
  5285                                  	; 21/12/2024
  5286 0000241F 66BD0200                	mov	bp, 2
  5287                                  	;jmp	short PrintNumber
  5288                                  
  5289                                  ; --------------------------------------------------------
  5290                                  
  5291                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5292                                  	; 01/12/2024 (32bit registers)
  5293                                  PrintNumber:
  5294                                  	; eax = binary number
  5295                                  	; ebp = digits
  5296 00002423 8B35[EC720000]          	mov	esi, [screenpos]
  5297                                  		; hw = row, si = column
  5298 00002429 BB0A000000              	mov	ebx, 10
  5299 0000242E 31C9                    	xor	ecx, ecx
  5300                                  printNumber_CutNumber:
  5301 00002430 41                      	inc	ecx
  5302 00002431 31D2                    	xor	edx, edx
  5303 00002433 F7F3                    	div	ebx
  5304 00002435 52                      	push	edx
  5305 00002436 39E9                    	cmp	ecx, ebp
  5306 00002438 7402                    	je	short printNumber_printloop
  5307 0000243A EBF4                    	jmp	printNumber_CutNumber
  5308                                  
  5309                                  printNumber_printloop:
  5310 0000243C 58                      	pop	eax
  5311                                  	; 21/12/2024
  5312                                  	; ebp = count of digits
  5313                                  	; eax <= 9
  5314                                  
  5315 0000243D 0430                    	add	al, '0'
  5316                                  	
  5317                                  	; esi = pixel position (hw = row, si = column)
  5318                                  	; eax = al = character
  5319                                  	;call	write_character
  5320                                  	; 22/12/2024
  5321 0000243F E82A010000              	call	write_character_white
  5322                                  
  5323 00002444 4D                      	dec	ebp
  5324 00002445 7405                     	jz	short printNumber_ok
  5325 00002447 83C608                  	add	esi, 8	; next column
  5326 0000244A EBF0                    	jmp	short printNumber_printloop
  5327                                  printNumber_ok:
  5328 0000244C C3                      	retn
  5329                                  
  5330                                  ; --------------------------------------------------------
  5331                                  
  5332                                  	; 14/11/2024 - Erdogan Tan
  5333                                  SetProgressTime:
  5334                                  	;; Calculate playing/progress seconds in file
  5335 0000244D E835000000              	call	CalcProgressTime
  5336                                  
  5337                                  	; 01/12/2024 (32bit registers)
  5338                                  UpdateProgressTime:
  5339                                  	; eax = (new) progress time 
  5340                                  
  5341 00002452 A3[AC7D0000]            	mov	[ProgressTime], eax
  5342                                  
  5343 00002457 B33C                    	mov	bl, 60
  5344 00002459 F6F3                    	div	bl
  5345                                  
  5346                                  	;; al = minutes, ah = seconds
  5347 0000245B 50                      	push	eax ; **
  5348 0000245C 50                      	push	eax ; *
  5349                                  
  5350                                  	;mov	dh, 24
  5351                                  	; 21/12/2024 (640*480)
  5352 0000245D B620                    	mov	dh, 32
  5353 0000245F B221                    	mov	dl, 33
  5354 00002461 E854FFFFFF              	call	setCursorPosition
  5355                                  
  5356 00002466 58                      	pop	eax ; *
  5357 00002467 30E4                    	xor	ah, ah
  5358 00002469 BD02000000              	mov	ebp, 2
  5359 0000246E E8B0FFFFFF              	call	PrintNumber
  5360                                  	
  5361                                  	;mov	dh, 24
  5362                                  	; 21/12/2024 (640*480)
  5363 00002473 B620                    	mov	dh, 32
  5364 00002475 B224                    	mov	dl, 36
  5365 00002477 E83EFFFFFF              	call	setCursorPosition
  5366                                  
  5367 0000247C 58                      	pop	eax ; **
  5368 0000247D 88E0                    	mov	al, ah
  5369 0000247F 30E4                    	xor	ah, ah
  5370                                  	; 21/12/2024
  5371 00002481 66BD0200                	mov	bp, 2
  5372 00002485 EB9C                    	jmp	short PrintNumber
  5373                                  
  5374                                  ; --------------------------------------------------------
  5375                                  
  5376                                  	; 01/12/2024 (32bit registers)
  5377                                  	; 17/11/2024
  5378                                  	; 14/11/2024
  5379                                  CalcProgressTime:
  5380                                  	;mov	ax, [LoadedDataBytes]
  5381                                  	;mov	dx, [LoadedDataBytes+2]
  5382                                  	;mov	bx, ax
  5383                                  	;or	bx, dx
  5384                                  	;jz	short cpt_ok
  5385                                  	; 01/12/2024
  5386 00002487 A1[B47D0000]            	mov	eax, [LoadedDataBytes]
  5387 0000248C 09C0                    	or	eax, eax
  5388 0000248E 7416                    	jz	short cpt_ok
  5389                                  
  5390                                  	;mov	bx, [WAVE_SampleRate]
  5391                                  	;div	bx
  5392                                  	;xor	dx, dx
  5393                                  	;mov	bx, [WAVE_BlockAlign]
  5394                                  	;div	bx
  5395                                  	; 01/12/2024
  5396 00002490 0FB71D[207D0000]        	movzx	ebx, word [WAVE_SampleRate]
  5397 00002497 31D2                    	xor	edx, edx
  5398 00002499 F7F3                    	div	ebx
  5399 0000249B 31D2                    	xor	edx, edx
  5400 0000249D 668B1D[287D0000]        	mov	bx, [WAVE_BlockAlign]
  5401 000024A4 F7F3                    	div	ebx
  5402                                  cpt_ok:
  5403                                  	; eax = (new) progress time
  5404 000024A6 C3                      	retn
  5405                                  
  5406                                  ; --------------------------------------------------------
  5407                                  ; 14/11/2024
  5408                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5409                                  
  5410                                  ;; DESCRIPTION: Update file information on template
  5411                                  ;; PARAMS:	WAVE parameters and other variables
  5412                                  ;; REGS:	AX(RW)
  5413                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5414                                  ;; RETURNS:	On-screen file info is updated.
  5415                                  
  5416                                  	; 01/12/2024 (32bit registers)
  5417                                  UpdateFileInfo:
  5418                                  	;; Print File Name
  5419                                  	;mov	dh, 9
  5420                                  	; 21/12/2024 (640*480 graphics display)
  5421 000024A7 B608                    	mov	dh, 8
  5422 000024A9 B217                    	mov	dl, 23
  5423 000024AB E80AFFFFFF              	call	setCursorPosition
  5424                                  	
  5425 000024B0 BE[3C7D0000]            	mov	esi, wav_file_name
  5426                                  	
  5427                                  	;;;
  5428                                  	; 14/11/2024
  5429                                  	; skip directory separators
  5430                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5431 000024B5 89F3                    	mov	ebx, esi
  5432                                  chk4_nxt_sep:
  5433 000024B7 AC                      	lodsb
  5434 000024B8 3C2F                    	cmp	al, '/'	; 14/12/2024
  5435 000024BA 7406                    	je	short chg_fpos
  5436 000024BC 20C0                    	and	al, al
  5437 000024BE 7406                    	jz	short chg_fpos_ok
  5438 000024C0 EBF5                    	jmp	short chk4_nxt_sep
  5439                                  chg_fpos:
  5440 000024C2 89F3                    	mov	ebx, esi
  5441 000024C4 EBF1                    	jmp	short chk4_nxt_sep
  5442                                  chg_fpos_ok:
  5443 000024C6 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5444                                  
  5445                                  	;;;
  5446                                  _fnl_chk:
  5447                                  	; 26/12/2024 (file name length limit -display-)
  5448                                  	;mov	ebx, 12
  5449 000024C8 BB11000000              	mov	ebx, 17 ; ????????.wav?????
  5450 000024CD 56                      	push	esi
  5451                                  _fnl_chk_loop:
  5452 000024CE AC                      	lodsb
  5453 000024CF 20C0                    	and	al, al
  5454 000024D1 7406                    	jz	short _fnl_ok
  5455 000024D3 4B                       	dec	ebx
  5456 000024D4 75F8                    	jnz	short _fnl_chk_loop
  5457 000024D6 C60600                  	mov	byte [esi], 0
  5458                                  _fnl_ok:
  5459 000024D9 5E                      	pop	esi
  5460                                  	;;;
  5461                                  
  5462 000024DA E870000000              	call	PrintString
  5463                                  	
  5464                                  	;; Print Frequency
  5465                                  	;mov	dh, 10
  5466                                  	; 21/12/2024 (640*480 graphics display)
  5467 000024DF B609                    	mov	dh, 9
  5468 000024E1 B217                    	mov	dl, 23
  5469 000024E3 E8D2FEFFFF              	call	setCursorPosition
  5470                                  	;movzx	eax, word [WAVE_SampleRate]
  5471                                  	; 22/12/2024
  5472                                  	; eax = 0
  5473 000024E8 66A1[207D0000]          	mov	ax, [WAVE_SampleRate]
  5474 000024EE BD05000000              	mov	ebp, 5
  5475 000024F3 E82BFFFFFF              	call	PrintNumber
  5476                                  
  5477                                  	;; Print BitRate
  5478                                  	;mov	dh, 9
  5479                                  	; 21/12/2024 (640*480 graphics display)
  5480 000024F8 B608                    	mov	dh, 8
  5481 000024FA B239                    	mov	dl, 57
  5482 000024FC E8B9FEFFFF              	call	setCursorPosition
  5483 00002501 66A1[2A7D0000]          	mov	ax, [WAVE_BitsPerSample]
  5484 00002507 66BD0200                	mov	bp, 2
  5485 0000250B E813FFFFFF              	call	PrintNumber
  5486                                  
  5487                                  	;; Print Channel Number
  5488                                  	;mov	dh, 10
  5489                                  	; 21/12/2024 (640*480 graphics display)
  5490 00002510 B609                    	mov	dh, 9
  5491 00002512 B239                    	mov	dl, 57
  5492 00002514 E8A1FEFFFF              	call	setCursorPosition
  5493 00002519 66A1[1E7D0000]          	mov	ax, [WAVE_NumChannels]
  5494 0000251F 66BD0100                	mov	bp, 1
  5495 00002523 E8FBFEFFFF              	call	PrintNumber
  5496                                  
  5497                                  	;call	UpdateVolume
  5498                                  	;retn
  5499                                  
  5500                                  ; --------------------------------------------------------
  5501                                  
  5502                                  	; 14/11/2024
  5503                                  UpdateVolume:
  5504                                  	;; Print Volume
  5505                                  	;mov	dh, 24
  5506                                  	; 21/12/2024 (640*480)
  5507 00002528 B620                    	mov	dh, 32
  5508 0000252A B24B                    	mov	dl, 75
  5509 0000252C E889FEFFFF              	call	setCursorPosition
  5510                                  	; 22/12/2024
  5511                                  	; eax = 0
  5512                                  
  5513 00002531 A0[B9230000]            	mov	al, [volume]
  5514                                  
  5515 00002536 B364                    	mov	bl, 100
  5516 00002538 F6E3                    	mul	bl
  5517                                  
  5518 0000253A B31F                    	mov	bl, 31
  5519 0000253C F6F3                    	div	bl
  5520                                  
  5521                                  	;neg	ax
  5522                                  	;add	ax, 100	
  5523                                  	; 01/12/2024
  5524 0000253E B464                    	mov	ah, 100
  5525 00002540 28C4                    	sub	ah, al
  5526 00002542 0FB6C4                  	movzx	eax, ah
  5527                                  	;xor	ah, ah
  5528                                  	;mov	bp, 3
  5529 00002545 BD03000000              	mov	ebp, 3
  5530                                  	;call	PrintNumber
  5531                                  	;retn
  5532 0000254A E9D4FEFFFF              	jmp	PrintNumber	
  5533                                  
  5534                                  ; --------------------------------------------------------
  5535                                  
  5536                                  	; 21/12/2024
  5537                                  	; write text in VESA VBE graphics mode
  5538                                  PrintString:
  5539                                  	; esi = string address
  5540                                  printstr_loop:
  5541 0000254F 31C0                    	xor	eax, eax
  5542 00002551 AC                      	lodsb
  5543 00002552 08C0                    	or	al, al
  5544 00002554 7417                    	jz	short printstr_ok
  5545                                  
  5546 00002556 56                      	push	esi
  5547                                  
  5548 00002557 8B35[EC720000]          	mov	esi, [screenpos]
  5549                                  
  5550                                  	; esi = pixel position (hw = row, si = column)
  5551                                  	; eax = al = character
  5552                                  	;call	write_character
  5553                                  	; 22/12/2024
  5554 0000255D E80C000000              	call	write_character_white
  5555                                  
  5556 00002562 668305[EC720000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5557                                  
  5558 0000256A 5E                      	pop	esi
  5559 0000256B EBE2                    	jmp	short printstr_loop
  5560                                  
  5561                                  printstr_ok:
  5562 0000256D C3                      	retn
  5563                                  
  5564                                  ; --------------------------------------------------------
  5565                                  
  5566                                  	; 21/12/2024
  5567                                  	; write character (at cursor position)
  5568                                  	; in graphics mode (640*480, 256 colors)
  5569                                  	; 22/12/2024
  5570                                  write_character_white:
  5571 0000256E B90F000000              	mov	ecx, 0Fh
  5572                                  write_character:
  5573                                  	; esi = pixel position (hw = row, si = column)
  5574                                  	; eax = al = character
  5575                                  	; cl = color
  5576 00002573 890D[F0720000]          	mov	[wcolor], ecx ; 22/12/2024
  5577                                  
  5578                                  	; 22/12/2024
  5579 00002579 50                      	push	eax
  5580                                  	; clear previous character pixels
  5581 0000257A BF[853F0000]            	mov	edi, fillblock
  5582                                  	sys	_video, 020Fh, 0, 8001h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 0000257F BB0F020000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 00002584 B900000000          <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 00002589 BA01800000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 0000258E B81F000000          <1>  mov eax, %1
    99                              <1> 
   100 00002593 CD40                <1>  int 40h
  5583 00002595 58                      	pop	eax
  5584                                  
  5585 00002596 C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5586 00002599 BF[A04D0000]            	mov	edi, fontbuff2 ; start of user font data
  5587 0000259E 01C7                    	add	edi, eax
  5588                                  
  5589                                  	; 21/12/2024
  5590                                  	; NOTE:
  5591                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5592                                  	; system calls -in graphics mode-
  5593                                  	; because 8*16 pixel operations are faster
  5594                                  	;			than 8*14 pixel operations.
  5595                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5596                                  	; adding 2 empty lines))
  5597                                  	; (8*14 characters can be written via pixel operations)
  5598                                    	
  5599                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5600                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5601                                  	;sysvideo:
  5602                                  	;   function in BH
  5603                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5604                                  	;   sub function in BL
  5605                                  	;	0Fh: WRITE CHARACTER (FONT)
  5606                                  	;          CL = char's color (8 bit, 256 colors)
  5607                                  	;	If DH bit 7 = 1
  5608                                  	;	   USER FONT (from user buffer)
  5609                                  	;	         DL = 1 -> 8x16 pixel font
  5610                                   	;	   EDI = user's font buffer address
  5611                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5612                                  	;	   ESI = start position (row, column)
  5613                                  	;		(HW = row, SI = column)
  5614                                  	;;;;;;;;;;;;;;;;;
  5615                                  
  5616                                  	sys	_video, 020Fh, [wcolor], 8001h
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 000025A0 BB0F020000          <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92 000025A5 8B0D[F0720000]      <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94 000025AB BA01800000          <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 000025B0 B81F000000          <1>  mov eax, %1
    99                              <1> 
   100 000025B5 CD40                <1>  int 40h
  5617                                  
  5618 000025B7 C3                      	retn
  5619                                  
  5620                                  ; --------------------------------------------------------
  5621                                  
  5622                                  	; 22/12/2024
  5623                                  	; 21/12/2024
  5624                                  	; (write chars in VESA VBE graphics mode)
  5625                                  	; 14/11/2024
  5626                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5627                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5628                                  
  5629                                  	;PROGRESSBAR_ROW equ 23
  5630                                  	; 21/12/2024 (640*480)
  5631                                  	PROGRESSBAR_ROW equ 31
  5632                                  
  5633                                  UpdateProgressBar:
  5634 000025B8 E890FEFFFF              	call	SetProgressTime	; 14/11/2024
  5635                                  
  5636                                  	; 01/12/2024 (32bit registers)
  5637 000025BD A1[AC7D0000]            	mov	eax, [ProgressTime]
  5638                                  UpdateProgressBar@:
  5639 000025C2 BA50000000              	mov	edx, 80
  5640 000025C7 F7E2                    	mul	edx
  5641 000025C9 8B1D[A87D0000]          	mov	ebx, [TotalTime]
  5642 000025CF F7F3                    	div	ebx
  5643                                  
  5644                                  	; 22/12/2024
  5645                                  	; check progress bar indicator position if it is same 
  5646 000025D1 3A05[F5720000]          	cmp	al, [pbprev]
  5647 000025D7 7430                    	je	short UpdateProgressBar_ok
  5648 000025D9 A2[F5720000]            	mov	[pbprev], al
  5649                                  
  5650                                  UpdateProgressBar@@:
  5651                                  	;; Push for the 'Clean' part
  5652 000025DE 50                      	push	eax ; **
  5653 000025DF 50                      	push	eax ; *
  5654                                  
  5655                                  	;; Set cursor position
  5656 000025E0 B61F                    	mov	dh, PROGRESSBAR_ROW
  5657 000025E2 B200                    	mov	dl, 0
  5658 000025E4 E8D1FDFFFF              	call	setCursorPosition
  5659                                  
  5660 000025E9 58                      	pop	eax ; *
  5661 000025EA 09C0                    	or	eax, eax
  5662 000025EC 742D                    	jz	short UpdateProgressBar_Clean
  5663                                  
  5664                                  UpdateProgressBar_DrawProgress:
  5665                                  	; 22/12/2024
  5666                                  	; 21/12/2024
  5667                                  	; (write progress bar chars in graphics mode)
  5668                                  	;;;;
  5669 000025EE 89C5                    	mov	ebp, eax
  5670 000025F0 50                      	push	eax ; ***
  5671 000025F1 8B35[EC720000]          	mov	esi, [screenpos]
  5672                                  UpdateProgressBar_DrawProgress_@:
  5673 000025F7 B8DF000000              	mov	eax, 223
  5674                                  	
  5675                                  	; esi = pixel position (hw = row, si = column)
  5676                                  	; eax = al = character
  5677                                  	;call	write_character
  5678                                  	; 22/12/2024
  5679 000025FC E86DFFFFFF              	call	write_character_white
  5680                                  
  5681 00002601 4D                      	dec	ebp
  5682 00002602 7406                    	jz	short UpdateProgressBar_DrawCursor
  5683                                  
  5684 00002604 83C608                  	add	esi, 8 ; next column
  5685 00002607 EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5686                                  	;;;
  5687                                  
  5688                                  UpdateProgressBar_ok:
  5689 00002609 C3                      	retn
  5690                                  
  5691                                  UpdateProgressBar_DrawCursor:
  5692                                  	; 22/12/2024
  5693 0000260A 5A                      	pop	edx ; ***
  5694 0000260B B61F                    	mov	dh, PROGRESSBAR_ROW
  5695 0000260D E8A8FDFFFF              	call	setCursorPosition
  5696                                  
  5697                                  	; 21/12/2024
  5698                                  	; (write progress bar character in graphics mode)
  5699                                  	;;;;
  5700                                  	;;;mov	eax, 223
  5701                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5702                                  	;;mov	eax, 223*16
  5703                                  	;;mov	edi, fontbuff2 ; start of user font data
  5704                                  	;;add	edi, eax
  5705                                  	;mov	edi, fontbuff2+(223*16)
  5706                                  	;
  5707                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5708                                  	; 22/12/2024
  5709                                  	;mov	eax, 223
  5710                                  	; eax = 0
  5711 00002612 B0DF                    	mov	al, 223
  5712 00002614 B10C                    	mov	cl, 0Ch ; red
  5713 00002616 E858FFFFFF              	call	write_character
  5714                                  	;;;;
  5715                                  
  5716                                  UpdateProgressBar_Clean:
  5717                                  	;pop	eax  ; **
  5718                                  	; 22/12/2024
  5719 0000261B 5A                      	pop	edx  ; **
  5720                                  	; 21/12/2024
  5721 0000261C BD50000000              	mov	ebp, 80
  5722                                  	;sub	bp, ax
  5723 00002621 6629D5                  	sub	bp, dx ; 22/12/2024
  5724 00002624 74E3                    	jz	short UpdateProgressBar_ok
  5725                                  
  5726 00002626 B61F                    	mov	dh, PROGRESSBAR_ROW
  5727                                  	;mov	dl, al ; 22/12/2024
  5728 00002628 E88DFDFFFF              	call	setCursorPosition
  5729                                  
  5730                                  	; 21/12/2024
  5731                                  	; (write progress bar chars in graphics mode)
  5732                                  	;;;;
  5733 0000262D 8B35[EC720000]          	mov	esi, [screenpos]
  5734                                  UpdateProgressBar_Clean_@:
  5735                                  	;;;mov	eax, 223
  5736                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5737                                  	;;mov	eax, 223*16
  5738                                  	;mov	edi, fontbuff2 ; start of user font data
  5739                                  	;add	edi, eax
  5740                                  	;mov	edi, fontbuff2+(223*16)
  5741                                  	;
  5742                                  	;sys	_video, 020Fh, 08h, 8001h
  5743                                  	; 22/12/2024
  5744                                  	;mov	eax, 223
  5745                                  	; eax = 0
  5746 00002633 B0DF                    	mov	al, 223
  5747 00002635 B108                    	mov	cl, 08h ; gray (dark)
  5748 00002637 E837FFFFFF              	call	write_character
  5749                                  	;;;;
  5750                                  
  5751 0000263C 4D                      	dec	ebp
  5752 0000263D 74CA                    	jz	short UpdateProgressBar_ok
  5753                                  
  5754 0000263F 83C608                  	add	esi, 8 ; next column
  5755 00002642 EBEF                    	jmp	short UpdateProgressBar_Clean_@
  5756                                  	;;;;
  5757                                  
  5758                                  ; --------------------------------------------------------
  5759                                  ; 17/11/2024
  5760                                  
  5761                                  Player_ProcessKey_Backwards:
  5762                                  	;; In order to go backwards 5 seconds:
  5763                                  	;; Update file pointer to the beginning, skip headers
  5764 00002644 B142                    	mov	cl, 'B'
  5765 00002646 EB02                    	jmp	short Player_ProcessKey_B_or_F
  5766                                  
  5767                                  Player_ProcessKey_Forwards:
  5768                                  	;; In order to fast-forward 5 seconds, set the file pointer
  5769                                  	;; to CUR_SEEK + 5 * Freq
  5770                                  
  5771 00002648 B146                    	mov	cl, 'F'
  5772                                  	;jmp	short Player_ProcessKey_B_or_F
  5773                                  
  5774                                  	; 01/12/2024 (32bit regsisters)
  5775                                  Player_ProcessKey_B_or_F:
  5776                                  	; 17/11/2024
  5777                                  	; 04/11/2024
  5778                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5779                                    
  5780                                  	; 04/11/2024
  5781 0000264A B805000000              	mov	eax, 5
  5782 0000264F 0FB71D[287D0000]        	movzx	ebx, word [WAVE_BlockAlign]
  5783 00002656 F7E3                    	mul	ebx
  5784 00002658 668B1D[207D0000]        	mov	bx, [WAVE_SampleRate]
  5785 0000265F F7E3                    	mul	ebx
  5786                                  	; eax = transfer byte count for 5 seconds
  5787                                  	
  5788                                  	; 17/11/2024
  5789 00002661 80F942                  	cmp	cl, 'B'
  5790                                  	;mov	bx, [LoadedDataBytes]
  5791                                  	;mov	cx, [LoadedDataBytes+2]
  5792                                  	; 01/12/2024
  5793 00002664 8B0D[B47D0000]          	mov	ecx, [LoadedDataBytes]
  5794 0000266A 7508                    	jne	short move_forward ; cl = 'F'
  5795                                  move_backward:
  5796                                  	;sub	bx, ax
  5797                                  	;sbb	cx, dx
  5798 0000266C 29C1                    	sub	ecx, eax
  5799 0000266E 7316                    	jnc	short move_file_pointer
  5800                                  move_to_beginning:
  5801                                  	;xor	cx, cx ; 0
  5802                                  	;xor	bx, bx ; 0
  5803 00002670 31C9                    	xor	ecx, ecx
  5804 00002672 EB12                    	jmp	short move_file_pointer
  5805                                  move_forward: 
  5806                                  	;add	bx, ax
  5807                                  	;adc	cx, dx
  5808 00002674 01C1                    	add	ecx, eax
  5809 00002676 7208                    	jc	short move_to_end
  5810                                  	;cmp	cx, [DATA_SubchunkSize+2]
  5811                                  	;ja	short move_to_end
  5812                                  	;jb	short move_file_pointer
  5813                                  	;cmp	bx, [DATA_SubchunkSize]
  5814                                  	;jna	short move_file_pointer
  5815 00002678 3B0D[307D0000]          	cmp	ecx, [DATA_SubchunkSize]
  5816 0000267E 7606                    	jna	short move_file_pointer
  5817                                  move_to_end:
  5818                                  	;mov	bx, [DATA_SubchunkSize]
  5819                                  	;mov	cx, [DATA_SubchunkSize+2]
  5820 00002680 8B0D[307D0000]          	mov	ecx, [DATA_SubchunkSize]
  5821                                  move_file_pointer:
  5822                                  	;mov	dx, bx    
  5823                                  	;mov	[LoadedDataBytes], dx
  5824                                  	;mov	[LoadedDataBytes+2], cx
  5825 00002686 890D[B47D0000]          	mov	[LoadedDataBytes], ecx
  5826                                  	;add	dx, 44 ; + header
  5827                                  	;adc	cx, 0
  5828 0000268C 83C12C                  	add	ecx, 44 
  5829                                  
  5830                                  	; seek
  5831                                  	;mov	bx, [filehandle]
  5832                                  	;mov	ax, 4200h
  5833                                  	;int	21h
  5834                                  	; 01/12/2024
  5835 0000268F 31D2                    	xor	edx, edx ; offset from beginning of the file
  5836                                  	; ecx = offset	
  5837                                  	; ebx = file handle
  5838                                  	; edx = 0
  5839                                  	sys	_seek, [filehandle]
    85                              <1> 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1>  %if %0 >= 2
    90 00002691 8B1D[387D0000]      <1>  mov ebx, %2
    91                              <1>  %if %0 >= 3
    92                              <1>  mov ecx, %3
    93                              <1>  %if %0 = 4
    94                              <1>  mov edx, %4
    95                              <1>  %endif
    96                              <1>  %endif
    97                              <1>  %endif
    98 00002697 B813000000          <1>  mov eax, %1
    99                              <1> 
   100 0000269C CD40                <1>  int 40h
  5840 0000269E C3                      	retn
  5841                                  
  5842                                  ; --------------------------------------------------------
  5843                                  
  5844                                  	; 25/12/2024
  5845                                  	; 22/12/2024 (VESA VBE mode graphics) 
  5846                                  	; (640*480, 256 colors)
  5847                                  clear_window:
  5848 0000269F 8B3D[E8720000]          	mov	edi, [LFB_ADDR]
  5849                                  	;add	edi, (13*80*8*14)
  5850                                  	; 25/12/2024
  5851 000026A5 81C7009A0100            	add	edi, 164*640
  5852 000026AB 29C0                    	sub	eax, eax
  5853                                  	;mov	ecx, (16*640*14)/4 ; 16 rows
  5854 000026AD B900A00000              	mov	ecx, 64*640 ; 256 volume level points
  5855 000026B2 F3AB                    	rep	stosd
  5856                                  	; 24/12/2024
  5857 000026B4 A3[F8720000]            	mov	[prev_points], eax ; 0
  5858                                  	;
  5859 000026B9 C3                      	retn
  5860                                  
  5861                                  ; --------------------------------------------------------
  5862                                  
  5863                                  	; 22/12/2024
  5864                                  	; 21/12/2024
  5865                                  	; (simulate wave leds in graphics mode)
  5866                                  	; (640*480, 256 colors)
  5867                                  reset_wave_leds:
  5868                                  	; 22/12/2024
  5869 000026BA C705[A0710000]0000-     	mov	dword [prev_leds], 0
  5869 000026C2 0000               
  5870                                  	;
  5871 000026C4 BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  5872 000026C9 BE[A05D0000]            	mov	esi, wleds_addr
  5873                                  next_led:
  5874 000026CE AD                      	lodsd
  5875 000026CF 89C7                    	mov	edi, eax
  5876 000026D1 BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  5877 000026D6 BB[805D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5878                                  led_line:
  5879 000026DB 8A23                    	mov	ah, [ebx]
  5880 000026DD B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  5881                                  next_pixel:
  5882 000026E2 D0E4                    	shl	ah, 1
  5883 000026E4 7308                    	jnc	short skip_this
  5884 000026E6 B008                    	mov	al, 8 ; gray
  5885 000026E8 AA                      	stosb
  5886 000026E9 49                      	dec	ecx
  5887 000026EA 75F6                    	jnz	short next_pixel
  5888 000026EC EB06                    	jmp	short next_line
  5889                                  skip_this:
  5890 000026EE B000                    	mov	al, 0 ; black
  5891 000026F0 AA                      	stosb
  5892 000026F1 49                      	dec	ecx
  5893 000026F2 75EE                    	jnz	short next_pixel
  5894                                  next_line:
  5895 000026F4 4A                      	dec	edx
  5896 000026F5 7504                    	jnz	short next_line_@
  5897 000026F7 4D                      	dec	ebp
  5898 000026F8 75D4                    	jnz	short next_led
  5899                                  	;clc	; 25/12/2024
  5900 000026FA C3                      	retn
  5901                                  next_line_@:
  5902                                  	; 22/12/2024
  5903 000026FB 81C778020000            	add	edi, 640-8 ; next line
  5904 00002701 43                      	inc	ebx
  5905 00002702 EBD7                    	jmp	short led_line	
  5906                                  
  5907                                  ; --------------------------------------------------------
  5908                                  
  5909                                  	; 22/12/2024 (graphics mode)
  5910                                  	; 09/12/2024
  5911                                  	; 19/11/2024
  5912                                  UpdateWaveLeds:
  5913                                  	; 23/11/2024
  5914                                  	;call	reset_wave_leds
  5915                                  	; 22/12/2024 (faster method, 80 against 80*16)
  5916                                  	; turn off previously lighting wave leds at first
  5917                                  	;;;
  5918 00002704 BE[A0710000]            	mov	esi, prev_leds
  5919 00002709 833E00                  	cmp	dword [esi], 0
  5920 0000270C 7433                    	jz	short UpdateWaveLeds_ok
  5921 0000270E B950000000              	mov	ecx, 80
  5922                                  turn_off_led:
  5923 00002713 AD                      	lodsd
  5924 00002714 89C7                    	mov	edi, eax
  5925                                  	; edi = wave led address
  5926 00002716 BD0E000000              	mov	ebp, 14
  5927 0000271B BB[805D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5928 00002720 31D2                    	xor	edx, edx
  5929 00002722 B008                    	mov	al, 8 ; gray (dark)
  5930                                  toffl_next_line:
  5931                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5932                                  	;mov	dl, 8
  5933 00002724 88C2                    	mov	dl, al ; 8
  5934 00002726 8A23                    	mov	ah, [ebx]
  5935                                  toffl_next_pixel:
  5936 00002728 D0E4                    	shl	ah, 1
  5937 0000272A 7310                    	jnc	short toffl_skip_this
  5938 0000272C AA                      	stosb
  5939                                  toffl_next_pixel_@:
  5940 0000272D 4A                      	dec	edx
  5941 0000272E 75F8                    	jnz	short toffl_next_pixel
  5942 00002730 4D                      	dec	ebp
  5943 00002731 740C                    	jz	short toffl_next_led
  5944 00002733 81C778020000            	add	edi, 640-8 ; next line
  5945 00002739 43                      	inc	ebx
  5946 0000273A EBE8                    	jmp	short toffl_next_line
  5947                                  toffl_skip_this:
  5948 0000273C 47                      	inc	edi
  5949 0000273D EBEE                    	jmp	short toffl_next_pixel_@
  5950                                  toffl_next_led:
  5951 0000273F E2D2                    	loop	turn_off_led
  5952                                  UpdateWaveLeds_ok:
  5953                                  	;;;
  5954                                  	; 09/12/2024
  5955                                  	;jmp	short turn_on_leds
  5956                                  
  5957                                  ; --------------------------------------------------------
  5958                                  
  5959                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  5960                                  	; 09/12/2024
  5961                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  5962                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  5963                                  	; 21/11/2024, 22/11/2024
  5964                                  	; 19/11/2024
  5965                                  turn_on_leds:
  5966                                  	; 09/12/2024
  5967                                  	; 07/12/2024
  5968 00002741 8A15[057D0000]          	mov	dl, [half_buffer]
  5969                                  tol_@:
  5970                                  	; 07/12/2024
  5971 00002747 3815[047D0000]          	cmp	[pbuf_s], dl
  5972 0000274D 7520                    	jne	short tol_ns_buf
  5973 0000274F 8B1D[FC7C0000]          	mov	ebx, [wleds_dif]
  5974 00002755 8B35[007D0000]          	mov	esi, [pbuf_o]
  5975 0000275B 8B0D[A47D0000]          	mov	ecx, [buffersize] ; bytes
  5976 00002761 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  5977 00002763 01DE                    	add	esi, ebx
  5978 00002765 7204                    	jc	short tol_o_@
  5979 00002767 39CE                    	cmp	esi, ecx
  5980 00002769 760C                    	jna	short tol_s_buf
  5981                                  tol_o_@:
  5982 0000276B 89CE                    	mov	esi, ecx
  5983 0000276D EB08                    	jmp	short tol_s_buf
  5984                                  
  5985                                  tol_ns_buf:
  5986 0000276F 8815[047D0000]          	mov	[pbuf_s], dl
  5987 00002775 31F6                    	xor	esi, esi ; 0
  5988                                  tol_s_buf:
  5989 00002777 8935[007D0000]          	mov	[pbuf_o], esi
  5990                                  
  5991                                  tol_buf_@:
  5992                                  	; 07/12/2024
  5993 0000277D 81C6[00800000]          	add	esi, audio_buffer
  5994 00002783 B950000000              	mov	ecx, 80
  5995                                  	;xor	eax, eax ; 0
  5996 00002788 BB[A05D0000]            	mov	ebx, wleds_addr
  5997                                  	; 22/12/2024
  5998 0000278D BF[A0710000]            	mov	edi, prev_leds
  5999                                  tol_fill_c:
  6000 00002792 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  6001 00002794 66AD                    	lodsw	; left
  6002 00002796 80C480                  	add	ah, 80h	; 24/12/2024
  6003 00002799 89C2                    	mov	edx, eax
  6004 0000279B 66AD                    	lodsw	; right
  6005                                  	;add	ax, dx
  6006 0000279D 80C480                  	add	ah, 80h
  6007                                  	;; 21/12/2024 (16 volume levels)
  6008                                  	;shr	eax, 12
  6009                                  	; 24/12/2024
  6010 000027A0 01D0                    	add	eax, edx
  6011 000027A2 C1E80D                  	shr	eax, 13	; (L+R/2) & 16 volume levels
  6012                                  
  6013 000027A5 53                      	push	ebx ; *
  6014                                  	; 01/12/2024
  6015 000027A6 C1E002                  	shl	eax, 2
  6016 000027A9 01C3                    	add	ebx, eax
  6017                                  	; 01/12/2024 (32bit address)
  6018                                  	;mov	edi, [ebx]
  6019                                  	; 22/12/2024
  6020 000027AB 8B03                    	mov	eax, [ebx]
  6021 000027AD AB                      	stosd
  6022 000027AE 57                      	push	edi ; **
  6023 000027AF 89C7                    	mov	edi, eax
  6024                                  	;;;
  6025                                  	; 21/12/2024
  6026                                  	; (simulate wave leds in graphics mode)
  6027                                  	; (640*480, 256 colors)
  6028                                  turn_on_led:
  6029                                  	; edi = wave led address
  6030 000027B1 BD0E000000              	mov	ebp, 14
  6031 000027B6 BB[805D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6032 000027BB A0[9D3F0000]            	mov	al, [ccolor]
  6033                                  tol_next_line:
  6034 000027C0 BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6035 000027C5 8A23                    	mov	ah, [ebx]
  6036                                  tol_next_pixel:
  6037 000027C7 D0E4                    	shl	ah, 1
  6038 000027C9 7310                    	jnc	short tol_skip_this
  6039 000027CB AA                      	stosb
  6040                                  tol_next_pixel_@:
  6041 000027CC 4A                      	dec	edx
  6042 000027CD 75F8                    	jnz	short tol_next_pixel
  6043 000027CF 4D                      	dec	ebp
  6044 000027D0 740C                    	jz	short tol_next_led
  6045                                  	; 22/12/2024
  6046 000027D2 81C778020000            	add	edi, 640-8 ; next line
  6047 000027D8 43                      	inc	ebx
  6048 000027D9 EBE5                    	jmp	short tol_next_line
  6049                                  tol_skip_this:
  6050 000027DB 47                      	inc	edi
  6051 000027DC EBEE                    	jmp	short tol_next_pixel_@
  6052                                  tol_next_led:
  6053                                  	; 22/12/2024
  6054 000027DE 5F                      	pop	edi ; **
  6055                                  	;;;
  6056 000027DF 5B                      	pop	ebx ; *
  6057 000027E0 83C340                  	add	ebx, 16*4
  6058 000027E3 E2AD                    	loop	tol_fill_c
  6059                                  
  6060 000027E5 C3                      	retn
  6061                                  
  6062                                  ; -------------------------------------------------------------
  6063                                  
  6064                                  ; -------------------------------------------------------------
  6065                                  ; ac97.inc (11/11/2023)
  6066                                  ; -------------------------------------------------------------
  6067                                  
  6068                                  ; special characters
  6069                                  LF      EQU 10
  6070                                  CR      EQU 13
  6071                                  
  6072                                  ; PCI stuff
  6073                                  
  6074                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  6075                                  
  6076                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  6077                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6078                                  SIS_VID		equ	1039h
  6079                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  6080                                  AMD_VID		equ	1022h
  6081                                  
  6082                                  ICH_DID         equ     2415h           ; ICH device ID
  6083                                  ICH0_DID        equ     2425h           ; ICH0
  6084                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  6085                                                                          ; they all should be compatible.
  6086                                  
  6087                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  6088                                  ICH3_DID	equ     2485h           ; ICH3
  6089                                  ICH4_DID        equ     24C5h           ; ICH4
  6090                                  ICH5_DID	equ     24D5h           ; ICH5
  6091                                  ICH6_DID	equ     266Eh           ; ICH6
  6092                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  6093                                  ESB631X_DID	equ     2698h           ; 631XESB
  6094                                  ICH7_DID	equ	27DEh		; ICH7
  6095                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6096                                  MX82440_DID	equ	7195h
  6097                                  SI7012_DID	equ	7012h
  6098                                  NFORCE_DID	equ	01B1h
  6099                                  NFORCE2_DID	equ	006Ah
  6100                                  AMD8111_DID	equ	746Dh
  6101                                  AMD768_DID	equ	7445h
  6102                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  6103                                  CK804_DID	equ	0059h
  6104                                  MCP04_DID	equ	003Ah
  6105                                  CK8_DID		equ	008Ah
  6106                                  NFORCE3_DID	equ	00DAh
  6107                                  CK8S_DID	equ	00EAh
  6108                                  
  6109                                  ; -------------------------------------------------------------
  6110                                  
  6111                                  ; 22/12/2024
  6112 000027E6 90<rep 2h>              align 4
  6113                                  
  6114                                  ; 13/11/2024
  6115                                  ; ('<<' to 'shl' conversion for FASM)
  6116                                  ;
  6117                                  ; 29/05/2024 (TRDOS 386)
  6118                                  ; 17/02/2017
  6119                                  ; Valid ICH device IDs
  6120                                  
  6121                                  valid_ids:
  6122                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  6123 000027E8 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  6124 000027EC 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  6125 000027F0 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  6126 000027F4 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  6127 000027F8 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  6128 000027FC 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  6129 00002800 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  6130 00002804 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  6131 00002808 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  6132 0000280C 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  6133                                  	; 03/11/2023 - Erdogan Tan
  6134 00002810 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  6135 00002814 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  6136 00002818 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  6137 0000281C DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  6138 00002820 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  6139 00002824 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  6140 00002828 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  6141 0000282C DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  6142 00002830 DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  6143 00002834 DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  6144 00002838 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  6145                                  
  6146                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  6147                                  ; 13/11/2024
  6148                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  6149                                  
  6150 0000283C 00000000                	dd 0
  6151                                  
  6152                                  Credits:
  6153 00002840 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  6153 00002849 6C6179657220666F72-
  6153 00002852 205452444F53203338-
  6153 0000285B 36206279204572646F-
  6153 00002864 67616E2054616E2E20 
  6154                                  	;db 'December 2024.', 10,13,0
  6155 0000286D 4A616E756172792032-     	db 'January 2025.', 10,13,0
  6155 00002876 3032352E0A0D00     
  6156                                  	;db '28/12/2024', 10,13
  6157 0000287D 31382F30312F323032-     	db '18/01/2025', 10,13
  6157 00002886 350A0D             
  6158                                  ; 15/11/2024
  6159                                  reset:
  6160 00002889 00                      	db 0
  6161                                  
  6162                                  msgAudioCardInfo:
  6163 0000288A 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  6163 00002893 204143393720284943-
  6163 0000289C 482920417564696F20-
  6163 000028A5 436F6E74726F6C6C65-
  6163 000028AE 722E0A0D00         
  6164                                  
  6165                                  	; 21/12/2024
  6166                                  msg_usage:
  6167 000028B3 75736167653A206470-     	db 'usage: dplaywav filename.wav',10,13,0
  6167 000028BC 6C6179776176206669-
  6167 000028C5 6C656E616D652E7761-
  6167 000028CE 760A0D00           
  6168                                  
  6169                                  noDevMsg:
  6170 000028D2 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  6170 000028DB 61626C6520746F2066-
  6170 000028E4 696E64204143393720-
  6170 000028ED 617564696F20646576-
  6170 000028F6 69636521           
  6171 000028FA 0A0D00                  	db 10,13,0
  6172                                  
  6173                                  noFileErrMsg:
  6174 000028FD 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  6174 00002906 6C65206E6F7420666F-
  6174 0000290F 756E642E0A0D00     
  6175                                  
  6176                                  ; 07/12/2024
  6177                                  trdos386_err_msg:
  6178 00002916 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  6178 0000291F 2053797374656D2063-
  6178 00002928 616C6C206572726F72-
  6178 00002931 20210A0D00         
  6179                                  
  6180                                  ; 29/05/2024
  6181                                  ; 11/11/2023
  6182                                  msg_init_err:
  6183 00002936 0D0A                    	db CR, LF
  6184 00002938 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6184 00002941 726F6C6C65722F436F-
  6184 0000294A 64656320696E697469-
  6184 00002953 616C697A6174696F6E-
  6184 0000295C 206572726F722021   
  6185 00002964 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6186                                  
  6187                                  ; 25/11/2023
  6188                                  msg_no_vra:
  6189 00002967 0A0D                    	db 10,13
  6190 00002969 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6190 00002972 70706F72742021204F-
  6190 0000297B 6E6C79203438206B48-
  6190 00002984 5A2073616D706C6520-
  6190 0000298D 726174652073757070-
  6190 00002996 6F727465642021     
  6191 0000299D 0A0D00                  	db 10,13,0
  6192                                  
  6193                                  ; 19/11/2024
  6194                                  ; 03/06/2017
  6195                                  hex_chars:
  6196 000029A0 303132333435363738-     	db '0123456789ABCDEF', 0
  6196 000029A9 3941424344454600   
  6197                                  msgAC97Info:
  6198 000029B1 0D0A                    	db 0Dh, 0Ah
  6199 000029B3 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6199 000029BC 696F20436F6E74726F-
  6199 000029C5 6C6C6572202620436F-
  6199 000029CE 64656320496E666F0D-
  6199 000029D7 0A                 
  6200 000029D8 2056656E646F722049-     	db ' Vendor ID: '
  6200 000029E1 443A20             
  6201                                  msgVendorId:
  6202 000029E4 303030306820446576-     	db '0000h Device ID: '
  6202 000029ED 6963652049443A20   
  6203                                  msgDevId:
  6204 000029F5 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6205 000029FC 204275733A20            	db ' Bus: '
  6206                                  msgBusNo:
  6207 00002A02 303068204465766963-     	db '00h Device: '
  6207 00002A0B 653A20             
  6208                                  msgDevNo:
  6209 00002A0E 3030682046756E6374-     	db '00h Function: '
  6209 00002A17 696F6E3A20         
  6210                                  msgFncNo:
  6211 00002A1C 303068                  	db '00h'
  6212 00002A1F 0D0A                    	db 0Dh, 0Ah
  6213 00002A21 204E414D4241523A20      	db ' NAMBAR: '
  6214                                  msgNamBar:
  6215 00002A2A 30303030682020          	db '0000h  '
  6216 00002A31 4E41424D4241523A20      	db 'NABMBAR: '
  6217                                  msgNabmBar:
  6218 00002A3A 303030306820204952-     	db '0000h  IRQ: '
  6218 00002A43 513A20             
  6219                                  msgIRQ:
  6220 00002A46 3030                    	dw 3030h
  6221 00002A48 0D0A00                  	db 0Dh, 0Ah, 0
  6222                                  ; 25/11/2023
  6223                                  msgVRAheader:
  6224 00002A4B 205652412073757070-     	db ' VRA support: '
  6224 00002A54 6F72743A20         
  6225 00002A59 00                      	db 0	
  6226                                  msgVRAyes:
  6227 00002A5A 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6228                                  msgVRAno:
  6229 00002A60 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6230 00002A65 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6230 00002A6E 6C617465642073616D-
  6230 00002A77 706C65207261746520-
  6230 00002A80 706C6179696E67206D-
  6230 00002A89 6574686F6429       
  6231 00002A8F 0D0A00                  	db 0Dh, 0Ah, 0
  6232                                  
  6233 00002A92 90<rep 2h>              align 4
  6234                                  
  6235                                  ; -------------------------------------------------------------
  6236                                  
  6237                                  	; 21/12/2024
  6238                                  SplashScreen:
  6239 00002A94 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6239 00002A9D 202020202020202020-
  6239 00002AA6 202020202020202020-
  6239 00002AAF 202020202020202020-
  6239 00002AB8 202020202020202020-
  6239 00002AC1 202020202020202020-
  6239 00002ACA 202020202020202020-
  6239 00002AD3 202020202020202020-
  6239 00002ADC 2020202020DDDBDE   
  6240 00002AE4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6240 00002AED 202020202020202020-
  6240 00002AF6 202020202020202020-
  6240 00002AFF 202020202020202020-
  6240 00002B08 202020202020202020-
  6240 00002B11 202020202020202020-
  6240 00002B1A 202020202020202020-
  6240 00002B23 202020202020202020-
  6240 00002B2C 2020202020DDDBDE   
  6241 00002B34 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6241 00002B3D 202020202020202020-
  6241 00002B46 202020202020202020-
  6241 00002B4F 202020202020202020-
  6241 00002B58 202020202020202020-
  6241 00002B61 202020202020202020-
  6241 00002B6A 202020202020202020-
  6241 00002B73 202020202020202020-
  6241 00002B7C 2020202020DDDBDE   
  6242 00002B84 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6242 00002B8D 202020202020202020-
  6242 00002B96 202020202020202020-
  6242 00002B9F 202020202020202020-
  6242 00002BA8 202020202020202020-
  6242 00002BB1 202020202020202020-
  6242 00002BBA 202020202020202020-
  6242 00002BC3 202020202020202020-
  6242 00002BCC 2020202020DDDBDE   
  6243 00002BD4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6243 00002BDD 202020202020202020-
  6243 00002BE6 202020202020202020-
  6243 00002BEF 202020202020202020-
  6243 00002BF8 202020202020202020-
  6243 00002C01 202020202020202020-
  6243 00002C0A 202020202020202020-
  6243 00002C13 202020202020202020-
  6243 00002C1C 2020202020DDDBDE   
  6244 00002C24 DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6244 00002C2D 202020202020202020-
  6244 00002C36 2020202020205F5F5F-
  6244 00002C3F 5F5F5F5F2020205F5F-
  6244 00002C48 5F5F5F5F2020202020-
  6244 00002C51 2020205F5F5F5F5F5F-
  6244 00002C5A 5F2E20202020202020-
  6244 00002C63 202020202020202020-
  6244 00002C6C 2020202020DDDBDE   
  6245 00002C74 DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6245 00002C7D 202020202020202020-
  6245 00002C86 20202020207C202020-
  6245 00002C8F 202020205C202F2020-
  6245 00002C98 5F5F20205C20202020-
  6245 00002CA1 20202F202020202020-
  6245 00002CAA 207C20202020202020-
  6245 00002CB3 202020202020202020-
  6245 00002CBC 2020202020DDDBDE   
  6246 00002CC4 DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6246 00002CCD 202020202020202020-
  6246 00002CD6 20202020207C20202E-
  6246 00002CDF 2D2D2E20207C20207C-
  6246 00002CE8 20207C20207C202020-
  6246 00002CF1 207C202020282D2D2D-
  6246 00002CFA 2D6020202020202020-
  6246 00002D03 202020202020202020-
  6246 00002D0C 2020202020DDDBDE   
  6247 00002D14 DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6247 00002D1D 202020202020202020-
  6247 00002D26 20202020207C20207C-
  6247 00002D2F 20207C20207C20207C-
  6247 00002D38 20207C20207C202020-
  6247 00002D41 20205C2020205C2020-
  6247 00002D4A 202020202020202020-
  6247 00002D53 202020202020202020-
  6247 00002D5C 2020202020DDDBDE   
  6248 00002D64 DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6248 00002D6D 202020202020202020-
  6248 00002D76 20202020207C202027-
  6248 00002D7F 2D2D2720207C202060-
  6248 00002D88 2D2D2720207C202E2D-
  6248 00002D91 2D2D2D292020207C20-
  6248 00002D9A 202020202020202020-
  6248 00002DA3 202020202020202020-
  6248 00002DAC 2020202020DDDBDE   
  6249 00002DB4 DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6249 00002DBD 202020202020202020-
  6249 00002DC6 20202020207C5F5F5F-
  6249 00002DCF 5F5F5F5F2F205C5F5F-
  6249 00002DD8 5F5F5F5F2F20207C5F-
  6249 00002DE1 5F5F5F5F5F5F2F2020-
  6249 00002DEA 202020202020202020-
  6249 00002DF3 202020202020202020-
  6249 00002DFC 2020202020DDDBDE   
  6250 00002E04 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6250 00002E0D 202020202020202020-
  6250 00002E16 202020202020202020-
  6250 00002E1F 202020202020202020-
  6250 00002E28 202020202020202020-
  6250 00002E31 202020202020202020-
  6250 00002E3A 202020202020202020-
  6250 00002E43 202020202020202020-
  6250 00002E4C 2020202020DDDBDE   
  6251 00002E54 DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6251 00002E5D 5F5F5F5F5F5F202020-
  6251 00002E66 205F5F202020202020-
  6251 00002E6F 202020205F5F5F2020-
  6251 00002E78 205F5F5F5F20202020-
  6251 00002E81 5F5F5F5F20205F5F5F-
  6251 00002E8A 5F5F5F5F202E5F5F5F-
  6251 00002E93 5F5F5F202020202020-
  6251 00002E9C 2020202020DDDBDE   
  6252 00002EA4 DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6252 00002EAD 2020205F20205C2020-
  6252 00002EB6 7C20207C2020202020-
  6252 00002EBF 2020202F2020205C20-
  6252 00002EC8 205C2020205C20202F-
  6252 00002ED1 2020202F207C202020-
  6252 00002EDA 5F5F5F5F7C7C202020-
  6252 00002EE3 5F20205C2020202020-
  6252 00002EEC 2020202020DDDBDE   
  6253 00002EF4 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6253 00002EFD 20207C5F2920207C20-
  6253 00002F06 7C20207C2020202020-
  6253 00002F0F 20202F20205E20205C-
  6253 00002F18 20205C2020205C2F20-
  6253 00002F21 20202F20207C20207C-
  6253 00002F2A 5F5F2020207C20207C-
  6253 00002F33 5F2920207C20202020-
  6253 00002F3C 2020202020DDDBDE   
  6254 00002F44 DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6254 00002F4D 2020205F5F5F2F2020-
  6254 00002F56 7C20207C2020202020-
  6254 00002F5F 202F20202F5F5C2020-
  6254 00002F68 5C20205C5F20202020-
  6254 00002F71 5F2F2020207C202020-
  6254 00002F7A 5F5F7C20207C202020-
  6254 00002F83 2020202F2020202020-
  6254 00002F8C 2020202020DDDBDE   
  6255 00002F94 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6255 00002F9D 20207C202020202020-
  6255 00002FA6 7C2020602D2D2D2D2E-
  6255 00002FAF 2F20205F5F5F5F5F20-
  6255 00002FB8 205C2020207C20207C-
  6255 00002FC1 20202020207C20207C-
  6255 00002FCA 5F5F5F5F207C20207C-
  6255 00002FD3 5C20205C2D2D2D2D2E-
  6255 00002FDC 2020202020DDDBDE   
  6256 00002FE4 DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6256 00002FED 205F7C202020202020-
  6256 00002FF6 7C5F5F5F5F5F5F5F2F-
  6256 00002FFF 5F5F2F20202020205C-
  6256 00003008 5F5F5C20207C5F5F7C-
  6256 00003011 20202020207C5F5F5F-
  6256 0000301A 5F5F5F5F7C7C205F7C-
  6256 00003023 20602E5F5F5F5F5F7C-
  6256 0000302C 2020202020DDDBDE   
  6257 00003034 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6257 0000303D 202020202020202020-
  6257 00003046 202020202020202020-
  6257 0000304F 202020202020202020-
  6257 00003058 202020202020202020-
  6257 00003061 202020202020202020-
  6257 0000306A 202020202020202020-
  6257 00003073 202020202020202020-
  6257 0000307C 2020202020DDDBDE   
  6258 00003084 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6258 0000308D 202020202020202020-
  6258 00003096 202020202020202020-
  6258 0000309F 202020202020202020-
  6258 000030A8 202020202020202020-
  6258 000030B1 202020202020202020-
  6258 000030BA 202020202020202020-
  6258 000030C3 202020202020202020-
  6258 000030CC 2020202020DDDBDE   
  6259 000030D4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6259 000030DD 202020202020202020-
  6259 000030E6 202020202020202020-
  6259 000030EF 202020202020202020-
  6259 000030F8 202020202020202020-
  6259 00003101 202020202020202020-
  6259 0000310A 202020202020202020-
  6259 00003113 202020202020202020-
  6259 0000311C 2020202020DDDBDE   
  6260 00003124 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6260 0000312D 202020202020202020-
  6260 00003136 202020202020202020-
  6260 0000313F 202020202020202020-
  6260 00003148 202020202020202020-
  6260 00003151 202020202020202020-
  6260 0000315A 202020202020202020-
  6260 00003163 202020202020202020-
  6260 0000316C 2020202020DDDBDE   
  6261 00003174 DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6261 0000317D 202020202020202020-
  6261 00003186 202020202020202020-
  6261 0000318F 202020202020202057-
  6261 00003198 454C434F4D4520544F-
  6261 000031A1 202020202020202020-
  6261 000031AA 202020202020202020-
  6261 000031B3 202020202020202020-
  6261 000031BC 2020202020DDDBDE   
  6262 000031C4 DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6262 000031CD 202020202020202020-
  6262 000031D6 202020202020202020-
  6262 000031DF 202020202020202044-
  6262 000031E8 4F5320504C41594552-
  6262 000031F1 202020202020202020-
  6262 000031FA 202020202020202020-
  6262 00003203 202020202020202020-
  6262 0000320C 2020202020DDDBDE   
  6263 00003214 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6263 0000321D 202020202020202020-
  6263 00003226 202020202020202020-
  6263 0000322F 202020202020202020-
  6263 00003238 202020202020202020-
  6263 00003241 202020202020202020-
  6263 0000324A 202020202020202020-
  6263 00003253 202020202020202020-
  6263 0000325C 2020202020DDDBDE   
  6264 00003264 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6264 0000326D 202020202020202020-
  6264 00003276 202020202020202020-
  6264 0000327F 202020202020202020-
  6264 00003288 202020202020202020-
  6264 00003291 202020202020202020-
  6264 0000329A 202020202020202020-
  6264 000032A3 202020202020202020-
  6264 000032AC 2020202020DDDBDE   
  6265 000032B4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6265 000032BD 202020202020202020-
  6265 000032C6 202020202020202020-
  6265 000032CF 202020202020202020-
  6265 000032D8 202020202020202020-
  6265 000032E1 202020202020202020-
  6265 000032EA 202020202020202020-
  6265 000032F3 202020202020202020-
  6265 000032FC 2020202020DDDBDE   
  6266 00003304 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6266 0000330D 202020202020202020-
  6266 00003316 202020202020202020-
  6266 0000331F 202020202020202020-
  6266 00003328 202020202020202020-
  6266 00003331 202020202020202020-
  6266 0000333A 202020202020202020-
  6266 00003343 202020202020202020-
  6266 0000334C 2020202020DDDBDE   
  6267 00003354 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6267 0000335D 202020202020202020-
  6267 00003366 202020202020202020-
  6267 0000336F 202020202020202020-
  6267 00003378 202020202020202020-
  6267 00003381 202020202020202020-
  6267 0000338A 202020202020202020-
  6267 00003393 202020202020202020-
  6267 0000339C 2020202020DDDBDE   
  6268 000033A4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6268 000033AD 202020202020202020-
  6268 000033B6 202020202020202020-
  6268 000033BF 202020202020202020-
  6268 000033C8 202020202020202020-
  6268 000033D1 202020202020202020-
  6268 000033DA 202020202020202020-
  6268 000033E3 202020202020202020-
  6268 000033EC 2020202020DDDBDE   
  6269 000033F4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6269 000033FD 202020202020202020-
  6269 00003406 202020202020202020-
  6269 0000340F 202020202020202020-
  6269 00003418 202020202020202020-
  6269 00003421 202020202020202020-
  6269 0000342A 202020202020202020-
  6269 00003433 202020202020202020-
  6269 0000343C 2020202020DDDBDE   
  6270 00003444 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6270 0000344D 202020202020202020-
  6270 00003456 202020202020202020-
  6270 0000345F 202020202020202020-
  6270 00003468 202020202020202020-
  6270 00003471 202020202020202020-
  6270 0000347A 202020202020202020-
  6270 00003483 202020202020202020-
  6270 0000348C 2020202020DDDBDE   
  6271 00003494 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6271 0000349D 202020202020202020-
  6271 000034A6 202020202020202020-
  6271 000034AF 202020202020202020-
  6271 000034B8 202020202020202020-
  6271 000034C1 202020202020202020-
  6271 000034CA 202020202020202020-
  6271 000034D3 202020202020202020-
  6271 000034DC 2020202020DDDBDE   
  6272 000034E4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6272 000034ED 202020202020202020-
  6272 000034F6 202020202020202020-
  6272 000034FF 202020202020202020-
  6272 00003508 202020202020202020-
  6272 00003511 202020202020202020-
  6272 0000351A 202020202020202020-
  6272 00003523 202020202020202020-
  6272 0000352C 2020202020DDDBDE   
  6273 00003534 00                      	db 0
  6274                                  
  6275                                  ; -------------------------------------------------------------
  6276                                  
  6277                                  	; 22/12/2024
  6278                                  	; 21/12/2024
  6279                                  PlayingScreen:
  6280 00003535 DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6280 0000353E DBDBDBDBDBDBDBDBDB-
  6280 00003547 DBDBDBDBDBDBDBDBDB-
  6280 00003550 DBDBDBDBDBDBDB2044-
  6280 00003559 4F5320506C61796572-
  6280 00003562 20DBDBDBDBDBDBDBDB-
  6280 0000356B DBDBDBDBDBDBDBDBDB-
  6280 00003574 DBDBDBDBDBDBDBDBDB-
  6280 0000357D DBDBDBDBDBDBDBDB   
  6281 00003585 C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6281 0000358E CDCDCDCDCDCDCDCDCD-
  6281 00003597 CDCDCDCDCDCDCDCDCD-
  6281 000035A0 CDCDCDCDCDCDCDCDCD-
  6281 000035A9 CDCDCDCDCDCDCDCDCD-
  6281 000035B2 CDCDCDCDCDCDCDCDCD-
  6281 000035BB CDCDCDCDCDCDCDCDCD-
  6281 000035C4 CDCDCDCDCDCDCDCDCD-
  6281 000035CD CDCDCDCDCDCDCDBB   
  6282 000035D5 BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6282 000035DE 202020202020202020-
  6282 000035E7 202020202020202020-
  6282 000035F0 202020202020202055-
  6282 000035F9 736572204775696465-
  6282 00003602 202020202020202020-
  6282 0000360B 202020202020202020-
  6282 00003614 202020202020202020-
  6282 0000361D 20202020202020BA   
  6283 00003625 BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<H>             Hardware Info", 9 dup(32), 186
  6283 0000362E 706163653E20202020-
  6283 00003637 2020202020506C6179-
  6283 00003640 2F5061757365202020-
  6283 00003649 20202020203C483E20-
  6283 00003652 202020202020202020-
  6283 0000365B 202020486172647761-
  6283 00003664 726520496E666F2020-
  6283 0000366D 20202020202020BA   
  6284                                  	; 25/12/2024
  6285 00003675 BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>/<G>     Wave Lighting", 9 dup(32), 186
  6285 0000367E 3E2020202020202020-
  6285 00003687 202020202053746F70-
  6285 00003690 202020202020202020-
  6285 00003699 20202020203C456E74-
  6285 000036A2 65723E2F3C473E2020-
  6285 000036AB 20202057617665204C-
  6285 000036B4 69676874696E672020-
  6285 000036BD 20202020202020BA   
  6286 000036C5 BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6286 000036CE 3E2020202020202020-
  6286 000036D7 2020202020466F7277-
  6286 000036E0 617264732020202020-
  6286 000036E9 20202020203C2B3E2F-
  6286 000036F2 3C2D3E202020202020-
  6286 000036FB 202020496E632F4465-
  6286 00003704 6320566F6C756D6520-
  6286 0000370D 20202020202020BA   
  6287 00003715 BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6287 0000371E 3E2020202020202020-
  6287 00003727 20202020204261636B-
  6287 00003730 776172647320202020-
  6287 00003739 20202020203C513E20-
  6287 00003742 202020202020202020-
  6287 0000374B 202020517569742050-
  6287 00003754 726F6772616D202020-
  6287 0000375D 20202020202020BA   
  6288 00003765 CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6288 0000376E CDCDCDCDCDCDCDCDCD-
  6288 00003777 CDCDCDCDCDCDCDCDCD-
  6288 00003780 CDCDCDCDCDCDCDCDCD-
  6288 00003789 CDCDCDCDCDCDCDCDCD-
  6288 00003792 CDCDCDCDCDCDCDCDCD-
  6288 0000379B CDCDCDCDCDCDCDCDCD-
  6288 000037A4 CDCDCDCDCDCDCDCDCD-
  6288 000037AD CDCDCDCDCDCDCDB9   
  6289 000037B5 BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6289 000037BE 6C65204E616D65203A-
  6289 000037C7 202020202020202020-
  6289 000037D0 202020202020202020-
  6289 000037D9 20202020204269742D-
  6289 000037E2 5261746520203A2020-
  6289 000037EB 202020302020426974-
  6289 000037F4 732020202020202020-
  6289 000037FD 20202020202020BA   
  6290 00003805 BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6290 0000380E 657175656E6379203A-
  6290 00003817 202020202030202020-
  6290 00003820 2020487A2020202020-
  6290 00003829 2020202020232D4368-
  6290 00003832 616E6E656C733A2020-
  6290 0000383B 202020302020202020-
  6290 00003844 202020202020202020-
  6290 0000384D 20202020202020BA   
  6291 00003855 C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6291 0000385E CDCDCDCDCDCDCDCDCD-
  6291 00003867 CDCDCDCDCDCDCDCDCD-
  6291 00003870 CDCDCDCDCDCDCDCDCD-
  6291 00003879 CDCDCDCDCDCDCDCDCD-
  6291 00003882 CDCDCDCDCDCDCDCDCD-
  6291 0000388B CDCDCDCDCDCDCDCDCD-
  6291 00003894 CDCDCDCDCDCDCDCDCD-
  6291 0000389D CDCDCDCDCDCDCDBC   
  6292 000038A5 202020202020202020-     	db  80 dup(32)
  6292 000038AE 202020202020202020-
  6292 000038B7 202020202020202020-
  6292 000038C0 202020202020202020-
  6292 000038C9 202020202020202020-
  6292 000038D2 202020202020202020-
  6292 000038DB 202020202020202020-
  6292 000038E4 202020202020202020-
  6292 000038ED 2020202020202020   
  6293                                  improper_samplerate_txt:
  6294                                  read_error_txt:
  6295 000038F5 202020202020202020-     	db  80 dup(32)
  6295 000038FE 202020202020202020-
  6295 00003907 202020202020202020-
  6295 00003910 202020202020202020-
  6295 00003919 202020202020202020-
  6295 00003922 202020202020202020-
  6295 0000392B 202020202020202020-
  6295 00003934 202020202020202020-
  6295 0000393D 2020202020202020   
  6296 00003945 202020202020202020-     	db  80 dup(32)
  6296 0000394E 202020202020202020-
  6296 00003957 202020202020202020-
  6296 00003960 202020202020202020-
  6296 00003969 202020202020202020-
  6296 00003972 202020202020202020-
  6296 0000397B 202020202020202020-
  6296 00003984 202020202020202020-
  6296 0000398D 2020202020202020   
  6297 00003995 202020202020202020-     	db  80 dup(32)
  6297 0000399E 202020202020202020-
  6297 000039A7 202020202020202020-
  6297 000039B0 202020202020202020-
  6297 000039B9 202020202020202020-
  6297 000039C2 202020202020202020-
  6297 000039CB 202020202020202020-
  6297 000039D4 202020202020202020-
  6297 000039DD 2020202020202020   
  6298 000039E5 202020202020202020-     	db  80 dup(32)
  6298 000039EE 202020202020202020-
  6298 000039F7 202020202020202020-
  6298 00003A00 202020202020202020-
  6298 00003A09 202020202020202020-
  6298 00003A12 202020202020202020-
  6298 00003A1B 202020202020202020-
  6298 00003A24 202020202020202020-
  6298 00003A2D 2020202020202020   
  6299 00003A35 202020202020202020-     	db  80 dup(32)
  6299 00003A3E 202020202020202020-
  6299 00003A47 202020202020202020-
  6299 00003A50 202020202020202020-
  6299 00003A59 202020202020202020-
  6299 00003A62 202020202020202020-
  6299 00003A6B 202020202020202020-
  6299 00003A74 202020202020202020-
  6299 00003A7D 2020202020202020   
  6300 00003A85 202020202020202020-     	db  80 dup(32)
  6300 00003A8E 202020202020202020-
  6300 00003A97 202020202020202020-
  6300 00003AA0 202020202020202020-
  6300 00003AA9 202020202020202020-
  6300 00003AB2 202020202020202020-
  6300 00003ABB 202020202020202020-
  6300 00003AC4 202020202020202020-
  6300 00003ACD 2020202020202020   
  6301 00003AD5 202020202020202020-     	db  80 dup(32)
  6301 00003ADE 202020202020202020-
  6301 00003AE7 202020202020202020-
  6301 00003AF0 202020202020202020-
  6301 00003AF9 202020202020202020-
  6301 00003B02 202020202020202020-
  6301 00003B0B 202020202020202020-
  6301 00003B14 202020202020202020-
  6301 00003B1D 2020202020202020   
  6302 00003B25 202020202020202020-     	db  80 dup(32)
  6302 00003B2E 202020202020202020-
  6302 00003B37 202020202020202020-
  6302 00003B40 202020202020202020-
  6302 00003B49 202020202020202020-
  6302 00003B52 202020202020202020-
  6302 00003B5B 202020202020202020-
  6302 00003B64 202020202020202020-
  6302 00003B6D 2020202020202020   
  6303 00003B75 202020202020202020-     	db  80 dup(32)
  6303 00003B7E 202020202020202020-
  6303 00003B87 202020202020202020-
  6303 00003B90 202020202020202020-
  6303 00003B99 202020202020202020-
  6303 00003BA2 202020202020202020-
  6303 00003BAB 202020202020202020-
  6303 00003BB4 202020202020202020-
  6303 00003BBD 2020202020202020   
  6304 00003BC5 202020202020202020-     	db  80 dup(32)
  6304 00003BCE 202020202020202020-
  6304 00003BD7 202020202020202020-
  6304 00003BE0 202020202020202020-
  6304 00003BE9 202020202020202020-
  6304 00003BF2 202020202020202020-
  6304 00003BFB 202020202020202020-
  6304 00003C04 202020202020202020-
  6304 00003C0D 2020202020202020   
  6305 00003C15 202020202020202020-     	db  80 dup(32)
  6305 00003C1E 202020202020202020-
  6305 00003C27 202020202020202020-
  6305 00003C30 202020202020202020-
  6305 00003C39 202020202020202020-
  6305 00003C42 202020202020202020-
  6305 00003C4B 202020202020202020-
  6305 00003C54 202020202020202020-
  6305 00003C5D 2020202020202020   
  6306 00003C65 202020202020202020-     	db  80 dup(32)
  6306 00003C6E 202020202020202020-
  6306 00003C77 202020202020202020-
  6306 00003C80 202020202020202020-
  6306 00003C89 202020202020202020-
  6306 00003C92 202020202020202020-
  6306 00003C9B 202020202020202020-
  6306 00003CA4 202020202020202020-
  6306 00003CAD 2020202020202020   
  6307 00003CB5 202020202020202020-     	db  80 dup(32)
  6307 00003CBE 202020202020202020-
  6307 00003CC7 202020202020202020-
  6307 00003CD0 202020202020202020-
  6307 00003CD9 202020202020202020-
  6307 00003CE2 202020202020202020-
  6307 00003CEB 202020202020202020-
  6307 00003CF4 202020202020202020-
  6307 00003CFD 2020202020202020   
  6308 00003D05 202020202020202020-     	db  80 dup(32)
  6308 00003D0E 202020202020202020-
  6308 00003D17 202020202020202020-
  6308 00003D20 202020202020202020-
  6308 00003D29 202020202020202020-
  6308 00003D32 202020202020202020-
  6308 00003D3B 202020202020202020-
  6308 00003D44 202020202020202020-
  6308 00003D4D 2020202020202020   
  6309 00003D55 202020202020202020-     	db  80 dup(32)
  6309 00003D5E 202020202020202020-
  6309 00003D67 202020202020202020-
  6309 00003D70 202020202020202020-
  6309 00003D79 202020202020202020-
  6309 00003D82 202020202020202020-
  6309 00003D8B 202020202020202020-
  6309 00003D94 202020202020202020-
  6309 00003D9D 2020202020202020   
  6310 00003DA5 202020202020202020-     	db  80 dup(32)
  6310 00003DAE 202020202020202020-
  6310 00003DB7 202020202020202020-
  6310 00003DC0 202020202020202020-
  6310 00003DC9 202020202020202020-
  6310 00003DD2 202020202020202020-
  6310 00003DDB 202020202020202020-
  6310 00003DE4 202020202020202020-
  6310 00003DED 2020202020202020   
  6311 00003DF5 202020202020202020-     	db  80 dup(32)
  6311 00003DFE 202020202020202020-
  6311 00003E07 202020202020202020-
  6311 00003E10 202020202020202020-
  6311 00003E19 202020202020202020-
  6311 00003E22 202020202020202020-
  6311 00003E2B 202020202020202020-
  6311 00003E34 202020202020202020-
  6311 00003E3D 2020202020202020   
  6312 00003E45 202020202020202020-     	db  80 dup(32)
  6312 00003E4E 202020202020202020-
  6312 00003E57 202020202020202020-
  6312 00003E60 202020202020202020-
  6312 00003E69 202020202020202020-
  6312 00003E72 202020202020202020-
  6312 00003E7B 202020202020202020-
  6312 00003E84 202020202020202020-
  6312 00003E8D 2020202020202020   
  6313 00003E95 CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6313 00003E9E CDCDCDCDCDCDCDCDCD-
  6313 00003EA7 CDCDCDCDCDCDCDCDCD-
  6313 00003EB0 CDCDCDCDCDCDCDCDCD-
  6313 00003EB9 CDCDCDCDCDCDCDCDCD-
  6313 00003EC2 CDCDCDCDCDCDCDCDCD-
  6313 00003ECB CDCDCDCDCDCDCDCDCD-
  6313 00003ED4 CDCDCDCDCDCDCDCDCD-
  6313 00003EDD CDCDCDCDCDCDCDCD   
  6314 00003EE5 202020202020202020-     	db  80 dup(32)
  6314 00003EEE 202020202020202020-
  6314 00003EF7 202020202020202020-
  6314 00003F00 202020202020202020-
  6314 00003F09 202020202020202020-
  6314 00003F12 202020202020202020-
  6314 00003F1B 202020202020202020-
  6314 00003F24 202020202020202020-
  6314 00003F2D 2020202020202020   
  6315 00003F35 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6315 00003F3E 202020202020202020-
  6315 00003F47 202020202020202020-
  6315 00003F50 20202020202030303A-
  6315 00003F59 303020AEAF2030303A-
  6315 00003F62 303020202020202020-
  6315 00003F6B 202020202020202020-
  6315 00003F74 202020202020202056-
  6315 00003F7D 4F4C2030303025     
  6316 00003F84 00                      	db 0
  6317                                  
  6318                                  ; -------------------------------------------------------------
  6319                                  
  6320                                  	; 22/12/2024
  6321                                  fillblock:
  6322 00003F85 FF<rep Eh>              	times 14 db 0FFh
  6323 00003F93 0000                    	dw 0
  6324                                  
  6325                                  ; -------------------------------------------------------------
  6326                                  
  6327                                  ; 23/11/2024
  6328                                  colors:
  6329 00003F95 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6330                                  	; white, cyan, green, red, yellow, blue, magenta
  6331 00003F9D 0B                      ccolor:	db 0Bh	; cyan
  6332                                  
  6333                                  EOF: 
  6334                                  
  6335                                  ; -------------------------------------------------------------
  6336                                  
  6337                                  bss:
  6338                                  
  6339                                  ABSOLUTE bss
  6340                                  
  6341 00003F9E ????                    alignb 4
  6342                                  
  6343                                  ; 21/12/2024
  6344                                  fontbuff1:
  6345 00003FA0 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6346                                  fontbuff2:
  6347 00004DA0 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6348                                  
  6349                                  ; 11/12/2024
  6350                                  wleds_addr:
  6351 00005DA0 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6352                                  ; 22/12/2024
  6353                                  prev_leds:
  6354 000071A0 <res 140h>              	resd 80	; previous lighting leds
  6355                                  
  6356                                  ; 24/12/2024
  6357                                  wpoints_dif:	; wave lighting points factor (differential) 
  6358 000072E0 ????????                	resd 1	; required bytes for 1/18 second wave lighting
  6359                                  graphstart:
  6360 000072E4 ????????                	resd 1	; start (top) line/row for wave lighting points 	 
  6361                                  
  6362                                  LFB_ADDR:
  6363 000072E8 ????????                	resd 1
  6364                                  ;nextrow:
  6365                                  	;resd 1
  6366                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6367 000072EC ????????                	resd 1
  6368 000072F0 ????????                wcolor:	resd 1
  6369                                  ; 26/12/2024
  6370                                  ;tcolor: resb 1 ; text color
  6371                                  columns:
  6372 000072F4 ??                      	resb 1
  6373 000072F5 ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6374                                  
  6375 000072F6 ????                    alignb 4
  6376                                  
  6377                                  bss_start:
  6378                                  
  6379                                  ; 24/12/2024
  6380                                  prev_points:
  6381 000072F8 <res A00h>              	resd 640 ; previous wave points (which are lighting)	
  6382                                  
  6383                                  ; 18/11/2024
  6384                                  stopped:
  6385 00007CF8 ??                      	resb 1
  6386 00007CF9 ??                      tLO:	resb 1
  6387                                  ; 21/11/2024
  6388 00007CFA ??                      tLP:	resb 1
  6389                                  ; 19/11/2024
  6390 00007CFB ??                      wleds:	resb 1
  6391                                  wleds_dif:
  6392 00007CFC ????????                	resd 1
  6393 00007D00 ????????                pbuf_o:	resd 1
  6394                                  ; 07/12/2024
  6395 00007D04 ??                      pbuf_s:	resb 1
  6396                                  
  6397                                  ; 07/12/2024
  6398                                  ; 24/11/2024
  6399                                  half_buffer:
  6400 00007D05 ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6401                                  
  6402                                  ; 30/05/2024
  6403 00007D06 ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6404                                  
  6405                                  ; 24/12/2024
  6406 00007D07 ??                      p_mode: resb 1	; point mode (as alternative to LED mode)
  6407                                  
  6408                                  ; 30/11/2024
  6409                                  alignb 4
  6410                                  
  6411                                  ;;;;;;;;;;;;;;
  6412                                  ; 14/11/2024
  6413                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6414                                  WAVFILEHEADERbuff:
  6415                                  RIFF_ChunkID:
  6416 00007D08 ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6417                                  		; 0x52494646
  6418                                  RIFF_ChunkSize:
  6419 00007D0C ????????                	resd 1	; Represents total file size, not 
  6420                                          	; including the first 2 fields 
  6421                                  		; (Total_File_Size - 8), little-endian
  6422                                  RIFF_Format:
  6423 00007D10 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6424                                  		; 0x57415645
  6425                                  
  6426                                  ;; WAVE header parameters ("Sub-chunk")
  6427                                  WAVE_SubchunkID:
  6428 00007D14 ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6429                                  		; 0x666d7420
  6430                                  WAVE_SubchunkSize:
  6431 00007D18 ????????                	resd 1	; Represents total chunk size
  6432                                  WAVE_AudioFormat:
  6433 00007D1C ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6434                                  		; of compression, not supported.
  6435                                  WAVE_NumChannels:
  6436 00007D1E ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6437                                  WAVE_SampleRate:
  6438 00007D20 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6439                                  WAVE_ByteRate:
  6440 00007D24 ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6441                                  WAVE_BlockAlign:
  6442 00007D28 ????                    	resw 1	; NumChannels * BytesPerSample
  6443                                  		; Number of bytes for one sample.
  6444                                  WAVE_BitsPerSample:
  6445 00007D2A ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6446                                  
  6447                                  ;; DATA header parameters
  6448                                  DATA_SubchunkID:
  6449 00007D2C ????????                	resd 1	; Must be equal to "data" - big-endian
  6450                                          	; 0x64617461
  6451                                  DATA_SubchunkSize:
  6452 00007D30 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6453                                          	; Number of bytes in the data.
  6454                                  ;;;;;;;;;;;;;;
  6455                                  
  6456                                  ; 28/12/2024
  6457                                  ; 15/11/2024
  6458                                  ;cursortype:
  6459 00007D34 ????                    	resw 1
  6460 00007D36 ??                      flags:	resb 1
  6461                                  ; 06/11/2023
  6462                                  ac97_int_ln_reg:
  6463 00007D37 ??                      	resb 1
  6464                                  filehandle:
  6465 00007D38 ????????                	resd 1
  6466                                  
  6467                                  ; 30/05/2024
  6468                                  wav_file_name:
  6469 00007D3C <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6470 00007D8C ????                    	resw 1	; 30/11/2024
  6471                                  
  6472                                  ; 08/11/2023
  6473                                  ; 07/11/2023
  6474                                  fbs_shift:
  6475 00007D8E ??                      	resb 1
  6476                                  ; 07/12/2024
  6477 00007D8F ??                      SRB:	resb 1
  6478                                  
  6479                                  ; 12/11/2016 - Erdogan Tan
  6480                                  bus_dev_fn:
  6481 00007D90 ????????                	resd 1
  6482                                  dev_vendor:
  6483 00007D94 ????????                	resd 1
  6484                                  
  6485                                  ; 17/02/2017
  6486                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6487                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6488                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6489                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6490 00007D98 ????                    NAMBAR:	resw 1	; BAR for mixer
  6491                                  NABMBAR:
  6492 00007D9A ????                    	resw 1	; BAR for bus master regs
  6493                                  
  6494                                  ; 15/11/2024
  6495                                  loadfromwavfile:
  6496 00007D9C ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6497                                  loadsize:
  6498 00007DA0 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6499                                  buffersize:
  6500 00007DA4 ????????                	resd 1	; 16 bit samples (not bytes)
  6501                                  		
  6502                                  ; 14/11/2024
  6503                                  TotalTime:
  6504 00007DA8 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6505                                  ProgressTime:
  6506 00007DAC ????????                	resd 1
  6507 00007DB0 ????????                count:	resd 1	; byte count of one (wav file) read
  6508                                  LoadedDataBytes:
  6509 00007DB4 ????????                	resd 1	; total read/load count
  6510                                  
  6511                                  timerticks:
  6512 00007DB8 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6513                                  		; (in order to get the emulator/qemu to run correctly)
  6514                                  ; 14/11/2024	
  6515                                  bss_end:
  6516                                  
  6517                                  ; 02/12/2024
  6518 00007DBC <res 244h>              alignb 4096
  6519                                  
  6520                                  ; 07/12/2024
  6521                                  ; 26/11/2023
  6522                                  audio_buffer:
  6523 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6524                                  
  6525                                  ; 01/12/2024
  6526                                  ; 26/11/2023
  6527                                  temp_buffer:
  6528 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
  6529                                  
  6530                                  ; 28/12/2024
  6531                                  alignb 4096
  6532 00028000 <res A00h>              g_buff:	resb 640*4
