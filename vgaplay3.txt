     1                                  ; ****************************************************************************
     2                                  ; vgaplay3.s - TRDOS 386 (TRDOS v2.0.9) WAV PLAYER - VESA VBE Video Mode 101h
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; VGAPLAY3.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 27/12/2024				- play music from multiple wav files -
     7                                  ;
     8                                  ; [ Last Modification: 18/01/2025 ]
     9                                  ;
    10                                  ; Modified from VGAPLAY2.PRG .wav player program by Erdogan Tan, 27/12/2024
    11                                  ;		AC97PLAy.PRG - 18/12/2024
    12                                  ;
    13                                  ; ****************************************************************************
    14                                  ; nasm vgaplay2.s -l vgaplay2.txt -o VGAPLAY2.PRG -Z error.txt
    15                                  
    16                                  ; 27/12/2024
    17                                  ; vgaplay2.s : DMA buffer tracking (instead of user's audio buffer)
    18                                  ; 18/12/2024
    19                                  ; ac97play.s : TUNELOOP version (playing without AC97 interrupt)
    20                                  
    21                                  ; vgaplay.s (26/12/2024) - play music from multiple wav files -
    22                                  ; dplayvga.s (25/12/2024) - play music from single wav file -
    23                                  ; ac97play.s (18/12/2024) - play music from multiple wav files -
    24                                  
    25                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    26                                  ; ------------------------------------------------------------
    27                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    28                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    29                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    30                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    31                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    32                                  
    33                                  ; ------------------------------------------------------------
    34                                  
    35                                  ; 30/11/2024
    36                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    37                                  ; 29/04/2016
    38                                  _ver 	equ 0
    39                                  _exit 	equ 1
    40                                  _fork 	equ 2
    41                                  _read 	equ 3
    42                                  _write	equ 4
    43                                  _open	equ 5
    44                                  _close 	equ 6
    45                                  _wait 	equ 7
    46                                  _creat 	equ 8
    47                                  _link 	equ 9
    48                                  _unlink	equ 10
    49                                  _exec	equ 11
    50                                  _chdir	equ 12
    51                                  _time 	equ 13
    52                                  _mkdir 	equ 14
    53                                  _chmod	equ 15
    54                                  _chown	equ 16
    55                                  _break	equ 17
    56                                  _stat	equ 18
    57                                  _seek	equ 19
    58                                  _tell 	equ 20
    59                                  _mount	equ 21
    60                                  _umount	equ 22
    61                                  _setuid	equ 23
    62                                  _getuid	equ 24
    63                                  _stime	equ 25
    64                                  _quit	equ 26
    65                                  _intr	equ 27
    66                                  _fstat	equ 28
    67                                  _emt 	equ 29
    68                                  _mdate 	equ 30
    69                                  _video 	equ 31
    70                                  _audio	equ 32
    71                                  _timer	equ 33
    72                                  _sleep	equ 34
    73                                  _msg    equ 35
    74                                  _geterr	equ 36
    75                                  _fpsave	equ 37
    76                                  _pri	equ 38
    77                                  _rele	equ 39
    78                                  _fff	equ 40
    79                                  _fnf	equ 41
    80                                  _alloc	equ 42
    81                                  _dalloc equ 43
    82                                  _calbac equ 44
    83                                  _dma	equ 45
    84                                  _stdio  equ 46
    85                                  
    86                                  ; ------------------------------------------------------------
    87                                  
    88                                  %macro sys 1-4
    89                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    90                                      ; 03/09/2015
    91                                      ; 13/04/2015
    92                                      ; Retro UNIX 386 v1 system call.
    93                                      %if %0 >= 2
    94                                          mov ebx, %2
    95                                          %if %0 >= 3
    96                                              mov ecx, %3
    97                                              %if %0 = 4
    98                                                 mov edx, %4
    99                                              %endif
   100                                          %endif
   101                                      %endif
   102                                      mov eax, %1
   103                                      ;int 30h
   104                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   105                                  %endmacro
   106                                  
   107                                  ; Retro UNIX 386 v1 system call format:
   108                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   109                                  
   110                                  ; ------------------------------------------------------------
   111                                  
   112                                  ; player internal variables and other equates.
   113                                  BUFFERSIZE	equ 65536
   114                                  ENDOFFILE	equ 1		; flag for knowing end of file
   115                                  
   116                                  ; ------------------------------------------------------------
   117                                  
   118                                  [BITS 32] ; 32-bit intructions
   119                                  
   120                                  [ORG 0]
   121                                  
   122                                  START_CODE:
   123                                  	; Prints the Credits Text.
   124                                  	sys	_msg, Credits, 255, 0Bh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000000 BB[DC2F0000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000005 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000000A BA0B000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000000F B823000000          <1>  mov eax, %1
   103                              <1> 
   104 00000014 CD40                <1>  int 40h
   125                                  
   126                                  	; clear bss
   127 00000016 BF[B07A0000]            	mov	edi, bss_start
   128 0000001B B9B8020000              	mov	ecx, (bss_end - bss_start)/4
   129 00000020 31C0                    	xor	eax, eax
   130 00000022 F3AB                    	rep	stosd
   131                                  
   132                                  ; -------------------------------------------------------------
   133                                  
   134                                  	; 21/12/2024
   135                                  	; Detect (& Enable) AC'97 Audio Device
   136 00000024 E844090000              	call	DetectAC97
   137 00000029 731B                    	jnc	short ac97_hardware_ready
   138                                  
   139                                  	; 30/11/2024
   140                                  	; 30/05/2024
   141                                  _dev_not_ready:
   142                                  	; couldn't find the audio device!
   143                                  	sys	_msg, noDevMsg, 255, 0Fh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000002B BB[7F300000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000030 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000035 BA0F000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000003A B823000000          <1>  mov eax, %1
   103                              <1> 
   104 0000003F CD40                <1>  int 40h
   144 00000041 E9AF050000                      jmp     Exit
   145                                  
   146                                  ac97_hardware_ready:
   147 00000046 E8590F0000              	call	write_audio_dev_info
   148                                  
   149                                  ; -------------------------------------------------------------
   150                                  
   151                                  	; 21/12/2024
   152                                  	;;;
   153                                  	; Read (copy) 8x14 system fonts
   154 0000004B BE[58470000]            	mov	esi, fontbuff1
   155                                  	sys	_video, 0C03h, 256, 0
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000050 BB030C0000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000055 B900010000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000005A BA00000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000005F B81F000000          <1>  mov eax, %1
   103                              <1> 
   104 00000064 CD40                <1>  int 40h
   156                                  
   157                                  	; convert 8x14 fonts to 8x16 fonts
   158                                  	; by inserting 2 empty rows to each characters
   159                                  	;mov	esi, fontbuff1
   160 00000066 BF[58550000]            	mov	edi, fontbuff2
   161                                  	; 18/02/2021
   162                                  	;mov	cx, 256
   163                                  fontconvert:
   164 0000006B 51                      	push	ecx
   165 0000006C 66B90E00                	mov	cx, 14
   166 00000070 F3A4                    	rep	movsb
   167 00000072 28C0                    	sub	al, al
   168 00000074 AA                      	stosb
   169 00000075 AA                      	stosb
   170 00000076 59                      	pop	ecx
   171 00000077 E2F2                    	loop	fontconvert
   172                                  	;;;
   173                                  
   174                                  ; ------------------------------------------------------------- 
   175                                  
   176                                  	; 21/12/2024
   177                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   178                                  	sys	_video, 08FFh, 101h
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000079 BBFF080000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 0000007E B901010000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000083 B81F000000          <1>  mov eax, %1
   103                              <1> 
   104 00000088 CD40                <1>  int 40h
   179 0000008A 09C0                    	or	eax, eax
   180 0000008C 0F845E050000            	jz	terminate    ; nothing to do				
   181                                  	;jz	trdos386_err ; write (OS) error msg and exit
   182                                  
   183                                  set_vesa_mode_101h_ok:
   184                                  	; linear frame buffer access
   185                                  	sys	_video, 06FFh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000092 BBFF060000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000097 B81F000000          <1>  mov eax, %1
   103                              <1> 
   104 0000009C CD40                <1>  int 40h
   186 0000009E 21C0                    	and	eax, eax
   187 000000A0 0F8492050000            	jz	error_exit ; set text mode and write err msg
   188 000000A6 A3[A07A0000]            	mov	[LFB_ADDR], eax
   189                                  
   190                                  ; -------------------------------------------------------------
   191                                  
   192                                  	; 25/12/2024
   193                                  	; 28/11/2024
   194                                  Player_InitalizePSP:
   195                                  	; 30/11/2024
   196                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   197                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   198                                  	;			.. argv0text, argv1text ..) 
   199                                  	; ---- argc, argv[] ----
   200 000000AB 89E6                    	mov	esi, esp
   201 000000AD AD                      	lodsd
   202 000000AE 83F802                  	cmp	eax, 2 ; two arguments 
   203                                  		; (program file name & mod file name)
   204 000000B1 0F8247050000            	jb	pmsg_usage ; nothing to do
   205                                  	;mov	[argc], al
   206 000000B7 C1E002                  	shl	eax, 2 ; *4
   207 000000BA 01E0                    	add	eax, esp
   208                                  	; eax = last argument's address pointer
   209 000000BC A3[08850000]            	mov	[argvl], eax ; last wav file (argument)
   210 000000C1 8935[00850000]          	mov	[argv], esi ; current argument (PRG file name)
   211 000000C7 AD                      	lodsd	; skip program (PRG) file name
   212 000000C8 8935[04850000]          	mov	[argvf], esi ; 1st wav file (argument)
   213                                  
   214                                  	; 25/12/2024
   215                                  Player_ParseParameters:
   216                                  	; 30/11/2024
   217                                  	; 29/11/2024
   218                                  	; 18/12/2024
   219                                  	;mov	edx, wav_file_name
   220                                  	
   221                                  	; 26/12/2024
   222                                  	;cmp	byte [IsInSplash], 0
   223                                  	;jna	short check_p_command
   224                                  
   225 000000CE BA[32470000]            	mov	edx, SplashFileName
   226 000000D3 EB3E                    	jmp	short _1
   227                                  
   228                                  	; 25/12/2024
   229                                  check_p_command:
   230                                  	; 07/12/2024
   231 000000D5 8B35[00850000]          	mov	esi, [argv]
   232                                  	;
   233 000000DB 803D[C7840000]50          	cmp	byte [command], 'P'
   234 000000E2 7410                    	je	short Player_ParsePreviousParameter
   235                                      
   236                                  	; 07/12/2024
   237                                  	; 30/11/2024
   238                                  	;mov	esi, [argv] ; current argument (wav file) ptr
   239 000000E4 83C604                  	add	esi, 4
   240 000000E7 3B35[08850000]          	cmp	esi, [argvl] ; last argument (wav file) ptr
   241 000000ED 7610                    	jna	short Player_ParseNextParameter
   242                                  jmp_Player_Quit:
   243 000000EF E9E9050000              	jmp	Player_Quit
   244                                  
   245                                  Player_ParsePreviousParameter:
   246                                  	; 29/11/2024
   247                                  	;mov	byte [command], 0
   248                                  	; 30/11/2024
   249                                  	;mov	esi, [argv] ; 07/12/2024	
   250 000000F4 3B35[04850000]          	cmp	esi, [argvf] ; first argument (wav file) ptr
   251 000000FA 7603                    	jna	short Player_ParseNextParameter
   252 000000FC 83EE04                  	sub	esi, 4
   253                                  Player_ParseNextParameter:
   254                                  	; 30/11/2024
   255 000000FF 8935[00850000]          	mov	[argv], esi  ; set as current argument
   256                                  	; 01/12/2024
   257 00000105 8B36                    	mov	esi, [esi]
   258                                  	; 07/12/2024
   259                                  	;mov	ecx, esi
   260                                  	;mov	esi, [ecx]
   261                                  
   262                                  	; 29/11/2024
   263 00000107 E84D000000              	call	GetFileName
   264                                  	;jcxz	jmp_Player_Quit
   265 0000010C E3E1                    	jecxz	jmp_Player_Quit ; 30/11/2024
   266                                  
   267                                  	; 30/11/2024
   268                                  	; 28/11/2024
   269 0000010E BA[0C850000]            	mov	edx, wav_file_name
   270                                  	;;;
   271                                  _1:
   272                                  
   273                                  ; open the file
   274                                          ; open existing file
   275                                  	; 28/11/2024
   276                                  	;mov	edx, wav_file_name
   277 00000113 E8A5080000                      call	openFile ; no error? ok.
   278 00000118 0F8383000000                    jnc	getwavparms	; 14/11/2024
   279                                  
   280                                  	; 28/11/2024
   281 0000011E 803D[31470000]00        	cmp	byte [IsInSplash], 0
   282 00000125 0F87A4000000            	ja	Player_SplashScreen
   283                                  
   284                                  	; 29/11/2024
   285 0000012B 803D[C8840000]00        	cmp	byte [filecount], 0
   286 00000132 77A1                    	ja	short check_p_command
   287                                  
   288                                  	; 25/12/2024
   289                                  	; 21/12/2024
   290 00000134 E89C050000              	call	set_text_mode
   291                                  	; file not found!
   292                                  	; 30/11/2024
   293                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000139 BB[AA300000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 0000013E B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000143 BA0C000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000148 B823000000          <1>  mov eax, %1
   103                              <1> 
   104 0000014D CD40                <1>  int 40h
   294 0000014F E9A1040000                      jmp     Exit
   295                                  
   296                                  _exit_:
   297 00000154 E997040000              	jmp	terminate
   298                                  
   299                                  ; -------------------------------------------------------------
   300                                  
   301                                  	; 26/12/2024
   302                                  	; 25/12/2024
   303                                  	; 30/11/2024 (32bit)
   304                                  	; 29/11/2024
   305                                  	; 30/05/2024
   306                                  GetFileName:
   307 00000159 BF[0C850000]            	mov	edi, wav_file_name 
   308                                  	; 30/11/2024
   309                                  	;mov	esi, [argv]
   310 0000015E 31C9                    	xor	ecx, ecx ; 0
   311                                  ScanName:
   312 00000160 AC                      	lodsb
   313                                  	;test	al, al
   314                                  	;jz	short a_4
   315                                  	; 29/11/2024
   316 00000161 3C0D                    	cmp	al, 0Dh
   317 00000163 7638                    	jna	short a_4
   318 00000165 3C20                    	cmp	al, 20h
   319 00000167 74F7                    	je	short ScanName	; scan start of name.
   320 00000169 AA                      	stosb
   321 0000016A B4FF                    	mov	ah, 0FFh
   322                                  	;;;
   323                                  	; 14/11/2024
   324                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   325                                  	;xor	ecx, ecx ; 0
   326                                  	;;;
   327                                  a_0:	
   328 0000016C FEC4                    	inc	ah
   329                                  a_1:
   330                                  	;;;
   331                                  	; 14/11/2024
   332 0000016E 41                      	inc	ecx
   333                                  	;;;
   334 0000016F AC                      	lodsb
   335 00000170 AA                      	stosb
   336 00000171 3C2E                    	cmp	al, '.'
   337 00000173 74F7                    	je	short a_0
   338                                  	; 29/11/2024
   339 00000175 3C20                    	cmp	al, 20h
   340                                  	;and	al, al
   341                                  	;jnz	short a_1
   342                                  	;;;
   343                                  	; 14/11/2024
   344 00000177 7613                    	jna	short a_3
   345 00000179 20E4                    	and	ah, ah
   346 0000017B 7406                    	jz	short a_2
   347 0000017D 3C2F                    	cmp	al, '/'	; 14/12/2024
   348 0000017F 7502                    	jne	short a_2
   349 00000181 B400                    	mov	ah, 0
   350                                  a_2:
   351 00000183 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   352 00000186 72E6                    	jb	short a_1
   353                                  	; 29/11/2024
   354 00000188 29C9                    	sub	ecx, ecx
   355 0000018A EB11                    	jmp	short a_4
   356                                  a_3:
   357                                  	; 29/11/2024
   358 0000018C 4F                      	dec	edi
   359                                  	;;;
   360 0000018D 08E4                    	or	ah, ah		; if period NOT found,
   361 0000018F 750C                    	jnz	short a_4 	; then add a .WAV extension.
   362                                  SetExt:
   363                                  	; 29/11/2024
   364                                  	;dec	edi
   365 00000191 C7072E574156            	mov	dword [edi], '.WAV'
   366                                  				; ! 64+12 is DOS limit
   367                                  				; but writing +4 must not
   368                                  				; destroy the following data	 
   369                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   370                                  	; 29/11/2024
   371 00000197 83C104                  	add	ecx, 4
   372 0000019A 83C704                  	add	edi, 4
   373                                  a_4:	
   374 0000019D C60700                  	mov	byte [edi], 0
   375                                  	; 30/11/2024
   376 000001A0 C3                      	retn
   377                                  
   378                                  ; -------------------------------------------------------------
   379                                  
   380                                  getwavparms:
   381                                  	; 14/11/2024
   382 000001A1 E849080000                     	call    getWAVParameters
   383 000001A6 72AC                    	jc	short _exit_		; nothing to do
   384                                  
   385                                  	; 17/11/2024
   386 000001A8 B304                    	mov	bl, 4
   387 000001AA 2A1D[EC840000]          	sub	bl, byte [WAVE_BlockAlign]
   388                                  			; = 0 for 16 bit stereo
   389                                  			; = 2 for 8 bit stereo or 16 bit mono
   390                                  			; = 3 for 8 bit mono	
   391                                  
   392 000001B0 D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   393                                  	; 15/11/2024
   394 000001B2 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   395 000001B5 881D[5E850000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   396                                  					; = 0 stereo and 16 bit
   397                                  					; = 1 mono or 8 bit
   398                                  	; 29/12/2024
   399                                  	; 30/05/2024
   400 000001BB E890090000              	call	codecConfig		; unmute codec, set rates.
   401 000001C0 0F8255040000            	jc	init_err
   402                                  
   403                                  ; -------------------------------------------------------------
   404                                  
   405                                  	; 25/12/2024
   406 000001C6 803D[31470000]00        	cmp 	byte [IsInSplash], 0
   407                                  	;jna	short StartPlay
   408                                  	; 27/12/2024
   409 000001CD 7672                    	jna	short StartPlay@
   410                                  
   411                                  ; -------------------------------------------------------------
   412                                  
   413                                  	; 26/12/2024
   414                                  Player_SplashScreen:
   415                                  	; 21/12/2024
   416                                  	;mov	byte [tcolor], 15
   417                                  _0:
   418 000001CF E8A2040000              	call	drawsplashscreen
   419                                  
   420                                  	; 21/12/2024
   421                                  	;;;
   422                                  	; set wave volume led addresses
   423 000001D4 8B1D[A07A0000]          	mov	ebx, [LFB_ADDR]
   424 000001DA 81C300C70100            	add	ebx, (13*80*8*14)
   425 000001E0 BD50000000              	mov	ebp, 80
   426 000001E5 BF[58650000]            	mov	edi, wleds_addr
   427                                  wleds_sa_1:
   428 000001EA B90F000000              	mov	ecx, 15
   429                                  wleds_sa_2:
   430 000001EF B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   431 000001F4 F7E1                    	mul	ecx
   432 000001F6 01D8                    	add	eax, ebx
   433 000001F8 AB                      	stosd
   434 000001F9 E2F4                    	loop	wleds_sa_2
   435 000001FB 89D8                    	mov	eax, ebx
   436 000001FD AB                      	stosd
   437 000001FE 83C308                  	add	ebx, 8
   438 00000201 4D                      	dec	ebp
   439 00000202 75E6                    	jnz	short wleds_sa_1
   440                                  	;;;
   441                                  
   442                                  	; 25/12/5024
   443                                  	; 28/11/2024 
   444 00000204 833D[FC840000]FF        	cmp	dword [filehandle], -1
   445 0000020B 7573                    	jne	short StartPlay
   446                                  
   447                                  	; 24/12/2024
   448                                  	; 07/12/2024
   449                                  	;;; wait for 3 seconds
   450                                  	sys	_time, 0 ; get time in unix epoch format
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000020D BB00000000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000212 B80D000000          <1>  mov eax, %1
   103                              <1> 
   104 00000217 CD40                <1>  int 40h
   451 00000219 89C1                    	mov	ecx, eax
   452 0000021B 83C103                  	add	ecx, 3
   453                                  _wait_3s:
   454 0000021E 90                      	nop
   455                                  	sys	_time, 0
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000021F BB00000000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000224 B80D000000          <1>  mov eax, %1
   103                              <1> 
   104 00000229 CD40                <1>  int 40h
   456 0000022B 39C8                    	cmp	eax, ecx
   457 0000022D 72EF                    	jb	short _wait_3s
   458                                  	;;;
   459                                  
   460                                  	; 25/12/2024
   461                                  	; 28/11/2024
   462 0000022F C605[31470000]00        	mov	byte [IsInSplash], 0
   463                                  	;mov	edx, wav_file_name
   464                                  	; 30/11/2024
   465 00000236 8B35[04850000]          	mov	esi, [argvf]
   466                                  	; 29/11/2024
   467 0000023C E9BEFEFFFF              	jmp	Player_ParseNextParameter
   468                                  
   469                                  ; -------------------------------------------------------------
   470                                  
   471                                  StartPlay@:
   472                                  	; 29/12/2024
   473                                  	; 19/11/2024
   474 00000241 C605[B7840000]01        	mov	byte [wleds], 1
   475                                  
   476                                  	;;;
   477                                  	; 09/12/2024
   478 00000248 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
   479 0000024D 803D[C5840000]00        	cmp	byte [VRA], 0
   480 00000254 7614                    	jna	short _w1 ; 48kHZ (interpolation)
   481                                  	;;;
   482                                  	; 01/12/2024 (32bit)
   483                                  	;movzx	eax, word [WAVE_SampleRate]
   484                                  	; 09/12/2024
   485 00000256 66A1[E4840000]          	mov	ax, [WAVE_SampleRate]
   486 0000025C B90A000000              	mov	ecx, 10
   487 00000261 F7E1                    	mul	ecx
   488 00000263 B1B6                    	mov	cl, 182
   489 00000265 F7F1                    	div	ecx
   490                                  	; ax = samples per 1/18.2 second
   491                                  	;mov	cl, byte [WAVE_BlockAlign]
   492                                  	; 09/12/2024 
   493                                  	;mov	cl, 4 ; 16 bit, stereo
   494                                  	;mul	ecx
   495 00000267 C1E002                  	shl	eax, 2 ; * 4
   496                                  _w1:
   497 0000026A A3[B8840000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
   498                                  				; for wave volume leds update
   499                                  				; (byte stream per 1/18.2 second)
   500                                  	;;;
   501                                  	; 24/12/2024
   502 0000026F 3D000A0000              	cmp	eax, 640*4 ; 640 samples (for 640 wave light points)
   503 00000274 7305                    	jnb	short _w2
   504 00000276 B8000A0000              	mov	eax, 640*4	
   505                                  _w2:
   506 0000027B A3[987A0000]            	mov	[wpoints_dif], eax
   507                                  	;;;
   508                                  
   509                                  ; -------------------------------------------------------------
   510                                  
   511                                  	; 25/12/2024
   512                                  StartPlay:
   513 00000280 FE05[C8840000]          	inc	byte [filecount]
   514 00000286 C605[C7840000]00        	mov	byte [command], 0
   515                                  
   516                                  ; -------------------------------------------------------------
   517                                  
   518                                  	; 07/12/2024 (playwav9.s)
   519                                  
   520                                  	; 18/11/2023 (ich_wav4.asm)
   521                                  	; 13/11/2023 (ich_wav3.asm)
   522                                  
   523 0000028D 803D[C5840000]01        	cmp	byte [VRA], 1
   524 00000294 7226                    	jb	short chk_sample_rate
   525                                  
   526                                  playwav_48_khz:
   527 00000296 C705[6C850000]-         	mov	dword [loadfromwavfile], loadFromFile
   527 0000029C [D60E0000]         
   528                                  	;mov	dword [loadsize], 0 ; 65536
   529                                  	;;;
   530                                  	; 17/11/2024
   531                                  	;mov	word [buffersize], 32768
   532                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   533                                  	; 30/11/2024
   534                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   535                                  	; 07/12/2024
   536 000002A0 B800000100              	mov	eax, BUFFERSIZE ; 65536
   537 000002A5 A3[74850000]            	mov	[buffersize], eax	; 16 bit samples
   538                                  	; 07/12/2024
   539                                  	;shl	eax, 1			; bytes
   540 000002AA 8A0D[5E850000]          	mov	cl, [fbs_shift]
   541 000002B0 D3E8                    	shr	eax, cl 
   542                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   543 000002B2 A3[70850000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   544                                  	;;;
   545                                  	;jmp	PlayNow ; 30/05/2024
   546                                  	; 07/12/2024
   547 000002B7 E95F020000              	jmp	Player_Template
   548                                  
   549                                  chk_sample_rate:
   550                                  	; set conversion parameters
   551                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   552 000002BC 66A1[E4840000]          	mov	ax, [WAVE_SampleRate]
   553 000002C2 663D80BB                	cmp	ax, 48000
   554 000002C6 74CE                    	je	short playwav_48_khz
   555                                  chk_22khz:
   556 000002C8 663D2256                	cmp	ax, 22050
   557 000002CC 7545                    	jne	short chk_11khz
   558 000002CE 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   559 000002D5 7615                    	jna	short chk_22khz_1
   560 000002D7 BB[B61E0000]            	mov	ebx, load_22khz_stereo_16_bit
   561 000002DC 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   562 000002E3 751A                    	jne	short chk_22khz_2
   563 000002E5 BB[231E0000]            	mov	ebx, load_22khz_mono_16_bit
   564 000002EA EB13                    	jmp	short chk_22khz_2
   565                                  chk_22khz_1:
   566 000002EC BB[961D0000]            	mov	ebx, load_22khz_stereo_8_bit
   567 000002F1 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   568 000002F8 7505                    	jne	short chk_22khz_2
   569 000002FA BB[071D0000]            	mov	ebx, load_22khz_mono_8_bit
   570                                  chk_22khz_2:
   571 000002FF B85A1D0000              	mov	eax, 7514  ; (442*17)
   572 00000304 BA25000000              	mov	edx, 37
   573 00000309 B911000000              	mov	ecx, 17
   574 0000030E E9DB010000              	jmp	set_sizes
   575                                  chk_11khz:
   576 00000313 663D112B                	cmp	ax, 11025
   577 00000317 7545                    	jne	short chk_44khz
   578 00000319 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   579 00000320 7615                    	jna	short chk_11khz_1
   580 00000322 BB[EA200000]            	mov	ebx, load_11khz_stereo_16_bit
   581 00000327 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   582 0000032E 751A                    	jne	short chk_11khz_2
   583 00000330 BB[6B200000]            	mov	ebx, load_11khz_mono_16_bit
   584 00000335 EB13                    	jmp	short chk_11khz_2
   585                                  chk_11khz_1:
   586 00000337 BB[E61F0000]            	mov	ebx, load_11khz_stereo_8_bit
   587 0000033C 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1 
   588 00000343 7505                    	jne	short chk_11khz_2
   589 00000345 BB[6D1F0000]            	mov	ebx, load_11khz_mono_8_bit
   590                                  chk_11khz_2:
   591 0000034A B8AD0E0000              	mov	eax, 3757  ; (221*17)
   592 0000034F BA4A000000              	mov	edx, 74
   593 00000354 B911000000              	mov	ecx, 17
   594 00000359 E990010000              	jmp	set_sizes
   595                                  chk_44khz:
   596 0000035E 663D44AC                	cmp	ax, 44100
   597 00000362 7545                    	jne	short chk_16khz
   598 00000364 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   599 0000036B 7615                    	jna	short chk_44khz_1
   600 0000036D BB[09230000]            	mov	ebx, load_44khz_stereo_16_bit
   601 00000372 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   602 00000379 751A                    	jne	short chk_44khz_2
   603 0000037B BB[8A220000]            	mov	ebx, load_44khz_mono_16_bit
   604 00000380 EB13                    	jmp	short chk_44khz_2
   605                                  chk_44khz_1:
   606 00000382 BB[07220000]            	mov	ebx, load_44khz_stereo_8_bit
   607 00000387 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   608 0000038E 7505                    	jne	short chk_44khz_2
   609 00000390 BB[85210000]            	mov	ebx, load_44khz_mono_8_bit
   610                                  chk_44khz_2:
   611                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   612 00000395 B8D93A0000              	mov	eax, 15065 ; (655*23)
   613                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   614                                  	;mov	ax, 14076 ; (612*23)
   615                                  	; 17/11/2024
   616                                  	;mov	ax, 12650 ; (550*23)
   617 0000039A BA19000000              	mov	edx, 25
   618 0000039F B917000000              	mov	ecx, 23
   619 000003A4 E945010000              	jmp	set_sizes
   620                                  chk_16khz:
   621 000003A9 663D803E                	cmp	ax, 16000
   622 000003AD 7545                    	jne	short chk_8khz
   623 000003AF 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   624 000003B6 7615                    	jna	short chk_16khz_1
   625 000003B8 BB[16180000]            	mov	ebx, load_16khz_stereo_16_bit
   626 000003BD 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1 
   627 000003C4 751A                    	jne	short chk_16khz_2
   628 000003C6 BB[8F170000]            	mov	ebx, load_16khz_mono_16_bit
   629 000003CB EB13                    	jmp	short chk_16khz_2
   630                                  chk_16khz_1:
   631 000003CD BB[CF160000]            	mov	ebx, load_16khz_stereo_8_bit
   632 000003D2 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   633 000003D9 7505                    	jne	short chk_16khz_2
   634 000003DB BB[4A160000]            	mov	ebx, load_16khz_mono_8_bit
   635                                  chk_16khz_2:
   636                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   637 000003E0 B855150000              	mov	eax, 5461
   638                                  	; 17/11/2024
   639                                  	;mov	ax, 5460
   640 000003E5 BA03000000              	mov	edx, 3
   641 000003EA B901000000              	mov	ecx, 1
   642 000003EF E9FA000000              	jmp	set_sizes
   643                                  chk_8khz:
   644 000003F4 663D401F                	cmp	ax, 8000
   645 000003F8 7545                    	jne	short chk_24khz
   646 000003FA 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   647 00000401 7615                    	jna	short chk_8khz_1
   648 00000403 BB[F9140000]            	mov	ebx, load_8khz_stereo_16_bit
   649 00000408 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   650 0000040F 751A                    	jne	short chk_8khz_2
   651 00000411 BB[23140000]            	mov	ebx, load_8khz_mono_16_bit
   652 00000416 EB13                    	jmp	short chk_8khz_2
   653                                  chk_8khz_1:
   654 00000418 BB[ED120000]            	mov	ebx, load_8khz_stereo_8_bit
   655 0000041D 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1 
   656 00000424 7505                    	jne	short chk_8khz_2
   657 00000426 BB[FF110000]            	mov	ebx, load_8khz_mono_8_bit
   658                                  chk_8khz_2:
   659 0000042B B8AA0A0000              	mov	eax, 2730
   660 00000430 BA06000000              	mov	edx, 6
   661 00000435 B901000000              	mov	ecx, 1
   662 0000043A E9AF000000              	jmp	set_sizes
   663                                  chk_24khz:
   664 0000043F 663DC05D                	cmp	ax, 24000
   665 00000443 7563                    	jne	short chk_32khz
   666 00000445 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   667 0000044C 7615                    	jna	short chk_24khz_1
   668                                  	; 18/01/2025 (BugFix)
   669                                  	; bx -> ebx
   670 0000044E BB[581A0000]            	mov	ebx, load_24khz_stereo_16_bit
   671 00000453 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   672 0000045A 751A                    	jne	short chk_24khz_2
   673 0000045C BB[EF190000]            	mov	ebx, load_24khz_mono_16_bit
   674 00000461 EB13                    	jmp	short chk_24khz_2
   675                                  chk_24khz_1:
   676 00000463 BB[5F190000]            	mov	ebx, load_24khz_stereo_8_bit
   677 00000468 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1 
   678 0000046F 7505                    	jne	short chk_24khz_2
   679 00000471 BB[F2180000]            	mov	ebx, load_24khz_mono_8_bit
   680                                  chk_24khz_2:
   681                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   682 00000476 B800200000              	mov	eax, 8192
   683                                  	; 17/11/2024
   684                                  	;mov	ax, 8190
   685 0000047B BA02000000              	mov	edx, 2
   686 00000480 B901000000              	mov	ecx, 1
   687 00000485 EB67                    	jmp	short set_sizes
   688                                  
   689                                  	; 07/12/2024
   690                                  vra_needed:
   691                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   692                                  	; 13/11/2023
   693 00000487 58                      	pop	eax ; discard return address to the caller
   694                                  	; 30/05/2024
   695                                  vra_err:
   696                                  	; 21/12/2024
   697 00000488 E848020000              	call	set_text_mode
   698                                  	; 30/11/2024
   699                                  	sys	_msg, msg_no_vra, 255, 0Fh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000048D BB[14310000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000492 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000497 BA0F000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000049C B823000000          <1>  mov eax, %1
   103                              <1> 
   104 000004A1 CD40                <1>  int 40h
   700 000004A3 E94D010000              	jmp	Exit
   701                                  
   702                                  chk_32khz:
   703 000004A8 663D007D                	cmp	ax, 32000
   704 000004AC 75D9                    	jne	short vra_needed
   705 000004AE 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8
   706 000004B5 7615                    	jna	short chk_32khz_1
   707 000004B7 BB[711C0000]            	mov	ebx, load_32khz_stereo_16_bit
   708 000004BC 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   709 000004C3 751A                    	jne	short chk_32khz_2
   710 000004C5 BB[011C0000]            	mov	ebx, load_32khz_mono_16_bit
   711 000004CA EB13                    	jmp	short chk_32khz_2
   712                                  chk_32khz_1:
   713 000004CC BB[5E1B0000]            	mov	ebx, load_32khz_stereo_8_bit
   714 000004D1 803D[E2840000]01        	cmp	byte [WAVE_NumChannels], 1
   715 000004D8 7505                    	jne	short chk_32khz_2
   716 000004DA BB[E51A0000]            	mov	ebx, load_32khz_mono_8_bit
   717                                  chk_32khz_2:
   718                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   719 000004DF B8AA2A0000              	mov	eax, 10922
   720                                  	; 17/11/2024
   721                                  	;mov	ax, 10920
   722 000004E4 BA03000000              	mov	edx, 3
   723 000004E9 B902000000              	mov	ecx, 2
   724                                  	;jmp	short set_sizes
   725                                  set_sizes:
   726                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   727                                  	;;;
   728                                  	; 17/11/2024
   729 000004EE 51                      	push	ecx
   730 000004EF B102                    	mov	cl, 2
   731 000004F1 2A0D[5E850000]          	sub	cl, [fbs_shift]
   732                                  		; = 2 for 16 bit stereo
   733                                  		; = 1 for 16 bit mono or 8 bit stereo
   734                                  		; = 0 for 8 bit mono
   735 000004F7 D3E0                    	shl	eax, cl
   736 000004F9 59                      	pop	ecx	
   737 000004FA A3[70850000]            	mov	[loadsize], eax	; (one) read count in bytes
   738                                  	;;;
   739 000004FF F7E2                    	mul	edx
   740 00000501 83F901                  	cmp	ecx, 1
   741 00000504 7402                    	je	short s_2
   742                                  s_1:
   743 00000506 F7F1                    	div	ecx
   744                                  s_2:
   745                                  	;;;
   746                                  	; eax = byte count of (to be) converted samples 
   747                                  	
   748                                  	; 17/11/2024
   749                                  	;;;
   750 00000508 8A0D[5E850000]          	mov	cl, [fbs_shift]
   751                                  
   752 0000050E D3E0                    	shl	eax, cl
   753                                  		; *1 for 16 bit stereo
   754                                  		; *2 for 16 bit mono or 8 bit stereo
   755                                  		; *4 for for 8 bit mono
   756                                  	;;;
   757                                  
   758                                  	; eax = 16 bit stereo byte count (target buffer size)
   759                                  	
   760                                  	; 07/12/2024
   761                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   762 00000510 A3[74850000]            	mov	[buffersize], eax ; buffer size in bytes
   763 00000515 891D[6C850000]          	mov	[loadfromwavfile], ebx
   764                                  
   765                                  ; -------------------------------------------------------------
   766                                  
   767                                  Player_Template:
   768                                  
   769                                  	; 26/12/2024
   770 0000051B 803D[31470000]00        	cmp 	byte [IsInSplash], 0
   771 00000522 7611                    	jna	short Player_Template_@
   772                                  
   773                                  	; 24/12/2024 (setting for wave lighting points)
   774 00000524 A1[A07A0000]            	mov	eax, [LFB_ADDR]
   775                                  	;add	eax, 228*640 ; wave graphics start (top) line/row
   776 00000529 05009A0100              	add	eax, 164*640 ; 256 volume levels ; 24/12/2024
   777 0000052E A3[9C7A0000]            	mov	[graphstart], eax
   778                                  
   779                                  	; 26/12/2024
   780 00000533 EB14                    	jmp	short PlayNow
   781                                  
   782                                  Player_Template_@:
   783                                  	; 21/12/2024
   784 00000535 E82C010000              	call	clearscreen
   785 0000053A E843010000              	call	drawplayingscreen
   786                                  
   787                                  	; 14/11/2024
   788 0000053F E817260000              	call	SetTotalTime
   789 00000544 E8E4260000              	call	UpdateFileInfo
   790                                  
   791                                  ; -------------------------------------------------------------
   792                                  
   793                                  	; 29/12/2024 (vgaplay3.s)
   794                                  	; 18/12/2024 (ac97play.s)
   795                                  PlayNow:
   796                                  	; 01/12/2024 (32bit)
   797                                  	; 14/11/2024
   798                                  	;mov	al, 3	; 0 = max, 31 = min
   799                                  	; 14/12/2024
   800 00000549 A0[3F2B0000]            	mov	al, [volume]
   801 0000054E E806040000              	call	SetPCMOutVolume@
   802                                  	; 15/11/2024
   803                                  	;;call	SetMasterVolume
   804                                  	;call	SetPCMOutVolume
   805                                  
   806                                  	;;;
   807                                  	; 18/12/2024
   808 00000553 833D[8C850000]00        	cmp	dword [_bdl_buffer], 0
   809 0000055A 7707                    	ja	short PlayNow@
   810                                  	;
   811                                  	;; 29/11/2024
   812                                  	;cmp	byte [IsInSplash], 0
   813                                  	;;ja	short PlayNow@
   814                                  	;; 02/12/2024
   815                                  	;jna	short PlayNow@
   816                                  	;;;
   817                                  
   818                                  ;PlayNow@:
   819                                  	; 28/11/2024
   820                                  	;cmp	byte [IsInSplash], 0
   821                                  	;ja	short _3
   822                                  	;
   823                                  	;call	UpdateVolume
   824                                  	;
   825                                  	; 02/12/2024
   826 0000055C E881010000              	call    PlayWav@
   827 00000561 EB33                    	jmp	short _3
   828                                  
   829                                  	; 02/12/2024
   830                                  PlayNow@:
   831                                  	; reset file loading and EOF parameters
   832                                  	; 18/12/2024
   833 00000563 C705[80850000]0000-     	mov	dword [count], 0
   833 0000056B 0000               
   834 0000056D C705[84850000]0000-     	mov	dword [LoadedDataBytes], 0
   834 00000575 0000               
   835 00000577 C605[FA840000]00        	mov	byte [flags], 0
   836 0000057E C605[B4840000]00        	mov	byte [stopped], 0
   837                                  	;jmp	short PlayNow@@
   838                                  	;;;
   839                                  
   840                                  PlayNow@@:
   841                                  	;;;
   842                                  	;
   843                                  	; 14/11/2024
   844 00000585 E8B4270000              	call	UpdateProgressBar
   845                                  	;;;
   846                                  
   847                                   	; 30/05/2024
   848                                  	; playwav4.asm
   849                                  _2:	
   850 0000058A E84D250000              	call	check4keyboardstop	; flush keyboard buffer
   851 0000058F 72F9                    	jc	short _2		; 07/11/2023
   852                                  
   853                                  ; play the .wav file. Most of the good stuff is in here.
   854                                  	
   855                                  	; 05/12/2024
   856                                  	; 02/12/2024
   857                                  	;mov	eax, [_bdl_buffer]	; BDL_BUFFER physical address
   858                                  ;_3:
   859 00000591 E86B010000              	call    PlayWav
   860                                  
   861                                  	; 30/12/2024
   862                                  	; 29/12/2024 (vgaplay3.s)
   863                                  	; 27/12/2024 (vgaplay.s)
   864                                  _3:
   865                                  
   866                                  ; close the .wav file and exit.
   867                                  
   868                                  	; 25/12/2024
   869 00000596 E83D040000              	call	closeFile
   870                                  
   871                                  	; 25/12/2024
   872                                  	;;;
   873                                  	; reset file loading and EOF parameters
   874                                  	; 18/12/2024
   875 0000059B C705[80850000]0000-     	mov	dword [count], 0
   875 000005A3 0000               
   876 000005A5 C705[84850000]0000-     	mov	dword [LoadedDataBytes], 0
   876 000005AD 0000               
   877 000005AF C605[FA840000]00        	mov	byte [flags], 0
   878 000005B6 C605[B4840000]00        	mov	byte [stopped], 0
   879                                  	; 29/12/2024
   880 000005BD C705[C0840000]0000-     	mov	dword [pbuf_s], 0
   880 000005C5 0000               
   881                                  	;;;
   882                                  
   883                                  	; 27/12/2024
   884                                  	; 26/12/2024
   885 000005C7 803D[31470000]00        	cmp	byte [IsInSplash], 0
   886 000005CE 7612                    	jna	short _6
   887 000005D0 C605[31470000]00        	mov	byte [IsInSplash], 0
   888 000005D7 8B35[04850000]          	mov	esi, [argvf]
   889 000005DD E91DFBFFFF              	jmp	Player_ParseNextParameter
   890                                  _6:
   891 000005E2 803D[C7840000]51        	cmp	byte [command], 'Q'
   892 000005E9 7405                    	je	short terminate
   893 000005EB E9E5FAFFFF              	jmp	check_p_command
   894                                  
   895                                  terminate:
   896 000005F0 E8E0000000              	call	set_text_mode
   897                                  Exit:
   898                                  	sys	_exit
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94                              <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000005F5 B801000000          <1>  mov eax, %1
   103                              <1> 
   104 000005FA CD40                <1>  int 40h
   899                                  halt:
   900 000005FC EBFE                    	jmp	short halt
   901                                  
   902                                  ; -------------------------------------------------------------
   903                                  
   904                                  	; 30/05/2024
   905                                  pmsg_usage:
   906                                  	; 21/12/2024
   907 000005FE E8D2000000              	call	set_text_mode
   908                                  	; 01/12/2024
   909                                  	sys	_msg, msg_usage, 255, 0Fh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000603 BB[4F300000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000608 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000060D BA0F000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000612 B823000000          <1>  mov eax, %1
   103                              <1> 
   104 00000617 CD40                <1>  int 40h
   910 00000619 EBDA                    	jmp	short Exit
   911                                  
   912                                  ; -------------------------------------------------------------
   913                                  
   914                                  	; 30/05/2024
   915                                  init_err:
   916                                  	; 21/12/2024
   917 0000061B E8B5000000              	call	set_text_mode
   918                                  	; 01/12/2024
   919                                  	sys	_msg, msg_init_err, 255, 0Fh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000620 BB[E3300000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000625 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000062A BA0F000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000062F B823000000          <1>  mov eax, %1
   103                              <1> 
   104 00000634 CD40                <1>  int 40h
   920 00000636 EBBD                    	jmp	short Exit
   921                                  
   922                                  ; -------------------------------------------------------------
   923                                  
   924                                  	; 07/12/2024
   925                                  error_exit:
   926                                  	; 21/12/2024
   927 00000638 E898000000              	call	set_text_mode
   928                                  trdos386_error:
   929                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000063D BB[C3300000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000642 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000647 BA0E000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000064C B823000000          <1>  mov eax, %1
   103                              <1> 
   104 00000651 CD40                <1>  int 40h
   930 00000653 EBA0                    	jmp	short Exit
   931                                  
   932                                  ; -------------------------------------------------------------
   933                                  
   934                                  	; 21/12/2024
   935                                  print_msg:
   936 00000655 B40E                    	mov	ah, 0Eh
   937 00000657 BB07000000              	mov	ebx, 7
   938                                  	;mov	bl, 7 ; char attribute & color
   939                                  p_next_chr:
   940 0000065C AC                      	lodsb
   941 0000065D 08C0                    	or	al, al
   942 0000065F 7404                    	jz	short p_retn ; retn
   943 00000661 CD31                    	int	31h
   944 00000663 EBF7                    	jmp	short p_next_chr
   945                                  p_retn:
   946 00000665 C3                      	retn
   947                                  
   948                                  ; -------------------------------------------------------------
   949                                  
   950                                  	; 21/12/2024
   951                                  clearscreen:
   952                                  	; fast clear
   953                                  	; 640*480, 256 colors
   954 00000666 8B3D[A07A0000]          	mov	edi, [LFB_ADDR]
   955 0000066C B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   956 00000671 31C0                    	xor	eax, eax
   957 00000673 F3AB                    	rep	stosd
   958 00000675 C3                      	retn
   959                                  
   960                                  ; -------------------------------------------------------------
   961                                  
   962                                  	; 26/12/2024
   963                                  	; 21/12/2024
   964                                  drawsplashscreen:
   965 00000676 BD[40320000]            	mov	ebp, SplashScreen
   966                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   967                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   968                                  	;mov	esi, 0 ; row 0, column 0
   969 0000067B BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   970 00000680 EB0A                    	jmp	short p_d_x
   971                                  drawplayingscreen:
   972 00000682 BD[E13C0000]            	mov	ebp, PlayingScreen
   973                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   974                                  	;mov	esi, 0 ; row 0, column 0
   975 00000687 BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   976                                  p_d_x:
   977 0000068C C605[AC7A0000]50        	mov	byte [columns], 80
   978                                  p_d_x_n:
   979 00000693 31D2                    	xor	edx, edx
   980 00000695 8A5500                  	mov	dl, [ebp]
   981 00000698 20D2                    	and	dl, dl
   982 0000069A 7438                    	jz	short p_d_x_ok
   983 0000069C C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   984                                  
   985 0000069F BF[58550000]            	mov	edi, fontbuff2 ; start of user font data
   986 000006A4 01D7                    	add	edi, edx
   987                                  	
   988                                  	;; NOTE: Following system call writes fonts at
   989                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   990                                  	;; screen width as 640 pixels (instead of 320 pixels)
   991                                  	;; so 8Fh is sub function 0Fh (write char)
   992                                  	;; with 640 pixels screen witdh. 
   993                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   994                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   995                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   996                                  	;; region, the text is appeared on screen
   997                                  	;; while LFB is at C0000000h or E0000000h.)
   998                                  
   999                                  	;sys	_video, 018Fh, [tcolor], 8001h
  1000                                  			;; use STD VGA video memory
  1001                                  			;; (0A0000h)
  1002                                  	;sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
  1003                                  		 ; use LFB for current VBE mode
  1004                                  		 ; for writing fonts on screen
  1005                                  	; 26/12/2024
  1006                                  	sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000006A6 BB0F020000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000006AB B90F000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000006B0 BA01800000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000006B5 B81F000000          <1>  mov eax, %1
   103                              <1> 
   104 000006BA CD40                <1>  int 40h
  1007                                  
  1008 000006BC 45                      	inc	ebp
  1009 000006BD 6683C608                	add	si, 8 ; next char pos
  1010 000006C1 FE0D[AC7A0000]          	dec	byte [columns]
  1011 000006C7 75CA                    	jnz	short p_d_x_n	; next column
  1012 000006C9 6631F6                  	xor	si, si
  1013                                  	;;add	esi, 00100000h	; next row ; 8*16
  1014                                  	;add	esi, [nextrow]
  1015 000006CC 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
  1016 000006D2 EBB8                    	jmp	short p_d_x
  1017                                  p_d_x_ok:
  1018 000006D4 C3                      	retn
  1019                                  
  1020                                  ; -------------------------------------------------------------
  1021                                  
  1022                                  	; 21/12/2024
  1023                                  set_text_mode:
  1024 000006D5 30E4                    	xor    ah, ah
  1025 000006D7 B003                    	mov    al, 3                        
  1026                                   	;int   10h ; al = 03h text mode, int 10 video
  1027 000006D9 CD31                    	int    31h ; TRDOS 386 - Video interrupt
  1028 000006DB C3                      	retn
  1029                                  
  1030                                  ; -------------------------------------------------------------
  1031                                  
  1032                                  	; 02/12/2024
  1033                                  Player_Quit@:
  1034 000006DC 58                      	pop	eax ; return addr (call PlayWav@)
  1035                                  	
  1036                                  	; 29/11/2024
  1037                                  Player_Quit:
  1038 000006DD E90EFFFFFF              	jmp	 terminate
  1039                                  
  1040                                  ; -------------------------------------------------------------
  1041                                  
  1042                                  	; 29/12/2024 (vgaplay3.s)
  1043                                  	; 02/12/2024 (ac97play.s)
  1044                                  PlayWav@:
  1045                                  	; 29/05/2024
  1046                                  	; Allocate memory block (33 pages)
  1047                                  	sys	_alloc, BDL_BUFFER, 33*4096, 0	; no upper limit
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000006E2 BB[00900000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000006E7 B900100200          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000006EC BA00000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000006F1 B82A000000          <1>  mov eax, %1
   103                              <1> 
   104 000006F6 CD40                <1>  int 40h
  1048                                  	;jc	short Player_Quit ; 01/12/2024
  1049 000006F8 72E2                    	jc	short Player_Quit@ ; 02/12/2024
  1050                                  
  1051 000006FA A3[8C850000]            	mov	[_bdl_buffer], eax ; BDL_BUFFER physical address
  1052                                  	; 02/12/2024
  1053 000006FF EB05                    	jmp	short PlayWav@@
  1054                                  
  1055                                  	; 29/12/2024
  1056                                  	; 01/12/2024
  1057                                  	; 29/05/2024 (TRDOS 386, playwav7.s)
  1058                                  	; ((Modified from playwav4.asm, ich_wav4.asm))
  1059                                  	; ------------------
  1060                                  ;playwav_vra:
  1061                                  PlayWav:
  1062                                  	; create Buffer Descriptor List
  1063                                  
  1064                                  	;  Generic Form of Buffer Descriptor
  1065                                  	;  ---------------------------------
  1066                                  	;  63   62    61-48    47-32   31-0
  1067                                  	;  ---  ---  --------  ------- -----
  1068                                  	;  IOC  BUP -reserved- Buffer  Buffer
  1069                                  	;		      Length   Pointer
  1070                                  	;		      [15:0]   [31:0]
  1071                                  
  1072                                  	;mov	esi, eax
  1073                                  
  1074 00000701 A1[8C850000]            	mov	eax, [_bdl_buffer] ; BDL_BUFFER physical address
  1075                                  
  1076                                  PlayWav@@:	; 02/12/2024
  1077                                  
  1078 00000706 0500100000              	add	eax, 4096	; WAVBUFFER_1 physical address
  1079 0000070B 89C3                    	mov	ebx, eax
  1080                                  	;mov	[wav_buffer1], eax
  1081                                  	;add	eax, 65536	; WAVBUFFER_2 physical address
  1082                                  	;mov	[wav_buffer2], eax
  1083                                  
  1084 0000070D BF[00900000]            	mov	edi, BDL_BUFFER
  1085 00000712 B910000000              	mov	ecx, 16
  1086                                  _pw0:
  1087                                  	;mov	eax, WAVBUFFER_1
  1088 00000717 89D8                    	mov	eax, ebx	; WAVBUFFER_1 physical address
  1089 00000719 AB                      	stosd
  1090                                  
  1091 0000071A A1[74850000]            	mov	eax, [buffersize]
  1092                                  	; 02/12/2024
  1093 0000071F D1E8                    	shr	eax, 1 ; buffer size in word
  1094 00000721 0D00000040              	or	eax, BUP	; tuneloop (without interrupt)
  1095 00000726 AB                      	stosd
  1096                                  
  1097                                  	;mov	eax, WAVBUFFER_2
  1098 00000727 89D8                    	mov	eax, ebx
  1099 00000729 0500000100              	add	eax, 65536	; WAVBUFFER_2 physical address
  1100 0000072E AB                      	stosd
  1101                                  
  1102 0000072F A1[74850000]            	mov	eax, [buffersize]
  1103                                  	; 02/12/2024
  1104 00000734 D1E8                    	shr	eax, 1 ; buffer size in word
  1105 00000736 0D00000040              	or	eax, BUP	; tuneloop (without interrupt)
  1106 0000073B AB                      	stosd
  1107                                  
  1108 0000073C E2D9                    	loop	_pw0
  1109                                  
  1110                                  	; 14/11/2024
  1111                                  	;mov	dword [count], ecx ; 0
  1112                                  	;mov	dword [LoadedDataBytes], 0
  1113                                  
  1114                                  RePlayWav:
  1115                                  	; 01/12/2024
  1116                                  	; load 64k into buffer 1
  1117 0000073E BF[00A00000]            	mov	edi, WAVBUFFER_1
  1118 00000743 FF15[6C850000]          	call	dword [loadfromwavfile]
  1119                                  	; 01/12/2024
  1120                                  	; 14/11/2024
  1121 00000749 A1[80850000]            	mov	eax, [count]
  1122 0000074E 0105[84850000]          	add	[LoadedDataBytes], eax
  1123                                  
  1124                                  	; 18/12/2024
  1125 00000754 C705[80850000]0000-     	mov	dword [count], 0
  1125 0000075C 0000               
  1126                                  
  1127                                  	; and 64k into buffer 2
  1128 0000075E BF[00A00100]            	mov	edi, WAVBUFFER_2
  1129 00000763 FF15[6C850000]          	call	dword [loadfromwavfile]
  1130                                  	; 01/12/2024
  1131                                  	; 14/11/2024
  1132 00000769 A1[80850000]            	mov	eax, [count]
  1133 0000076E 0105[84850000]          	add	[LoadedDataBytes], eax
  1134                                  	
  1135                                  	; write NABMBAR+10h with offset of buffer descriptor list
  1136                                  
  1137                                         	;;mov	eax, BDL_BUFFER
  1138                                          ;mov	eax, esi	; BDL_BUFFER physical address
  1139                                  
  1140                                  	;mov	eax, [_bdl_buffer] ; BDL_BUFFER physical address
  1141                                  	; 02/12/2024
  1142 00000774 8B1D[8C850000]          	mov	ebx, [_bdl_buffer]
  1143                                  
  1144 0000077A 668B15[6A850000]        	mov	dx, [NABMBAR]
  1145 00000781 6683C210                        add     dx, PO_BDBAR_REG	; set pointer to BDL
  1146                                  	;out	dx, eax 		; write to AC97 controller
  1147                                  	; 29/05/2024
  1148                                  	;mov	ebx, eax ; data, dword
  1149                                  	; 02/12/2024
  1150                                  	; ebx = [_bdl_buffer] ; data, dword
  1151 00000785 B405                    	mov	ah, 5	; write port dword
  1152 00000787 CD34                    	int	34h
  1153                                  
  1154                                  	; 31/05/2024
  1155                                  	; 19/05/2024
  1156                                  	;call	delay1_4ms
  1157                                  
  1158 00000789 B01F                            mov	al, 31
  1159 0000078B E836070000              	call	setLastValidIndex
  1160                                  
  1161                                  	; 31/05/2024
  1162                                  	; 19/05/2024
  1163                                  	;call	delay1_4ms
  1164                                  
  1165                                  	; 17/02/2017
  1166 00000790 668B15[6A850000]                mov	dx, [NABMBAR]
  1167 00000797 6683C21B                        add	dx, PO_CR_REG		; PCM out Control Register
  1168                                          ;mov	al, IOCE + RPBM	; Enable 'Interrupt On Completion' + run
  1169                                  	;			; (LVBI interrupt will not be enabled)
  1170                                  	; 06/11/2023 (TUNELOOP version, without interrupt)
  1171 0000079B B001                    	mov	al, RPBM
  1172                                  	;out	dx, al			; Start bus master operation.
  1173                                  	; 29/05/2024
  1174                                  	; al = data, byte
  1175 0000079D B401                    	mov	ah, 1 ; write port, byte
  1176 0000079F CD34                    	int	34h
  1177                                  
  1178                                  	; 29/12/2024
  1179                                  
  1180                                  ; while DMA engine is running, examine current index and wait until it hits 1
  1181                                  ; as soon as it's 1, we need to refresh the data in wavbuffer1 with another
  1182                                  ; 64k. Likewise when it's playing buffer 2, refresh buffer 1 and repeat.
  1183                                  
  1184                                  	; 28/11/2024
  1185 000007A1 803D[31470000]00        	cmp	byte [IsInSplash], 0
  1186                                  	;jna	short tuneLoop	; 18/12/2024
  1187                                  	; 29/12/2024
  1188 000007A8 764C                    	jna	short _5
  1189                                  sL1:
  1190 000007AA E8DA060000              	call	updateLVI	; /set LVI != CIV/
  1191 000007AF 7433                    	jz	short sL3
  1192 000007B1 E8C3060000              	call	getCurrentIndex
  1193 000007B6 A801                    	test	al, BIT0
  1194 000007B8 74F0                    	jz	short sL1	; loop if buffer 2 is not playing
  1195                                  
  1196                                  	; load buffer 1
  1197                                  	;mov	ax, [WAV_BUFFER1]
  1198                                  	;call	word [loadfromwavfile]
  1199                                  	; 01/12/2024
  1200 000007BA BF[00A00000]            	mov	edi, WAVBUFFER_1
  1201 000007BF FF15[6C850000]          	call	dword [loadfromwavfile]
  1202 000007C5 721D                    	jc	short sL3
  1203                                  sL2:
  1204 000007C7 E8BD060000              	call	updateLVI
  1205 000007CC 7416                    	jz	short sL3
  1206 000007CE E8A6060000              	call	getCurrentIndex
  1207 000007D3 A801                    	test	al, BIT0
  1208 000007D5 75F0                    	jnz	short sL2	; loop if buffer 1 is not playing
  1209                                  
  1210                                  	; load buffer 2
  1211                                  	;mov	ax, [WAV_BUFFER2]
  1212                                  	;call	word [loadfromwavfile]
  1213                                  	; 01/12/2024
  1214 000007D7 BF[00A00100]            	mov	edi, WAVBUFFER_2
  1215 000007DC FF15[6C850000]          	call	dword [loadfromwavfile]
  1216 000007E2 73C6                    	jnc	short sL1
  1217                                  sL3:
  1218 000007E4 668B15[6A850000]        	mov	dx, [NABMBAR]
  1219 000007EB 6683C21B                	add	dx, PO_CR_REG	; PCM out Control Register
  1220 000007EF B000                    	mov	al, 0
  1221                                  	;out	dx, al		; stop player
  1222                                  	; 01/12/2024
  1223                                  	; al = data, byte
  1224 000007F1 B401                    	mov	ah, 1  ; write port, byte
  1225 000007F3 CD34                    	int	34h
  1226                                  
  1227                                  	; 01/12/2024
  1228                                  	; 29/11/2024
  1229                                  	;; reset file loading and EOF parameters
  1230                                  	;;mov	dword [count], 0
  1231                                  	;mov	dword [LoadedDataBytes], 0
  1232                                  	;mov	byte [flags], 0
  1233                                  
  1234 000007F5 C3                      	retn
  1235                                  
  1236                                  ; -------------------------------------------
  1237                                  
  1238                                  _5:
  1239                                  	; 26/12/2024
  1240 000007F6 803D[C6840000]00        	cmp	byte [p_mode], 0
  1241 000007FD 7705                    	ja	short tuneLoop
  1242                                  	;;;
  1243                                  
  1244                                  ; -------------------------------------------
  1245                                  
  1246                                  	; 22/12/2024
  1247                                   	; prepare all leds as turned off
  1248 000007FF E83C260000              	call	reset_wave_leds
  1249                                  
  1250                                  ; -------------------------------------------
  1251                                  
  1252                                  	; 29/12/2024 (vgaplay3.s)
  1253                                  	; 18/12/2024 (ac97play.s)
  1254                                  	; 01/12/2024 (32bit)
  1255                                  	; 29/11/2024
  1256                                  tuneLoop:
  1257                                  	; 30/05/2024
  1258                                  	; 18/11/2023 (ich_wav4.asm)
  1259                                  	; 08/11/2023
  1260                                  	; 06/11/2023
  1261                                  tLWait:
  1262                                  	; 18/11/2024
  1263 00000804 803D[B4840000]00        	cmp	byte [stopped], 0
  1264                                  	;jna	short tL@
  1265                                  	; 21/11/2024
  1266 0000080B 7718                    	ja	short tLWait@
  1267 0000080D A0[B6840000]            	mov	al, [tLP]
  1268 00000812 3C31                    	cmp	al, '1'
  1269 00000814 7458                    	je	short tL1@
  1270 00000816 0F87A3000000            	ja	tL2@
  1271 0000081C B031                    	mov	al, '1'
  1272 0000081E A2[B6840000]            	mov	[tLP], al
  1273 00000823 EB49                    	jmp	short tL1@ 
  1274                                  tLWait@:	; 21/11/2024
  1275                                  	;;;
  1276                                  	; 09/12/2024
  1277 00000825 803D[B4840000]03        	cmp	byte [stopped], 3
  1278 0000082C 0F83DF000000            	jnb	_exitt_
  1279                                  	;;;
  1280 00000832 E8A4200000              	call	checkUpdateEvents
  1281 00000837 0F82D4000000            	jc	_exitt_
  1282                                  	;;;
  1283                                  	; 29/11/2024
  1284 0000083D 803D[C7840000]4E        	cmp	byte [command], 'N'
  1285 00000844 0F84C7000000            	je	_exitt_
  1286 0000084A 803D[C7840000]50        	cmp	byte [command], 'P'
  1287 00000851 0F84BA000000            	je	_exitt_
  1288                                  	;;;
  1289 00000857 803D[B5840000]30        	cmp	byte [tLO], '0'
  1290 0000085E 74A4                    	je	short tLWait
  1291 00000860 E8B6000000              	call	tLZ
  1292 00000865 C605[B5840000]30        	mov	byte [tLO], '0'
  1293 0000086C EB96                    	jmp	short tLWait
  1294                                  
  1295                                  ;tLO:	db 0
  1296                                  	
  1297                                  tL1@:
  1298                                  	;mov	al, '1'
  1299                                  	; 19/11/2024
  1300 0000086E A2[B5840000]            	mov	[tLO], al
  1301 00000873 E8A5000000              	call	tL0
  1302                                  tL1:
  1303 00000878 E80C060000              	call	updateLVI	; /set LVI != CIV/
  1304 0000087D 0F848E000000            	jz	_exitt_		; 08/11/2023
  1305                                  	;;;
  1306                                  	;call	check4keyboardstop
  1307                                  	; 14/11/2024
  1308 00000883 E853200000              	call	checkUpdateEvents
  1309 00000888 0F8283000000            	jc	_exitt_
  1310                                  	; 18/11/2024
  1311 0000088E 803D[B4840000]00        	cmp	byte [stopped], 0
  1312 00000895 778E                    	ja	short tLWait@	; 21/11/2024
  1313                                  	;;;
  1314 00000897 E8DD050000              	call	getCurrentIndex
  1315 0000089C A801                    	test	al, BIT0
  1316 0000089E 74D8                    	jz	short tL1	; loop if buffer 2 is not playing
  1317                                  
  1318                                  	; load buffer 1
  1319                                  	;mov	ax, [WAV_BUFFER1]
  1320                                  	; 01/12/2024
  1321 000008A0 BF[00A00000]            	mov	edi, WAVBUFFER_1	
  1322                                  
  1323                                  	;call	loadFromFile
  1324                                  	; 18/11/2023
  1325                                  	;call	word [loadfromwavfile]
  1326                                  	; 01/12/2024
  1327 000008A5 FF15[6C850000]          	call	dword [loadfromwavfile]
  1328 000008AB 7264                    	jc	short _exitt_	; end of file
  1329                                  
  1330                                  	; 14/11/2024
  1331                                  	;mov	ax, [count]
  1332                                  	;add	[LoadedDataBytes], ax
  1333                                  	;adc	word [LoadedDataBytes+2], 0
  1334                                  	; 01/12/2024
  1335 000008AD A1[80850000]            	mov	eax, [count]
  1336 000008B2 0105[84850000]          	add	[LoadedDataBytes], eax
  1337                                  
  1338 000008B8 B032                    	mov	al, '2'
  1339                                  	; 21/11/2024
  1340 000008BA A2[B6840000]            	mov	[tLP], al
  1341                                  tL2@:
  1342                                  	; 19/11/2024
  1343 000008BF A2[B5840000]            	mov	[tLO], al
  1344 000008C4 E854000000              	call	tL0
  1345                                  tL2:
  1346 000008C9 E8BB050000              	call    updateLVI
  1347 000008CE 7441                    	jz	short _exitt_	; 08/11/2023
  1348                                  	;;;
  1349                                  	;call	check4keyboardstop
  1350                                  	; 14/11/2024
  1351 000008D0 E806200000              	call	checkUpdateEvents
  1352 000008D5 723A                    	jc	short _exitt_
  1353                                  	; 18/11/2024
  1354 000008D7 803D[B4840000]00        	cmp	byte [stopped], 0
  1355 000008DE 0F8741FFFFFF            	ja	tLWait@		; 21/11/2024 
  1356                                  	;;;
  1357 000008E4 E890050000              	call    getCurrentIndex
  1358 000008E9 A801                    	test	al, BIT0
  1359 000008EB 75DC                    	jnz	short tL2	; loop if buffer 1 is not playing
  1360                                  
  1361                                  	; load buffer 2
  1362                                  	;mov	ax, [WAV_BUFFER2]
  1363                                  	; 01/12/2024
  1364 000008ED BF[00A00100]            	mov	edi, WAVBUFFER_2
  1365                                  	;call	loadFromFile
  1366                                  	; 18/11/2023
  1367                                  	;call	word [loadfromwavfile]
  1368                                  	; 01/12/2024
  1369 000008F2 FF15[6C850000]          	call	dword [loadfromwavfile]
  1370                                  	;jnc	short tuneLoop
  1371 000008F8 7217                    	jc	short _exitt_
  1372                                  
  1373                                  	; 14/11/2024
  1374                                  	;mov	ax, [count]
  1375                                  	;add	[LoadedDataBytes], ax
  1376                                  	;adc	word [LoadedDataBytes+2], 0
  1377                                  	; 01/12/2024
  1378 000008FA A1[80850000]            	mov	eax, [count]
  1379 000008FF 0105[84850000]          	add	[LoadedDataBytes], eax	
  1380                                  
  1381                                  	; 21/11/2024
  1382 00000905 C605[B6840000]31        	mov	byte [tLP], '1'
  1383 0000090C E9F3FEFFFF              	jmp	tuneLoop
  1384                                  
  1385                                  	; 29/12/2024 (vgaplay3.s)
  1386                                  _exitt_:
  1387                                  	; 07/12/2024
  1388                                  	; Stop Playing
  1389                                  	;mov	byte [stopped], 2
  1390                                  	;sys	_audio, 0700h
  1391 00000911 E8F5040000              	call	ac97_stop
  1392                                  
  1393                                  	;;;
  1394                                  	; 14/11/2024
  1395 00000916 E823240000              	call	UpdateProgressBar
  1396                                  	;;;
  1397                                  
  1398                                  	; 18/11/2024
  1399                                  tLZ:
  1400                                  	; 30/05/2024
  1401 0000091B B030                    	mov	al, '0'
  1402                                  
  1403                                  	;add	al, '0'
  1404                                  	;call	tL0
  1405                                  	;
  1406                                  	;retn
  1407                                  	; 06/11/2023
  1408                                  	;jmp	short tL0
  1409                                  	;retn
  1410                                  
  1411                                  	; 06/11/2023
  1412                                  tL0:
  1413                                  	; 29/05/2024 (TRDOS 386)
  1414                                  	; 08/11/2023
  1415                                  	; 05/11/2023
  1416                                  	; 17/02/2017 - Buffer switch test (temporary)
  1417                                  	; 06/11/2023
  1418                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1419                                  
  1420                                  	; 22/12/2024 (graphics mode modification)
  1421                                  	; (640*480, 256 colors)
  1422                                  	;;;
  1423                                  	;mov	ebp, 16
  1424 0000091D BD0E000000              	mov	ebp, 14
  1425 00000922 8B3D[A07A0000]          	mov	edi, [LFB_ADDR]
  1426 00000928 0FB6F0                  	movzx	esi, al
  1427 0000092B C1E604                  	shl	esi, 4 ; * 16
  1428 0000092E 81C6[58550000]          	add	esi, fontbuff2
  1429                                  tL0_1:
  1430 00000934 BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1431 00000939 8A26                    	mov	ah, [esi]
  1432                                  tL0_2:
  1433 0000093B B00C                    	mov	al, 0Ch ; red
  1434 0000093D D0E4                    	shl	ah, 1
  1435 0000093F 7302                    	jnc	short tL0_3
  1436 00000941 B00E                    	mov	al, 0Eh ; yellow
  1437                                  tL0_3:
  1438 00000943 AA                      	stosb
  1439 00000944 4A                      	dec	edx
  1440 00000945 75F4                    	jnz	short tL0_2
  1441 00000947 4D                      	dec	ebp
  1442 00000948 7409                    	jz	short tL0_4
  1443 0000094A 81C778020000            	add	edi, 640-8 ; next line
  1444 00000950 46                      	inc	esi
  1445 00000951 EBE1                    	jmp	short tL0_1
  1446                                  tL0_4:
  1447                                  	;;;
  1448 00000953 C3                      	retn
  1449                                  
  1450                                  ; -------------------------------------------
  1451                                  
  1452                                  	; 29/12/2024 (vgaplay3.s)
  1453                                  	; 18/12/2024 (ac97play.s)
  1454                                  	; 14/11/2024
  1455                                  ;SetMasterVolume:
  1456                                  	; 15/11/2024
  1457                                  SetPCMOutVolume:
  1458                                  	;cmp	al, 31
  1459                                  	;ja	short setvolume_ok
  1460 00000954 A2[3F2B0000]            	mov	[volume], al  ; max = 0, min = 31
  1461                                  SetPCMOutVolume@:	; 19/11/2024
  1462 00000959 88C4                    	mov	ah, al
  1463 0000095B 668B15[68850000]        	mov	dx, [NAMBAR]
  1464                                  	; 15/11/2024 (QEMU)
  1465                                    	;add	dx, CODEC_MASTER_VOL_REG
  1466 00000962 6683C218                	add	dx, CODEC_PCM_OUT_REG
  1467                                  	;out	dx, ax
  1468                                  	; 01/12/2024
  1469                                  	; bx = data, word
  1470                                  	; 03/12/2024
  1471 00000966 89C3                    	mov	ebx, eax
  1472 00000968 B403                    	mov	ah, 3  ; write port, word
  1473 0000096A CD34                    	int	34h
  1474                                  ;setvolume_ok:
  1475 0000096C C3                      	retn
  1476                                  
  1477                                  ; -------------------------------------------
  1478                                  
  1479                                  	; 29/12/2024 (vgaplay3.s)
  1480                                  	; 18/12/2024 (ac97play.s)
  1481                                  	; 30/05/2024
  1482                                  DetectAC97:
  1483                                  DetectICH:
  1484                                  	; 22/11/2023
  1485                                  	; 19/11/2023
  1486                                  	; 01/11/2023 - TRDOS 386 Kernel v2.0.7
  1487                                  	;; 10/06/2017
  1488                                  	;; 05/06/2017
  1489                                  	;; 29/05/2017
  1490                                  	;; 28/05/2017
  1491                                  
  1492                                  	; 01/12/2024
  1493                                  	; 19/11/2023
  1494 0000096D BE[842F0000]            	mov	esi, valid_ids	; address of Valid ICH (AC97) Device IDs
  1495 00000972 B915000000              	mov	ecx, valid_id_count
  1496                                  pfd_1:
  1497 00000977 AD                      	lodsd
  1498 00000978 E8A8000000              	call	pciFindDevice
  1499 0000097D 7303                    	jnc	short d_ac97_1
  1500 0000097F E2F6                    	loop	pfd_1
  1501                                  
  1502                                  	;stc
  1503 00000981 C3                      	retn
  1504                                  
  1505                                  d_ac97_1:
  1506                                  	; eax = BUS/DEV/FN
  1507                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1508                                  	; edx = DEV/VENDOR
  1509                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1510                                  
  1511                                  	; playwav4.asm - 19/05/2024
  1512                                  
  1513 00000982 A3[60850000]            	mov	[bus_dev_fn], eax
  1514 00000987 8915[64850000]          	mov	[dev_vendor], edx
  1515                                  
  1516                                  	; get ICH base address regs for mixer and bus master
  1517                                  
  1518 0000098D B010                            mov     al, NAMBAR_REG
  1519 0000098F E81F010000                      call    pciRegRead16			; read PCI registers 10-11
  1520                                          ;and    dx, IO_ADDR_MASK 		; mask off BIT0
  1521                                  	; 19/05/2024
  1522 00000994 80E2FE                  	and	dl, 0FEh
  1523                                  
  1524 00000997 668915[68850000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1525                                  
  1526 0000099E B014                    	mov     al, NABMBAR_REG
  1527 000009A0 E80E010000                      call    pciRegRead16
  1528                                          ;and    dx, IO_ADDR_MASK
  1529                                  	; 19/05/2024
  1530 000009A5 80E2C0                  	and	dl, 0C0h
  1531                                  
  1532 000009A8 668915[6A850000]                mov     [NABMBAR], dx			; save bus master base addr
  1533                                  
  1534 000009AF B03C                    	mov	al, AC97_INT_LINE ; Interrupt line register (3Ch)
  1535 000009B1 E8F6000000              	call	pciRegRead8 ; 17/02/2017
  1536                                  	
  1537 000009B6 8815[FB840000]          	mov	[ac97_int_ln_reg], dl
  1538                                  
  1539                                  	;clc
  1540                                  
  1541 000009BC C3                      	retn
  1542                                  
  1543                                  ; ----------------------------------
  1544                                  	
  1545                                  	; 26/12/2024
  1546                                  	; 07/12/2024
  1547                                  	; 01/12/2024
  1548                                  	; 14/11/2024
  1549                                  	; INPUT: ds:dx = file name address
  1550                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1551                                  openFile:
  1552                                  	; 26/12/2024
  1553                                  	; 01/12/2024
  1554                                  	sys	_open, edx, 0
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000009BD 89D3                <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000009BF B900000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000009C4 B805000000          <1>  mov eax, %1
   103                              <1> 
   104 000009C9 CD40                <1>  int 40h
  1555                                  	; 07/12/2024
  1556                                  	;sys	_open, wav_file_name, 0
  1557 000009CB 7305                    	jnc	short _of1
  1558                                  
  1559 000009CD B8FFFFFFFF              	mov	eax, -1
  1560                                  	; cf = 1 -> not found or access error
  1561                                  _of1:
  1562 000009D2 A3[FC840000]            	mov	[filehandle], eax
  1563 000009D7 C3                      	retn
  1564                                  
  1565                                  ; ----------------------------------
  1566                                  
  1567                                  ; close the currently open file
  1568                                  
  1569                                  	; 01/12/2024
  1570                                  	; 14/11/2024
  1571                                  	; INPUT: [filehandle] ; -1 = not open
  1572                                  	; OUTPUT: none
  1573                                  closeFile:
  1574 000009D8 833D[FC840000]FF        	cmp	dword [filehandle], -1
  1575 000009DF 740D                    	jz	short _cf1
  1576                                  	; 01/12/2024
  1577                                  	sys	_close, [filehandle]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000009E1 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000009E7 B806000000          <1>  mov eax, %1
   103                              <1> 
   104 000009EC CD40                <1>  int 40h
  1578                                  	;mov 	dword [filehandle], -1
  1579                                  _cf1:
  1580 000009EE C3                      	retn
  1581                                  
  1582                                  ; ----------------------------------
  1583                                  
  1584                                  	; 01/12/2024
  1585                                  	; 14/11/2024 - Erdogan Tan
  1586                                  getWAVParameters:
  1587                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1588                                  ; entry: none - assumes file is already open
  1589                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1590                                  ;	cx = number of channels (mono=1, stereo=2)
  1591                                  ;	dx = bits per sample (8, 16)
  1592                                  ;	bx = number of bytes per sample (1 to 4)
  1593                                  
  1594                                          ;mov	dx, WAVFILEHEADERbuff
  1595                                  	;mov	bx, [filehandle]
  1596                                          ;mov	cx, 44			; 44 bytes
  1597                                  	;mov	ah, 3Fh
  1598                                          ;int	21h
  1599                                  	;jc	short gwavp_retn
  1600                                  	; 01/12/2024 (TRDOS 386)
  1601                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000009EF 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000009F5 B9[CC840000]        <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000009FA BA2C000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000009FF B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00000A04 CD40                <1>  int 40h
  1602 00000A06 721C                    	jc	short gwavp_retn
  1603                                  
  1604 00000A08 83F82C                  	cmp	eax, 44
  1605 00000A0B 7217                    	jb	short gwavp_retn
  1606                                  
  1607 00000A0D 813D[D4840000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1607 00000A15 5645               
  1608 00000A17 750A                    	jne	short gwavp_stc_retn
  1609                                  
  1610 00000A19 66833D[E0840000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1611                                  	;jne	short gwavp_stc_retn
  1612 00000A21 7401                    	je	short gwavp_retn ; 15/11/2024
  1613                                  
  1614                                  	; 15/11/2024
  1615                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1616                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1617                                  	;mov	dx, [WAVE_BitsPerSample] 
  1618                                  					; return bits per sample value in DX
  1619                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1620                                  ;gwavp_retn:
  1621                                          ;retn
  1622                                  
  1623                                  gwavp_stc_retn:
  1624 00000A23 F9                      	stc
  1625                                  gwavp_retn:
  1626 00000A24 C3                      	retn
  1627                                  
  1628                                  
  1629                                  ; 29/12/2024 (vgaplay3.s)
  1630                                  ; 18/12/2024 (ac97play.s)
  1631                                  ; --------------------------------------------------------
  1632                                  ; 27/05/2024 - (TRDOS 386 Kernel) audio.s
  1633                                  ; --------------------------------------------------------
  1634                                  
  1635                                  NOT_PCI32_PCI16	EQU 03FFFFFFFh ; NOT BIT31+BIT30 ; 19/03/2017
  1636                                  NOT_BIT31 EQU 7FFFFFFFh
  1637                                  
  1638                                  pciFindDevice:
  1639                                  	; 19/11/2023
  1640                                  	; 03/04/2017 ('pci.asm', 20/03/2017)
  1641                                  	;
  1642                                  	; scan through PCI space looking for a device+vendor ID
  1643                                  	;
  1644                                  	; Entry: EAX=Device+Vendor ID
  1645                                  	;
  1646                                  	; Exit: EAX=PCI address if device found
  1647                                  	;	EDX=Device+Vendor ID
  1648                                  	;       CY clear if found, set if not found. EAX invalid if CY set.
  1649                                  	;
  1650                                  	; Destroys: ebx, edi ; 19/11/2023
  1651                                  
  1652                                          ; 19/11/2023
  1653 00000A25 89C3                    	mov	ebx, eax
  1654 00000A27 BF00000080              	mov	edi, 80000000h
  1655                                  nextPCIdevice:
  1656 00000A2C 89F8                    	mov 	eax, edi		; read PCI registers
  1657 00000A2E E88C000000              	call	pciRegRead32
  1658                                  	; 19/11/2023
  1659 00000A33 39DA                    	cmp	edx, ebx
  1660 00000A35 7412                    	je	short PCIScanExit	; found
  1661                                  	; 19/11/2023
  1662 00000A37 81FF00F8FF80            	cmp	edi, 80FFF800h
  1663 00000A3D 7308                    	jnb	short pfd_nf		; not found
  1664 00000A3F 81C700010000            	add	edi, 100h
  1665 00000A45 EBE5                    	jmp	short nextPCIdevice
  1666                                  pfd_nf:
  1667 00000A47 F9                      	stc
  1668 00000A48 C3                      	retn
  1669                                  PCIScanExit:
  1670                                  	;pushf
  1671 00000A49 B8FFFFFF7F              	mov	eax, NOT_BIT31 	; 19/03/2017
  1672 00000A4E 21F8                    	and	eax, edi	; return only bus/dev/fn #
  1673 00000A50 C3                      	retn
  1674                                  
  1675                                  pciRegRead:
  1676                                  	; 01/12/2024
  1677                                  	; 03/04/2017 ('pci.asm', 20/03/2017)
  1678                                  	;
  1679                                  	; 8/16/32bit PCI reader
  1680                                  	;
  1681                                  	; Entry: EAX=PCI Bus/Device/fn/register number
  1682                                  	;           BIT30 set if 32 bit access requested
  1683                                  	;           BIT29 set if 16 bit access requested
  1684                                  	;           otherwise defaults to 8 bit read
  1685                                  	;
  1686                                  	; Exit:  DL,DX,EDX register data depending on requested read size
  1687                                  	;
  1688                                  	; Note1: this routine is meant to be called via pciRegRead8,
  1689                                  	;	 pciRegread16 or pciRegRead32, listed below.
  1690                                  	;
  1691                                  	; Note2: don't attempt to read 32 bits of data from a non dword
  1692                                  	;	 aligned reg number. Likewise, don't do 16 bit reads from
  1693                                  	;	 non word aligned reg #
  1694                                  
  1695 00000A51 53                      	push	ebx
  1696 00000A52 51                      	push	ecx
  1697 00000A53 89C3                            mov     ebx, eax		; save eax, dh
  1698 00000A55 88F1                            mov     cl, dh
  1699                                  
  1700 00000A57 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; clear out data size request
  1701 00000A5C 0D00000080                      or      eax, BIT31		; make a PCI access request
  1702 00000A61 24FC                            and     al, ~3 ; NOT 3 ; 0FCh	; force index to be dword
  1703                                  
  1704 00000A63 66BAF80C                        mov     dx, PCI_INDEX_PORT
  1705                                          ;out	dx, eax			; write PCI selector
  1706                                  	; 29/05/2024
  1707 00000A67 53                      	push	ebx
  1708 00000A68 89C3                    	mov	ebx, eax ; data, dword
  1709 00000A6A B405                    	mov	ah, 5 ; write port, dword
  1710                                  	; dx = port number
  1711 00000A6C CD34                    	int	34h
  1712 00000A6E 5B                      	pop	ebx
  1713                                  	
  1714 00000A6F 66BAFC0C                        mov     dx, PCI_DATA_PORT
  1715 00000A73 88D8                            mov     al, bl
  1716 00000A75 2403                            and     al, 3			; figure out which port to
  1717 00000A77 00C2                            add     dl, al			; read to
  1718                                  
  1719 00000A79 F7C3000000C0            	test    ebx, PCI32+PCI16
  1720 00000A7F 750A                            jnz     short _pregr0
  1721                                  
  1722                                  	;in	al, dx			; return 8 bits of data
  1723                                  	; 29/05/2024
  1724 00000A81 B400                    	mov	ah, 0 ; read port, byte
  1725                                  	; dx = port number
  1726 00000A83 CD34                    	int	34h
  1727                                          
  1728 00000A85 88C2                    	mov	dl, al
  1729 00000A87 88CE                    	mov     dh, cl			; restore dh for 8 bit read
  1730 00000A89 EB17                    	jmp	short _pregr2
  1731                                  _pregr0:	
  1732 00000A8B F7C300000080            	test    ebx, PCI32
  1733 00000A91 7509                            jnz	short _pregr1
  1734                                  
  1735                                  	;in	ax, dx
  1736                                  	; 29/05/2024
  1737 00000A93 B402                    	mov	ah, 2 ; read port, word
  1738                                  	; dx = port number
  1739 00000A95 CD34                    	int	34h
  1740                                  
  1741 00000A97 6689C2                  	mov     dx, ax			; return 16 bits of data
  1742 00000A9A EB06                    	jmp	short _pregr2
  1743                                  _pregr1:
  1744                                  	;in	eax, dx			; return 32 bits of data
  1745                                  	; 29/05/2024
  1746 00000A9C B404                    	mov	ah, 4 ; read port, dword
  1747                                  	; dx = port number
  1748 00000A9E CD34                    	int	34h
  1749                                  
  1750 00000AA0 89C2                    	mov	edx, eax
  1751                                  _pregr2:
  1752 00000AA2 89D8                    	mov     eax, ebx		; restore eax
  1753 00000AA4 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; clear out data size request
  1754 00000AA9 59                      	pop	ecx
  1755 00000AAA 5B                      	pop	ebx
  1756 00000AAB C3                      	retn
  1757                                  
  1758                                  pciRegRead8:
  1759 00000AAC 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; set up 8 bit read size
  1760 00000AB1 EB9E                            jmp     short pciRegRead	; call generic PCI access
  1761                                  
  1762                                  pciRegRead16:
  1763 00000AB3 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; set up 16 bit read size
  1764 00000AB8 0D00000040                      or      eax, PCI16		; call generic PCI access
  1765 00000ABD EB92                            jmp     short pciRegRead
  1766                                  
  1767                                  pciRegRead32:
  1768 00000ABF 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; set up 32 bit read size
  1769 00000AC4 0D00000080                      or      eax, PCI32		; call generic PCI access
  1770 00000AC9 EB86                            jmp     pciRegRead
  1771                                  
  1772                                  pciRegWrite:
  1773                                  	; 01/12/2024
  1774                                  	; 03/04/2017 ('pci.asm', 29/11/2016)
  1775                                  	;
  1776                                  	; 8/16/32bit PCI writer
  1777                                  	;
  1778                                  	; Entry: EAX=PCI Bus/Device/fn/register number
  1779                                  	;           BIT31 set if 32 bit access requested
  1780                                  	;           BIT30 set if 16 bit access requested
  1781                                  	;           otherwise defaults to 8bit read
  1782                                  	;        DL/DX/EDX data to write depending on size
  1783                                  	;
  1784                                  	; Note1: this routine is meant to be called via pciRegWrite8,
  1785                                  	;	 pciRegWrite16 or pciRegWrite32 as detailed below.
  1786                                  	;
  1787                                  	; Note2: don't attempt to write 32bits of data from a non dword
  1788                                  	;	 aligned reg number. Likewise, don't do 16 bit writes from
  1789                                  	;	 non word aligned reg #
  1790                                  
  1791 00000ACB 53                      	push	ebx
  1792 00000ACC 51                      	push	ecx
  1793 00000ACD 89C3                            mov     ebx, eax		; save eax, edx
  1794 00000ACF 89D1                            mov     ecx, edx
  1795 00000AD1 25FFFFFF3F              	and     eax, NOT_PCI32_PCI16	; clear out data size request
  1796 00000AD6 0D00000080                      or      eax, BIT31		; make a PCI access request
  1797 00000ADB 24FC                            and     al, ~3 ; NOT 3 ; 0FCh	; force index to be dword
  1798                                  
  1799 00000ADD 66BAF80C                        mov     dx, PCI_INDEX_PORT
  1800                                  	;out	dx, eax			; write PCI selector
  1801                                  	; 29/05/2024
  1802 00000AE1 53                      	push	ebx
  1803 00000AE2 89C3                    	mov	ebx, eax ; data, dword
  1804 00000AE4 B405                    	mov	ah, 5 ; write port, dword
  1805                                  	; dx = port number
  1806 00000AE6 CD34                    	int	34h
  1807 00000AE8 5B                      	pop	ebx
  1808                                  	
  1809 00000AE9 66BAFC0C                        mov     dx, PCI_DATA_PORT
  1810 00000AED 88D8                            mov     al, bl
  1811 00000AEF 2403                            and     al, 3			; figure out which port to
  1812 00000AF1 00C2                            add     dl, al			; write to
  1813                                  
  1814 00000AF3 F7C3000000C0            	test    ebx, PCI32+PCI16
  1815 00000AF9 7508                            jnz     short _pregw0
  1816 00000AFB 88C8                    	mov	al, cl 			; put data into al
  1817                                  	;out	dx, al
  1818                                  	; 29/05/2024
  1819                                  	; al = data, byte
  1820 00000AFD B401                    	mov	ah, 1 ; write port, byte
  1821                                  	; dx = port number
  1822 00000AFF CD34                    	int	34h
  1823                                  
  1824 00000B01 EB1F                    	jmp	short _pregw2
  1825                                  _pregw0:
  1826 00000B03 F7C300000080            	test    ebx, PCI32
  1827 00000B09 750D                            jnz     short _pregw1
  1828 00000B0B 6689C8                  	mov	ax, cx			; put data into ax
  1829                                  	;out	dx, ax
  1830                                  	; 29/05/2024
  1831 00000B0E 53                      	push	ebx
  1832 00000B0F 89C3                    	mov	ebx, eax ; data, word
  1833 00000B11 B403                    	mov	ah, 3 ; write port, word
  1834                                  	; dx = port number
  1835 00000B13 CD34                    	int	34h
  1836 00000B15 5B                      	pop	ebx
  1837                                  
  1838 00000B16 EB0A                    	jmp	short _pregw2
  1839                                  _pregw1:
  1840 00000B18 89C8                    	mov	eax, ecx		; put data into eax
  1841                                  	;out	dx, eax
  1842                                  	; 29/05/2024
  1843 00000B1A 53                      	push	ebx
  1844 00000B1B 89C3                    	mov	ebx, eax ; data, dword
  1845 00000B1D B405                    	mov	ah, 5 ; write port, dword
  1846                                  	; dx = port number
  1847 00000B1F CD34                    	int	34h
  1848 00000B21 5B                      	pop	ebx
  1849                                  _pregw2:
  1850 00000B22 89D8                            mov     eax, ebx		; restore eax
  1851 00000B24 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; clear out data size request
  1852 00000B29 89CA                            mov     edx, ecx		; restore dx
  1853 00000B2B 59                      	pop	ecx
  1854 00000B2C 5B                      	pop	ebx
  1855 00000B2D C3                      	retn
  1856                                  
  1857                                  pciRegWrite8:
  1858 00000B2E 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; set up 8 bit write size
  1859 00000B33 EB96                            jmp	short pciRegWrite	; call generic PCI access
  1860                                  
  1861                                  pciRegWrite16:
  1862 00000B35 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; set up 16 bit write size
  1863 00000B3A 0D00000040                      or      eax, PCI16		; call generic PCI access
  1864 00000B3F EB8A                            jmp	short pciRegWrite
  1865                                  
  1866                                  pciRegWrite32:
  1867 00000B41 25FFFFFF3F                      and     eax, NOT_PCI32_PCI16	; set up 32 bit write size
  1868 00000B46 0D00000080                      or      eax, PCI32		; call generic PCI access
  1869 00000B4B E97BFFFFFF                      jmp	pciRegWrite
  1870                                  
  1871                                  ; --------------------------------------------------------
  1872                                  ; 19/05/2024 - (playwav4.asm) ac97_vra.asm
  1873                                  ; --------------------------------------------------------
  1874                                  
  1875                                  	; 13/11/2023
  1876                                  
  1877                                  ;VRA:	db 1
  1878                                  
  1879                                  codecConfig:
  1880                                  	; 01/12/2024 (ac97play.s)
  1881                                  	; 29/05/2024 (playwav7.s modification)
  1882                                  	; 19/05/2024
  1883                                  	; 19/11/2023
  1884                                  	; 15/11/2023
  1885                                  	; 04/11/2023
  1886                                  	; 17/02/2017 
  1887                                  	; 07/11/2016 (Erdogan Tan)
  1888                                  
  1889                                  	;AC97_EA_VRA equ 1
  1890                                  	AC97_EA_VRA equ BIT0
  1891                                  
  1892                                  	; 04/11/2023
  1893                                  init_ac97_controller:
  1894 00000B50 A1[60850000]            	mov	eax, [bus_dev_fn]
  1895 00000B55 B004                    	mov	al, PCI_CMD_REG
  1896 00000B57 E857FFFFFF              	call	pciRegRead16		; read PCI command register
  1897 00000B5C 80CA05                  	or      dl, IO_ENA+BM_ENA	; enable IO and bus master
  1898 00000B5F E8D1FFFFFF              	call	pciRegWrite16
  1899                                  
  1900                                  	;call	delay_100ms
  1901                                  
  1902                                  	; 19/05/2024
  1903                                  	; ('PLAYMOD3.ASM', Erdogan Tan, 18/05/2024)
  1904                                  
  1905                                  init_ac97_codec:
  1906                                  	; 18/11/2023
  1907 00000B64 BD28000000              	mov	ebp, 40
  1908                                  	; 29/05/2024
  1909                                  	;mov	ebp, 1000
  1910                                  _initc_1:
  1911                                  	; 29/05/2024
  1912 00000B69 66BA3000                	mov	dx, GLOB_STS_REG ; 30h
  1913 00000B6D 660315[6A850000]        	add	dx, [NABMBAR]
  1914                                  	;in	eax, dx
  1915 00000B74 B404                    	mov	ah, 4	; read port, dword
  1916 00000B76 CD34                    	int	34h
  1917                                  
  1918                                  	; 19/05/2024
  1919                                  	;call	delay1_4ms
  1920                                  
  1921 00000B78 83F8FF                  	cmp	eax, 0FFFFFFFFh ; -1
  1922 00000B7B 750A                    	jne	short _initc_3
  1923                                  _initc_2:
  1924 00000B7D 4D                      	dec	ebp
  1925 00000B7E 7425                    	jz	short _ac97_codec_ready
  1926                                  
  1927                                  	; 31/05/2024
  1928 00000B80 E8B3020000              	call	delay_100ms
  1929 00000B85 EBE2                    	jmp	short _initc_1
  1930                                  _initc_3:
  1931 00000B87 A900030010              	test	eax, CTRL_ST_CREADY
  1932 00000B8C 7517                    	jnz	short _ac97_codec_ready
  1933                                  
  1934                                  	; 30/05/2024
  1935 00000B8E 803D[25300000]01        	cmp	byte [reset], 1
  1936 00000B95 73E6                    	jnb	short _initc_2
  1937                                  
  1938 00000B97 E893010000              	call	reset_ac97_codec
  1939                                  	; 30/05/2024
  1940 00000B9C C605[25300000]01        	mov	byte [reset], 1
  1941                                  	; 19/05/2024
  1942 00000BA3 EBD8                    	jmp	short _initc_2
  1943                                  
  1944                                  _ac97_codec_ready:
  1945 00000BA5 668B15[68850000]        	mov	dx, [NAMBAR]
  1946                                  	;add	dx, 0 ; ac_reg_0 ; reset register
  1947                                  	;out	dx, ax
  1948                                  	; 29/05/2024
  1949 00000BAC 53                      	push	ebx
  1950 00000BAD 89C3                    	mov	ebx, eax ; bx = data, word
  1951 00000BAF B403                    	mov	ah, 3	; write port, word
  1952 00000BB1 CD34                    	int	34h
  1953 00000BB3 5B                      	pop	ebx
  1954                                  
  1955                                  	; 31/05/2024
  1956                                  	; 29/05/2024
  1957                                  	;call	delay_100ms
  1958                                  
  1959                                  	; 19/11/2023
  1960 00000BB4 09ED                    	or	ebp, ebp
  1961 00000BB6 7539                    	jnz	short _ac97_codec_init_ok
  1962                                  
  1963 00000BB8 31C0                    	xor	eax, eax ; 0
  1964 00000BBA 668B15[68850000]        	mov	dx, [NAMBAR]
  1965 00000BC1 6683C226                	add	dx, CODEC_REG_POWERDOWN
  1966                                  	;out	dx, ax
  1967                                  	; 29/05/2024
  1968 00000BC5 53                      	push	ebx
  1969 00000BC6 89C3                    	mov	ebx, eax
  1970 00000BC8 B403                    	mov	ah, 3	; write port, word
  1971 00000BCA CD34                    	int	34h
  1972 00000BCC 5B                      	pop	ebx
  1973                                  
  1974                                  	; 19/11/2023
  1975                                  	; wait for 1 second
  1976                                  	; 19/05/2024
  1977 00000BCD B9E8030000              	mov	ecx, 1000 ; 1000*4*0.25ms = 1s
  1978                                  	;;mov	ecx, 10
  1979                                  	; 30/05/2024
  1980                                  	;mov	ecx, 40
  1981                                  _ac97_codec_rloop:
  1982                                  	;call	delay_100ms
  1983                                  	; 31/05/2024
  1984 00000BD2 E870020000              	call	delay1_4ms
  1985                                  
  1986                                  	;mov	dx, [NAMBAR]
  1987                                  	;add	dx, CODEC_REG_POWERDOWN
  1988                                  	;in	ax, dx
  1989                                  	; 29/05/2024
  1990 00000BD7 668B15[68850000]        	mov	dx, [NAMBAR]
  1991 00000BDE 6683C226                	add	dx, CODEC_REG_POWERDOWN
  1992                                  	; 31/05/2024
  1993 00000BE2 B402                    	mov	ah, 2	; read port, word
  1994 00000BE4 CD34                    	int	34h
  1995                                  
  1996                                  	; 31/05/2024
  1997                                  	;call	delay1_4ms
  1998                                  	
  1999 00000BE6 6683E00F                	and	ax, 0Fh
  2000 00000BEA 3C0F                    	cmp	al, 0Fh
  2001 00000BEC 7403                    	je	short _ac97_codec_init_ok
  2002 00000BEE E2E2                    	loop	_ac97_codec_rloop 
  2003                                  
  2004                                  init_ac97_codec_err1:
  2005                                  	;stc	; cf = 1 ; 19/05/2024
  2006                                  init_ac97_codec_err2:
  2007 00000BF0 C3                      	retn
  2008                                  
  2009                                  _ac97_codec_init_ok:
  2010 00000BF1 E8DA000000              	call 	reset_ac97_controller
  2011                                  
  2012                                  	; 31/05/2024
  2013                                  	; 30/05/2024
  2014                                  	; 19/05/2024
  2015                                  	;call	delay_100ms
  2016                                  
  2017                                  	; 30/05/2024
  2018                                  	;call	delay1_4ms
  2019                                  	;call	delay1_4ms
  2020                                  	;call	delay1_4ms
  2021                                  	;call	delay1_4ms
  2022                                  
  2023                                  	; 01/12/2024
  2024                                  setup_ac97_codec:
  2025                                  	; 12/11/2023
  2026 00000BF6 66813D[E4840000]80-     	cmp	word [WAVE_SampleRate], 48000
  2026 00000BFE BB                 
  2027 00000BFF 0F849C000000            	je	skip_rate
  2028                                  	
  2029                                  	; 31/05/2024
  2030                                  	; 30/05/2024
  2031                                  	; 29/05/2024
  2032                                  	;cmp	byte [VRA], 0
  2033                                  	;jna	short skip_rate
  2034                                  
  2035                                  	; 11/11/2023
  2036 00000C05 668B15[68850000]        	mov	dx, [NAMBAR]
  2037 00000C0C 6683C22A                	add	dx, CODEC_EXT_AUDIO_CTRL_REG  	; 2Ah
  2038                                  	;in	ax, dx
  2039                                  	; 29/05/2024
  2040 00000C10 B402                    	mov	ah, 2 ; read port, word
  2041 00000C12 CD34                    	int	34h
  2042                                  
  2043                                  	; 30/05/2024
  2044                                  	; 19/05/2024
  2045 00000C14 E82E020000              	call	delay1_4ms
  2046                                  
  2047                                  	;and	al, ~BIT1 ; Clear DRA
  2048                                  	;;;
  2049                                  	; 30/05/2024
  2050 00000C19 24FC                    	and	al, ~(BIT1+BIT0) ; Clear DRA+VRA
  2051                                  	; 01/12/2024 (FASM)
  2052                                  	;and	al, NOT (BIT1+BIT0) ; 0FCh
  2053                                  	;out	dx, ax
  2054                                  	; 31/05/2024
  2055 00000C1B 53                      	push	ebx
  2056 00000C1C 89C3                    	mov	ebx, eax
  2057 00000C1E 668B15[68850000]        	mov	dx, [NAMBAR]
  2058 00000C25 6683C22A                	add	dx, CODEC_EXT_AUDIO_CTRL_REG  	; 2Ah
  2059 00000C29 B403                    	mov	ah, 3 ; write port, word
  2060 00000C2B CD34                    	int	34h
  2061 00000C2D 5B                      	pop	ebx
  2062                                  
  2063                                  	; 31/05/2024
  2064 00000C2E E8B1010000              	call	check_vra
  2065                                  
  2066                                  	; 31/05/2024 - temporary (interpolated sample rate test)
  2067                                  	;mov	byte [VRA], 0
  2068                                  
  2069                                  	; 31/05/2024
  2070 00000C33 803D[C5840000]00        	cmp	byte [VRA], 0
  2071 00000C3A 7665                    	jna	short skip_rate
  2072                                  
  2073 00000C3C 668B15[68850000]        	mov	dx, [NAMBAR]
  2074 00000C43 6683C22A                	add	dx, CODEC_EXT_AUDIO_CTRL_REG  	; 2Ah
  2075                                  	;in	ax, dx
  2076                                  	; 31/05/2024
  2077 00000C47 B402                    	mov	ah, 2 ; read port, word
  2078 00000C49 CD34                    	int	34h
  2079                                  
  2080                                  	;and	al, ~BIT1 ; Clear DRA
  2081                                  	;;;
  2082                                  
  2083 00000C4B 0C01                    	or	al, AC97_EA_VRA ; 1 ; 04/11/2023
  2084                                  	;out	dx, ax	; Enable variable rate audio
  2085                                  	; 29/05/2024
  2086 00000C4D 53                      	push	ebx
  2087 00000C4E 89C3                    	mov	ebx, eax
  2088                                  	;
  2089                                  	; 30/05/2024
  2090 00000C50 668B15[68850000]        	mov	dx, [NAMBAR]
  2091 00000C57 6683C22A                	add	dx, CODEC_EXT_AUDIO_CTRL_REG  	; 2Ah
  2092                                  	;
  2093 00000C5B B403                    	mov	ah, 3 ; write port, word
  2094 00000C5D CD34                    	int	34h
  2095 00000C5F 5B                      	pop	ebx
  2096                                  
  2097                                  	;mov	cx, 10
  2098 00000C60 B90A000000              	mov	ecx, 10 ; 30/05/2024
  2099                                  check_vra_loop:
  2100                                  	; 31/05/2024
  2101                                  	;call	delay_100ms
  2102                                  	; 30/05/2024
  2103 00000C65 E8DD010000              	call	delay1_4ms
  2104                                  
  2105                                  	; 11/11/2023
  2106                                  	;in	ax, dx
  2107                                  	; 29/05/2024
  2108 00000C6A 668B15[68850000]        	mov	dx, [NAMBAR]
  2109 00000C71 6683C22A                	add	dx, CODEC_EXT_AUDIO_CTRL_REG  	; 2Ah
  2110 00000C75 B402                    	mov	ah, 2 ; read port, word
  2111 00000C77 CD34                    	int	34h
  2112                                  
  2113 00000C79 A801                    	test	al, AC97_EA_VRA ; 1
  2114 00000C7B 750B                    	jnz	short set_rate
  2115                                  
  2116                                  	; 11/11/2023
  2117 00000C7D E2E6                    	loop	check_vra_loop
  2118                                  
  2119                                  ;vra_not_supported:	; 19/05/2024
  2120 00000C7F C605[C5840000]00        	mov	byte [VRA], 0
  2121 00000C86 EB19                    	jmp	short skip_rate
  2122                                  
  2123                                  set_rate:
  2124                                  	;mov	ax, [sample_rate] ; 17/02/2017 (Erdogan Tan)
  2125                                  	; 01/12/2024
  2126 00000C88 66A1[E4840000]          	mov	ax, [WAVE_SampleRate]
  2127                                  
  2128 00000C8E 668B15[68850000]        	mov    	dx, [NAMBAR]
  2129 00000C95 6683C22C                	add    	dx, CODEC_PCM_FRONT_DACRATE_REG	; 2Ch
  2130                                  	;out	dx, ax 	; PCM Front/Center Output Sample Rate
  2131                                  	; 29/05/2024
  2132 00000C99 53                      	push	ebx
  2133 00000C9A 89C3                    	mov	ebx, eax  ; bx = data, word
  2134 00000C9C B403                    	mov	ah, 3 ; write port, word
  2135 00000C9E CD34                    	int	34h
  2136 00000CA0 5B                      	pop	ebx
  2137                                  
  2138                                  	; 29/05/2024
  2139                                  	;call	delay_100ms
  2140                                  	; 30/05/2024
  2141                                  	;call	delay1_4ms
  2142                                  
  2143                                  	; 12/11/2023
  2144                                  skip_rate:
  2145 00000CA1 66B80202                	mov	ax, 0202h
  2146 00000CA5 668B15[68850000]          	mov	dx, [NAMBAR]
  2147 00000CAC 6683C202                  	add	dx, CODEC_MASTER_VOL_REG ;02h
  2148                                  	;out	dx, ax
  2149                                  	; 29/05/2024
  2150 00000CB0 53                      	push	ebx
  2151 00000CB1 89C3                    	mov	ebx, eax  ; bx = data, word
  2152 00000CB3 B403                    	mov	ah, 3 ; write port, word
  2153 00000CB5 CD34                    	int	34h
  2154 00000CB7 5B                      	pop	ebx
  2155                                  
  2156                                  	; 29/05/2024
  2157                                  	;call	delay1_4ms
  2158                                  	;call	delay1_4ms
  2159                                  	;call	delay1_4ms
  2160                                  	;call	delay1_4ms
  2161                                  
  2162 00000CB8 66B80202                	mov	ax, 0202h
  2163 00000CBC 668B15[68850000]          	mov	dx, [NAMBAR]
  2164 00000CC3 6683C218                  	add	dx, CODEC_PCM_OUT_REG		;18h
  2165                                    	;out	dx, ax
  2166                                  	; 29/05/2024
  2167 00000CC7 53                      	push	ebx
  2168 00000CC8 89C3                    	mov	ebx, eax  ; bx = data, word
  2169 00000CCA B403                    	mov	ah, 3 ; write port, word
  2170 00000CCC CD34                    	int	34h
  2171 00000CCE 5B                      	pop	ebx
  2172                                  
  2173                                   	; 29/05/2024
  2174                                  	;call	delay1_4ms
  2175                                  	;call	delay1_4ms
  2176                                  	;call	delay1_4ms
  2177                                  	;call	delay1_4ms
  2178                                  
  2179                                  	; 19/05/2024
  2180                                  	;clc
  2181                                  
  2182 00000CCF C3                              retn
  2183                                  
  2184                                  reset_ac97_controller:
  2185                                  	; 29/05/2024 (TRDOS 386)
  2186                                  	; 19/05/2024
  2187                                  	; 11/11/2023
  2188                                  	; 10/06/2017
  2189                                  	; 29/05/2017
  2190                                  	; 28/05/2017
  2191                                  	; reset AC97 audio controller registers
  2192 00000CD0 31C0                    	xor	eax, eax
  2193 00000CD2 66BA0B00                        mov	dx, PI_CR_REG
  2194 00000CD6 660315[6A850000]        	add	dx, [NABMBAR]
  2195                                  	;out	dx, al
  2196                                  	; 29/05/2024
  2197                                  	; al = data, byte
  2198 00000CDD B401                    	mov	ah, 1 ; write port, byte
  2199 00000CDF CD34                    	int	34h
  2200                                  
  2201                                  	; 19/05/2024
  2202                                  	;call	delay1_4ms
  2203                                  
  2204 00000CE1 66BA1B00                        mov     dx, PO_CR_REG
  2205 00000CE5 660315[6A850000]        	add	dx, [NABMBAR]
  2206                                  	;out	dx, al
  2207                                  	; 29/05/2024
  2208                                  	; al = data, byte
  2209 00000CEC B401                    	mov	ah, 1 ; write port, byte
  2210 00000CEE CD34                    	int	34h
  2211                                  
  2212                                  	; 19/05/2024
  2213                                  	;call	delay1_4ms
  2214                                  
  2215 00000CF0 66BA2B00                        mov     dx, MC_CR_REG
  2216 00000CF4 660315[6A850000]        	add	dx, [NABMBAR]
  2217                                  	;out	dx, al
  2218                                  	; 29/05/2024
  2219                                  	; al = data, byte
  2220 00000CFB B401                    	mov	ah, 1 ; write port, byte
  2221 00000CFD CD34                    	int	34h
  2222                                  
  2223                                  	; 19/05/2024
  2224                                  	;call	delay1_4ms
  2225                                  
  2226 00000CFF B002                            mov	al, RR
  2227 00000D01 66BA0B00                        mov	dx, PI_CR_REG
  2228 00000D05 660315[6A850000]        	add	dx, [NABMBAR]
  2229                                  	;out	dx, al
  2230                                  	; 29/05/2024
  2231                                  	; al = data, byte
  2232 00000D0C B401                    	mov	ah, 1 ; write port, byte
  2233 00000D0E CD34                    	int	34h
  2234                                  
  2235                                  	; 19/05/2024
  2236                                  	;call	delay1_4ms
  2237                                  
  2238 00000D10 66BA1B00                        mov	dx, PO_CR_REG
  2239 00000D14 660315[6A850000]        	add	dx, [NABMBAR]
  2240                                  	;out	dx, al
  2241                                  	; 29/05/2024
  2242                                  	; al = data, byte
  2243 00000D1B B401                    	mov	ah, 1 ; write port, byte
  2244 00000D1D CD34                    	int	34h
  2245                                  
  2246                                  	; 19/05/2024
  2247                                  	;call	delay1_4ms
  2248                                  
  2249 00000D1F 66BA2B00                        mov	dx, MC_CR_REG
  2250 00000D23 660315[6A850000]        	add	dx, [NABMBAR]
  2251                                  	;out	dx, al
  2252                                  	; 29/05/2024
  2253                                  	; al = data, byte
  2254 00000D2A B401                    	mov	ah, 1 ; write port, byte
  2255 00000D2C CD34                    	int	34h
  2256                                  
  2257                                  	; 19/05/2024
  2258                                  	;call	delay1_4ms
  2259                                  
  2260 00000D2E C3                      	retn
  2261                                  
  2262                                  reset_ac97_codec:
  2263                                  	; 29/05/2024 (TRDOS 386)
  2264                                  	; 11/11/2023
  2265                                  	; 28/05/2017 - Erdogan Tan (Ref: KolibriOS, intelac97.asm)
  2266 00000D2F 66BA2C00                	mov	dx, GLOB_CNT_REG ; 2Ch
  2267 00000D33 660315[6A850000]        	add	dx, [NABMBAR]
  2268                                  	;in	eax, dx
  2269                                  	; 29/05/2024
  2270 00000D3A B404                    	mov	ah, 4 ; read port, dword
  2271 00000D3C CD34                    	int	34h
  2272                                  
  2273                                  	;test	eax, 2
  2274                                  	; 06/08/2022
  2275 00000D3E A802                    	test	al, 2
  2276 00000D40 7407                    	jz	short _r_ac97codec_cold
  2277                                  
  2278 00000D42 E80F000000              	call	warm_ac97codec_reset
  2279 00000D47 7308                    	jnc	short _r_ac97codec_ok
  2280                                  _r_ac97codec_cold:
  2281 00000D49 E845000000                      call	cold_ac97codec_reset
  2282 00000D4E 7301                            jnc	short _r_ac97codec_ok
  2283                                  	
  2284                                  	; 16/04/2017
  2285                                          ;xor	eax, eax	; timeout error
  2286                                         	;stc
  2287 00000D50 C3                      	retn
  2288                                  
  2289                                  _r_ac97codec_ok:
  2290 00000D51 31C0                            xor     eax, eax
  2291                                          ;mov	al, VIA_ACLINK_C00_READY ; 1
  2292 00000D53 FEC0                            inc	al
  2293 00000D55 C3                      	retn
  2294                                  
  2295                                  warm_ac97codec_reset:
  2296                                  	; 29/05/2024 (TRDOS 386)
  2297                                  	; 11/11/2023
  2298                                  	; 06/08/2022 - TRDOS 386 v2.0.5
  2299                                  	; 28/05/2017 - Erdogan Tan (Ref: KolibriOS, intelac97.asm)
  2300 00000D56 B806000000              	mov	eax, 6
  2301 00000D5B 66BA2C00                	mov	dx, GLOB_CNT_REG ; 2Ch
  2302 00000D5F 660315[6A850000]        	add	dx, [NABMBAR]
  2303                                  	;out	dx, eax
  2304                                  	; 29/05/2024
  2305 00000D66 53                      	push	ebx
  2306 00000D67 89C3                    	mov	ebx, eax  ; ebx = data, dword
  2307 00000D69 B405                    	mov	ah, 5 ; write port, dword
  2308 00000D6B CD34                    	int	34h
  2309 00000D6D 5B                      	pop	ebx
  2310                                  
  2311                                  	; 30/05/2024
  2312 00000D6E B90A000000              	mov	ecx, 10	; total 1s
  2313                                  	; 29/05/2024
  2314                                  	;mov	ecx, 4000
  2315                                  _warm_ac97c_rst_wait:
  2316                                  	; 30/05/2024
  2317 00000D73 E8C0000000              	call	delay_100ms
  2318                                  
  2319 00000D78 66BA3000                	mov	dx, GLOB_STS_REG ; 30h
  2320 00000D7C 660315[6A850000]        	add	dx, [NABMBAR]
  2321                                  	;in	eax, dx
  2322                                  	; 29/05/2024
  2323 00000D83 B404                    	mov	ah, 4 ; read port, dword
  2324 00000D85 CD34                    	int	34h
  2325                                  
  2326 00000D87 A900030010              	test	eax, CTRL_ST_CREADY
  2327 00000D8C 7504                    	jnz	short _warm_ac97c_rst_ok
  2328                                  
  2329 00000D8E 49                      	dec	ecx
  2330 00000D8F 75E2                    	jnz	short _warm_ac97c_rst_wait
  2331                                  
  2332                                  _warm_ac97c_rst_fail:
  2333 00000D91 F9                              stc
  2334                                  _warm_ac97c_rst_ok:
  2335 00000D92 C3                      	retn
  2336                                  
  2337                                  cold_ac97codec_reset:
  2338                                  	; 11/11/2023
  2339                                  	; 06/08/2022 - TRDOS 386 v2.0.5
  2340                                  	; 28/05/2017 - Erdogan Tan (Ref: KolibriOS, intelac97.asm)
  2341 00000D93 B802000000                      mov	eax, 2
  2342 00000D98 66BA2C00                	mov	dx, GLOB_CNT_REG ; 2Ch
  2343 00000D9C 660315[6A850000]        	add	dx, [NABMBAR]
  2344                                  	;out	dx, eax
  2345                                  	; 29/05/2024
  2346 00000DA3 53                      	push	ebx
  2347 00000DA4 89C3                    	mov	ebx, eax  ; ebx = data, dword
  2348 00000DA6 B405                    	mov	ah, 5 ; write port, dword
  2349 00000DA8 CD34                    	int	34h
  2350 00000DAA 5B                      	pop	ebx
  2351                                  
  2352                                  	; 30/05/2024
  2353 00000DAB E888000000              	call	delay_100ms 	; wait 100 ms
  2354 00000DB0 E883000000              	call	delay_100ms 	; wait 100 ms
  2355 00000DB5 E87E000000              	call	delay_100ms 	; wait 100 ms
  2356 00000DBA E879000000              	call	delay_100ms 	; wait 100 ms
  2357                                  
  2358                                  	; 30/05/2024
  2359 00000DBF B910000000              	mov	ecx, 16	; total 20*100 ms = 2s
  2360                                  	; 29/05/2024
  2361                                  	;mov	ecx, 16000
  2362                                  _cold_ac97c_rst_wait:
  2363 00000DC4 66BA3000                	mov	dx, GLOB_STS_REG ; 30h
  2364 00000DC8 660315[6A850000]        	add	dx, [NABMBAR]
  2365                                  	;in	eax, dx
  2366                                  	; 29/05/2024
  2367 00000DCF B404                    	mov	ah, 4 ; read port, dword
  2368 00000DD1 CD34                    	int	34h
  2369                                  
  2370 00000DD3 A900030010              	test	eax, CTRL_ST_CREADY
  2371 00000DD8 7509                    	jnz	short _cold_ac97c_rst_ok
  2372                                  
  2373                                  	; 30/05/2024
  2374                                  	; 29/05/2024
  2375 00000DDA E859000000              	call	delay_100ms
  2376                                  
  2377 00000DDF 49                      	dec	ecx
  2378 00000DE0 75E2                    	jnz	short _cold_ac97c_rst_wait
  2379                                  
  2380                                  _cold_ac97c_rst_fail:
  2381 00000DE2 F9                              stc
  2382                                  _cold_ac97c_rst_ok:
  2383 00000DE3 C3                      	retn
  2384                                  
  2385                                  ; 29/12/2024 (vgaplay3.s, NASM)
  2386                                  ; 18/12/2024 (ac97play.s, FASM)
  2387                                  ; 13/11/2024
  2388                                  ; 30/05/2024
  2389                                  %if 1
  2390                                  ;if 1
  2391                                  check_vra:
  2392                                  	; 29/05/2024
  2393 00000DE4 C605[C5840000]01        	mov	byte [VRA], 1
  2394                                  
  2395                                  	; 29/05/2024 - audio.s (TRDOS 386 Kernel) - 27/05/2024
  2396                                  	; 24/05/2024
  2397                                  	; 23/05/2024
  2398 00000DEB 668B15[68850000]        	mov	dx, [NAMBAR]
  2399 00000DF2 6683C228                	add	dx, CODEC_EXT_AUDIO_REG	; 28h
  2400                                  	;in	ax, dx
  2401                                  	; 29/05/2024
  2402 00000DF6 B402                    	mov	ah, 2 ; read port, word
  2403 00000DF8 CD34                    	int	34h
  2404                                  
  2405                                  	; 30/05/2024
  2406                                  	; 23/05/2024
  2407 00000DFA E848000000              	call	delay1_4ms
  2408                                  
  2409                                  	; 29/05/2024
  2410 00000DFF A801                    	test	al, BIT0
  2411                                  	;test	al, 1 ; BIT0 ; Variable Rate Audio bit
  2412 00000E01 7507                    	jnz	short check_vra_ok
  2413                                  
  2414                                  vra_not_supported:
  2415                                  	; 13/11/2023
  2416 00000E03 C605[C5840000]00        	mov	byte [VRA], 0
  2417                                  check_vra_ok:
  2418 00000E0A C3                      	retn
  2419                                  ;end if
  2420                                  %endif
  2421                                  
  2422                                  ; --------------------------------------------------------
  2423                                  ; --------------------------------------------------------
  2424                                  
  2425                                  ; 29/12/2024 (vgaplay3.s)
  2426                                  ; 18/12/2024 (ac97play.s)
  2427                                  ;
  2428                                  ; 18/11/2024
  2429                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  2430                                  
  2431                                  ac97_stop: 
  2432                                  	; 18/11/2024
  2433 00000E0B C605[B4840000]02        	mov	byte [stopped], 2
  2434                                  
  2435                                  ac97_po_cmd@:
  2436 00000E12 30C0                    	xor	al, al ; 0
  2437                                  ac97_po_cmd:
  2438 00000E14 668B15[6A850000]        	mov     dx, [NABMBAR]
  2439 00000E1B 6683C21B                        add     dx, PO_CR_REG	; PCM out control register
  2440                                  	;out	dx, al
  2441                                  	; 01/12/2024
  2442 00000E1F B401                    	mov	ah, 1 ; write port, byte
  2443 00000E21 CD34                    	int	34h
  2444 00000E23 C3                      	retn
  2445                                  
  2446                                  ac97_pause:
  2447 00000E24 C605[B4840000]01        	mov	byte [stopped], 1 ; paused
  2448                                  	;mov	al, 0
  2449                                  	;jmp	short ac97_po_cmd
  2450 00000E2B EBE5                    	jmp	short ac97_po_cmd@
  2451                                  
  2452                                  ac97_play: ; continue to play (after pause)
  2453 00000E2D C605[B4840000]00        	mov	byte [stopped], 0
  2454 00000E34 B001                    	mov	al, RPBM
  2455 00000E36 EBDC                    	jmp	short ac97_po_cmd
  2456                                  
  2457                                  ; --------------------------------------------------------
  2458                                  
  2459                                  PORTB		EQU 061h
  2460                                  REFRESH_STATUS	EQU 010h	; Refresh signal status
  2461                                  
  2462                                  	; 29/12/2024 (vgaplay3.s)
  2463                                  	; 18/12/2024
  2464                                  	; 01/12/2024 (ac97play.s)
  2465                                  delay_100ms:
  2466                                  	; 30/05/2024 (playwav7.s)
  2467 00000E38 51                      	push	ecx
  2468 00000E39 B990010000              	mov	ecx, 400  ; 400*0.25ms
  2469                                  _delay_x_ms:
  2470 00000E3E E804000000              	call	delay1_4ms
  2471 00000E43 E2F9                            loop	_delay_x_ms
  2472 00000E45 59                      	pop	ecx
  2473 00000E46 C3                      	retn
  2474                                  
  2475                                  delay1_4ms:
  2476                                  	; 30/05/2024 (TRDOS 386)
  2477 00000E47 50                              push    eax 
  2478 00000E48 51                              push    ecx
  2479 00000E49 53                      	push	ebx
  2480 00000E4A 52                      	push	edx
  2481 00000E4B B910000000                      mov     ecx, 16			; close enough.
  2482                                  	;in	al, PORTB
  2483                                  	; 30/05/2024
  2484 00000E50 66BA6100                	mov	dx, PORTB
  2485 00000E54 B400                    	mov	ah, 0  ; read port, byte
  2486 00000E56 CD34                    	int	34h
  2487                                  
  2488 00000E58 2410                    	and	al, REFRESH_STATUS
  2489                                  	;mov	ah, al			; Start toggle state
  2490 00000E5A 88C3                    	mov	bl, al
  2491 00000E5C 09C9                    	or	ecx, ecx
  2492 00000E5E 7401                    	jz	short _d4ms1
  2493 00000E60 41                      	inc	ecx			; Throwaway first toggle
  2494                                  _d4ms1:	
  2495                                  	;in	al, PORTB		; Read system control port
  2496                                  	; 30/05/2024
  2497 00000E61 66BA6100                	mov	dx, PORTB
  2498 00000E65 B400                    	mov	ah, 0  ; read port, byte
  2499 00000E67 CD34                    	int	34h
  2500                                  
  2501 00000E69 2410                    	and	al, REFRESH_STATUS	; Refresh toggles 15.085 microseconds
  2502                                  	;cmp	ah, al
  2503 00000E6B 38C3                    	cmp	bl, al
  2504 00000E6D 74F2                    	je	short _d4ms1		; Wait for state change
  2505                                  
  2506                                  	;mov	ah, al			; Update with new state
  2507 00000E6F 88C3                    	mov	bl, al
  2508 00000E71 49                      	dec	ecx
  2509 00000E72 75ED                    	jnz	short _d4ms1
  2510                                  
  2511 00000E74 5A                      	pop	edx
  2512 00000E75 5B                              pop	ebx
  2513 00000E76 59                      	pop	ecx
  2514 00000E77 58                              pop	eax
  2515                                  c4ue_okk:
  2516 00000E78 C3                              retn
  2517                                  
  2518                                  ; --------------------------------------------------------
  2519                                  
  2520                                  getCurrentIndex:
  2521                                  	; returns AL = current index value
  2522                                  	; 01/12/2024
  2523                                  	; 29/05/2024 (TRDOS 386)
  2524                                  	; 08/11/2023
  2525 00000E79 668B15[6A850000]        	mov	dx, [NABMBAR]
  2526 00000E80 6683C214                	add	dx, PO_CIV_REG
  2527                                  	;in	al, dx
  2528                                  	; 29/05/2024
  2529 00000E84 B400                    	mov	ah, 0 ; read port, byte
  2530 00000E86 CD34                    	int	34h
  2531                                  uLVI2:	;	06/11/2023
  2532 00000E88 C3                      	retn
  2533                                  
  2534                                  ; --------------------------------------------------------
  2535                                  
  2536                                  updateLVI:
  2537                                  	; 01/12/2024
  2538                                  	; 29/05/2024 (TRDOS 386)
  2539                                  	; 08/11/2023
  2540                                  	; 07/11/2023
  2541                                  	; 06/11/2023
  2542 00000E89 668B15[6A850000]        	mov	dx, [NABMBAR]
  2543 00000E90 6683C214                	add	dx, PO_CIV_REG
  2544                                  	; (Current Index Value and Last Valid Index value)
  2545                                  	;in	ax, dx
  2546                                  	; 29/05/2024
  2547 00000E94 B402                    	mov	ah, 2 ; read port, word
  2548 00000E96 CD34                    	int	34h
  2549                                  
  2550 00000E98 38E0                    	cmp	al, ah ; is current index = last index ?
  2551 00000E9A 75EC                    	jne	short uLVI2
  2552                                  
  2553                                  	; 08/11/2023	
  2554 00000E9C E8D8FFFFFF              	call	getCurrentIndex
  2555                                   
  2556 00000EA1 F605[FA840000]01        	test	byte [flags], ENDOFFILE
  2557                                  	;jnz	short uLVI1
  2558 00000EA8 7418                    	jz	short uLVI0  ; 08/11/2023
  2559                                  
  2560                                  	; 08/11/2023
  2561 00000EAA 50                      	push	eax	; 29/05/2024 (32 bit)
  2562 00000EAB 668B15[6A850000]        	mov	dx, [NABMBAR]
  2563 00000EB2 6683C216                	add	dx, PO_SR_REG  ; PCM out status register
  2564                                  	;in	ax, dx
  2565                                  	; 29/05/2024
  2566 00000EB6 B402                    	mov	ah, 2 ; read port, word
  2567 00000EB8 CD34                    	int	34h
  2568                                  
  2569 00000EBA A803                    	test	al, 3 ; bit 1 = Current Equals Last Valid (CELV)
  2570                                  		      ; (has been processed)
  2571                                  		      ; bit 0 = 1 -> DMA Controller Halted (DCH)
  2572 00000EBC 58                      	pop	eax
  2573 00000EBD 7407                    	jz	short uLVI1
  2574                                  uLVI3:
  2575 00000EBF 31C0                    	xor	eax, eax
  2576                                  	; zf = 1
  2577 00000EC1 C3                      	retn
  2578                                  uLVI0:
  2579                                          ; not at the end of the file yet.
  2580 00000EC2 FEC8                    	dec	al
  2581 00000EC4 241F                    	and	al, 1Fh
  2582                                  uLVI1:
  2583                                  	;call	setLastValidIndex
  2584                                  ;uLVI2:
  2585                                  	;retn
  2586                                  
  2587                                  ;input AL = index # to stop on
  2588                                  setLastValidIndex:
  2589                                  	; 01/12/2024
  2590                                  	; 29/05/2024 (TRDOS 386)
  2591                                  	; 08/11/2023
  2592 00000EC6 668B15[6A850000]        	mov	dx, [NABMBAR]
  2593 00000ECD 6683C215                	add	dx, PO_LVI_REG
  2594                                          ;out	dx, al
  2595                                  	; 29/05/2024
  2596                                  	; al = data, byte
  2597 00000ED1 B401                    	mov	ah, 1 ; write port, byte
  2598 00000ED3 CD34                    	int	34h
  2599 00000ED5 C3                      	retn
  2600                                  
  2601                                  ; --------------------------------------------------------
  2602                                  ; 07/12/2024
  2603                                  ; --------------------------------------------------------
  2604                                  
  2605                                  ; /////
  2606                                  	; 14/12/2024
  2607                                  	; 07/12/2024
  2608                                  	; 01/12/2024
  2609                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  2610                                  loadFromFile:
  2611                                  	; 07/11/2023
  2612                                  
  2613 00000ED6 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2614                                  					; last of the file?
  2615 00000EDD 7402                    	jz	short lff_0		; no
  2616 00000EDF F9                      	stc
  2617 00000EE0 C3                      	retn
  2618                                  
  2619                                  lff_0:
  2620                                  	; 07/12/2024
  2621                                  	; 26/11/2023 (playwav8.s)
  2622                                  	;mov	edi, audio_buffer
  2623                                  
  2624                                  	; 01/12/2024 (TRDOS 386)
  2625                                  	; edi = audio buffer address
  2626                                  
  2627                                  	; 14/12/2024
  2628                                  	; 01/12/2024
  2629                                  	; 17/11/2024
  2630                                  	;mov	ebx, [filehandle]
  2631                                  	; 02/12/2024
  2632                                  	;mov	edx, [loadsize] 
  2633                                  
  2634                                  	; 17/11/2024
  2635 00000EE1 803D[5E850000]00        	cmp	byte [fbs_shift], 0
  2636 00000EE8 7677                    	jna	short lff_1 ; stereo, 16 bit
  2637                                  
  2638                                  lff_2:
  2639                                  	; 01/12/2024
  2640 00000EEA BE[00A00200]            	mov	esi, temp_buffer 
  2641                                  	; 14/12/2024
  2642                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000EEF 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000EF5 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000EF7 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000EFD B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00000F02 CD40                <1>  int 40h
  2643 00000F04 0F8289000000            	jc	lff_4 ; error !
  2644                                  
  2645                                  	; 01/12/2024
  2646                                  	; 14/11/2024
  2647 00000F0A A3[80850000]            	mov	[count], eax
  2648                                  
  2649                                  	; 01/12/2024
  2650 00000F0F 21C0                    	and	eax, eax
  2651                                  	;jz	short lff_3
  2652                                  	; 14/12/2024
  2653 00000F11 0F8485000000            	jz	lff_10
  2654                                  
  2655 00000F17 8A1D[5E850000]          	mov	bl, [fbs_shift]
  2656                                  
  2657                                  	; 14/12/2024
  2658 00000F1D 89FA                    	mov	edx, edi ; audio buffer start address
  2659                                  
  2660                                  	; 01/12/2024
  2661 00000F1F 89C1                    	mov	ecx, eax
  2662 00000F21 803D[EE840000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  2663 00000F28 751E                    	jne	short lff_7 ; 16 bit samples
  2664                                  	; 8 bit samples
  2665 00000F2A FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  2666 00000F2C 740E                    	jz	short lff_6 ; 8 bit, stereo
  2667                                  	; 01/12/2024 (32bit registers)
  2668                                  lff_5:
  2669                                  	; mono & 8 bit
  2670 00000F2E AC                      	lodsb
  2671 00000F2F 2C80                    	sub	al, 80h ; 08/11/2023
  2672 00000F31 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  2673 00000F34 66AB                    	stosw	; left channel
  2674 00000F36 66AB                    	stosw	; right channel
  2675 00000F38 E2F4                    	loop	lff_5
  2676 00000F3A EB16                    	jmp	short lff_9
  2677                                  lff_6:
  2678                                  	; stereo & 8 bit
  2679 00000F3C AC                      	lodsb
  2680 00000F3D 2C80                    	sub	al, 80h ; 08/11/2023
  2681 00000F3F C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  2682 00000F42 66AB                    	stosw
  2683 00000F44 E2F6                    	loop	lff_6
  2684 00000F46 EB0A                    	jmp	short lff_9
  2685                                  lff_7:
  2686 00000F48 D1E9                    	shr	ecx, 1 ; word count
  2687                                  lff_8:
  2688 00000F4A 66AD                    	lodsw
  2689 00000F4C 66AB                    	stosw	; left channel
  2690 00000F4E 66AB                    	stosw	; right channel
  2691 00000F50 E2F8                    	loop	lff_8
  2692                                  lff_9:
  2693                                  	; 14/12/2024
  2694 00000F52 89F8                    	mov	eax, edi
  2695 00000F54 8B0D[74850000]          	mov	ecx, [buffersize] 
  2696 00000F5A 01D1                    	add	ecx, edx ; + buffer start address
  2697 00000F5C 39C8                    	cmp	eax, ecx	
  2698 00000F5E 7225                    	jb	short lff_3
  2699 00000F60 C3                      	retn
  2700                                  	
  2701                                  lff_1:  
  2702                                  	; 07/12/2024
  2703                                  	; 01/12/2024
  2704                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  2705                                  	; 14/12/2024
  2706                                  	sys 	_read, [filehandle], edi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000F61 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000F67 89F9                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000F69 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000F6F B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00000F74 CD40                <1>  int 40h
  2707                                  	; 07/11/2023
  2708 00000F76 721B                    	jc	short lff_4 ; error !
  2709                                  
  2710                                  	; 01/12/2024
  2711                                  	; 14/11/2024
  2712 00000F78 A3[80850000]            	mov	[count], eax
  2713                                  
  2714                                  	; 02/12/2024
  2715 00000F7D 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  2716 00000F7F 7411                    	je	short endLFF
  2717                                  	; edi = buffer (start) address
  2718 00000F81 01C7                    	add	edi, eax
  2719 00000F83 89D1                    	mov	ecx, edx
  2720                                  lff_3:
  2721                                  	;call	padfill			; blank pad the remainder
  2722                                  	; 21/12/2024
  2723                                  padfill:
  2724                                  	; 14/12/2024
  2725                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  2726                                  	; 17/11/2024
  2727                                  	;   di = offset (to be filled with ZEROs)
  2728                                  	;   bp = buffer segment
  2729                                  	;   ax = di = number of bytes loaded
  2730                                  	;   cx = buffer size (> loaded bytes)	
  2731                                  	; 07/11/2023
  2732                                  	; 06/11/2023
  2733                                  	; 17/02/2017
  2734                                  	; 01/12/2024
  2735 00000F85 29C1                    	sub	ecx, eax
  2736                                  	; 01/12/2024
  2737                                  	; 25/11/2024
  2738 00000F87 31C0                    	xor	eax, eax
  2739                                  	; 14/12/2024
  2740 00000F89 F3AA                    	rep	stosb
  2741                                  	; 21/12/2024
  2742                                  	;retn
  2743                                  	; ----------
  2744                                          ;clc				; don't exit with CY yet.
  2745 00000F8B 800D[FA840000]01                or	byte [flags], ENDOFFILE	; end of file flag
  2746                                  endLFF:
  2747 00000F92 C3                              retn
  2748                                  lff_4:
  2749                                  	; 08/11/2023
  2750 00000F93 B021                    	mov	al, '!'  ; error
  2751 00000F95 E883F9FFFF              	call	tL0
  2752                                  
  2753                                  	; 01/12/2024
  2754 00000F9A 31C0                    	xor	eax, eax
  2755                                  lff_10:
  2756                                  	; 14/12/2024
  2757 00000F9C 8B0D[74850000]          	mov	ecx, [buffersize]
  2758 00000FA2 EBE1                    	jmp	short lff_3
  2759                                  
  2760                                  ; /////
  2761                                  
  2762                                  ; --------------------------------------------------------
  2763                                  ; --------------------------------------------------------
  2764                                  	
  2765                                  write_audio_dev_info:
  2766                                  	; 30/05/2024
  2767                                       	;sys_msg msgAudioCardInfo, 0Fh
  2768                                  	; 01/12/2024
  2769                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00000FA4 BB[26300000]        <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00000FA9 B9FF000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00000FAE BA0F000000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00000FB3 B823000000          <1>  mov eax, %1
   103                              <1> 
   104 00000FB8 CD40                <1>  int 40h
  2770 00000FBA C3                      	retn
  2771                                  
  2772                                  ; --------------------------------------------------------
  2773                                  
  2774                                  write_ac97_pci_dev_info:
  2775                                  	; 19/11/2024
  2776                                  	; 30/05/2024
  2777                                  	; 06/06/2017
  2778                                  	; 03/06/2017
  2779                                  	; BUS/DEV/FN
  2780                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  2781                                  	; DEV/VENDOR
  2782                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  2783                                  
  2784 00000FBB A1[64850000]            	mov	eax, [dev_vendor]
  2785 00000FC0 31DB                    	xor	ebx, ebx
  2786 00000FC2 88C3                    	mov	bl, al
  2787 00000FC4 88DA                    	mov	dl, bl
  2788 00000FC6 80E30F                  	and	bl, 0Fh
  2789 00000FC9 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2790 00000FCF A2[94310000]            	mov	[msgVendorId+3], al
  2791 00000FD4 88D3                    	mov	bl, dl
  2792 00000FD6 C0EB04                  	shr	bl, 4
  2793 00000FD9 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2794 00000FDF A2[93310000]            	mov	[msgVendorId+2], al
  2795 00000FE4 88E3                    	mov	bl, ah
  2796 00000FE6 88DA                    	mov	dl, bl
  2797 00000FE8 80E30F                  	and	bl, 0Fh
  2798 00000FEB 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2799 00000FF1 A2[92310000]            	mov	[msgVendorId+1], al
  2800 00000FF6 88D3                    	mov	bl, dl
  2801 00000FF8 C0EB04                  	shr	bl, 4
  2802 00000FFB 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2803 00001001 A2[91310000]            	mov	[msgVendorId], al
  2804 00001006 C1E810                  	shr	eax, 16
  2805 00001009 88C3                    	mov	bl, al
  2806 0000100B 88DA                    	mov	dl, bl
  2807 0000100D 80E30F                  	and	bl, 0Fh
  2808 00001010 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2809 00001016 A2[A5310000]            	mov	[msgDevId+3], al
  2810 0000101B 88D3                    	mov	bl, dl
  2811 0000101D C0EB04                  	shr	bl, 4
  2812 00001020 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2813 00001026 A2[A4310000]            	mov	[msgDevId+2], al
  2814 0000102B 88E3                    	mov	bl, ah
  2815 0000102D 88DA                    	mov	dl, bl
  2816 0000102F 80E30F                  	and	bl, 0Fh
  2817 00001032 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2818 00001038 A2[A3310000]            	mov	[msgDevId+1], al
  2819 0000103D 88D3                    	mov	bl, dl
  2820 0000103F C0EB04                  	shr	bl, 4
  2821 00001042 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2822 00001048 A2[A2310000]            	mov	[msgDevId], al
  2823                                  
  2824 0000104D A1[60850000]            	mov	eax, [bus_dev_fn]
  2825 00001052 C1E808                  	shr	eax, 8
  2826 00001055 88C3                    	mov	bl, al
  2827 00001057 88DA                    	mov	dl, bl
  2828 00001059 80E307                  	and	bl, 7 ; bit 0,1,2
  2829 0000105C 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2830 00001062 A2[CA310000]            	mov	[msgFncNo+1], al
  2831 00001067 88D3                    	mov	bl, dl
  2832 00001069 C0EB03                  	shr	bl, 3
  2833 0000106C 88DA                    	mov	dl, bl
  2834 0000106E 80E30F                  	and	bl, 0Fh
  2835 00001071 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2836 00001077 A2[BC310000]            	mov	[msgDevNo+1], al
  2837 0000107C 88D3                    	mov	bl, dl
  2838 0000107E C0EB04                  	shr	bl, 4
  2839 00001081 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2840 00001087 A2[BB310000]            	mov	[msgDevNo], al
  2841 0000108C 88E3                    	mov	bl, ah
  2842 0000108E 88DA                    	mov	dl, bl
  2843 00001090 80E30F                  	and	bl, 0Fh
  2844 00001093 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2845 00001099 A2[B0310000]            	mov	[msgBusNo+1], al
  2846 0000109E 88D3                    	mov	bl, dl
  2847 000010A0 C0EB04                  	shr	bl, 4
  2848 000010A3 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2849 000010A9 A2[AF310000]            	mov	[msgBusNo], al
  2850                                  
  2851                                  	;mov	ax, [ac97_NamBar]
  2852 000010AE 66A1[68850000]          	mov	ax, [NAMBAR]
  2853 000010B4 88C3                    	mov	bl, al
  2854 000010B6 88DA                    	mov	dl, bl
  2855 000010B8 80E30F                  	and	bl, 0Fh
  2856 000010BB 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2857 000010C1 A2[DA310000]            	mov	[msgNamBar+3], al
  2858 000010C6 88D3                    	mov	bl, dl
  2859 000010C8 C0EB04                  	shr	bl, 4
  2860 000010CB 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2861 000010D1 A2[D9310000]            	mov	[msgNamBar+2], al
  2862 000010D6 88E3                    	mov	bl, ah
  2863 000010D8 88DA                    	mov	dl, bl
  2864 000010DA 80E30F                  	and	bl, 0Fh
  2865 000010DD 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2866 000010E3 A2[D8310000]            	mov	[msgNamBar+1], al
  2867 000010E8 88D3                    	mov	bl, dl
  2868 000010EA C0EB04                  	shr	bl, 4
  2869 000010ED 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2870 000010F3 A2[D7310000]            	mov	[msgNamBar], al
  2871                                  
  2872                                  	;mov	ax, [ac97_NabmBar]
  2873 000010F8 66A1[6A850000]          	mov	ax, [NABMBAR]
  2874 000010FE 88C3                    	mov	bl, al
  2875 00001100 88DA                    	mov	dl, bl
  2876 00001102 80E30F                  	and	bl, 0Fh
  2877 00001105 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2878 0000110B A2[EA310000]            	mov	[msgNabmBar+3], al
  2879 00001110 88D3                    	mov	bl, dl
  2880 00001112 C0EB04                  	shr	bl, 4
  2881 00001115 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2882 0000111B A2[E9310000]            	mov	[msgNabmBar+2], al
  2883 00001120 88E3                    	mov	bl, ah
  2884 00001122 88DA                    	mov	dl, bl
  2885 00001124 80E30F                  	and	bl, 0Fh
  2886 00001127 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2887 0000112D A2[E8310000]            	mov	[msgNabmBar+1], al
  2888 00001132 88D3                    	mov	bl, dl
  2889 00001134 C0EB04                  	shr	bl, 4
  2890 00001137 8A83[4D310000]          	mov	al, [hex_chars+ebx]
  2891 0000113D A2[E7310000]            	mov	[msgNabmBar], al
  2892                                  
  2893 00001142 31C0                    	xor	eax, eax
  2894 00001144 A0[FB840000]            	mov	al, [ac97_int_ln_reg]
  2895 00001149 B10A                    	mov	cl, 10
  2896 0000114B F6F1                    	div	cl
  2897                                  	; 23/11/2024
  2898                                  	;add	[msgIRQ], ax
  2899 0000114D 66053030                	add	ax, 3030h
  2900 00001151 66A3[F3310000]          	mov	[msgIRQ], ax
  2901                                  	;and	al, al
  2902 00001157 3C30                    	cmp	al, 30h
  2903 00001159 750D                    	jnz	short _w_ac97imsg_
  2904 0000115B A0[F4310000]            	mov	al, byte [msgIRQ+1]
  2905 00001160 B420                    	mov	ah, ' '
  2906 00001162 66A3[F3310000]          	mov	[msgIRQ], ax
  2907                                  _w_ac97imsg_:
  2908                                  	; 19/11/2024
  2909 00001168 E8B81C0000              	call 	clear_window
  2910 0000116D B60D                    	mov	dh, 13
  2911 0000116F B200                    	mov	dl, 0
  2912 00001171 E8CA190000              	call	setCursorPosition
  2913                                  	;;;
  2914                                  	; 21/12/2024
  2915 00001176 BD[5E310000]            	mov	ebp, msgAC97Info ; message
  2916                                  	; 22/12/2024
  2917                                  	;mov	cl, 07h ; color 
  2918 0000117B E81F000000              	call	sys_gmsg
  2919                                  	;
  2920                                  	; 30/05/2024
  2921                                  write_VRA_info:
  2922                                  	; 21/12/2024
  2923 00001180 BD[F8310000]            	mov	ebp, msgVRAheader ; message
  2924                                  	;mov	cl, 07h ; color 
  2925 00001185 E815000000              	call	sys_gmsg
  2926                                  	;
  2927 0000118A 803D[C5840000]00        	cmp	byte [VRA], 0
  2928 00001191 7607                    	jna	short _w_VRAi_no
  2929                                  _w_VRAi_yes:
  2930 00001193 BD[07320000]            	mov	ebp, msgVRAyes
  2931 00001198 EB05                    	jmp	short _w_VRAi_yn_msg
  2932                                  _w_VRAi_no:
  2933 0000119A BD[0D320000]            	mov	ebp, msgVRAno
  2934                                  _w_VRAi_yn_msg:
  2935                                  	;mov	cl, 07h ; color 
  2936                                  	;call	sys_msg
  2937                                  	;retn
  2938                                  	;jmp	short sys_gmsg
  2939                                  	;;;
  2940                                  ; --------------------------------------------------------
  2941                                  
  2942                                  	; 22/12/2024
  2943                                  	;;;
  2944                                  	; 21/12/2024
  2945                                  	; (write message in VGA/VESA-VBE mode)
  2946                                  sys_gmsg:
  2947 0000119F 8A4500                  	mov	al, [ebp]
  2948 000011A2 20C0                    	and	al, al
  2949 000011A4 7458                    	jz	short sys_gmsg_ok
  2950 000011A6 3C20                    	cmp	al, 20h
  2951 000011A8 731E                    	jnb	short sys_gmsg_3
  2952 000011AA 3C0D                    	cmp	al, CR ; 13
  2953 000011AC 750C                    	jne	short sys_gmsg_2
  2954                                  	; carriege return, move cursor to column 0
  2955 000011AE 66C705[A47A0000]00-     	mov	word [screenpos], 0
  2955 000011B6 00                 
  2956                                  sys_gmsg_1:
  2957 000011B7 45                      	inc	ebp
  2958 000011B8 EBE5                    	jmp	short sys_gmsg
  2959                                  sys_gmsg_2:
  2960 000011BA 3C0A                    	cmp	al, LF ; 10
  2961 000011BC 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  2962                                  	; line feed, move cursor to next row
  2963 000011BE 668305[A67A0000]10      	add	word [screenpos+2], 16
  2964 000011C6 EBEF                    	jmp	short sys_gmsg_1
  2965                                  sys_gmsg_3:
  2966 000011C8 8B35[A47A0000]          	mov	esi, [screenpos]
  2967                                  		; hw = (cursor) row
  2968                                  		; si = (cursor) column
  2969 000011CE B907000000              	mov	ecx, 07h ; gray (light)
  2970 000011D3 E8211B0000              	call	write_character
  2971 000011D8 83C608                  	add	esi, 8
  2972                                  	;;;
  2973 000011DB 6681FE8002              	cmp	si, 640
  2974 000011E0 7213                    	jb	short sys_gmsg_5
  2975 000011E2 C1EE10                  	shr	esi, 16
  2976 000011E5 6683C610                	add	si, 16
  2977 000011E9 6681FEE001              	cmp	si, 480
  2978 000011EE 7202                    	jb	short sys_gmsg_4
  2979 000011F0 31F6                    	xor	esi, esi
  2980                                  sys_gmsg_4:
  2981 000011F2 C1E610                  	shl	esi, 16
  2982                                  	;;;
  2983                                  sys_gmsg_5:
  2984 000011F5 8935[A47A0000]          	mov	[screenpos], esi
  2985 000011FB 45                      	inc	ebp
  2986 000011FC EBA1                    	jmp	short sys_gmsg
  2987                                  sys_gmsg_ok:
  2988 000011FE C3                      	retn
  2989                                  	;;;
  2990                                  
  2991                                  ; --------------------------------------------------------
  2992                                  
  2993                                  ; 29/12/2024 - vgaplay3.s
  2994                                  ; 18/12/2024
  2995                                  ; 01/12/2024 - ac97play.s
  2996                                  ; 29/05/2024
  2997                                  ; 26/11/2023
  2998                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  2999                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  3000                                  ; 14/11/2023
  3001                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  3002                                  ; --------------------------------------------------------
  3003                                  
  3004                                  ;;Note:	At the end of every buffer load,
  3005                                  ;;	during buffer switch/swap, there will be discontinuity
  3006                                  ;;	between the last converted sample and the 1st sample
  3007                                  ;;	of the next buffer.
  3008                                  ;;	(like as a dot noises vaguely between normal sound samples)
  3009                                  ;;	-To avoid this defect, the 1st sample of
  3010                                  ;;	the next buffer may be read from the wav file but
  3011                                  ;;	the file pointer would need to be set to 1 sample back
  3012                                  ;;	again via seek system call. Time comsumption problem! -
  3013                                  ;;
  3014                                  ;;	Erdogan Tan - 15/11/2023
  3015                                  ;;
  3016                                  ;;	((If entire wav data would be loaded at once.. conversion
  3017                                  ;;	defect/noise would disappear.. but for DOS, to keep
  3018                                  ;;	64KB buffer limit is important also it is important
  3019                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  3020                                  ;;	I have tested this program by using 2-30MB wav files.))
  3021                                  ;;
  3022                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  3023                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  3024                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  3025                                  ;;			Realtek ALC850 codec.
  3026                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  3027                                  
  3028                                  load_8khz_mono_8_bit:
  3029                                  	; 15/11/2023
  3030                                  	; 14/11/2023
  3031                                  	; 13/11/2023
  3032 000011FF F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3033                                  					; last of the file?
  3034 00001206 7402                    	jz	short lff8m_0		; no
  3035 00001208 F9                      	stc
  3036 00001209 C3                      	retn
  3037                                  
  3038                                  lff8m_0:
  3039                                  	; 01/12/2024
  3040                                  	; edi = audio buffer address
  3041                                  	; 13/12/2024
  3042 0000120A 893D[B07A0000]          	mov	[audio_buffer], edi
  3043 00001210 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3044                                          ;mov	edx, [loadsize]
  3045                                  
  3046                                  	; esi = buffer address
  3047                                  	;; edx = buffer size
  3048                                  
  3049                                  	; load file into memory
  3050                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001215 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 0000121B 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000121D 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001223 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001228 CD40                <1>  int 40h
  3051 0000122A 7305                    	jnc	short lff8m_6
  3052 0000122C E9B3000000              	jmp	lff8m_5  ; error !
  3053                                  
  3054                                  lff8m_6:
  3055                                  	; 01/12/2024
  3056 00001231 A3[80850000]            	mov	[count], eax
  3057                                  	;mov	edi, audio_buffer
  3058                                  	; 29/05/2024
  3059 00001236 8B3D[B07A0000]          	mov	edi, [audio_buffer]
  3060                                  	;and	eax, eax
  3061 0000123C 0F8499000000            	jz	lff8_eof
  3062                                  
  3063 00001242 89C1                    	mov	ecx, eax		; byte count
  3064                                  lff8m_1:
  3065 00001244 AC                      	lodsb
  3066 00001245 A2[D2280000]            	mov	[previous_val], al
  3067 0000124A 2C80                    	sub	al, 80h
  3068 0000124C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3069 00001250 66AB                    	stosw		; original sample (left channel)
  3070 00001252 66AB                    	stosw		; original sample (right channel)
  3071                                  	;xor	eax, eax
  3072 00001254 B080                    	mov	al, 80h
  3073 00001256 49                      	dec	ecx
  3074 00001257 7402                    	jz	short lff8m_2
  3075 00001259 8A06                    	mov	al, [esi]
  3076                                  lff8m_2:
  3077                                  	;mov	[next_val], ax
  3078 0000125B 88C7                    	mov	bh, al	; [next_val]
  3079 0000125D 8A25[D2280000]          	mov	ah, [previous_val]
  3080 00001263 00E0                    	add	al, ah	; [previous_val]
  3081 00001265 D0D8                    	rcr	al, 1
  3082 00001267 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  3083 00001269 00E0                    	add	al, ah	; [previous_val]
  3084 0000126B D0D8                    	rcr	al, 1	
  3085 0000126D 88C3                    	mov	bl, al 	; this is temporary interpolation value
  3086 0000126F 00E0                    	add	al, ah	; [previous_val]
  3087 00001271 D0D8                    	rcr	al, 1
  3088 00001273 2C80                    	sub	al, 80h
  3089 00001275 66C1E008                	shl	ax, 8	
  3090 00001279 66AB                    	stosw		; this is 1st interpolated sample (L)
  3091 0000127B 66AB                    	stosw		; this is 1st interpolated sample (R)
  3092 0000127D 88D8                    	mov	al, bl
  3093 0000127F 00D0                    	add	al, dl
  3094 00001281 D0D8                    	rcr	al, 1
  3095 00001283 2C80                    	sub	al, 80h
  3096 00001285 66C1E008                	shl	ax, 8
  3097 00001289 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3098 0000128B 66AB                    	stosw		; this is 2nd interpolated sample (R)
  3099 0000128D 88D0                    	mov	al, dl
  3100 0000128F 2C80                    	sub	al, 80h
  3101 00001291 66C1E008                	shl	ax, 8
  3102 00001295 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  3103 00001297 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  3104                                  	;mov	al, [next_val]
  3105 00001299 88F8                    	mov	al, bh
  3106 0000129B 00D0                    	add	al, dl
  3107 0000129D D0D8                    	rcr	al, 1
  3108 0000129F 88C3                    	mov	bl, al	; this is temporary interpolation value
  3109 000012A1 00D0                    	add	al, dl
  3110 000012A3 D0D8                    	rcr	al, 1
  3111 000012A5 2C80                    	sub	al, 80h
  3112 000012A7 66C1E008                	shl	ax, 8
  3113 000012AB 66AB                    	stosw		; this is 4th interpolated sample (L)
  3114 000012AD 66AB                    	stosw		; this is 4th interpolated sample (R)
  3115                                  	;mov	al, [next_val]
  3116 000012AF 88F8                    	mov	al, bh
  3117 000012B1 00D8                    	add	al, bl
  3118 000012B3 D0D8                    	rcr	al, 1
  3119 000012B5 2C80                    	sub	al, 80h
  3120 000012B7 66C1E008                	shl	ax, 8
  3121 000012BB 66AB                    	stosw		; this is 5th interpolated sample (L)
  3122 000012BD 66AB                    	stosw		; this is 5th interpolated sample (R)
  3123                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3124 000012BF 09C9                    	or	ecx, ecx
  3125 000012C1 7581                    	jnz	short lff8m_1
  3126                                  
  3127                                  	; --------------
  3128                                  
  3129                                  lff8s_3:
  3130                                  lff8m_3:
  3131                                  lff8s2_3:
  3132                                  lff8m2_3:
  3133                                  lff16s_3:
  3134                                  lff16m_3:
  3135                                  lff16s2_3:
  3136                                  lff16m2_3:
  3137                                  lff24_3:
  3138                                  lff32_3:
  3139                                  lff44_3:
  3140                                  lff22_3:
  3141                                  lff11_3:
  3142                                  	; 08/12/2024 (BugFix)
  3143                                  	; 31/05/2024
  3144 000012C3 8B0D[74850000]          	mov	ecx, [buffersize] ; buffer size in words
  3145                                  	; 29/12/2024
  3146                                  	; 08/12/2024
  3147                                  	;shl	ecx, 1 ; buffer size in bytes
  3148                                  	; 13/12/2024
  3149 000012C9 030D[B07A0000]          	add	ecx, [audio_buffer] ; + start address of the buffer
  3150 000012CF 29F9                    	sub	ecx, edi
  3151 000012D1 7607                    	jna	short lff8m_4
  3152                                  	;inc	ecx
  3153 000012D3 C1E902                  	shr	ecx, 2
  3154 000012D6 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  3155 000012D8 F3AB                    	rep	stosd
  3156                                  lff8m_4:
  3157                                  	; 31/05/2024
  3158                                  	; cf=1
  3159                                  	; 08/12/2024
  3160                                  	;clc
  3161 000012DA C3                      	retn
  3162                                  
  3163                                  lff8_eof:
  3164                                  lff16_eof:
  3165                                  lff24_eof:
  3166                                  lff32_eof:
  3167                                  lff44_eof:
  3168                                  lff22_eof:
  3169                                  lff11_eof:
  3170                                  	; 15/11/2023
  3171 000012DB C605[FA840000]01        	mov	byte [flags], ENDOFFILE
  3172 000012E2 EBDF                    	jmp	short lff8m_3
  3173                                  
  3174                                  lff8s_5:
  3175                                  lff8m_5:
  3176                                  lff8s2_5:
  3177                                  lff8m2_5:
  3178                                  lff16s_5:
  3179                                  lff16m_5:
  3180                                  lff16s2_5:
  3181                                  lff16m2_5:
  3182                                  lff24_5:
  3183                                  lff32_5:
  3184                                  lff44_5:
  3185                                  lff22_5:
  3186                                  lff11_5:
  3187 000012E4 B021                    	mov	al, '!'  ; error
  3188 000012E6 E832F6FFFF              	call	tL0
  3189                                  	
  3190                                  	;jmp	short lff8m_3
  3191                                  	; 15/11/2023
  3192 000012EB EBEE                    	jmp	lff8_eof
  3193                                  
  3194                                  	; --------------
  3195                                  
  3196                                  load_8khz_stereo_8_bit:
  3197                                  	; 15/11/2023
  3198                                  	; 14/11/2023
  3199                                  	; 13/11/2023
  3200 000012ED F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3201                                  					; last of the file?
  3202 000012F4 7402                    	jz	short lff8s_0		; no
  3203 000012F6 F9                      	stc
  3204 000012F7 C3                      	retn
  3205                                  
  3206                                  lff8s_0:
  3207                                  	; 01/12/2024
  3208                                  	; edi = audio buffer address
  3209                                  	; 13/12/2024
  3210 000012F8 893D[B07A0000]          	mov	[audio_buffer], edi
  3211 000012FE BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3212                                          ;mov	edx, [loadsize]
  3213                                  
  3214                                  	; esi = buffer address
  3215                                  	;; edx = buffer size
  3216                                  
  3217                                  	; load file into memory
  3218                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001303 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001309 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000130B 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001311 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001316 CD40                <1>  int 40h
  3219 00001318 72CA                    	jc	short lff8s_5 ; error !
  3220                                  
  3221                                  	; 01/12/2024
  3222 0000131A A3[80850000]            	mov	[count], eax
  3223                                  
  3224                                  	;mov	edi, audio_buffer
  3225                                  	; 29/05/2024
  3226                                  	;mov	edi, [audio_buffer]
  3227                                  	
  3228 0000131F D1E8                    	shr	eax, 1
  3229 00001321 74B8                    	jz	short lff8_eof
  3230                                  
  3231 00001323 89C1                    	mov	ecx, eax	; word count
  3232                                  lff8s_1:
  3233 00001325 AC                      	lodsb
  3234 00001326 A2[D2280000]            	mov	[previous_val_l], al
  3235 0000132B 2C80                    	sub	al, 80h
  3236 0000132D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3237 00001331 66AB                    	stosw		; original sample (L)
  3238 00001333 AC                      	lodsb
  3239 00001334 A2[D4280000]            	mov	[previous_val_r], al
  3240 00001339 2C80                    	sub	al, 80h
  3241 0000133B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3242 0000133F 66AB                    	stosw		; original sample (R)
  3243                                  
  3244                                  	;xor	eax, eax
  3245 00001341 66B88080                	mov	ax, 8080h
  3246 00001345 49                      	dec	ecx
  3247 00001346 7403                    	jz	short lff8s_2
  3248                                  		; convert 8 bit sample to 16 bit sample
  3249 00001348 668B06                  	mov	ax, [esi]
  3250                                  lff8s_2:
  3251 0000134B A2[D6280000]            	mov	[next_val_l], al
  3252 00001350 8825[D8280000]          	mov	[next_val_r], ah
  3253 00001356 8A25[D2280000]          	mov	ah, [previous_val_l]
  3254 0000135C 00E0                    	add	al, ah
  3255 0000135E D0D8                    	rcr	al, 1
  3256 00001360 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  3257 00001362 00E0                    	add	al, ah
  3258 00001364 D0D8                    	rcr	al, 1
  3259 00001366 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  3260 00001368 00E0                    	add	al, ah
  3261 0000136A D0D8                    	rcr	al, 1
  3262 0000136C 2C80                    	sub	al, 80h
  3263 0000136E 66C1E008                	shl	ax, 8
  3264 00001372 66AB                    	stosw		; this is 1st interpolated sample (L)
  3265 00001374 A0[D8280000]            	mov	al, [next_val_r]
  3266 00001379 8A25[D4280000]          	mov	ah, [previous_val_r]
  3267 0000137F 00E0                    	add	al, ah
  3268 00001381 D0D8                    	rcr	al, 1
  3269 00001383 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  3270 00001385 00E0                    	add	al, ah
  3271 00001387 D0D8                    	rcr	al, 1
  3272 00001389 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  3273 0000138B 00E0                    	add	al, ah
  3274 0000138D D0D8                    	rcr	al, 1
  3275 0000138F 2C80                    	sub	al, 80h
  3276 00001391 66C1E008                	shl	ax, 8
  3277 00001395 66AB                    	stosw		; this is 1st interpolated sample (R)
  3278 00001397 88D8                    	mov	al, bl
  3279 00001399 00D0                    	add	al, dl
  3280 0000139B D0D8                    	rcr	al, 1
  3281 0000139D 2C80                    	sub	al, 80h
  3282 0000139F 66C1E008                	shl	ax, 8
  3283 000013A3 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3284 000013A5 88F8                    	mov	al, bh
  3285 000013A7 00F0                    	add	al, dh
  3286 000013A9 D0D8                    	rcr	al, 1
  3287 000013AB 2C80                    	sub	al, 80h
  3288 000013AD 66C1E008                	shl	ax, 8
  3289 000013B1 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  3290 000013B3 88D0                    	mov	al, dl
  3291 000013B5 2C80                    	sub	al, 80h
  3292 000013B7 66C1E008                	shl	ax, 8
  3293 000013BB 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  3294 000013BD 88F0                    	mov	al, dh
  3295 000013BF 2C80                    	sub	al, 80h
  3296 000013C1 66C1E008                	shl	ax, 8
  3297 000013C5 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  3298 000013C7 A0[D6280000]            	mov	al, [next_val_l]
  3299 000013CC 00D0                    	add	al, dl
  3300 000013CE D0D8                    	rcr	al, 1
  3301 000013D0 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  3302 000013D2 00D0                    	add	al, dl
  3303 000013D4 D0D8                    	rcr	al, 1
  3304 000013D6 2C80                    	sub	al, 80h
  3305 000013D8 66C1E008                	shl	ax, 8
  3306 000013DC 66AB                    	stosw		; this is 4th interpolated sample (L)
  3307 000013DE A0[D8280000]            	mov	al, [next_val_r]
  3308 000013E3 00F0                    	add	al, dh
  3309 000013E5 D0D8                    	rcr	al, 1
  3310 000013E7 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  3311 000013E9 00F0                    	add	al, dh
  3312 000013EB D0D8                    	rcr	al, 1
  3313 000013ED 2C80                    	sub	al, 80h
  3314 000013EF 66C1E008                	shl	ax, 8
  3315 000013F3 66AB                    	stosw		; this is 4th interpolated sample (R)
  3316 000013F5 A0[D6280000]            	mov	al, [next_val_l]
  3317 000013FA 00D8                    	add	al, bl
  3318 000013FC D0D8                    	rcr	al, 1
  3319 000013FE 2C80                    	sub	al, 80h
  3320 00001400 66C1E008                	shl	ax, 8
  3321 00001404 66AB                    	stosw		; this is 5th interpolated sample (L)
  3322 00001406 A0[D8280000]            	mov	al, [next_val_r]
  3323 0000140B 00F8                    	add	al, bh
  3324 0000140D D0D8                    	rcr	al, 1
  3325 0000140F 2C80                    	sub	al, 80h
  3326 00001411 66C1E008                	shl	ax, 8
  3327 00001415 66AB                    	stosw		; this is 5th interpolated sample (R)
  3328                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3329 00001417 E305                    	jecxz	lff8s_6
  3330 00001419 E907FFFFFF              	jmp	lff8s_1
  3331                                  lff8s_6:
  3332 0000141E E9A0FEFFFF              	jmp	lff8s_3
  3333                                  
  3334                                  load_8khz_mono_16_bit:
  3335                                  	; 13/11/2023
  3336 00001423 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3337                                  					; last of the file?
  3338 0000142A 7402                    	jz	short lff8m2_0		; no
  3339 0000142C F9                      	stc
  3340 0000142D C3                      	retn
  3341                                  
  3342                                  lff8m2_0:
  3343                                  	; 01/12/2024
  3344                                  	; edi = audio buffer address
  3345                                  	; 13/12/2024
  3346 0000142E 893D[B07A0000]          	mov	[audio_buffer], edi
  3347 00001434 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3348                                          ;mov	edx, [loadsize]
  3349                                  
  3350                                  	; esi = buffer address
  3351                                  	;; edx = buffer size
  3352                                  
  3353                                  	; load file into memory
  3354                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001439 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 0000143F 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001441 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001447 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 0000144C CD40                <1>  int 40h
  3355 0000144E 0F82A0000000            	jc	lff8m2_7 ; error !
  3356                                  
  3357                                  	; 01/12/2024
  3358 00001454 A3[80850000]            	mov	[count], eax
  3359                                  
  3360                                  	;mov	edi, audio_buffer
  3361                                  	; 29/05/2024
  3362                                  	;mov	edi, [audio_buffer]
  3363                                  	
  3364 00001459 D1E8                    	shr	eax, 1
  3365 0000145B 7505                    	jnz	short lff8m2_8
  3366 0000145D E979FEFFFF              	jmp	lff8_eof
  3367                                  
  3368                                  lff8m2_8:
  3369 00001462 89C1                    	mov	ecx, eax	; word count
  3370                                  lff8m2_1:
  3371 00001464 66AD                    	lodsw
  3372 00001466 66AB                    	stosw		; original sample (left channel)
  3373 00001468 66AB                    	stosw		; original sample (right channel)
  3374 0000146A 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  3375 0000146D 66A3[D2280000]          	mov	[previous_val], ax
  3376 00001473 31C0                    	xor	eax, eax
  3377 00001475 49                      	dec	ecx
  3378 00001476 7403                    	jz	short lff8m2_2
  3379 00001478 668B06                  	mov	ax, [esi]
  3380                                  lff8m2_2:
  3381 0000147B 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  3382 0000147E 89C5                    	mov	ebp, eax	; [next_val]
  3383 00001480 660305[D2280000]        	add	ax, [previous_val]
  3384 00001487 66D1D8                  	rcr	ax, 1
  3385 0000148A 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  3386 0000148C 660305[D2280000]        	add	ax, [previous_val]
  3387 00001493 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  3388 00001496 89C3                    	mov	ebx, eax 		
  3389 00001498 660305[D2280000]        	add	ax, [previous_val]
  3390 0000149F 66D1D8                  	rcr	ax, 1
  3391 000014A2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3392 000014A5 66AB                    	stosw		; this is 1st interpolated sample (L)
  3393 000014A7 66AB                    	stosw		; this is 1st interpolated sample (R)
  3394 000014A9 89D8                    	mov	eax, ebx
  3395 000014AB 6601D0                  	add	ax, dx
  3396 000014AE 66D1D8                  	rcr	ax, 1
  3397 000014B1 80EC80                  	sub	ah, 80h
  3398 000014B4 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3399 000014B6 66AB                    	stosw		; this is 2nd interpolated sample (R)
  3400 000014B8 89D0                    	mov	eax, edx
  3401 000014BA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3402 000014BD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  3403 000014BF 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  3404 000014C1 89E8                    	mov	eax, ebp
  3405 000014C3 6601D0                  	add	ax, dx
  3406 000014C6 66D1D8                  	rcr	ax, 1
  3407 000014C9 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  3408 000014CB 6601D0                  	add	ax, dx
  3409 000014CE 66D1D8                  	rcr	ax, 1
  3410 000014D1 80EC80                  	sub	ah, 80h
  3411 000014D4 66AB                    	stosw		; this is 4th interpolated sample (L)
  3412 000014D6 66AB                    	stosw		; this is 4th interpolated sample (R)
  3413 000014D8 89E8                    	mov	eax, ebp
  3414 000014DA 6601D8                  	add	ax, bx
  3415 000014DD 66D1D8                  	rcr	ax, 1
  3416 000014E0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3417 000014E3 66AB                    	stosw		; this is 5th interpolated sample (L)
  3418 000014E5 66AB                    	stosw		; this is 5th interpolated sample (R)
  3419                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3420 000014E7 09C9                    	or	ecx, ecx
  3421 000014E9 0F8575FFFFFF            	jnz	lff8m2_1
  3422 000014EF E9CFFDFFFF              	jmp	lff8m2_3
  3423                                  
  3424                                  lff8m2_7:
  3425                                  lff8s2_7:
  3426 000014F4 E9EBFDFFFF              	jmp	lff8m2_5  ; error
  3427                                  
  3428                                  load_8khz_stereo_16_bit:
  3429                                  	; 16/11/2023
  3430                                  	; 15/11/2023
  3431                                  	; 13/11/2023
  3432 000014F9 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3433                                  					; last of the file?
  3434 00001500 7402                    	jz	short lff8s2_0		; no
  3435 00001502 F9                      	stc
  3436 00001503 C3                      	retn
  3437                                  
  3438                                  lff8s2_0:
  3439                                  	; 01/12/2024
  3440                                  	; edi = audio buffer address
  3441                                  	; 13/12/2024
  3442 00001504 893D[B07A0000]          	mov	[audio_buffer], edi
  3443 0000150A BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3444                                          ;mov	edx, [loadsize]
  3445                                  
  3446                                  	; esi = buffer address
  3447                                  	;; edx = buffer size
  3448                                  
  3449                                  	; load file into memory
  3450                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000150F 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001515 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001517 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000151D B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001522 CD40                <1>  int 40h
  3451 00001524 72CE                    	jc	short lff8s2_7 ; error !
  3452                                  
  3453                                  	; 01/12/2024
  3454 00001526 A3[80850000]            	mov	[count], eax
  3455                                  
  3456                                  	;mov	edi, audio_buffer
  3457                                  	; 29/05/2024
  3458                                  	;mov	edi, [audio_buffer]
  3459                                  	
  3460 0000152B C1E802                  	shr	eax, 2
  3461 0000152E 7505                    	jnz	short lff8s2_8
  3462 00001530 E9A6FDFFFF              	jmp	lff8_eof
  3463                                  
  3464                                  lff8s2_8:
  3465 00001535 89C1                    	mov	ecx, eax ; dword count
  3466                                  lff8s2_1:
  3467 00001537 66AD                    	lodsw
  3468 00001539 66AB                    	stosw		; original sample (L)
  3469                                  	; 15/11/2023
  3470 0000153B 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  3471 0000153E 66A3[D2280000]          	mov	[previous_val_l], ax
  3472 00001544 66AD                    	lodsw
  3473 00001546 66AB                    	stosw		; original sample (R)
  3474 00001548 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  3475 0000154B 66A3[D4280000]          	mov	[previous_val_r], ax
  3476 00001551 31D2                    	xor	edx, edx
  3477 00001553 31C0                    	xor	eax, eax
  3478                                  	; 16/11/2023
  3479 00001555 49                      	dec	ecx
  3480 00001556 7407                    	jz	short lff8s2_2
  3481 00001558 668B06                  	mov	ax, [esi]
  3482 0000155B 668B5602                	mov	dx, [esi+2]
  3483                                  lff8s2_2:
  3484 0000155F 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  3485 00001562 66A3[D6280000]          	mov	[next_val_l], ax
  3486 00001568 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  3487 0000156B 668915[D8280000]        	mov	[next_val_r], dx
  3488 00001572 660305[D2280000]        	add	ax, [previous_val_l]
  3489 00001579 66D1D8                  	rcr	ax, 1
  3490 0000157C 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  3491 0000157E 660305[D2280000]        	add	ax, [previous_val_l]
  3492 00001585 66D1D8                  	rcr	ax, 1	
  3493 00001588 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  3494 0000158A 660305[D2280000]        	add	ax, [previous_val_l]
  3495 00001591 66D1D8                  	rcr	ax, 1
  3496 00001594 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3497 00001597 66AB                    	stosw		; this is 1st interpolated sample (L)
  3498 00001599 66A1[D8280000]          	mov	ax, [next_val_r]
  3499 0000159F 660305[D4280000]        	add	ax, [previous_val_r]
  3500 000015A6 66D1D8                  	rcr	ax, 1
  3501 000015A9 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  3502 000015AB 660305[D4280000]        	add	ax, [previous_val_r]
  3503 000015B2 66D1D8                  	rcr	ax, 1
  3504 000015B5 50                      	push	eax ; *	; this is temporary interpolation value (R)
  3505 000015B6 660305[D4280000]        	add	ax, [previous_val_r]
  3506 000015BD 66D1D8                  	rcr	ax, 1
  3507 000015C0 80EC80                  	sub	ah, 80h
  3508 000015C3 66AB                    	stosw		; this is 1st interpolated sample (R)
  3509 000015C5 89D8                    	mov	eax, ebx
  3510 000015C7 6601D0                  	add	ax, dx
  3511 000015CA 66D1D8                  	rcr	ax, 1
  3512 000015CD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3513 000015D0 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3514 000015D2 58                      	pop	eax ; *
  3515 000015D3 6601E8                  	add	ax, bp
  3516 000015D6 66D1D8                  	rcr	ax, 1
  3517 000015D9 80EC80                  	sub	ah, 80h
  3518 000015DC 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  3519 000015DE 89D0                    	mov	eax, edx
  3520 000015E0 80EC80                  	sub	ah, 80h
  3521 000015E3 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  3522 000015E5 89E8                    	mov	eax, ebp
  3523 000015E7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3524 000015EA 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  3525 000015EC 66A1[D6280000]          	mov	ax, [next_val_l]
  3526 000015F2 6601D0                  	add	ax, dx
  3527 000015F5 66D1D8                  	rcr	ax, 1
  3528 000015F8 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  3529 000015FA 6601D0                  	add	ax, dx
  3530 000015FD 66D1D8                  	rcr	ax, 1
  3531 00001600 80EC80                  	sub	ah, 80h
  3532 00001603 66AB                    	stosw		; this is 4th interpolated sample (L)
  3533 00001605 66A1[D8280000]          	mov	ax, [next_val_r]
  3534 0000160B 6601E8                  	add	ax, bp
  3535 0000160E 66D1D8                  	rcr	ax, 1
  3536 00001611 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  3537 00001612 6601E8                  	add	ax, bp
  3538 00001615 66D1D8                  	rcr	ax, 1
  3539 00001618 80EC80                  	sub	ah, 80h
  3540 0000161B 66AB                    	stosw		; this is 4th interpolated sample (R)
  3541 0000161D 66A1[D6280000]          	mov	ax, [next_val_l]
  3542 00001623 6601D8                  	add	ax, bx
  3543 00001626 66D1D8                  	rcr	ax, 1
  3544 00001629 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3545 0000162C 66AB                    	stosw		; this is 5th interpolated sample (L)
  3546 0000162E 58                      	pop	eax ; **
  3547 0000162F 660305[D8280000]        	add	ax, [next_val_r]
  3548 00001636 66D1D8                  	rcr	ax, 1
  3549 00001639 80EC80                  	sub	ah, 80h
  3550 0000163C 66AB                    	stosw		; this is 5th interpolated sample (R)
  3551                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3552 0000163E E305                    	jecxz	lff8_s2_9
  3553 00001640 E9F2FEFFFF              	jmp	lff8s2_1
  3554                                  lff8_s2_9:
  3555 00001645 E979FCFFFF              	jmp	lff8s2_3
  3556                                  
  3557                                  ; .....................
  3558                                  
  3559                                  load_16khz_mono_8_bit:
  3560                                  	; 14/11/2023
  3561                                  	; 13/11/2023
  3562 0000164A F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3563                                  					; last of the file?
  3564 00001651 7402                    	jz	short lff16m_0		; no
  3565 00001653 F9                      	stc
  3566 00001654 C3                      	retn
  3567                                  
  3568                                  lff16m_0:
  3569                                  	; 01/12/2024
  3570                                  	; edi = audio buffer address
  3571                                  	; 13/12/2024
  3572 00001655 893D[B07A0000]          	mov	[audio_buffer], edi
  3573 0000165B BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3574                                          ;mov	edx, [loadsize]
  3575                                  
  3576                                  	; esi = buffer address
  3577                                  	;; edx = buffer size
  3578                                  
  3579                                  	; load file into memory
  3580                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001660 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001666 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001668 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000166E B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001673 CD40                <1>  int 40h
  3581 00001675 7253                    	jc	short lff16m_7 ; error !
  3582                                  
  3583                                  	; 01/12/2024
  3584 00001677 A3[80850000]            	mov	[count], eax
  3585                                  
  3586                                  	;mov	edi, audio_buffer
  3587                                  	; 29/05/2024
  3588                                  	;mov	edi, [audio_buffer]
  3589                                  	
  3590 0000167C 21C0                    	and	eax, eax
  3591 0000167E 7505                    	jnz	short lff16m_8
  3592 00001680 E956FCFFFF              	jmp	lff16_eof
  3593                                  
  3594                                  lff16m_8:
  3595 00001685 89C1                    	mov	ecx, eax		; byte count
  3596                                  lff16m_1:
  3597 00001687 AC                      	lodsb
  3598                                  	;mov	[previous_val], al
  3599 00001688 88C3                    	mov	bl, al
  3600 0000168A 2C80                    	sub	al, 80h
  3601 0000168C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3602 00001690 66AB                    	stosw		; original sample (left channel)
  3603 00001692 66AB                    	stosw		; original sample (right channel)
  3604                                  	;xor	ax, ax
  3605                                  	; 14/11/22023
  3606 00001694 B080                    	mov	al, 80h
  3607 00001696 49                      	dec	ecx
  3608 00001697 7402                    	jz	short lff16m_2
  3609 00001699 8A06                    	mov	al, [esi]
  3610                                  lff16m_2:
  3611                                  	;mov	[next_val], al
  3612 0000169B 88C7                    	mov	bh, al
  3613                                  	;add	al, [previous_val]
  3614 0000169D 00D8                    	add	al, bl
  3615 0000169F D0D8                    	rcr	al, 1
  3616 000016A1 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  3617                                  	;add	al, [previous_val]
  3618 000016A3 00D8                    	add	al, bl
  3619 000016A5 D0D8                    	rcr	al, 1
  3620 000016A7 2C80                    	sub	al, 80h
  3621 000016A9 66C1E008                	shl	ax, 8
  3622 000016AD 66AB                    	stosw		; this is 1st interpolated sample (L)
  3623 000016AF 66AB                    	stosw		; this is 1st interpolated sample (R)
  3624                                  	;mov	al, [next_val]
  3625 000016B1 88F8                    	mov	al, bh
  3626 000016B3 00D0                    	add	al, dl
  3627 000016B5 D0D8                    	rcr	al, 1
  3628 000016B7 2C80                    	sub	al, 80h
  3629 000016B9 66C1E008                	shl	ax, 8
  3630 000016BD 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3631 000016BF 66AB                    	stosw		; this is 2nd interpolated sample (R)
  3632                                  	
  3633                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3634 000016C1 09C9                    	or	ecx, ecx
  3635 000016C3 75C2                    	jnz	short lff16m_1
  3636 000016C5 E9F9FBFFFF              	jmp	lff16m_3
  3637                                  
  3638                                  lff16m_7:
  3639                                  lff16s_7:
  3640 000016CA E915FCFFFF              	jmp	lff16m_5  ; error
  3641                                  
  3642                                  load_16khz_stereo_8_bit:
  3643                                  	; 14/11/2023
  3644                                  	; 13/11/2023
  3645 000016CF F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3646                                  					; last of the file?
  3647 000016D6 7402                    	jz	short lff16s_0		; no
  3648 000016D8 F9                      	stc
  3649 000016D9 C3                      	retn
  3650                                  
  3651                                  lff16s_0:
  3652                                  	; 01/12/2024
  3653                                  	; edi = audio buffer address
  3654                                  	; 13/12/2024
  3655 000016DA 893D[B07A0000]          	mov	[audio_buffer], edi
  3656 000016E0 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3657                                          ;mov	edx, [loadsize]
  3658                                  
  3659                                  	; esi = buffer address
  3660                                  	;; edx = buffer size
  3661                                  
  3662                                  	; load file into memory
  3663                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000016E5 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000016EB 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000016ED 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000016F3 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 000016F8 CD40                <1>  int 40h
  3664 000016FA 72CE                    	jc	short lff16s_7 ; error !
  3665                                  
  3666                                  	; 01/12/2024
  3667 000016FC A3[80850000]            	mov	[count], eax
  3668                                  
  3669                                  	;mov	edi, audio_buffer
  3670                                  	; 29/05/2024
  3671                                  	;mov	edi, [audio_buffer]
  3672                                  	
  3673 00001701 D1E8                    	shr	eax, 1
  3674 00001703 7505                    	jnz	short lff16s_8
  3675 00001705 E9D1FBFFFF              	jmp	lff16_eof
  3676                                  
  3677                                  lff16s_8:
  3678 0000170A 89C1                    	mov	ecx, eax	; word count
  3679                                  lff16s_1:
  3680 0000170C AC                      	lodsb
  3681 0000170D A2[D2280000]            	mov	[previous_val_l], al
  3682 00001712 2C80                    	sub	al, 80h
  3683 00001714 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3684 00001718 66AB                    	stosw		; original sample (L)
  3685 0000171A AC                      	lodsb
  3686 0000171B A2[D4280000]            	mov	[previous_val_r], al
  3687 00001720 2C80                    	sub	al, 80h
  3688 00001722 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3689 00001726 66AB                    	stosw		; original sample (R)
  3690                                  
  3691                                  	;xor	eax, eax
  3692 00001728 66B88080                	mov	ax, 8080h
  3693 0000172C 49                      	dec	ecx
  3694 0000172D 7403                    	jz	short lff16s_2
  3695                                  		; convert 8 bit sample to 16 bit sample
  3696 0000172F 668B06                  	mov	ax, [esi]
  3697                                  lff16s_2:
  3698                                  	;mov	[next_val_l], al
  3699                                  	;mov	[next_val_r], ah
  3700 00001732 89C3                    	mov	ebx, eax
  3701 00001734 0205[D2280000]          	add	al, [previous_val_l]
  3702 0000173A D0D8                    	rcr	al, 1
  3703 0000173C 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  3704 0000173E 0205[D2280000]          	add	al, [previous_val_l]
  3705 00001744 D0D8                    	rcr	al, 1
  3706 00001746 2C80                    	sub	al, 80h
  3707 00001748 66C1E008                	shl	ax, 8
  3708 0000174C 66AB                    	stosw		; this is 1st interpolated sample (L)
  3709 0000174E 88F8                    	mov	al, bh	; [next_val_r]
  3710 00001750 0205[D4280000]          	add	al, [previous_val_r]
  3711 00001756 D0D8                    	rcr	al, 1
  3712 00001758 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  3713 0000175A 0205[D4280000]          	add	al, [previous_val_r]
  3714 00001760 D0D8                    	rcr	al, 1
  3715 00001762 2C80                    	sub	al, 80h
  3716 00001764 66C1E008                	shl	ax, 8
  3717 00001768 66AB                    	stosw		; this is 1st interpolated sample (R)
  3718 0000176A 88D0                    	mov	al, dl
  3719 0000176C 00D8                    	add	al, bl	; [next_val_l]
  3720 0000176E D0D8                    	rcr	al, 1
  3721 00001770 2C80                    	sub	al, 80h
  3722 00001772 66C1E008                	shl	ax, 8
  3723 00001776 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3724 00001778 88F0                    	mov	al, dh
  3725 0000177A 00F8                    	add	al, bh	; [next_val_r]
  3726 0000177C D0D8                    	rcr	al, 1
  3727 0000177E 2C80                    	sub	al, 80h
  3728 00001780 66C1E008                	shl	ax, 8
  3729 00001784 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  3730                                  	
  3731                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3732 00001786 09C9                    	or	ecx, ecx
  3733 00001788 7582                    	jnz	short lff16s_1
  3734 0000178A E934FBFFFF              	jmp	lff16s_3
  3735                                  
  3736                                  load_16khz_mono_16_bit:
  3737                                  	; 15/11/2023
  3738                                  	; 13/11/2023
  3739 0000178F F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3740                                  					; last of the file?
  3741 00001796 7402                    	jz	short lff16m2_0		; no
  3742 00001798 F9                      	stc
  3743 00001799 C3                      	retn
  3744                                  
  3745                                  lff16m2_0:
  3746                                  	; 01/12/2024
  3747                                  	; edi = audio buffer address
  3748                                  	; 13/12/2024
  3749 0000179A 893D[B07A0000]          	mov	[audio_buffer], edi
  3750 000017A0 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3751                                          ;mov	edx, [loadsize]
  3752                                  
  3753                                  	; esi = buffer address
  3754                                  	;; edx = buffer size
  3755                                  
  3756                                  	; load file into memory
  3757                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000017A5 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000017AB 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000017AD 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000017B3 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 000017B8 CD40                <1>  int 40h
  3758 000017BA 7255                    	jc	short lff16m2_7 ; error !
  3759                                  
  3760                                  	; 01/12/2024
  3761 000017BC A3[80850000]            	mov	[count], eax
  3762                                  
  3763                                  	;mov	edi, audio_buffer
  3764                                  	; 29/05/2024
  3765                                  	;mov	edi, [audio_buffer]
  3766                                  	
  3767 000017C1 D1E8                    	shr	eax, 1
  3768 000017C3 7505                    	jnz	short lff16m2_8
  3769 000017C5 E911FBFFFF              	jmp	lff16_eof
  3770                                  
  3771                                  lff16m2_8:
  3772 000017CA 89C1                    	mov	ecx, eax  ; word count
  3773                                  lff16m2_1:
  3774 000017CC 66AD                    	lodsw
  3775 000017CE 66AB                    	stosw		; original sample (left channel)
  3776 000017D0 66AB                    	stosw		; original sample (right channel)
  3777 000017D2 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3778                                  	;mov	[previous_val], ax
  3779 000017D5 89C3                    	mov	ebx, eax
  3780 000017D7 31C0                    	xor	eax, eax
  3781 000017D9 49                      	dec	ecx
  3782 000017DA 7403                    	jz	short lff16m2_2
  3783 000017DC 668B06                  	mov	ax, [esi]
  3784                                  lff16m2_2:
  3785 000017DF 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3786 000017E2 89C5                    	mov	ebp, eax	; [next_val]
  3787                                  	;add	ax, [previous_val]
  3788 000017E4 6601D8                  	add	ax, bx
  3789 000017E7 66D1D8                  	rcr	ax, 1
  3790 000017EA 89C2                    	mov	edx, eax ; this is temporary interpolation value
  3791                                  	;add	ax, [previous_val]
  3792 000017EC 6601D8                  	add	ax, bx
  3793 000017EF 66D1D8                  	rcr	ax, 1
  3794 000017F2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3795 000017F5 66AB                    	stosw		; this is 1st interpolated sample (L)
  3796 000017F7 66AB                    	stosw		; this is 1st interpolated sample (R)
  3797 000017F9 89E8                    	mov	eax, ebp
  3798 000017FB 6601D0                  	add	ax, dx
  3799 000017FE 66D1D8                  	rcr	ax, 1
  3800 00001801 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3801 00001804 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3802 00001806 66AB                    	stosw		; this is 2nd interpolated sample (R)
  3803                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3804 00001808 09C9                    	or	ecx, ecx
  3805 0000180A 75C0                    	jnz	short lff16m2_1
  3806 0000180C E9B2FAFFFF              	jmp	lff16m2_3
  3807                                  
  3808                                  lff16m2_7:
  3809                                  lff16s2_7:
  3810 00001811 E9CEFAFFFF              	jmp	lff16m2_5  ; error
  3811                                  
  3812                                  load_16khz_stereo_16_bit:
  3813                                  	; 16/11/2023
  3814                                  	; 15/11/2023
  3815                                  	; 13/11/2023
  3816 00001816 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3817                                  					; last of the file?
  3818 0000181D 7402                    	jz	short lff16s2_0		; no
  3819 0000181F F9                      	stc
  3820 00001820 C3                      	retn
  3821                                  
  3822                                  lff16s2_0:
  3823                                  	; 01/12/2024
  3824                                  	; edi = audio buffer address
  3825                                  	; 13/12/2024
  3826 00001821 893D[B07A0000]          	mov	[audio_buffer], edi
  3827 00001827 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3828                                          ;mov	edx, [loadsize]
  3829                                  
  3830                                  	; esi = buffer address
  3831                                  	;; edx = buffer size
  3832                                  
  3833                                  	; load file into memory
  3834                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000182C 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001832 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001834 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000183A B803000000          <1>  mov eax, %1
   103                              <1> 
   104 0000183F CD40                <1>  int 40h
  3835 00001841 72CE                    	jc	short lff16s2_7 ; error !
  3836                                  
  3837                                  	; 01/12/2024
  3838 00001843 A3[80850000]            	mov	[count], eax
  3839                                  
  3840                                  	;mov	edi, audio_buffer
  3841                                  	; 29/05/2024
  3842                                  	;mov	edi, [audio_buffer]
  3843                                  	
  3844 00001848 C1E802                  	shr	eax, 2
  3845 0000184B 7505                    	jnz	short lff16s2_8
  3846 0000184D E989FAFFFF              	jmp	lff16_eof
  3847                                  
  3848                                  lff16s2_8:
  3849 00001852 89C1                    	mov	ecx, eax  ; dword count
  3850                                  lff16s2_1:
  3851 00001854 66AD                    	lodsw
  3852 00001856 66AB                    	stosw		; original sample (L)
  3853 00001858 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3854 0000185B 66A3[D2280000]          	mov	[previous_val_l], ax
  3855 00001861 66AD                    	lodsw
  3856 00001863 66AB                    	stosw		; original sample (R)
  3857 00001865 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3858 00001868 66A3[D4280000]          	mov	[previous_val_r], ax
  3859 0000186E 31D2                    	xor	edx, edx
  3860 00001870 31C0                    	xor	eax, eax
  3861                                  	; 16/11/2023
  3862 00001872 49                      	dec	ecx
  3863 00001873 7407                    	jz	short lff16s2_2
  3864 00001875 668B06                  	mov	ax, [esi]
  3865 00001878 668B5602                	mov	dx, [esi+2]
  3866                                  lff16s2_2:
  3867 0000187C 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3868                                  	;mov	[next_val_l], ax
  3869 0000187F 89C5                    	mov	ebp, eax
  3870 00001881 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3871 00001884 668915[D8280000]        	mov	[next_val_r], dx
  3872 0000188B 660305[D2280000]        	add	ax, [previous_val_l]
  3873 00001892 66D1D8                  	rcr	ax, 1
  3874 00001895 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  3875 00001897 660305[D2280000]        	add	ax, [previous_val_l]
  3876 0000189E 66D1D8                  	rcr	ax, 1
  3877 000018A1 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3878 000018A4 66AB                    	stosw		; this is 1st interpolated sample (L)
  3879 000018A6 66A1[D8280000]          	mov	ax, [next_val_r]
  3880 000018AC 660305[D4280000]        	add	ax, [previous_val_r]
  3881 000018B3 66D1D8                  	rcr	ax, 1
  3882 000018B6 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  3883 000018B8 660305[D4280000]        	add	ax, [previous_val_r]
  3884 000018BF 66D1D8                  	rcr	ax, 1
  3885 000018C2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3886 000018C5 66AB                    	stosw		; this is 1st interpolated sample (R)
  3887                                  	;mov	ax, [next_val_l]
  3888 000018C7 89E8                    	mov	eax, ebp
  3889 000018C9 6601D0                  	add	ax, dx
  3890 000018CC 66D1D8                  	rcr	ax, 1
  3891 000018CF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3892 000018D2 66AB                    	stosw		; this is 2nd interpolated sample (L)
  3893 000018D4 66A1[D8280000]          	mov	ax, [next_val_r]
  3894 000018DA 6601D8                  	add	ax, bx
  3895 000018DD 66D1D8                  	rcr	ax, 1
  3896 000018E0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3897 000018E3 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  3898                                  	
  3899                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3900 000018E5 09C9                    	or	ecx, ecx
  3901 000018E7 0F8567FFFFFF            	jnz	lff16s2_1
  3902 000018ED E9D1F9FFFF              	jmp	lff16s2_3
  3903                                  
  3904                                  ; .....................
  3905                                  
  3906                                  load_24khz_mono_8_bit:
  3907                                  	; 15/11/2023
  3908 000018F2 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3909                                  					; last of the file?
  3910 000018F9 7402                    	jz	short lff24m_0		; no
  3911 000018FB F9                      	stc
  3912 000018FC C3                      	retn
  3913                                  
  3914                                  lff24m_0:
  3915                                  	; 01/12/2024
  3916                                  	; edi = audio buffer address
  3917                                  	; 13/12/2024
  3918 000018FD 893D[B07A0000]          	mov	[audio_buffer], edi
  3919 00001903 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3920                                          ;mov	edx, [loadsize]
  3921                                  
  3922                                  	; esi = buffer address
  3923                                  	;; edx = buffer size
  3924                                  
  3925                                  	; load file into memory
  3926                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001908 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 0000190E 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001910 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001916 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 0000191B CD40                <1>  int 40h
  3927 0000191D 723B                    	jc	short lff24m_7 ; error !
  3928                                  
  3929                                  	; 01/12/2024
  3930 0000191F A3[80850000]            	mov	[count], eax
  3931                                  
  3932                                  	;mov	edi, audio_buffer
  3933                                  	; 29/05/2024
  3934                                  	;mov	edi, [audio_buffer]
  3935                                  	
  3936 00001924 21C0                    	and	eax, eax
  3937 00001926 7505                    	jnz	short lff24m_8
  3938 00001928 E9AEF9FFFF              	jmp	lff24_eof
  3939                                  
  3940                                  lff24m_8:
  3941 0000192D 89C1                    	mov	ecx, eax	; byte count
  3942                                  lff24m_1:
  3943 0000192F AC                      	lodsb
  3944                                  	;mov	[previous_val], al
  3945 00001930 88C3                    	mov	bl, al
  3946 00001932 2C80                    	sub	al, 80h
  3947 00001934 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3948 00001938 66AB                    	stosw		; original sample (left channel)
  3949 0000193A 66AB                    	stosw		; original sample (right channel)
  3950                                  	;xor	eax, eax
  3951 0000193C B080                    	mov	al, 80h
  3952 0000193E 49                      	dec	ecx
  3953 0000193F 7402                    	jz	short lff24m_2
  3954 00001941 8A06                    	mov	al, [esi]
  3955                                  lff24m_2:
  3956                                  	;;mov	[next_val], al
  3957                                  	;mov	bh, al
  3958                                  	;add	al, [previous_val]
  3959 00001943 00D8                    	add	al, bl
  3960 00001945 D0D8                    	rcr	al, 1
  3961 00001947 2C80                    	sub	al, 80h
  3962 00001949 66C1E008                	shl	ax, 8
  3963 0000194D 66AB                    	stosw		; this is interpolated sample (L)
  3964 0000194F 66AB                    	stosw		; this is interpolated sample (R)
  3965                                  	
  3966                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3967 00001951 09C9                    	or	ecx, ecx
  3968 00001953 75DA                    	jnz	short lff24m_1
  3969 00001955 E969F9FFFF              	jmp	lff24_3
  3970                                  
  3971                                  lff24m_7:
  3972                                  lff24s_7:
  3973 0000195A E985F9FFFF              	jmp	lff24_5  ; error
  3974                                  
  3975                                  load_24khz_stereo_8_bit:
  3976                                  	; 15/11/2023
  3977 0000195F F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3978                                  					; last of the file?
  3979 00001966 7402                    	jz	short lff24s_0		; no
  3980 00001968 F9                      	stc
  3981 00001969 C3                      	retn
  3982                                  
  3983                                  lff24s_0:
  3984                                  	; 01/12/2024
  3985                                  	; edi = audio buffer address
  3986                                  	; 13/12/2024
  3987 0000196A 893D[B07A0000]          	mov	[audio_buffer], edi
  3988 00001970 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3989                                          ;mov	edx, [loadsize]
  3990                                  
  3991                                  	; esi = buffer address
  3992                                  	;; edx = buffer size
  3993                                  
  3994                                  	; load file into memory
  3995                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001975 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 0000197B 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 0000197D 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001983 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001988 CD40                <1>  int 40h
  3996 0000198A 72CE                    	jc	short lff24s_7 ; error !
  3997                                  
  3998                                  	; 01/12/2024
  3999 0000198C A3[80850000]            	mov	[count], eax
  4000                                  
  4001                                  	;mov	edi, audio_buffer
  4002                                  	; 29/05/2024
  4003                                  	;mov	edi, [audio_buffer]
  4004                                  	
  4005 00001991 D1E8                    	shr	eax, 1
  4006 00001993 7505                    	jnz	short lff24s_8
  4007 00001995 E941F9FFFF              	jmp	lff24_eof
  4008                                  
  4009                                  lff24s_8:
  4010 0000199A 89C1                    	mov	ecx, eax  ; word count
  4011                                  lff24s_1:
  4012 0000199C AC                      	lodsb
  4013 0000199D A2[D2280000]            	mov	[previous_val_l], al
  4014 000019A2 2C80                    	sub	al, 80h
  4015 000019A4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4016 000019A8 66AB                    	stosw		; original sample (L)
  4017 000019AA AC                      	lodsb
  4018 000019AB A2[D4280000]            	mov	[previous_val_r], al
  4019 000019B0 2C80                    	sub	al, 80h
  4020 000019B2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4021 000019B6 66AB                    	stosw		; original sample (R)
  4022                                  
  4023                                  	;xor	eax, eax
  4024 000019B8 66B88080                	mov	ax, 8080h
  4025 000019BC 49                      	dec	ecx
  4026 000019BD 7403                    	jz	short lff24s_2
  4027                                  		; convert 8 bit sample to 16 bit sample
  4028 000019BF 668B06                  	mov	ax, [esi]
  4029                                  lff24s_2:
  4030                                  	;;mov	[next_val_l], al
  4031                                  	;;mov	[next_val_r], ah
  4032                                  	;mov	bx, ax
  4033 000019C2 88E7                    	mov	bh, ah
  4034 000019C4 0205[D2280000]          	add	al, [previous_val_l]
  4035 000019CA D0D8                    	rcr	al, 1
  4036                                  	;mov	dl, al
  4037 000019CC 2C80                    	sub	al, 80h
  4038 000019CE 66C1E008                	shl	ax, 8
  4039 000019D2 66AB                    	stosw		; this is interpolated sample (L)
  4040 000019D4 88F8                    	mov	al, bh	; [next_val_r]
  4041 000019D6 0205[D4280000]          	add	al, [previous_val_r]
  4042 000019DC D0D8                    	rcr	al, 1
  4043                                  	;mov	dh, al
  4044 000019DE 2C80                    	sub	al, 80h
  4045 000019E0 66C1E008                	shl	ax, 8
  4046 000019E4 66AB                    	stosw		; this is interpolated sample (R)
  4047                                  		
  4048                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  4049 000019E6 09C9                    	or	ecx, ecx
  4050 000019E8 75B2                    	jnz	short lff24s_1
  4051 000019EA E9D4F8FFFF              	jmp	lff24_3
  4052                                  
  4053                                  load_24khz_mono_16_bit:
  4054                                  	; 15/11/2023
  4055 000019EF F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4056                                  					; last of the file?
  4057 000019F6 7402                    	jz	short lff24m2_0		; no
  4058 000019F8 F9                      	stc
  4059 000019F9 C3                      	retn
  4060                                  
  4061                                  lff24m2_0:
  4062                                  	; 01/12/2024
  4063                                  	; edi = audio buffer address
  4064                                  	; 13/12/2024
  4065 000019FA 893D[B07A0000]          	mov	[audio_buffer], edi
  4066 00001A00 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4067                                          ;mov	edx, [loadsize]
  4068                                  
  4069                                  	; esi = buffer address
  4070                                  	;; edx = buffer size
  4071                                  
  4072                                  	; load file into memory
  4073                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001A05 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001A0B 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001A0D 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001A13 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001A18 CD40                <1>  int 40h
  4074 00001A1A 7237                    	jc	short lff24m2_7 ; error !
  4075                                  
  4076                                  	; 01/12/2024
  4077 00001A1C A3[80850000]            	mov	[count], eax
  4078                                  
  4079                                  	;mov	edi, audio_buffer
  4080                                  	; 29/05/2024
  4081                                  	;mov	edi, [audio_buffer]
  4082                                  	
  4083 00001A21 D1E8                    	shr	eax, 1
  4084 00001A23 7505                    	jnz	short lff24m2_8
  4085 00001A25 E9B1F8FFFF              	jmp	lff24_eof
  4086                                  
  4087                                  lff24m2_8:
  4088 00001A2A 89C1                    	mov	ecx, eax  ; word count
  4089                                  lff24m2_1:
  4090 00001A2C 66AD                    	lodsw
  4091 00001A2E 66AB                    	stosw		; original sample (left channel)
  4092 00001A30 66AB                    	stosw		; original sample (right channel)
  4093 00001A32 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4094                                  	;mov	[previous_val], ax
  4095                                  	;mov	ebx, eax
  4096                                  	;xor	eax, eax
  4097 00001A35 31DB                    	xor	ebx, ebx
  4098 00001A37 49                      	dec	ecx
  4099 00001A38 7403                    	jz	short lff24m2_2
  4100                                  	;mov	ax, [esi]
  4101 00001A3A 668B1E                  	mov	bx, [esi]
  4102                                  lff24m2_2:
  4103                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  4104                                  	;mov	ebp, eax	; [next_val]
  4105                                  	;add	ax, [previous_val]
  4106                                  	; ax = [previous_val]
  4107                                  	; bx = [next_val]
  4108 00001A3D 6601D8                  	add	ax, bx
  4109 00001A40 66D1D8                  	rcr	ax, 1
  4110 00001A43 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4111 00001A46 66AB                    	stosw		; this is interpolated sample (L)
  4112 00001A48 66AB                    	stosw		; this is interpolated sample (R)
  4113                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  4114 00001A4A 09C9                    	or	ecx, ecx
  4115 00001A4C 75DE                    	jnz	short lff24m2_1
  4116 00001A4E E970F8FFFF              	jmp	lff24_3
  4117                                  
  4118                                  lff24m2_7:
  4119                                  lff24s2_7:
  4120 00001A53 E98CF8FFFF              	jmp	lff24_5  ; error
  4121                                  
  4122                                  load_24khz_stereo_16_bit:
  4123                                  	; 16/11/2023
  4124                                  	; 15/11/2023
  4125 00001A58 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4126                                  					; last of the file?
  4127 00001A5F 7402                    	jz	short lff24s2_0		; no
  4128 00001A61 F9                      	stc
  4129 00001A62 C3                      	retn
  4130                                  
  4131                                  lff24s2_0:
  4132                                  	; 01/12/2024
  4133                                  	; edi = audio buffer address
  4134                                  	; 13/12/2024
  4135 00001A63 893D[B07A0000]          	mov	[audio_buffer], edi
  4136 00001A69 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4137                                          ;mov	edx, [loadsize]
  4138                                  
  4139                                  	; esi = buffer address
  4140                                  	;; edx = buffer size
  4141                                  
  4142                                  	; load file into memory
  4143                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001A6E 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001A74 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001A76 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001A7C B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001A81 CD40                <1>  int 40h
  4144 00001A83 72CE                    	jc	short lff24s2_7 ; error !
  4145                                  
  4146                                  	; 01/12/2024
  4147 00001A85 A3[80850000]            	mov	[count], eax
  4148                                  
  4149                                  	;mov	edi, audio_buffer
  4150                                  	; 29/05/2024
  4151                                  	;mov	edi, [audio_buffer]
  4152                                  	
  4153 00001A8A C1E802                  	shr	eax, 2
  4154 00001A8D 7505                    	jnz	short lff24s2_8
  4155 00001A8F E947F8FFFF              	jmp	lff24_eof
  4156                                  
  4157                                  lff24s2_8:
  4158 00001A94 89C1                    	mov	ecx, eax  ; dword count
  4159                                  lff24s2_1:
  4160 00001A96 66AD                    	lodsw
  4161 00001A98 66AB                    	stosw		; original sample (L)
  4162 00001A9A 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  4163 00001A9D 66A3[D2280000]          	mov	[previous_val_l], ax
  4164 00001AA3 66AD                    	lodsw
  4165 00001AA5 66AB                    	stosw		; original sample (R)
  4166 00001AA7 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  4167                                  	;mov	[previous_val_r], ax
  4168 00001AAA 89C3                    	mov	ebx, eax
  4169 00001AAC 31D2                    	xor	edx, edx
  4170 00001AAE 31C0                    	xor	eax, eax
  4171                                  	; 16/11/2023
  4172 00001AB0 49                      	dec	ecx
  4173 00001AB1 7407                    	jz	short lff24s2_2
  4174 00001AB3 668B06                  	mov	ax, [esi]
  4175 00001AB6 668B5602                	mov	dx, [esi+2]
  4176                                  lff24s2_2:
  4177 00001ABA 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  4178                                  	;;mov	[next_val_l], ax
  4179                                  	;mov	ebp, eax
  4180 00001ABD 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  4181                                  	;mov	[next_val_r], dx
  4182 00001AC0 660305[D2280000]        	add	ax, [previous_val_l]
  4183 00001AC7 66D1D8                  	rcr	ax, 1
  4184 00001ACA 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  4185 00001ACD 66AB                    	stosw		; this is interpolated sample (L)
  4186                                  	;mov	ax, [next_val_r]
  4187 00001ACF 89D0                    	mov	eax, edx
  4188                                  	;add	ax, [previous_val_r]
  4189 00001AD1 6601D8                  	add	ax, bx
  4190 00001AD4 66D1D8                  	rcr	ax, 1
  4191 00001AD7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4192 00001ADA 66AB                    	stosw		; this is interpolated sample (R)
  4193                                  	
  4194                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  4195 00001ADC 09C9                    	or	ecx, ecx
  4196 00001ADE 75B6                    	jnz	short lff24s2_1
  4197 00001AE0 E9DEF7FFFF              	jmp	lff24_3
  4198                                  
  4199                                  ; .....................
  4200                                  
  4201                                  load_32khz_mono_8_bit:
  4202                                  	; 15/11/2023
  4203 00001AE5 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4204                                  					; last of the file?
  4205 00001AEC 7402                    	jz	short lff32m_0		; no
  4206 00001AEE F9                      	stc
  4207 00001AEF C3                      	retn
  4208                                  
  4209                                  lff32m_0:
  4210                                  	; 01/12/2024
  4211                                  	; edi = audio buffer address
  4212                                  	; 13/12/2024
  4213 00001AF0 893D[B07A0000]          	mov	[audio_buffer], edi
  4214 00001AF6 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4215                                          ;mov	edx, [loadsize]
  4216                                  
  4217                                  	; esi = buffer address
  4218                                  	;; edx = buffer size
  4219                                  
  4220                                  	; load file into memory
  4221                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001AFB 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001B01 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001B03 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001B09 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001B0E CD40                <1>  int 40h
  4222 00001B10 7247                    	jc	short lff32m_7 ; error !
  4223                                  
  4224                                  	; 01/12/2024
  4225 00001B12 A3[80850000]            	mov	[count], eax
  4226                                  
  4227                                  	;mov	edi, audio_buffer
  4228                                  	; 29/05/2024
  4229                                  	;mov	edi, [audio_buffer]
  4230                                  	
  4231 00001B17 21C0                    	and	eax, eax
  4232 00001B19 7505                    	jnz	short lff32m_8
  4233 00001B1B E9BBF7FFFF              	jmp	lff32_eof
  4234                                  
  4235                                  lff32m_8:
  4236 00001B20 89C1                    	mov	ecx, eax	; byte count
  4237                                  lff32m_1:
  4238 00001B22 AC                      	lodsb
  4239                                  	;mov	[previous_val], al
  4240 00001B23 88C3                    	mov	bl, al
  4241 00001B25 2C80                    	sub	al, 80h
  4242 00001B27 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4243 00001B2B 66AB                    	stosw		; original sample (left channel)
  4244 00001B2D 66AB                    	stosw		; original sample (right channel)
  4245                                  	;xor	eax, eax
  4246 00001B2F B080                    	mov	al, 80h
  4247 00001B31 49                      	dec	ecx
  4248 00001B32 7402                    	jz	short lff32m_2
  4249 00001B34 8A06                    	mov	al, [esi]
  4250                                  lff32m_2:
  4251                                  	;;mov	[next_val], al
  4252                                  	;mov	bh, al
  4253                                  	;add	al, [previous_val]
  4254 00001B36 00D8                    	add	al, bl
  4255 00001B38 D0D8                    	rcr	al, 1
  4256 00001B3A 2C80                    	sub	al, 80h
  4257 00001B3C 66C1E008                	shl	ax, 8
  4258 00001B40 66AB                    	stosw		; this is interpolated sample (L)
  4259 00001B42 66AB                    	stosw		; this is interpolated sample (R)
  4260                                  	
  4261                                  	; different than 8-16-24 kHZ !
  4262                                  	; 'original-interpolated-original' trio samples
  4263 00001B44 E30E                    	jecxz	lff32m_3
  4264                                  
  4265 00001B46 AC                      	lodsb
  4266 00001B47 2C80                    	sub	al, 80h
  4267 00001B49 66C1E008                	shl	ax, 8
  4268 00001B4D 66AB                    	stosw		; original sample (left channel)
  4269 00001B4F 66AB                    	stosw		; original sample (right channel)
  4270                                  
  4271                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  4272 00001B51 49                      	dec	ecx
  4273 00001B52 75CE                    	jnz	short lff32m_1
  4274                                  lff32m_3:
  4275 00001B54 E96AF7FFFF              	jmp	lff32_3
  4276                                  
  4277                                  lff32m_7:
  4278                                  lff32s_7:
  4279 00001B59 E986F7FFFF              	jmp	lff32_5  ; error
  4280                                  
  4281                                  load_32khz_stereo_8_bit:
  4282                                  	; 15/11/2023
  4283 00001B5E F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4284                                  					; last of the file?
  4285 00001B65 7402                    	jz	short lff32s_0		; no
  4286 00001B67 F9                      	stc
  4287 00001B68 C3                      	retn
  4288                                  
  4289                                  lff32s_0:
  4290                                  	; 01/12/2024
  4291                                  	; edi = audio buffer address
  4292                                  	; 13/12/2024
  4293 00001B69 893D[B07A0000]          	mov	[audio_buffer], edi
  4294 00001B6F BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4295                                          ;mov	edx, [loadsize]
  4296                                  
  4297                                  	; esi = buffer address
  4298                                  	;; edx = buffer size
  4299                                  
  4300                                  	; load file into memory
  4301                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001B74 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001B7A 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001B7C 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001B82 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001B87 CD40                <1>  int 40h
  4302 00001B89 72CE                    	jc	short lff32s_7 ; error !
  4303                                  
  4304                                  	; 01/12/2024
  4305 00001B8B A3[80850000]            	mov	[count], eax
  4306                                  
  4307                                  	;mov	edi, audio_buffer
  4308                                  	; 29/05/2024
  4309                                  	;mov	edi, [audio_buffer]
  4310                                  	
  4311 00001B90 D1E8                    	shr	eax, 1
  4312 00001B92 7505                    	jnz	short lff32s_8
  4313 00001B94 E942F7FFFF              	jmp	lff32_eof
  4314                                  
  4315                                  lff32s_8:
  4316 00001B99 89C1                    	mov	ecx, eax  ; word count
  4317                                  lff32s_1:
  4318 00001B9B AC                      	lodsb
  4319 00001B9C A2[D2280000]            	mov	[previous_val_l], al
  4320 00001BA1 2C80                    	sub	al, 80h
  4321 00001BA3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4322 00001BA7 66AB                    	stosw		; original sample (L)
  4323 00001BA9 AC                      	lodsb
  4324 00001BAA A2[D4280000]            	mov	[previous_val_r], al
  4325 00001BAF 2C80                    	sub	al, 80h
  4326 00001BB1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4327 00001BB5 66AB                    	stosw		; original sample (R)
  4328                                  
  4329                                  	;xor	eax, eax
  4330 00001BB7 66B88080                	mov	ax, 8080h
  4331 00001BBB 49                      	dec	ecx
  4332 00001BBC 7403                    	jz	short lff32s_2
  4333                                  		; convert 8 bit sample to 16 bit sample
  4334 00001BBE 668B06                  	mov	ax, [esi]
  4335                                  lff32s_2:
  4336                                  	;;mov	[next_val_l], al
  4337                                  	;;mov	[next_val_r], ah
  4338                                  	;mov	bx, ax
  4339 00001BC1 88E7                    	mov	bh, ah
  4340 00001BC3 0205[D2280000]          	add	al, [previous_val_l]
  4341 00001BC9 D0D8                    	rcr	al, 1
  4342                                  	;mov	dl, al
  4343 00001BCB 2C80                    	sub	al, 80h
  4344 00001BCD 66C1E008                	shl	ax, 8
  4345 00001BD1 66AB                    	stosw		; this is interpolated sample (L)
  4346 00001BD3 88F8                    	mov	al, bh	; [next_val_r]
  4347 00001BD5 0205[D4280000]          	add	al, [previous_val_r]
  4348 00001BDB D0D8                    	rcr	al, 1
  4349                                  	;mov	dh, al
  4350 00001BDD 2C80                    	sub	al, 80h
  4351 00001BDF 66C1E008                	shl	ax, 8
  4352 00001BE3 66AB                    	stosw		; this is interpolated sample (R)
  4353                                  
  4354                                  	; different than 8-16-24 kHZ !
  4355                                  	; 'original-interpolated-original' trio samples
  4356 00001BE5 E315                    	jecxz	lff32s_3
  4357                                  
  4358 00001BE7 AC                      	lodsb
  4359 00001BE8 2C80                    	sub	al, 80h
  4360 00001BEA 66C1E008                	shl	ax, 8
  4361 00001BEE 66AB                    	stosw		; original sample (left channel)
  4362                                  
  4363 00001BF0 AC                      	lodsb
  4364 00001BF1 2C80                    	sub	al, 80h
  4365 00001BF3 66C1E008                	shl	ax, 8
  4366 00001BF7 66AB                    	stosw		; original sample (right channel)
  4367                                  		
  4368                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  4369 00001BF9 49                      	dec	ecx
  4370 00001BFA 759F                    	jnz	short lff32s_1
  4371                                  lff32s_3:
  4372 00001BFC E9C2F6FFFF              	jmp	lff32_3
  4373                                  
  4374                                  load_32khz_mono_16_bit:
  4375                                  	; 15/11/2023
  4376 00001C01 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4377                                  					; last of the file?
  4378 00001C08 7402                    	jz	short lff32m2_0		; no
  4379 00001C0A F9                      	stc
  4380 00001C0B C3                      	retn
  4381                                  
  4382                                  lff32m2_0:
  4383                                  	; 01/12/2024
  4384                                  	; edi = audio buffer address
  4385                                  	; 13/12/2024
  4386 00001C0C 893D[B07A0000]          	mov	[audio_buffer], edi
  4387 00001C12 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4388                                          ;mov	edx, [loadsize]
  4389                                  
  4390                                  	; esi = buffer address
  4391                                  	;; edx = buffer size
  4392                                  
  4393                                  	; load file into memory
  4394                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001C17 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001C1D 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001C1F 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001C25 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001C2A CD40                <1>  int 40h
  4395 00001C2C 723E                    	jc	short lff32m2_7 ; error !
  4396                                  
  4397                                  	; 01/12/2024
  4398 00001C2E A3[80850000]            	mov	[count], eax
  4399                                  
  4400                                  	;mov	edi, audio_buffer
  4401                                  	; 29/05/2024
  4402                                  	;mov	edi, [audio_buffer]
  4403                                  	
  4404 00001C33 D1E8                    	shr	eax, 1
  4405 00001C35 7505                    	jnz	short lff32m2_8
  4406 00001C37 E99FF6FFFF              	jmp	lff32_eof
  4407                                  
  4408                                  lff32m2_8:
  4409 00001C3C 89C1                    	mov	ecx, eax  ; word count
  4410                                  lff32m2_1:
  4411 00001C3E 66AD                    	lodsw
  4412 00001C40 66AB                    	stosw		; original sample (left channel)
  4413 00001C42 66AB                    	stosw		; original sample (right channel)
  4414 00001C44 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4415                                  	;mov	[previous_val], ax
  4416                                  	;mov	ebx, eax
  4417                                  	;xor	eax, eax
  4418 00001C47 31DB                    	xor	ebx, ebx
  4419 00001C49 49                      	dec	ecx
  4420 00001C4A 7403                    	jz	short lff32m2_2
  4421                                  	;mov	ax, [esi]
  4422 00001C4C 668B1E                  	mov	bx, [esi]
  4423                                  lff32m2_2:
  4424                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  4425                                  	;mov	ebp, eax	; [next_val]
  4426                                  	;add	ax, [previous_val]
  4427                                  	; ax = [previous_val]
  4428                                  	; bx = [next_val]
  4429 00001C4F 6601D8                  	add	ax, bx
  4430 00001C52 66D1D8                  	rcr	ax, 1
  4431 00001C55 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4432 00001C58 66AB                    	stosw		; this is interpolated sample (L)
  4433 00001C5A 66AB                    	stosw		; this is interpolated sample (R)
  4434                                  
  4435                                  	; different than 8-16-24 kHZ !
  4436                                  	; 'original-interpolated-original' trio samples 
  4437 00001C5C E309                    	jecxz	lff32m2_3
  4438                                  
  4439 00001C5E 66AD                    	lodsw
  4440 00001C60 66AB                    	stosw		; original sample (left channel)
  4441 00001C62 66AB                    	stosw		; original sample (right channel)
  4442                                  
  4443                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  4444 00001C64 49                      	dec	ecx
  4445 00001C65 75D7                    	jnz	short lff32m2_1
  4446                                  lff32m2_3:
  4447 00001C67 E957F6FFFF              	jmp	lff32_3
  4448                                  
  4449                                  lff32m2_7:
  4450                                  lff32s2_7:
  4451 00001C6C E973F6FFFF              	jmp	lff32_5  ; error
  4452                                  
  4453                                  load_32khz_stereo_16_bit:
  4454                                  	; 16/11/2023
  4455                                  	; 15/11/2023
  4456 00001C71 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4457                                  					; last of the file?
  4458 00001C78 7402                    	jz	short lff32s2_0		; no
  4459 00001C7A F9                      	stc
  4460 00001C7B C3                      	retn
  4461                                  
  4462                                  lff32s2_0:
  4463                                  	; 01/12/2024
  4464                                  	; edi = audio buffer address
  4465                                  	; 13/12/2024
  4466 00001C7C 893D[B07A0000]          	mov	[audio_buffer], edi
  4467 00001C82 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4468                                          ;mov	edx, [loadsize]
  4469                                  
  4470                                  	; esi = buffer address
  4471                                  	;; edx = buffer size
  4472                                  
  4473                                  	; load file into memory
  4474                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001C87 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001C8D 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001C8F 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001C95 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001C9A CD40                <1>  int 40h
  4475 00001C9C 72CE                    	jc	short lff32s2_7 ; error !
  4476                                  
  4477                                  	; 01/12/2024
  4478 00001C9E A3[80850000]            	mov	[count], eax
  4479                                  
  4480                                  	;mov	edi, audio_buffer
  4481                                  	; 29/05/2024
  4482                                  	;mov	edi, [audio_buffer]
  4483                                  	
  4484 00001CA3 C1E802                  	shr	eax, 2
  4485 00001CA6 7505                    	jnz	short lff32s2_8
  4486 00001CA8 E92EF6FFFF              	jmp	lff32_eof
  4487                                  
  4488                                  lff32s2_8:
  4489 00001CAD 89C1                    	mov	ecx, eax ; dword count
  4490                                  lff32s2_1:
  4491 00001CAF 66AD                    	lodsw
  4492 00001CB1 66AB                    	stosw		; original sample (L)
  4493 00001CB3 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  4494 00001CB6 66A3[D2280000]          	mov	[previous_val_l], ax
  4495 00001CBC 66AD                    	lodsw
  4496 00001CBE 66AB                    	stosw		; original sample (R)
  4497 00001CC0 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  4498                                  	;mov	[previous_val_r], ax
  4499 00001CC3 89C3                    	mov	ebx, eax
  4500 00001CC5 31D2                    	xor	edx, edx
  4501 00001CC7 31C0                    	xor	eax, eax
  4502                                  	; 16/11/2023
  4503 00001CC9 49                      	dec	ecx
  4504 00001CCA 7407                    	jz	short lff32s2_2
  4505 00001CCC 668B06                  	mov	ax, [esi]
  4506 00001CCF 668B5602                	mov	dx, [esi+2]
  4507                                  lff32s2_2:
  4508 00001CD3 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  4509                                  	;;mov	[next_val_l], ax
  4510                                  	;mov	ebp, eax
  4511 00001CD6 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  4512                                  	;mov	[next_val_r], dx
  4513 00001CD9 660305[D2280000]        	add	ax, [previous_val_l]
  4514 00001CE0 66D1D8                  	rcr	ax, 1
  4515 00001CE3 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  4516 00001CE6 66AB                    	stosw		; this is interpolated sample (L)
  4517                                  	;mov	ax, [next_val_r]
  4518 00001CE8 89D0                    	mov	eax, edx
  4519                                  	;add	ax, [previous_val_r]
  4520 00001CEA 6601D8                  	add	ax, bx
  4521 00001CED 66D1D8                  	rcr	ax, 1
  4522 00001CF0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4523 00001CF3 66AB                    	stosw		; this is interpolated sample (R)
  4524                                  
  4525                                  	; different than 8-16-24 kHZ !
  4526                                  	; 'original-interpolated-original' trio samples
  4527 00001CF5 E30B                    	jecxz	lff32s2_3
  4528                                  
  4529 00001CF7 66AD                    	lodsw
  4530 00001CF9 66AB                    	stosw	; original sample (L)
  4531 00001CFB 66AD                    	lodsw
  4532 00001CFD 66AB                    	stosw	; original sample (R)
  4533                                  	
  4534                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  4535 00001CFF 49                      	dec	ecx
  4536 00001D00 75AD                    	jnz	short lff32s2_1
  4537                                  lff32s2_3:
  4538 00001D02 E9BCF5FFFF              	jmp	lff32_3
  4539                                  
  4540                                  ; .....................
  4541                                  
  4542                                  load_22khz_mono_8_bit:
  4543                                  	; 16/11/2023
  4544 00001D07 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4545                                  					; last of the file?
  4546 00001D0E 7402                    	jz	short lff22m_0		; no
  4547 00001D10 F9                      	stc
  4548 00001D11 C3                      	retn
  4549                                  
  4550                                  lff22m_0:
  4551                                  	; 01/12/2024
  4552                                  	; edi = audio buffer address
  4553                                  	; 13/12/2024
  4554 00001D12 893D[B07A0000]          	mov	[audio_buffer], edi
  4555 00001D18 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4556                                          ;mov	edx, [loadsize]
  4557                                  
  4558                                  	; esi = buffer address
  4559                                  	;; edx = buffer size
  4560                                  
  4561                                  	; load file into memory
  4562                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001D1D 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001D23 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001D25 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001D2B B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001D30 CD40                <1>  int 40h
  4563 00001D32 725D                    	jc	short lff22m_7 ; error !
  4564                                  
  4565                                  	; 01/12/2024
  4566 00001D34 A3[80850000]            	mov	[count], eax
  4567                                  
  4568                                  	;mov	edi, audio_buffer
  4569                                  	; 29/05/2024
  4570                                  	;mov	edi, [audio_buffer]
  4571                                  	
  4572 00001D39 21C0                    	and	eax, eax
  4573 00001D3B 7505                    	jnz	short lff22m_8
  4574 00001D3D E999F5FFFF              	jmp	lff22_eof
  4575                                  
  4576                                  lff22m_8:
  4577 00001D42 89C1                    	mov	ecx, eax	; byte count
  4578                                  lff22m_9:
  4579 00001D44 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  4580 00001D49 C605[DA280000]03        	mov	byte [faz], 3  ; 3 steps/phases
  4581                                  lff22m_1:
  4582                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  4583 00001D50 AC                      	lodsb
  4584 00001D51 B280                    	mov	dl, 80h
  4585 00001D53 49                      	dec	ecx
  4586 00001D54 7402                    	jz	short lff22m_2_1
  4587 00001D56 8A16                    	mov	dl, [esi]
  4588                                  lff22m_2_1:	
  4589                                  	; al = [previous_val]
  4590                                  	; dl = [next_val]
  4591 00001D58 E831060000              	call	interpolating_3_8bit_mono ; 1 of 17
  4592 00001D5D E32D                    	jecxz	lff22m_3
  4593                                  lff22m_2_2:
  4594 00001D5F AC                      	lodsb
  4595 00001D60 B280                    	mov	dl, 80h
  4596 00001D62 49                      	dec	ecx
  4597 00001D63 7402                    	jz	short lff22m_2_3
  4598 00001D65 8A16                    	mov	dl, [esi]
  4599                                  lff22m_2_3:
  4600 00001D67 E8A6060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  4601 00001D6C E31E                    	jecxz	lff22m_3
  4602 00001D6E 4D                      	dec	ebp
  4603 00001D6F 75EE                    	jnz	short lff22m_2_2
  4604                                  
  4605 00001D71 A0[DA280000]            	mov	al, [faz]
  4606 00001D76 FEC8                    	dec	al
  4607 00001D78 74CA                    	jz	short lff22m_9
  4608 00001D7A FE0D[DA280000]          	dec	byte [faz]
  4609 00001D80 BD04000000              	mov	ebp, 4
  4610 00001D85 FEC8                    	dec	al
  4611 00001D87 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  4612 00001D89 45                      	inc	ebp ; 5
  4613 00001D8A EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  4614                                  
  4615                                  lff22m_3:
  4616                                  lff22s_3:
  4617 00001D8C E932F5FFFF              	jmp	lff22_3	; padfill
  4618                                  		; (put zeros in the remain words of the buffer)
  4619                                  lff22m_7:
  4620                                  lff22s_7:
  4621 00001D91 E94EF5FFFF              	jmp	lff22_5  ; error
  4622                                  
  4623                                  load_22khz_stereo_8_bit:
  4624                                  	; 16/11/2023
  4625 00001D96 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4626                                  					; last of the file?
  4627 00001D9D 7402                    	jz	short lff22s_0		; no
  4628 00001D9F F9                      	stc
  4629 00001DA0 C3                      	retn
  4630                                  
  4631                                  lff22s_0:
  4632                                  	; 01/12/2024
  4633                                  	; edi = audio buffer address
  4634                                  	; 13/12/2024
  4635 00001DA1 893D[B07A0000]          	mov	[audio_buffer], edi
  4636 00001DA7 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4637                                          ;mov	edx, [loadsize]
  4638                                  
  4639                                  	; esi = buffer address
  4640                                  	;; edx = buffer size
  4641                                  
  4642                                  	; load file into memory
  4643                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001DAC 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001DB2 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001DB4 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001DBA B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001DBF CD40                <1>  int 40h
  4644 00001DC1 72CE                    	jc	short lff22s_7 ; error !
  4645                                  
  4646                                  	; 01/12/2024
  4647 00001DC3 A3[80850000]            	mov	[count], eax
  4648                                  
  4649                                  	;mov	edi, audio_buffer
  4650                                  	; 29/05/2024
  4651                                  	;mov	edi, [audio_buffer]
  4652                                  	
  4653 00001DC8 D1E8                    	shr	eax, 1
  4654 00001DCA 7505                    	jnz	short lff22s_8
  4655 00001DCC E90AF5FFFF              	jmp	lff22_eof
  4656                                  
  4657                                  lff22s_8:
  4658 00001DD1 89C1                    	mov	ecx, eax	; word count
  4659                                  lff22s_9:
  4660 00001DD3 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  4661 00001DD8 C605[DA280000]03        	mov	byte [faz], 3  ; 3 steps/phase
  4662                                  lff22s_1:
  4663                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  4664 00001DDF 66AD                    	lodsw
  4665 00001DE1 66BA8080                	mov	dx, 8080h
  4666 00001DE5 49                      	dec	ecx
  4667 00001DE6 7403                    	jz	short lff22s_2_1
  4668 00001DE8 668B16                  	mov	dx, [esi]
  4669                                  lff22s_2_1:	
  4670                                  	; al = [previous_val_l]
  4671                                  	; ah = [previous_val_r]
  4672                                  	; dl = [next_val_l]
  4673                                  	; dh = [next_val_r]
  4674 00001DEB E8CF050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  4675 00001DF0 E39A                    	jecxz	lff22s_3
  4676                                  lff22s_2_2:
  4677 00001DF2 66AD                    	lodsw
  4678 00001DF4 66BA8080                	mov	dx, 8080h
  4679 00001DF8 49                      	dec	ecx
  4680 00001DF9 7403                    	jz	short lff22s_2_3
  4681 00001DFB 668B16                  	mov	dx, [esi]
  4682                                  lff22s_2_3:
  4683 00001DFE E82C060000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  4684 00001E03 E387                    	jecxz	lff22s_3
  4685 00001E05 4D                      	dec	ebp
  4686 00001E06 75EA                    	jnz	short lff22s_2_2
  4687                                  
  4688 00001E08 A0[DA280000]            	mov	al, [faz]
  4689 00001E0D FEC8                    	dec	al
  4690 00001E0F 74C2                    	jz	short lff22s_9
  4691 00001E11 FE0D[DA280000]          	dec	byte [faz]
  4692 00001E17 BD04000000              	mov	ebp, 4
  4693 00001E1C FEC8                    	dec	al
  4694 00001E1E 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  4695 00001E20 45                      	inc	ebp ; 5
  4696 00001E21 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  4697                                  
  4698                                  load_22khz_mono_16_bit:
  4699                                  	; 16/11/2023
  4700 00001E23 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4701                                  					; last of the file?
  4702 00001E2A 7402                    	jz	short lff22m2_0		; no
  4703 00001E2C F9                      	stc
  4704 00001E2D C3                      	retn
  4705                                  
  4706                                  lff22m2_0:
  4707                                  	; 01/12/2024
  4708                                  	; edi = audio buffer address
  4709                                  	; 13/12/2024
  4710 00001E2E 893D[B07A0000]          	mov	[audio_buffer], edi
  4711 00001E34 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4712                                          ;mov	edx, [loadsize]
  4713                                  
  4714                                  	; esi = buffer address
  4715                                  	;; edx = buffer size
  4716                                  
  4717                                  	; load file into memory
  4718                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001E39 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001E3F 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001E41 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001E47 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001E4C CD40                <1>  int 40h
  4719 00001E4E 7261                    	jc	short lff22m2_7 ; error !
  4720                                  
  4721                                  	; 01/12/2024
  4722 00001E50 A3[80850000]            	mov	[count], eax
  4723                                  
  4724                                  	;mov	edi, audio_buffer
  4725                                  	; 29/05/2024
  4726                                  	;mov	edi, [audio_buffer]
  4727                                  	
  4728 00001E55 D1E8                    	shr	eax, 1
  4729 00001E57 7505                    	jnz	short lff22m2_8
  4730 00001E59 E97DF4FFFF              	jmp	lff22_eof
  4731                                  
  4732                                  lff22m2_8:
  4733 00001E5E 89C1                    	mov	ecx, eax	; word count
  4734                                  lff22m2_9:
  4735 00001E60 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  4736 00001E65 C605[DA280000]03        	mov	byte [faz], 3  ; 3 steps/phases
  4737                                  lff22m2_1:
  4738                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  4739 00001E6C 66AD                    	lodsw
  4740 00001E6E 31D2                    	xor	edx, edx
  4741 00001E70 49                      	dec	ecx
  4742 00001E71 7403                    	jz	short lff22m2_2_1
  4743 00001E73 668B16                  	mov	dx, [esi]
  4744                                  lff22m2_2_1:	
  4745                                  	; ax = [previous_val]
  4746                                  	; dx = [next_val]
  4747 00001E76 E8E5050000              	call	interpolating_3_16bit_mono ; 1 of 17
  4748 00001E7B E32F                    	jecxz	lff22m2_3
  4749                                  lff22m2_2_2:
  4750 00001E7D 66AD                    	lodsw
  4751 00001E7F 31D2                    	xor	edx, edx
  4752 00001E81 49                      	dec	ecx
  4753 00001E82 7403                    	jz	short lff22m2_2_3
  4754 00001E84 668B16                  	mov	dx, [esi]
  4755                                  lff22m2_2_3:
  4756 00001E87 E867060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  4757 00001E8C E31E                    	jecxz	lff22m2_3
  4758 00001E8E 4D                      	dec	ebp
  4759 00001E8F 75EC                    	jnz	short lff22m2_2_2
  4760                                  
  4761 00001E91 A0[DA280000]            	mov	al, [faz]
  4762 00001E96 FEC8                    	dec	al
  4763 00001E98 74C6                    	jz	short lff22m2_9
  4764 00001E9A FE0D[DA280000]          	dec	byte [faz]
  4765 00001EA0 BD04000000              	mov	ebp, 4
  4766 00001EA5 FEC8                    	dec	al
  4767 00001EA7 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  4768 00001EA9 45                      	inc	ebp ; 5
  4769 00001EAA EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  4770                                  
  4771                                  lff22m2_3:
  4772                                  lff22s2_3:
  4773 00001EAC E912F4FFFF              	jmp	lff22_3	; padfill
  4774                                  		; (put zeros in the remain words of the buffer)
  4775                                  lff22m2_7:
  4776                                  lff22s2_7:
  4777 00001EB1 E92EF4FFFF              	jmp	lff22_5  ; error
  4778                                  
  4779                                  load_22khz_stereo_16_bit:
  4780                                  	; 16/11/2023
  4781 00001EB6 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4782                                  					; last of the file?
  4783 00001EBD 7402                    	jz	short lff22s2_0		; no
  4784 00001EBF F9                      	stc
  4785 00001EC0 C3                      	retn
  4786                                  
  4787                                  lff22s2_0:
  4788                                  	; 01/12/2024
  4789                                  	; edi = audio buffer address
  4790                                  	; 13/12/2024
  4791 00001EC1 893D[B07A0000]          	mov	[audio_buffer], edi
  4792 00001EC7 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4793                                          ;mov	edx, [loadsize]
  4794                                  
  4795                                  	; esi = buffer address
  4796                                  	;; edx = buffer size
  4797                                  
  4798                                  	; load file into memory
  4799                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001ECC 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001ED2 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001ED4 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001EDA B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001EDF CD40                <1>  int 40h
  4800 00001EE1 72CE                    	jc	short lff22s2_7 ; error !
  4801                                  
  4802                                  	; 01/12/2024
  4803 00001EE3 A3[80850000]            	mov	[count], eax
  4804                                  
  4805                                  	;mov	edi, audio_buffer
  4806                                  	; 29/05/2024
  4807                                  	;mov	edi, [audio_buffer]
  4808                                  	
  4809 00001EE8 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4810 00001EEB 7505                    	jnz	short lff22s2_8
  4811 00001EED E9E9F3FFFF              	jmp	lff22_eof
  4812                                  
  4813                                  lff22s2_8:
  4814 00001EF2 89C1                    	mov	ecx, eax	; dword count
  4815                                  lff22s2_9:
  4816 00001EF4 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  4817 00001EF9 C605[DA280000]03        	mov	byte [faz], 3  ; 3 steps/phase
  4818                                  lff22s2_1:
  4819                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  4820 00001F00 66AD                    	lodsw
  4821 00001F02 89C3                    	mov	ebx, eax
  4822 00001F04 66AD                    	lodsw
  4823 00001F06 8B16                    	mov	edx, [esi]
  4824 00001F08 668915[D6280000]        	mov	[next_val_l], dx
  4825                                  	; 26/11/2023
  4826 00001F0F C1EA10                  	shr	edx, 16
  4827 00001F12 49                      	dec	ecx
  4828 00001F13 7509                    	jnz	short lff22s2_2_1
  4829 00001F15 31D2                    	xor	edx, edx ; 0
  4830 00001F17 668915[D6280000]        	mov	[next_val_l], dx
  4831                                  lff22s2_2_1:
  4832                                  	; bx = [previous_val_l]
  4833                                  	; ax = [previous_val_r]
  4834                                  	; [next_val_l]
  4835                                  	; dx = [next_val_r]
  4836 00001F1E E86D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  4837 00001F23 E387                    	jecxz	lff22s2_3
  4838                                  lff22s2_2_2:
  4839 00001F25 66AD                    	lodsw
  4840 00001F27 89C3                    	mov	ebx, eax
  4841 00001F29 66AD                    	lodsw
  4842 00001F2B 8B16                    	mov	edx, [esi]
  4843 00001F2D 668915[D6280000]        	mov	[next_val_l], dx
  4844                                  	; 26/11/2023
  4845 00001F34 C1EA10                  	shr	edx, 16
  4846 00001F37 49                      	dec	ecx
  4847 00001F38 7509                    	jnz	short lff22s2_2_3
  4848 00001F3A 31D2                    	xor	edx, edx ; 0
  4849 00001F3C 668915[D6280000]        	mov	[next_val_l], dx
  4850                                  lff22s2_2_3:
  4851 00001F43 E8C3050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  4852 00001F48 E31E                    	jecxz	lff22s2_2_4
  4853                                  
  4854 00001F4A 4D                      	dec	ebp
  4855 00001F4B 75D8                    	jnz	short lff22s2_2_2
  4856                                  
  4857 00001F4D A0[DA280000]            	mov	al, [faz]
  4858 00001F52 FEC8                    	dec	al
  4859 00001F54 749E                    	jz	short lff22s2_9
  4860 00001F56 FE0D[DA280000]          	dec	byte [faz]
  4861 00001F5C BD04000000              	mov	ebp, 4
  4862 00001F61 FEC8                    	dec	al
  4863 00001F63 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  4864 00001F65 45                      	inc	ebp ; 5
  4865 00001F66 EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  4866                                  
  4867                                  lff22s2_2_4:
  4868                                  	; 26/11/2023
  4869 00001F68 E956F3FFFF              	jmp	lff22_3	; padfill
  4870                                  
  4871                                  ; .....................
  4872                                  
  4873                                  load_11khz_mono_8_bit:
  4874                                  	; 18/11/2023
  4875 00001F6D F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4876                                  					; last of the file?
  4877 00001F74 7402                    	jz	short lff11m_0		; no
  4878 00001F76 F9                      	stc
  4879 00001F77 C3                      	retn
  4880                                  
  4881                                  lff11m_0:
  4882                                  	; 01/12/2024
  4883                                  	; edi = audio buffer address
  4884                                  	; 13/12/2024
  4885 00001F78 893D[B07A0000]          	mov	[audio_buffer], edi
  4886 00001F7E BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4887                                          ;mov	edx, [loadsize]
  4888                                  
  4889                                  	; esi = buffer address
  4890                                  	;; edx = buffer size
  4891                                  
  4892                                  	; load file into memory
  4893                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00001F83 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00001F89 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00001F8B 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00001F91 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00001F96 CD40                <1>  int 40h
  4894 00001F98 7247                    	jc	short lff11m_7 ; error !
  4895                                  
  4896                                  	; 01/12/2024
  4897 00001F9A A3[80850000]            	mov	[count], eax
  4898                                  
  4899                                  	;mov	edi, audio_buffer
  4900                                  	; 29/05/2024
  4901                                  	;mov	edi, [audio_buffer]
  4902                                  	
  4903 00001F9F 21C0                    	and	eax, eax
  4904 00001FA1 7505                    	jnz	short lff11m_8
  4905 00001FA3 E933F3FFFF              	jmp	lff11_eof
  4906                                  
  4907                                  lff11m_8:
  4908 00001FA8 89C1                    	mov	ecx, eax		; byte count
  4909                                  lff11m_9:
  4910 00001FAA BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  4911                                  lff11m_1:
  4912                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  4913 00001FAF AC                      	lodsb
  4914 00001FB0 B280                    	mov	dl, 80h
  4915 00001FB2 49                      	dec	ecx
  4916 00001FB3 7402                    	jz	short lff11m_2_1
  4917 00001FB5 8A16                    	mov	dl, [esi]
  4918                                  lff11m_2_1:	
  4919                                  	; al = [previous_val]
  4920                                  	; dl = [next_val]
  4921 00001FB7 E87E050000              	call	interpolating_5_8bit_mono
  4922 00001FBC E333                    	jecxz	lff11m_3
  4923                                  lff11m_2_2:
  4924 00001FBE AC                      	lodsb
  4925 00001FBF B280                    	mov	dl, 80h
  4926 00001FC1 49                      	dec	ecx
  4927 00001FC2 7402                    	jz	short lff11m_2_3
  4928 00001FC4 8A16                    	mov	dl, [esi]
  4929                                  lff11m_2_3:
  4930 00001FC6 E87B060000               	call	interpolating_4_8bit_mono
  4931 00001FCB E324                    	jecxz	lff11m_3
  4932                                  
  4933 00001FCD 4D                      	dec	ebp
  4934 00001FCE 74DA                    	jz	short lff11m_9
  4935                                  
  4936 00001FD0 AC                      	lodsb
  4937 00001FD1 B280                    	mov	dl, 80h
  4938 00001FD3 49                      	dec	ecx
  4939 00001FD4 7402                    	jz	short lff11m_2_4
  4940 00001FD6 8A16                    	mov	dl, [esi]
  4941                                  lff11m_2_4:
  4942 00001FD8 E869060000              	call	interpolating_4_8bit_mono
  4943 00001FDD E312                    	jecxz	lff11m_3
  4944 00001FDF EBCE                    	jmp	short lff11m_1
  4945                                  
  4946                                  lff11m_7:
  4947                                  lff11s_7:
  4948 00001FE1 E9FEF2FFFF              	jmp	lff11_5  ; error
  4949                                  
  4950                                  load_11khz_stereo_8_bit:
  4951                                  	; 18/11/2023
  4952 00001FE6 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4953                                  					; last of the file?
  4954 00001FED 7407                    	jz	short lff11s_0		; no
  4955 00001FEF F9                      	stc
  4956 00001FF0 C3                      	retn
  4957                                  
  4958                                  lff11m_3:
  4959                                  lff11s_3:
  4960 00001FF1 E9CDF2FFFF              	jmp	lff11_3	; padfill
  4961                                  		; (put zeros in the remain words of the buffer)
  4962                                  
  4963                                  lff11s_0:
  4964                                  	; 01/12/2024
  4965                                  	; edi = audio buffer address
  4966                                  	; 13/12/2024
  4967 00001FF6 893D[B07A0000]          	mov	[audio_buffer], edi
  4968 00001FFC BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4969                                          ;mov	edx, [loadsize]
  4970                                  
  4971                                  	; esi = buffer address
  4972                                  	;; edx = buffer size
  4973                                  
  4974                                  	; load file into memory
  4975                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00002001 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002007 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002009 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000200F B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00002014 CD40                <1>  int 40h
  4976 00002016 72C9                    	jc	short lff11s_7 ; error !
  4977                                  
  4978                                  	; 01/12/2024
  4979 00002018 A3[80850000]            	mov	[count], eax
  4980                                  
  4981                                  	;mov	edi, audio_buffer
  4982                                  	; 29/05/2024
  4983                                  	;mov	edi, [audio_buffer]
  4984                                  	
  4985 0000201D D1E8                    	shr	eax, 1
  4986 0000201F 7505                    	jnz	short lff11s_8
  4987 00002021 E9B5F2FFFF              	jmp	lff11_eof
  4988                                  
  4989                                  lff11s_8:
  4990 00002026 89C1                    	mov	ecx, eax	; word count
  4991                                  lff11s_9:
  4992 00002028 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  4993                                  lff11s_1:
  4994                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  4995 0000202D 66AD                    	lodsw
  4996 0000202F 66BA8080                	mov	dx, 8080h
  4997 00002033 49                      	dec	ecx
  4998 00002034 7403                    	jz	short lff11s_2_1
  4999 00002036 668B16                  	mov	dx, [esi]
  5000                                  lff11s_2_1:	
  5001                                  	; al = [previous_val_l]
  5002                                  	; ah = [previous_val_r]
  5003                                  	; dl = [next_val_l]
  5004                                  	; dh = [next_val_r]
  5005 00002039 E85B050000              	call	interpolating_5_8bit_stereo
  5006 0000203E E3B1                    	jecxz	lff11s_3
  5007                                  lff11s_2_2:
  5008 00002040 66AD                    	lodsw
  5009 00002042 66BA8080                	mov	dx, 8080h
  5010 00002046 49                      	dec	ecx
  5011 00002047 7403                    	jz	short lff11s_2_3
  5012 00002049 668B16                  	mov	dx, [esi]
  5013                                  lff11s_2_3:
  5014 0000204C E834060000               	call	interpolating_4_8bit_stereo
  5015 00002051 E39E                    	jecxz	lff11s_3
  5016                                  	
  5017 00002053 4D                      	dec	ebp
  5018 00002054 74D2                    	jz	short lff11s_9
  5019                                  
  5020 00002056 66AD                    	lodsw
  5021 00002058 66BA8080                	mov	dx, 8080h
  5022 0000205C 49                      	dec	ecx
  5023 0000205D 7403                    	jz	short lff11s_2_4
  5024 0000205F 668B16                  	mov	dx, [esi]
  5025                                  lff11s_2_4:
  5026 00002062 E81E060000              	call	interpolating_4_8bit_stereo
  5027 00002067 E388                    	jecxz	lff11s_3
  5028 00002069 EBC2                    	jmp	short lff11s_1
  5029                                  
  5030                                  load_11khz_mono_16_bit:
  5031                                  	; 18/11/2023
  5032 0000206B F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  5033                                  					; last of the file?
  5034 00002072 7402                    	jz	short lff11m2_0		; no
  5035 00002074 F9                      	stc
  5036 00002075 C3                      	retn
  5037                                  
  5038                                  lff11m2_0:
  5039                                  	; 01/12/2024
  5040                                  	; edi = audio buffer address
  5041                                  	; 13/12/2024
  5042 00002076 893D[B07A0000]          	mov	[audio_buffer], edi
  5043 0000207C BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  5044                                          ;mov	edx, [loadsize]
  5045                                  
  5046                                  	; esi = buffer address
  5047                                  	;; edx = buffer size
  5048                                  
  5049                                  	; load file into memory
  5050                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00002081 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002087 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002089 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000208F B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00002094 CD40                <1>  int 40h
  5051 00002096 724D                    	jc	short lff11m2_7 ; error !
  5052                                  
  5053                                  	; 01/12/2024
  5054 00002098 A3[80850000]            	mov	[count], eax
  5055                                  
  5056                                  	;mov	edi, audio_buffer
  5057                                  	; 29/05/2024
  5058                                  	;mov	edi, [audio_buffer]
  5059                                  	
  5060 0000209D D1E8                    	shr	eax, 1
  5061 0000209F 7505                    	jnz	short lff11m2_8
  5062 000020A1 E935F2FFFF              	jmp	lff11_eof
  5063                                  
  5064                                  lff11m2_8:
  5065 000020A6 89C1                    	mov	ecx, eax	; word count
  5066                                  lff11m2_9:
  5067 000020A8 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  5068                                  lff11m2_1:
  5069                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  5070 000020AD 66AD                    	lodsw
  5071 000020AF 31D2                    	xor	edx, edx
  5072 000020B1 49                      	dec	ecx
  5073 000020B2 7403                    	jz	short lff11m2_2_1
  5074 000020B4 668B16                  	mov	dx, [esi]
  5075                                  lff11m2_2_1:	
  5076                                  	; ax = [previous_val]
  5077                                  	; dx = [next_val]
  5078 000020B7 E836060000              	call	interpolating_5_16bit_mono
  5079 000020BC E368                    	jecxz	lff11m2_3
  5080                                  lff11m2_2_2:
  5081 000020BE 66AD                    	lodsw
  5082 000020C0 31D2                    	xor	edx, edx
  5083 000020C2 49                      	dec	ecx
  5084 000020C3 7403                    	jz	short lff11m2_2_3
  5085 000020C5 668B16                  	mov	dx, [esi]
  5086                                  lff11m2_2_3:
  5087 000020C8 E84F070000               	call	interpolating_4_16bit_mono
  5088 000020CD E357                    	jecxz	lff11m2_3
  5089                                  
  5090 000020CF 4D                      	dec	ebp
  5091 000020D0 74D6                    	jz	short lff11m2_9
  5092                                  
  5093 000020D2 66AD                    	lodsw
  5094 000020D4 31D2                    	xor	edx, edx
  5095 000020D6 49                      	dec	ecx
  5096 000020D7 7403                    	jz	short lff11m2_2_4
  5097 000020D9 668B16                  	mov	dx, [esi]
  5098                                  lff11m2_2_4:
  5099 000020DC E83B070000               	call	interpolating_4_16bit_mono
  5100 000020E1 E343                    	jecxz	lff11m2_3
  5101 000020E3 EBC8                    	jmp	short lff11m2_1
  5102                                  
  5103                                  lff11m2_7:
  5104                                  lff11s2_7:
  5105 000020E5 E9FAF1FFFF              	jmp	lff11_5  ; error
  5106                                  
  5107                                  load_11khz_stereo_16_bit:
  5108                                  	; 18/01/2025
  5109                                  	; 18/11/2023
  5110 000020EA F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  5111                                  					; last of the file?
  5112 000020F1 7402                    	jz	short lff11s2_0		; no
  5113 000020F3 F9                      	stc
  5114 000020F4 C3                      	retn
  5115                                  
  5116                                  lff11s2_0:
  5117                                  	; 01/12/2024
  5118                                  	; edi = audio buffer address
  5119                                  	; 13/12/2024
  5120 000020F5 893D[B07A0000]          	mov	[audio_buffer], edi
  5121 000020FB BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  5122                                          ;mov	edx, [loadsize]
  5123                                  
  5124                                  	; esi = buffer address
  5125                                  	;; edx = buffer size
  5126                                  
  5127                                  	; load file into memory
  5128                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00002100 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002106 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002108 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000210E B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00002113 CD40                <1>  int 40h
  5129 00002115 72CE                    	jc	short lff11s2_7 ; error !
  5130                                  
  5131                                  	; 01/12/2024
  5132 00002117 A3[80850000]            	mov	[count], eax
  5133                                  
  5134                                  	;mov	edi, audio_buffer
  5135                                  	; 29/05/2024
  5136                                  	;mov	edi, [audio_buffer]
  5137                                  	
  5138 0000211C C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  5139 0000211F 750A                    	jnz	short lff11s2_8
  5140 00002121 E9B5F1FFFF              	jmp	lff11_eof
  5141                                  
  5142                                  lff11m2_3:
  5143                                  lff11s2_3:
  5144 00002126 E998F1FFFF              	jmp	lff11_3	; padfill
  5145                                  		; (put zeros in the remain words of the buffer)
  5146                                  
  5147                                  lff11s2_8:
  5148 0000212B 89C1                    	mov	ecx, eax	; dword count
  5149                                  lff11s2_9:
  5150 0000212D BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  5151                                  lff11s2_1:
  5152                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  5153 00002132 66AD                    	lodsw
  5154 00002134 89C3                    	mov	ebx, eax
  5155 00002136 66AD                    	lodsw
  5156 00002138 8B16                    	mov	edx, [esi]
  5157                                  	; 18/01/2025
  5158                                  	;mov	[next_val_l], edx
  5159                                  	; 26/11/2023
  5160                                  	;shr	edx, 16
  5161                                  	;mov	[next_val_r], dx
  5162 0000213A 49                      	dec	ecx
  5163 0000213B 7502                    	jnz	short lff11s2_2_1
  5164 0000213D 31D2                    	xor	edx, edx ; 0
  5165                                  	;mov	[next_val_l], dx
  5166                                  	;mov	[next_val_r], dx
  5167                                  lff11s2_2_1:
  5168                                  	; bx = [previous_val_l]
  5169                                  	; ax = [previous_val_r]
  5170                                  	; [next_val_l]
  5171                                  	; dx = [next_val_r]
  5172                                  	;;;
  5173                                  	; 18/01/2025 (BugFix)
  5174 0000213F 8915[D6280000]          	mov	[next_val_l], edx
  5175                                  	;;;
  5176 00002145 E803060000              	call	interpolating_5_16bit_stereo
  5177 0000214A E3DA                    	jecxz	lff11s2_3
  5178                                  lff11s2_2_2:
  5179 0000214C 66AD                    	lodsw
  5180 0000214E 89C3                    	mov	ebx, eax
  5181 00002150 66AD                    	lodsw
  5182 00002152 8B16                    	mov	edx, [esi]
  5183                                  	; 18/01/2025
  5184                                  	;mov	[next_val_l], dx
  5185                                  	; 26/11/2023
  5186                                  	;shr	edx, 16
  5187                                  	;mov	[next_val_r], dx
  5188 00002154 49                      	dec	ecx
  5189 00002155 7502                    	jnz	short lff11s2_2_3
  5190 00002157 31D2                    	xor	edx, edx ; 0
  5191                                  	;mov	[next_val_l], dx
  5192                                  	;mov	[next_val_r], dx
  5193                                  lff11s2_2_3:
  5194                                  	;;;
  5195                                  	; 18/01/2025 (BugFix)
  5196 00002159 8915[D6280000]          	mov	[next_val_l], edx
  5197                                  	;;;
  5198 0000215F E8F1060000              	call	interpolating_4_16bit_stereo
  5199 00002164 E3C0                    	jecxz	lff11s2_3
  5200                                  	
  5201 00002166 4D                      	dec	ebp
  5202 00002167 74C4                    	jz	short lff11s2_9
  5203                                  
  5204 00002169 66AD                    	lodsw
  5205 0000216B 89C3                    	mov	ebx, eax
  5206 0000216D 66AD                    	lodsw
  5207 0000216F 8B16                    	mov	edx, [esi]
  5208                                  	; 18/01/2025
  5209                                  	;mov	[next_val_l], dx
  5210                                  	; 26/11/2023
  5211                                  	;shr	edx, 16
  5212                                  	;mov	[next_val_r], dx
  5213 00002171 49                      	dec	ecx
  5214 00002172 7502                    	jnz	short lff11s2_2_4
  5215 00002174 31D2                    	xor	edx, edx ; 0
  5216                                  	;mov	[next_val_l], dx
  5217                                  	;mov	[next_val_r], dx
  5218                                  lff11s2_2_4:
  5219                                  	;;;
  5220                                  	; 18/01/2025 (BugFix)
  5221 00002176 8915[D6280000]          	mov	[next_val_l], edx
  5222                                  	;;;
  5223 0000217C E8D4060000               	call	interpolating_4_16bit_stereo
  5224 00002181 E3A3                    	jecxz	lff11s2_3
  5225 00002183 EBAD                    	jmp	short lff11s2_1
  5226                                  
  5227                                  ; .....................
  5228                                  
  5229                                  load_44khz_mono_8_bit:
  5230                                  	; 18/11/2023
  5231 00002185 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  5232                                  					; last of the file?
  5233 0000218C 7402                    	jz	short lff44m_0		; no
  5234 0000218E F9                      	stc
  5235 0000218F C3                      	retn
  5236                                  
  5237                                  lff44m_0:
  5238                                  	; 01/12/2024
  5239                                  	; edi = audio buffer address
  5240                                  	; 13/12/2024
  5241 00002190 893D[B07A0000]          	mov	[audio_buffer], edi
  5242 00002196 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  5243                                          ;mov	edx, [loadsize]
  5244                                  
  5245                                  	; esi = buffer address
  5246                                  	;; edx = buffer size
  5247                                  
  5248                                  	; load file into memory
  5249                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000219B 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000021A1 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000021A3 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000021A9 B803000000          <1>  mov eax, %1
   103                              <1> 
   104 000021AE CD40                <1>  int 40h
  5250 000021B0 7250                    	jc	short lff44m_7 ; error !
  5251                                  
  5252                                  	; 01/12/2024
  5253 000021B2 A3[80850000]            	mov	[count], eax
  5254                                  
  5255                                  	;mov	edi, audio_buffer
  5256                                  	; 29/05/2024
  5257                                  	;mov	edi, [audio_buffer]
  5258                                  	
  5259 000021B7 21C0                    	and	eax, eax
  5260 000021B9 7505                    	jnz	short lff44m_8
  5261 000021BB E91BF1FFFF              	jmp	lff44_eof
  5262                                  
  5263                                  lff44m_8:
  5264 000021C0 89C1                    	mov	ecx, eax	; byte count
  5265                                  lff44m_9:
  5266 000021C2 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  5267 000021C7 C605[DA280000]02        	mov	byte [faz], 2  ; 2 steps/phases
  5268                                  lff44m_1:
  5269                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  5270                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  5271 000021CE AC                      	lodsb
  5272 000021CF B280                    	mov	dl, 80h
  5273 000021D1 49                      	dec	ecx
  5274 000021D2 7402                    	jz	short lff44m_2_1
  5275 000021D4 8A16                    	mov	dl, [esi]
  5276                                  lff44m_2_1:	
  5277                                  	; al = [previous_val]
  5278                                  	; dl = [next_val]
  5279 000021D6 E837020000              	call	interpolating_2_8bit_mono
  5280 000021DB E320                    	jecxz	lff44m_3
  5281                                  lff44m_2_2:
  5282 000021DD AC                      	lodsb
  5283 000021DE 2C80                    	sub	al, 80h
  5284 000021E0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5285 000021E4 66AB                    	stosw		; (L)
  5286 000021E6 66AB                    	stosw		; (R)
  5287                                  
  5288 000021E8 49                      	dec	ecx
  5289 000021E9 7412                    	jz	short lff44m_3
  5290 000021EB 4D                      	dec	ebp
  5291 000021EC 75EF                    	jnz	short lff44m_2_2
  5292                                  	
  5293 000021EE FE0D[DA280000]          	dec	byte [faz]
  5294 000021F4 74CC                    	jz	short lff44m_9 
  5295 000021F6 BD0B000000              	mov	ebp, 11
  5296 000021FB EBD1                    	jmp	short lff44m_1
  5297                                  
  5298                                  lff44m_3:
  5299                                  lff44s_3:
  5300 000021FD E9C1F0FFFF              	jmp	lff44_3	; padfill
  5301                                  		; (put zeros in the remain words of the buffer)
  5302                                  lff44m_7:
  5303                                  lff44s_7:
  5304 00002202 E9DDF0FFFF              	jmp	lff44_5  ; error
  5305                                  
  5306                                  load_44khz_stereo_8_bit:
  5307                                  	; 16/11/2023
  5308 00002207 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  5309                                  					; last of the file?
  5310 0000220E 7402                    	jz	short lff44s_0		; no
  5311 00002210 F9                      	stc
  5312 00002211 C3                      	retn
  5313                                  
  5314                                  lff44s_0:
  5315                                  	; 01/12/2024
  5316                                  	; edi = audio buffer address
  5317                                  	; 13/12/2024
  5318 00002212 893D[B07A0000]          	mov	[audio_buffer], edi
  5319 00002218 BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  5320                                          ;mov	edx, [loadsize]
  5321                                  
  5322                                  	; esi = buffer address
  5323                                  	;; edx = buffer size
  5324                                  
  5325                                  	; load file into memory
  5326                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000221D 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002223 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002225 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000222B B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00002230 CD40                <1>  int 40h
  5327 00002232 72CE                    	jc	short lff44s_7 ; error !
  5328                                  
  5329                                  	; 01/12/2024
  5330 00002234 A3[80850000]            	mov	[count], eax
  5331                                  
  5332                                  	;mov	edi, audio_buffer
  5333                                  	; 29/05/2024
  5334                                  	;mov	edi, [audio_buffer]
  5335                                  	
  5336 00002239 D1E8                    	shr	eax, 1
  5337 0000223B 7505                    	jnz	short lff44s_8
  5338 0000223D E999F0FFFF              	jmp	lff44_eof
  5339                                  
  5340                                  lff44s_8:
  5341 00002242 89C1                    	mov	ecx, eax	; word count
  5342                                  lff44s_9:
  5343 00002244 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  5344 00002249 C605[DA280000]02        	mov	byte [faz], 2  ; 2 steps/phase
  5345                                  lff44s_1:
  5346                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  5347                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  5348 00002250 66AD                    	lodsw
  5349 00002252 66BA8080                	mov	dx, 8080h
  5350 00002256 49                      	dec	ecx
  5351 00002257 7403                    	jz	short lff44s_2_1
  5352 00002259 668B16                  	mov	dx, [esi]
  5353                                  lff44s_2_1:	
  5354                                  	; al = [previous_val_l]
  5355                                  	; ah = [previous_val_r]
  5356                                  	; dl = [next_val_l]
  5357                                  	; dh = [next_val_r]
  5358 0000225C E8CE010000              	call	interpolating_2_8bit_stereo
  5359 00002261 E39A                    	jecxz	lff44s_3
  5360                                  lff44s_2_2:
  5361 00002263 AC                      	lodsb
  5362 00002264 2C80                    	sub	al, 80h
  5363 00002266 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5364 0000226A 66AB                    	stosw		; (L)
  5365 0000226C AC                      	lodsb
  5366 0000226D 2C80                    	sub	al, 80h
  5367 0000226F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5368 00002273 66AB                    	stosw		; (R)
  5369                                  
  5370 00002275 49                      	dec	ecx
  5371 00002276 7485                    	jz	short lff44s_3	
  5372 00002278 4D                      	dec	ebp
  5373 00002279 75E8                    	jnz	short lff44s_2_2
  5374                                  	
  5375 0000227B FE0D[DA280000]          	dec	byte [faz]
  5376 00002281 74C1                    	jz	short lff44s_9 
  5377 00002283 BD0B000000              	mov	ebp, 11
  5378 00002288 EBC6                    	jmp	short lff44s_1
  5379                                  
  5380                                  load_44khz_mono_16_bit:
  5381                                  	; 18/11/2023
  5382 0000228A F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  5383                                  					; last of the file?
  5384 00002291 7402                    	jz	short lff44m2_0		; no
  5385 00002293 F9                      	stc
  5386 00002294 C3                      	retn
  5387                                  
  5388                                  lff44m2_0:
  5389                                  	; 01/12/2024
  5390                                  	; edi = audio buffer address
  5391                                  	; 13/12/2024
  5392 00002295 893D[B07A0000]          	mov	[audio_buffer], edi
  5393 0000229B BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  5394                                          ;mov	edx, [loadsize]
  5395                                  
  5396                                  	; esi = buffer address
  5397                                  	;; edx = buffer size
  5398                                  
  5399                                  	; load file into memory
  5400                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000022A0 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 000022A6 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 000022A8 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000022AE B803000000          <1>  mov eax, %1
   103                              <1> 
   104 000022B3 CD40                <1>  int 40h
  5401 000022B5 724D                    	jc	short lff44m2_7 ; error !
  5402                                  
  5403                                  	; 01/12/2024
  5404 000022B7 A3[80850000]            	mov	[count], eax
  5405                                  
  5406                                  	;mov	edi, audio_buffer
  5407                                  	; 29/05/2024
  5408                                  	;mov	edi, [audio_buffer]
  5409                                  	
  5410 000022BC D1E8                    	shr	eax, 1
  5411 000022BE 7505                    	jnz	short lff44m2_8
  5412 000022C0 E916F0FFFF              	jmp	lff44_eof
  5413                                  
  5414                                  lff44m2_8:
  5415 000022C5 89C1                    	mov	ecx, eax	; word count
  5416                                  lff44m2_9:
  5417 000022C7 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  5418 000022CC C605[DA280000]02        	mov	byte [faz], 2  ; 2 steps/phases
  5419                                  lff44m2_1:
  5420                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  5421                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  5422 000022D3 66AD                    	lodsw
  5423 000022D5 31D2                    	xor	edx, edx
  5424 000022D7 49                      	dec	ecx
  5425 000022D8 7403                    	jz	short lff44m2_2_1
  5426 000022DA 668B16                  	mov	dx, [esi]
  5427                                  lff44m2_2_1:	
  5428                                  	; ax = [previous_val]
  5429                                  	; dx = [next_val]
  5430 000022DD E811020000              	call	interpolating_2_16bit_mono
  5431 000022E2 E31B                    	jecxz	lff44m2_3
  5432                                  lff44m2_2_2:
  5433 000022E4 66AD                    	lodsw
  5434 000022E6 66AB                    	stosw		; (L)eft Channel
  5435 000022E8 66AB                    	stosw		; (R)ight Channel
  5436                                  
  5437 000022EA 49                      	dec	ecx
  5438 000022EB 7412                    	jz	short lff44m2_3	
  5439 000022ED 4D                      	dec	ebp
  5440 000022EE 75F4                    	jnz	short lff44m2_2_2
  5441                                  	
  5442 000022F0 FE0D[DA280000]          	dec	byte [faz]
  5443 000022F6 74CF                    	jz	short lff44m2_9 
  5444 000022F8 BD0B000000              	mov	ebp, 11
  5445 000022FD EBD4                    	jmp	short lff44m2_1
  5446                                  
  5447                                  lff44m2_3:
  5448                                  lff44s2_3:
  5449 000022FF E9BFEFFFFF              	jmp	lff44_3	; padfill
  5450                                  		; (put zeros in the remain words of the buffer)
  5451                                  lff44m2_7:
  5452                                  lff44s2_7:
  5453 00002304 E9DBEFFFFF              	jmp	lff44_5  ; error
  5454                                  
  5455                                  load_44khz_stereo_16_bit:
  5456                                  	; 18/11/2023
  5457 00002309 F605[FA840000]01                test    byte [flags], ENDOFFILE	; have we already read the
  5458                                  					; last of the file?
  5459 00002310 7402                    	jz	short lff44s2_0		; no
  5460 00002312 F9                      	stc
  5461 00002313 C3                      	retn
  5462                                  
  5463                                  lff44s2_0:
  5464                                  	; 01/12/2024
  5465                                  	; edi = audio buffer address
  5466                                  	; 13/12/2024
  5467 00002314 893D[B07A0000]          	mov	[audio_buffer], edi
  5468 0000231A BE[00A00200]            	mov	esi, temp_buffer ; temporary buffer for wav data
  5469                                          ;mov	edx, [loadsize]
  5470                                  
  5471                                  	; esi = buffer address
  5472                                  	;; edx = buffer size
  5473                                  
  5474                                  	; load file into memory
  5475                                  	sys 	_read, [filehandle], esi, [loadsize]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 0000231F 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002325 89F1                <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002327 8B15[70850000]      <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 0000232D B803000000          <1>  mov eax, %1
   103                              <1> 
   104 00002332 CD40                <1>  int 40h
  5476 00002334 72CE                    	jc	short lff44s2_7 ; error !
  5477                                  
  5478                                  	; 01/12/2024
  5479 00002336 A3[80850000]            	mov	[count], eax
  5480                                  
  5481                                  	;mov	edi, audio_buffer
  5482                                  	; 29/05/2024
  5483                                  	;mov	edi, [audio_buffer]
  5484                                  	
  5485 0000233B C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  5486 0000233E 7505                    	jnz	short lff44s2_8
  5487 00002340 E996EFFFFF              	jmp	lff44_eof
  5488                                  
  5489                                  lff44s2_8:
  5490 00002345 89C1                    	mov	ecx, eax	; dword count
  5491                                  lff44s2_9:
  5492 00002347 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  5493 0000234C C605[DA280000]02        	mov	byte [faz], 2  ; 2 steps/phase
  5494                                  lff44s2_1:
  5495                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  5496                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  5497 00002353 66AD                    	lodsw
  5498 00002355 89C3                    	mov	ebx, eax
  5499 00002357 66AD                    	lodsw
  5500                                  	;mov	dx, [esi]
  5501                                  	;mov	[next_val_l], dx
  5502                                  	;mov	dx, [esi+2]
  5503                                  	; 26/11/2023
  5504 00002359 8B16                    	mov	edx, [esi]
  5505 0000235B 668915[D6280000]        	mov	[next_val_l], dx
  5506 00002362 C1EA10                  	shr	edx, 16
  5507 00002365 49                      	dec	ecx
  5508 00002366 7509                    	jnz	short lff44s2_2_1
  5509 00002368 31D2                    	xor	edx, edx ; 0
  5510 0000236A 668915[D6280000]        	mov	[next_val_l], dx
  5511                                  lff44s2_2_1:
  5512                                  	; bx = [previous_val_l]
  5513                                  	; ax = [previous_val_r]
  5514                                  	; [next_val_l]
  5515                                  	; dx = [next_val_r]
  5516 00002371 E895010000              	call	interpolating_2_16bit_stereo
  5517 00002376 E387                    	jecxz	lff44s2_3
  5518                                  lff44s2_2_2:
  5519                                  	;movsw		; (L)eft Channel
  5520                                  	;movsw		; (R)ight Channel
  5521 00002378 A5                      	movsd
  5522                                  
  5523 00002379 49                      	dec	ecx
  5524 0000237A 7483                    	jz	short lff44s2_3	
  5525 0000237C 4D                      	dec	ebp
  5526 0000237D 75F9                    	jnz	short lff44s2_2_2
  5527                                  	
  5528 0000237F FE0D[DA280000]          	dec	byte [faz]
  5529 00002385 74C0                    	jz	short lff44s2_9 
  5530 00002387 BD0B000000              	mov	ebp, 11
  5531 0000238C EBC5                    	jmp	short lff44s2_1
  5532                                  
  5533                                  ; .....................
  5534                                  
  5535                                  interpolating_3_8bit_mono:
  5536                                  	; 16/11/2023
  5537                                  	; al = [previous_val]
  5538                                  	; dl = [next_val]
  5539                                  	; original-interpolated-interpolated
  5540 0000238E 88C3                    	mov	bl, al
  5541 00002390 2C80                    	sub	al, 80h
  5542 00002392 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5543 00002396 66AB                    	stosw		; original sample (L)
  5544 00002398 66AB                    	stosw		; original sample (R)
  5545 0000239A 88D8                    	mov	al, bl
  5546 0000239C 00D0                    	add	al, dl
  5547 0000239E D0D8                    	rcr	al, 1
  5548 000023A0 88C7                    	mov	bh, al	; interpolated middle (temporary)
  5549 000023A2 00D8                    	add	al, bl
  5550 000023A4 D0D8                    	rcr	al, 1
  5551 000023A6 2C80                    	sub	al, 80h
  5552 000023A8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5553 000023AC 66AB                    	stosw		; interpolated sample 1 (L)
  5554 000023AE 66AB                    	stosw		; interpolated sample 1 (R)
  5555 000023B0 88F8                    	mov	al, bh
  5556 000023B2 00D0                    	add	al, dl	; [next_val]
  5557 000023B4 D0D8                    	rcr	al, 1
  5558 000023B6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5559 000023BA 66AB                    	stosw		; interpolated sample 2 (L)
  5560 000023BC 66AB                    	stosw		; interpolated sample 2 (R)
  5561 000023BE C3                      	retn
  5562                                  
  5563                                  interpolating_3_8bit_stereo:
  5564                                  	; 16/11/2023
  5565                                  	; al = [previous_val_l]
  5566                                  	; ah = [previous_val_r]
  5567                                  	; dl = [next_val_l]
  5568                                  	; dh = [next_val_r]
  5569                                  	; original-interpolated-interpolated
  5570 000023BF 89C3                    	mov	ebx, eax
  5571 000023C1 2C80                    	sub	al, 80h
  5572 000023C3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5573 000023C7 66AB                    	stosw		; original sample (L)
  5574 000023C9 88F8                    	mov	al, bh
  5575 000023CB 2C80                    	sub	al, 80h
  5576 000023CD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5577 000023D1 66AB                    	stosw		; original sample (R)
  5578 000023D3 88D8                    	mov	al, bl
  5579 000023D5 00D0                    	add	al, dl	; [next_val_l]
  5580 000023D7 D0D8                    	rcr	al, 1
  5581 000023D9 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  5582 000023DA 00D8                    	add	al, bl	; [previous_val_l]
  5583 000023DC D0D8                    	rcr	al, 1
  5584 000023DE 2C80                    	sub	al, 80h
  5585 000023E0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5586 000023E4 66AB                    	stosw		; interpolated sample 1 (L)
  5587 000023E6 88F8                    	mov	al, bh
  5588 000023E8 00F0                    	add	al, dh	; [next_val_r]
  5589 000023EA D0D8                    	rcr	al, 1
  5590 000023EC 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  5591 000023ED 00F8                    	add	al, bh	; [previous_val_r]
  5592 000023EF D0D8                    	rcr	al, 1
  5593 000023F1 2C80                    	sub	al, 80h
  5594 000023F3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5595 000023F7 66AB                    	stosw		; interpolated sample 1 (R)
  5596 000023F9 5B                      	pop	ebx ; **
  5597 000023FA 58                      	pop	eax ; *
  5598 000023FB 00D0                    	add	al, dl	; [next_val_l]
  5599 000023FD D0D8                    	rcr	al, 1
  5600 000023FF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5601 00002403 66AB                    	stosw		; interpolated sample 2 (L)
  5602 00002405 88D8                    	mov	al, bl
  5603 00002407 00F0                    	add	al, dh	; [next_val_r]
  5604 00002409 D0D8                    	rcr	al, 1
  5605 0000240B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5606 0000240F 66AB                    	stosw		; interpolated sample 2 (R)
  5607 00002411 C3                      	retn
  5608                                  
  5609                                  interpolating_2_8bit_mono:
  5610                                  	; 16/11/2023
  5611                                  	; al = [previous_val]
  5612                                  	; dl = [next_val]
  5613                                  	; original-interpolated
  5614 00002412 88C3                    	mov	bl, al
  5615 00002414 2C80                    	sub	al, 80h
  5616 00002416 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5617 0000241A 66AB                    	stosw		; original sample (L)
  5618 0000241C 66AB                    	stosw		; original sample (R)
  5619 0000241E 88D8                    	mov	al, bl
  5620 00002420 00D0                    	add	al, dl
  5621 00002422 D0D8                    	rcr	al, 1
  5622 00002424 2C80                    	sub	al, 80h
  5623 00002426 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5624 0000242A 66AB                    	stosw		; interpolated sample (L)
  5625 0000242C 66AB                    	stosw		; interpolated sample (R)
  5626 0000242E C3                      	retn
  5627                                  
  5628                                  interpolating_2_8bit_stereo:
  5629                                  	; 16/11/2023
  5630                                  	; al = [previous_val_l]
  5631                                  	; ah = [previous_val_r]
  5632                                  	; dl = [next_val_l]
  5633                                  	; dh = [next_val_r]
  5634                                  	; original-interpolated
  5635 0000242F 89C3                    	mov	ebx, eax
  5636 00002431 2C80                    	sub	al, 80h
  5637 00002433 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5638 00002437 66AB                    	stosw		; original sample (L)
  5639 00002439 88F8                    	mov	al, bh
  5640 0000243B 2C80                    	sub	al, 80h
  5641 0000243D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5642 00002441 66AB                    	stosw		; original sample (R)
  5643 00002443 88D8                    	mov	al, bl	; [previous_val_l]
  5644 00002445 00D0                    	add	al, dl	; [next_val_l]
  5645 00002447 D0D8                    	rcr	al, 1
  5646 00002449 2C80                    	sub	al, 80h
  5647 0000244B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5648 0000244F 66AB                    	stosw		; interpolated sample (L)
  5649 00002451 88F8                    	mov	al, bh
  5650 00002453 00F0                    	add	al, dh	; [next_val_r]
  5651 00002455 D0D8                    	rcr	al, 1
  5652 00002457 2C80                    	sub	al, 80h
  5653 00002459 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5654 0000245D 66AB                    	stosw		; interpolated sample (R)
  5655 0000245F C3                      	retn
  5656                                  
  5657                                  interpolating_3_16bit_mono:
  5658                                  	; 16/11/2023
  5659                                  	; ax = [previous_val]
  5660                                  	; dx = [next_val]
  5661                                  	; original-interpolated-interpolated
  5662                                  
  5663 00002460 66AB                    	stosw		; original sample (L)
  5664 00002462 66AB                    	stosw		; original sample (R)
  5665 00002464 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  5666 00002467 50                      	push	eax ; *	; [previous_val]
  5667 00002468 80C680                  	add	dh, 80h
  5668 0000246B 6601D0                  	add	ax, dx
  5669 0000246E 66D1D8                  	rcr	ax, 1
  5670 00002471 5B                      	pop	ebx ; *
  5671 00002472 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  5672 00002473 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  5673 00002476 66D1D8                  	rcr	ax, 1
  5674 00002479 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5675 0000247C 66AB                    	stosw 		; interpolated sample 1 (L)
  5676 0000247E 66AB                    	stosw		; interpolated sample 1 (R)
  5677 00002480 89D8                    	mov	eax, ebx
  5678 00002482 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  5679 00002485 66D1D8                  	rcr	ax, 1
  5680 00002488 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5681 0000248B 66AB                    	stosw		; interpolated sample 2 (L)
  5682 0000248D 66AB                    	stosw		; interpolated sample 2 (R)
  5683 0000248F C3                      	retn
  5684                                  
  5685                                  interpolating_3_16bit_stereo:
  5686                                  	; 16/11/2023
  5687                                  	; bx = [previous_val_l]
  5688                                  	; ax = [previous_val_r]
  5689                                  	; [next_val_l]
  5690                                  	; dx = [next_val_r]
  5691                                  	; original-interpolated-interpolated
  5692                                  
  5693 00002490 93                      	xchg	eax, ebx
  5694 00002491 66AB                    	stosw		; original sample (L)
  5695 00002493 93                      	xchg	eax, ebx
  5696 00002494 66AB                    	stosw		; original sample (R)
  5697 00002496 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  5698 00002499 50                      	push	eax ; *	; [previous_val_r]
  5699 0000249A 80C780                  	add	bh, 80h
  5700 0000249D 8005[D7280000]80        	add	byte [next_val_l+1], 80h
  5701 000024A4 66A1[D6280000]          	mov	ax, [next_val_l]
  5702 000024AA 6601D8                  	add	ax, bx	; [previous_val_l]
  5703 000024AD 66D1D8                  	rcr	ax, 1
  5704 000024B0 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  5705 000024B1 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  5706 000024B4 66D1D8                  	rcr	ax, 1
  5707 000024B7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5708 000024BA 66AB                    	stosw 		; interpolated sample 1 (L)
  5709 000024BC 58                      	pop	eax  ; *
  5710 000024BD 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  5711 000024C0 52                      	push	edx  ; * ; [next_val_r]
  5712 000024C1 92                      	xchg	eax, edx
  5713 000024C2 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  5714 000024C5 66D1D8                  	rcr	ax, 1	; / 2
  5715 000024C8 50                      	push	eax ; ** ; interpolated middle (R)
  5716 000024C9 6601D0                  	add	ax, dx	; + [previous_val_r]
  5717 000024CC 66D1D8                  	rcr	ax, 1
  5718 000024CF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5719 000024D2 66AB                    	stosw 		; interpolated sample 1 (R)
  5720 000024D4 66A1[D6280000]          	mov	ax, [next_val_l]
  5721 000024DA 6601D8                  	add	ax, bx	; + interpolated middle (L)
  5722 000024DD 66D1D8                  	rcr	ax, 1
  5723 000024E0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5724 000024E3 66AB                    	stosw 		; interpolated sample 2 (L)
  5725 000024E5 58                      	pop	eax ; **
  5726 000024E6 5A                      	pop	edx ; *
  5727 000024E7 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  5728 000024EA 66D1D8                  	rcr	ax, 1	; / 2
  5729 000024ED 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5730 000024F0 66AB                    	stosw 		; interpolated sample 2 (L)
  5731 000024F2 C3                      	retn
  5732                                  
  5733                                  interpolating_2_16bit_mono:
  5734                                  	; 16/11/2023
  5735                                  	; ax = [previous_val]
  5736                                  	; dx = [next_val]
  5737                                  	; original-interpolated
  5738                                  
  5739 000024F3 66AB                    	stosw		; original sample (L)
  5740 000024F5 66AB                    	stosw		; original sample (R)
  5741 000024F7 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  5742 000024FA 80C680                  	add	dh, 80h
  5743 000024FD 6601D0                  	add	ax, dx
  5744 00002500 66D1D8                  	rcr	ax, 1
  5745 00002503 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5746 00002506 66AB                    	stosw		; interpolated sample (L)
  5747 00002508 66AB                    	stosw		; interpolated sample (R)
  5748 0000250A C3                      	retn
  5749                                  
  5750                                  interpolating_2_16bit_stereo:
  5751                                  	; 18/01/2025
  5752                                  	; 16/11/2023
  5753                                  	; bx = [previous_val_l]
  5754                                  	; ax = [previous_val_r]
  5755                                  	; [next_val_l]
  5756                                  	; dx = [next_val_r]
  5757                                  	; original-interpolated
  5758                                  
  5759 0000250B 93                      	xchg	eax, ebx
  5760 0000250C 66AB                    	stosw		; original sample (L)
  5761 0000250E 93                      	xchg	eax, ebx
  5762 0000250F 66AB                    	stosw		; original sample (R)
  5763 00002511 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  5764 00002514 80C680                  	add	dh, 80h
  5765 00002517 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  5766 0000251A 66D1D8                  	rcr	ax, 1	; / 2
  5767                                  	; 18/01/2025
  5768 0000251D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5769                                  	;push	eax ; *	; interpolated sample (R)
  5770                                  	; 18/01/2025
  5771 00002520 C1E010                  	shl	eax, 16
  5772 00002523 66A1[D6280000]          	mov	ax, [next_val_l]
  5773 00002529 80C480                  	add	ah, 80h
  5774 0000252C 80C780                  	add	bh, 80h
  5775 0000252F 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  5776 00002532 66D1D8                  	rcr	ax, 1	; / 2
  5777 00002535 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  5778                                  	; 18/01/2025
  5779                                  	;stosw 		; interpolated sample (L)
  5780                                  	;pop	eax ; *	
  5781                                  	;sub	ah, 80h	; -32768 to +32767 format again
  5782                                  	;stosw 		; interpolated sample (R)
  5783                                  	; 18/01/2025
  5784 00002538 AB                      	stosd
  5785 00002539 C3                      	retn
  5786                                  
  5787                                  interpolating_5_8bit_mono:
  5788                                  	; 17/11/2023
  5789                                  	; al = [previous_val]
  5790                                  	; dl = [next_val]
  5791                                  	; original-interpltd-interpltd-interpltd-interpltd
  5792 0000253A 88C3                    	mov	bl, al
  5793 0000253C 2C80                    	sub	al, 80h
  5794 0000253E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5795 00002542 66AB                    	stosw		; original sample (L)
  5796 00002544 66AB                    	stosw		; original sample (R)
  5797 00002546 88D8                    	mov	al, bl
  5798 00002548 00D0                    	add	al, dl
  5799 0000254A D0D8                    	rcr	al, 1
  5800 0000254C 88C7                    	mov	bh, al	; interpolated middle (temporary)
  5801 0000254E 00D8                    	add	al, bl  ; [previous_val]
  5802 00002550 D0D8                    	rcr	al, 1 	
  5803 00002552 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  5804 00002554 00D8                    	add	al, bl
  5805 00002556 D0D8                    	rcr	al, 1
  5806 00002558 2C80                    	sub	al, 80h
  5807 0000255A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5808 0000255E 66AB                    	stosw		; interpolated sample 1 (L)
  5809 00002560 66AB                    	stosw		; interpolated sample 1 (R)
  5810 00002562 88F8                    	mov	al, bh
  5811 00002564 00F0                    	add	al, dh
  5812 00002566 D0D8                    	rcr	al, 1
  5813 00002568 2C80                    	sub	al, 80h
  5814 0000256A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5815 0000256E 66AB                    	stosw		; interpolated sample 2 (L)
  5816 00002570 66AB                    	stosw		; interpolated sample 2 (R)
  5817 00002572 88F8                    	mov	al, bh
  5818 00002574 00D0                    	add	al, dl	; [next_val]
  5819 00002576 D0D8                    	rcr	al, 1
  5820 00002578 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  5821 0000257A 00F8                    	add	al, bh
  5822 0000257C D0D8                    	rcr	al, 1
  5823 0000257E 2C80                    	sub	al, 80h
  5824 00002580 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5825 00002584 66AB                    	stosw		; interpolated sample 3 (L)
  5826 00002586 66AB                    	stosw		; interpolated sample 3 (R)
  5827 00002588 88F0                    	mov	al, dh
  5828 0000258A 00D0                    	add	al, dl
  5829 0000258C D0D8                    	rcr	al, 1
  5830 0000258E 2C80                    	sub	al, 80h
  5831 00002590 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5832 00002594 66AB                    	stosw		; interpolated sample 4 (L)
  5833 00002596 66AB                    	stosw		; interpolated sample 4 (R)
  5834 00002598 C3                      	retn
  5835                                  
  5836                                  interpolating_5_8bit_stereo:
  5837                                  	; 17/11/2023
  5838                                  	; al = [previous_val_l]
  5839                                  	; ah = [previous_val_r]
  5840                                  	; dl = [next_val_l]
  5841                                  	; dh = [next_val_r]
  5842                                  	; original-interpltd-interpltd-interpltd-interpltd
  5843 00002599 89C3                    	mov	ebx, eax
  5844 0000259B 2C80                    	sub	al, 80h
  5845 0000259D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5846 000025A1 66AB                    	stosw		; original sample (L)
  5847 000025A3 88F8                    	mov	al, bh
  5848 000025A5 2C80                    	sub	al, 80h
  5849 000025A7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5850 000025AB 66AB                    	stosw		; original sample (R)
  5851 000025AD 52                      	push	edx ; *
  5852 000025AE 88D8                    	mov	al, bl
  5853 000025B0 00D0                    	add	al, dl	; [next_val_l]
  5854 000025B2 D0D8                    	rcr	al, 1
  5855 000025B4 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  5856 000025B5 00D8                    	add	al, bl	; [previous_val_l]
  5857 000025B7 D0D8                    	rcr	al, 1
  5858 000025B9 86D8                    	xchg	al, bl
  5859 000025BB 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  5860 000025BD D0D8                    	rcr	al, 1
  5861 000025BF 2C80                    	sub	al, 80h
  5862 000025C1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5863 000025C5 66AB                    	stosw		; interpolated sample 1 (L)
  5864 000025C7 88F8                    	mov	al, bh
  5865 000025C9 00F0                    	add	al, dh	; [next_val_r]
  5866 000025CB D0D8                    	rcr	al, 1
  5867 000025CD 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  5868 000025CE 00F8                    	add	al, bh	; [previous_val_r]
  5869 000025D0 D0D8                    	rcr	al, 1
  5870 000025D2 86F8                    	xchg	al, bh
  5871 000025D4 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  5872 000025D6 D0D8                    	rcr	al, 1
  5873 000025D8 2C80                    	sub	al, 80h
  5874 000025DA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5875 000025DE 66AB                    	stosw		; interpolated sample 1 (R)
  5876 000025E0 5A                      	pop	edx ; ***
  5877 000025E1 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  5878 000025E2 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  5879 000025E4 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  5880 000025E6 D0D8                    	rcr	al, 1
  5881 000025E8 2C80                    	sub	al, 80h
  5882 000025EA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5883 000025EE 66AB                    	stosw		; interpolated sample 2 (L)
  5884 000025F0 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  5885 000025F2 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  5886 000025F4 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  5887 000025F6 D0D8                    	rcr	al, 1
  5888 000025F8 2C80                    	sub	al, 80h
  5889 000025FA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5890 000025FE 66AB                    	stosw		; interpolated sample 2 (R)
  5891 00002600 5A                      	pop	edx ; *
  5892 00002601 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  5893 00002603 00D0                    	add	al, dl	; [next_val_l]
  5894 00002605 D0D8                    	rcr	al, 1
  5895 00002607 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  5896 00002609 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  5897 0000260B D0D8                    	rcr	al, 1
  5898 0000260D 2C80                    	sub	al, 80h
  5899 0000260F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5900 00002613 66AB                    	stosw		; interpolated sample 3 (L)
  5901 00002615 88F8                    	mov	al, bh	
  5902 00002617 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  5903 00002619 D0D8                    	rcr	al, 1
  5904 0000261B 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  5905 0000261D 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  5906 0000261F D0D8                    	rcr	al, 1
  5907 00002621 2C80                    	sub	al, 80h
  5908 00002623 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5909 00002627 66AB                    	stosw		; interpolated sample 3 (R)
  5910 00002629 88D8                    	mov	al, bl
  5911 0000262B 00D0                    	add	al, dl	; [next_val_l]
  5912 0000262D D0D8                    	rcr	al, 1
  5913 0000262F 2C80                    	sub	al, 80h
  5914 00002631 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5915 00002635 66AB                    	stosw		; interpolated sample 4 (L)
  5916 00002637 88F8                    	mov	al, bh
  5917 00002639 00F0                    	add	al, dh	; [next_val_r]
  5918 0000263B D0D8                    	rcr	al, 1
  5919 0000263D 2C80                    	sub	al, 80h
  5920 0000263F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5921 00002643 66AB                    	stosw		; interpolated sample 4 (R)
  5922 00002645 C3                      	retn
  5923                                  
  5924                                  interpolating_4_8bit_mono:
  5925                                  	; 17/11/2023
  5926                                  	; al = [previous_val]
  5927                                  	; dl = [next_val]
  5928                                  	; original-interpolated-interpolated-interpolated
  5929 00002646 88C3                    	mov	bl, al
  5930 00002648 2C80                    	sub	al, 80h
  5931 0000264A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5932 0000264E 66AB                    	stosw		; original sample (L)
  5933 00002650 66AB                    	stosw		; original sample (R)
  5934 00002652 88D8                    	mov	al, bl
  5935 00002654 00D0                    	add	al, dl	
  5936 00002656 D0D8                    	rcr	al, 1
  5937 00002658 86D8                    	xchg	al, bl  ; al = [previous_val]
  5938 0000265A 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  5939 0000265C D0D8                    	rcr	al, 1 	
  5940 0000265E 2C80                    	sub	al, 80h
  5941 00002660 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5942 00002664 66AB                    	stosw		; interpolated sample 1 (L)
  5943 00002666 66AB                    	stosw		; interpolated sample 1 (R)
  5944 00002668 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  5945 0000266A 2C80                    	sub	al, 80h
  5946 0000266C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5947 00002670 66AB                    	stosw		; interpolated sample 2 (L)
  5948 00002672 66AB                    	stosw		; interpolated sample 2 (R)
  5949 00002674 88D8                    	mov	al, bl
  5950 00002676 00D0                    	add	al, dl	; [next_val]
  5951 00002678 D0D8                    	rcr	al, 1
  5952 0000267A 2C80                    	sub	al, 80h
  5953 0000267C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5954 00002680 66AB                    	stosw		; interpolated sample 3 (L)
  5955 00002682 66AB                    	stosw		; interpolated sample 3 (R)
  5956 00002684 C3                      	retn
  5957                                  
  5958                                  interpolating_4_8bit_stereo:
  5959                                  	; 17/11/2023
  5960                                  	; al = [previous_val_l]
  5961                                  	; ah = [previous_val_r]
  5962                                  	; dl = [next_val_l]
  5963                                  	; dh = [next_val_r]	
  5964                                  	; original-interpolated-interpolated-interpolated
  5965 00002685 89C3                    	mov	ebx, eax
  5966 00002687 2C80                    	sub	al, 80h
  5967 00002689 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5968 0000268D 66AB                    	stosw		; original sample (L)
  5969 0000268F 88F8                    	mov	al, bh
  5970 00002691 2C80                    	sub	al, 80h
  5971 00002693 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5972 00002697 66AB                    	stosw		; original sample (R)
  5973 00002699 88D8                    	mov	al, bl
  5974 0000269B 00D0                    	add	al, dl	; [next_val_l]
  5975 0000269D D0D8                    	rcr	al, 1
  5976 0000269F 86D8                    	xchg	al, bl	; al = [previous_val_l]
  5977 000026A1 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  5978 000026A3 D0D8                    	rcr	al, 1
  5979 000026A5 2C80                    	sub	al, 80h
  5980 000026A7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5981 000026AB 66AB                    	stosw		; interpolated sample 1 (L)
  5982 000026AD 88F8                    	mov	al, bh
  5983 000026AF 00F0                    	add	al, dh	; [next_val_r]
  5984 000026B1 D0D8                    	rcr	al, 1
  5985 000026B3 86F8                    	xchg	al, bh	; al = [previous_val_h]
  5986 000026B5 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  5987 000026B7 D0D8                    	rcr	al, 1
  5988 000026B9 2C80                    	sub	al, 80h
  5989 000026BB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5990 000026BF 66AB                    	stosw		; interpolated sample 1 (R)
  5991 000026C1 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  5992 000026C3 2C80                    	sub	al, 80h
  5993 000026C5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5994 000026C9 66AB                    	stosw		; interpolated sample 2 (L)
  5995 000026CB 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  5996 000026CD 2C80                    	sub	al, 80h
  5997 000026CF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  5998 000026D3 66AB                    	stosw		; interpolated sample 2 (L)
  5999 000026D5 88D8                    	mov	al, bl
  6000 000026D7 00D0                    	add	al, dl	; [next_val_l]
  6001 000026D9 D0D8                    	rcr	al, 1
  6002 000026DB 2C80                    	sub	al, 80h
  6003 000026DD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  6004 000026E1 66AB                    	stosw		; interpolated sample 3 (L)
  6005 000026E3 88F8                    	mov	al, bh
  6006 000026E5 00F0                    	add	al, dh	; [next_val_r]
  6007 000026E7 D0D8                    	rcr	al, 1
  6008 000026E9 2C80                    	sub	al, 80h
  6009 000026EB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  6010 000026EF 66AB                    	stosw		; interpolated sample 3 (R)
  6011 000026F1 C3                      	retn
  6012                                  
  6013                                  interpolating_5_16bit_mono:
  6014                                  	; 18/11/2023
  6015                                  	; ax = [previous_val]
  6016                                  	; dx = [next_val]
  6017                                  	; original-interpltd-interpltd-interpltd-interpltd
  6018 000026F2 66AB                    	stosw		; original sample (L)
  6019 000026F4 66AB                    	stosw		; original sample (R)
  6020 000026F6 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  6021 000026F9 89C3                    	mov	ebx, eax ; [previous_val]
  6022 000026FB 80C680                  	add	dh, 80h
  6023 000026FE 6601D0                  	add	ax, dx
  6024 00002701 66D1D8                  	rcr	ax, 1
  6025 00002704 50                      	push	eax ; *	; interpolated middle (temporary)
  6026 00002705 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  6027 00002708 66D1D8                  	rcr	ax, 1
  6028 0000270B 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  6029 0000270C 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  6030 0000270F 66D1D8                  	rcr	ax, 1	
  6031 00002712 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6032 00002715 66AB                    	stosw 		; interpolated sample 1 (L)
  6033 00002717 66AB                    	stosw		; interpolated sample 1 (R)
  6034 00002719 58                      	pop	eax ; **
  6035 0000271A 5B                      	pop	ebx ; *
  6036 0000271B 6601D8                  	add	ax, bx	; 1st quarter + middle
  6037 0000271E 66D1D8                  	rcr	ax, 1	; / 2
  6038 00002721 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  6039 00002724 66AB                    	stosw		; interpolated sample 2 (L)
  6040 00002726 66AB                    	stosw		; interpolated sample 2 (R)
  6041 00002728 89D8                    	mov	eax, ebx
  6042 0000272A 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  6043 0000272D 66D1D8                  	rcr	ax, 1
  6044 00002730 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  6045 00002731 6601D8                  	add	ax, bx	; + interpolated middle
  6046 00002734 66D1D8                  	rcr	ax, 1
  6047 00002737 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6048 0000273A 66AB                    	stosw		; interpolated sample 3 (L)
  6049 0000273C 66AB                    	stosw		; interpolated sample 3 (R)
  6050 0000273E 58                      	pop	eax ; *	
  6051 0000273F 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  6052 00002742 66D1D8                  	rcr	ax, 1	; / 2
  6053 00002745 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6054 00002748 66AB                    	stosw		; interpolated sample 4 (L)
  6055 0000274A 66AB                    	stosw		; interpolated sample 4 (R)
  6056 0000274C C3                      	retn
  6057                                  
  6058                                  interpolating_5_16bit_stereo:
  6059                                  	; 18/11/2023
  6060                                  	; bx = [previous_val_l]
  6061                                  	; ax = [previous_val_r]
  6062                                  	; [next_val_l]
  6063                                  	; [next_val_r]
  6064                                  	; original-interpltd-interpltd-interpltd-interpltd
  6065 0000274D 51                      	push	ecx ; !
  6066 0000274E 93                      	xchg	eax, ebx
  6067 0000274F 66AB                    	stosw		; original sample (L)
  6068 00002751 93                      	xchg	eax, ebx
  6069 00002752 66AB                    	stosw		; original sample (R)
  6070 00002754 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  6071 00002757 50                      	push	eax ; *	; [previous_val_r]
  6072 00002758 80C780                  	add	bh, 80h
  6073 0000275B 8005[D7280000]80        	add	byte [next_val_l+1], 80h
  6074 00002762 66A1[D6280000]          	mov	ax, [next_val_l]
  6075 00002768 6601D8                  	add	ax, bx	; [previous_val_l]
  6076 0000276B 66D1D8                  	rcr	ax, 1
  6077 0000276E 89C1                    	mov	ecx, eax ; interpolated middle (L)
  6078 00002770 6601D8                  	add	ax, bx	
  6079 00002773 66D1D8                  	rcr	ax, 1
  6080 00002776 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  6081 00002778 6601D8                  	add	ax, bx	; [previous_val_l]
  6082 0000277B 66D1D8                  	rcr	ax, 1
  6083 0000277E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6084 00002781 66AB                    	stosw 		; interpolated sample 1 (L)
  6085 00002783 89C8                    	mov	eax, ecx
  6086 00002785 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  6087 00002788 66D1D8                  	rcr	ax, 1	; / 2
  6088 0000278B 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  6089 0000278D 5A                      	pop	edx ; *	; [previous_val_r]
  6090 0000278E 89D0                    	mov	eax, edx
  6091 00002790 8005[D9280000]80        	add	byte [next_val_r+1], 80h
  6092 00002797 660305[D8280000]        	add	ax, [next_val_r]
  6093 0000279E 66D1D8                  	rcr	ax, 1
  6094 000027A1 50                      	push	eax ; *	; interpolated middle (R)
  6095 000027A2 6601D0                  	add	ax, dx
  6096 000027A5 66D1D8                  	rcr	ax, 1
  6097 000027A8 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  6098 000027A9 6601D0                  	add	ax, dx	; [previous_val_r]
  6099 000027AC 66D1D8                  	rcr	ax, 1
  6100 000027AF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6101 000027B2 66AB                    	stosw 		; interpolated sample 1 (R)
  6102 000027B4 89D8                    	mov	eax, ebx
  6103 000027B6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6104 000027B9 66AB                    	stosw 		; interpolated sample 2 (L)
  6105 000027BB 58                      	pop	eax ; **
  6106 000027BC 5A                      	pop	edx ; *
  6107 000027BD 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  6108 000027C0 66D1D8                  	rcr	ax, 1	; / 2
  6109 000027C3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6110 000027C6 66AB                    	stosw 		; interpolated sample 2 (R)
  6111 000027C8 89C8                    	mov	eax, ecx
  6112 000027CA 660305[D6280000]        	add	ax, [next_val_l]
  6113 000027D1 66D1D8                  	rcr	ax, 1
  6114 000027D4 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  6115 000027D5 6601C8                  	add	ax, cx	; interpolated middle (L)
  6116 000027D8 66D1D8                  	rcr	ax, 1
  6117 000027DB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6118 000027DE 66AB                    	stosw 		; interpolated sample 3 (L)
  6119 000027E0 89D0                    	mov	eax, edx
  6120 000027E2 660305[D8280000]        	add	ax, [next_val_r]
  6121 000027E9 66D1D8                  	rcr	ax, 1
  6122 000027EC 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  6123 000027ED 6601D0                  	add	ax, dx	; interpolated middle (R)
  6124 000027F0 66D1D8                  	rcr	ax, 1
  6125 000027F3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6126 000027F6 66AB                    	stosw 		; interpolated sample 3 (R)
  6127 000027F8 5B                      	pop	ebx ; **
  6128 000027F9 58                      	pop	eax ; *
  6129 000027FA 660305[D6280000]        	add	ax, [next_val_l]
  6130 00002801 66D1D8                  	rcr	ax, 1
  6131 00002804 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6132 00002807 66AB                    	stosw 		; interpolated sample 4 (L)
  6133 00002809 89D8                    	mov	eax, ebx
  6134 0000280B 660305[D8280000]        	add	ax, [next_val_r]
  6135 00002812 66D1D8                  	rcr	ax, 1
  6136 00002815 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6137 00002818 66AB                    	stosw 		; interpolated sample 4 (R)
  6138 0000281A 59                      	pop	ecx ; !
  6139 0000281B C3                      	retn
  6140                                  
  6141                                  interpolating_4_16bit_mono:
  6142                                  	; 18/11/2023
  6143                                  	; ax = [previous_val]
  6144                                  	; dx = [next_val]
  6145                                  	; original-interpolated
  6146                                  
  6147 0000281C 66AB                    	stosw		; original sample (L)
  6148 0000281E 66AB                    	stosw		; original sample (R)
  6149 00002820 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  6150 00002823 89C3                    	mov	ebx, eax ; [previous_val]
  6151 00002825 80C680                  	add	dh, 80h
  6152 00002828 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  6153 0000282B 66D1D8                  	rcr	ax, 1
  6154 0000282E 93                      	xchg	eax, ebx
  6155 0000282F 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  6156 00002832 66D1D8                  	rcr	ax, 1
  6157 00002835 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6158 00002838 66AB                    	stosw 		; interpolated sample 1 (L)
  6159 0000283A 66AB                    	stosw		; interpolated sample 1 (R)
  6160 0000283C 89D8                    	mov	eax, ebx ; interpolated middle
  6161 0000283E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6162 00002841 66AB                    	stosw 		; interpolated sample 2 (L)
  6163 00002843 66AB                    	stosw		; interpolated sample 2 (R)
  6164 00002845 89D8                    	mov	eax, ebx
  6165 00002847 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  6166 0000284A 66D1D8                  	rcr	ax, 1
  6167 0000284D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6168 00002850 66AB                    	stosw		; interpolated sample 3 (L)
  6169 00002852 66AB                    	stosw		; interpolated sample 3 (R)
  6170 00002854 C3                      	retn
  6171                                  
  6172                                  interpolating_4_16bit_stereo:
  6173                                  	; 18/11/2023
  6174                                  	; bx = [previous_val_l]
  6175                                  	; ax = [previous_val_r]
  6176                                  	; [next_val_l]
  6177                                  	; [next_val_r]
  6178                                  	; original-interpolated-interpolated-interpolated
  6179 00002855 93                      	xchg	eax, ebx
  6180 00002856 66AB                    	stosw		; original sample (L)
  6181 00002858 93                      	xchg	eax, ebx
  6182 00002859 66AB                    	stosw		; original sample (R)
  6183 0000285B 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  6184 0000285E 89C2                    	mov	edx, eax ; [previous_val_r]
  6185 00002860 80C780                  	add	bh, 80h
  6186 00002863 8005[D7280000]80        	add	byte [next_val_l+1], 80h
  6187 0000286A 66A1[D6280000]          	mov	ax, [next_val_l]
  6188 00002870 6601D8                  	add	ax, bx	; [previous_val_l]
  6189 00002873 66D1D8                  	rcr	ax, 1
  6190 00002876 93                      	xchg	eax, ebx
  6191 00002877 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  6192 0000287A 66D1D8                  	rcr	ax, 1
  6193 0000287D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6194 00002880 66AB                    	stosw 		; interpolated sample 1 (L)
  6195 00002882 8005[D9280000]80        	add	byte [next_val_r+1], 80h
  6196 00002889 89D0                    	mov	eax, edx ; [previous_val_r]
  6197 0000288B 660305[D8280000]        	add	ax, [next_val_r]
  6198 00002892 66D1D8                  	rcr	ax, 1
  6199 00002895 92                      	xchg	eax, edx
  6200 00002896 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  6201 00002899 66D1D8                  	rcr	ax, 1
  6202 0000289C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6203 0000289F 66AB                    	stosw 		; interpolated sample 1 (R)
  6204 000028A1 89D8                    	mov	eax, ebx
  6205 000028A3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6206 000028A6 66AB                    	stosw 		; interpolated sample 2 (L)
  6207 000028A8 89D0                    	mov	eax, edx
  6208 000028AA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6209 000028AD 66AB                    	stosw 		; interpolated sample 2 (R)
  6210 000028AF 89D8                    	mov	eax, ebx
  6211 000028B1 660305[D6280000]        	add	ax, [next_val_l]
  6212 000028B8 66D1D8                  	rcr	ax, 1
  6213 000028BB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6214 000028BE 66AB                    	stosw 		; interpolated sample 3 (L)
  6215 000028C0 89D0                    	mov	eax, edx
  6216 000028C2 660305[D8280000]        	add	ax, [next_val_r]
  6217 000028C9 66D1D8                  	rcr	ax, 1
  6218 000028CC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  6219 000028CF 66AB                    	stosw 		; interpolated sample 3 (R)
  6220 000028D1 C3                      	retn
  6221                                  
  6222                                  ; 13/11/2023
  6223                                  previous_val:
  6224 000028D2 0000                    previous_val_l: dw 0
  6225 000028D4 0000                    previous_val_r: dw 0
  6226                                  next_val:
  6227 000028D6 0000                    next_val_l: dw 0
  6228 000028D8 0000                    next_val_r: dw 0
  6229                                  
  6230                                  ; 16/11/2023
  6231 000028DA 00                      faz:	db 0
  6232                                  
  6233                                  ; --------------------------------------------------------
  6234                                  ; 14/11/2024 - Erdogan Tan
  6235                                  ; --------------------------------------------------------
  6236                                  
  6237                                  	; 07/12/2024
  6238                                  	; 01/12/2024 (32bit registers)
  6239                                  	; 29/11/2024
  6240                                  checkUpdateEvents:
  6241 000028DB E8FC010000              	call	check4keyboardstop
  6242 000028E0 7279                    	jc	short c4ue_ok
  6243                                  
  6244                                  	; 18/11/2024
  6245 000028E2 50                      	push	eax ; *
  6246 000028E3 09C0                    	or	eax, eax
  6247 000028E5 0F8406010000            	jz	c4ue_cpt
  6248                                  
  6249                                  	; 18/11/2024
  6250 000028EB 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  6251 000028ED 7543                    	jne	short c4ue_chk_s
  6252 000028EF 803D[B4840000]00        	cmp	byte [stopped], 0
  6253 000028F6 7714                    	ja	short c4ue_chk_ps
  6254                                  	; pause
  6255 000028F8 E827E5FFFF              	call	ac97_pause
  6256                                  	; 21/11/2024
  6257 000028FD A0[B5840000]            	mov	al, [tLO]
  6258 00002902 A2[B6840000]            	mov	byte [tLP], al
  6259 00002907 E9E5000000              	jmp	c4ue_cpt
  6260                                  c4ue_chk_ps:
  6261 0000290C 803D[B4840000]01        	cmp	byte [stopped], 1
  6262 00002913 770A                    	ja	short c4ue_replay
  6263                                  	; continue to play (after a pause)
  6264 00002915 E813E5FFFF              	call	ac97_play 
  6265 0000291A E9D2000000              	jmp	c4ue_cpt
  6266                                  c4ue_replay:
  6267                                  	; 19/11/2024
  6268 0000291F 58                      	pop	eax ; *
  6269 00002920 58                      	pop	eax ; return address
  6270                                  	; 07/02/2024
  6271                                  	;mov	al, [volume]
  6272                                  	;call	SetmasterVolume
  6273 00002921 C605[B4840000]00        	mov	byte [stopped], 0
  6274 00002928 E8C9040000              	call	move_to_beginning
  6275                                  	;jmp	PlayWav
  6276                                  	; 07/12/2024
  6277 0000292D E90CDEFFFF              	jmp	RePlayWav
  6278                                  
  6279                                  c4ue_chk_s:
  6280 00002932 3C53                    	cmp	al, 'S'	; stop
  6281 00002934 7526                    	jne	short c4ue_chk_fb
  6282 00002936 803D[B4840000]00        	cmp	byte [stopped], 0
  6283 0000293D 0F87AE000000            	ja	c4ue_cpt ; Already stopped/paused
  6284 00002943 E8C3E4FFFF              	call	ac97_stop
  6285                                  	; 19/11/2024
  6286 00002948 C605[B5840000]00        	mov	byte [tLO], 0
  6287                                  	; 21/11/2024
  6288 0000294F C605[B6840000]30        	mov	byte [tLP], '0'
  6289 00002956 E996000000              	jmp	c4ue_cpt
  6290                                  
  6291                                  	; 01/12/2024
  6292                                  	; 18/11/2024
  6293                                  c4ue_ok:
  6294 0000295B C3                      	retn
  6295                                  
  6296                                  c4ue_chk_fb:
  6297                                  	; 17/11/2024
  6298 0000295C 3C46                    	cmp	al, 'F'
  6299 0000295E 750A                    	jne	short c4ue_chk_b
  6300 00002960 E869040000              	call 	Player_ProcessKey_Forwards
  6301 00002965 E987000000              	jmp	c4ue_cpt
  6302                                  
  6303                                  c4ue_chk_b:
  6304 0000296A 3C42                    	cmp	al, 'B'
  6305                                  	;;jne	short c4ue_cpt
  6306                                  	; 19/11/2024
  6307                                  	;jne	short c4ue_chk_h
  6308                                  	; 25/12/2024
  6309                                  	; 29/11/2024
  6310 0000296C 7507                    	jne	short c4ue_chk_n
  6311 0000296E E857040000              	call 	Player_ProcessKey_Backwards
  6312 00002973 EB7C                    	jmp	short c4ue_cpt
  6313                                  
  6314                                  	;;;
  6315                                  	; 25/12/2024
  6316                                  	; 29/11/2024
  6317                                  c4ue_chk_n:
  6318 00002975 3C4E                    	cmp	al, 'N'
  6319 00002977 7404                    	je	short c4ue_nps
  6320                                  c4ue_chk_p:
  6321 00002979 3C50                    	cmp	al, 'P'
  6322 0000297B 7509                    	jne	short c4ue_chk_h
  6323                                  c4ue_nps:
  6324 0000297D C605[B4840000]03        	mov	byte [stopped], 3
  6325 00002984 EB6B                    	jmp	short c4ue_cpt
  6326                                  	;;;
  6327                                  
  6328                                  c4ue_chk_h:
  6329                                  	; 19/11/2024
  6330 00002986 3C48                    	cmp	al, 'H'
  6331 00002988 7515                    	jne	short c4ue_chk_cr
  6332 0000298A C605[B7840000]00        	mov	byte [wleds], 0
  6333 00002991 E825E6FFFF              	call 	write_ac97_pci_dev_info
  6334                                  	;;;
  6335                                  	;24/12/2024 (wave lighting points option)
  6336 00002996 C605[C6840000]01        	mov	byte [p_mode], 1
  6337                                  	;;;
  6338                                  	;mov	dh, 24
  6339                                  	;mov	dl, 79
  6340                                  	;call	setCursorPosition
  6341                                  	; 21/12/2024
  6342 0000299D EB52                    	jmp	short c4ue_cpt
  6343                                  c4ue_chk_cr:
  6344                                  	;;;
  6345                                  	; 24/12/2024 (wave lighting points option)
  6346 0000299F 8A25[B7840000]          	mov	ah, [wleds]
  6347 000029A5 3C47                    	cmp	al, 'G'
  6348 000029A7 7432                    	je	short c4ue_g
  6349                                  ;	;;;
  6350                                  ;	; 26/12/2024
  6351                                  ;	cmp	al, 'T'
  6352                                  ;	jne	short c4ue_chk_cr_@
  6353                                  ;	inc	byte [tcolor]
  6354                                  ;	and 	byte [tcolor], 0Fh
  6355                                  ;	jnz	short c4ue_cpt
  6356                                  ;	inc	byte [tcolor]
  6357                                  ;	jmp	short c4ue_cpt
  6358                                  ;c4ue_chk_cr_@:
  6359                                  ;	;;;
  6360                                  	; 19/11/2024
  6361 000029A9 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  6362 000029AB 7544                    	jne	short c4ue_cpt
  6363                                  	;inc	byte [wleds]
  6364                                  	;jnz	short c4ue_cpt
  6365                                  	;inc	byte [wleds]
  6366                                  	;;;
  6367                                  	; 24/12/2024
  6368                                  	; 22/12/2024 (faster method)
  6369                                  	; (UpdateWaveLeds procedure turns off previously
  6370                                  	;  lighting wave leds only)
  6371                                  	;call	reset_wave_leds ; prepare all leds as turned off
  6372                                  	;;;
  6373                                  	; 23/11/2024
  6374 000029AD 31DB                    	xor	ebx, ebx
  6375                                  	; 24/12/2024 (wave lighting points option)
  6376 000029AF 881D[C6840000]          	mov	[p_mode], bl ; 0
  6377                                  	;
  6378                                  	;mov	bl, [wleds]
  6379 000029B5 88E3                    	mov	bl, ah ; 24/12/2024
  6380 000029B7 FEC3                    	inc	bl
  6381 000029B9 80E30F                  	and	bl, 0Fh
  6382 000029BC 7501                    	jnz	short c4ue_sc
  6383 000029BE 43                      	inc	ebx
  6384                                  c4ue_sc:
  6385 000029BF 881D[B7840000]          	mov	[wleds], bl
  6386 000029C5 D0EB                    	shr	bl, 1
  6387 000029C7 8A83[4D470000]          	mov	al, [ebx+colors]
  6388                                  	; 24/12/2024
  6389 000029CD A2[55470000]            	mov	[ccolor], al
  6390 000029D2 7211                    	jc	short c4ue_g_@
  6391                                  	; 24/12/2024
  6392 000029D4 E867040000              	call	reset_wave_leds ; prepare all leds as turned off
  6393 000029D9 EB16                    	jmp	short c4ue_cpt
  6394                                  	; 24/12/2024
  6395                                  c4ue_g:
  6396 000029DB 08E4                    	or	ah, ah	; byte [wleds]
  6397 000029DD 7506                    	jnz	short c4ue_g_@
  6398 000029DF FE05[B7840000]          	inc	byte [wleds]	; force wave lighting ('G' key)
  6399                                  c4ue_g_@:
  6400                                  	; 24/12/2024 (wave lighting points option)
  6401 000029E5 C605[C6840000]01        	mov	byte [p_mode], 1
  6402 000029EC E834040000              	call	clear_window
  6403                                  	;;;
  6404                                  c4ue_cpt:
  6405                                  	; 24/12/2024
  6406                                  	; 18/11/2024
  6407 000029F1 59                      	pop	ecx ; *
  6408                                  	;;;
  6409                                  	; 29/12/2024
  6410                                  	; 24/12/2024 (skip wave lighting if data is not loaded yet)
  6411                                  	;cmp	byte [SRB], 0
  6412                                  	;ja	short c4ue_vb_ok
  6413                                  	;;;
  6414                                  	; 01/12/2024 (TRDOS 386)
  6415                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second),
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 000029F2 BB04000000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 000029F7 B80D000000          <1>  mov eax, %1
   103                              <1> 
   104 000029FC CD40                <1>  int 40h
  6416                                  	; 24/12/2024
  6417                                  	; 18/11/2024
  6418                                  	;pop	ecx ; *
  6419                                  	; 01/12/2024
  6420 000029FE 3B05[88850000]          	cmp	eax, [timerticks]
  6421                                  	;je	short c4ue_ok
  6422                                  	; 18/11/2024
  6423 00002A04 7407                    	je	short c4ue_skip_utt
  6424                                  c4ue_utt:	
  6425                                  	; 01/12/2024
  6426 00002A06 A3[88850000]            	mov	[timerticks], eax
  6427 00002A0B EB04                    	jmp	short c4ue_cpt_@
  6428                                  c4ue_skip_utt:
  6429                                  	; 18/11/2024
  6430 00002A0D 21C9                    	and	ecx, ecx
  6431 00002A0F 7432                    	jz	short c4ue_vb_ok
  6432                                  c4ue_cpt_@:
  6433                                  	; 18/11/2024
  6434 00002A11 803D[B4840000]00        	cmp	byte [stopped], 0
  6435 00002A18 7729                    	ja	short c4ue_vb_ok
  6436                                  	
  6437 00002A1A E8EE010000              	call	CalcProgressTime
  6438                                  
  6439                                  	;cmp	ax, [ProgressTime]
  6440                                  	; 01/12/2024
  6441 00002A1F 3B05[7C850000]          	cmp	eax, [ProgressTime]
  6442                                  	;je	short c4ue_vb_ok
  6443                                  			; same second, no need to update
  6444                                  	; 23/11/2024
  6445 00002A25 7405                    	je	short c4ue_uvb
  6446                                  
  6447                                  	;call	UpdateProgressTime
  6448                                  	;call	UpdateProgressBar@
  6449 00002A27 E812030000              	call	UpdateProgressBar
  6450                                  
  6451                                  	; 23/11/2024
  6452                                  c4ue_uvb:
  6453 00002A2C 803D[B7840000]00        	cmp	byte [wleds], 0
  6454 00002A33 760E                    	jna	short c4ue_vb_ok
  6455                                  
  6456                                  	; 24/12/2024 (wave points mode)
  6457 00002A35 803D[C6840000]00        	cmp	byte [p_mode], 0
  6458 00002A3C 7706                    	ja	short c4ue_uwp
  6459                                  
  6460 00002A3E E847040000              	call	UpdateWaveLeds
  6461                                  
  6462                                  c4ue_vb_ok:
  6463 00002A43 C3                      	retn
  6464                                  
  6465                                  	; 22/12/2024
  6466                                  c4ue_uwp:
  6467                                  	;call	UpdateWavePoints
  6468                                  	;retn
  6469                                  
  6470                                  ; --------------------------------------------------------
  6471                                  ; 27/12/2024 - Erdogan Tan
  6472                                  ; --------------------------------------------------------
  6473                                  
  6474                                  	; 29/12/2024
  6475                                  	; 27/12/2024 (DMA Buffer Tracking)
  6476                                  	; 26/12/2024
  6477                                  	; 24/12/2024
  6478                                  UpdateWavePoints:
  6479 00002A44 BE[B47A0000]            	mov	esi, prev_points
  6480 00002A49 833E00                  	cmp	dword [esi], 0
  6481 00002A4C 740B                    	jz	short lights_off_ok
  6482 00002A4E B980020000              	mov	ecx, 640
  6483                                  light_off:
  6484 00002A53 AD                      	lodsd
  6485                                  	; eax = wave point (lighting point) address
  6486 00002A54 C60000                  	mov	byte [eax], 0 ; black point (light off)
  6487 00002A57 E2FA                    	loop	light_off	
  6488                                  
  6489                                  lights_off_ok:
  6490                                  	; 29/12/2024
  6491 00002A59 803D[B5840000]32        	cmp	byte [tLO],'2'
  6492 00002A60 7507                    	jne	short lights_on_buff_1
  6493                                  lights_on_buff_2:
  6494 00002A62 BA[00A00100]            	mov	edx, WAVBUFFER_2
  6495 00002A67 EB05                    	jmp	short lights_on
  6496                                  lights_on_buff_1:
  6497 00002A69 BA[00A00000]            	mov	edx, WAVBUFFER_1
  6498                                  lights_on:
  6499 00002A6E 3915[C0840000]          	cmp	[pbuf_s], edx
  6500 00002A74 7520                    	jne	short lights_on_2
  6501 00002A76 8B1D[987A0000]          	mov	ebx, [wpoints_dif]
  6502 00002A7C 8B35[BC840000]          	mov	esi, [pbuf_o]
  6503 00002A82 8B0D[74850000]          	mov	ecx, [buffersize] ; bytes
  6504 00002A88 29D9                    	sub	ecx, ebx ; sub ecx, [wpoints_dif]
  6505 00002A8A 01DE                    	add	esi, ebx
  6506 00002A8C 7204                    	jc	short lights_on_1
  6507 00002A8E 39CE                    	cmp	esi, ecx
  6508 00002A90 760C                    	jna	short lights_on_3
  6509                                  lights_on_1:
  6510 00002A92 89CE                    	mov	esi, ecx
  6511 00002A94 EB08                    	jmp	short lights_on_3
  6512                                  
  6513                                  lights_on_2:
  6514                                  	; 29/12/2024
  6515 00002A96 8915[C0840000]          	mov	[pbuf_s], edx
  6516 00002A9C 31F6                    	xor	esi, esi ; 0
  6517                                  lights_on_3:
  6518 00002A9E 8935[BC840000]          	mov	[pbuf_o], esi
  6519                                  	; 29/12/2024
  6520                                  	;add	esi, [pbuf_s]
  6521 00002AA4 01D6                    	add	esi, edx
  6522 00002AA6 B980020000              	mov	ecx, 640
  6523 00002AAB 89CD                    	mov	ebp, ecx
  6524                                  	; 26/12/2024
  6525 00002AAD BF[B47A0000]            	mov	edi, prev_points
  6526 00002AB2 8B1D[9C7A0000]          	mov	ebx, [graphstart] ; start (top) line
  6527                                  lights_on_4:
  6528 00002AB8 31C0                    	xor	eax, eax ; 0
  6529 00002ABA 66AD                    	lodsw	; left
  6530 00002ABC 80C480                  	add	ah, 80h
  6531 00002ABF 89C2                    	mov	edx, eax
  6532 00002AC1 66AD                    	lodsw	; right
  6533                                  	;add	ax, dx
  6534 00002AC3 80C480                  	add	ah, 80h
  6535                                  	;shr	eax, 9	; 128 volume levels
  6536 00002AC6 01D0                    	add	eax, edx
  6537                                  	;shr	eax, 10	; (L+R/2) & 128 volume levels
  6538 00002AC8 C1E809                  	shr	eax, 9	; (L+R/2) & 256 volume levels
  6539 00002ACB F7E5                    	mul	ebp	; * 640 (row)
  6540 00002ACD 01D8                    	add	eax, ebx ; + column
  6541 00002ACF 8A15[55470000]          	mov	dl, [ccolor]
  6542 00002AD5 8810                    	mov	[eax], dl ; pixel (light on) color
  6543 00002AD7 AB                      	stosd		; save light on addr in prev_points
  6544 00002AD8 43                      	inc	ebx
  6545 00002AD9 E2DD                    	loop	lights_on_4
  6546 00002ADB C3                      	retn
  6547                                  
  6548                                  ; --------------------------------------------------------
  6549                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  6550                                  ; --------------------------------------------------------
  6551                                  
  6552                                  	; 29/12/2024
  6553                                  	; 25/12/2024
  6554                                  	; 07/12/2024
  6555                                  	; 01/12/2024 (TRDOS 386)
  6556                                  	; 29/11/2024
  6557                                  check4keyboardstop:
  6558                                  	; 19/05/2024
  6559                                  	; 08/11/2023
  6560                                  	; 04/11/2023
  6561 00002ADC B401                    	mov	ah, 1
  6562                                  	;int	16h
  6563                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  6564 00002ADE CD32                    	int	32h
  6565                                  	;clc
  6566 00002AE0 7433                    	jz	short _cksr
  6567                                  
  6568 00002AE2 30E4                    	xor	ah, ah
  6569                                  	;int	16h
  6570                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  6571 00002AE4 CD32                    	int	32h
  6572                                  
  6573                                  	; 25/12/2024
  6574                                  	; 29/11/2024
  6575                                  	;mov	[command], al
  6576                                  
  6577                                  	;;;
  6578                                  	; 19/05/2024 (change PCM out volume)
  6579 00002AE6 3C2B                    	cmp	al, '+'
  6580 00002AE8 750D                    	jne	short p_1
  6581                                  	
  6582 00002AEA A0[3F2B0000]            	mov	al, [volume]
  6583 00002AEF 3C00                    	cmp	al, 0
  6584 00002AF1 7624                    	jna	short p_3
  6585 00002AF3 FEC8                    	dec	al
  6586 00002AF5 EB0F                    	jmp	short p_2
  6587                                  p_1:
  6588 00002AF7 3C2D                    	cmp	al, '-'
  6589 00002AF9 751D                    	jne	short p_4
  6590                                  
  6591 00002AFB A0[3F2B0000]            	mov	al, [volume]
  6592 00002B00 3C1F                    	cmp	al, 31
  6593 00002B02 7313                    	jnb	short p_3
  6594 00002B04 FEC0                    	inc	al
  6595                                  p_2:
  6596 00002B06 A2[3F2B0000]            	mov	[volume], al
  6597                                  	; 29/12/2024
  6598                                  	; 14/11/2024
  6599 00002B0B E844DEFFFF              	call	SetPCMOutVolume
  6600                                  	; 15/11/2024 (QEMU)
  6601                                  	; 07/12/2024
  6602                                  	;call	SetMasterVolume
  6603                                  	;call	UpdateVolume
  6604                                  	;;clc
  6605                                  	;retn
  6606 00002B10 E999010000              	jmp	UpdateVolume
  6607                                  	;mov	ah, al
  6608                                  	;mov    dx, [NAMBAR]
  6609                                    	;;add   dx, CODEC_MASTER_VOL_REG
  6610                                  	;add	dx, CODEC_PCM_OUT_REG
  6611                                  	;out    dx, ax
  6612                                  	;
  6613                                  	;call   delay1_4ms
  6614                                          ;call   delay1_4ms
  6615                                          ;call   delay1_4ms
  6616                                          ;call   delay1_4ms
  6617                                  _cksr:		; 19/05/2024
  6618                                  	; 18/12/2024
  6619 00002B15 31C0                    	xor	eax, eax
  6620                                  	;clc
  6621                                  p_3:
  6622 00002B17 C3                      	retn
  6623                                  p_4:
  6624                                  	; 17/11/2024
  6625 00002B18 80FC01                  	cmp	ah, 01h  ; ESC
  6626 00002B1B 7419                        	je	short p_q
  6627                                  	;cmp	ax, 2E03h ; 21/12/2024 
  6628 00002B1D 3C03                    	cmp	al, 03h  ; CTRL+C
  6629 00002B1F 7415                    	je	short p_q
  6630                                  
  6631                                  	; 18/11/2024
  6632 00002B21 3C20                    	cmp	al, 20h
  6633 00002B23 7419                    	je	short p_r
  6634                                  
  6635                                  	; 19/11/2024
  6636 00002B25 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  6637 00002B27 7415                    	je	short p_r
  6638                                  
  6639 00002B29 24DF                    	and	al, 0DFh
  6640                                  
  6641                                  	; 25/12/2024
  6642                                  	; 29/11/2024
  6643 00002B2B A2[C7840000]            	mov	[command], al
  6644                                  
  6645                                  	;cmp	al, 'B'
  6646                                  	;je	short p_r
  6647                                  	;cmp	al, 'F'
  6648                                  	;je	short p_r
  6649                                  
  6650                                  	; 29/11/2024
  6651                                  	;cmp	al, 'N'
  6652                                  	;je	short p_r
  6653                                  	;cmp	al, 'P'
  6654                                  	;je	short p_r
  6655                                  
  6656 00002B30 3C51                    	cmp	al, 'Q'
  6657                                  	;je	short p_q
  6658 00002B32 7409                    	je	short p_quit ; 29/11/2024
  6659                                  
  6660 00002B34 F8                      	clc
  6661 00002B35 C3                      	retn
  6662                                  
  6663                                  	;;;
  6664                                  ;_cskr:	
  6665                                  p_q:
  6666                                  	; 27/12/2024
  6667 00002B36 C605[C7840000]51        	mov	byte [command], 'Q'
  6668                                  p_quit:
  6669 00002B3D F9                      	stc
  6670                                  p_r:
  6671 00002B3E C3                      	retn
  6672                                  
  6673                                  ; 29/05/2024
  6674                                  ; 19/05/2024
  6675                                  volume: 
  6676                                  	;db	02h
  6677                                  ; 26/12/2024
  6678 00002B3F 03                      	db	03h
  6679                                  
  6680                                  ; --------------------------------------------------------
  6681                                  
  6682                                  	; 22/12/2024
  6683                                  	; 21/12/2024
  6684                                  	; simulate cursor position in VGA (VESA VBE) mode
  6685                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  6686                                  setCursorPosition:
  6687                                  	; dh = Row
  6688                                  	; dl = Column
  6689                                  	
  6690 00002B40 31C0                    	xor	eax, eax
  6691 00002B42 B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  6692 00002B44 F6E6                    	mul	dh
  6693 00002B46 6683C007                	add	ax, 7	; top margin
  6694 00002B4A C1E010                  	shl	eax, 16
  6695 00002B4D 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  6696 00002B4F 66C1E003                	shl	ax, 3
  6697                                  			; hw = row, ax = column
  6698 00002B53 A3[A47A0000]            	mov	[screenpos], eax
  6699                                  	; 22/12/2024
  6700 00002B58 31C0                    	xor	eax, eax
  6701 00002B5A C3                      	retn
  6702                                  	
  6703                                  ; --------------------------------------------------------
  6704                                  ; 14/11/2024
  6705                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  6706                                  
  6707                                  ;; NAME:	SetTotalTime
  6708                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  6709                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  6710                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  6711                                  ;; 		Output on the screen of the total time in seconds
  6712                                  
  6713                                  	; 01/12/2024 (32 bit registers)
  6714                                  SetTotalTime:
  6715                                  	;; Calculate total seconds in file
  6716                                  	;mov	ax, [DATA_SubchunkSize]
  6717                                  	;mov	dx, [DATA_SubchunkSize + 2]
  6718                                  	;mov	bx, [WAVE_SampleRate]
  6719                                  	;div	bx
  6720                                  	;xor	dx, dx
  6721                                  	; 01/12/2024
  6722 00002B5B A1[F4840000]            	mov	eax, [DATA_SubchunkSize]
  6723 00002B60 0FB71D[E4840000]        	movzx	ebx, word [WAVE_SampleRate]
  6724 00002B67 31D2                    	xor	edx, edx
  6725 00002B69 F7F3                    	div	ebx
  6726                                  
  6727                                  	;mov	bx, [WAVE_BlockAlign]
  6728                                  	;div	bx
  6729                                  	; 01/12/2024
  6730 00002B6B 668B1D[EC840000]        	mov	bx, [WAVE_BlockAlign]
  6731 00002B72 31D2                    	xor	edx, edx
  6732 00002B74 F7F3                    	div	ebx
  6733                                  
  6734                                  	;mov	[TotalTime], ax
  6735 00002B76 A3[78850000]            	mov	[TotalTime], eax
  6736                                  
  6737 00002B7B B33C                    	mov	bl, 60
  6738 00002B7D F6F3                    	div	bl
  6739                                  
  6740                                  	;; al = minutes, ah = seconds
  6741 00002B7F 50                      	push	eax ; **
  6742 00002B80 50                      	push	eax ; *
  6743                                  
  6744                                  	;mov	dh, 24
  6745                                  	; 21/12/2024 (640*480)
  6746 00002B81 B620                    	mov	dh, 32
  6747 00002B83 B22A                    	mov	dl, 42
  6748 00002B85 E8B6FFFFFF              	call	setCursorPosition
  6749                                  
  6750 00002B8A 58                      	pop	eax ; *
  6751 00002B8B 30E4                    	xor	ah, ah
  6752 00002B8D BD02000000              	mov	ebp, 2
  6753 00002B92 E812000000              	call	PrintNumber
  6754                                  	
  6755                                  	;mov	dh, 24
  6756                                  	; 21/12/2024 (640*480)
  6757 00002B97 B620                    	mov	dh, 32
  6758 00002B99 B22D                    	mov	dl, 45
  6759 00002B9B E8A0FFFFFF              	call	setCursorPosition
  6760                                  
  6761 00002BA0 58                      	pop	eax ; **
  6762 00002BA1 88E0                    	mov	al, ah
  6763 00002BA3 30E4                    	xor	ah, ah
  6764                                  	; 21/12/2024
  6765 00002BA5 66BD0200                	mov	bp, 2
  6766                                  	;jmp	short PrintNumber
  6767                                  
  6768                                  ; --------------------------------------------------------
  6769                                  
  6770                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  6771                                  	; 01/12/2024 (32bit registers)
  6772                                  PrintNumber:
  6773                                  	; eax = binary number
  6774                                  	; ebp = digits
  6775 00002BA9 8B35[A47A0000]          	mov	esi, [screenpos]
  6776                                  		; hw = row, si = column
  6777 00002BAF BB0A000000              	mov	ebx, 10
  6778 00002BB4 31C9                    	xor	ecx, ecx
  6779                                  printNumber_CutNumber:
  6780 00002BB6 41                      	inc	ecx
  6781 00002BB7 31D2                    	xor	edx, edx
  6782 00002BB9 F7F3                    	div	ebx
  6783 00002BBB 52                      	push	edx
  6784 00002BBC 39E9                    	cmp	ecx, ebp
  6785 00002BBE 7402                    	je	short printNumber_printloop
  6786 00002BC0 EBF4                    	jmp	printNumber_CutNumber
  6787                                  
  6788                                  printNumber_printloop:
  6789 00002BC2 58                      	pop	eax
  6790                                  	; 21/12/2024
  6791                                  	; ebp = count of digits
  6792                                  	; eax <= 9
  6793                                  
  6794 00002BC3 0430                    	add	al, '0'
  6795                                  	
  6796                                  	; esi = pixel position (hw = row, si = column)
  6797                                  	; eax = al = character
  6798                                  	;call	write_character
  6799                                  	; 22/12/2024
  6800 00002BC5 E82A010000              	call	write_character_white
  6801                                  
  6802 00002BCA 4D                      	dec	ebp
  6803 00002BCB 7405                     	jz	short printNumber_ok
  6804 00002BCD 83C608                  	add	esi, 8	; next column
  6805 00002BD0 EBF0                    	jmp	short printNumber_printloop
  6806                                  printNumber_ok:
  6807 00002BD2 C3                      	retn
  6808                                  
  6809                                  ; --------------------------------------------------------
  6810                                  
  6811                                  	; 14/11/2024 - Erdogan Tan
  6812                                  SetProgressTime:
  6813                                  	;; Calculate playing/progress seconds in file
  6814 00002BD3 E835000000              	call	CalcProgressTime
  6815                                  
  6816                                  	; 01/12/2024 (32bit registers)
  6817                                  UpdateProgressTime:
  6818                                  	; eax = (new) progress time 
  6819                                  
  6820 00002BD8 A3[7C850000]            	mov	[ProgressTime], eax
  6821                                  
  6822 00002BDD B33C                    	mov	bl, 60
  6823 00002BDF F6F3                    	div	bl
  6824                                  
  6825                                  	;; al = minutes, ah = seconds
  6826 00002BE1 50                      	push	eax ; **
  6827 00002BE2 50                      	push	eax ; *
  6828                                  
  6829                                  	;mov	dh, 24
  6830                                  	; 21/12/2024 (640*480)
  6831 00002BE3 B620                    	mov	dh, 32
  6832 00002BE5 B221                    	mov	dl, 33
  6833 00002BE7 E854FFFFFF              	call	setCursorPosition
  6834                                  
  6835 00002BEC 58                      	pop	eax ; *
  6836 00002BED 30E4                    	xor	ah, ah
  6837 00002BEF BD02000000              	mov	ebp, 2
  6838 00002BF4 E8B0FFFFFF              	call	PrintNumber
  6839                                  	
  6840                                  	;mov	dh, 24
  6841                                  	; 21/12/2024 (640*480)
  6842 00002BF9 B620                    	mov	dh, 32
  6843 00002BFB B224                    	mov	dl, 36
  6844 00002BFD E83EFFFFFF              	call	setCursorPosition
  6845                                  
  6846 00002C02 58                      	pop	eax ; **
  6847 00002C03 88E0                    	mov	al, ah
  6848 00002C05 30E4                    	xor	ah, ah
  6849                                  	; 21/12/2024
  6850 00002C07 66BD0200                	mov	bp, 2
  6851 00002C0B EB9C                    	jmp	short PrintNumber
  6852                                  
  6853                                  ; --------------------------------------------------------
  6854                                  
  6855                                  	; 01/12/2024 (32bit registers)
  6856                                  	; 17/11/2024
  6857                                  	; 14/11/2024
  6858                                  CalcProgressTime:
  6859                                  	;mov	ax, [LoadedDataBytes]
  6860                                  	;mov	dx, [LoadedDataBytes+2]
  6861                                  	;mov	bx, ax
  6862                                  	;or	bx, dx
  6863                                  	;jz	short cpt_ok
  6864                                  	; 01/12/2024
  6865 00002C0D A1[84850000]            	mov	eax, [LoadedDataBytes]
  6866 00002C12 09C0                    	or	eax, eax
  6867 00002C14 7416                    	jz	short cpt_ok
  6868                                  
  6869                                  	;mov	bx, [WAVE_SampleRate]
  6870                                  	;div	bx
  6871                                  	;xor	dx, dx
  6872                                  	;mov	bx, [WAVE_BlockAlign]
  6873                                  	;div	bx
  6874                                  	; 01/12/2024
  6875 00002C16 0FB71D[E4840000]        	movzx	ebx, word [WAVE_SampleRate]
  6876 00002C1D 31D2                    	xor	edx, edx
  6877 00002C1F F7F3                    	div	ebx
  6878 00002C21 31D2                    	xor	edx, edx
  6879 00002C23 668B1D[EC840000]        	mov	bx, [WAVE_BlockAlign]
  6880 00002C2A F7F3                    	div	ebx
  6881                                  cpt_ok:
  6882                                  	; eax = (new) progress time
  6883 00002C2C C3                      	retn
  6884                                  
  6885                                  ; --------------------------------------------------------
  6886                                  ; 14/11/2024
  6887                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  6888                                  
  6889                                  ;; DESCRIPTION: Update file information on template
  6890                                  ;; PARAMS:	WAVE parameters and other variables
  6891                                  ;; REGS:	AX(RW)
  6892                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  6893                                  ;; RETURNS:	On-screen file info is updated.
  6894                                  
  6895                                  	; 01/12/2024 (32bit registers)
  6896                                  UpdateFileInfo:
  6897                                  	;; Print File Name
  6898                                  	;mov	dh, 9
  6899                                  	; 21/12/2024 (640*480 graphics display)
  6900 00002C2D B608                    	mov	dh, 8
  6901 00002C2F B217                    	mov	dl, 23
  6902 00002C31 E80AFFFFFF              	call	setCursorPosition
  6903                                  	
  6904 00002C36 BE[0C850000]            	mov	esi, wav_file_name
  6905                                  	
  6906                                  	;;;
  6907                                  	; 14/11/2024
  6908                                  	; skip directory separators
  6909                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  6910 00002C3B 89F3                    	mov	ebx, esi
  6911                                  chk4_nxt_sep:
  6912 00002C3D AC                      	lodsb
  6913 00002C3E 3C2F                    	cmp	al, '/'	; 14/12/2024
  6914 00002C40 7406                    	je	short chg_fpos
  6915 00002C42 20C0                    	and	al, al
  6916 00002C44 7406                    	jz	short chg_fpos_ok
  6917 00002C46 EBF5                    	jmp	short chk4_nxt_sep
  6918                                  chg_fpos:
  6919 00002C48 89F3                    	mov	ebx, esi
  6920 00002C4A EBF1                    	jmp	short chk4_nxt_sep
  6921                                  chg_fpos_ok:
  6922 00002C4C 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  6923                                  	;;;
  6924                                  _fnl_chk:
  6925                                  	; 26/12/2024 (file name length limit -display-)
  6926                                  	;mov	ebx, 12
  6927 00002C4E BB11000000              	mov	ebx, 17 ; ????????.wav?????
  6928 00002C53 56                      	push	esi
  6929                                  _fnl_chk_loop:
  6930 00002C54 AC                      	lodsb
  6931 00002C55 20C0                    	and	al, al
  6932 00002C57 7406                    	jz	short _fnl_ok
  6933 00002C59 4B                       	dec	ebx
  6934 00002C5A 75F8                    	jnz	short _fnl_chk_loop
  6935 00002C5C C60600                  	mov	byte [esi], 0
  6936                                  _fnl_ok:
  6937 00002C5F 5E                      	pop	esi
  6938                                  	;;;
  6939                                  
  6940 00002C60 E870000000              	call	PrintString
  6941                                  	
  6942                                  	;; Print Frequency
  6943                                  	;mov	dh, 10
  6944                                  	; 21/12/2024 (640*480 graphics display)
  6945 00002C65 B609                    	mov	dh, 9
  6946 00002C67 B217                    	mov	dl, 23
  6947 00002C69 E8D2FEFFFF              	call	setCursorPosition
  6948                                  	;movzx	eax, word [WAVE_SampleRate]
  6949                                  	; 22/12/2024
  6950                                  	; eax = 0
  6951 00002C6E 66A1[E4840000]          	mov	ax, [WAVE_SampleRate]
  6952 00002C74 BD05000000              	mov	ebp, 5
  6953 00002C79 E82BFFFFFF              	call	PrintNumber
  6954                                  
  6955                                  	;; Print BitRate
  6956                                  	;mov	dh, 9
  6957                                  	; 21/12/2024 (640*480 graphics display)
  6958 00002C7E B608                    	mov	dh, 8
  6959 00002C80 B239                    	mov	dl, 57
  6960 00002C82 E8B9FEFFFF              	call	setCursorPosition
  6961 00002C87 66A1[EE840000]          	mov	ax, [WAVE_BitsPerSample]
  6962 00002C8D 66BD0200                	mov	bp, 2
  6963 00002C91 E813FFFFFF              	call	PrintNumber
  6964                                  
  6965                                  	;; Print Channel Number
  6966                                  	;mov	dh, 10
  6967                                  	; 21/12/2024 (640*480 graphics display)
  6968 00002C96 B609                    	mov	dh, 9
  6969 00002C98 B239                    	mov	dl, 57
  6970 00002C9A E8A1FEFFFF              	call	setCursorPosition
  6971 00002C9F 66A1[E2840000]          	mov	ax, [WAVE_NumChannels]
  6972 00002CA5 66BD0100                	mov	bp, 1
  6973 00002CA9 E8FBFEFFFF              	call	PrintNumber
  6974                                  
  6975                                  	;call	UpdateVolume
  6976                                  	;retn
  6977                                  
  6978                                  ; --------------------------------------------------------
  6979                                  
  6980                                  	; 14/11/2024
  6981                                  UpdateVolume:
  6982                                  	;; Print Volume
  6983                                  	;mov	dh, 24
  6984                                  	; 21/12/2024 (640*480)
  6985 00002CAE B620                    	mov	dh, 32
  6986 00002CB0 B24B                    	mov	dl, 75
  6987 00002CB2 E889FEFFFF              	call	setCursorPosition
  6988                                  	; 22/12/2024
  6989                                  	; eax = 0
  6990                                  
  6991 00002CB7 A0[3F2B0000]            	mov	al, [volume]
  6992                                  
  6993 00002CBC B364                    	mov	bl, 100
  6994 00002CBE F6E3                    	mul	bl
  6995                                  
  6996 00002CC0 B31F                    	mov	bl, 31
  6997 00002CC2 F6F3                    	div	bl
  6998                                  
  6999                                  	;neg	ax
  7000                                  	;add	ax, 100	
  7001                                  	; 01/12/2024
  7002 00002CC4 B464                    	mov	ah, 100
  7003 00002CC6 28C4                    	sub	ah, al
  7004 00002CC8 0FB6C4                  	movzx	eax, ah
  7005                                  	;xor	ah, ah
  7006                                  	;mov	bp, 3
  7007 00002CCB BD03000000              	mov	ebp, 3
  7008                                  	;call	PrintNumber
  7009                                  	;retn
  7010 00002CD0 E9D4FEFFFF              	jmp	PrintNumber	
  7011                                  
  7012                                  ; --------------------------------------------------------
  7013                                  
  7014                                  	; 21/12/2024
  7015                                  	; write text in VESA VBE graphics mode
  7016                                  PrintString:
  7017                                  	; esi = string address
  7018                                  printstr_loop:
  7019 00002CD5 31C0                    	xor	eax, eax
  7020 00002CD7 AC                      	lodsb
  7021 00002CD8 08C0                    	or	al, al
  7022 00002CDA 7417                    	jz	short printstr_ok
  7023                                  
  7024 00002CDC 56                      	push	esi
  7025                                  
  7026 00002CDD 8B35[A47A0000]          	mov	esi, [screenpos]
  7027                                  
  7028                                  	; esi = pixel position (hw = row, si = column)
  7029                                  	; eax = al = character
  7030                                  	;call	write_character
  7031                                  	; 22/12/2024
  7032 00002CE3 E80C000000              	call	write_character_white
  7033                                  
  7034 00002CE8 668305[A47A0000]08      	add	word [screenpos], 8 ; update column (only, not row)
  7035                                  
  7036 00002CF0 5E                      	pop	esi
  7037 00002CF1 EBE2                    	jmp	short printstr_loop
  7038                                  
  7039                                  printstr_ok:
  7040 00002CF3 C3                      	retn
  7041                                  
  7042                                  ; --------------------------------------------------------
  7043                                  
  7044                                  	; 21/12/2024
  7045                                  	; write character (at cursor position)
  7046                                  	; in graphics mode (640*480, 256 colors)
  7047                                  	; 22/12/2024
  7048                                  write_character_white:
  7049 00002CF4 B90F000000              	mov	ecx, 0Fh
  7050                                  	; 26/12/2024
  7051                                  	;movzx	ecx, byte [tcolor]
  7052                                  write_character:
  7053                                  	; esi = pixel position (hw = row, si = column)
  7054                                  	; eax = al = character
  7055                                  	; cl = color
  7056 00002CF9 890D[A87A0000]          	mov	[wcolor], ecx ; 22/12/2024
  7057                                  
  7058                                  	; 22/12/2024
  7059 00002CFF 50                      	push	eax
  7060                                  	; clear previous character pixels
  7061 00002D00 BF[3D470000]            	mov	edi, fillblock
  7062                                  	sys	_video, 020Fh, 0, 8001h
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00002D05 BB0F020000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002D0A B900000000          <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002D0F BA01800000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00002D14 B81F000000          <1>  mov eax, %1
   103                              <1> 
   104 00002D19 CD40                <1>  int 40h
  7063 00002D1B 58                      	pop	eax
  7064                                  
  7065 00002D1C C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  7066 00002D1F BF[58550000]            	mov	edi, fontbuff2 ; start of user font data
  7067 00002D24 01C7                    	add	edi, eax
  7068                                  
  7069                                  	; 21/12/2024
  7070                                  	; NOTE:
  7071                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  7072                                  	; system calls -in graphics mode-
  7073                                  	; because 8*16 pixel operations are faster
  7074                                  	;			than 8*14 pixel operations.
  7075                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  7076                                  	; adding 2 empty lines))
  7077                                  	; (8*14 characters can be written via pixel operations)
  7078                                    	
  7079                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  7080                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  7081                                  	;sysvideo:
  7082                                  	;   function in BH
  7083                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  7084                                  	;   sub function in BL
  7085                                  	;	0Fh: WRITE CHARACTER (FONT)
  7086                                  	;          CL = char's color (8 bit, 256 colors)
  7087                                  	;	If DH bit 7 = 1
  7088                                  	;	   USER FONT (from user buffer)
  7089                                  	;	         DL = 1 -> 8x16 pixel font
  7090                                   	;	   EDI = user's font buffer address
  7091                                  	;		(NOTE: byte order is as row0,row1,row2..)
  7092                                  	;	   ESI = start position (row, column)
  7093                                  	;		(HW = row, SI = column)
  7094                                  	;;;;;;;;;;;;;;;;;
  7095                                  
  7096                                  	sys	_video, 020Fh, [wcolor], 8001h
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00002D26 BB0F020000          <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96 00002D2B 8B0D[A87A0000]      <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98 00002D31 BA01800000          <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00002D36 B81F000000          <1>  mov eax, %1
   103                              <1> 
   104 00002D3B CD40                <1>  int 40h
  7097                                  
  7098 00002D3D C3                      	retn
  7099                                  
  7100                                  ; --------------------------------------------------------
  7101                                  
  7102                                  	; 22/12/2024
  7103                                  	; 21/12/2024
  7104                                  	; (write chars in VESA VBE graphics mode)
  7105                                  	; 14/11/2024
  7106                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  7107                                  	; (Modification: Erdogan Tan, 14/11/2024)
  7108                                  
  7109                                  	;PROGRESSBAR_ROW equ 23
  7110                                  	; 21/12/2024 (640*480)
  7111                                  	PROGRESSBAR_ROW equ 31
  7112                                  
  7113                                  UpdateProgressBar:
  7114 00002D3E E890FEFFFF              	call	SetProgressTime	; 14/11/2024
  7115                                  
  7116                                  	; 01/12/2024 (32bit registers)
  7117 00002D43 A1[7C850000]            	mov	eax, [ProgressTime]
  7118                                  UpdateProgressBar@:
  7119 00002D48 BA50000000              	mov	edx, 80
  7120 00002D4D F7E2                    	mul	edx
  7121 00002D4F 8B1D[78850000]          	mov	ebx, [TotalTime]
  7122 00002D55 F7F3                    	div	ebx
  7123                                  
  7124                                  	; 22/12/2024
  7125                                  	; check progress bar indicator position if it is same 
  7126 00002D57 3A05[AD7A0000]          	cmp	al, [pbprev]
  7127 00002D5D 7430                    	je	short UpdateProgressBar_ok
  7128 00002D5F A2[AD7A0000]            	mov	[pbprev], al
  7129                                  
  7130                                  UpdateProgressBar@@:
  7131                                  	;; Push for the 'Clean' part
  7132 00002D64 50                      	push	eax ; **
  7133 00002D65 50                      	push	eax ; *
  7134                                  
  7135                                  	;; Set cursor position
  7136 00002D66 B61F                    	mov	dh, PROGRESSBAR_ROW
  7137 00002D68 B200                    	mov	dl, 0
  7138 00002D6A E8D1FDFFFF              	call	setCursorPosition
  7139                                  
  7140 00002D6F 58                      	pop	eax ; *
  7141 00002D70 09C0                    	or	eax, eax
  7142 00002D72 742D                    	jz	short UpdateProgressBar_Clean
  7143                                  
  7144                                  UpdateProgressBar_DrawProgress:
  7145                                  	; 22/12/2024
  7146                                  	; 21/12/2024
  7147                                  	; (write progress bar chars in graphics mode)
  7148                                  	;;;;
  7149 00002D74 89C5                    	mov	ebp, eax
  7150 00002D76 50                      	push	eax ; ***
  7151 00002D77 8B35[A47A0000]          	mov	esi, [screenpos]
  7152                                  UpdateProgressBar_DrawProgress_@:
  7153 00002D7D B8DF000000              	mov	eax, 223
  7154                                  	
  7155                                  	; esi = pixel position (hw = row, si = column)
  7156                                  	; eax = al = character
  7157                                  	;call	write_character
  7158                                  	; 22/12/2024
  7159 00002D82 E86DFFFFFF              	call	write_character_white
  7160                                  
  7161 00002D87 4D                      	dec	ebp
  7162 00002D88 7406                    	jz	short UpdateProgressBar_DrawCursor
  7163                                  
  7164 00002D8A 83C608                  	add	esi, 8 ; next column
  7165 00002D8D EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  7166                                  	;;;
  7167                                  
  7168                                  UpdateProgressBar_ok:
  7169 00002D8F C3                      	retn
  7170                                  
  7171                                  UpdateProgressBar_DrawCursor:
  7172                                  	; 22/12/2024
  7173 00002D90 5A                      	pop	edx ; ***
  7174 00002D91 B61F                    	mov	dh, PROGRESSBAR_ROW
  7175 00002D93 E8A8FDFFFF              	call	setCursorPosition
  7176                                  
  7177                                  	; 21/12/2024
  7178                                  	; (write progress bar character in graphics mode)
  7179                                  	;;;;
  7180                                  	;;;mov	eax, 223
  7181                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  7182                                  	;;mov	eax, 223*16
  7183                                  	;;mov	edi, fontbuff2 ; start of user font data
  7184                                  	;;add	edi, eax
  7185                                  	;mov	edi, fontbuff2+(223*16)
  7186                                  	;
  7187                                  	;sys	_video, 020Fh, 0Ch, 8001h
  7188                                  	; 22/12/2024
  7189                                  	;mov	eax, 223
  7190                                  	; eax = 0
  7191 00002D98 B0DF                    	mov	al, 223
  7192 00002D9A B10C                    	mov	cl, 0Ch ; red
  7193 00002D9C E858FFFFFF              	call	write_character
  7194                                  	;;;;
  7195                                  
  7196                                  UpdateProgressBar_Clean:
  7197                                  	;pop	eax  ; **
  7198                                  	; 22/12/2024
  7199 00002DA1 5A                      	pop	edx  ; **
  7200                                  	; 21/12/2024
  7201 00002DA2 BD50000000              	mov	ebp, 80
  7202                                  	;sub	bp, ax
  7203 00002DA7 6629D5                  	sub	bp, dx ; 22/12/2024
  7204 00002DAA 74E3                    	jz	short UpdateProgressBar_ok
  7205                                  
  7206 00002DAC B61F                    	mov	dh, PROGRESSBAR_ROW
  7207                                  	;mov	dl, al ; 22/12/2024
  7208 00002DAE E88DFDFFFF              	call	setCursorPosition
  7209                                  
  7210                                  	; 21/12/2024
  7211                                  	; (write progress bar chars in graphics mode)
  7212                                  	;;;;
  7213 00002DB3 8B35[A47A0000]          	mov	esi, [screenpos]
  7214                                  UpdateProgressBar_Clean_@:
  7215                                  	;;;mov	eax, 223
  7216                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  7217                                  	;;mov	eax, 223*16
  7218                                  	;mov	edi, fontbuff2 ; start of user font data
  7219                                  	;add	edi, eax
  7220                                  	;mov	edi, fontbuff2+(223*16)
  7221                                  	;
  7222                                  	;sys	_video, 020Fh, 08h, 8001h
  7223                                  	; 22/12/2024
  7224                                  	;mov	eax, 223
  7225                                  	; eax = 0
  7226 00002DB9 B0DF                    	mov	al, 223
  7227 00002DBB B108                    	mov	cl, 08h ; gray (dark)
  7228 00002DBD E837FFFFFF              	call	write_character
  7229                                  	;;;;
  7230                                  
  7231 00002DC2 4D                      	dec	ebp
  7232 00002DC3 74CA                    	jz	short UpdateProgressBar_ok
  7233                                  
  7234 00002DC5 83C608                  	add	esi, 8 ; next column
  7235 00002DC8 EBEF                    	jmp	short UpdateProgressBar_Clean_@
  7236                                  	;;;;
  7237                                  
  7238                                  ; --------------------------------------------------------
  7239                                  ; 17/11/2024
  7240                                  
  7241                                  Player_ProcessKey_Backwards:
  7242                                  	;; In order to go backwards 5 seconds:
  7243                                  	;; Update file pointer to the beginning, skip headers
  7244 00002DCA B142                    	mov	cl, 'B'
  7245 00002DCC EB02                    	jmp	short Player_ProcessKey_B_or_F
  7246                                  
  7247                                  Player_ProcessKey_Forwards:
  7248                                  	;; In order to fast-forward 5 seconds, set the file pointer
  7249                                  	;; to CUR_SEEK + 5 * Freq
  7250                                  
  7251 00002DCE B146                    	mov	cl, 'F'
  7252                                  	;jmp	short Player_ProcessKey_B_or_F
  7253                                  
  7254                                  	; 01/12/2024 (32bit regsisters)
  7255                                  Player_ProcessKey_B_or_F:
  7256                                  	; 17/11/2024
  7257                                  	; 04/11/2024
  7258                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  7259                                    
  7260                                  	; 04/11/2024
  7261 00002DD0 B805000000              	mov	eax, 5
  7262 00002DD5 0FB71D[EC840000]        	movzx	ebx, word [WAVE_BlockAlign]
  7263 00002DDC F7E3                    	mul	ebx
  7264 00002DDE 668B1D[E4840000]        	mov	bx, [WAVE_SampleRate]
  7265 00002DE5 F7E3                    	mul	ebx
  7266                                  	; eax = transfer byte count for 5 seconds
  7267                                  	
  7268                                  	; 17/11/2024
  7269 00002DE7 80F942                  	cmp	cl, 'B'
  7270                                  	;mov	bx, [LoadedDataBytes]
  7271                                  	;mov	cx, [LoadedDataBytes+2]
  7272                                  	; 01/12/2024
  7273 00002DEA 8B0D[84850000]          	mov	ecx, [LoadedDataBytes]
  7274 00002DF0 7508                    	jne	short move_forward ; cl = 'F'
  7275                                  move_backward:
  7276                                  	;sub	bx, ax
  7277                                  	;sbb	cx, dx
  7278 00002DF2 29C1                    	sub	ecx, eax
  7279 00002DF4 7316                    	jnc	short move_file_pointer
  7280                                  move_to_beginning:
  7281                                  	;xor	cx, cx ; 0
  7282                                  	;xor	bx, bx ; 0
  7283 00002DF6 31C9                    	xor	ecx, ecx
  7284 00002DF8 EB12                    	jmp	short move_file_pointer
  7285                                  move_forward: 
  7286                                  	;add	bx, ax
  7287                                  	;adc	cx, dx
  7288 00002DFA 01C1                    	add	ecx, eax
  7289 00002DFC 7208                    	jc	short move_to_end
  7290                                  	;cmp	cx, [DATA_SubchunkSize+2]
  7291                                  	;ja	short move_to_end
  7292                                  	;jb	short move_file_pointer
  7293                                  	;cmp	bx, [DATA_SubchunkSize]
  7294                                  	;jna	short move_file_pointer
  7295 00002DFE 3B0D[F4840000]          	cmp	ecx, [DATA_SubchunkSize]
  7296 00002E04 7606                    	jna	short move_file_pointer
  7297                                  move_to_end:
  7298                                  	;mov	bx, [DATA_SubchunkSize]
  7299                                  	;mov	cx, [DATA_SubchunkSize+2]
  7300 00002E06 8B0D[F4840000]          	mov	ecx, [DATA_SubchunkSize]
  7301                                  move_file_pointer:
  7302                                  	;mov	dx, bx    
  7303                                  	;mov	[LoadedDataBytes], dx
  7304                                  	;mov	[LoadedDataBytes+2], cx
  7305 00002E0C 890D[84850000]          	mov	[LoadedDataBytes], ecx
  7306                                  	;add	dx, 44 ; + header
  7307                                  	;adc	cx, 0
  7308 00002E12 83C12C                  	add	ecx, 44 
  7309                                  
  7310                                  	; seek
  7311                                  	;mov	bx, [filehandle]
  7312                                  	;mov	ax, 4200h
  7313                                  	;int	21h
  7314                                  	; 01/12/2024
  7315 00002E15 31D2                    	xor	edx, edx ; offset from beginning of the file
  7316                                  	; ecx = offset	
  7317                                  	; ebx = file handle
  7318                                  	; edx = 0
  7319                                  	sys	_seek, [filehandle]
    89                              <1> 
    90                              <1> 
    91                              <1> 
    92                              <1> 
    93                              <1>  %if %0 >= 2
    94 00002E17 8B1D[FC840000]      <1>  mov ebx, %2
    95                              <1>  %if %0 >= 3
    96                              <1>  mov ecx, %3
    97                              <1>  %if %0 = 4
    98                              <1>  mov edx, %4
    99                              <1>  %endif
   100                              <1>  %endif
   101                              <1>  %endif
   102 00002E1D B813000000          <1>  mov eax, %1
   103                              <1> 
   104 00002E22 CD40                <1>  int 40h
  7320 00002E24 C3                      	retn
  7321                                  
  7322                                  ; --------------------------------------------------------
  7323                                  
  7324                                  	; 25/12/2024
  7325                                  	; 22/12/2024 (VESA VBE mode graphics) 
  7326                                  	; (640*480, 256 colors)
  7327                                  clear_window:
  7328 00002E25 8B3D[A07A0000]          	mov	edi, [LFB_ADDR]
  7329                                  	;add	edi, (13*80*8*14)
  7330                                  	; 25/12/2024
  7331 00002E2B 81C7009A0100            	add	edi, 164*640
  7332 00002E31 29C0                    	sub	eax, eax
  7333                                  	;mov	ecx, (16*640*14)/4 ; 16 rows
  7334 00002E33 B900A00000              	mov	ecx, 64*640 ; 256 volume level points
  7335 00002E38 F3AB                    	rep	stosd
  7336                                  	; 24/12/2024
  7337 00002E3A A3[B47A0000]            	mov	[prev_points], eax ; 0
  7338                                  	;
  7339 00002E3F C3                      	retn
  7340                                  
  7341                                  ; --------------------------------------------------------
  7342                                  
  7343                                  	; 22/12/2024
  7344                                  	; 21/12/2024
  7345                                  	; (simulate wave leds in graphics mode)
  7346                                  	; (640*480, 256 colors)
  7347                                  reset_wave_leds:
  7348                                  	; 22/12/2024
  7349 00002E40 C705[58790000]0000-     	mov	dword [prev_leds], 0
  7349 00002E48 0000               
  7350                                  	;
  7351 00002E4A BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  7352 00002E4F BE[58650000]            	mov	esi, wleds_addr
  7353                                  next_led:
  7354 00002E54 AD                      	lodsd
  7355 00002E55 89C7                    	mov	edi, eax
  7356 00002E57 BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  7357 00002E5C BB[38650000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  7358                                  led_line:
  7359 00002E61 8A23                    	mov	ah, [ebx]
  7360 00002E63 B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  7361                                  next_pixel:
  7362 00002E68 D0E4                    	shl	ah, 1
  7363 00002E6A 7308                    	jnc	short skip_this
  7364 00002E6C B008                    	mov	al, 8 ; gray
  7365 00002E6E AA                      	stosb
  7366 00002E6F 49                      	dec	ecx
  7367 00002E70 75F6                    	jnz	short next_pixel
  7368 00002E72 EB06                    	jmp	short next_line
  7369                                  skip_this:
  7370 00002E74 B000                    	mov	al, 0 ; black
  7371 00002E76 AA                      	stosb
  7372 00002E77 49                      	dec	ecx
  7373 00002E78 75EE                    	jnz	short next_pixel
  7374                                  next_line:
  7375 00002E7A 4A                      	dec	edx
  7376 00002E7B 7504                    	jnz	short next_line_@
  7377 00002E7D 4D                      	dec	ebp
  7378 00002E7E 75D4                    	jnz	short next_led
  7379                                  	;clc	; 25/12/2024
  7380 00002E80 C3                      	retn
  7381                                  next_line_@:
  7382                                  	; 22/12/2024
  7383 00002E81 81C778020000            	add	edi, 640-8 ; next line
  7384 00002E87 43                      	inc	ebx
  7385 00002E88 EBD7                    	jmp	short led_line	
  7386                                  
  7387                                  ; --------------------------------------------------------
  7388                                  
  7389                                  	; 22/12/2024 (graphics mode)
  7390                                  	; 09/12/2024
  7391                                  	; 19/11/2024
  7392                                  UpdateWaveLeds:
  7393                                  	; 23/11/2024
  7394                                  	;call	reset_wave_leds
  7395                                  	; 22/12/2024 (faster method, 80 against 80*16)
  7396                                  	; turn off previously lighting wave leds at first
  7397                                  	;;;
  7398 00002E8A BE[58790000]            	mov	esi, prev_leds
  7399 00002E8F 833E00                  	cmp	dword [esi], 0
  7400 00002E92 7433                    	jz	short UpdateWaveLeds_ok
  7401 00002E94 B950000000              	mov	ecx, 80
  7402                                  turn_off_led:
  7403 00002E99 AD                      	lodsd
  7404 00002E9A 89C7                    	mov	edi, eax
  7405                                  	; edi = wave led address
  7406 00002E9C BD0E000000              	mov	ebp, 14
  7407 00002EA1 BB[38650000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  7408 00002EA6 31D2                    	xor	edx, edx
  7409 00002EA8 B008                    	mov	al, 8 ; gray (dark)
  7410                                  toffl_next_line:
  7411                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  7412                                  	;mov	dl, 8
  7413 00002EAA 88C2                    	mov	dl, al ; 8
  7414 00002EAC 8A23                    	mov	ah, [ebx]
  7415                                  toffl_next_pixel:
  7416 00002EAE D0E4                    	shl	ah, 1
  7417 00002EB0 7310                    	jnc	short toffl_skip_this
  7418 00002EB2 AA                      	stosb
  7419                                  toffl_next_pixel_@:
  7420 00002EB3 4A                      	dec	edx
  7421 00002EB4 75F8                    	jnz	short toffl_next_pixel
  7422 00002EB6 4D                      	dec	ebp
  7423 00002EB7 740C                    	jz	short toffl_next_led
  7424 00002EB9 81C778020000            	add	edi, 640-8 ; next line
  7425 00002EBF 43                      	inc	ebx
  7426 00002EC0 EBE8                    	jmp	short toffl_next_line
  7427                                  toffl_skip_this:
  7428 00002EC2 47                      	inc	edi
  7429 00002EC3 EBEE                    	jmp	short toffl_next_pixel_@
  7430                                  toffl_next_led:
  7431 00002EC5 E2D2                    	loop	turn_off_led
  7432                                  UpdateWaveLeds_ok:
  7433                                  	;;;
  7434                                  	; 09/12/2024
  7435                                  	;jmp	short turn_on_leds
  7436                                  
  7437                                  ; --------------------------------------------------------
  7438                                  
  7439                                  	; 29/12/2024
  7440                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  7441                                  	; 09/12/2024
  7442                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  7443                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  7444                                  	; 21/11/2024, 22/11/2024
  7445                                  	; 19/11/2024
  7446                                  turn_on_leds:
  7447                                  	; 29/12/2024
  7448 00002EC7 803D[B5840000]32        	cmp	byte [tLO],'2'
  7449 00002ECE 7509                    	jne	short tol_buffer_1
  7450                                  tol_buffer_2:
  7451 00002ED0 BA[00A00100]            	mov	edx, WAVBUFFER_2
  7452 00002ED5 EB10                    	jmp	short tol_@
  7453                                  
  7454                                  	; 29/12/2024
  7455                                  tol_clc_retn:
  7456 00002ED7 F8                      	clc
  7457                                  tol_retn:
  7458 00002ED8 C3                      	retn
  7459                                  
  7460                                  tol_buffer_1:
  7461                                  	; 29/12/2024
  7462 00002ED9 803D[B5840000]31        	cmp	byte [tLO],'1'
  7463 00002EE0 75F5                    	jne	short tol_clc_retn
  7464                                  
  7465 00002EE2 BA[00A00000]            	mov	edx, WAVBUFFER_1
  7466                                  tol_@:
  7467                                  	; calculate differential
  7468                                  	; 29/12/2024
  7469 00002EE7 3915[C0840000]          	cmp	[pbuf_s], edx
  7470 00002EED 7520                    	jne	short tol_ns_buf
  7471 00002EEF 8B1D[B8840000]          	mov	ebx, [wleds_dif]
  7472 00002EF5 8B35[BC840000]          	mov	esi, [pbuf_o]
  7473 00002EFB 8B0D[74850000]          	mov	ecx, [buffersize] ; bytes
  7474 00002F01 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  7475 00002F03 01DE                    	add	esi, ebx
  7476 00002F05 7204                    	jc	short tol_o_@
  7477 00002F07 39CE                    	cmp	esi, ecx
  7478 00002F09 760C                    	jna	short tol_s_buf
  7479                                  tol_o_@:
  7480 00002F0B 89CE                    	mov	esi, ecx
  7481 00002F0D EB08                    	jmp	short tol_s_buf
  7482                                  
  7483                                  tol_ns_buf:
  7484                                  	; 29/12/2024
  7485 00002F0F 8915[C0840000]          	mov	[pbuf_s], edx
  7486 00002F15 31F6                    	xor	esi, esi ; 0
  7487                                  tol_s_buf:
  7488 00002F17 8935[BC840000]          	mov	[pbuf_o], esi
  7489                                  
  7490                                  tol_buf_@:
  7491                                  	; 29/12/2024
  7492 00002F1D 01D6                    	add	esi, edx ; [pbuf_s]
  7493 00002F1F B950000000              	mov	ecx, 80
  7494                                  	;xor	eax, eax ; 0
  7495 00002F24 BB[58650000]            	mov	ebx, wleds_addr
  7496                                  	; 22/12/2024
  7497 00002F29 BF[58790000]            	mov	edi, prev_leds
  7498                                  tol_fill_c:
  7499 00002F2E 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  7500 00002F30 66AD                    	lodsw	; left
  7501 00002F32 80C480                  	add	ah, 80h	; 24/12/2024
  7502 00002F35 89C2                    	mov	edx, eax
  7503 00002F37 66AD                    	lodsw	; right
  7504                                  	;add	ax, dx
  7505 00002F39 80C480                  	add	ah, 80h
  7506                                  	;; 21/12/2024 (16 volume levels)
  7507                                  	;shr	eax, 12
  7508                                  	; 24/12/2024
  7509 00002F3C 01D0                    	add	eax, edx
  7510 00002F3E C1E80D                  	shr	eax, 13	; (L+R/2) & 16 volume levels
  7511                                  
  7512 00002F41 53                      	push	ebx ; *
  7513                                  	; 01/12/2024
  7514 00002F42 C1E002                  	shl	eax, 2
  7515 00002F45 01C3                    	add	ebx, eax
  7516                                  	; 01/12/2024 (32bit address)
  7517                                  	;mov	edi, [ebx]
  7518                                  	; 22/12/2024
  7519 00002F47 8B03                    	mov	eax, [ebx]
  7520 00002F49 AB                      	stosd
  7521 00002F4A 57                      	push	edi ; **
  7522 00002F4B 89C7                    	mov	edi, eax
  7523                                  	;;;
  7524                                  	; 21/12/2024
  7525                                  	; (simulate wave leds in graphics mode)
  7526                                  	; (640*480, 256 colors)
  7527                                  turn_on_led:
  7528                                  	; edi = wave led address
  7529 00002F4D BD0E000000              	mov	ebp, 14
  7530 00002F52 BB[38650000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  7531 00002F57 A0[55470000]            	mov	al, [ccolor]
  7532                                  tol_next_line:
  7533 00002F5C BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  7534 00002F61 8A23                    	mov	ah, [ebx]
  7535                                  tol_next_pixel:
  7536 00002F63 D0E4                    	shl	ah, 1
  7537 00002F65 7310                    	jnc	short tol_skip_this
  7538 00002F67 AA                      	stosb
  7539                                  tol_next_pixel_@:
  7540 00002F68 4A                      	dec	edx
  7541 00002F69 75F8                    	jnz	short tol_next_pixel
  7542 00002F6B 4D                      	dec	ebp
  7543 00002F6C 740C                    	jz	short tol_next_led
  7544                                  	; 22/12/2024
  7545 00002F6E 81C778020000            	add	edi, 640-8 ; next line
  7546 00002F74 43                      	inc	ebx
  7547 00002F75 EBE5                    	jmp	short tol_next_line
  7548                                  tol_skip_this:
  7549 00002F77 47                      	inc	edi
  7550 00002F78 EBEE                    	jmp	short tol_next_pixel_@
  7551                                  tol_next_led:
  7552                                  	; 22/12/2024
  7553 00002F7A 5F                      	pop	edi ; **
  7554                                  	;;;
  7555 00002F7B 5B                      	pop	ebx ; *
  7556 00002F7C 83C340                  	add	ebx, 16*4
  7557 00002F7F E2AD                    	loop	tol_fill_c
  7558                                  
  7559 00002F81 C3                      	retn
  7560                                  
  7561                                  ; -------------------------------------------------------------
  7562                                  
  7563                                  ; -------------------------------------------------------------
  7564                                  ; ac97.inc (11/11/2023)
  7565                                  ; -------------------------------------------------------------
  7566                                  
  7567                                  ; special characters
  7568                                  LF      EQU 10
  7569                                  CR      EQU 13
  7570                                  
  7571                                  ; PCI stuff
  7572                                  
  7573                                  BIT0  EQU 1
  7574                                  BIT1  EQU 2
  7575                                  BIT2  EQU 4
  7576                                  BIT8  EQU 100h
  7577                                  BIT9  EQU 200h
  7578                                  BIT28 EQU 10000000h
  7579                                  BIT30 EQU 40000000h
  7580                                  BIT31 EQU 80000000h
  7581                                  
  7582                                  BUP		equ	BIT30		; Buffer Underrun Policy.
  7583                                  					; if this buffer is the last buffer
  7584                                  					; in a playback, fill the remaining
  7585                                  					; samples with 0 (silence) or not.
  7586                                  					; It's a good idea to set this to 1
  7587                                  					; for the last buffer in playback,
  7588                                  					; otherwise you're likely to get a lot
  7589                                  					; of noise at the end of the sound.
  7590                                  
  7591                                  RR		equ	BIT1		; reset registers. Nukes all regs
  7592                                                                          ; except bits 4:2 of this register.
  7593                                                                          ; Only set this bit if BIT 0 is 0
  7594                                  RPBM		equ	BIT0		; Run/Pause
  7595                                  					; set this bit to start the codec!
  7596                                  IO_ENA		EQU	BIT0		; i/o decode enable
  7597                                  BM_ENA		EQU	BIT2		; bus master enable
  7598                                  
  7599                                  PCI_INDEX_PORT  EQU     0CF8h
  7600                                  PCI_DATA_PORT   EQU     0CFCh
  7601                                  PCI32           EQU     BIT31           ; bitflag to signal 32bit access
  7602                                  PCI16           EQU     BIT30           ; bitflag for 16bit access
  7603                                  
  7604                                  AC97_INT_LINE	equ	3Ch		; AC97 Interrupt Line register offset
  7605                                  
  7606                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  7607                                  
  7608                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  7609                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  7610                                  SIS_VID		equ	1039h
  7611                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  7612                                  AMD_VID		equ	1022h
  7613                                  
  7614                                  ICH_DID         equ     2415h           ; ICH device ID
  7615                                  ICH0_DID        equ     2425h           ; ICH0
  7616                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  7617                                                                          ; they all should be compatible.
  7618                                  
  7619                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  7620                                  ICH3_DID	equ     2485h           ; ICH3
  7621                                  ICH4_DID        equ     24C5h           ; ICH4
  7622                                  ICH5_DID	equ     24D5h           ; ICH5
  7623                                  ICH6_DID	equ     266Eh           ; ICH6
  7624                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  7625                                  ESB631X_DID	equ     2698h           ; 631XESB
  7626                                  ICH7_DID	equ	27DEh		; ICH7
  7627                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  7628                                  MX82440_DID	equ	7195h
  7629                                  SI7012_DID	equ	7012h
  7630                                  NFORCE_DID	equ	01B1h
  7631                                  NFORCE2_DID	equ	006Ah
  7632                                  AMD8111_DID	equ	746Dh
  7633                                  AMD768_DID	equ	7445h
  7634                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  7635                                  CK804_DID	equ	0059h
  7636                                  MCP04_DID	equ	003Ah
  7637                                  CK8_DID		equ	008Ah
  7638                                  NFORCE3_DID	equ	00DAh
  7639                                  CK8S_DID	equ	00EAh
  7640                                  
  7641                                  NAMBAR_REG	equ	10h		; native audio mixer BAR
  7642                                  NABMBAR_REG	equ	14h		; native audio bus mastering BAR
  7643                                  
  7644                                  CODEC_MASTER_VOL_REG	equ	02h	; master volume
  7645                                  CODEC_MASTER_TONE_REG	equ	08h	; master tone (R+L)
  7646                                  CODEC_PCM_OUT_REG 	equ	18h     ; PCM output volume
  7647                                  CODEC_EXT_AUDIO_REG	equ	28h	; extended audio
  7648                                  CODEC_EXT_AUDIO_CTRL_REG equ	2Ah	; extended audio control
  7649                                  CODEC_PCM_FRONT_DACRATE_REG equ	2Ch	; PCM out sample rate
  7650                                  
  7651                                  ; ICH supports 3 different types of register sets for three types of things
  7652                                  ; it can do, thus:
  7653                                  ;
  7654                                  ; PCM in (for recording) aka PI
  7655                                  ; PCM out (for playback) aka PO
  7656                                  ; MIC in (for recording) aka MC
  7657                                  
  7658                                  PI_BDBAR_REG	equ	0		; PCM in buffer descriptor BAR
  7659                                  PO_BDBAR_REG	equ	10h		; PCM out buffer descriptor BAR
  7660                                  
  7661                                  GLOB_CNT_REG	equ	2Ch		; Global control register
  7662                                  GLOB_STS_REG 	equ	30h		; Global Status register (RO)
  7663                                  
  7664                                  PI_CR_REG 	equ	0Bh		; PCM in Control Register
  7665                                  PO_CR_REG	equ	1Bh		; PCM out Control Register
  7666                                  MC_CR_REG	equ	2Bh		; MIC in Control Register
  7667                                  
  7668                                  PCI_CMD_REG	EQU	04h		; reg 04h, command register
  7669                                  
  7670                                  CTRL_ST_CREADY		equ	BIT8+BIT9+BIT28 ; Primary Codec Ready
  7671                                  CODEC_REG_POWERDOWN	equ	26h
  7672                                  
  7673                                  PO_CIV_REG	equ	14h		; PCM out current Index value (RO)
  7674                                  PO_LVI_REG	equ	15h		; PCM out Last Valid Index
  7675                                  PO_SR_REG	equ	16h		; PCM out Status register
  7676                                  
  7677                                  ; -------------------------------------------------------------
  7678                                  
  7679                                  ; 22/12/2024
  7680 00002F82 90<rep 2h>              align 4
  7681                                  
  7682                                  ; 13/11/2024
  7683                                  ; ('<<' to 'shl' conversion for FASM)
  7684                                  ;
  7685                                  ; 29/05/2024 (TRDOS 386)
  7686                                  ; 17/02/2017
  7687                                  ; Valid ICH device IDs
  7688                                  
  7689                                  valid_ids:
  7690                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  7691 00002F84 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  7692 00002F88 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  7693 00002F8C 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  7694 00002F90 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  7695 00002F94 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  7696 00002F98 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  7697 00002F9C 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  7698 00002FA0 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  7699 00002FA4 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  7700 00002FA8 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  7701                                  	; 03/11/2023 - Erdogan Tan
  7702 00002FAC 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  7703 00002FB0 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  7704 00002FB4 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  7705 00002FB8 DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  7706 00002FBC 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  7707 00002FC0 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  7708 00002FC4 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  7709 00002FC8 DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  7710 00002FCC DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  7711 00002FD0 DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  7712 00002FD4 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  7713                                  
  7714                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  7715                                  ; 13/11/2024
  7716                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  7717                                  
  7718 00002FD8 00000000                	dd 0
  7719                                  
  7720                                  Credits:
  7721 00002FDC 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  7721 00002FE5 6C6179657220666F72-
  7721 00002FEE 205452444F53203338-
  7721 00002FF7 36206279204572646F-
  7721 00003000 67616E2054616E2E20 
  7722                                  	;db 'December 2024.', 10,13,0
  7723 00003009 4A616E756172792032-     	db 'January 2025.', 10,13,0
  7723 00003012 3032352E0A0D00     
  7724                                  	;db '30/12/2024', 10,13
  7725 00003019 31382F30312F323032-     	db '18/01/2025', 10,13
  7725 00003022 350A0D             
  7726                                  ; 15/11/2024
  7727                                  reset:
  7728 00003025 00                      	db 0
  7729                                  
  7730                                  msgAudioCardInfo:
  7731 00003026 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  7731 0000302F 204143393720284943-
  7731 00003038 482920417564696F20-
  7731 00003041 436F6E74726F6C6C65-
  7731 0000304A 722E0A0D00         
  7732                                  
  7733                                  	; 27/12/2024
  7734                                  msg_usage:
  7735 0000304F 75736167653A205647-     	db 'usage: VGAPLAY3 <FileName1> <FileName2> <...>',10,13,0
  7735 00003058 41504C415933203C46-
  7735 00003061 696C654E616D65313E-
  7735 0000306A 203C46696C654E616D-
  7735 00003073 65323E203C2E2E2E3E-
  7735 0000307C 0A0D00             
  7736                                  
  7737                                  noDevMsg:
  7738 0000307F 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  7738 00003088 61626C6520746F2066-
  7738 00003091 696E64204143393720-
  7738 0000309A 617564696F20646576-
  7738 000030A3 69636521           
  7739 000030A7 0A0D00                  	db 10,13,0
  7740                                  
  7741                                  noFileErrMsg:
  7742 000030AA 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  7742 000030B3 6C65206E6F7420666F-
  7742 000030BC 756E642E0A0D00     
  7743                                  
  7744                                  ; 07/12/2024
  7745                                  trdos386_err_msg:
  7746 000030C3 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  7746 000030CC 2053797374656D2063-
  7746 000030D5 616C6C206572726F72-
  7746 000030DE 20210A0D00         
  7747                                  
  7748                                  ; 29/05/2024
  7749                                  ; 11/11/2023
  7750                                  msg_init_err:
  7751 000030E3 0D0A                    	db CR, LF
  7752 000030E5 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  7752 000030EE 726F6C6C65722F436F-
  7752 000030F7 64656320696E697469-
  7752 00003100 616C697A6174696F6E-
  7752 00003109 206572726F722021   
  7753 00003111 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  7754                                  
  7755                                  ; 25/11/2023
  7756                                  msg_no_vra:
  7757 00003114 0A0D                    	db 10,13
  7758 00003116 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  7758 0000311F 70706F72742021204F-
  7758 00003128 6E6C79203438206B48-
  7758 00003131 5A2073616D706C6520-
  7758 0000313A 726174652073757070-
  7758 00003143 6F727465642021     
  7759 0000314A 0A0D00                  	db 10,13,0
  7760                                  
  7761                                  ; 19/11/2024
  7762                                  ; 03/06/2017
  7763                                  hex_chars:
  7764 0000314D 303132333435363738-     	db '0123456789ABCDEF', 0
  7764 00003156 3941424344454600   
  7765                                  msgAC97Info:
  7766 0000315E 0D0A                    	db 0Dh, 0Ah
  7767 00003160 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  7767 00003169 696F20436F6E74726F-
  7767 00003172 6C6C6572202620436F-
  7767 0000317B 64656320496E666F0D-
  7767 00003184 0A                 
  7768 00003185 2056656E646F722049-     	db ' Vendor ID: '
  7768 0000318E 443A20             
  7769                                  msgVendorId:
  7770 00003191 303030306820446576-     	db '0000h Device ID: '
  7770 0000319A 6963652049443A20   
  7771                                  msgDevId:
  7772 000031A2 30303030680D0A          	db '0000h', 0Dh, 0Ah
  7773 000031A9 204275733A20            	db ' Bus: '
  7774                                  msgBusNo:
  7775 000031AF 303068204465766963-     	db '00h Device: '
  7775 000031B8 653A20             
  7776                                  msgDevNo:
  7777 000031BB 3030682046756E6374-     	db '00h Function: '
  7777 000031C4 696F6E3A20         
  7778                                  msgFncNo:
  7779 000031C9 303068                  	db '00h'
  7780 000031CC 0D0A                    	db 0Dh, 0Ah
  7781 000031CE 204E414D4241523A20      	db ' NAMBAR: '
  7782                                  msgNamBar:
  7783 000031D7 30303030682020          	db '0000h  '
  7784 000031DE 4E41424D4241523A20      	db 'NABMBAR: '
  7785                                  msgNabmBar:
  7786 000031E7 303030306820204952-     	db '0000h  IRQ: '
  7786 000031F0 513A20             
  7787                                  msgIRQ:
  7788 000031F3 3030                    	dw 3030h
  7789 000031F5 0D0A00                  	db 0Dh, 0Ah, 0
  7790                                  ; 25/11/2023
  7791                                  msgVRAheader:
  7792 000031F8 205652412073757070-     	db ' VRA support: '
  7792 00003201 6F72743A20         
  7793 00003206 00                      	db 0	
  7794                                  msgVRAyes:
  7795 00003207 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  7796                                  msgVRAno:
  7797 0000320D 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  7798 00003212 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  7798 0000321B 6C617465642073616D-
  7798 00003224 706C65207261746520-
  7798 0000322D 706C6179696E67206D-
  7798 00003236 6574686F6429       
  7799 0000323C 0D0A00                  	db 0Dh, 0Ah, 0
  7800                                  
  7801 0000323F 90                      align 4
  7802                                  
  7803                                  ; -------------------------------------------------------------
  7804                                  
  7805                                  	; 21/12/2024
  7806                                  SplashScreen:
  7807 00003240 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7807 00003249 202020202020202020-
  7807 00003252 202020202020202020-
  7807 0000325B 202020202020202020-
  7807 00003264 202020202020202020-
  7807 0000326D 202020202020202020-
  7807 00003276 202020202020202020-
  7807 0000327F 202020202020202020-
  7807 00003288 2020202020DDDBDE   
  7808 00003290 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7808 00003299 202020202020202020-
  7808 000032A2 202020202020202020-
  7808 000032AB 202020202020202020-
  7808 000032B4 202020202020202020-
  7808 000032BD 202020202020202020-
  7808 000032C6 202020202020202020-
  7808 000032CF 202020202020202020-
  7808 000032D8 2020202020DDDBDE   
  7809 000032E0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7809 000032E9 202020202020202020-
  7809 000032F2 202020202020202020-
  7809 000032FB 202020202020202020-
  7809 00003304 202020202020202020-
  7809 0000330D 202020202020202020-
  7809 00003316 202020202020202020-
  7809 0000331F 202020202020202020-
  7809 00003328 2020202020DDDBDE   
  7810 00003330 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7810 00003339 202020202020202020-
  7810 00003342 202020202020202020-
  7810 0000334B 202020202020202020-
  7810 00003354 202020202020202020-
  7810 0000335D 202020202020202020-
  7810 00003366 202020202020202020-
  7810 0000336F 202020202020202020-
  7810 00003378 2020202020DDDBDE   
  7811 00003380 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7811 00003389 202020202020202020-
  7811 00003392 202020202020202020-
  7811 0000339B 202020202020202020-
  7811 000033A4 202020202020202020-
  7811 000033AD 202020202020202020-
  7811 000033B6 202020202020202020-
  7811 000033BF 202020202020202020-
  7811 000033C8 2020202020DDDBDE   
  7812 000033D0 DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  7812 000033D9 202020202020202020-
  7812 000033E2 2020202020205F5F5F-
  7812 000033EB 5F5F5F5F2020205F5F-
  7812 000033F4 5F5F5F5F2020202020-
  7812 000033FD 2020205F5F5F5F5F5F-
  7812 00003406 5F2E20202020202020-
  7812 0000340F 202020202020202020-
  7812 00003418 2020202020DDDBDE   
  7813 00003420 DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  7813 00003429 202020202020202020-
  7813 00003432 20202020207C202020-
  7813 0000343B 202020205C202F2020-
  7813 00003444 5F5F20205C20202020-
  7813 0000344D 20202F202020202020-
  7813 00003456 207C20202020202020-
  7813 0000345F 202020202020202020-
  7813 00003468 2020202020DDDBDE   
  7814 00003470 DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  7814 00003479 202020202020202020-
  7814 00003482 20202020207C20202E-
  7814 0000348B 2D2D2E20207C20207C-
  7814 00003494 20207C20207C202020-
  7814 0000349D 207C202020282D2D2D-
  7814 000034A6 2D6020202020202020-
  7814 000034AF 202020202020202020-
  7814 000034B8 2020202020DDDBDE   
  7815 000034C0 DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  7815 000034C9 202020202020202020-
  7815 000034D2 20202020207C20207C-
  7815 000034DB 20207C20207C20207C-
  7815 000034E4 20207C20207C202020-
  7815 000034ED 20205C2020205C2020-
  7815 000034F6 202020202020202020-
  7815 000034FF 202020202020202020-
  7815 00003508 2020202020DDDBDE   
  7816 00003510 DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  7816 00003519 202020202020202020-
  7816 00003522 20202020207C202027-
  7816 0000352B 2D2D2720207C202060-
  7816 00003534 2D2D2720207C202E2D-
  7816 0000353D 2D2D2D292020207C20-
  7816 00003546 202020202020202020-
  7816 0000354F 202020202020202020-
  7816 00003558 2020202020DDDBDE   
  7817 00003560 DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  7817 00003569 202020202020202020-
  7817 00003572 20202020207C5F5F5F-
  7817 0000357B 5F5F5F5F2F205C5F5F-
  7817 00003584 5F5F5F5F2F20207C5F-
  7817 0000358D 5F5F5F5F5F5F2F2020-
  7817 00003596 202020202020202020-
  7817 0000359F 202020202020202020-
  7817 000035A8 2020202020DDDBDE   
  7818 000035B0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7818 000035B9 202020202020202020-
  7818 000035C2 202020202020202020-
  7818 000035CB 202020202020202020-
  7818 000035D4 202020202020202020-
  7818 000035DD 202020202020202020-
  7818 000035E6 202020202020202020-
  7818 000035EF 202020202020202020-
  7818 000035F8 2020202020DDDBDE   
  7819 00003600 DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  7819 00003609 5F5F5F5F5F5F202020-
  7819 00003612 205F5F202020202020-
  7819 0000361B 202020205F5F5F2020-
  7819 00003624 205F5F5F5F20202020-
  7819 0000362D 5F5F5F5F20205F5F5F-
  7819 00003636 5F5F5F5F202E5F5F5F-
  7819 0000363F 5F5F5F202020202020-
  7819 00003648 2020202020DDDBDE   
  7820 00003650 DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  7820 00003659 2020205F20205C2020-
  7820 00003662 7C20207C2020202020-
  7820 0000366B 2020202F2020205C20-
  7820 00003674 205C2020205C20202F-
  7820 0000367D 2020202F207C202020-
  7820 00003686 5F5F5F5F7C7C202020-
  7820 0000368F 5F20205C2020202020-
  7820 00003698 2020202020DDDBDE   
  7821 000036A0 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  7821 000036A9 20207C5F2920207C20-
  7821 000036B2 7C20207C2020202020-
  7821 000036BB 20202F20205E20205C-
  7821 000036C4 20205C2020205C2F20-
  7821 000036CD 20202F20207C20207C-
  7821 000036D6 5F5F2020207C20207C-
  7821 000036DF 5F2920207C20202020-
  7821 000036E8 2020202020DDDBDE   
  7822 000036F0 DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  7822 000036F9 2020205F5F5F2F2020-
  7822 00003702 7C20207C2020202020-
  7822 0000370B 202F20202F5F5C2020-
  7822 00003714 5C20205C5F20202020-
  7822 0000371D 5F2F2020207C202020-
  7822 00003726 5F5F7C20207C202020-
  7822 0000372F 2020202F2020202020-
  7822 00003738 2020202020DDDBDE   
  7823 00003740 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  7823 00003749 20207C202020202020-
  7823 00003752 7C2020602D2D2D2D2E-
  7823 0000375B 2F20205F5F5F5F5F20-
  7823 00003764 205C2020207C20207C-
  7823 0000376D 20202020207C20207C-
  7823 00003776 5F5F5F5F207C20207C-
  7823 0000377F 5C20205C2D2D2D2D2E-
  7823 00003788 2020202020DDDBDE   
  7824 00003790 DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  7824 00003799 205F7C202020202020-
  7824 000037A2 7C5F5F5F5F5F5F5F2F-
  7824 000037AB 5F5F2F20202020205C-
  7824 000037B4 5F5F5C20207C5F5F7C-
  7824 000037BD 20202020207C5F5F5F-
  7824 000037C6 5F5F5F5F7C7C205F7C-
  7824 000037CF 20602E5F5F5F5F5F7C-
  7824 000037D8 2020202020DDDBDE   
  7825 000037E0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7825 000037E9 202020202020202020-
  7825 000037F2 202020202020202020-
  7825 000037FB 202020202020202020-
  7825 00003804 202020202020202020-
  7825 0000380D 202020202020202020-
  7825 00003816 202020202020202020-
  7825 0000381F 202020202020202020-
  7825 00003828 2020202020DDDBDE   
  7826 00003830 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7826 00003839 202020202020202020-
  7826 00003842 202020202020202020-
  7826 0000384B 202020202020202020-
  7826 00003854 202020202020202020-
  7826 0000385D 202020202020202020-
  7826 00003866 202020202020202020-
  7826 0000386F 202020202020202020-
  7826 00003878 2020202020DDDBDE   
  7827 00003880 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7827 00003889 202020202020202020-
  7827 00003892 202020202020202020-
  7827 0000389B 202020202020202020-
  7827 000038A4 202020202020202020-
  7827 000038AD 202020202020202020-
  7827 000038B6 202020202020202020-
  7827 000038BF 202020202020202020-
  7827 000038C8 2020202020DDDBDE   
  7828 000038D0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7828 000038D9 202020202020202020-
  7828 000038E2 202020202020202020-
  7828 000038EB 202020202020202020-
  7828 000038F4 202020202020202020-
  7828 000038FD 202020202020202020-
  7828 00003906 202020202020202020-
  7828 0000390F 202020202020202020-
  7828 00003918 2020202020DDDBDE   
  7829 00003920 DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  7829 00003929 202020202020202020-
  7829 00003932 202020202020202020-
  7829 0000393B 202020202020202057-
  7829 00003944 454C434F4D4520544F-
  7829 0000394D 202020202020202020-
  7829 00003956 202020202020202020-
  7829 0000395F 202020202020202020-
  7829 00003968 2020202020DDDBDE   
  7830 00003970 DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  7830 00003979 202020202020202020-
  7830 00003982 202020202020202020-
  7830 0000398B 202020202020202044-
  7830 00003994 4F5320504C41594552-
  7830 0000399D 202020202020202020-
  7830 000039A6 202020202020202020-
  7830 000039AF 202020202020202020-
  7830 000039B8 2020202020DDDBDE   
  7831 000039C0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7831 000039C9 202020202020202020-
  7831 000039D2 202020202020202020-
  7831 000039DB 202020202020202020-
  7831 000039E4 202020202020202020-
  7831 000039ED 202020202020202020-
  7831 000039F6 202020202020202020-
  7831 000039FF 202020202020202020-
  7831 00003A08 2020202020DDDBDE   
  7832 00003A10 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7832 00003A19 202020202020202020-
  7832 00003A22 202020202020202020-
  7832 00003A2B 202020202020202020-
  7832 00003A34 202020202020202020-
  7832 00003A3D 202020202020202020-
  7832 00003A46 202020202020202020-
  7832 00003A4F 202020202020202020-
  7832 00003A58 2020202020DDDBDE   
  7833 00003A60 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7833 00003A69 202020202020202020-
  7833 00003A72 202020202020202020-
  7833 00003A7B 202020202020202020-
  7833 00003A84 202020202020202020-
  7833 00003A8D 202020202020202020-
  7833 00003A96 202020202020202020-
  7833 00003A9F 202020202020202020-
  7833 00003AA8 2020202020DDDBDE   
  7834 00003AB0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7834 00003AB9 202020202020202020-
  7834 00003AC2 202020202020202020-
  7834 00003ACB 202020202020202020-
  7834 00003AD4 202020202020202020-
  7834 00003ADD 202020202020202020-
  7834 00003AE6 202020202020202020-
  7834 00003AEF 202020202020202020-
  7834 00003AF8 2020202020DDDBDE   
  7835 00003B00 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7835 00003B09 202020202020202020-
  7835 00003B12 202020202020202020-
  7835 00003B1B 202020202020202020-
  7835 00003B24 202020202020202020-
  7835 00003B2D 202020202020202020-
  7835 00003B36 202020202020202020-
  7835 00003B3F 202020202020202020-
  7835 00003B48 2020202020DDDBDE   
  7836 00003B50 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7836 00003B59 202020202020202020-
  7836 00003B62 202020202020202020-
  7836 00003B6B 202020202020202020-
  7836 00003B74 202020202020202020-
  7836 00003B7D 202020202020202020-
  7836 00003B86 202020202020202020-
  7836 00003B8F 202020202020202020-
  7836 00003B98 2020202020DDDBDE   
  7837 00003BA0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7837 00003BA9 202020202020202020-
  7837 00003BB2 202020202020202020-
  7837 00003BBB 202020202020202020-
  7837 00003BC4 202020202020202020-
  7837 00003BCD 202020202020202020-
  7837 00003BD6 202020202020202020-
  7837 00003BDF 202020202020202020-
  7837 00003BE8 2020202020DDDBDE   
  7838 00003BF0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7838 00003BF9 202020202020202020-
  7838 00003C02 202020202020202020-
  7838 00003C0B 202020202020202020-
  7838 00003C14 202020202020202020-
  7838 00003C1D 202020202020202020-
  7838 00003C26 202020202020202020-
  7838 00003C2F 202020202020202020-
  7838 00003C38 2020202020DDDBDE   
  7839 00003C40 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7839 00003C49 202020202020202020-
  7839 00003C52 202020202020202020-
  7839 00003C5B 202020202020202020-
  7839 00003C64 202020202020202020-
  7839 00003C6D 202020202020202020-
  7839 00003C76 202020202020202020-
  7839 00003C7F 202020202020202020-
  7839 00003C88 2020202020DDDBDE   
  7840 00003C90 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  7840 00003C99 202020202020202020-
  7840 00003CA2 202020202020202020-
  7840 00003CAB 202020202020202020-
  7840 00003CB4 202020202020202020-
  7840 00003CBD 202020202020202020-
  7840 00003CC6 202020202020202020-
  7840 00003CCF 202020202020202020-
  7840 00003CD8 2020202020DDDBDE   
  7841 00003CE0 00                      	db 0
  7842                                  
  7843                                  ; -------------------------------------------------------------
  7844                                  
  7845                                  	; 25/12/2024
  7846                                  PlayingScreen:
  7847 00003CE1 DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  7847 00003CEA DBDBDBDBDBDBDBDBDB-
  7847 00003CF3 DBDBDBDBDBDBDBDBDB-
  7847 00003CFC DBDBDBDBDBDBDB2044-
  7847 00003D05 4F5320506C61796572-
  7847 00003D0E 20DBDBDBDBDBDBDBDB-
  7847 00003D17 DBDBDBDBDBDBDBDBDB-
  7847 00003D20 DBDBDBDBDBDBDBDBDB-
  7847 00003D29 DBDBDBDBDBDBDBDB   
  7848 00003D31 C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  7848 00003D3A CDCDCDCDCDCDCDCDCD-
  7848 00003D43 CDCDCDCDCDCDCDCDCD-
  7848 00003D4C CDCDCDCDCDCDCDCDCD-
  7848 00003D55 CDCDCDCDCDCDCDCDCD-
  7848 00003D5E CDCDCDCDCDCDCDCDCD-
  7848 00003D67 CDCDCDCDCDCDCDCDCD-
  7848 00003D70 CDCDCDCDCDCDCDCDCD-
  7848 00003D79 CDCDCDCDCDCDCDBB   
  7849 00003D81 BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  7849 00003D8A 202020202020202020-
  7849 00003D93 202020202020202020-
  7849 00003D9C 202020202020202055-
  7849 00003DA5 736572204775696465-
  7849 00003DAE 202020202020202020-
  7849 00003DB7 202020202020202020-
  7849 00003DC0 202020202020202020-
  7849 00003DC9 20202020202020BA   
  7850 00003DD1 BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<N>/<P>         Next/Previous", 9 dup(32), 186
  7850 00003DDA 706163653E20202020-
  7850 00003DE3 2020202020506C6179-
  7850 00003DEC 2F5061757365202020-
  7850 00003DF5 20202020203C4E3E2F-
  7850 00003DFE 3C503E202020202020-
  7850 00003E07 2020204E6578742F50-
  7850 00003E10 726576696F75732020-
  7850 00003E19 20202020202020BA   
  7851 00003E21 BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>/<G>     Wave Lighting", 9 dup(32), 186
  7851 00003E2A 3E2020202020202020-
  7851 00003E33 202020202053746F70-
  7851 00003E3C 202020202020202020-
  7851 00003E45 20202020203C456E74-
  7851 00003E4E 65723E2F3C473E2020-
  7851 00003E57 20202057617665204C-
  7851 00003E60 69676874696E672020-
  7851 00003E69 20202020202020BA   
  7852 00003E71 BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  7852 00003E7A 3E2020202020202020-
  7852 00003E83 2020202020466F7277-
  7852 00003E8C 617264732020202020-
  7852 00003E95 20202020203C2B3E2F-
  7852 00003E9E 3C2D3E202020202020-
  7852 00003EA7 202020496E632F4465-
  7852 00003EB0 6320566F6C756D6520-
  7852 00003EB9 20202020202020BA   
  7853 00003EC1 BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  7853 00003ECA 3E2020202020202020-
  7853 00003ED3 20202020204261636B-
  7853 00003EDC 776172647320202020-
  7853 00003EE5 20202020203C513E20-
  7853 00003EEE 202020202020202020-
  7853 00003EF7 202020517569742050-
  7853 00003F00 726F6772616D202020-
  7853 00003F09 20202020202020BA   
  7854 00003F11 CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  7854 00003F1A CDCDCDCDCDCDCDCDCD-
  7854 00003F23 CDCDCDCDCDCDCDCDCD-
  7854 00003F2C CDCDCDCDCDCDCDCDCD-
  7854 00003F35 CDCDCDCDCDCDCDCDCD-
  7854 00003F3E CDCDCDCDCDCDCDCDCD-
  7854 00003F47 CDCDCDCDCDCDCDCDCD-
  7854 00003F50 CDCDCDCDCDCDCDCDCD-
  7854 00003F59 CDCDCDCDCDCDCDB9   
  7855 00003F61 BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  7855 00003F6A 6C65204E616D65203A-
  7855 00003F73 202020202020202020-
  7855 00003F7C 202020202020202020-
  7855 00003F85 20202020204269742D-
  7855 00003F8E 5261746520203A2020-
  7855 00003F97 202020302020426974-
  7855 00003FA0 732020202020202020-
  7855 00003FA9 20202020202020BA   
  7856 00003FB1 BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  7856 00003FBA 657175656E6379203A-
  7856 00003FC3 202020202030202020-
  7856 00003FCC 2020487A2020202020-
  7856 00003FD5 2020202020232D4368-
  7856 00003FDE 616E6E656C733A2020-
  7856 00003FE7 202020302020202020-
  7856 00003FF0 202020202020202020-
  7856 00003FF9 20202020202020BA   
  7857 00004001 C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  7857 0000400A CDCDCDCDCDCDCDCDCD-
  7857 00004013 CDCDCDCDCDCDCDCDCD-
  7857 0000401C CDCDCDCDCDCDCDCDCD-
  7857 00004025 CDCDCDCDCDCDCDCDCD-
  7857 0000402E CDCDCDCDCDCDCDCDCD-
  7857 00004037 CDCDCDCDCDCDCDCDCD-
  7857 00004040 CDCDCDCDCDCDCDCDCD-
  7857 00004049 CDCDCDCDCDCDCDBC   
  7858 00004051 202020202020202020-     	db  80 dup(32)
  7858 0000405A 202020202020202020-
  7858 00004063 202020202020202020-
  7858 0000406C 202020202020202020-
  7858 00004075 202020202020202020-
  7858 0000407E 202020202020202020-
  7858 00004087 202020202020202020-
  7858 00004090 202020202020202020-
  7858 00004099 2020202020202020   
  7859                                  improper_samplerate_txt:
  7860                                  read_error_txt:
  7861 000040A1 202020202020202020-     	db  80 dup(32)
  7861 000040AA 202020202020202020-
  7861 000040B3 202020202020202020-
  7861 000040BC 202020202020202020-
  7861 000040C5 202020202020202020-
  7861 000040CE 202020202020202020-
  7861 000040D7 202020202020202020-
  7861 000040E0 202020202020202020-
  7861 000040E9 2020202020202020   
  7862 000040F1 202020202020202020-     	db  80 dup(32)
  7862 000040FA 202020202020202020-
  7862 00004103 202020202020202020-
  7862 0000410C 202020202020202020-
  7862 00004115 202020202020202020-
  7862 0000411E 202020202020202020-
  7862 00004127 202020202020202020-
  7862 00004130 202020202020202020-
  7862 00004139 2020202020202020   
  7863 00004141 202020202020202020-     	db  80 dup(32)
  7863 0000414A 202020202020202020-
  7863 00004153 202020202020202020-
  7863 0000415C 202020202020202020-
  7863 00004165 202020202020202020-
  7863 0000416E 202020202020202020-
  7863 00004177 202020202020202020-
  7863 00004180 202020202020202020-
  7863 00004189 2020202020202020   
  7864 00004191 202020202020202020-     	db  80 dup(32)
  7864 0000419A 202020202020202020-
  7864 000041A3 202020202020202020-
  7864 000041AC 202020202020202020-
  7864 000041B5 202020202020202020-
  7864 000041BE 202020202020202020-
  7864 000041C7 202020202020202020-
  7864 000041D0 202020202020202020-
  7864 000041D9 2020202020202020   
  7865 000041E1 202020202020202020-     	db  80 dup(32)
  7865 000041EA 202020202020202020-
  7865 000041F3 202020202020202020-
  7865 000041FC 202020202020202020-
  7865 00004205 202020202020202020-
  7865 0000420E 202020202020202020-
  7865 00004217 202020202020202020-
  7865 00004220 202020202020202020-
  7865 00004229 2020202020202020   
  7866 00004231 202020202020202020-     	db  80 dup(32)
  7866 0000423A 202020202020202020-
  7866 00004243 202020202020202020-
  7866 0000424C 202020202020202020-
  7866 00004255 202020202020202020-
  7866 0000425E 202020202020202020-
  7866 00004267 202020202020202020-
  7866 00004270 202020202020202020-
  7866 00004279 2020202020202020   
  7867 00004281 202020202020202020-     	db  80 dup(32)
  7867 0000428A 202020202020202020-
  7867 00004293 202020202020202020-
  7867 0000429C 202020202020202020-
  7867 000042A5 202020202020202020-
  7867 000042AE 202020202020202020-
  7867 000042B7 202020202020202020-
  7867 000042C0 202020202020202020-
  7867 000042C9 2020202020202020   
  7868 000042D1 202020202020202020-     	db  80 dup(32)
  7868 000042DA 202020202020202020-
  7868 000042E3 202020202020202020-
  7868 000042EC 202020202020202020-
  7868 000042F5 202020202020202020-
  7868 000042FE 202020202020202020-
  7868 00004307 202020202020202020-
  7868 00004310 202020202020202020-
  7868 00004319 2020202020202020   
  7869 00004321 202020202020202020-     	db  80 dup(32)
  7869 0000432A 202020202020202020-
  7869 00004333 202020202020202020-
  7869 0000433C 202020202020202020-
  7869 00004345 202020202020202020-
  7869 0000434E 202020202020202020-
  7869 00004357 202020202020202020-
  7869 00004360 202020202020202020-
  7869 00004369 2020202020202020   
  7870 00004371 202020202020202020-     	db  80 dup(32)
  7870 0000437A 202020202020202020-
  7870 00004383 202020202020202020-
  7870 0000438C 202020202020202020-
  7870 00004395 202020202020202020-
  7870 0000439E 202020202020202020-
  7870 000043A7 202020202020202020-
  7870 000043B0 202020202020202020-
  7870 000043B9 2020202020202020   
  7871 000043C1 202020202020202020-     	db  80 dup(32)
  7871 000043CA 202020202020202020-
  7871 000043D3 202020202020202020-
  7871 000043DC 202020202020202020-
  7871 000043E5 202020202020202020-
  7871 000043EE 202020202020202020-
  7871 000043F7 202020202020202020-
  7871 00004400 202020202020202020-
  7871 00004409 2020202020202020   
  7872 00004411 202020202020202020-     	db  80 dup(32)
  7872 0000441A 202020202020202020-
  7872 00004423 202020202020202020-
  7872 0000442C 202020202020202020-
  7872 00004435 202020202020202020-
  7872 0000443E 202020202020202020-
  7872 00004447 202020202020202020-
  7872 00004450 202020202020202020-
  7872 00004459 2020202020202020   
  7873 00004461 202020202020202020-     	db  80 dup(32)
  7873 0000446A 202020202020202020-
  7873 00004473 202020202020202020-
  7873 0000447C 202020202020202020-
  7873 00004485 202020202020202020-
  7873 0000448E 202020202020202020-
  7873 00004497 202020202020202020-
  7873 000044A0 202020202020202020-
  7873 000044A9 2020202020202020   
  7874 000044B1 202020202020202020-     	db  80 dup(32)
  7874 000044BA 202020202020202020-
  7874 000044C3 202020202020202020-
  7874 000044CC 202020202020202020-
  7874 000044D5 202020202020202020-
  7874 000044DE 202020202020202020-
  7874 000044E7 202020202020202020-
  7874 000044F0 202020202020202020-
  7874 000044F9 2020202020202020   
  7875 00004501 202020202020202020-     	db  80 dup(32)
  7875 0000450A 202020202020202020-
  7875 00004513 202020202020202020-
  7875 0000451C 202020202020202020-
  7875 00004525 202020202020202020-
  7875 0000452E 202020202020202020-
  7875 00004537 202020202020202020-
  7875 00004540 202020202020202020-
  7875 00004549 2020202020202020   
  7876 00004551 202020202020202020-     	db  80 dup(32)
  7876 0000455A 202020202020202020-
  7876 00004563 202020202020202020-
  7876 0000456C 202020202020202020-
  7876 00004575 202020202020202020-
  7876 0000457E 202020202020202020-
  7876 00004587 202020202020202020-
  7876 00004590 202020202020202020-
  7876 00004599 2020202020202020   
  7877 000045A1 202020202020202020-     	db  80 dup(32)
  7877 000045AA 202020202020202020-
  7877 000045B3 202020202020202020-
  7877 000045BC 202020202020202020-
  7877 000045C5 202020202020202020-
  7877 000045CE 202020202020202020-
  7877 000045D7 202020202020202020-
  7877 000045E0 202020202020202020-
  7877 000045E9 2020202020202020   
  7878 000045F1 202020202020202020-     	db  80 dup(32)
  7878 000045FA 202020202020202020-
  7878 00004603 202020202020202020-
  7878 0000460C 202020202020202020-
  7878 00004615 202020202020202020-
  7878 0000461E 202020202020202020-
  7878 00004627 202020202020202020-
  7878 00004630 202020202020202020-
  7878 00004639 2020202020202020   
  7879 00004641 CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  7879 0000464A CDCDCDCDCDCDCDCDCD-
  7879 00004653 CDCDCDCDCDCDCDCDCD-
  7879 0000465C CDCDCDCDCDCDCDCDCD-
  7879 00004665 CDCDCDCDCDCDCDCDCD-
  7879 0000466E CDCDCDCDCDCDCDCDCD-
  7879 00004677 CDCDCDCDCDCDCDCDCD-
  7879 00004680 CDCDCDCDCDCDCDCDCD-
  7879 00004689 CDCDCDCDCDCDCDCD   
  7880 00004691 202020202020202020-     	db  80 dup(32)
  7880 0000469A 202020202020202020-
  7880 000046A3 202020202020202020-
  7880 000046AC 202020202020202020-
  7880 000046B5 202020202020202020-
  7880 000046BE 202020202020202020-
  7880 000046C7 202020202020202020-
  7880 000046D0 202020202020202020-
  7880 000046D9 2020202020202020   
  7881 000046E1 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  7881 000046EA 202020202020202020-
  7881 000046F3 202020202020202020-
  7881 000046FC 20202020202030303A-
  7881 00004705 303020AEAF2030303A-
  7881 0000470E 303020202020202020-
  7881 00004717 202020202020202020-
  7881 00004720 202020202020202056-
  7881 00004729 4F4C2030303025     
  7882 00004730 00                      	db 0
  7883                                  
  7884                                  ; 25/12/2024
  7885                                  ; 28/11/2024
  7886                                  IsInSplash:
  7887 00004731 01                      	db 1
  7888                                  
  7889                                  SplashFileName:
  7890 00004732 53504C4153482E5741-     	db "SPLASH.WAV", 0
  7890 0000473B 5600               
  7891                                  
  7892                                  ; -------------------------------------------------------------
  7893                                  
  7894                                  	; 22/12/2024
  7895                                  fillblock:
  7896 0000473D FF<rep Eh>              	times 14 db 0FFh
  7897 0000474B 0000                    	dw 0
  7898                                  
  7899                                  ; -------------------------------------------------------------
  7900                                  
  7901                                  ; 23/11/2024
  7902                                  colors:
  7903 0000474D 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  7904                                  	; white, cyan, green, red, yellow, blue, magenta
  7905 00004755 0B                      ccolor:	db 0Bh	; cyan
  7906                                  
  7907                                  EOF: 
  7908                                  
  7909                                  ; -------------------------------------------------------------
  7910                                  
  7911                                  bss:
  7912                                  
  7913                                  ABSOLUTE bss
  7914                                  
  7915 00004756 ????                    alignb 4
  7916                                  
  7917                                  ; 21/12/2024
  7918                                  fontbuff1:
  7919 00004758 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  7920                                  fontbuff2:
  7921 00005558 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  7922                                  
  7923                                  ; 11/12/2024
  7924                                  wleds_addr:
  7925 00006558 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  7926                                  ; 22/12/2024
  7927                                  prev_leds:
  7928 00007958 <res 140h>              	resd 80	; previous lighting leds
  7929                                  
  7930                                  ; 24/12/2024
  7931                                  wpoints_dif:	; wave lighting points factor (differential)
  7932 00007A98 ????????                	resd 1	; required bytes for 1/18 second wave lighting
  7933                                  graphstart:
  7934 00007A9C ????????                	resd 1	; start (top) line/row for wave lighting points
  7935                                  
  7936                                  LFB_ADDR:
  7937 00007AA0 ????????                	resd 1
  7938                                  ;nextrow:
  7939                                  	;resd 1
  7940                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  7941 00007AA4 ????????                	resd 1
  7942 00007AA8 ????????                wcolor:	resd 1
  7943                                  ; 26/12/2024
  7944                                  ;tcolor: resb 1 ; text color
  7945                                  columns:
  7946 00007AAC ??                      	resb 1
  7947 00007AAD ??                      pbprev:	resb 1 ; previous progress bar indicator position
  7948                                  
  7949 00007AAE ????                    alignb 4
  7950                                  
  7951                                  bss_start:
  7952                                  
  7953                                  ; 29/12/2024
  7954                                  audio_buffer:
  7955 00007AB0 ????????                	resd 1
  7956                                  
  7957                                  ; 24/12/2024
  7958                                  prev_points:
  7959 00007AB4 <res A00h>              	resd 640 ; previous wave points (which are lighting)
  7960                                  
  7961                                  ; 18/11/2024
  7962                                  stopped:
  7963 000084B4 ??                      	resb 1
  7964 000084B5 ??                      tLO:	resb 1
  7965                                  ; 21/11/2024
  7966 000084B6 ??                      tLP:	resb 1
  7967                                  ; 19/11/2024
  7968 000084B7 ??                      wleds:	resb 1
  7969                                  wleds_dif:
  7970 000084B8 ????????                	resd 1
  7971 000084BC ????????                pbuf_o:	resd 1
  7972                                  ; 29/12/2024
  7973 000084C0 ????????                pbuf_s:	resd 1
  7974                                  
  7975                                  ; 07/12/2024
  7976                                  ; 24/11/2024
  7977                                  half_buffer:
  7978 000084C4 ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  7979                                  
  7980                                  ; 30/05/2024
  7981 000084C5 ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  7982                                  
  7983                                  ; 24/12/2024
  7984 000084C6 ??                      p_mode: resb 1	; point mode (as alternative to LED mode)
  7985                                  
  7986                                  ; 25/12/2024
  7987                                  ; 29/11/2024
  7988                                  command:
  7989 000084C7 ??                      	resb 1
  7990                                  filecount:
  7991 000084C8 ??                      	resb 1
  7992                                  
  7993                                  ; 30/11/2024
  7994 000084C9 ??????                  alignb 4
  7995                                  
  7996                                  ;;;;;;;;;;;;;;
  7997                                  ; 14/11/2024
  7998                                  ; (Ref: player.asm, Matan Alfasi, 2017)
  7999                                  WAVFILEHEADERbuff:
  8000                                  RIFF_ChunkID:
  8001 000084CC ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  8002                                  		; 0x52494646
  8003                                  RIFF_ChunkSize:
  8004 000084D0 ????????                	resd 1	; Represents total file size, not
  8005                                          	; including the first 2 fields 
  8006                                  		; (Total_File_Size - 8), little-endian
  8007                                  RIFF_Format:
  8008 000084D4 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  8009                                  		; 0x57415645
  8010                                  
  8011                                  ;; WAVE header parameters ("Sub-chunk")
  8012                                  WAVE_SubchunkID:
  8013 000084D8 ????????                	resd 1	; Must be equal to "fmt " - big-endian
  8014                                  		; 0x666d7420
  8015                                  WAVE_SubchunkSize:
  8016 000084DC ????????                	resd 1	; Represents total chunk size
  8017                                  WAVE_AudioFormat:
  8018 000084E0 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  8019                                  		; of compression, not supported.
  8020                                  WAVE_NumChannels:
  8021 000084E2 ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  8022                                  WAVE_SampleRate:
  8023 000084E4 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  8024                                  WAVE_ByteRate:
  8025 000084E8 ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  8026                                  WAVE_BlockAlign:
  8027 000084EC ????                    	resw 1	; NumChannels * BytesPerSample
  8028                                  		; Number of bytes for one sample.
  8029                                  WAVE_BitsPerSample:
  8030 000084EE ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  8031                                  
  8032                                  ;; DATA header parameters
  8033                                  DATA_SubchunkID:
  8034 000084F0 ????????                	resd 1	; Must be equal to "data" - big-endian
  8035                                          	; 0x64617461
  8036                                  DATA_SubchunkSize:
  8037 000084F4 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  8038                                          	; Number of bytes in the data.
  8039                                  ;;;;;;;;;;;;;;
  8040                                  
  8041                                  ; 28/12/2024
  8042                                  ; 15/11/2024
  8043                                  ;cursortype:
  8044 000084F8 ????                    	resw 1
  8045 000084FA ??                      flags:	resb 1
  8046                                  ; 06/11/2023
  8047                                  ac97_int_ln_reg:
  8048 000084FB ??                      	resb 1
  8049                                  filehandle:
  8050 000084FC ????????                	resd 1
  8051                                  
  8052                                  ; 25/12/2024
  8053                                  ; 30/11/2024
  8054                                  ;argc:	resb 1	; argument count
  8055 00008500 ????????                argv:	resd 1	; current argument (wav file) ptr
  8056 00008504 ????????                argvf:	resd 1	; 1st argument (wav file) ptr
  8057 00008508 ????????                argvl:	resd 1	; last argument (wav file) ptr
  8058                                  
  8059                                  ; 30/05/2024
  8060                                  wav_file_name:
  8061 0000850C <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  8062 0000855C ????                    	resw 1	; 30/11/2024
  8063                                  
  8064                                  ; 08/11/2023
  8065                                  ; 07/11/2023
  8066                                  fbs_shift:
  8067 0000855E ??                      	resb 1
  8068                                  ; 07/12/2024
  8069 0000855F ??                      SRB:	resb 1
  8070                                  
  8071                                  ; 12/11/2016 - Erdogan Tan
  8072                                  bus_dev_fn:
  8073 00008560 ????????                	resd 1
  8074                                  dev_vendor:
  8075 00008564 ????????                	resd 1
  8076                                  
  8077                                  ; 17/02/2017
  8078                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  8079                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  8080                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  8081                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  8082 00008568 ????                    NAMBAR:	resw 1	; BAR for mixer
  8083                                  NABMBAR:
  8084 0000856A ????                    	resw 1	; BAR for bus master regs
  8085                                  
  8086                                  ; 15/11/2024
  8087                                  loadfromwavfile:
  8088 0000856C ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  8089                                  loadsize:
  8090 00008570 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  8091                                  buffersize:
  8092 00008574 ????????                	resd 1	; 16 bit samples (not bytes)
  8093                                  
  8094                                  ; 14/11/2024
  8095                                  TotalTime:
  8096 00008578 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  8097                                  ProgressTime:
  8098 0000857C ????????                	resd 1
  8099 00008580 ????????                count:	resd 1	; byte count of one (wav file) read
  8100                                  LoadedDataBytes:
  8101 00008584 ????????                	resd 1	; total read/load count
  8102                                  
  8103                                  timerticks:
  8104 00008588 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  8105                                  		; (in order to get the emulator/qemu to run correctly)
  8106                                  ; 01/12/2024
  8107                                  _bdl_buffer:
  8108 0000858C ????????                	resd 1
  8109                                  
  8110                                  ; 14/11/2024
  8111                                  bss_end:
  8112                                  
  8113                                  ; 29/12/2024
  8114 00008590 <res A70h>              alignb 4096
  8115                                  
  8116                                  ; 01/12/2024
  8117                                  BDL_BUFFER:
  8118 00009000 <res 100h>              	resb 256
  8119                                  	; 02/12/2024
  8120 00009100 <res F00h>              	resb 4096-256
  8121                                  
  8122                                  ;alignb 4096
  8123                                  
  8124                                  ; 29/05/2024
  8125                                  WAVBUFFER_1:
  8126 0000A000 <res 10000h>            	resb 65536
  8127                                  WAVBUFFER_2:
  8128 0001A000 <res 10000h>            	resb 65536
  8129                                  
  8130                                  ; 01/12/2024
  8131                                  ; 26/11/2023
  8132                                  temp_buffer:
  8133 0002A000 <res 10000h>            	resb 65536  ;  resb BUFFERSIZE
