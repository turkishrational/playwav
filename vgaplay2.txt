     1                                  ; ****************************************************************************
     2                                  ; vgaplay2.s - TRDOS 386 (TRDOS v2.0.9) WAV PLAYER - VESA VBE Video Mode 101h
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; VGAPLAY2.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 27/12/2024				- play music from multiple wav files -
     7                                  ;
     8                                  ; [ Last Modification: 18/01/2025 ]
     9                                  ;
    10                                  ; Modified from VGAPLAY.PRG .wav player program by Erdogan Tan, 26/12/2024
    11                                  ;
    12                                  ; ****************************************************************************
    13                                  ; nasm vgaplay2.s -l vgaplay2.txt -o VGAPLAY2.PRG -Z error.txt
    14                                  
    15                                  ; 27/12/2024
    16                                  ; vgaplay2.s : DMA buffer tracking (instead of user's audio buffer)
    17                                  
    18                                  ; vgaplay.s (26/12/2024) - play music from multiple wav files -
    19                                  ; dplayvga.s (25/12/2024) - play music from single wav file -
    20                                  ; ac97play.s (18/12/2024) - play music from multiple wav files -
    21                                  
    22                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    23                                  ; ------------------------------------------------------------
    24                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    25                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    26                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    27                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    28                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    29                                  
    30                                  ; ------------------------------------------------------------
    31                                  
    32                                  ; 30/11/2024
    33                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    34                                  ; 29/04/2016
    35                                  _ver 	equ 0
    36                                  _exit 	equ 1
    37                                  _fork 	equ 2
    38                                  _read 	equ 3
    39                                  _write	equ 4
    40                                  _open	equ 5
    41                                  _close 	equ 6
    42                                  _wait 	equ 7
    43                                  _creat 	equ 8
    44                                  _link 	equ 9
    45                                  _unlink	equ 10
    46                                  _exec	equ 11
    47                                  _chdir	equ 12
    48                                  _time 	equ 13
    49                                  _mkdir 	equ 14
    50                                  _chmod	equ 15
    51                                  _chown	equ 16
    52                                  _break	equ 17
    53                                  _stat	equ 18
    54                                  _seek	equ 19
    55                                  _tell 	equ 20
    56                                  _mount	equ 21
    57                                  _umount	equ 22
    58                                  _setuid	equ 23
    59                                  _getuid	equ 24
    60                                  _stime	equ 25
    61                                  _quit	equ 26
    62                                  _intr	equ 27
    63                                  _fstat	equ 28
    64                                  _emt 	equ 29
    65                                  _mdate 	equ 30
    66                                  _video 	equ 31
    67                                  _audio	equ 32
    68                                  _timer	equ 33
    69                                  _sleep	equ 34
    70                                  _msg    equ 35
    71                                  _geterr	equ 36
    72                                  _fpsave	equ 37
    73                                  _pri	equ 38
    74                                  _rele	equ 39
    75                                  _fff	equ 40
    76                                  _fnf	equ 41
    77                                  _alloc	equ 42
    78                                  _dalloc equ 43
    79                                  _calbac equ 44
    80                                  _dma	equ 45
    81                                  _stdio  equ 46
    82                                  
    83                                  ; ------------------------------------------------------------
    84                                  
    85                                  %macro sys 1-4
    86                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    87                                      ; 03/09/2015
    88                                      ; 13/04/2015
    89                                      ; Retro UNIX 386 v1 system call.
    90                                      %if %0 >= 2
    91                                          mov ebx, %2
    92                                          %if %0 >= 3
    93                                              mov ecx, %3
    94                                              %if %0 = 4
    95                                                 mov edx, %4
    96                                              %endif
    97                                          %endif
    98                                      %endif
    99                                      mov eax, %1
   100                                      ;int 30h
   101                                      int 40h ; TRDOS 386 (TRDOS v2.0)
   102                                  %endmacro
   103                                  
   104                                  ; Retro UNIX 386 v1 system call format:
   105                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   106                                  
   107                                  ; ------------------------------------------------------------
   108                                  
   109                                  ; player internal variables and other equates.
   110                                  BUFFERSIZE	equ 65536
   111                                  ENDOFFILE	equ 1		; flag for knowing end of file
   112                                  
   113                                  ; ------------------------------------------------------------
   114                                  
   115                                  [BITS 32] ; 32-bit intructions
   116                                  
   117                                  [ORG 0]
   118                                  
   119                                  START_CODE:
   120                                  	; Prints the Credits Text.
   121                                  	sys	_msg, Credits, 255, 0Bh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000000 BB[F4290000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000005 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000000A BA0B000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000000F B823000000          <1>  mov eax, %1
   100                              <1> 
   101 00000014 CD40                <1>  int 40h
   122                                  
   123                                  	; clear bss
   124 00000016 BF[C8740000]            	mov	edi, bss_start
   125 0000001B B9B5020000              	mov	ecx, (bss_end - bss_start)/4
   126 00000020 31C0                    	xor	eax, eax
   127 00000022 F3AB                    	rep	stosd
   128                                  
   129                                  ; -------------------------------------------------------------
   130                                  
   131                                  	; 21/12/2024
   132                                  	; Detect (& Enable) AC'97 Audio Device
   133 00000024 E8A8080000              	call	DetectAC97
   134 00000029 731B                    	jnc	short ac97_hardware_ready
   135                                  
   136                                  	; 30/11/2024
   137                                  	; 30/05/2024
   138                                  _dev_not_ready:
   139                                  	; couldn't find the audio device!
   140                                  	sys	_msg, noDevMsg, 255, 0Fh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000002B BB[972A0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000030 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000035 BA0F000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000003A B823000000          <1>  mov eax, %1
   100                              <1> 
   101 0000003F CD40                <1>  int 40h
   141 00000041 E99B050000                      jmp     Exit
   142                                  
   143                                  ac97_hardware_ready:
   144 00000046 E8220A0000              	call	write_audio_dev_info
   145                                  
   146                                  ; -------------------------------------------------------------
   147                                  
   148                                  	; 21/12/2024
   149                                  	;;;
   150                                  	; Read (copy) 8x14 system fonts
   151 0000004B BE[70410000]            	mov	esi, fontbuff1
   152                                  	sys	_video, 0C03h, 256, 0
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000050 BB030C0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000055 B900010000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000005A BA00000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000005F B81F000000          <1>  mov eax, %1
   100                              <1> 
   101 00000064 CD40                <1>  int 40h
   153                                  
   154                                  	; convert 8x14 fonts to 8x16 fonts
   155                                  	; by inserting 2 empty rows to each characters
   156                                  	;mov	esi, fontbuff1
   157 00000066 BF[704F0000]            	mov	edi, fontbuff2
   158                                  	; 18/02/2021
   159                                  	;mov	cx, 256
   160                                  fontconvert:
   161 0000006B 51                      	push	ecx
   162 0000006C 66B90E00                	mov	cx, 14
   163 00000070 F3A4                    	rep	movsb
   164 00000072 28C0                    	sub	al, al
   165 00000074 AA                      	stosb
   166 00000075 AA                      	stosb
   167 00000076 59                      	pop	ecx
   168 00000077 E2F2                    	loop	fontconvert
   169                                  	;;;
   170                                  
   171                                  ; ------------------------------------------------------------- 
   172                                  
   173                                  	; 21/12/2024
   174                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   175                                  	sys	_video, 08FFh, 101h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000079 BBFF080000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000007E B901010000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000083 B81F000000          <1>  mov eax, %1
   100                              <1> 
   101 00000088 CD40                <1>  int 40h
   176 0000008A 09C0                    	or	eax, eax
   177 0000008C 0F844A050000            	jz	terminate    ; nothing to do				
   178                                  	;jz	trdos386_err ; write (OS) error msg and exit
   179                                  
   180                                  set_vesa_mode_101h_ok:
   181                                  	; linear frame buffer access
   182                                  	sys	_video, 06FFh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000092 BBFF060000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000097 B81F000000          <1>  mov eax, %1
   100                              <1> 
   101 0000009C CD40                <1>  int 40h
   183 0000009E 21C0                    	and	eax, eax
   184 000000A0 0F8481050000            	jz	error_exit ; set text mode and write err msg
   185 000000A6 A3[B8740000]            	mov	[LFB_ADDR], eax
   186                                  
   187                                  ; -------------------------------------------------------------
   188                                  
   189                                  	; 25/12/2024
   190                                  	; 28/11/2024
   191                                  Player_InitalizePSP:
   192                                  	; 30/11/2024
   193                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   194                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   195                                  	;			.. argv0text, argv1text ..) 
   196                                  	; ---- argc, argv[] ----
   197 000000AB 89E6                    	mov	esi, esp
   198 000000AD AD                      	lodsd
   199 000000AE 83F802                  	cmp	eax, 2 ; two arguments 
   200                                  		; (program file name & mod file name)
   201 000000B1 0F8233050000            	jb	pmsg_usage ; nothing to do
   202                                  	;mov	[argc], al
   203 000000B7 C1E002                  	shl	eax, 2 ; *4
   204 000000BA 01E0                    	add	eax, esp
   205                                  	; eax = last argument's address pointer
   206 000000BC A3[187F0000]            	mov	[argvl], eax ; last wav file (argument)
   207 000000C1 8935[107F0000]          	mov	[argv], esi ; current argument (PRG file name)
   208 000000C7 AD                      	lodsd	; skip program (PRG) file name
   209 000000C8 8935[147F0000]          	mov	[argvf], esi ; 1st wav file (argument)
   210                                  
   211                                  	; 25/12/2024
   212                                  Player_ParseParameters:
   213                                  	; 30/11/2024
   214                                  	; 29/11/2024
   215                                  	; 18/12/2024
   216                                  	;mov	edx, wav_file_name
   217                                  	
   218                                  	; 26/12/2024
   219                                  	;cmp	byte [IsInSplash], 0
   220                                  	;jna	short check_p_command
   221                                  
   222 000000CE BA[4A410000]            	mov	edx, SplashFileName
   223 000000D3 EB3E                    	jmp	short _1
   224                                  
   225                                  	; 25/12/2024
   226                                  check_p_command:
   227                                  	; 07/12/2024
   228 000000D5 8B35[107F0000]          	mov	esi, [argv]
   229                                  	;
   230 000000DB 803D[D87E0000]50          	cmp	byte [command], 'P'
   231 000000E2 7410                    	je	short Player_ParsePreviousParameter
   232                                      
   233                                  	; 07/12/2024
   234                                  	; 30/11/2024
   235                                  	;mov	esi, [argv] ; current argument (wav file) ptr
   236 000000E4 83C604                  	add	esi, 4
   237 000000E7 3B35[187F0000]          	cmp	esi, [argvl] ; last argument (wav file) ptr
   238 000000ED 7610                    	jna	short Player_ParseNextParameter
   239                                  jmp_Player_Quit:
   240 000000EF E931050000              	jmp	Player_Quit
   241                                  
   242                                  Player_ParsePreviousParameter:
   243                                  	; 29/11/2024
   244                                  	;mov	byte [command], 0
   245                                  	; 30/11/2024
   246                                  	;mov	esi, [argv] ; 07/12/2024	
   247 000000F4 3B35[147F0000]          	cmp	esi, [argvf] ; first argument (wav file) ptr
   248 000000FA 7603                    	jna	short Player_ParseNextParameter
   249 000000FC 83EE04                  	sub	esi, 4
   250                                  Player_ParseNextParameter:
   251                                  	; 30/11/2024
   252 000000FF 8935[107F0000]          	mov	[argv], esi  ; set as current argument
   253                                  	; 01/12/2024
   254 00000105 8B36                    	mov	esi, [esi]
   255                                  	; 07/12/2024
   256                                  	;mov	ecx, esi
   257                                  	;mov	esi, [ecx]
   258                                  
   259                                  	; 29/11/2024
   260 00000107 E84D000000              	call	GetFileName
   261                                  	;jcxz	jmp_Player_Quit
   262 0000010C E3E1                    	jecxz	jmp_Player_Quit ; 30/11/2024
   263                                  
   264                                  	; 30/11/2024
   265                                  	; 28/11/2024
   266 0000010E BA[1C7F0000]            	mov	edx, wav_file_name
   267                                  	;;;
   268                                  _1:
   269                                  
   270                                  ; open the file
   271                                          ; open existing file
   272                                  	; 28/11/2024
   273                                  	;mov	edx, wav_file_name
   274 00000113 E80B080000                      call	openFile ; no error? ok.
   275 00000118 0F8383000000                    jnc	getwavparms	; 14/11/2024
   276                                  
   277                                  	; 28/11/2024
   278 0000011E 803D[49410000]00        	cmp	byte [IsInSplash], 0
   279 00000125 0F8799000000            	ja	Player_SplashScreen
   280                                  
   281                                  	; 29/11/2024
   282 0000012B 803D[D97E0000]00        	cmp	byte [filecount], 0
   283 00000132 77A1                    	ja	short check_p_command
   284                                  
   285                                  	; 25/12/2024
   286                                  	; 21/12/2024
   287 00000134 E88B050000              	call	set_text_mode
   288                                  	; file not found!
   289                                  	; 30/11/2024
   290                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000139 BB[C22A0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000013E B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000143 BA0C000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000148 B823000000          <1>  mov eax, %1
   100                              <1> 
   101 0000014D CD40                <1>  int 40h
   291 0000014F E98D040000                      jmp     Exit
   292                                  
   293                                  _exit_:
   294 00000154 E983040000              	jmp	terminate
   295                                  
   296                                  ; -------------------------------------------------------------
   297                                  
   298                                  	; 26/12/2024
   299                                  	; 25/12/2024
   300                                  	; 30/11/2024 (32bit)
   301                                  	; 29/11/2024
   302                                  	; 30/05/2024
   303                                  GetFileName:
   304 00000159 BF[1C7F0000]            	mov	edi, wav_file_name 
   305                                  	; 30/11/2024
   306                                  	;mov	esi, [argv]
   307 0000015E 31C9                    	xor	ecx, ecx ; 0
   308                                  ScanName:
   309 00000160 AC                      	lodsb
   310                                  	;test	al, al
   311                                  	;jz	short a_4
   312                                  	; 29/11/2024
   313 00000161 3C0D                    	cmp	al, 0Dh
   314 00000163 7638                    	jna	short a_4
   315 00000165 3C20                    	cmp	al, 20h
   316 00000167 74F7                    	je	short ScanName	; scan start of name.
   317 00000169 AA                      	stosb
   318 0000016A B4FF                    	mov	ah, 0FFh
   319                                  	;;;
   320                                  	; 14/11/2024
   321                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   322                                  	;xor	ecx, ecx ; 0
   323                                  	;;;
   324                                  a_0:	
   325 0000016C FEC4                    	inc	ah
   326                                  a_1:
   327                                  	;;;
   328                                  	; 14/11/2024
   329 0000016E 41                      	inc	ecx
   330                                  	;;;
   331 0000016F AC                      	lodsb
   332 00000170 AA                      	stosb
   333 00000171 3C2E                    	cmp	al, '.'
   334 00000173 74F7                    	je	short a_0
   335                                  	; 29/11/2024
   336 00000175 3C20                    	cmp	al, 20h
   337                                  	;and	al, al
   338                                  	;jnz	short a_1
   339                                  	;;;
   340                                  	; 14/11/2024
   341 00000177 7613                    	jna	short a_3
   342 00000179 20E4                    	and	ah, ah
   343 0000017B 7406                    	jz	short a_2
   344 0000017D 3C2F                    	cmp	al, '/'	; 14/12/2024
   345 0000017F 7502                    	jne	short a_2
   346 00000181 B400                    	mov	ah, 0
   347                                  a_2:
   348 00000183 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   349 00000186 72E6                    	jb	short a_1
   350                                  	; 29/11/2024
   351 00000188 29C9                    	sub	ecx, ecx
   352 0000018A EB11                    	jmp	short a_4
   353                                  a_3:
   354                                  	; 29/11/2024
   355 0000018C 4F                      	dec	edi
   356                                  	;;;
   357 0000018D 08E4                    	or	ah, ah		; if period NOT found,
   358 0000018F 750C                    	jnz	short a_4 	; then add a .WAV extension.
   359                                  SetExt:
   360                                  	; 29/11/2024
   361                                  	;dec	edi
   362 00000191 C7072E574156            	mov	dword [edi], '.WAV'
   363                                  				; ! 64+12 is DOS limit
   364                                  				; but writing +4 must not
   365                                  				; destroy the following data	 
   366                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   367                                  	; 29/11/2024
   368 00000197 83C104                  	add	ecx, 4
   369 0000019A 83C704                  	add	edi, 4
   370                                  a_4:	
   371 0000019D C60700                  	mov	byte [edi], 0
   372                                  	; 30/11/2024
   373 000001A0 C3                      	retn
   374                                  
   375                                  ; -------------------------------------------------------------
   376                                  
   377                                  getwavparms:
   378                                  	; 14/11/2024
   379 000001A1 E8AF070000                     	call    getWAVParameters
   380 000001A6 72AC                    	jc	short _exit_		; nothing to do
   381                                  
   382                                  	; 17/11/2024
   383 000001A8 B304                    	mov	bl, 4
   384 000001AA 2A1D[FC7E0000]          	sub	bl, byte [WAVE_BlockAlign]
   385                                  			; = 0 for 16 bit stereo
   386                                  			; = 2 for 8 bit stereo or 16 bit mono
   387                                  			; = 3 for 8 bit mono	
   388                                  
   389 000001B0 D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   390                                  	; 15/11/2024
   391 000001B2 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   392 000001B5 881D[6E7F0000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   393                                  					; = 0 stereo and 16 bit
   394                                  					; = 1 mono or 8 bit
   395                                  
   396                                  ; -------------------------------------------------------------
   397                                  
   398                                  	; 25/12/2024
   399 000001BB 803D[49410000]00        	cmp 	byte [IsInSplash], 0
   400                                  	;jna	short StartPlay
   401                                  	; 27/12/2024
   402 000001C2 7672                    	jna	short StartPlay@
   403                                  
   404                                  ; -------------------------------------------------------------
   405                                  
   406                                  	; 26/12/2024
   407                                  Player_SplashScreen:
   408                                  	; 21/12/2024
   409                                  	;mov	byte [tcolor], 15
   410                                  _0:
   411 000001C4 E89C040000              	call	drawsplashscreen
   412                                  
   413                                  	; 21/12/2024
   414                                  	;;;
   415                                  	; set wave volume led addresses
   416 000001C9 8B1D[B8740000]          	mov	ebx, [LFB_ADDR]
   417 000001CF 81C300C70100            	add	ebx, (13*80*8*14)
   418 000001D5 BD50000000              	mov	ebp, 80
   419 000001DA BF[705F0000]            	mov	edi, wleds_addr
   420                                  wleds_sa_1:
   421 000001DF B90F000000              	mov	ecx, 15
   422                                  wleds_sa_2:
   423 000001E4 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   424 000001E9 F7E1                    	mul	ecx
   425 000001EB 01D8                    	add	eax, ebx
   426 000001ED AB                      	stosd
   427 000001EE E2F4                    	loop	wleds_sa_2
   428 000001F0 89D8                    	mov	eax, ebx
   429 000001F2 AB                      	stosd
   430 000001F3 83C308                  	add	ebx, 8
   431 000001F6 4D                      	dec	ebp
   432 000001F7 75E6                    	jnz	short wleds_sa_1
   433                                  	;;;
   434                                  
   435                                  	; 25/12/5024
   436                                  	; 28/11/2024 
   437 000001F9 833D[0C7F0000]FF        	cmp	dword [filehandle], -1
   438 00000200 7540                    	jne	short StartPlay
   439                                  
   440                                  	; 24/12/2024
   441                                  	; 07/12/2024
   442                                  	;;; wait for 3 seconds
   443                                  	sys	_time, 0 ; get time in unix epoch format
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000202 BB00000000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000207 B80D000000          <1>  mov eax, %1
   100                              <1> 
   101 0000020C CD40                <1>  int 40h
   444 0000020E 89C1                    	mov	ecx, eax
   445 00000210 83C103                  	add	ecx, 3
   446                                  _wait_3s:
   447 00000213 90                      	nop
   448                                  	sys	_time, 0
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000214 BB00000000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000219 B80D000000          <1>  mov eax, %1
   100                              <1> 
   101 0000021E CD40                <1>  int 40h
   449 00000220 39C8                    	cmp	eax, ecx
   450 00000222 72EF                    	jb	short _wait_3s
   451                                  	;;;
   452                                  
   453                                  	; 25/12/2024
   454                                  	; 28/11/2024
   455 00000224 C605[49410000]00        	mov	byte [IsInSplash], 0
   456                                  	;mov	edx, wav_file_name
   457                                  	; 30/11/2024
   458 0000022B 8B35[147F0000]          	mov	esi, [argvf]
   459                                  	; 29/11/2024
   460 00000231 E9C9FEFFFF              	jmp	Player_ParseNextParameter
   461                                  
   462                                  ; -------------------------------------------------------------
   463                                  
   464                                  	; 27/12/2024
   465                                  StartPlay@:
   466                                  
   467                                  	; 27/12/2024 (Detect & Enable AC97 hardware again)
   468                                  	; (this is needed after disabling audio system)
   469                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
   470                                          sys	_audio, 0102h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000236 BB02010000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000023B B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000240 CD40                <1>  int 40h
   471                                  	; ignore error at this stage
   472                                  	;jc	short ac97_not_detected
   473                                  
   474                                  ; -------------------------------------------------------------
   475                                  
   476                                  	; 25/12/2024
   477                                  StartPlay:
   478 00000242 FE05[D97E0000]          	inc	byte [filecount]
   479 00000248 C605[D87E0000]00        	mov	byte [command], 0
   480                                  
   481                                  ; -------------------------------------------------------------
   482                                  
   483                                  	; 07/12/2024 (playwav9.s)
   484                                  
   485                                  	; 18/11/2023 (ich_wav4.asm)
   486                                  	; 13/11/2023 (ich_wav3.asm)
   487                                  
   488 0000024F 803D[D67E0000]01        	cmp	byte [VRA], 1
   489 00000256 7226                    	jb	short chk_sample_rate
   490                                  
   491                                  playwav_48_khz:
   492 00000258 C705[7C7F0000]-         	mov	dword [loadfromwavfile], loadFromFile
   492 0000025E [9F090000]         
   493                                  	;mov	dword [loadsize], 0 ; 65536
   494                                  	;;;
   495                                  	; 17/11/2024
   496                                  	;mov	word [buffersize], 32768
   497                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   498                                  	; 30/11/2024
   499                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   500                                  	; 07/12/2024
   501 00000262 B800000100              	mov	eax, BUFFERSIZE ; 65536
   502 00000267 A3[847F0000]            	mov	[buffersize], eax	; 16 bit samples
   503                                  	; 07/12/2024
   504                                  	;shl	eax, 1			; bytes
   505 0000026C 8A0D[6E7F0000]          	mov	cl, [fbs_shift]
   506 00000272 D3E8                    	shr	eax, cl 
   507                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   508 00000274 A3[807F0000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   509                                  	;;;
   510                                  	;jmp	PlayNow ; 30/05/2024
   511                                  	; 07/12/2024
   512 00000279 E95F020000              	jmp	Player_Template
   513                                  
   514                                  chk_sample_rate:
   515                                  	; set conversion parameters
   516                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   517 0000027E 66A1[F47E0000]          	mov	ax, [WAVE_SampleRate]
   518 00000284 663D80BB                	cmp	ax, 48000
   519 00000288 74CE                    	je	short playwav_48_khz
   520                                  chk_22khz:
   521 0000028A 663D2256                	cmp	ax, 22050
   522 0000028E 7545                    	jne	short chk_11khz
   523 00000290 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   524 00000297 7615                    	jna	short chk_22khz_1
   525 00000299 BB[09190000]            	mov	ebx, load_22khz_stereo_16_bit
   526 0000029E 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   527 000002A5 751A                    	jne	short chk_22khz_2
   528 000002A7 BB[7C180000]            	mov	ebx, load_22khz_mono_16_bit
   529 000002AC EB13                    	jmp	short chk_22khz_2
   530                                  chk_22khz_1:
   531 000002AE BB[F5170000]            	mov	ebx, load_22khz_stereo_8_bit
   532 000002B3 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   533 000002BA 7505                    	jne	short chk_22khz_2
   534 000002BC BB[6C170000]            	mov	ebx, load_22khz_mono_8_bit
   535                                  chk_22khz_2:
   536 000002C1 B85A1D0000              	mov	eax, 7514  ; (442*17)
   537 000002C6 BA25000000              	mov	edx, 37
   538 000002CB B911000000              	mov	ecx, 17
   539 000002D0 E9DB010000              	jmp	set_sizes
   540                                  chk_11khz:
   541 000002D5 663D112B                	cmp	ax, 11025
   542 000002D9 7545                    	jne	short chk_44khz
   543 000002DB 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   544 000002E2 7615                    	jna	short chk_11khz_1
   545 000002E4 BB[251B0000]            	mov	ebx, load_11khz_stereo_16_bit
   546 000002E9 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   547 000002F0 751A                    	jne	short chk_11khz_2
   548 000002F2 BB[AC1A0000]            	mov	ebx, load_11khz_mono_16_bit
   549 000002F7 EB13                    	jmp	short chk_11khz_2
   550                                  chk_11khz_1:
   551 000002F9 BB[321A0000]            	mov	ebx, load_11khz_stereo_8_bit
   552 000002FE 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1 
   553 00000305 7505                    	jne	short chk_11khz_2
   554 00000307 BB[BA190000]            	mov	ebx, load_11khz_mono_8_bit
   555                                  chk_11khz_2:
   556 0000030C B8AD0E0000              	mov	eax, 3757  ; (221*17)
   557 00000311 BA4A000000              	mov	edx, 74
   558 00000316 B911000000              	mov	ecx, 17
   559 0000031B E990010000              	jmp	set_sizes
   560                                  chk_44khz:
   561 00000320 663D44AC                	cmp	ax, 44100
   562 00000324 7545                    	jne	short chk_16khz
   563 00000326 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   564 0000032D 7615                    	jna	short chk_44khz_1
   565 0000032F BB[2C1D0000]            	mov	ebx, load_44khz_stereo_16_bit
   566 00000334 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   567 0000033B 751A                    	jne	short chk_44khz_2
   568 0000033D BB[B31C0000]            	mov	ebx, load_44khz_mono_16_bit
   569 00000342 EB13                    	jmp	short chk_44khz_2
   570                                  chk_44khz_1:
   571 00000344 BB[361C0000]            	mov	ebx, load_44khz_stereo_8_bit
   572 00000349 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   573 00000350 7505                    	jne	short chk_44khz_2
   574 00000352 BB[BA1B0000]            	mov	ebx, load_44khz_mono_8_bit
   575                                  chk_44khz_2:
   576                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   577 00000357 B8D93A0000              	mov	eax, 15065 ; (655*23)
   578                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   579                                  	;mov	ax, 14076 ; (612*23)
   580                                  	; 17/11/2024
   581                                  	;mov	ax, 12650 ; (550*23)
   582 0000035C BA19000000              	mov	edx, 25
   583 00000361 B917000000              	mov	ecx, 23
   584 00000366 E945010000              	jmp	set_sizes
   585                                  chk_16khz:
   586 0000036B 663D803E                	cmp	ax, 16000
   587 0000036F 7545                    	jne	short chk_8khz
   588 00000371 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   589 00000378 7615                    	jna	short chk_16khz_1
   590 0000037A BB[B1120000]            	mov	ebx, load_16khz_stereo_16_bit
   591 0000037F 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1 
   592 00000386 751A                    	jne	short chk_16khz_2
   593 00000388 BB[30120000]            	mov	ebx, load_16khz_mono_16_bit
   594 0000038D EB13                    	jmp	short chk_16khz_2
   595                                  chk_16khz_1:
   596 0000038F BB[76110000]            	mov	ebx, load_16khz_stereo_8_bit
   597 00000394 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   598 0000039B 7505                    	jne	short chk_16khz_2
   599 0000039D BB[F7100000]            	mov	ebx, load_16khz_mono_8_bit
   600                                  chk_16khz_2:
   601                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   602 000003A2 B855150000              	mov	eax, 5461
   603                                  	; 17/11/2024
   604                                  	;mov	ax, 5460
   605 000003A7 BA03000000              	mov	edx, 3
   606 000003AC B901000000              	mov	ecx, 1
   607 000003B1 E9FA000000              	jmp	set_sizes
   608                                  chk_8khz:
   609 000003B6 663D401F                	cmp	ax, 8000
   610 000003BA 7545                    	jne	short chk_24khz
   611 000003BC 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   612 000003C3 7615                    	jna	short chk_8khz_1
   613 000003C5 BB[AC0F0000]            	mov	ebx, load_8khz_stereo_16_bit
   614 000003CA 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   615 000003D1 751A                    	jne	short chk_8khz_2
   616 000003D3 BB[DC0E0000]            	mov	ebx, load_8khz_mono_16_bit
   617 000003D8 EB13                    	jmp	short chk_8khz_2
   618                                  chk_8khz_1:
   619 000003DA BB[AC0D0000]            	mov	ebx, load_8khz_stereo_8_bit
   620 000003DF 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1 
   621 000003E6 7505                    	jne	short chk_8khz_2
   622 000003E8 BB[C80C0000]            	mov	ebx, load_8khz_mono_8_bit
   623                                  chk_8khz_2:
   624 000003ED B8AA0A0000              	mov	eax, 2730
   625 000003F2 BA06000000              	mov	edx, 6
   626 000003F7 B901000000              	mov	ecx, 1
   627 000003FC E9AF000000              	jmp	set_sizes
   628                                  chk_24khz:
   629 00000401 663DC05D                	cmp	ax, 24000
   630 00000405 7563                    	jne	short chk_32khz
   631 00000407 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   632 0000040E 7615                    	jna	short chk_24khz_1
   633                                  	; 18/01/2025 (BugFix)
   634                                  	; bx -> ebx
   635 00000410 BB[DB140000]            	mov	ebx, load_24khz_stereo_16_bit
   636 00000415 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   637 0000041C 751A                    	jne	short chk_24khz_2
   638 0000041E BB[78140000]            	mov	ebx, load_24khz_mono_16_bit
   639 00000423 EB13                    	jmp	short chk_24khz_2
   640                                  chk_24khz_1:
   641 00000425 BB[EE130000]            	mov	ebx, load_24khz_stereo_8_bit
   642 0000042A 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1 
   643 00000431 7505                    	jne	short chk_24khz_2
   644 00000433 BB[87130000]            	mov	ebx, load_24khz_mono_8_bit
   645                                  chk_24khz_2:
   646                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   647 00000438 B800200000              	mov	eax, 8192
   648                                  	; 17/11/2024
   649                                  	;mov	ax, 8190
   650 0000043D BA02000000              	mov	edx, 2
   651 00000442 B901000000              	mov	ecx, 1
   652 00000447 EB67                    	jmp	short set_sizes
   653                                  
   654                                  	; 07/12/2024
   655                                  vra_needed:
   656                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   657                                  	; 13/11/2023
   658 00000449 58                      	pop	eax ; discard return address to the caller
   659                                  	; 30/05/2024
   660                                  vra_err:
   661                                  	; 21/12/2024
   662 0000044A E875020000              	call	set_text_mode
   663                                  	; 30/11/2024
   664                                  	sys	_msg, msg_no_vra, 255, 0Fh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000044F BB[2C2B0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000454 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000459 BA0F000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000045E B823000000          <1>  mov eax, %1
   100                              <1> 
   101 00000463 CD40                <1>  int 40h
   665 00000465 E977010000              	jmp	Exit
   666                                  
   667                                  chk_32khz:
   668 0000046A 663D007D                	cmp	ax, 32000
   669 0000046E 75D9                    	jne	short vra_needed
   670 00000470 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8
   671 00000477 7615                    	jna	short chk_32khz_1
   672 00000479 BB[DC160000]            	mov	ebx, load_32khz_stereo_16_bit
   673 0000047E 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   674 00000485 751A                    	jne	short chk_32khz_2
   675 00000487 BB[72160000]            	mov	ebx, load_32khz_mono_16_bit
   676 0000048C EB13                    	jmp	short chk_32khz_2
   677                                  chk_32khz_1:
   678 0000048E BB[D5150000]            	mov	ebx, load_32khz_stereo_8_bit
   679 00000493 803D[F27E0000]01        	cmp	byte [WAVE_NumChannels], 1
   680 0000049A 7505                    	jne	short chk_32khz_2
   681 0000049C BB[62150000]            	mov	ebx, load_32khz_mono_8_bit
   682                                  chk_32khz_2:
   683                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   684 000004A1 B8AA2A0000              	mov	eax, 10922
   685                                  	; 17/11/2024
   686                                  	;mov	ax, 10920
   687 000004A6 BA03000000              	mov	edx, 3
   688 000004AB B902000000              	mov	ecx, 2
   689                                  	;jmp	short set_sizes
   690                                  set_sizes:
   691                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   692                                  	;;;
   693                                  	; 17/11/2024
   694 000004B0 51                      	push	ecx
   695 000004B1 B102                    	mov	cl, 2
   696 000004B3 2A0D[6E7F0000]          	sub	cl, [fbs_shift]
   697                                  		; = 2 for 16 bit stereo
   698                                  		; = 1 for 16 bit mono or 8 bit stereo
   699                                  		; = 0 for 8 bit mono
   700 000004B9 D3E0                    	shl	eax, cl
   701 000004BB 59                      	pop	ecx	
   702 000004BC A3[807F0000]            	mov	[loadsize], eax	; (one) read count in bytes
   703                                  	;;;
   704 000004C1 F7E2                    	mul	edx
   705 000004C3 83F901                  	cmp	ecx, 1
   706 000004C6 7402                    	je	short s_2
   707                                  s_1:
   708 000004C8 F7F1                    	div	ecx
   709                                  s_2:
   710                                  	;;;
   711                                  	; eax = byte count of (to be) converted samples 
   712                                  	
   713                                  	; 17/11/2024
   714                                  	;;;
   715 000004CA 8A0D[6E7F0000]          	mov	cl, [fbs_shift]
   716                                  
   717 000004D0 D3E0                    	shl	eax, cl
   718                                  		; *1 for 16 bit stereo
   719                                  		; *2 for 16 bit mono or 8 bit stereo
   720                                  		; *4 for for 8 bit mono
   721                                  	;;;
   722                                  
   723                                  	; eax = 16 bit stereo byte count (target buffer size)
   724                                  	
   725                                  	; 07/12/2024
   726                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   727 000004D2 A3[847F0000]            	mov	[buffersize], eax ; buffer size in bytes
   728 000004D7 891D[7C7F0000]          	mov	[loadfromwavfile], ebx
   729                                  
   730                                  ; -------------------------------------------------------------
   731                                  
   732                                  Player_Template:
   733                                  
   734                                  	; 26/12/2024
   735 000004DD 803D[49410000]00        	cmp 	byte [IsInSplash], 0
   736 000004E4 7611                    	jna	short Player_Template_@
   737                                  
   738                                  	; 24/12/2024 (setting for wave lighting points)
   739 000004E6 A1[B8740000]            	mov	eax, [LFB_ADDR]
   740                                  	;add	eax, 228*640 ; wave graphics start (top) line/row
   741 000004EB 05009A0100              	add	eax, 164*640 ; 256 volume levels ; 24/12/2024
   742 000004F0 A3[B4740000]            	mov	[graphstart], eax
   743                                  
   744                                  	; 26/12/2024
   745 000004F5 EB14                    	jmp	short PlayNow
   746                                  
   747                                  Player_Template_@:
   748                                  	; 21/12/2024
   749 000004F7 E859010000              	call	clearscreen
   750 000004FC E870010000              	call	drawplayingscreen
   751                                  
   752                                  	; 14/11/2024
   753 00000501 E882200000              	call	SetTotalTime
   754 00000506 E84F210000              	call	UpdateFileInfo
   755                                  
   756                                  ; -------------------------------------------------------------
   757                                  
   758                                  	; 21/12/2024 (VGA/LFB modifications)
   759                                  	; (Direct access/map to the LFB is already done here)
   760                                  	; ((this program is in VESA/VBE graphics mode here))
   761                                  PlayNow:
   762                                  	; 07/12/2024
   763                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000050B BB00020000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000510 8B0D[847F0000]      <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000516 BA[00800000]        <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000051B B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000520 CD40                <1>  int 40h
   764 00000522 0F82FF000000            	jc	error_exit ; return to text mode and print err msg
   765                                  
   766                                  	; 01/06/2024
   767                                  	; Initialize Audio Device (bh = 3)
   768                                  	sys	_audio, 0301h, 0, audio_int_handler
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000528 BB01030000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000052D B900000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000532 BA[8B090000]        <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000537 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 0000053C CD40                <1>  int 40h
   769                                  	;jc	short error_exit
   770 0000053E 0F82C3000000            	jc	init_err ; return to text mode and print err msg
   771                                  
   772                                  	; 30/05/2024
   773                                  	; playwav4.asm
   774                                  ;_2:	; 24/12/2024
   775                                  	;call	check4keyboardstop	; flush keyboard buffer
   776                                  	;jc	short _2		; 07/11/2023
   777                                  
   778                                  	;;;
   779                                  	; 26/12/2024
   780                                  	; 14/11/2024
   781                                  	;mov	al, 3	; 0 = max, 31 = min
   782                                  	; 15/11/2024
   783 00000544 E86E030000              	call	SetMasterVolume
   784                                  
   785                                  	; 26/12/2024
   786 00000549 803D[49410000]00        	cmp 	byte [IsInSplash], 0
   787 00000550 770A                    	ja	short _2
   788                                  
   789                                  	; 07/12/2024
   790                                  	;call	SetPCMOutVolume
   791 00000552 E884210000              	call	UpdateVolume
   792                                  	;;;
   793                                  	; 14/11/2024
   794 00000557 E80F220000              	call	UpdateProgressBar
   795                                  	;;;
   796                                  
   797                                  	; 26/12/2024
   798                                  _2:
   799                                  
   800                                  ; play the .wav file. Most of the good stuff is in here.
   801                                  	
   802                                  	; 05/12/2024
   803 0000055C E86A010000              	call    PlayWav
   804                                  
   805                                  ; close the .wav file and exit.
   806                                  
   807                                  	; 25/12/2024
   808 00000561 E8D8030000              	call	closeFile
   809                                  
   810                                  	; 25/12/2024
   811                                  	;;;
   812                                  	; reset file loading and EOF parameters
   813                                  	; 18/12/2024
   814 00000566 C705[907F0000]0000-     	mov	dword [count], 0
   814 0000056E 0000               
   815 00000570 C705[947F0000]0000-     	mov	dword [LoadedDataBytes], 0
   815 00000578 0000               
   816 0000057A C605[0A7F0000]00        	mov	byte [flags], 0
   817 00000581 C605[C87E0000]00        	mov	byte [stopped], 0
   818                                  	; 26/12/2024
   819 00000588 C605[D47E0000]FF        	mov	byte [pbuf_s], 0FFh
   820                                  	;;;
   821                                  
   822                                  ;	cmp	byte [IsInSplash], 0
   823                                  ;	jna	short _6
   824                                  ;	mov	byte [IsInSplash], 0
   825                                  ;	mov	esi, [argvf]
   826                                  ;	jmp	Player_ParseNextParameter
   827                                  ;
   828                                  ;	; 29/11/2024
   829                                  ;_6:
   830                                  ;	cmp	byte [command], 'Q'
   831                                  ;	je	short _7	; 25/12/2024
   832                                  ;	jmp	check_p_command
   833                                  ;
   834                                  ;_7:
   835                                  	; 07/12/2024
   836                                  	;;;
   837                                  	; Stop Playing
   838                                  	;sys	_audio, 0700h
   839                                  	; Cancel callback service (for user)
   840                                  	sys	_audio, 0900h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000058F BB00090000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000594 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000599 CD40                <1>  int 40h
   841                                  	; Deallocate Audio Buffer (for user)
   842                                  	sys	_audio, 0A00h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000059B BB000A0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000005A0 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 000005A5 CD40                <1>  int 40h
   843                                  	; Disable Audio Device
   844                                  	sys	_audio, 0C00h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000005A7 BB000C0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000005AC B820000000          <1>  mov eax, %1
   100                              <1> 
   101 000005B1 CD40                <1>  int 40h
   845                                  	;;;
   846                                  
   847                                  	; 27/12/2024
   848                                  	; 26/12/2024
   849 000005B3 803D[49410000]00        	cmp	byte [IsInSplash], 0
   850 000005BA 7612                    	jna	short _6
   851 000005BC C605[49410000]00        	mov	byte [IsInSplash], 0
   852 000005C3 8B35[147F0000]          	mov	esi, [argvf]
   853 000005C9 E931FBFFFF              	jmp	Player_ParseNextParameter
   854                                  _6:
   855 000005CE 803D[D87E0000]51        	cmp	byte [command], 'Q'
   856 000005D5 7405                    	je	short terminate
   857 000005D7 E9F9FAFFFF              	jmp	check_p_command
   858                                  
   859                                  terminate:
   860 000005DC E8E3000000              	call	set_text_mode
   861                                  Exit:
   862                                  	sys	_exit
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91                              <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000005E1 B801000000          <1>  mov eax, %1
   100                              <1> 
   101 000005E6 CD40                <1>  int 40h
   863                                  halt:
   864 000005E8 EBFE                    	jmp	short halt
   865                                  
   866                                  ; -------------------------------------------------------------
   867                                  
   868                                  	; 30/05/2024
   869                                  pmsg_usage:
   870                                  	; 21/12/2024
   871 000005EA E8D5000000              	call	set_text_mode
   872                                  	; 01/12/2024
   873                                  	sys	_msg, msg_usage, 255, 0Fh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000005EF BB[672A0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000005F4 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000005F9 BA0F000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000005FE B823000000          <1>  mov eax, %1
   100                              <1> 
   101 00000603 CD40                <1>  int 40h
   874 00000605 EBDA                    	jmp	short Exit
   875                                  
   876                                  ; -------------------------------------------------------------
   877                                  
   878                                  	; 30/05/2024
   879                                  init_err:
   880                                  	; 21/12/2024
   881 00000607 E8B8000000              	call	set_text_mode
   882                                  	; 01/12/2024
   883                                  	sys	_msg, msg_init_err, 255, 0Fh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000060C BB[FB2A0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000611 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000616 BA0F000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000061B B823000000          <1>  mov eax, %1
   100                              <1> 
   101 00000620 CD40                <1>  int 40h
   884 00000622 EBBD                    	jmp	short Exit
   885                                  
   886                                  ; -------------------------------------------------------------
   887                                  
   888                                  	; 02/12/2024
   889                                  Player_Quit@:
   890 00000624 58                      	pop	eax ; return addr (call PlayWav@)
   891                                  	
   892                                  	; 29/11/2024
   893                                  Player_Quit:
   894 00000625 EBB5                    	jmp	 short terminate
   895                                  
   896                                  
   897                                  ; -------------------------------------------------------------
   898                                  
   899                                  	; 07/12/2024
   900                                  error_exit:
   901                                  	; 21/12/2024
   902 00000627 E898000000              	call	set_text_mode
   903                                  trdos386_error:
   904                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000062C BB[DB2A0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000631 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000636 BA0E000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000063B B823000000          <1>  mov eax, %1
   100                              <1> 
   101 00000640 CD40                <1>  int 40h
   905 00000642 EB9D                    	jmp	short Exit
   906                                  
   907                                  ; -------------------------------------------------------------
   908                                  
   909                                  	; 21/12/2024
   910                                  print_msg:
   911 00000644 B40E                    	mov	ah, 0Eh
   912 00000646 BB07000000              	mov	ebx, 7
   913                                  	;mov	bl, 7 ; char attribute & color
   914                                  p_next_chr:
   915 0000064B AC                      	lodsb
   916 0000064C 08C0                    	or	al, al
   917 0000064E 7404                    	jz	short p_retn ; retn
   918 00000650 CD31                    	int	31h
   919 00000652 EBF7                    	jmp	short p_next_chr
   920                                  p_retn:
   921 00000654 C3                      	retn
   922                                  
   923                                  ; -------------------------------------------------------------
   924                                  
   925                                  	; 21/12/2024
   926                                  clearscreen:
   927                                  	; fast clear
   928                                  	; 640*480, 256 colors
   929 00000655 8B3D[B8740000]          	mov	edi, [LFB_ADDR]
   930 0000065B B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   931 00000660 31C0                    	xor	eax, eax
   932 00000662 F3AB                    	rep	stosd
   933 00000664 C3                      	retn
   934                                  
   935                                  ; -------------------------------------------------------------
   936                                  
   937                                  	; 26/12/2024
   938                                  	; 21/12/2024
   939                                  drawsplashscreen:
   940 00000665 BD[582C0000]            	mov	ebp, SplashScreen
   941                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   942                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   943                                  	;mov	esi, 0 ; row 0, column 0
   944 0000066A BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   945 0000066F EB0A                    	jmp	short p_d_x
   946                                  drawplayingscreen:
   947 00000671 BD[F9360000]            	mov	ebp, PlayingScreen
   948                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   949                                  	;mov	esi, 0 ; row 0, column 0
   950 00000676 BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   951                                  p_d_x:
   952 0000067B C605[C4740000]50        	mov	byte [columns], 80
   953                                  p_d_x_n:
   954 00000682 31D2                    	xor	edx, edx
   955 00000684 8A5500                  	mov	dl, [ebp]
   956 00000687 20D2                    	and	dl, dl
   957 00000689 7438                    	jz	short p_d_x_ok
   958 0000068B C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   959                                  
   960 0000068E BF[704F0000]            	mov	edi, fontbuff2 ; start of user font data
   961 00000693 01D7                    	add	edi, edx
   962                                  	
   963                                  	;; NOTE: Following system call writes fonts at
   964                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   965                                  	;; screen width as 640 pixels (instead of 320 pixels)
   966                                  	;; so 8Fh is sub function 0Fh (write char)
   967                                  	;; with 640 pixels screen witdh. 
   968                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   969                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   970                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   971                                  	;; region, the text is appeared on screen
   972                                  	;; while LFB is at C0000000h or E0000000h.)
   973                                  
   974                                  	;sys	_video, 018Fh, [tcolor], 8001h
   975                                  			;; use STD VGA video memory
   976                                  			;; (0A0000h)
   977                                  	;sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
   978                                  		 ; use LFB for current VBE mode
   979                                  		 ; for writing fonts on screen
   980                                  	; 26/12/2024
   981                                  	sys	_video, 020Fh, 0Fh, 8001h ; 8x16 user font
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000695 BB0F020000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000069A B90F000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000069F BA01800000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000006A4 B81F000000          <1>  mov eax, %1
   100                              <1> 
   101 000006A9 CD40                <1>  int 40h
   982                                  
   983 000006AB 45                      	inc	ebp
   984 000006AC 6683C608                	add	si, 8 ; next char pos
   985 000006B0 FE0D[C4740000]          	dec	byte [columns]
   986 000006B6 75CA                    	jnz	short p_d_x_n	; next column
   987 000006B8 6631F6                  	xor	si, si
   988                                  	;;add	esi, 00100000h	; next row ; 8*16
   989                                  	;add	esi, [nextrow]
   990 000006BB 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   991 000006C1 EBB8                    	jmp	short p_d_x
   992                                  p_d_x_ok:
   993 000006C3 C3                      	retn
   994                                  
   995                                  ; -------------------------------------------------------------
   996                                  
   997                                  	; 21/12/2024
   998                                  set_text_mode:
   999 000006C4 30E4                    	xor    ah, ah
  1000 000006C6 B003                    	mov    al, 3                        
  1001                                   	;int   10h ; al = 03h text mode, int 10 video
  1002 000006C8 CD31                    	int    31h ; TRDOS 386 - Video interrupt
  1003 000006CA C3                      	retn
  1004                                  
  1005                                  ; -------------------------------------------------------------
  1006                                  
  1007                                  	; 07/12/2024 (playwav9.s)
  1008                                  	; 26/11/2023 (playwav8.s)
  1009                                  PlayWav:
  1010                                  	; 19/11/2024
  1011 000006CB C605[CB7E0000]01        	mov	byte [wleds], 1
  1012                                  
  1013                                  	;;;
  1014                                  	; 09/12/2024
  1015 000006D2 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
  1016 000006D7 803D[D67E0000]00        	cmp	byte [VRA], 0
  1017 000006DE 7614                    	jna	short _3 ; 48kHZ (interpolation)
  1018                                  	;;;
  1019                                  	; 01/12/2024 (32bit)
  1020                                  	;movzx	eax, word [WAVE_SampleRate]
  1021                                  	; 09/12/2024
  1022 000006E0 66A1[F47E0000]          	mov	ax, [WAVE_SampleRate]
  1023 000006E6 B90A000000              	mov	ecx, 10
  1024 000006EB F7E1                    	mul	ecx
  1025 000006ED B1B6                    	mov	cl, 182
  1026 000006EF F7F1                    	div	ecx
  1027                                  	; ax = samples per 1/18.2 second
  1028                                  	;mov	cl, byte [WAVE_BlockAlign]
  1029                                  	; 09/12/2024 
  1030                                  	;mov	cl, 4 ; 16 bit, stereo
  1031                                  	;mul	ecx
  1032 000006F1 C1E002                  	shl	eax, 2 ; * 4
  1033                                  _3:
  1034 000006F4 A3[CC7E0000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
  1035                                  				; for wave volume leds update
  1036                                  				; (byte stream per 1/18.2 second)
  1037                                  	;;;
  1038                                  	; 24/12/2024
  1039 000006F9 3D000A0000              	cmp	eax, 640*4 ; 640 samples (for 640 wave light points)
  1040 000006FE 7305                    	jnb	short _4
  1041 00000700 B8000A0000              	mov	eax, 640*4	
  1042                                  _4:
  1043 00000705 A3[B0740000]            	mov	[wpoints_dif], eax
  1044                                  	;;;
  1045                                  
  1046                                  RePlayWav:
  1047                                  	; 07/12/2024
  1048 0000070A BF[00800000]            	mov	edi, audio_buffer
  1049 0000070F FF15[7C7F0000]          	call	dword [loadfromwavfile]
  1050 00000715 0F820CFFFFFF            	jc	error_exit
  1051                                  
  1052 0000071B C605[D57E0000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
  1053                                  
  1054 00000722 A1[907F0000]            	mov	eax, [count]
  1055 00000727 0105[947F0000]          	add	[LoadedDataBytes], eax
  1056                                  
  1057 0000072D F605[0A7F0000]01        	test    byte [flags], ENDOFFILE  ; end of file
  1058 00000734 752C                    	jnz	short _5 ; yes
  1059                                  			 ; bypass filling dma half buffer 2
  1060                                  
  1061                                  	; bh = 16 : update (current, first) dma half buffer
  1062                                  	; bl = 0  : then switch to the next (second) half buffer
  1063                                  	sys	_audio, 1000h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000736 BB00100000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000073B B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000740 CD40                <1>  int 40h
  1064                                  
  1065                                  	; 18/12/2024
  1066 00000742 C705[907F0000]0000-     	mov	dword [count], 0
  1066 0000074A 0000               
  1067                                  
  1068                                  	; 07/12/2024
  1069 0000074C BF[00800000]            	mov	edi, audio_buffer
  1070 00000751 FF15[7C7F0000]          	call	dword [loadfromwavfile]
  1071                                  	;jc	error_exit
  1072                                  	
  1073 00000757 A1[907F0000]            	mov	eax, [count]
  1074 0000075C 0105[947F0000]          	add	[LoadedDataBytes], eax
  1075                                  _5:
  1076                                  	; 07/12/2024
  1077 00000762 668B0D[F47E0000]         	mov	cx, [WAVE_SampleRate]
  1078 00000769 B303                    	mov	bl, 3	; 16 bit, stereo
  1079 0000076B B704                    	mov	bh, 4	; start to play
  1080                                  	sys	_audio
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91                              <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000076D B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000772 CD40                <1>  int 40h
  1081                                  
  1082                                  	;;;
  1083                                  	; 26/12/2024
  1084                                  SplashLoop:
  1085 00000774 803D[49410000]00        	cmp	byte [IsInSplash], 0
  1086 0000077B 7648                    	jna	short _10
  1087                                  	;; skip 1st signal without sound data loading
  1088                                  	;nop
  1089                                  	;nop
  1090                                  	;nop
  1091                                  	;cmp	byte [SRB], 0
  1092                                  	;jna	short SplashLoop
  1093                                  	;mov	byte [SRB], 0
  1094                                  _8:
  1095 0000077D F605[0A7F0000]01        	test    byte [flags], ENDOFFILE  ; end of file
  1096 00000784 0F856E1B0000            	jnz	ac97_stop ; yes
  1097                                  
  1098                                  	; bh = 16 : update (current, first) dma half buffer
  1099                                  	; bl = 0  : then switch to the next (second) half buffer
  1100                                  	sys	_audio, 1000h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000078A BB00100000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000078F B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000794 CD40                <1>  int 40h
  1101                                  
  1102 00000796 803D[6F7F0000]00        	cmp	byte [SRB], 0
  1103 0000079D 7619                    	jna	short _9
  1104 0000079F C605[6F7F0000]00        	mov	byte [SRB], 0
  1105 000007A6 BF[00800000]            	mov	edi, audio_buffer
  1106 000007AB FF15[7C7F0000]          	call	dword [loadfromwavfile]
  1107 000007B1 7305                    	jnc	short _9
  1108                                  	; end of file
  1109                                  	;call	ac97_stop
  1110                                  	;retn
  1111 000007B3 E9401B0000              	jmp	ac97_stop
  1112                                  _9:
  1113 000007B8 E84C1D0000              	call	check4keyboardstop
  1114 000007BD 0F82B1000000            	jc	_exitt_
  1115 000007C3 EBB8                    	jmp	short _8
  1116                                  _10:
  1117                                  	; 26/12/2024
  1118 000007C5 803D[D77E0000]00        	cmp	byte [p_mode], 0
  1119 000007CC 7705                    	ja	short tuneLoop
  1120                                  	;;;
  1121                                  
  1122                                  ; -------------------------------------------
  1123                                  
  1124                                  	; 22/12/2024
  1125                                   	; prepare all leds as turned off
  1126 000007CE E89A200000              	call	reset_wave_leds
  1127                                  
  1128                                  ; -------------------------------------------
  1129                                  
  1130                                  	; 07/12/2024 (playwav9.s)
  1131                                  	; 01/12/2024 (32bit)
  1132                                  	; 29/11/2024
  1133                                  tuneLoop:
  1134                                  	; 30/05/2024
  1135                                  	; 18/11/2023 (ich_wav4.asm)
  1136                                  	; 08/11/2023
  1137                                  	; 06/11/2023
  1138                                  tLWait:
  1139                                  	; 18/11/2024
  1140 000007D3 803D[C87E0000]00        	cmp	byte [stopped], 0
  1141                                  	; 24/11/2024
  1142 000007DA 7641                    	jna	short tL1
  1143                                  
  1144                                  tLWait@:	; 21/11/2024
  1145                                  	;;;
  1146                                  	; 25/12/2024
  1147                                  	; 09/12/2024
  1148 000007DC 803D[C87E0000]03        	cmp	byte [stopped], 3
  1149 000007E3 0F838B000000            	jnb	_exitt_
  1150                                  	;;;
  1151 000007E9 E8461B0000              	call	checkUpdateEvents
  1152 000007EE 0F8280000000            	jc	_exitt_
  1153                                  	;;;
  1154                                  	; 25/12/2024
  1155                                  	; 29/11/2024
  1156 000007F4 803D[D87E0000]4E        	cmp	byte [command], 'N'
  1157 000007FB 7477                    	je	_exitt_
  1158 000007FD 803D[D87E0000]50        	cmp	byte [command], 'P'
  1159 00000804 746E                    	je	_exitt_
  1160                                  	;;;
  1161 00000806 803D[C97E0000]30        	cmp	byte [tLO], '0'
  1162 0000080D 74C4                    	je	short tLWait
  1163 0000080F E86A000000              	call	tLZ
  1164 00000814 C605[C97E0000]30        	mov	byte [tLO], '0'
  1165 0000081B EBB6                    	jmp	short tLWait
  1166                                  tL1:
  1167                                  	; 27/11/2024
  1168                                  	; Check AC'97 interrupt status
  1169 0000081D 803D[6F7F0000]00        	cmp	byte [SRB], 0
  1170 00000824 7709                    	ja	short tL3
  1171                                  tL2:
  1172 00000826 E8091B0000              	call	checkUpdateEvents
  1173 0000082B 7247                    	jc	_exitt_
  1174 0000082D EBA4                    	jmp	short tLWait
  1175                                  tL3:
  1176 0000082F 8035[D57E0000]01        	xor	byte [half_buffer], 1
  1177                                  	; 07/12/2024
  1178 00000836 C605[6F7F0000]00        	mov	byte [SRB], 0
  1179                                  
  1180                                  	; 07/12/2024
  1181 0000083D BF[00800000]            	mov	edi, audio_buffer
  1182                                  	;call	loadFromFile
  1183                                  	; 18/11/2023
  1184                                  	;call	word [loadfromwavfile]
  1185                                  	; 01/12/2024
  1186 00000842 FF15[7C7F0000]          	call	dword [loadfromwavfile]
  1187 00000848 722A                    	jc	short _exitt_	; end of file
  1188                                  
  1189                                  	; 07/12/2024
  1190                                  	;;;;
  1191                                  	; bh = 16 : update (current, first) dma half buffer
  1192                                  	; bl = 0  : then switch to the other half buffer
  1193                                  	sys	_audio, 1000h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000084A BB00100000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000084F B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000854 CD40                <1>  int 40h
  1194                                  	;;;;
  1195                                  
  1196                                  	; 26/11/2024
  1197 00000856 A0[D57E0000]            	mov	al, [half_buffer]
  1198 0000085B 0431                    	add	al, '1'
  1199                                  	; 19/11/2024
  1200 0000085D A2[C97E0000]            	mov	[tLO], al
  1201 00000862 E819000000              	call	tL0
  1202                                  
  1203                                  	; 24/11/2024
  1204                                  	; 14/11/2024
  1205                                  	;mov	ax, [count]
  1206                                  	;add	[LoadedDataBytes], ax
  1207                                  	;adc	word [LoadedDataBytes+2], 0
  1208                                  	; 01/12/2024
  1209 00000867 A1[907F0000]            	mov	eax, [count]
  1210 0000086C 0105[947F0000]          	add	[LoadedDataBytes], eax
  1211                                  
  1212                                  	; 07/12/2024 (playwav9.s)
  1213                                  	; 27/11/2024 (playwav9.asm)
  1214 00000872 EBB2                    	jmp	short tL2
  1215                                  
  1216                                  _exitt_:
  1217                                  	; 07/12/2024
  1218                                  	; Stop Playing
  1219                                  	;mov	byte [stopped], 2
  1220                                  	;sys	_audio, 0700h
  1221 00000874 E87F1A0000              	call	ac97_stop
  1222                                  
  1223                                  	;;;
  1224                                  	; 14/11/2024
  1225 00000879 E8ED1E0000              	call	UpdateProgressBar
  1226                                  	;;;
  1227                                  
  1228                                  	; 18/11/2024
  1229                                  tLZ:
  1230                                  	; 30/05/2024
  1231 0000087E B030                    	mov	al, '0'
  1232                                  
  1233                                  	;add	al, '0'
  1234                                  	;call	tL0
  1235                                  	;
  1236                                  	;retn
  1237                                  	; 06/11/2023
  1238                                  	;jmp	short tL0
  1239                                  	;retn
  1240                                  
  1241                                  	; 06/11/2023
  1242                                  tL0:
  1243                                  	; 29/05/2024 (TRDOS 386)
  1244                                  	; 08/11/2023
  1245                                  	; 05/11/2023
  1246                                  	; 17/02/2017 - Buffer switch test (temporary)
  1247                                  	; 06/11/2023
  1248                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1249                                  
  1250                                  	; 22/12/2024 (graphics mode modification)
  1251                                  	; (640*480, 256 colors)
  1252                                  	;;;
  1253                                  	;mov	ebp, 16
  1254 00000880 BD0E000000              	mov	ebp, 14
  1255 00000885 8B3D[B8740000]          	mov	edi, [LFB_ADDR]
  1256 0000088B 0FB6F0                  	movzx	esi, al
  1257 0000088E C1E604                  	shl	esi, 4 ; * 16
  1258 00000891 81C6[704F0000]          	add	esi, fontbuff2
  1259                                  tL0_1:
  1260 00000897 BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1261 0000089C 8A26                    	mov	ah, [esi]
  1262                                  tL0_2:
  1263 0000089E B00C                    	mov	al, 0Ch ; red
  1264 000008A0 D0E4                    	shl	ah, 1
  1265 000008A2 7302                    	jnc	short tL0_3
  1266 000008A4 B00E                    	mov	al, 0Eh ; yellow
  1267                                  tL0_3:
  1268 000008A6 AA                      	stosb
  1269 000008A7 4A                      	dec	edx
  1270 000008A8 75F4                    	jnz	short tL0_2
  1271 000008AA 4D                      	dec	ebp
  1272 000008AB 7409                    	jz	short tL0_4
  1273 000008AD 81C778020000            	add	edi, 640-8 ; next line
  1274 000008B3 46                      	inc	esi
  1275 000008B4 EBE1                    	jmp	short tL0_1
  1276                                  tL0_4:
  1277                                  	;;;
  1278 000008B6 C3                      	retn
  1279                                  
  1280                                  ; -------------------------------------------
  1281                                  
  1282                                  	; 26/12/2024
  1283                                  	; 07/12/2024
  1284                                  SetMasterVolume:
  1285 000008B7 A0[6C250000]            	mov	al, [volume]
  1286                                  	; 26/12/2024
  1287                                  	;mov	[volume], al  ; max = 0, min = 31
  1288                                  
  1289 000008BC B41F                    	mov	ah, 31
  1290 000008BE 28C4                    	sub	ah, al
  1291 000008C0 88E0                    	mov	al, ah
  1292                                  
  1293                                  	; Set Master Volume Level (BL=0 or 80h)
  1294                                  	; 	for next playing (BL>=80h)
  1295                                  	;sys	_audio, 0B80h, eax
  1296                                  	sys	_audio, 0B00h, eax
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000008C2 BB000B0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000008C7 89C1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000008C9 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 000008CE CD40                <1>  int 40h
  1297                                  	
  1298                                  setvolume_ok:
  1299                                  ac97_not_detected:
  1300 000008D0 C3                      	retn
  1301                                  
  1302                                  ; -------------------------------------------
  1303                                  
  1304                                  	; 07/12/2024 (playwav9.s)
  1305                                  DetectAC97:
  1306                                  DetectICH:
  1307                                  	; 25/11/2023 (playwav8.s)
  1308                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1309                                          sys	_audio, 0102h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000008D1 BB02010000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000008D6 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 000008DB CD40                <1>  int 40h
  1310                                  	;jnc	short d_ac97_@
  1311                                  	;retn
  1312 000008DD 72F1                    	jc	short ac97_not_detected
  1313                                  d_ac97_@:
  1314                                  	; 07/12/2024 (playwav9.s)
  1315                                  	; 06/06/2017
  1316                                  	sys	_audio, 0E00h ; get audio controller info
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000008DF BB000E0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000008E4 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 000008E9 CD40                <1>  int 40h
  1317 000008EB 0F8236FDFFFF            	jc	error_exit ; 25/11/2023
  1318                                  
  1319                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1320                                  	;jne	_dev_not_ready	
  1321                                  
  1322                                  	; EAX = IRQ Number in AL
  1323                                  	;	Audio Device Number in AH 
  1324                                  	; EBX = DEV/VENDOR ID
  1325                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1326                                  	; ECX = BUS/DEV/FN 
  1327                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1328                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1329                                  	;      (Low word, DX = NAMBAR address)
  1330                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1331                                  
  1332 000008F1 891D[747F0000]          	mov	[dev_vendor], ebx
  1333 000008F7 890D[707F0000]          	mov	[bus_dev_fn], ecx
  1334                                  
  1335 000008FD 668915[787F0000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1336                                  	;shr	edx, 16
  1337                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1338 00000904 8915[787F0000]          	mov	[NAMBAR], edx
  1339                                  
  1340 0000090A A2[0B7F0000]            	mov	[ac97_int_ln_reg], al
  1341                                  
  1342                                  	; 07/12/2024
  1343                                  	; 01/06/2024
  1344                                  	; 25/11/2023
  1345                                  	; Get AC'97 Codec info
  1346                                  	; (Function 14, sub function 1)
  1347                                  	sys	_audio, 0E01h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000090F BB010E0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000914 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00000919 CD40                <1>  int 40h
  1348                                  	; Save Variable Rate Audio support bit
  1349 0000091B 2401                    	and	al, 1
  1350 0000091D A2[D67E0000]            	mov	[VRA], al
  1351                                  
  1352                                  	;clc
  1353                                  
  1354 00000922 C3                      	retn
  1355                                  
  1356                                  ; ----------------------------------
  1357                                  	
  1358                                  	; 26/12/2024
  1359                                  	; 07/12/2024
  1360                                  	; 01/12/2024
  1361                                  	; 14/11/2024
  1362                                  	; INPUT: ds:dx = file name address
  1363                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1364                                  openFile:
  1365                                  	; 26/12/2024
  1366                                  	; 01/12/2024
  1367                                  	sys	_open, edx, 0
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000923 89D3                <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000925 B900000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000092A B805000000          <1>  mov eax, %1
   100                              <1> 
   101 0000092F CD40                <1>  int 40h
  1368                                  	; 07/12/2024
  1369                                  	;sys	_open, wav_file_name, 0
  1370 00000931 7305                    	jnc	short _of1
  1371                                  
  1372 00000933 B8FFFFFFFF              	mov	eax, -1
  1373                                  	; cf = 1 -> not found or access error
  1374                                  _of1:
  1375 00000938 A3[0C7F0000]            	mov	[filehandle], eax
  1376 0000093D C3                      	retn
  1377                                  
  1378                                  ; ----------------------------------
  1379                                  
  1380                                  ; close the currently open file
  1381                                  
  1382                                  	; 01/12/2024
  1383                                  	; 14/11/2024
  1384                                  	; INPUT: [filehandle] ; -1 = not open
  1385                                  	; OUTPUT: none
  1386                                  closeFile:
  1387 0000093E 833D[0C7F0000]FF        	cmp	dword [filehandle], -1
  1388 00000945 740D                    	jz	short _cf1
  1389                                  	; 01/12/2024
  1390                                  	sys	_close, [filehandle]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000947 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000094D B806000000          <1>  mov eax, %1
   100                              <1> 
   101 00000952 CD40                <1>  int 40h
  1391                                  	;mov 	dword [filehandle], -1
  1392                                  _cf1:
  1393 00000954 C3                      	retn
  1394                                  
  1395                                  ; ----------------------------------
  1396                                  
  1397                                  	; 01/12/2024
  1398                                  	; 14/11/2024 - Erdogan Tan
  1399                                  getWAVParameters:
  1400                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1401                                  ; entry: none - assumes file is already open
  1402                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1403                                  ;	cx = number of channels (mono=1, stereo=2)
  1404                                  ;	dx = bits per sample (8, 16)
  1405                                  ;	bx = number of bytes per sample (1 to 4)
  1406                                  
  1407                                          ;mov	dx, WAVFILEHEADERbuff
  1408                                  	;mov	bx, [filehandle]
  1409                                          ;mov	cx, 44			; 44 bytes
  1410                                  	;mov	ah, 3Fh
  1411                                          ;int	21h
  1412                                  	;jc	short gwavp_retn
  1413                                  	; 01/12/2024 (TRDOS 386)
  1414                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000955 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000095B B9[DC7E0000]        <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000960 BA2C000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000965 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 0000096A CD40                <1>  int 40h
  1415 0000096C 721C                    	jc	short gwavp_retn
  1416                                  
  1417 0000096E 83F82C                  	cmp	eax, 44
  1418 00000971 7217                    	jb	short gwavp_retn
  1419                                  
  1420 00000973 813D[E47E0000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1420 0000097B 5645               
  1421 0000097D 750A                    	jne	short gwavp_stc_retn
  1422                                  
  1423 0000097F 66833D[F07E0000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1424                                  	;jne	short gwavp_stc_retn
  1425 00000987 7401                    	je	short gwavp_retn ; 15/11/2024
  1426                                  
  1427                                  	; 15/11/2024
  1428                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1429                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1430                                  	;mov	dx, [WAVE_BitsPerSample] 
  1431                                  					; return bits per sample value in DX
  1432                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1433                                  ;gwavp_retn:
  1434                                          ;retn
  1435                                  
  1436                                  gwavp_stc_retn:
  1437 00000989 F9                      	stc
  1438                                  gwavp_retn:
  1439 0000098A C3                      	retn
  1440                                  
  1441                                  ; --------------------------------------------------------
  1442                                  ; 07/12/2024
  1443                                  ; --------------------------------------------------------
  1444                                  ; ref: playwav8.s (04/06/2024)
  1445                                  
  1446                                  audio_int_handler:
  1447                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1448                                  
  1449                                  	; 07/12/2024
  1450                                  	;mov	al, [stopped]
  1451                                  	;cmp	al, 2
  1452                                  	;je	short _callback_retn
  1453                                  
  1454                                  	; 18/08/2020
  1455                                  	;mov	byte [SRB], 1
  1456                                  	; 07/12/2024
  1457 0000098B FE05[6F7F0000]          	inc	byte [SRB]
  1458                                  
  1459                                  ;_callback_retn:
  1460                                  	sys	_rele ; return from callback service 
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91                              <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000991 B827000000          <1>  mov eax, %1
   100                              <1> 
   101 00000996 CD40                <1>  int 40h
  1461                                  	; we must not come here !
  1462                                  	sys	_exit
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91                              <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000998 B801000000          <1>  mov eax, %1
   100                              <1> 
   101 0000099D CD40                <1>  int 40h
  1463                                  
  1464                                  ; --------------------------------------------------------
  1465                                  ; 07/12/2024
  1466                                  ; --------------------------------------------------------
  1467                                  
  1468                                  ; /////
  1469                                  	; 14/12/2024
  1470                                  	; 07/12/2024
  1471                                  	; 01/12/2024
  1472                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1473                                  loadFromFile:
  1474                                  	; 07/11/2023
  1475                                  
  1476 0000099F F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1477                                  					; last of the file?
  1478 000009A6 7402                    	jz	short lff_0		; no
  1479 000009A8 F9                      	stc
  1480 000009A9 C3                      	retn
  1481                                  
  1482                                  lff_0:
  1483                                  	; 07/12/2024
  1484                                  	; 26/11/2023 (playwav8.s)
  1485                                  	;mov	edi, audio_buffer
  1486                                  
  1487                                  	; 01/12/2024 (TRDOS 386)
  1488                                  	; edi = audio buffer address
  1489                                  
  1490                                  	; 14/12/2024
  1491                                  	; 01/12/2024
  1492                                  	; 17/11/2024
  1493                                  	;mov	ebx, [filehandle]
  1494                                  	; 02/12/2024
  1495                                  	;mov	edx, [loadsize] 
  1496                                  
  1497                                  	; 17/11/2024
  1498 000009AA 803D[6E7F0000]00        	cmp	byte [fbs_shift], 0
  1499 000009B1 7677                    	jna	short lff_1 ; stereo, 16 bit
  1500                                  
  1501                                  lff_2:
  1502                                  	; 01/12/2024
  1503 000009B3 BE[00800100]            	mov	esi, temp_buffer 
  1504                                  	; 14/12/2024
  1505                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000009B8 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000009BE 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000009C0 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000009C6 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000009CB CD40                <1>  int 40h
  1506 000009CD 0F8289000000            	jc	lff_4 ; error !
  1507                                  
  1508                                  	; 01/12/2024
  1509                                  	; 14/11/2024
  1510 000009D3 A3[907F0000]            	mov	[count], eax
  1511                                  
  1512                                  	; 01/12/2024
  1513 000009D8 21C0                    	and	eax, eax
  1514                                  	;jz	short lff_3
  1515                                  	; 14/12/2024
  1516 000009DA 0F8485000000            	jz	lff_10
  1517                                  
  1518 000009E0 8A1D[6E7F0000]          	mov	bl, [fbs_shift]
  1519                                  
  1520                                  	; 14/12/2024
  1521 000009E6 89FA                    	mov	edx, edi ; audio buffer start address
  1522                                  
  1523                                  	; 01/12/2024
  1524 000009E8 89C1                    	mov	ecx, eax
  1525 000009EA 803D[FE7E0000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1526 000009F1 751E                    	jne	short lff_7 ; 16 bit samples
  1527                                  	; 8 bit samples
  1528 000009F3 FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1529 000009F5 740E                    	jz	short lff_6 ; 8 bit, stereo
  1530                                  	; 01/12/2024 (32bit registers)
  1531                                  lff_5:
  1532                                  	; mono & 8 bit
  1533 000009F7 AC                      	lodsb
  1534 000009F8 2C80                    	sub	al, 80h ; 08/11/2023
  1535 000009FA C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1536 000009FD 66AB                    	stosw	; left channel
  1537 000009FF 66AB                    	stosw	; right channel
  1538 00000A01 E2F4                    	loop	lff_5
  1539 00000A03 EB16                    	jmp	short lff_9
  1540                                  lff_6:
  1541                                  	; stereo & 8 bit
  1542 00000A05 AC                      	lodsb
  1543 00000A06 2C80                    	sub	al, 80h ; 08/11/2023
  1544 00000A08 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1545 00000A0B 66AB                    	stosw
  1546 00000A0D E2F6                    	loop	lff_6
  1547 00000A0F EB0A                    	jmp	short lff_9
  1548                                  lff_7:
  1549 00000A11 D1E9                    	shr	ecx, 1 ; word count
  1550                                  lff_8:
  1551 00000A13 66AD                    	lodsw
  1552 00000A15 66AB                    	stosw	; left channel
  1553 00000A17 66AB                    	stosw	; right channel
  1554 00000A19 E2F8                    	loop	lff_8
  1555                                  lff_9:
  1556                                  	; 14/12/2024
  1557 00000A1B 89F8                    	mov	eax, edi
  1558 00000A1D 8B0D[847F0000]          	mov	ecx, [buffersize] 
  1559 00000A23 01D1                    	add	ecx, edx ; + buffer start address
  1560 00000A25 39C8                    	cmp	eax, ecx	
  1561 00000A27 7225                    	jb	short lff_3
  1562 00000A29 C3                      	retn
  1563                                  	
  1564                                  lff_1:  
  1565                                  	; 07/12/2024
  1566                                  	; 01/12/2024
  1567                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1568                                  	; 14/12/2024
  1569                                  	sys 	_read, [filehandle], edi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000A2A 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000A30 89F9                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000A32 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000A38 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00000A3D CD40                <1>  int 40h
  1570                                  	; 07/11/2023
  1571 00000A3F 721B                    	jc	short lff_4 ; error !
  1572                                  
  1573                                  	; 01/12/2024
  1574                                  	; 14/11/2024
  1575 00000A41 A3[907F0000]            	mov	[count], eax
  1576                                  
  1577                                  	; 02/12/2024
  1578 00000A46 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1579 00000A48 7411                    	je	short endLFF
  1580                                  	; edi = buffer (start) address
  1581 00000A4A 01C7                    	add	edi, eax
  1582 00000A4C 89D1                    	mov	ecx, edx
  1583                                  lff_3:
  1584                                  	;call	padfill			; blank pad the remainder
  1585                                  	; 21/12/2024
  1586                                  padfill:
  1587                                  	; 14/12/2024
  1588                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1589                                  	; 17/11/2024
  1590                                  	;   di = offset (to be filled with ZEROs)
  1591                                  	;   bp = buffer segment
  1592                                  	;   ax = di = number of bytes loaded
  1593                                  	;   cx = buffer size (> loaded bytes)	
  1594                                  	; 07/11/2023
  1595                                  	; 06/11/2023
  1596                                  	; 17/02/2017
  1597                                  	; 01/12/2024
  1598 00000A4E 29C1                    	sub	ecx, eax
  1599                                  	; 01/12/2024
  1600                                  	; 25/11/2024
  1601 00000A50 31C0                    	xor	eax, eax
  1602                                  	; 14/12/2024
  1603 00000A52 F3AA                    	rep	stosb
  1604                                  	; 21/12/2024
  1605                                  	;retn
  1606                                  	; ----------
  1607                                          ;clc				; don't exit with CY yet.
  1608 00000A54 800D[0A7F0000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1609                                  endLFF:
  1610 00000A5B C3                              retn
  1611                                  lff_4:
  1612                                  	; 08/11/2023
  1613 00000A5C B021                    	mov	al, '!'  ; error
  1614 00000A5E E81DFEFFFF              	call	tL0
  1615                                  
  1616                                  	; 01/12/2024
  1617 00000A63 31C0                    	xor	eax, eax
  1618                                  lff_10:
  1619                                  	; 14/12/2024
  1620 00000A65 8B0D[847F0000]          	mov	ecx, [buffersize]
  1621 00000A6B EBE1                    	jmp	short lff_3
  1622                                  
  1623                                  ; /////
  1624                                  
  1625                                  ; --------------------------------------------------------
  1626                                  ; --------------------------------------------------------
  1627                                  	
  1628                                  write_audio_dev_info:
  1629                                  	; 30/05/2024
  1630                                       	;sys_msg msgAudioCardInfo, 0Fh
  1631                                  	; 01/12/2024
  1632                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000A6D BB[3E2A0000]        <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000A72 B9FF000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000A77 BA0F000000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000A7C B823000000          <1>  mov eax, %1
   100                              <1> 
   101 00000A81 CD40                <1>  int 40h
  1633 00000A83 C3                      	retn
  1634                                  
  1635                                  ; --------------------------------------------------------
  1636                                  
  1637                                  write_ac97_pci_dev_info:
  1638                                  	; 19/11/2024
  1639                                  	; 30/05/2024
  1640                                  	; 06/06/2017
  1641                                  	; 03/06/2017
  1642                                  	; BUS/DEV/FN
  1643                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1644                                  	; DEV/VENDOR
  1645                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1646                                  
  1647 00000A84 A1[747F0000]            	mov	eax, [dev_vendor]
  1648 00000A89 31DB                    	xor	ebx, ebx
  1649 00000A8B 88C3                    	mov	bl, al
  1650 00000A8D 88DA                    	mov	dl, bl
  1651 00000A8F 80E30F                  	and	bl, 0Fh
  1652 00000A92 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1653 00000A98 A2[AC2B0000]            	mov	[msgVendorId+3], al
  1654 00000A9D 88D3                    	mov	bl, dl
  1655 00000A9F C0EB04                  	shr	bl, 4
  1656 00000AA2 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1657 00000AA8 A2[AB2B0000]            	mov	[msgVendorId+2], al
  1658 00000AAD 88E3                    	mov	bl, ah
  1659 00000AAF 88DA                    	mov	dl, bl
  1660 00000AB1 80E30F                  	and	bl, 0Fh
  1661 00000AB4 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1662 00000ABA A2[AA2B0000]            	mov	[msgVendorId+1], al
  1663 00000ABF 88D3                    	mov	bl, dl
  1664 00000AC1 C0EB04                  	shr	bl, 4
  1665 00000AC4 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1666 00000ACA A2[A92B0000]            	mov	[msgVendorId], al
  1667 00000ACF C1E810                  	shr	eax, 16
  1668 00000AD2 88C3                    	mov	bl, al
  1669 00000AD4 88DA                    	mov	dl, bl
  1670 00000AD6 80E30F                  	and	bl, 0Fh
  1671 00000AD9 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1672 00000ADF A2[BD2B0000]            	mov	[msgDevId+3], al
  1673 00000AE4 88D3                    	mov	bl, dl
  1674 00000AE6 C0EB04                  	shr	bl, 4
  1675 00000AE9 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1676 00000AEF A2[BC2B0000]            	mov	[msgDevId+2], al
  1677 00000AF4 88E3                    	mov	bl, ah
  1678 00000AF6 88DA                    	mov	dl, bl
  1679 00000AF8 80E30F                  	and	bl, 0Fh
  1680 00000AFB 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1681 00000B01 A2[BB2B0000]            	mov	[msgDevId+1], al
  1682 00000B06 88D3                    	mov	bl, dl
  1683 00000B08 C0EB04                  	shr	bl, 4
  1684 00000B0B 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1685 00000B11 A2[BA2B0000]            	mov	[msgDevId], al
  1686                                  
  1687 00000B16 A1[707F0000]            	mov	eax, [bus_dev_fn]
  1688 00000B1B C1E808                  	shr	eax, 8
  1689 00000B1E 88C3                    	mov	bl, al
  1690 00000B20 88DA                    	mov	dl, bl
  1691 00000B22 80E307                  	and	bl, 7 ; bit 0,1,2
  1692 00000B25 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1693 00000B2B A2[E22B0000]            	mov	[msgFncNo+1], al
  1694 00000B30 88D3                    	mov	bl, dl
  1695 00000B32 C0EB03                  	shr	bl, 3
  1696 00000B35 88DA                    	mov	dl, bl
  1697 00000B37 80E30F                  	and	bl, 0Fh
  1698 00000B3A 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1699 00000B40 A2[D42B0000]            	mov	[msgDevNo+1], al
  1700 00000B45 88D3                    	mov	bl, dl
  1701 00000B47 C0EB04                  	shr	bl, 4
  1702 00000B4A 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1703 00000B50 A2[D32B0000]            	mov	[msgDevNo], al
  1704 00000B55 88E3                    	mov	bl, ah
  1705 00000B57 88DA                    	mov	dl, bl
  1706 00000B59 80E30F                  	and	bl, 0Fh
  1707 00000B5C 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1708 00000B62 A2[C82B0000]            	mov	[msgBusNo+1], al
  1709 00000B67 88D3                    	mov	bl, dl
  1710 00000B69 C0EB04                  	shr	bl, 4
  1711 00000B6C 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1712 00000B72 A2[C72B0000]            	mov	[msgBusNo], al
  1713                                  
  1714                                  	;mov	ax, [ac97_NamBar]
  1715 00000B77 66A1[787F0000]          	mov	ax, [NAMBAR]
  1716 00000B7D 88C3                    	mov	bl, al
  1717 00000B7F 88DA                    	mov	dl, bl
  1718 00000B81 80E30F                  	and	bl, 0Fh
  1719 00000B84 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1720 00000B8A A2[F22B0000]            	mov	[msgNamBar+3], al
  1721 00000B8F 88D3                    	mov	bl, dl
  1722 00000B91 C0EB04                  	shr	bl, 4
  1723 00000B94 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1724 00000B9A A2[F12B0000]            	mov	[msgNamBar+2], al
  1725 00000B9F 88E3                    	mov	bl, ah
  1726 00000BA1 88DA                    	mov	dl, bl
  1727 00000BA3 80E30F                  	and	bl, 0Fh
  1728 00000BA6 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1729 00000BAC A2[F02B0000]            	mov	[msgNamBar+1], al
  1730 00000BB1 88D3                    	mov	bl, dl
  1731 00000BB3 C0EB04                  	shr	bl, 4
  1732 00000BB6 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1733 00000BBC A2[EF2B0000]            	mov	[msgNamBar], al
  1734                                  
  1735                                  	;mov	ax, [ac97_NabmBar]
  1736 00000BC1 66A1[7A7F0000]          	mov	ax, [NABMBAR]
  1737 00000BC7 88C3                    	mov	bl, al
  1738 00000BC9 88DA                    	mov	dl, bl
  1739 00000BCB 80E30F                  	and	bl, 0Fh
  1740 00000BCE 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1741 00000BD4 A2[022C0000]            	mov	[msgNabmBar+3], al
  1742 00000BD9 88D3                    	mov	bl, dl
  1743 00000BDB C0EB04                  	shr	bl, 4
  1744 00000BDE 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1745 00000BE4 A2[012C0000]            	mov	[msgNabmBar+2], al
  1746 00000BE9 88E3                    	mov	bl, ah
  1747 00000BEB 88DA                    	mov	dl, bl
  1748 00000BED 80E30F                  	and	bl, 0Fh
  1749 00000BF0 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1750 00000BF6 A2[002C0000]            	mov	[msgNabmBar+1], al
  1751 00000BFB 88D3                    	mov	bl, dl
  1752 00000BFD C0EB04                  	shr	bl, 4
  1753 00000C00 8A83[652B0000]          	mov	al, [hex_chars+ebx]
  1754 00000C06 A2[FF2B0000]            	mov	[msgNabmBar], al
  1755                                  
  1756 00000C0B 31C0                    	xor	eax, eax
  1757 00000C0D A0[0B7F0000]            	mov	al, [ac97_int_ln_reg]
  1758 00000C12 B10A                    	mov	cl, 10
  1759 00000C14 F6F1                    	div	cl
  1760                                  	; 23/11/2024
  1761                                  	;add	[msgIRQ], ax
  1762 00000C16 66053030                	add	ax, 3030h
  1763 00000C1A 66A3[0B2C0000]          	mov	[msgIRQ], ax
  1764                                  	;and	al, al
  1765 00000C20 3C30                    	cmp	al, 30h
  1766 00000C22 750D                    	jnz	short _w_ac97imsg_
  1767 00000C24 A0[0C2C0000]            	mov	al, byte [msgIRQ+1]
  1768 00000C29 B420                    	mov	ah, ' '
  1769 00000C2B 66A3[0B2C0000]          	mov	[msgIRQ], ax
  1770                                  _w_ac97imsg_:
  1771                                  	; 19/11/2024
  1772 00000C31 E81C1C0000              	call 	clear_window
  1773 00000C36 B60D                    	mov	dh, 13
  1774 00000C38 B200                    	mov	dl, 0
  1775 00000C3A E82E190000              	call	setCursorPosition
  1776                                  	;;;
  1777                                  	; 21/12/2024
  1778 00000C3F BD[762B0000]            	mov	ebp, msgAC97Info ; message
  1779                                  	; 22/12/2024
  1780                                  	;mov	cl, 07h ; color 
  1781 00000C44 E81F000000              	call	sys_gmsg
  1782                                  	;
  1783                                  	; 30/05/2024
  1784                                  write_VRA_info:
  1785                                  	; 21/12/2024
  1786 00000C49 BD[102C0000]            	mov	ebp, msgVRAheader ; message
  1787                                  	;mov	cl, 07h ; color 
  1788 00000C4E E815000000              	call	sys_gmsg
  1789                                  	;
  1790 00000C53 803D[D67E0000]00        	cmp	byte [VRA], 0
  1791 00000C5A 7607                    	jna	short _w_VRAi_no
  1792                                  _w_VRAi_yes:
  1793 00000C5C BD[1F2C0000]            	mov	ebp, msgVRAyes
  1794 00000C61 EB05                    	jmp	short _w_VRAi_yn_msg
  1795                                  _w_VRAi_no:
  1796 00000C63 BD[252C0000]            	mov	ebp, msgVRAno
  1797                                  _w_VRAi_yn_msg:
  1798                                  	;mov	cl, 07h ; color 
  1799                                  	;call	sys_msg
  1800                                  	;retn
  1801                                  	;jmp	short sys_gmsg
  1802                                  	;;;
  1803                                  ; --------------------------------------------------------
  1804                                  
  1805                                  	; 22/12/2024
  1806                                  	;;;
  1807                                  	; 21/12/2024
  1808                                  	; (write message in VGA/VESA-VBE mode)
  1809                                  sys_gmsg:
  1810 00000C68 8A4500                  	mov	al, [ebp]
  1811 00000C6B 20C0                    	and	al, al
  1812 00000C6D 7458                    	jz	short sys_gmsg_ok
  1813 00000C6F 3C20                    	cmp	al, 20h
  1814 00000C71 731E                    	jnb	short sys_gmsg_3
  1815 00000C73 3C0D                    	cmp	al, CR ; 13
  1816 00000C75 750C                    	jne	short sys_gmsg_2
  1817                                  	; carriege return, move cursor to column 0
  1818 00000C77 66C705[BC740000]00-     	mov	word [screenpos], 0
  1818 00000C7F 00                 
  1819                                  sys_gmsg_1:
  1820 00000C80 45                      	inc	ebp
  1821 00000C81 EBE5                    	jmp	short sys_gmsg
  1822                                  sys_gmsg_2:
  1823 00000C83 3C0A                    	cmp	al, LF ; 10
  1824 00000C85 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1825                                  	; line feed, move cursor to next row
  1826 00000C87 668305[BE740000]10      	add	word [screenpos+2], 16
  1827 00000C8F EBEF                    	jmp	short sys_gmsg_1
  1828                                  sys_gmsg_3:
  1829 00000C91 8B35[BC740000]          	mov	esi, [screenpos]
  1830                                  		; hw = (cursor) row
  1831                                  		; si = (cursor) column
  1832 00000C97 B907000000              	mov	ecx, 07h ; gray (light)
  1833 00000C9C E8851A0000              	call	write_character
  1834 00000CA1 83C608                  	add	esi, 8
  1835                                  	;;;
  1836 00000CA4 6681FE8002              	cmp	si, 640
  1837 00000CA9 7213                    	jb	short sys_gmsg_5
  1838 00000CAB C1EE10                  	shr	esi, 16
  1839 00000CAE 6683C610                	add	si, 16
  1840 00000CB2 6681FEE001              	cmp	si, 480
  1841 00000CB7 7202                    	jb	short sys_gmsg_4
  1842 00000CB9 31F6                    	xor	esi, esi
  1843                                  sys_gmsg_4:
  1844 00000CBB C1E610                  	shl	esi, 16
  1845                                  	;;;
  1846                                  sys_gmsg_5:
  1847 00000CBE 8935[BC740000]          	mov	[screenpos], esi
  1848 00000CC4 45                      	inc	ebp
  1849 00000CC5 EBA1                    	jmp	short sys_gmsg
  1850                                  sys_gmsg_ok:
  1851 00000CC7 C3                      	retn
  1852                                  	;;;
  1853                                  
  1854                                  ; --------------------------------------------------------
  1855                                  
  1856                                  ; 07/12/2024 - playwav9.s
  1857                                  ; 01/12/2024 - ac97play.s
  1858                                  ; 29/05/2024
  1859                                  ; 26/11/2023
  1860                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1861                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1862                                  ; 14/11/2023
  1863                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1864                                  ; --------------------------------------------------------
  1865                                  
  1866                                  ;;Note:	At the end of every buffer load,
  1867                                  ;;	during buffer switch/swap, there will be discontinuity
  1868                                  ;;	between the last converted sample and the 1st sample
  1869                                  ;;	of the next buffer.
  1870                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1871                                  ;;	-To avoid this defect, the 1st sample of
  1872                                  ;;	the next buffer may be read from the wav file but
  1873                                  ;;	the file pointer would need to be set to 1 sample back
  1874                                  ;;	again via seek system call. Time comsumption problem! -
  1875                                  ;;
  1876                                  ;;	Erdogan Tan - 15/11/2023
  1877                                  ;;
  1878                                  ;;	((If entire wav data would be loaded at once.. conversion
  1879                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1880                                  ;;	64KB buffer limit is important also it is important
  1881                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1882                                  ;;	I have tested this program by using 2-30MB wav files.))
  1883                                  ;;
  1884                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1885                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1886                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1887                                  ;;			Realtek ALC850 codec.
  1888                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1889                                  
  1890                                  load_8khz_mono_8_bit:
  1891                                  	; 15/11/2023
  1892                                  	; 14/11/2023
  1893                                  	; 13/11/2023
  1894 00000CC8 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1895                                  					; last of the file?
  1896 00000CCF 7402                    	jz	short lff8m_0		; no
  1897 00000CD1 F9                      	stc
  1898 00000CD2 C3                      	retn
  1899                                  
  1900                                  lff8m_0:
  1901                                  	; 01/12/2024
  1902                                  	; edi = audio buffer address
  1903 00000CD3 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1904                                          ;mov	edx, [loadsize]
  1905                                  
  1906                                  	; esi = buffer address
  1907                                  	;; edx = buffer size
  1908                                  
  1909                                  	; load file into memory
  1910                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000CD8 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000CDE 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000CE0 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000CE6 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00000CEB CD40                <1>  int 40h
  1911 00000CED 7305                    	jnc	short lff8m_6
  1912 00000CEF E9AF000000              	jmp	lff8m_5  ; error !
  1913                                  
  1914                                  lff8m_6:
  1915                                  	; 01/12/2024
  1916 00000CF4 A3[907F0000]            	mov	[count], eax
  1917                                  	;;;
  1918                                  	; 07/12/2024
  1919                                  	;mov	edi, audio_buffer
  1920                                  	;;;
  1921 00000CF9 21C0                    	and	eax, eax
  1922 00000CFB 0F8499000000            	jz	lff8_eof
  1923                                  
  1924 00000D01 89C1                    	mov	ecx, eax		; byte count
  1925                                  lff8m_1:
  1926 00000D03 AC                      	lodsb
  1927 00000D04 A2[EF220000]            	mov	[previous_val], al
  1928 00000D09 2C80                    	sub	al, 80h
  1929 00000D0B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1930 00000D0F 66AB                    	stosw		; original sample (left channel)
  1931 00000D11 66AB                    	stosw		; original sample (right channel)
  1932                                  	;xor	eax, eax
  1933 00000D13 B080                    	mov	al, 80h
  1934 00000D15 49                      	dec	ecx
  1935 00000D16 7402                    	jz	short lff8m_2
  1936 00000D18 8A06                    	mov	al, [esi]
  1937                                  lff8m_2:
  1938                                  	;mov	[next_val], ax
  1939 00000D1A 88C7                    	mov	bh, al	; [next_val]
  1940 00000D1C 8A25[EF220000]          	mov	ah, [previous_val]
  1941 00000D22 00E0                    	add	al, ah	; [previous_val]
  1942 00000D24 D0D8                    	rcr	al, 1
  1943 00000D26 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1944 00000D28 00E0                    	add	al, ah	; [previous_val]
  1945 00000D2A D0D8                    	rcr	al, 1	
  1946 00000D2C 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1947 00000D2E 00E0                    	add	al, ah	; [previous_val]
  1948 00000D30 D0D8                    	rcr	al, 1
  1949 00000D32 2C80                    	sub	al, 80h
  1950 00000D34 66C1E008                	shl	ax, 8	
  1951 00000D38 66AB                    	stosw		; this is 1st interpolated sample (L)
  1952 00000D3A 66AB                    	stosw		; this is 1st interpolated sample (R)
  1953 00000D3C 88D8                    	mov	al, bl
  1954 00000D3E 00D0                    	add	al, dl
  1955 00000D40 D0D8                    	rcr	al, 1
  1956 00000D42 2C80                    	sub	al, 80h
  1957 00000D44 66C1E008                	shl	ax, 8
  1958 00000D48 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1959 00000D4A 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1960 00000D4C 88D0                    	mov	al, dl
  1961 00000D4E 2C80                    	sub	al, 80h
  1962 00000D50 66C1E008                	shl	ax, 8
  1963 00000D54 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1964 00000D56 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1965                                  	;mov	al, [next_val]
  1966 00000D58 88F8                    	mov	al, bh
  1967 00000D5A 00D0                    	add	al, dl
  1968 00000D5C D0D8                    	rcr	al, 1
  1969 00000D5E 88C3                    	mov	bl, al	; this is temporary interpolation value
  1970 00000D60 00D0                    	add	al, dl
  1971 00000D62 D0D8                    	rcr	al, 1
  1972 00000D64 2C80                    	sub	al, 80h
  1973 00000D66 66C1E008                	shl	ax, 8
  1974 00000D6A 66AB                    	stosw		; this is 4th interpolated sample (L)
  1975 00000D6C 66AB                    	stosw		; this is 4th interpolated sample (R)
  1976                                  	;mov	al, [next_val]
  1977 00000D6E 88F8                    	mov	al, bh
  1978 00000D70 00D8                    	add	al, bl
  1979 00000D72 D0D8                    	rcr	al, 1
  1980 00000D74 2C80                    	sub	al, 80h
  1981 00000D76 66C1E008                	shl	ax, 8
  1982 00000D7A 66AB                    	stosw		; this is 5th interpolated sample (L)
  1983 00000D7C 66AB                    	stosw		; this is 5th interpolated sample (R)
  1984                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1985 00000D7E 09C9                    	or	ecx, ecx
  1986 00000D80 7581                    	jnz	short lff8m_1
  1987                                  
  1988                                  	; --------------
  1989                                  
  1990                                  lff8s_3:
  1991                                  lff8m_3:
  1992                                  lff8s2_3:
  1993                                  lff8m2_3:
  1994                                  lff16s_3:
  1995                                  lff16m_3:
  1996                                  lff16s2_3:
  1997                                  lff16m2_3:
  1998                                  lff24_3:
  1999                                  lff32_3:
  2000                                  lff44_3:
  2001                                  lff22_3:
  2002                                  lff11_3:
  2003                                  	; 08/12/2024 (BugFix)
  2004                                  	; 31/05/2024 (BugFix)
  2005 00000D82 8B0D[847F0000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  2006                                  	;shl	ecx, 1	; byte count ; Bug !
  2007                                  	; 08/12/2024
  2008 00000D88 81C1[00800000]          	add	ecx, audio_buffer
  2009 00000D8E 29F9                    	sub	ecx, edi
  2010 00000D90 7607                    	jna	short lff8m_4
  2011                                  	;inc	ecx
  2012 00000D92 C1E902                  	shr	ecx, 2
  2013 00000D95 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  2014 00000D97 F3AB                    	rep	stosd
  2015                                  lff8m_4:
  2016                                  	; 31/05/2024 (BugFix)
  2017                                  	; cf=1 ; Bug !
  2018                                  	; 08/12/2024
  2019                                  	;clc
  2020 00000D99 C3                      	retn
  2021                                  
  2022                                  lff8_eof:
  2023                                  lff16_eof:
  2024                                  lff24_eof:
  2025                                  lff32_eof:
  2026                                  lff44_eof:
  2027                                  lff22_eof:
  2028                                  lff11_eof:
  2029                                  	; 15/11/2023
  2030 00000D9A C605[0A7F0000]01        	mov	byte [flags], ENDOFFILE
  2031 00000DA1 EBDF                    	jmp	short lff8m_3
  2032                                  
  2033                                  lff8s_5:
  2034                                  lff8m_5:
  2035                                  lff8s2_5:
  2036                                  lff8m2_5:
  2037                                  lff16s_5:
  2038                                  lff16m_5:
  2039                                  lff16s2_5:
  2040                                  lff16m2_5:
  2041                                  lff24_5:
  2042                                  lff32_5:
  2043                                  lff44_5:
  2044                                  lff22_5:
  2045                                  lff11_5:
  2046 00000DA3 B021                    	mov	al, '!'  ; error
  2047 00000DA5 E8D6FAFFFF              	call	tL0
  2048                                  	
  2049                                  	;jmp	short lff8m_3
  2050                                  	; 15/11/2023
  2051 00000DAA EBEE                    	jmp	lff8_eof
  2052                                  
  2053                                  	; --------------
  2054                                  
  2055                                  load_8khz_stereo_8_bit:
  2056                                  	; 15/11/2023
  2057                                  	; 14/11/2023
  2058                                  	; 13/11/2023
  2059 00000DAC F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2060                                  					; last of the file?
  2061 00000DB3 7402                    	jz	short lff8s_0		; no
  2062 00000DB5 F9                      	stc
  2063 00000DB6 C3                      	retn
  2064                                  
  2065                                  lff8s_0:
  2066                                  	; 01/12/2024
  2067                                  	; edi = audio buffer address
  2068 00000DB7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2069                                          ;mov	edx, [loadsize]
  2070                                  
  2071                                  	; esi = buffer address
  2072                                  	;; edx = buffer size
  2073                                  
  2074                                  	; load file into memory
  2075                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000DBC 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000DC2 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000DC4 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000DCA B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00000DCF CD40                <1>  int 40h
  2076 00000DD1 72D0                    	jc	short lff8s_5 ; error !
  2077                                  
  2078                                  	; 01/12/2024
  2079 00000DD3 A3[907F0000]            	mov	[count], eax
  2080                                  	;;;
  2081                                  	; 07/12/2024
  2082                                  	;mov	edi, audio_buffer
  2083                                  	;;;
  2084 00000DD8 D1E8                    	shr	eax, 1
  2085 00000DDA 74BE                    	jz	short lff8_eof
  2086                                  
  2087 00000DDC 89C1                    	mov	ecx, eax	; word count
  2088                                  lff8s_1:
  2089 00000DDE AC                      	lodsb
  2090 00000DDF A2[EF220000]            	mov	[previous_val_l], al
  2091 00000DE4 2C80                    	sub	al, 80h
  2092 00000DE6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2093 00000DEA 66AB                    	stosw		; original sample (L)
  2094 00000DEC AC                      	lodsb
  2095 00000DED A2[F1220000]            	mov	[previous_val_r], al
  2096 00000DF2 2C80                    	sub	al, 80h
  2097 00000DF4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2098 00000DF8 66AB                    	stosw		; original sample (R)
  2099                                  
  2100                                  	;xor	eax, eax
  2101 00000DFA 66B88080                	mov	ax, 8080h
  2102 00000DFE 49                      	dec	ecx
  2103 00000DFF 7403                    	jz	short lff8s_2
  2104                                  		; convert 8 bit sample to 16 bit sample
  2105 00000E01 668B06                  	mov	ax, [esi]
  2106                                  lff8s_2:
  2107 00000E04 A2[F3220000]            	mov	[next_val_l], al
  2108 00000E09 8825[F5220000]          	mov	[next_val_r], ah
  2109 00000E0F 8A25[EF220000]          	mov	ah, [previous_val_l]
  2110 00000E15 00E0                    	add	al, ah
  2111 00000E17 D0D8                    	rcr	al, 1
  2112 00000E19 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  2113 00000E1B 00E0                    	add	al, ah
  2114 00000E1D D0D8                    	rcr	al, 1
  2115 00000E1F 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  2116 00000E21 00E0                    	add	al, ah
  2117 00000E23 D0D8                    	rcr	al, 1
  2118 00000E25 2C80                    	sub	al, 80h
  2119 00000E27 66C1E008                	shl	ax, 8
  2120 00000E2B 66AB                    	stosw		; this is 1st interpolated sample (L)
  2121 00000E2D A0[F5220000]            	mov	al, [next_val_r]
  2122 00000E32 8A25[F1220000]          	mov	ah, [previous_val_r]
  2123 00000E38 00E0                    	add	al, ah
  2124 00000E3A D0D8                    	rcr	al, 1
  2125 00000E3C 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  2126 00000E3E 00E0                    	add	al, ah
  2127 00000E40 D0D8                    	rcr	al, 1
  2128 00000E42 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  2129 00000E44 00E0                    	add	al, ah
  2130 00000E46 D0D8                    	rcr	al, 1
  2131 00000E48 2C80                    	sub	al, 80h
  2132 00000E4A 66C1E008                	shl	ax, 8
  2133 00000E4E 66AB                    	stosw		; this is 1st interpolated sample (R)
  2134 00000E50 88D8                    	mov	al, bl
  2135 00000E52 00D0                    	add	al, dl
  2136 00000E54 D0D8                    	rcr	al, 1
  2137 00000E56 2C80                    	sub	al, 80h
  2138 00000E58 66C1E008                	shl	ax, 8
  2139 00000E5C 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2140 00000E5E 88F8                    	mov	al, bh
  2141 00000E60 00F0                    	add	al, dh
  2142 00000E62 D0D8                    	rcr	al, 1
  2143 00000E64 2C80                    	sub	al, 80h
  2144 00000E66 66C1E008                	shl	ax, 8
  2145 00000E6A 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2146 00000E6C 88D0                    	mov	al, dl
  2147 00000E6E 2C80                    	sub	al, 80h
  2148 00000E70 66C1E008                	shl	ax, 8
  2149 00000E74 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2150 00000E76 88F0                    	mov	al, dh
  2151 00000E78 2C80                    	sub	al, 80h
  2152 00000E7A 66C1E008                	shl	ax, 8
  2153 00000E7E 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2154 00000E80 A0[F3220000]            	mov	al, [next_val_l]
  2155 00000E85 00D0                    	add	al, dl
  2156 00000E87 D0D8                    	rcr	al, 1
  2157 00000E89 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  2158 00000E8B 00D0                    	add	al, dl
  2159 00000E8D D0D8                    	rcr	al, 1
  2160 00000E8F 2C80                    	sub	al, 80h
  2161 00000E91 66C1E008                	shl	ax, 8
  2162 00000E95 66AB                    	stosw		; this is 4th interpolated sample (L)
  2163 00000E97 A0[F5220000]            	mov	al, [next_val_r]
  2164 00000E9C 00F0                    	add	al, dh
  2165 00000E9E D0D8                    	rcr	al, 1
  2166 00000EA0 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  2167 00000EA2 00F0                    	add	al, dh
  2168 00000EA4 D0D8                    	rcr	al, 1
  2169 00000EA6 2C80                    	sub	al, 80h
  2170 00000EA8 66C1E008                	shl	ax, 8
  2171 00000EAC 66AB                    	stosw		; this is 4th interpolated sample (R)
  2172 00000EAE A0[F3220000]            	mov	al, [next_val_l]
  2173 00000EB3 00D8                    	add	al, bl
  2174 00000EB5 D0D8                    	rcr	al, 1
  2175 00000EB7 2C80                    	sub	al, 80h
  2176 00000EB9 66C1E008                	shl	ax, 8
  2177 00000EBD 66AB                    	stosw		; this is 5th interpolated sample (L)
  2178 00000EBF A0[F5220000]            	mov	al, [next_val_r]
  2179 00000EC4 00F8                    	add	al, bh
  2180 00000EC6 D0D8                    	rcr	al, 1
  2181 00000EC8 2C80                    	sub	al, 80h
  2182 00000ECA 66C1E008                	shl	ax, 8
  2183 00000ECE 66AB                    	stosw		; this is 5th interpolated sample (R)
  2184                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2185 00000ED0 E305                    	jecxz	lff8s_6
  2186 00000ED2 E907FFFFFF              	jmp	lff8s_1
  2187                                  lff8s_6:
  2188 00000ED7 E9A6FEFFFF              	jmp	lff8s_3
  2189                                  
  2190                                  load_8khz_mono_16_bit:
  2191                                  	; 13/11/2023
  2192 00000EDC F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2193                                  					; last of the file?
  2194 00000EE3 7402                    	jz	short lff8m2_0		; no
  2195 00000EE5 F9                      	stc
  2196 00000EE6 C3                      	retn
  2197                                  
  2198                                  lff8m2_0:
  2199                                  	; 01/12/2024
  2200                                  	; edi = audio buffer address
  2201 00000EE7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2202                                          ;mov	edx, [loadsize]
  2203                                  
  2204                                  	; esi = buffer address
  2205                                  	;; edx = buffer size
  2206                                  
  2207                                  	; load file into memory
  2208                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000EEC 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000EF2 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000EF4 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000EFA B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00000EFF CD40                <1>  int 40h
  2209 00000F01 0F82A0000000            	jc	lff8m2_7 ; error !
  2210                                  
  2211                                  	; 01/12/2024
  2212 00000F07 A3[907F0000]            	mov	[count], eax
  2213                                  	;;;
  2214                                  	; 07/12/2024
  2215                                  	;mov	edi, audio_buffer
  2216                                  	;;;
  2217 00000F0C D1E8                    	shr	eax, 1
  2218 00000F0E 7505                    	jnz	short lff8m2_8
  2219 00000F10 E985FEFFFF              	jmp	lff8_eof
  2220                                  
  2221                                  lff8m2_8:
  2222 00000F15 89C1                    	mov	ecx, eax	; word count
  2223                                  lff8m2_1:
  2224 00000F17 66AD                    	lodsw
  2225 00000F19 66AB                    	stosw		; original sample (left channel)
  2226 00000F1B 66AB                    	stosw		; original sample (right channel)
  2227 00000F1D 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2228 00000F20 66A3[EF220000]          	mov	[previous_val], ax
  2229 00000F26 31C0                    	xor	eax, eax
  2230 00000F28 49                      	dec	ecx
  2231 00000F29 7403                    	jz	short lff8m2_2
  2232 00000F2B 668B06                  	mov	ax, [esi]
  2233                                  lff8m2_2:
  2234 00000F2E 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  2235 00000F31 89C5                    	mov	ebp, eax	; [next_val]
  2236 00000F33 660305[EF220000]        	add	ax, [previous_val]
  2237 00000F3A 66D1D8                  	rcr	ax, 1
  2238 00000F3D 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  2239 00000F3F 660305[EF220000]        	add	ax, [previous_val]
  2240 00000F46 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  2241 00000F49 89C3                    	mov	ebx, eax 		
  2242 00000F4B 660305[EF220000]        	add	ax, [previous_val]
  2243 00000F52 66D1D8                  	rcr	ax, 1
  2244 00000F55 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2245 00000F58 66AB                    	stosw		; this is 1st interpolated sample (L)
  2246 00000F5A 66AB                    	stosw		; this is 1st interpolated sample (R)
  2247 00000F5C 89D8                    	mov	eax, ebx
  2248 00000F5E 6601D0                  	add	ax, dx
  2249 00000F61 66D1D8                  	rcr	ax, 1
  2250 00000F64 80EC80                  	sub	ah, 80h
  2251 00000F67 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2252 00000F69 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2253 00000F6B 89D0                    	mov	eax, edx
  2254 00000F6D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2255 00000F70 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2256 00000F72 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2257 00000F74 89E8                    	mov	eax, ebp
  2258 00000F76 6601D0                  	add	ax, dx
  2259 00000F79 66D1D8                  	rcr	ax, 1
  2260 00000F7C 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2261 00000F7E 6601D0                  	add	ax, dx
  2262 00000F81 66D1D8                  	rcr	ax, 1
  2263 00000F84 80EC80                  	sub	ah, 80h
  2264 00000F87 66AB                    	stosw		; this is 4th interpolated sample (L)
  2265 00000F89 66AB                    	stosw		; this is 4th interpolated sample (R)
  2266 00000F8B 89E8                    	mov	eax, ebp
  2267 00000F8D 6601D8                  	add	ax, bx
  2268 00000F90 66D1D8                  	rcr	ax, 1
  2269 00000F93 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2270 00000F96 66AB                    	stosw		; this is 5th interpolated sample (L)
  2271 00000F98 66AB                    	stosw		; this is 5th interpolated sample (R)
  2272                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2273 00000F9A 09C9                    	or	ecx, ecx
  2274 00000F9C 0F8575FFFFFF            	jnz	lff8m2_1
  2275 00000FA2 E9DBFDFFFF              	jmp	lff8m2_3
  2276                                  
  2277                                  lff8m2_7:
  2278                                  lff8s2_7:
  2279 00000FA7 E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2280                                  
  2281                                  load_8khz_stereo_16_bit:
  2282                                  	; 16/11/2023
  2283                                  	; 15/11/2023
  2284                                  	; 13/11/2023
  2285 00000FAC F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2286                                  					; last of the file?
  2287 00000FB3 7402                    	jz	short lff8s2_0		; no
  2288 00000FB5 F9                      	stc
  2289 00000FB6 C3                      	retn
  2290                                  
  2291                                  lff8s2_0:
  2292                                  	; 01/12/2024
  2293                                  	; edi = audio buffer address
  2294 00000FB7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2295                                          ;mov	edx, [loadsize]
  2296                                  
  2297                                  	; esi = buffer address
  2298                                  	;; edx = buffer size
  2299                                  
  2300                                  	; load file into memory
  2301                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00000FBC 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00000FC2 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00000FC4 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00000FCA B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00000FCF CD40                <1>  int 40h
  2302 00000FD1 72D4                    	jc	short lff8s2_7 ; error !
  2303                                  
  2304                                  	; 01/12/2024
  2305 00000FD3 A3[907F0000]            	mov	[count], eax
  2306                                  	;;;
  2307                                  	; 07/12/2024
  2308                                  	;mov	edi, audio_buffer
  2309                                  	;;;
  2310 00000FD8 C1E802                  	shr	eax, 2
  2311 00000FDB 7505                    	jnz	short lff8s2_8
  2312 00000FDD E9B8FDFFFF              	jmp	lff8_eof
  2313                                  
  2314                                  lff8s2_8:
  2315 00000FE2 89C1                    	mov	ecx, eax ; dword count
  2316                                  lff8s2_1:
  2317 00000FE4 66AD                    	lodsw
  2318 00000FE6 66AB                    	stosw		; original sample (L)
  2319                                  	; 15/11/2023
  2320 00000FE8 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2321 00000FEB 66A3[EF220000]          	mov	[previous_val_l], ax
  2322 00000FF1 66AD                    	lodsw
  2323 00000FF3 66AB                    	stosw		; original sample (R)
  2324 00000FF5 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2325 00000FF8 66A3[F1220000]          	mov	[previous_val_r], ax
  2326 00000FFE 31D2                    	xor	edx, edx
  2327 00001000 31C0                    	xor	eax, eax
  2328                                  	; 16/11/2023
  2329 00001002 49                      	dec	ecx
  2330 00001003 7407                    	jz	short lff8s2_2
  2331 00001005 668B06                  	mov	ax, [esi]
  2332 00001008 668B5602                	mov	dx, [esi+2]
  2333                                  lff8s2_2:
  2334 0000100C 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2335 0000100F 66A3[F3220000]          	mov	[next_val_l], ax
  2336 00001015 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2337 00001018 668915[F5220000]        	mov	[next_val_r], dx
  2338 0000101F 660305[EF220000]        	add	ax, [previous_val_l]
  2339 00001026 66D1D8                  	rcr	ax, 1
  2340 00001029 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2341 0000102B 660305[EF220000]        	add	ax, [previous_val_l]
  2342 00001032 66D1D8                  	rcr	ax, 1	
  2343 00001035 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2344 00001037 660305[EF220000]        	add	ax, [previous_val_l]
  2345 0000103E 66D1D8                  	rcr	ax, 1
  2346 00001041 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2347 00001044 66AB                    	stosw		; this is 1st interpolated sample (L)
  2348 00001046 66A1[F5220000]          	mov	ax, [next_val_r]
  2349 0000104C 660305[F1220000]        	add	ax, [previous_val_r]
  2350 00001053 66D1D8                  	rcr	ax, 1
  2351 00001056 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2352 00001058 660305[F1220000]        	add	ax, [previous_val_r]
  2353 0000105F 66D1D8                  	rcr	ax, 1
  2354 00001062 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2355 00001063 660305[F1220000]        	add	ax, [previous_val_r]
  2356 0000106A 66D1D8                  	rcr	ax, 1
  2357 0000106D 80EC80                  	sub	ah, 80h
  2358 00001070 66AB                    	stosw		; this is 1st interpolated sample (R)
  2359 00001072 89D8                    	mov	eax, ebx
  2360 00001074 6601D0                  	add	ax, dx
  2361 00001077 66D1D8                  	rcr	ax, 1
  2362 0000107A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2363 0000107D 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2364 0000107F 58                      	pop	eax ; *
  2365 00001080 6601E8                  	add	ax, bp
  2366 00001083 66D1D8                  	rcr	ax, 1
  2367 00001086 80EC80                  	sub	ah, 80h
  2368 00001089 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2369 0000108B 89D0                    	mov	eax, edx
  2370 0000108D 80EC80                  	sub	ah, 80h
  2371 00001090 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2372 00001092 89E8                    	mov	eax, ebp
  2373 00001094 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2374 00001097 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2375 00001099 66A1[F3220000]          	mov	ax, [next_val_l]
  2376 0000109F 6601D0                  	add	ax, dx
  2377 000010A2 66D1D8                  	rcr	ax, 1
  2378 000010A5 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2379 000010A7 6601D0                  	add	ax, dx
  2380 000010AA 66D1D8                  	rcr	ax, 1
  2381 000010AD 80EC80                  	sub	ah, 80h
  2382 000010B0 66AB                    	stosw		; this is 4th interpolated sample (L)
  2383 000010B2 66A1[F5220000]          	mov	ax, [next_val_r]
  2384 000010B8 6601E8                  	add	ax, bp
  2385 000010BB 66D1D8                  	rcr	ax, 1
  2386 000010BE 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2387 000010BF 6601E8                  	add	ax, bp
  2388 000010C2 66D1D8                  	rcr	ax, 1
  2389 000010C5 80EC80                  	sub	ah, 80h
  2390 000010C8 66AB                    	stosw		; this is 4th interpolated sample (R)
  2391 000010CA 66A1[F3220000]          	mov	ax, [next_val_l]
  2392 000010D0 6601D8                  	add	ax, bx
  2393 000010D3 66D1D8                  	rcr	ax, 1
  2394 000010D6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2395 000010D9 66AB                    	stosw		; this is 5th interpolated sample (L)
  2396 000010DB 58                      	pop	eax ; **
  2397 000010DC 660305[F5220000]        	add	ax, [next_val_r]
  2398 000010E3 66D1D8                  	rcr	ax, 1
  2399 000010E6 80EC80                  	sub	ah, 80h
  2400 000010E9 66AB                    	stosw		; this is 5th interpolated sample (R)
  2401                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2402 000010EB E305                    	jecxz	lff8_s2_9
  2403 000010ED E9F2FEFFFF              	jmp	lff8s2_1
  2404                                  lff8_s2_9:
  2405 000010F2 E98BFCFFFF              	jmp	lff8s2_3
  2406                                  
  2407                                  ; .....................
  2408                                  
  2409                                  load_16khz_mono_8_bit:
  2410                                  	; 14/11/2023
  2411                                  	; 13/11/2023
  2412 000010F7 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2413                                  					; last of the file?
  2414 000010FE 7402                    	jz	short lff16m_0		; no
  2415 00001100 F9                      	stc
  2416 00001101 C3                      	retn
  2417                                  
  2418                                  lff16m_0:
  2419                                  	; 01/12/2024
  2420                                  	; edi = audio buffer address
  2421 00001102 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2422                                          ;mov	edx, [loadsize]
  2423                                  
  2424                                  	; esi = buffer address
  2425                                  	;; edx = buffer size
  2426                                  
  2427                                  	; load file into memory
  2428                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001107 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000110D 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000110F 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001115 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 0000111A CD40                <1>  int 40h
  2429 0000111C 7253                    	jc	short lff16m_7 ; error !
  2430                                  
  2431                                  	; 01/12/2024
  2432 0000111E A3[907F0000]            	mov	[count], eax
  2433                                  	;;;
  2434                                  	; 07/12/2024
  2435                                  	;mov	edi, audio_buffer
  2436                                  	;;;
  2437 00001123 21C0                    	and	eax, eax
  2438 00001125 7505                    	jnz	short lff16m_8
  2439 00001127 E96EFCFFFF              	jmp	lff16_eof
  2440                                  
  2441                                  lff16m_8:
  2442 0000112C 89C1                    	mov	ecx, eax		; byte count
  2443                                  lff16m_1:
  2444 0000112E AC                      	lodsb
  2445                                  	;mov	[previous_val], al
  2446 0000112F 88C3                    	mov	bl, al
  2447 00001131 2C80                    	sub	al, 80h
  2448 00001133 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2449 00001137 66AB                    	stosw		; original sample (left channel)
  2450 00001139 66AB                    	stosw		; original sample (right channel)
  2451                                  	;xor	ax, ax
  2452                                  	; 14/11/22023
  2453 0000113B B080                    	mov	al, 80h
  2454 0000113D 49                      	dec	ecx
  2455 0000113E 7402                    	jz	short lff16m_2
  2456 00001140 8A06                    	mov	al, [esi]
  2457                                  lff16m_2:
  2458                                  	;mov	[next_val], al
  2459 00001142 88C7                    	mov	bh, al
  2460                                  	;add	al, [previous_val]
  2461 00001144 00D8                    	add	al, bl
  2462 00001146 D0D8                    	rcr	al, 1
  2463 00001148 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2464                                  	;add	al, [previous_val]
  2465 0000114A 00D8                    	add	al, bl
  2466 0000114C D0D8                    	rcr	al, 1
  2467 0000114E 2C80                    	sub	al, 80h
  2468 00001150 66C1E008                	shl	ax, 8
  2469 00001154 66AB                    	stosw		; this is 1st interpolated sample (L)
  2470 00001156 66AB                    	stosw		; this is 1st interpolated sample (R)
  2471                                  	;mov	al, [next_val]
  2472 00001158 88F8                    	mov	al, bh
  2473 0000115A 00D0                    	add	al, dl
  2474 0000115C D0D8                    	rcr	al, 1
  2475 0000115E 2C80                    	sub	al, 80h
  2476 00001160 66C1E008                	shl	ax, 8
  2477 00001164 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2478 00001166 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2479                                  	
  2480                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2481 00001168 09C9                    	or	ecx, ecx
  2482 0000116A 75C2                    	jnz	short lff16m_1
  2483 0000116C E911FCFFFF              	jmp	lff16m_3
  2484                                  
  2485                                  lff16m_7:
  2486                                  lff16s_7:
  2487 00001171 E92DFCFFFF              	jmp	lff16m_5  ; error
  2488                                  
  2489                                  load_16khz_stereo_8_bit:
  2490                                  	; 14/11/2023
  2491                                  	; 13/11/2023
  2492 00001176 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2493                                  					; last of the file?
  2494 0000117D 7402                    	jz	short lff16s_0		; no
  2495 0000117F F9                      	stc
  2496 00001180 C3                      	retn
  2497                                  
  2498                                  lff16s_0:
  2499                                  	; 01/12/2024
  2500                                  	; edi = audio buffer address
  2501 00001181 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2502                                          ;mov	edx, [loadsize]
  2503                                  
  2504                                  	; esi = buffer address
  2505                                  	;; edx = buffer size
  2506                                  
  2507                                  	; load file into memory
  2508                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001186 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000118C 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000118E 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001194 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001199 CD40                <1>  int 40h
  2509 0000119B 72D4                    	jc	short lff16s_7 ; error !
  2510                                  
  2511                                  	; 01/12/2024
  2512 0000119D A3[907F0000]            	mov	[count], eax
  2513                                  	;;;
  2514                                  	; 07/12/2024
  2515                                  	;mov	edi, audio_buffer
  2516                                  	;;;
  2517 000011A2 D1E8                    	shr	eax, 1
  2518 000011A4 7505                    	jnz	short lff16s_8
  2519 000011A6 E9EFFBFFFF              	jmp	lff16_eof
  2520                                  
  2521                                  lff16s_8:
  2522 000011AB 89C1                    	mov	ecx, eax	; word count
  2523                                  lff16s_1:
  2524 000011AD AC                      	lodsb
  2525 000011AE A2[EF220000]            	mov	[previous_val_l], al
  2526 000011B3 2C80                    	sub	al, 80h
  2527 000011B5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2528 000011B9 66AB                    	stosw		; original sample (L)
  2529 000011BB AC                      	lodsb
  2530 000011BC A2[F1220000]            	mov	[previous_val_r], al
  2531 000011C1 2C80                    	sub	al, 80h
  2532 000011C3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2533 000011C7 66AB                    	stosw		; original sample (R)
  2534                                  
  2535                                  	;xor	eax, eax
  2536 000011C9 66B88080                	mov	ax, 8080h
  2537 000011CD 49                      	dec	ecx
  2538 000011CE 7403                    	jz	short lff16s_2
  2539                                  		; convert 8 bit sample to 16 bit sample
  2540 000011D0 668B06                  	mov	ax, [esi]
  2541                                  lff16s_2:
  2542                                  	;mov	[next_val_l], al
  2543                                  	;mov	[next_val_r], ah
  2544 000011D3 89C3                    	mov	ebx, eax
  2545 000011D5 0205[EF220000]          	add	al, [previous_val_l]
  2546 000011DB D0D8                    	rcr	al, 1
  2547 000011DD 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2548 000011DF 0205[EF220000]          	add	al, [previous_val_l]
  2549 000011E5 D0D8                    	rcr	al, 1
  2550 000011E7 2C80                    	sub	al, 80h
  2551 000011E9 66C1E008                	shl	ax, 8
  2552 000011ED 66AB                    	stosw		; this is 1st interpolated sample (L)
  2553 000011EF 88F8                    	mov	al, bh	; [next_val_r]
  2554 000011F1 0205[F1220000]          	add	al, [previous_val_r]
  2555 000011F7 D0D8                    	rcr	al, 1
  2556 000011F9 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2557 000011FB 0205[F1220000]          	add	al, [previous_val_r]
  2558 00001201 D0D8                    	rcr	al, 1
  2559 00001203 2C80                    	sub	al, 80h
  2560 00001205 66C1E008                	shl	ax, 8
  2561 00001209 66AB                    	stosw		; this is 1st interpolated sample (R)
  2562 0000120B 88D0                    	mov	al, dl
  2563 0000120D 00D8                    	add	al, bl	; [next_val_l]
  2564 0000120F D0D8                    	rcr	al, 1
  2565 00001211 2C80                    	sub	al, 80h
  2566 00001213 66C1E008                	shl	ax, 8
  2567 00001217 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2568 00001219 88F0                    	mov	al, dh
  2569 0000121B 00F8                    	add	al, bh	; [next_val_r]
  2570 0000121D D0D8                    	rcr	al, 1
  2571 0000121F 2C80                    	sub	al, 80h
  2572 00001221 66C1E008                	shl	ax, 8
  2573 00001225 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2574                                  	
  2575                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2576 00001227 09C9                    	or	ecx, ecx
  2577 00001229 7582                    	jnz	short lff16s_1
  2578 0000122B E952FBFFFF              	jmp	lff16s_3
  2579                                  
  2580                                  load_16khz_mono_16_bit:
  2581                                  	; 15/11/2023
  2582                                  	; 13/11/2023
  2583 00001230 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2584                                  					; last of the file?
  2585 00001237 7402                    	jz	short lff16m2_0		; no
  2586 00001239 F9                      	stc
  2587 0000123A C3                      	retn
  2588                                  
  2589                                  lff16m2_0:
  2590                                  	; 01/12/2024
  2591                                  	; edi = audio buffer address
  2592 0000123B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2593                                          ;mov	edx, [loadsize]
  2594                                  
  2595                                  	; esi = buffer address
  2596                                  	;; edx = buffer size
  2597                                  
  2598                                  	; load file into memory
  2599                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001240 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001246 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001248 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000124E B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001253 CD40                <1>  int 40h
  2600 00001255 7255                    	jc	short lff16m2_7 ; error !
  2601                                  
  2602                                  	; 01/12/2024
  2603 00001257 A3[907F0000]            	mov	[count], eax
  2604                                  	;;;
  2605                                  	; 07/12/2024
  2606                                  	;mov	edi, audio_buffer
  2607                                  	;;;
  2608 0000125C D1E8                    	shr	eax, 1
  2609 0000125E 7505                    	jnz	short lff16m2_8
  2610 00001260 E935FBFFFF              	jmp	lff16_eof
  2611                                  
  2612                                  lff16m2_8:
  2613 00001265 89C1                    	mov	ecx, eax  ; word count
  2614                                  lff16m2_1:
  2615 00001267 66AD                    	lodsw
  2616 00001269 66AB                    	stosw		; original sample (left channel)
  2617 0000126B 66AB                    	stosw		; original sample (right channel)
  2618 0000126D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2619                                  	;mov	[previous_val], ax
  2620 00001270 89C3                    	mov	ebx, eax
  2621 00001272 31C0                    	xor	eax, eax
  2622 00001274 49                      	dec	ecx
  2623 00001275 7403                    	jz	short lff16m2_2
  2624 00001277 668B06                  	mov	ax, [esi]
  2625                                  lff16m2_2:
  2626 0000127A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2627 0000127D 89C5                    	mov	ebp, eax	; [next_val]
  2628                                  	;add	ax, [previous_val]
  2629 0000127F 6601D8                  	add	ax, bx
  2630 00001282 66D1D8                  	rcr	ax, 1
  2631 00001285 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2632                                  	;add	ax, [previous_val]
  2633 00001287 6601D8                  	add	ax, bx
  2634 0000128A 66D1D8                  	rcr	ax, 1
  2635 0000128D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2636 00001290 66AB                    	stosw		; this is 1st interpolated sample (L)
  2637 00001292 66AB                    	stosw		; this is 1st interpolated sample (R)
  2638 00001294 89E8                    	mov	eax, ebp
  2639 00001296 6601D0                  	add	ax, dx
  2640 00001299 66D1D8                  	rcr	ax, 1
  2641 0000129C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2642 0000129F 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2643 000012A1 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2644                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2645 000012A3 09C9                    	or	ecx, ecx
  2646 000012A5 75C0                    	jnz	short lff16m2_1
  2647 000012A7 E9D6FAFFFF              	jmp	lff16m2_3
  2648                                  
  2649                                  lff16m2_7:
  2650                                  lff16s2_7:
  2651 000012AC E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2652                                  
  2653                                  load_16khz_stereo_16_bit:
  2654                                  	; 16/11/2023
  2655                                  	; 15/11/2023
  2656                                  	; 13/11/2023
  2657 000012B1 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2658                                  					; last of the file?
  2659 000012B8 7402                    	jz	short lff16s2_0		; no
  2660 000012BA F9                      	stc
  2661 000012BB C3                      	retn
  2662                                  
  2663                                  lff16s2_0:
  2664                                  	; 01/12/2024
  2665                                  	; edi = audio buffer address
  2666 000012BC BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2667                                          ;mov	edx, [loadsize]
  2668                                  
  2669                                  	; esi = buffer address
  2670                                  	;; edx = buffer size
  2671                                  
  2672                                  	; load file into memory
  2673                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000012C1 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000012C7 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000012C9 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000012CF B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000012D4 CD40                <1>  int 40h
  2674 000012D6 72D4                    	jc	short lff16s2_7 ; error !
  2675                                  
  2676                                  	; 01/12/2024
  2677 000012D8 A3[907F0000]            	mov	[count], eax
  2678                                  	;;;
  2679                                  	; 07/12/2024
  2680                                  	;mov	edi, audio_buffer
  2681                                  	;;;
  2682 000012DD C1E802                  	shr	eax, 2
  2683 000012E0 7505                    	jnz	short lff16s2_8
  2684 000012E2 E9B3FAFFFF              	jmp	lff16_eof
  2685                                  
  2686                                  lff16s2_8:
  2687 000012E7 89C1                    	mov	ecx, eax  ; dword count
  2688                                  lff16s2_1:
  2689 000012E9 66AD                    	lodsw
  2690 000012EB 66AB                    	stosw		; original sample (L)
  2691 000012ED 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2692 000012F0 66A3[EF220000]          	mov	[previous_val_l], ax
  2693 000012F6 66AD                    	lodsw
  2694 000012F8 66AB                    	stosw		; original sample (R)
  2695 000012FA 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2696 000012FD 66A3[F1220000]          	mov	[previous_val_r], ax
  2697 00001303 31D2                    	xor	edx, edx
  2698 00001305 31C0                    	xor	eax, eax
  2699                                  	; 16/11/2023
  2700 00001307 49                      	dec	ecx
  2701 00001308 7407                    	jz	short lff16s2_2
  2702 0000130A 668B06                  	mov	ax, [esi]
  2703 0000130D 668B5602                	mov	dx, [esi+2]
  2704                                  lff16s2_2:
  2705 00001311 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2706                                  	;mov	[next_val_l], ax
  2707 00001314 89C5                    	mov	ebp, eax
  2708 00001316 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2709 00001319 668915[F5220000]        	mov	[next_val_r], dx
  2710 00001320 660305[EF220000]        	add	ax, [previous_val_l]
  2711 00001327 66D1D8                  	rcr	ax, 1
  2712 0000132A 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2713 0000132C 660305[EF220000]        	add	ax, [previous_val_l]
  2714 00001333 66D1D8                  	rcr	ax, 1
  2715 00001336 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2716 00001339 66AB                    	stosw		; this is 1st interpolated sample (L)
  2717 0000133B 66A1[F5220000]          	mov	ax, [next_val_r]
  2718 00001341 660305[F1220000]        	add	ax, [previous_val_r]
  2719 00001348 66D1D8                  	rcr	ax, 1
  2720 0000134B 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2721 0000134D 660305[F1220000]        	add	ax, [previous_val_r]
  2722 00001354 66D1D8                  	rcr	ax, 1
  2723 00001357 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2724 0000135A 66AB                    	stosw		; this is 1st interpolated sample (R)
  2725                                  	;mov	ax, [next_val_l]
  2726 0000135C 89E8                    	mov	eax, ebp
  2727 0000135E 6601D0                  	add	ax, dx
  2728 00001361 66D1D8                  	rcr	ax, 1
  2729 00001364 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2730 00001367 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2731 00001369 66A1[F5220000]          	mov	ax, [next_val_r]
  2732 0000136F 6601D8                  	add	ax, bx
  2733 00001372 66D1D8                  	rcr	ax, 1
  2734 00001375 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2735 00001378 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2736                                  	
  2737                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2738 0000137A 09C9                    	or	ecx, ecx
  2739 0000137C 0F8567FFFFFF            	jnz	lff16s2_1
  2740 00001382 E9FBF9FFFF              	jmp	lff16s2_3
  2741                                  
  2742                                  ; .....................
  2743                                  
  2744                                  load_24khz_mono_8_bit:
  2745                                  	; 15/11/2023
  2746 00001387 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2747                                  					; last of the file?
  2748 0000138E 7402                    	jz	short lff24m_0		; no
  2749 00001390 F9                      	stc
  2750 00001391 C3                      	retn
  2751                                  
  2752                                  lff24m_0:
  2753                                  	; 01/12/2024
  2754                                  	; edi = audio buffer address
  2755 00001392 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2756                                          ;mov	edx, [loadsize]
  2757                                  
  2758                                  	; esi = buffer address
  2759                                  	;; edx = buffer size
  2760                                  
  2761                                  	; load file into memory
  2762                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001397 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000139D 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000139F 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000013A5 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000013AA CD40                <1>  int 40h
  2763 000013AC 723B                    	jc	short lff24m_7 ; error !
  2764                                  
  2765                                  	; 01/12/2024
  2766 000013AE A3[907F0000]            	mov	[count], eax
  2767                                  	;;;
  2768                                  	; 07/12/2024
  2769                                  	;mov	edi, audio_buffer
  2770                                  	;;;
  2771 000013B3 21C0                    	and	eax, eax
  2772 000013B5 7505                    	jnz	short lff24m_8
  2773 000013B7 E9DEF9FFFF              	jmp	lff24_eof
  2774                                  
  2775                                  lff24m_8:
  2776 000013BC 89C1                    	mov	ecx, eax	; byte count
  2777                                  lff24m_1:
  2778 000013BE AC                      	lodsb
  2779                                  	;mov	[previous_val], al
  2780 000013BF 88C3                    	mov	bl, al
  2781 000013C1 2C80                    	sub	al, 80h
  2782 000013C3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2783 000013C7 66AB                    	stosw		; original sample (left channel)
  2784 000013C9 66AB                    	stosw		; original sample (right channel)
  2785                                  	;xor	eax, eax
  2786 000013CB B080                    	mov	al, 80h
  2787 000013CD 49                      	dec	ecx
  2788 000013CE 7402                    	jz	short lff24m_2
  2789 000013D0 8A06                    	mov	al, [esi]
  2790                                  lff24m_2:
  2791                                  	;;mov	[next_val], al
  2792                                  	;mov	bh, al
  2793                                  	;add	al, [previous_val]
  2794 000013D2 00D8                    	add	al, bl
  2795 000013D4 D0D8                    	rcr	al, 1
  2796 000013D6 2C80                    	sub	al, 80h
  2797 000013D8 66C1E008                	shl	ax, 8
  2798 000013DC 66AB                    	stosw		; this is interpolated sample (L)
  2799 000013DE 66AB                    	stosw		; this is interpolated sample (R)
  2800                                  	
  2801                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2802 000013E0 09C9                    	or	ecx, ecx
  2803 000013E2 75DA                    	jnz	short lff24m_1
  2804 000013E4 E999F9FFFF              	jmp	lff24_3
  2805                                  
  2806                                  lff24m_7:
  2807                                  lff24s_7:
  2808 000013E9 E9B5F9FFFF              	jmp	lff24_5  ; error
  2809                                  
  2810                                  load_24khz_stereo_8_bit:
  2811                                  	; 15/11/2023
  2812 000013EE F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2813                                  					; last of the file?
  2814 000013F5 7402                    	jz	short lff24s_0		; no
  2815 000013F7 F9                      	stc
  2816 000013F8 C3                      	retn
  2817                                  
  2818                                  lff24s_0:
  2819                                  	; 01/12/2024
  2820                                  	; edi = audio buffer address
  2821 000013F9 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2822                                          ;mov	edx, [loadsize]
  2823                                  
  2824                                  	; esi = buffer address
  2825                                  	;; edx = buffer size
  2826                                  
  2827                                  	; load file into memory
  2828                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000013FE 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001404 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001406 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000140C B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001411 CD40                <1>  int 40h
  2829 00001413 72D4                    	jc	short lff24s_7 ; error !
  2830                                  
  2831                                  	; 01/12/2024
  2832 00001415 A3[907F0000]            	mov	[count], eax
  2833                                  	;;;
  2834                                  	; 07/12/2024
  2835                                  	;mov	edi, audio_buffer
  2836                                  	;;;
  2837 0000141A D1E8                    	shr	eax, 1
  2838 0000141C 7505                    	jnz	short lff24s_8
  2839 0000141E E977F9FFFF              	jmp	lff24_eof
  2840                                  
  2841                                  lff24s_8:
  2842 00001423 89C1                    	mov	ecx, eax  ; word count
  2843                                  lff24s_1:
  2844 00001425 AC                      	lodsb
  2845 00001426 A2[EF220000]            	mov	[previous_val_l], al
  2846 0000142B 2C80                    	sub	al, 80h
  2847 0000142D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2848 00001431 66AB                    	stosw		; original sample (L)
  2849 00001433 AC                      	lodsb
  2850 00001434 A2[F1220000]            	mov	[previous_val_r], al
  2851 00001439 2C80                    	sub	al, 80h
  2852 0000143B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2853 0000143F 66AB                    	stosw		; original sample (R)
  2854                                  
  2855                                  	;xor	eax, eax
  2856 00001441 66B88080                	mov	ax, 8080h
  2857 00001445 49                      	dec	ecx
  2858 00001446 7403                    	jz	short lff24s_2
  2859                                  		; convert 8 bit sample to 16 bit sample
  2860 00001448 668B06                  	mov	ax, [esi]
  2861                                  lff24s_2:
  2862                                  	;;mov	[next_val_l], al
  2863                                  	;;mov	[next_val_r], ah
  2864                                  	;mov	bx, ax
  2865 0000144B 88E7                    	mov	bh, ah
  2866 0000144D 0205[EF220000]          	add	al, [previous_val_l]
  2867 00001453 D0D8                    	rcr	al, 1
  2868                                  	;mov	dl, al
  2869 00001455 2C80                    	sub	al, 80h
  2870 00001457 66C1E008                	shl	ax, 8
  2871 0000145B 66AB                    	stosw		; this is interpolated sample (L)
  2872 0000145D 88F8                    	mov	al, bh	; [next_val_r]
  2873 0000145F 0205[F1220000]          	add	al, [previous_val_r]
  2874 00001465 D0D8                    	rcr	al, 1
  2875                                  	;mov	dh, al
  2876 00001467 2C80                    	sub	al, 80h
  2877 00001469 66C1E008                	shl	ax, 8
  2878 0000146D 66AB                    	stosw		; this is interpolated sample (R)
  2879                                  		
  2880                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2881 0000146F 09C9                    	or	ecx, ecx
  2882 00001471 75B2                    	jnz	short lff24s_1
  2883 00001473 E90AF9FFFF              	jmp	lff24_3
  2884                                  
  2885                                  load_24khz_mono_16_bit:
  2886                                  	; 15/11/2023
  2887 00001478 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2888                                  					; last of the file?
  2889 0000147F 7402                    	jz	short lff24m2_0		; no
  2890 00001481 F9                      	stc
  2891 00001482 C3                      	retn
  2892                                  
  2893                                  lff24m2_0:
  2894                                  	; 01/12/2024
  2895                                  	; edi = audio buffer address
  2896 00001483 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2897                                          ;mov	edx, [loadsize]
  2898                                  
  2899                                  	; esi = buffer address
  2900                                  	;; edx = buffer size
  2901                                  
  2902                                  	; load file into memory
  2903                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001488 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000148E 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001490 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001496 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 0000149B CD40                <1>  int 40h
  2904 0000149D 7237                    	jc	short lff24m2_7 ; error !
  2905                                  
  2906                                  	; 01/12/2024
  2907 0000149F A3[907F0000]            	mov	[count], eax
  2908                                  	;;;
  2909                                  	; 07/12/2024
  2910                                  	;mov	edi, audio_buffer
  2911                                  	;;;
  2912 000014A4 D1E8                    	shr	eax, 1
  2913 000014A6 7505                    	jnz	short lff24m2_8
  2914 000014A8 E9EDF8FFFF              	jmp	lff24_eof
  2915                                  
  2916                                  lff24m2_8:
  2917 000014AD 89C1                    	mov	ecx, eax  ; word count
  2918                                  lff24m2_1:
  2919 000014AF 66AD                    	lodsw
  2920 000014B1 66AB                    	stosw		; original sample (left channel)
  2921 000014B3 66AB                    	stosw		; original sample (right channel)
  2922 000014B5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2923                                  	;mov	[previous_val], ax
  2924                                  	;mov	ebx, eax
  2925                                  	;xor	eax, eax
  2926 000014B8 31DB                    	xor	ebx, ebx
  2927 000014BA 49                      	dec	ecx
  2928 000014BB 7403                    	jz	short lff24m2_2
  2929                                  	;mov	ax, [esi]
  2930 000014BD 668B1E                  	mov	bx, [esi]
  2931                                  lff24m2_2:
  2932                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2933                                  	;mov	ebp, eax	; [next_val]
  2934                                  	;add	ax, [previous_val]
  2935                                  	; ax = [previous_val]
  2936                                  	; bx = [next_val]
  2937 000014C0 6601D8                  	add	ax, bx
  2938 000014C3 66D1D8                  	rcr	ax, 1
  2939 000014C6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2940 000014C9 66AB                    	stosw		; this is interpolated sample (L)
  2941 000014CB 66AB                    	stosw		; this is interpolated sample (R)
  2942                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2943 000014CD 09C9                    	or	ecx, ecx
  2944 000014CF 75DE                    	jnz	short lff24m2_1
  2945 000014D1 E9ACF8FFFF              	jmp	lff24_3
  2946                                  
  2947                                  lff24m2_7:
  2948                                  lff24s2_7:
  2949 000014D6 E9C8F8FFFF              	jmp	lff24_5  ; error
  2950                                  
  2951                                  load_24khz_stereo_16_bit:
  2952                                  	; 16/11/2023
  2953                                  	; 15/11/2023
  2954 000014DB F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2955                                  					; last of the file?
  2956 000014E2 7402                    	jz	short lff24s2_0		; no
  2957 000014E4 F9                      	stc
  2958 000014E5 C3                      	retn
  2959                                  
  2960                                  lff24s2_0:
  2961                                  	; 01/12/2024
  2962                                  	; edi = audio buffer address
  2963 000014E6 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2964                                          ;mov	edx, [loadsize]
  2965                                  
  2966                                  	; esi = buffer address
  2967                                  	;; edx = buffer size
  2968                                  
  2969                                  	; load file into memory
  2970                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000014EB 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000014F1 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000014F3 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000014F9 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000014FE CD40                <1>  int 40h
  2971 00001500 72D4                    	jc	short lff24s2_7 ; error !
  2972                                  
  2973                                  	; 01/12/2024
  2974 00001502 A3[907F0000]            	mov	[count], eax
  2975                                  	;;;
  2976                                  	; 07/12/2024
  2977                                  	;mov	edi, audio_buffer
  2978                                  	;;;
  2979 00001507 C1E802                  	shr	eax, 2
  2980 0000150A 7505                    	jnz	short lff24s2_8
  2981 0000150C E989F8FFFF              	jmp	lff24_eof
  2982                                  
  2983                                  lff24s2_8:
  2984 00001511 89C1                    	mov	ecx, eax  ; dword count
  2985                                  lff24s2_1:
  2986 00001513 66AD                    	lodsw
  2987 00001515 66AB                    	stosw		; original sample (L)
  2988 00001517 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2989 0000151A 66A3[EF220000]          	mov	[previous_val_l], ax
  2990 00001520 66AD                    	lodsw
  2991 00001522 66AB                    	stosw		; original sample (R)
  2992 00001524 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2993                                  	;mov	[previous_val_r], ax
  2994 00001527 89C3                    	mov	ebx, eax
  2995 00001529 31D2                    	xor	edx, edx
  2996 0000152B 31C0                    	xor	eax, eax
  2997                                  	; 16/11/2023
  2998 0000152D 49                      	dec	ecx
  2999 0000152E 7407                    	jz	short lff24s2_2
  3000 00001530 668B06                  	mov	ax, [esi]
  3001 00001533 668B5602                	mov	dx, [esi+2]
  3002                                  lff24s2_2:
  3003 00001537 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3004                                  	;;mov	[next_val_l], ax
  3005                                  	;mov	ebp, eax
  3006 0000153A 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3007                                  	;mov	[next_val_r], dx
  3008 0000153D 660305[EF220000]        	add	ax, [previous_val_l]
  3009 00001544 66D1D8                  	rcr	ax, 1
  3010 00001547 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3011 0000154A 66AB                    	stosw		; this is interpolated sample (L)
  3012                                  	;mov	ax, [next_val_r]
  3013 0000154C 89D0                    	mov	eax, edx
  3014                                  	;add	ax, [previous_val_r]
  3015 0000154E 6601D8                  	add	ax, bx
  3016 00001551 66D1D8                  	rcr	ax, 1
  3017 00001554 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3018 00001557 66AB                    	stosw		; this is interpolated sample (R)
  3019                                  	
  3020                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3021 00001559 09C9                    	or	ecx, ecx
  3022 0000155B 75B6                    	jnz	short lff24s2_1
  3023 0000155D E920F8FFFF              	jmp	lff24_3
  3024                                  
  3025                                  ; .....................
  3026                                  
  3027                                  load_32khz_mono_8_bit:
  3028                                  	; 15/11/2023
  3029 00001562 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3030                                  					; last of the file?
  3031 00001569 7402                    	jz	short lff32m_0		; no
  3032 0000156B F9                      	stc
  3033 0000156C C3                      	retn
  3034                                  
  3035                                  lff32m_0:
  3036                                  	; 01/12/2024
  3037                                  	; edi = audio buffer address
  3038 0000156D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3039                                          ;mov	edx, [loadsize]
  3040                                  
  3041                                  	; esi = buffer address
  3042                                  	;; edx = buffer size
  3043                                  
  3044                                  	; load file into memory
  3045                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001572 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001578 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000157A 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001580 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001585 CD40                <1>  int 40h
  3046 00001587 7247                    	jc	short lff32m_7 ; error !
  3047                                  
  3048                                  	; 01/12/2024
  3049 00001589 A3[907F0000]            	mov	[count], eax
  3050                                  	;;;
  3051                                  	; 07/12/2024
  3052                                  	;mov	edi, audio_buffer
  3053                                  	;;;
  3054 0000158E 21C0                    	and	eax, eax
  3055 00001590 7505                    	jnz	short lff32m_8
  3056 00001592 E903F8FFFF              	jmp	lff32_eof
  3057                                  
  3058                                  lff32m_8:
  3059 00001597 89C1                    	mov	ecx, eax	; byte count
  3060                                  lff32m_1:
  3061 00001599 AC                      	lodsb
  3062                                  	;mov	[previous_val], al
  3063 0000159A 88C3                    	mov	bl, al
  3064 0000159C 2C80                    	sub	al, 80h
  3065 0000159E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3066 000015A2 66AB                    	stosw		; original sample (left channel)
  3067 000015A4 66AB                    	stosw		; original sample (right channel)
  3068                                  	;xor	eax, eax
  3069 000015A6 B080                    	mov	al, 80h
  3070 000015A8 49                      	dec	ecx
  3071 000015A9 7402                    	jz	short lff32m_2
  3072 000015AB 8A06                    	mov	al, [esi]
  3073                                  lff32m_2:
  3074                                  	;;mov	[next_val], al
  3075                                  	;mov	bh, al
  3076                                  	;add	al, [previous_val]
  3077 000015AD 00D8                    	add	al, bl
  3078 000015AF D0D8                    	rcr	al, 1
  3079 000015B1 2C80                    	sub	al, 80h
  3080 000015B3 66C1E008                	shl	ax, 8
  3081 000015B7 66AB                    	stosw		; this is interpolated sample (L)
  3082 000015B9 66AB                    	stosw		; this is interpolated sample (R)
  3083                                  	
  3084                                  	; different than 8-16-24 kHZ !
  3085                                  	; 'original-interpolated-original' trio samples
  3086 000015BB E30E                    	jecxz	lff32m_3
  3087                                  
  3088 000015BD AC                      	lodsb
  3089 000015BE 2C80                    	sub	al, 80h
  3090 000015C0 66C1E008                	shl	ax, 8
  3091 000015C4 66AB                    	stosw		; original sample (left channel)
  3092 000015C6 66AB                    	stosw		; original sample (right channel)
  3093                                  
  3094                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3095 000015C8 49                      	dec	ecx
  3096 000015C9 75CE                    	jnz	short lff32m_1
  3097                                  lff32m_3:
  3098 000015CB E9B2F7FFFF              	jmp	lff32_3
  3099                                  
  3100                                  lff32m_7:
  3101                                  lff32s_7:
  3102 000015D0 E9CEF7FFFF              	jmp	lff32_5  ; error
  3103                                  
  3104                                  load_32khz_stereo_8_bit:
  3105                                  	; 15/11/2023
  3106 000015D5 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3107                                  					; last of the file?
  3108 000015DC 7402                    	jz	short lff32s_0		; no
  3109 000015DE F9                      	stc
  3110 000015DF C3                      	retn
  3111                                  
  3112                                  lff32s_0:
  3113                                  	; 01/12/2024
  3114                                  	; edi = audio buffer address
  3115 000015E0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3116                                          ;mov	edx, [loadsize]
  3117                                  
  3118                                  	; esi = buffer address
  3119                                  	;; edx = buffer size
  3120                                  
  3121                                  	; load file into memory
  3122                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000015E5 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000015EB 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000015ED 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000015F3 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000015F8 CD40                <1>  int 40h
  3123 000015FA 72D4                    	jc	short lff32s_7 ; error !
  3124                                  
  3125                                  	; 01/12/2024
  3126 000015FC A3[907F0000]            	mov	[count], eax
  3127                                  	;;;
  3128                                  	; 07/12/2024
  3129                                  	;mov	edi, audio_buffer
  3130                                  	;;;
  3131 00001601 D1E8                    	shr	eax, 1
  3132 00001603 7505                    	jnz	short lff32s_8
  3133 00001605 E990F7FFFF              	jmp	lff32_eof
  3134                                  
  3135                                  lff32s_8:
  3136 0000160A 89C1                    	mov	ecx, eax  ; word count
  3137                                  lff32s_1:
  3138 0000160C AC                      	lodsb
  3139 0000160D A2[EF220000]            	mov	[previous_val_l], al
  3140 00001612 2C80                    	sub	al, 80h
  3141 00001614 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3142 00001618 66AB                    	stosw		; original sample (L)
  3143 0000161A AC                      	lodsb
  3144 0000161B A2[F1220000]            	mov	[previous_val_r], al
  3145 00001620 2C80                    	sub	al, 80h
  3146 00001622 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3147 00001626 66AB                    	stosw		; original sample (R)
  3148                                  
  3149                                  	;xor	eax, eax
  3150 00001628 66B88080                	mov	ax, 8080h
  3151 0000162C 49                      	dec	ecx
  3152 0000162D 7403                    	jz	short lff32s_2
  3153                                  		; convert 8 bit sample to 16 bit sample
  3154 0000162F 668B06                  	mov	ax, [esi]
  3155                                  lff32s_2:
  3156                                  	;;mov	[next_val_l], al
  3157                                  	;;mov	[next_val_r], ah
  3158                                  	;mov	bx, ax
  3159 00001632 88E7                    	mov	bh, ah
  3160 00001634 0205[EF220000]          	add	al, [previous_val_l]
  3161 0000163A D0D8                    	rcr	al, 1
  3162                                  	;mov	dl, al
  3163 0000163C 2C80                    	sub	al, 80h
  3164 0000163E 66C1E008                	shl	ax, 8
  3165 00001642 66AB                    	stosw		; this is interpolated sample (L)
  3166 00001644 88F8                    	mov	al, bh	; [next_val_r]
  3167 00001646 0205[F1220000]          	add	al, [previous_val_r]
  3168 0000164C D0D8                    	rcr	al, 1
  3169                                  	;mov	dh, al
  3170 0000164E 2C80                    	sub	al, 80h
  3171 00001650 66C1E008                	shl	ax, 8
  3172 00001654 66AB                    	stosw		; this is interpolated sample (R)
  3173                                  
  3174                                  	; different than 8-16-24 kHZ !
  3175                                  	; 'original-interpolated-original' trio samples
  3176 00001656 E315                    	jecxz	lff32s_3
  3177                                  
  3178 00001658 AC                      	lodsb
  3179 00001659 2C80                    	sub	al, 80h
  3180 0000165B 66C1E008                	shl	ax, 8
  3181 0000165F 66AB                    	stosw		; original sample (left channel)
  3182                                  
  3183 00001661 AC                      	lodsb
  3184 00001662 2C80                    	sub	al, 80h
  3185 00001664 66C1E008                	shl	ax, 8
  3186 00001668 66AB                    	stosw		; original sample (right channel)
  3187                                  		
  3188                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3189 0000166A 49                      	dec	ecx
  3190 0000166B 759F                    	jnz	short lff32s_1
  3191                                  lff32s_3:
  3192 0000166D E910F7FFFF              	jmp	lff32_3
  3193                                  
  3194                                  load_32khz_mono_16_bit:
  3195                                  	; 15/11/2023
  3196 00001672 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3197                                  					; last of the file?
  3198 00001679 7402                    	jz	short lff32m2_0		; no
  3199 0000167B F9                      	stc
  3200 0000167C C3                      	retn
  3201                                  
  3202                                  lff32m2_0:
  3203                                  	; 01/12/2024
  3204                                  	; edi = audio buffer address
  3205 0000167D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3206                                          ;mov	edx, [loadsize]
  3207                                  
  3208                                  	; esi = buffer address
  3209                                  	;; edx = buffer size
  3210                                  
  3211                                  	; load file into memory
  3212                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001682 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001688 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000168A 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001690 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001695 CD40                <1>  int 40h
  3213 00001697 723E                    	jc	short lff32m2_7 ; error !
  3214                                  
  3215                                  	; 01/12/2024
  3216 00001699 A3[907F0000]            	mov	[count], eax
  3217                                  	;;;
  3218                                  	; 07/12/2024
  3219                                  	;mov	edi, audio_buffer
  3220                                  	;;;
  3221 0000169E D1E8                    	shr	eax, 1
  3222 000016A0 7505                    	jnz	short lff32m2_8
  3223 000016A2 E9F3F6FFFF              	jmp	lff32_eof
  3224                                  
  3225                                  lff32m2_8:
  3226 000016A7 89C1                    	mov	ecx, eax  ; word count
  3227                                  lff32m2_1:
  3228 000016A9 66AD                    	lodsw
  3229 000016AB 66AB                    	stosw		; original sample (left channel)
  3230 000016AD 66AB                    	stosw		; original sample (right channel)
  3231 000016AF 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3232                                  	;mov	[previous_val], ax
  3233                                  	;mov	ebx, eax
  3234                                  	;xor	eax, eax
  3235 000016B2 31DB                    	xor	ebx, ebx
  3236 000016B4 49                      	dec	ecx
  3237 000016B5 7403                    	jz	short lff32m2_2
  3238                                  	;mov	ax, [esi]
  3239 000016B7 668B1E                  	mov	bx, [esi]
  3240                                  lff32m2_2:
  3241                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  3242                                  	;mov	ebp, eax ; [next_val]
  3243                                  	;add	ax, [previous_val]
  3244                                  	; ax = [previous_val]
  3245                                  	; bx = [next_val]
  3246 000016BA 6601D8                  	add	ax, bx
  3247 000016BD 66D1D8                  	rcr	ax, 1
  3248 000016C0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3249 000016C3 66AB                    	stosw		; this is interpolated sample (L)
  3250 000016C5 66AB                    	stosw		; this is interpolated sample (R)
  3251                                  
  3252                                  	; different than 8-16-24 kHZ !
  3253                                  	; 'original-interpolated-original' trio samples 
  3254 000016C7 E309                    	jecxz	lff32m2_3
  3255                                  
  3256 000016C9 66AD                    	lodsw
  3257 000016CB 66AB                    	stosw		; original sample (left channel)
  3258 000016CD 66AB                    	stosw		; original sample (right channel)
  3259                                  
  3260                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3261 000016CF 49                      	dec	ecx
  3262 000016D0 75D7                    	jnz	short lff32m2_1
  3263                                  lff32m2_3:
  3264 000016D2 E9ABF6FFFF              	jmp	lff32_3
  3265                                  
  3266                                  lff32m2_7:
  3267                                  lff32s2_7:
  3268 000016D7 E9C7F6FFFF              	jmp	lff32_5  ; error
  3269                                  
  3270                                  load_32khz_stereo_16_bit:
  3271                                  	; 16/11/2023
  3272                                  	; 15/11/2023
  3273 000016DC F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3274                                  					; last of the file?
  3275 000016E3 7402                    	jz	short lff32s2_0		; no
  3276 000016E5 F9                      	stc
  3277 000016E6 C3                      	retn
  3278                                  
  3279                                  lff32s2_0:
  3280                                  	; 01/12/2024
  3281                                  	; edi = audio buffer address
  3282 000016E7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3283                                          ;mov	edx, [loadsize]
  3284                                  
  3285                                  	; esi = buffer address
  3286                                  	;; edx = buffer size
  3287                                  
  3288                                  	; load file into memory
  3289                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000016EC 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000016F2 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000016F4 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000016FA B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000016FF CD40                <1>  int 40h
  3290 00001701 72D4                    	jc	short lff32s2_7 ; error !
  3291                                  
  3292                                  	; 01/12/2024
  3293 00001703 A3[907F0000]            	mov	[count], eax
  3294                                  	;;;
  3295                                  	; 07/12/2024
  3296                                  	;mov	edi, audio_buffer
  3297                                  	;;;
  3298 00001708 C1E802                  	shr	eax, 2
  3299 0000170B 7505                    	jnz	short lff32s2_8
  3300 0000170D E988F6FFFF              	jmp	lff32_eof
  3301                                  
  3302                                  lff32s2_8:
  3303 00001712 89C1                    	mov	ecx, eax ; dword count
  3304                                  lff32s2_1:
  3305 00001714 66AD                    	lodsw
  3306 00001716 66AB                    	stosw		; original sample (L)
  3307 00001718 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3308 0000171B 66A3[EF220000]          	mov	[previous_val_l], ax
  3309 00001721 66AD                    	lodsw
  3310 00001723 66AB                    	stosw		; original sample (R)
  3311 00001725 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3312                                  	;mov	[previous_val_r], ax
  3313 00001728 89C3                    	mov	ebx, eax
  3314 0000172A 31D2                    	xor	edx, edx
  3315 0000172C 31C0                    	xor	eax, eax
  3316                                  	; 16/11/2023
  3317 0000172E 49                      	dec	ecx
  3318 0000172F 7407                    	jz	short lff32s2_2
  3319 00001731 668B06                  	mov	ax, [esi]
  3320 00001734 668B5602                	mov	dx, [esi+2]
  3321                                  lff32s2_2:
  3322 00001738 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3323                                  	;;mov	[next_val_l], ax
  3324                                  	;mov	ebp, eax
  3325 0000173B 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3326                                  	;mov	[next_val_r], dx
  3327 0000173E 660305[EF220000]        	add	ax, [previous_val_l]
  3328 00001745 66D1D8                  	rcr	ax, 1
  3329 00001748 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3330 0000174B 66AB                    	stosw		; this is interpolated sample (L)
  3331                                  	;mov	ax, [next_val_r]
  3332 0000174D 89D0                    	mov	eax, edx
  3333                                  	;add	ax, [previous_val_r]
  3334 0000174F 6601D8                  	add	ax, bx
  3335 00001752 66D1D8                  	rcr	ax, 1
  3336 00001755 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3337 00001758 66AB                    	stosw		; this is interpolated sample (R)
  3338                                  
  3339                                  	; different than 8-16-24 kHZ !
  3340                                  	; 'original-interpolated-original' trio samples
  3341 0000175A E30B                    	jecxz	lff32s2_3
  3342                                  
  3343 0000175C 66AD                    	lodsw
  3344 0000175E 66AB                    	stosw	; original sample (L)
  3345 00001760 66AD                    	lodsw
  3346 00001762 66AB                    	stosw	; original sample (R)
  3347                                  	
  3348                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3349 00001764 49                      	dec	ecx
  3350 00001765 75AD                    	jnz	short lff32s2_1
  3351                                  lff32s2_3:
  3352 00001767 E916F6FFFF              	jmp	lff32_3
  3353                                  
  3354                                  ; .....................
  3355                                  
  3356                                  load_22khz_mono_8_bit:
  3357                                  	; 16/11/2023
  3358 0000176C F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3359                                  					; last of the file?
  3360 00001773 7402                    	jz	short lff22m_0		; no
  3361 00001775 F9                      	stc
  3362 00001776 C3                      	retn
  3363                                  
  3364                                  lff22m_0:
  3365                                  	; 01/12/2024
  3366                                  	; edi = audio buffer address
  3367 00001777 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3368                                          ;mov	edx, [loadsize]
  3369                                  
  3370                                  	; esi = buffer address
  3371                                  	;; edx = buffer size
  3372                                  
  3373                                  	; load file into memory
  3374                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000177C 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001782 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001784 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000178A B803000000          <1>  mov eax, %1
   100                              <1> 
   101 0000178F CD40                <1>  int 40h
  3375 00001791 725D                    	jc	short lff22m_7 ; error !
  3376                                  
  3377                                  	; 01/12/2024
  3378 00001793 A3[907F0000]            	mov	[count], eax
  3379                                  	;;;
  3380                                  	; 07/12/2024
  3381                                  	;mov	edi, audio_buffer
  3382                                  	;;;
  3383 00001798 21C0                    	and	eax, eax
  3384 0000179A 7505                    	jnz	short lff22m_8
  3385 0000179C E9F9F5FFFF              	jmp	lff22_eof
  3386                                  
  3387                                  lff22m_8:
  3388 000017A1 89C1                    	mov	ecx, eax	; byte count
  3389                                  lff22m_9:
  3390 000017A3 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3391 000017A8 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3392                                  lff22m_1:
  3393                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3394 000017AF AC                      	lodsb
  3395 000017B0 B280                    	mov	dl, 80h
  3396 000017B2 49                      	dec	ecx
  3397 000017B3 7402                    	jz	short lff22m_2_1
  3398 000017B5 8A16                    	mov	dl, [esi]
  3399                                  lff22m_2_1:	
  3400                                  	; al = [previous_val]
  3401                                  	; dl = [next_val]
  3402 000017B7 E8EF050000              	call	interpolating_3_8bit_mono ; 1 of 17
  3403 000017BC E32D                    	jecxz	lff22m_3
  3404                                  lff22m_2_2:
  3405 000017BE AC                      	lodsb
  3406 000017BF B280                    	mov	dl, 80h
  3407 000017C1 49                      	dec	ecx
  3408 000017C2 7402                    	jz	short lff22m_2_3
  3409 000017C4 8A16                    	mov	dl, [esi]
  3410                                  lff22m_2_3:
  3411 000017C6 E864060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3412 000017CB E31E                    	jecxz	lff22m_3
  3413 000017CD 4D                      	dec	ebp
  3414 000017CE 75EE                    	jnz	short lff22m_2_2
  3415                                  
  3416 000017D0 A0[F7220000]            	mov	al, [faz]
  3417 000017D5 FEC8                    	dec	al
  3418 000017D7 74CA                    	jz	short lff22m_9
  3419 000017D9 FE0D[F7220000]          	dec	byte [faz]
  3420 000017DF BD04000000              	mov	ebp, 4
  3421 000017E4 FEC8                    	dec	al
  3422 000017E6 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3423 000017E8 45                      	inc	ebp ; 5
  3424 000017E9 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3425                                  
  3426                                  lff22m_3:
  3427                                  lff22s_3:
  3428 000017EB E992F5FFFF              	jmp	lff22_3	; padfill
  3429                                  		; (put zeros in the remain words of the buffer)
  3430                                  lff22m_7:
  3431                                  lff22s_7:
  3432 000017F0 E9AEF5FFFF              	jmp	lff22_5  ; error
  3433                                  
  3434                                  load_22khz_stereo_8_bit:
  3435                                  	; 16/11/2023
  3436 000017F5 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3437                                  					; last of the file?
  3438 000017FC 7402                    	jz	short lff22s_0		; no
  3439 000017FE F9                      	stc
  3440 000017FF C3                      	retn
  3441                                  
  3442                                  lff22s_0:
  3443                                  	; 01/12/2024
  3444                                  	; edi = audio buffer address
  3445 00001800 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3446                                          ;mov	edx, [loadsize]
  3447                                  
  3448                                  	; esi = buffer address
  3449                                  	;; edx = buffer size
  3450                                  
  3451                                  	; load file into memory
  3452                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001805 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000180B 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000180D 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001813 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001818 CD40                <1>  int 40h
  3453 0000181A 72D4                    	jc	short lff22s_7 ; error !
  3454                                  
  3455                                  	; 01/12/2024
  3456 0000181C A3[907F0000]            	mov	[count], eax
  3457                                  	;;;
  3458                                  	; 07/12/2024
  3459                                  	;mov	edi, audio_buffer
  3460                                  	;;;
  3461 00001821 D1E8                    	shr	eax, 1
  3462 00001823 7505                    	jnz	short lff22s_8
  3463 00001825 E970F5FFFF              	jmp	lff22_eof
  3464                                  
  3465                                  lff22s_8:
  3466 0000182A 89C1                    	mov	ecx, eax	; word count
  3467                                  lff22s_9:
  3468 0000182C BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3469 00001831 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3470                                  lff22s_1:
  3471                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3472 00001838 66AD                    	lodsw
  3473 0000183A 66BA8080                	mov	dx, 8080h
  3474 0000183E 49                      	dec	ecx
  3475 0000183F 7403                    	jz	short lff22s_2_1
  3476 00001841 668B16                  	mov	dx, [esi]
  3477                                  lff22s_2_1:	
  3478                                  	; al = [previous_val_l]
  3479                                  	; ah = [previous_val_r]
  3480                                  	; dl = [next_val_l]
  3481                                  	; dh = [next_val_r]
  3482 00001844 E893050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3483 00001849 E3A0                    	jecxz	lff22s_3
  3484                                  lff22s_2_2:
  3485 0000184B 66AD                    	lodsw
  3486 0000184D 66BA8080                	mov	dx, 8080h
  3487 00001851 49                      	dec	ecx
  3488 00001852 7403                    	jz	short lff22s_2_3
  3489 00001854 668B16                  	mov	dx, [esi]
  3490                                  lff22s_2_3:
  3491 00001857 E8F0050000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3492 0000185C E38D                    	jecxz	lff22s_3
  3493 0000185E 4D                      	dec	ebp
  3494 0000185F 75EA                    	jnz	short lff22s_2_2
  3495                                  
  3496 00001861 A0[F7220000]            	mov	al, [faz]
  3497 00001866 FEC8                    	dec	al
  3498 00001868 74C2                    	jz	short lff22s_9
  3499 0000186A FE0D[F7220000]          	dec	byte [faz]
  3500 00001870 BD04000000              	mov	ebp, 4
  3501 00001875 FEC8                    	dec	al
  3502 00001877 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3503 00001879 45                      	inc	ebp ; 5
  3504 0000187A EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3505                                  
  3506                                  load_22khz_mono_16_bit:
  3507                                  	; 16/11/2023
  3508 0000187C F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3509                                  					; last of the file?
  3510 00001883 7402                    	jz	short lff22m2_0		; no
  3511 00001885 F9                      	stc
  3512 00001886 C3                      	retn
  3513                                  
  3514                                  lff22m2_0:
  3515                                  	; 01/12/2024
  3516                                  	; edi = audio buffer address
  3517 00001887 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3518                                          ;mov	edx, [loadsize]
  3519                                  
  3520                                  	; esi = buffer address
  3521                                  	;; edx = buffer size
  3522                                  
  3523                                  	; load file into memory
  3524                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 0000188C 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001892 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001894 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000189A B803000000          <1>  mov eax, %1
   100                              <1> 
   101 0000189F CD40                <1>  int 40h
  3525 000018A1 7261                    	jc	short lff22m2_7 ; error !
  3526                                  
  3527                                  	; 01/12/2024
  3528 000018A3 A3[907F0000]            	mov	[count], eax
  3529                                  	;;;
  3530                                  	; 07/12/2024
  3531                                  	;mov	edi, audio_buffer
  3532                                  	;;;
  3533 000018A8 D1E8                    	shr	eax, 1
  3534 000018AA 7505                    	jnz	short lff22m2_8
  3535 000018AC E9E9F4FFFF              	jmp	lff22_eof
  3536                                  
  3537                                  lff22m2_8:
  3538 000018B1 89C1                    	mov	ecx, eax	; word count
  3539                                  lff22m2_9:
  3540 000018B3 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3541 000018B8 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3542                                  lff22m2_1:
  3543                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3544 000018BF 66AD                    	lodsw
  3545 000018C1 31D2                    	xor	edx, edx
  3546 000018C3 49                      	dec	ecx
  3547 000018C4 7403                    	jz	short lff22m2_2_1
  3548 000018C6 668B16                  	mov	dx, [esi]
  3549                                  lff22m2_2_1:	
  3550                                  	; ax = [previous_val]
  3551                                  	; dx = [next_val]
  3552 000018C9 E8AF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3553 000018CE E32F                    	jecxz	lff22m2_3
  3554                                  lff22m2_2_2:
  3555 000018D0 66AD                    	lodsw
  3556 000018D2 31D2                    	xor	edx, edx
  3557 000018D4 49                      	dec	ecx
  3558 000018D5 7403                    	jz	short lff22m2_2_3
  3559 000018D7 668B16                  	mov	dx, [esi]
  3560                                  lff22m2_2_3:
  3561 000018DA E831060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3562 000018DF E31E                    	jecxz	lff22m2_3
  3563 000018E1 4D                      	dec	ebp
  3564 000018E2 75EC                    	jnz	short lff22m2_2_2
  3565                                  
  3566 000018E4 A0[F7220000]            	mov	al, [faz]
  3567 000018E9 FEC8                    	dec	al
  3568 000018EB 74C6                    	jz	short lff22m2_9
  3569 000018ED FE0D[F7220000]          	dec	byte [faz]
  3570 000018F3 BD04000000              	mov	ebp, 4
  3571 000018F8 FEC8                    	dec	al
  3572 000018FA 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3573 000018FC 45                      	inc	ebp ; 5
  3574 000018FD EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3575                                  
  3576                                  lff22m2_3:
  3577                                  lff22s2_3:
  3578 000018FF E97EF4FFFF              	jmp	lff22_3	; padfill
  3579                                  		; (put zeros in the remain words of the buffer)
  3580                                  lff22m2_7:
  3581                                  lff22s2_7:
  3582 00001904 E99AF4FFFF              	jmp	lff22_5  ; error
  3583                                  
  3584                                  load_22khz_stereo_16_bit:
  3585                                  	; 16/11/2023
  3586 00001909 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3587                                  					; last of the file?
  3588 00001910 7402                    	jz	short lff22s2_0		; no
  3589 00001912 F9                      	stc
  3590 00001913 C3                      	retn
  3591                                  
  3592                                  lff22s2_0:
  3593                                  	; 01/12/2024
  3594                                  	; edi = audio buffer address
  3595 00001914 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3596                                          ;mov	edx, [loadsize]
  3597                                  
  3598                                  	; esi = buffer address
  3599                                  	;; edx = buffer size
  3600                                  
  3601                                  	; load file into memory
  3602                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001919 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 0000191F 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001921 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001927 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 0000192C CD40                <1>  int 40h
  3603 0000192E 72D4                    	jc	short lff22s2_7 ; error !
  3604                                  
  3605                                  	; 01/12/2024
  3606 00001930 A3[907F0000]            	mov	[count], eax
  3607                                  	;;;
  3608                                  	; 07/12/2024
  3609                                  	;mov	edi, audio_buffer
  3610                                  	;;;
  3611 00001935 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3612 00001938 7505                    	jnz	short lff22s2_8
  3613 0000193A E95BF4FFFF              	jmp	lff22_eof
  3614                                  
  3615                                  lff22s2_8:
  3616 0000193F 89C1                    	mov	ecx, eax	; dword count
  3617                                  lff22s2_9:
  3618 00001941 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3619 00001946 C605[F7220000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3620                                  lff22s2_1:
  3621                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3622 0000194D 66AD                    	lodsw
  3623 0000194F 89C3                    	mov	ebx, eax
  3624 00001951 66AD                    	lodsw
  3625 00001953 8B16                    	mov	edx, [esi]
  3626 00001955 668915[F3220000]        	mov	[next_val_l], dx
  3627                                  	; 26/11/2023
  3628 0000195C C1EA10                  	shr	edx, 16
  3629 0000195F 49                      	dec	ecx
  3630 00001960 7509                    	jnz	short lff22s2_2_1
  3631 00001962 31D2                    	xor	edx, edx ; 0
  3632 00001964 668915[F3220000]        	mov	[next_val_l], dx
  3633                                  lff22s2_2_1:
  3634                                  	; bx = [previous_val_l]
  3635                                  	; ax = [previous_val_r]
  3636                                  	; [next_val_l]
  3637                                  	; dx = [next_val_r]
  3638 0000196B E83D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3639 00001970 E38D                    	jecxz	lff22s2_3
  3640                                  lff22s2_2_2:
  3641 00001972 66AD                    	lodsw
  3642 00001974 89C3                    	mov	ebx, eax
  3643 00001976 66AD                    	lodsw
  3644 00001978 8B16                    	mov	edx, [esi]
  3645 0000197A 668915[F3220000]        	mov	[next_val_l], dx
  3646                                  	; 26/11/2023
  3647 00001981 C1EA10                  	shr	edx, 16
  3648 00001984 49                      	dec	ecx
  3649 00001985 7509                    	jnz	short lff22s2_2_3
  3650 00001987 31D2                    	xor	edx, edx ; 0
  3651 00001989 668915[F3220000]        	mov	[next_val_l], dx
  3652                                  lff22s2_2_3:
  3653 00001990 E893050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3654 00001995 E31E                    	jecxz	lff22s2_2_4
  3655                                  
  3656 00001997 4D                      	dec	ebp
  3657 00001998 75D8                    	jnz	short lff22s2_2_2
  3658                                  
  3659 0000199A A0[F7220000]            	mov	al, [faz]
  3660 0000199F FEC8                    	dec	al
  3661 000019A1 749E                    	jz	short lff22s2_9
  3662 000019A3 FE0D[F7220000]          	dec	byte [faz]
  3663 000019A9 BD04000000              	mov	ebp, 4
  3664 000019AE FEC8                    	dec	al
  3665 000019B0 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3666 000019B2 45                      	inc	ebp ; 5
  3667 000019B3 EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3668                                  
  3669                                  lff22s2_2_4:
  3670                                  	; 26/11/2023
  3671 000019B5 E9C8F3FFFF              	jmp	lff22_3	; padfill
  3672                                  
  3673                                  ; .....................
  3674                                  
  3675                                  load_11khz_mono_8_bit:
  3676                                  	; 18/11/2023
  3677 000019BA F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3678                                  					; last of the file?
  3679 000019C1 7402                    	jz	short lff11m_0		; no
  3680 000019C3 F9                      	stc
  3681 000019C4 C3                      	retn
  3682                                  
  3683                                  lff11m_0:
  3684                                  	; 01/12/2024
  3685                                  	; edi = audio buffer address
  3686 000019C5 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3687                                          ;mov	edx, [loadsize]
  3688                                  
  3689                                  	; esi = buffer address
  3690                                  	;; edx = buffer size
  3691                                  
  3692                                  	; load file into memory
  3693                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000019CA 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000019D0 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000019D2 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000019D8 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 000019DD CD40                <1>  int 40h
  3694 000019DF 7247                    	jc	short lff11m_7 ; error !
  3695                                  
  3696                                  	; 01/12/2024
  3697 000019E1 A3[907F0000]            	mov	[count], eax
  3698                                  	;;;
  3699                                  	; 07/12/2024
  3700                                  	;mov	edi, audio_buffer
  3701                                  	;;;
  3702 000019E6 21C0                    	and	eax, eax
  3703 000019E8 7505                    	jnz	short lff11m_8
  3704 000019EA E9ABF3FFFF              	jmp	lff11_eof
  3705                                  
  3706                                  lff11m_8:
  3707 000019EF 89C1                    	mov	ecx, eax		; byte count
  3708                                  lff11m_9:
  3709 000019F1 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3710                                  lff11m_1:
  3711                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3712 000019F6 AC                      	lodsb
  3713 000019F7 B280                    	mov	dl, 80h
  3714 000019F9 49                      	dec	ecx
  3715 000019FA 7402                    	jz	short lff11m_2_1
  3716 000019FC 8A16                    	mov	dl, [esi]
  3717                                  lff11m_2_1:	
  3718                                  	; al = [previous_val]
  3719                                  	; dl = [next_val]
  3720 000019FE E854050000              	call	interpolating_5_8bit_mono
  3721 00001A03 E328                    	jecxz	lff11m_3
  3722                                  lff11m_2_2:
  3723 00001A05 AC                      	lodsb
  3724 00001A06 B280                    	mov	dl, 80h
  3725 00001A08 49                      	dec	ecx
  3726 00001A09 7402                    	jz	short lff11m_2_3
  3727 00001A0B 8A16                    	mov	dl, [esi]
  3728                                  lff11m_2_3:
  3729 00001A0D E851060000               	call	interpolating_4_8bit_mono
  3730 00001A12 E319                    	jecxz	lff11m_3
  3731                                  
  3732 00001A14 4D                      	dec	ebp
  3733 00001A15 74DA                    	jz	short lff11m_9
  3734                                  
  3735 00001A17 AC                      	lodsb
  3736 00001A18 B280                    	mov	dl, 80h
  3737 00001A1A 49                      	dec	ecx
  3738 00001A1B 7402                    	jz	short lff11m_2_4
  3739 00001A1D 8A16                    	mov	dl, [esi]
  3740                                  lff11m_2_4:
  3741 00001A1F E83F060000              	call	interpolating_4_8bit_mono
  3742 00001A24 E307                    	jecxz	lff11m_3
  3743 00001A26 EBCE                    	jmp	short lff11m_1
  3744                                  
  3745                                  lff11m_7:
  3746                                  lff11s_7:
  3747 00001A28 E976F3FFFF              	jmp	lff11_5  ; error
  3748                                  
  3749                                  lff11m_3:
  3750                                  lff11s_3:
  3751 00001A2D E950F3FFFF              	jmp	lff11_3	; padfill
  3752                                  		; (put zeros in the remain words of the buffer)
  3753                                  
  3754                                  load_11khz_stereo_8_bit:
  3755                                  	; 18/11/2023
  3756 00001A32 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3757                                  					; last of the file?
  3758 00001A39 7402                    	jz	short lff11s_0		; no
  3759 00001A3B F9                      	stc
  3760 00001A3C C3                      	retn
  3761                                  
  3762                                  lff11s_0:
  3763                                  	; 01/12/2024
  3764                                  	; edi = audio buffer address
  3765 00001A3D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3766                                          ;mov	edx, [loadsize]
  3767                                  
  3768                                  	; esi = buffer address
  3769                                  	;; edx = buffer size
  3770                                  
  3771                                  	; load file into memory
  3772                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001A42 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001A48 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001A4A 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001A50 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001A55 CD40                <1>  int 40h
  3773 00001A57 72CF                    	jc	short lff11s_7 ; error !
  3774                                  
  3775                                  	; 01/12/2024
  3776 00001A59 A3[907F0000]            	mov	[count], eax
  3777                                  	;;;
  3778                                  	; 07/12/2024
  3779                                  	;mov	edi, audio_buffer
  3780                                  	;;;
  3781 00001A5E D1E8                    	shr	eax, 1
  3782 00001A60 7505                    	jnz	short lff11s_8
  3783 00001A62 E933F3FFFF              	jmp	lff11_eof
  3784                                  
  3785                                  lff11s_8:
  3786 00001A67 89C1                    	mov	ecx, eax	; word count
  3787                                  lff11s_9:
  3788 00001A69 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3789                                  lff11s_1:
  3790                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3791 00001A6E 66AD                    	lodsw
  3792 00001A70 66BA8080                	mov	dx, 8080h
  3793 00001A74 49                      	dec	ecx
  3794 00001A75 7403                    	jz	short lff11s_2_1
  3795 00001A77 668B16                  	mov	dx, [esi]
  3796                                  lff11s_2_1:	
  3797                                  	; al = [previous_val_l]
  3798                                  	; ah = [previous_val_r]
  3799                                  	; dl = [next_val_l]
  3800                                  	; dh = [next_val_r]
  3801 00001A7A E837050000              	call	interpolating_5_8bit_stereo
  3802 00001A7F E3AC                    	jecxz	lff11s_3
  3803                                  lff11s_2_2:
  3804 00001A81 66AD                    	lodsw
  3805 00001A83 66BA8080                	mov	dx, 8080h
  3806 00001A87 49                      	dec	ecx
  3807 00001A88 7403                    	jz	short lff11s_2_3
  3808 00001A8A 668B16                  	mov	dx, [esi]
  3809                                  lff11s_2_3:
  3810 00001A8D E810060000               	call	interpolating_4_8bit_stereo
  3811 00001A92 E399                    	jecxz	lff11s_3
  3812                                  	
  3813 00001A94 4D                      	dec	ebp
  3814 00001A95 74D2                    	jz	short lff11s_9
  3815                                  
  3816 00001A97 66AD                    	lodsw
  3817 00001A99 66BA8080                	mov	dx, 8080h
  3818 00001A9D 49                      	dec	ecx
  3819 00001A9E 7403                    	jz	short lff11s_2_4
  3820 00001AA0 668B16                  	mov	dx, [esi]
  3821                                  lff11s_2_4:
  3822 00001AA3 E8FA050000              	call	interpolating_4_8bit_stereo
  3823 00001AA8 E383                    	jecxz	lff11s_3
  3824 00001AAA EBC2                    	jmp	short lff11s_1
  3825                                  
  3826                                  load_11khz_mono_16_bit:
  3827                                  	; 18/11/2023
  3828 00001AAC F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3829                                  					; last of the file?
  3830 00001AB3 7402                    	jz	short lff11m2_0		; no
  3831 00001AB5 F9                      	stc
  3832 00001AB6 C3                      	retn
  3833                                  
  3834                                  lff11m2_0:
  3835                                  	; 01/12/2024
  3836                                  	; edi = audio buffer address
  3837 00001AB7 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3838                                          ;mov	edx, [loadsize]
  3839                                  
  3840                                  	; esi = buffer address
  3841                                  	;; edx = buffer size
  3842                                  
  3843                                  	; load file into memory
  3844                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001ABC 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001AC2 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001AC4 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001ACA B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001ACF CD40                <1>  int 40h
  3845 00001AD1 724D                    	jc	short lff11m2_7 ; error !
  3846                                  
  3847                                  	; 01/12/2024
  3848 00001AD3 A3[907F0000]            	mov	[count], eax
  3849                                  	;;;
  3850                                  	; 07/12/2024
  3851                                  	;mov	edi, audio_buffer
  3852                                  	;;;
  3853 00001AD8 D1E8                    	shr	eax, 1
  3854 00001ADA 7505                    	jnz	short lff11m2_8
  3855 00001ADC E9B9F2FFFF              	jmp	lff11_eof
  3856                                  
  3857                                  lff11m2_8:
  3858 00001AE1 89C1                    	mov	ecx, eax	; word count
  3859                                  lff11m2_9:
  3860 00001AE3 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3861                                  lff11m2_1:
  3862                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3863 00001AE8 66AD                    	lodsw
  3864 00001AEA 31D2                    	xor	edx, edx
  3865 00001AEC 49                      	dec	ecx
  3866 00001AED 7403                    	jz	short lff11m2_2_1
  3867 00001AEF 668B16                  	mov	dx, [esi]
  3868                                  lff11m2_2_1:	
  3869                                  	; ax = [previous_val]
  3870                                  	; dx = [next_val]
  3871 00001AF2 E818060000              	call	interpolating_5_16bit_mono
  3872 00001AF7 E362                    	jecxz	lff11m2_3
  3873                                  lff11m2_2_2:
  3874 00001AF9 66AD                    	lodsw
  3875 00001AFB 31D2                    	xor	edx, edx
  3876 00001AFD 49                      	dec	ecx
  3877 00001AFE 7403                    	jz	short lff11m2_2_3
  3878 00001B00 668B16                  	mov	dx, [esi]
  3879                                  lff11m2_2_3:
  3880 00001B03 E831070000               	call	interpolating_4_16bit_mono
  3881 00001B08 E351                    	jecxz	lff11m2_3
  3882                                  
  3883 00001B0A 4D                      	dec	ebp
  3884 00001B0B 74D6                    	jz	short lff11m2_9
  3885                                  
  3886 00001B0D 66AD                    	lodsw
  3887 00001B0F 31D2                    	xor	edx, edx
  3888 00001B11 49                      	dec	ecx
  3889 00001B12 7403                    	jz	short lff11m2_2_4
  3890 00001B14 668B16                  	mov	dx, [esi]
  3891                                  lff11m2_2_4:
  3892 00001B17 E81D070000               	call	interpolating_4_16bit_mono
  3893 00001B1C E33D                    	jecxz	lff11m2_3
  3894 00001B1E EBC8                    	jmp	short lff11m2_1
  3895                                  
  3896                                  lff11m2_7:
  3897                                  lff11s2_7:
  3898 00001B20 E97EF2FFFF              	jmp	lff11_5  ; error
  3899                                  
  3900                                  load_11khz_stereo_16_bit:
  3901                                  	; 18/01/2025
  3902                                  	; 18/11/2023
  3903 00001B25 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3904                                  					; last of the file?
  3905 00001B2C 7402                    	jz	short lff11s2_0		; no
  3906 00001B2E F9                      	stc
  3907 00001B2F C3                      	retn
  3908                                  
  3909                                  lff11s2_0:
  3910                                  	; 01/12/2024
  3911                                  	; edi = audio buffer address
  3912 00001B30 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3913                                          ;mov	edx, [loadsize]
  3914                                  
  3915                                  	; esi = buffer address
  3916                                  	;; edx = buffer size
  3917                                  
  3918                                  	; load file into memory
  3919                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001B35 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001B3B 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001B3D 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001B43 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001B48 CD40                <1>  int 40h
  3920 00001B4A 72D4                    	jc	short lff11s2_7 ; error !
  3921                                  
  3922                                  	; 01/12/2024
  3923 00001B4C A3[907F0000]            	mov	[count], eax
  3924                                  	;;;
  3925                                  	; 07/12/2024
  3926                                  	;mov	edi, audio_buffer
  3927                                  	;;;
  3928 00001B51 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3929 00001B54 750A                    	jnz	short lff11s2_8
  3930 00001B56 E93FF2FFFF              	jmp	lff11_eof
  3931                                  
  3932                                  lff11m2_3:
  3933                                  lff11s2_3:
  3934 00001B5B E922F2FFFF              	jmp	lff11_3	; padfill
  3935                                  		; (put zeros in the remain words of the buffer)
  3936                                  
  3937                                  lff11s2_8:
  3938 00001B60 89C1                    	mov	ecx, eax	; dword count
  3939                                  lff11s2_9:
  3940 00001B62 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3941                                  lff11s2_1:
  3942                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3943 00001B67 66AD                    	lodsw
  3944 00001B69 89C3                    	mov	ebx, eax
  3945 00001B6B 66AD                    	lodsw
  3946 00001B6D 8B16                    	mov	edx, [esi]
  3947                                  	; 18/01/2025
  3948                                  	;mov	[next_val_l], edx
  3949                                  	; 26/11/2023
  3950                                  	;shr	edx, 16
  3951                                  	;mov	[next_val_r], dx
  3952 00001B6F 49                      	dec	ecx
  3953 00001B70 7502                    	jnz	short lff11s2_2_1
  3954 00001B72 31D2                    	xor	edx, edx ; 0
  3955                                  	;mov	[next_val_l], dx
  3956                                  	;mov	[next_val_r], dx
  3957                                  lff11s2_2_1:
  3958                                  	; bx = [previous_val_l]
  3959                                  	; ax = [previous_val_r]
  3960                                  	; [next_val_l]
  3961                                  	; dx = [next_val_r]
  3962                                  	;;;
  3963                                  	; 18/01/2025 (BugFix)
  3964 00001B74 8915[F3220000]          	mov	[next_val_l], edx
  3965                                  	;;;
  3966 00001B7A E8EB050000              	call	interpolating_5_16bit_stereo
  3967 00001B7F E3DA                    	jecxz	lff11s2_3
  3968                                  lff11s2_2_2:
  3969 00001B81 66AD                    	lodsw
  3970 00001B83 89C3                    	mov	ebx, eax
  3971 00001B85 66AD                    	lodsw
  3972 00001B87 8B16                    	mov	edx, [esi]
  3973                                  	; 18/01/2025
  3974                                  	;mov	[next_val_l], dx
  3975                                  	; 26/11/2023
  3976                                  	;shr	edx, 16
  3977                                  	;mov	[next_val_r], dx
  3978 00001B89 49                      	dec	ecx
  3979 00001B8A 7502                    	jnz	short lff11s2_2_3
  3980 00001B8C 31D2                    	xor	edx, edx ; 0
  3981                                  	;mov	[next_val_l], dx
  3982                                  	;mov	[next_val_r], dx
  3983                                  lff11s2_2_3:
  3984                                  	;;;
  3985                                  	; 18/01/2025 (BugFix)
  3986 00001B8E 8915[F3220000]          	mov	[next_val_l], edx
  3987                                  	;;;
  3988 00001B94 E8D9060000              	call	interpolating_4_16bit_stereo
  3989 00001B99 E3C0                    	jecxz	lff11s2_3
  3990                                  	
  3991 00001B9B 4D                      	dec	ebp
  3992 00001B9C 74C4                    	jz	short lff11s2_9
  3993                                  
  3994 00001B9E 66AD                    	lodsw
  3995 00001BA0 89C3                    	mov	ebx, eax
  3996 00001BA2 66AD                    	lodsw
  3997 00001BA4 8B16                    	mov	edx, [esi]
  3998                                  	; 18/01/2025
  3999                                  	;mov	[next_val_l], dx
  4000                                  	; 26/11/2023
  4001                                  	;shr	edx, 16
  4002                                  	;mov	[next_val_r], dx
  4003 00001BA6 49                      	dec	ecx
  4004 00001BA7 7502                    	jnz	short lff11s2_2_4
  4005 00001BA9 31D2                    	xor	edx, edx ; 0
  4006                                  	;mov	[next_val_l], dx
  4007                                  	;mov	[next_val_r], dx
  4008                                  lff11s2_2_4:
  4009                                  	;;;
  4010                                  	; 18/01/2025 (BugFix)
  4011 00001BAB 8915[F3220000]          	mov	[next_val_l], edx
  4012                                  	;;;
  4013 00001BB1 E8BC060000               	call	interpolating_4_16bit_stereo
  4014 00001BB6 E3A3                    	jecxz	lff11s2_3
  4015 00001BB8 EBAD                    	jmp	short lff11s2_1
  4016                                  
  4017                                  ; .....................
  4018                                  
  4019                                  load_44khz_mono_8_bit:
  4020                                  	; 18/11/2023
  4021 00001BBA F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4022                                  					; last of the file?
  4023 00001BC1 7402                    	jz	short lff44m_0		; no
  4024 00001BC3 F9                      	stc
  4025 00001BC4 C3                      	retn
  4026                                  
  4027                                  lff44m_0:
  4028                                  	; 01/12/2024
  4029                                  	; edi = audio buffer address
  4030 00001BC5 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4031                                          ;mov	edx, [loadsize]
  4032                                  
  4033                                  	; esi = buffer address
  4034                                  	;; edx = buffer size
  4035                                  
  4036                                  	; load file into memory
  4037                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001BCA 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001BD0 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001BD2 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001BD8 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001BDD CD40                <1>  int 40h
  4038 00001BDF 7250                    	jc	short lff44m_7 ; error !
  4039                                  
  4040                                  	; 01/12/2024
  4041 00001BE1 A3[907F0000]            	mov	[count], eax
  4042                                  	;;;
  4043                                  	; 07/12/2024
  4044                                  	;mov	edi, audio_buffer
  4045                                  	;;;
  4046 00001BE6 21C0                    	and	eax, eax
  4047 00001BE8 7505                    	jnz	short lff44m_8
  4048 00001BEA E9ABF1FFFF              	jmp	lff44_eof
  4049                                  
  4050                                  lff44m_8:
  4051 00001BEF 89C1                    	mov	ecx, eax	; byte count
  4052                                  lff44m_9:
  4053 00001BF1 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4054 00001BF6 C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phases
  4055                                  lff44m_1:
  4056                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4057                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4058 00001BFD AC                      	lodsb
  4059 00001BFE B280                    	mov	dl, 80h
  4060 00001C00 49                      	dec	ecx
  4061 00001C01 7402                    	jz	short lff44m_2_1
  4062 00001C03 8A16                    	mov	dl, [esi]
  4063                                  lff44m_2_1:	
  4064                                  	; al = [previous_val]
  4065                                  	; dl = [next_val]
  4066 00001C05 E825020000              	call	interpolating_2_8bit_mono
  4067 00001C0A E320                    	jecxz	lff44m_3
  4068                                  lff44m_2_2:
  4069 00001C0C AC                      	lodsb
  4070 00001C0D 2C80                    	sub	al, 80h
  4071 00001C0F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4072 00001C13 66AB                    	stosw		; (L)
  4073 00001C15 66AB                    	stosw		; (R)
  4074                                  
  4075 00001C17 49                      	dec	ecx
  4076 00001C18 7412                    	jz	short lff44m_3
  4077 00001C1A 4D                      	dec	ebp
  4078 00001C1B 75EF                    	jnz	short lff44m_2_2
  4079                                  	
  4080 00001C1D FE0D[F7220000]          	dec	byte [faz]
  4081 00001C23 74CC                    	jz	short lff44m_9 
  4082 00001C25 BD0B000000              	mov	ebp, 11
  4083 00001C2A EBD1                    	jmp	short lff44m_1
  4084                                  
  4085                                  lff44m_3:
  4086                                  lff44s_3:
  4087 00001C2C E951F1FFFF              	jmp	lff44_3	; padfill
  4088                                  		; (put zeros in the remain words of the buffer)
  4089                                  lff44m_7:
  4090                                  lff44s_7:
  4091 00001C31 E96DF1FFFF              	jmp	lff44_5  ; error
  4092                                  
  4093                                  load_44khz_stereo_8_bit:
  4094                                  	; 16/11/2023
  4095 00001C36 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4096                                  					; last of the file?
  4097 00001C3D 7402                    	jz	short lff44s_0		; no
  4098 00001C3F F9                      	stc
  4099 00001C40 C3                      	retn
  4100                                  
  4101                                  lff44s_0:
  4102                                  	; 01/12/2024
  4103                                  	; edi = audio buffer address
  4104 00001C41 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4105                                          ;mov	edx, [loadsize]
  4106                                  
  4107                                  	; esi = buffer address
  4108                                  	;; edx = buffer size
  4109                                  
  4110                                  	; load file into memory
  4111                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001C46 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001C4C 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001C4E 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001C54 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001C59 CD40                <1>  int 40h
  4112 00001C5B 72D4                    	jc	short lff44s_7 ; error !
  4113                                  
  4114                                  	; 01/12/2024
  4115 00001C5D A3[907F0000]            	mov	[count], eax
  4116                                  	;;;
  4117                                  	; 07/12/2024
  4118                                  	;mov	edi, audio_buffer
  4119                                  	;;;
  4120 00001C62 D1E8                    	shr	eax, 1
  4121 00001C64 7505                    	jnz	short lff44s_8
  4122 00001C66 E92FF1FFFF              	jmp	lff44_eof
  4123                                  
  4124                                  lff44s_8:
  4125 00001C6B 89C1                    	mov	ecx, eax	; word count
  4126                                  lff44s_9:
  4127 00001C6D BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4128 00001C72 C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4129                                  lff44s_1:
  4130                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4131                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4132 00001C79 66AD                    	lodsw
  4133 00001C7B 66BA8080                	mov	dx, 8080h
  4134 00001C7F 49                      	dec	ecx
  4135 00001C80 7403                    	jz	short lff44s_2_1
  4136 00001C82 668B16                  	mov	dx, [esi]
  4137                                  lff44s_2_1:	
  4138                                  	; al = [previous_val_l]
  4139                                  	; ah = [previous_val_r]
  4140                                  	; dl = [next_val_l]
  4141                                  	; dh = [next_val_r]
  4142 00001C85 E8C2010000              	call	interpolating_2_8bit_stereo
  4143 00001C8A E3A0                    	jecxz	lff44s_3
  4144                                  lff44s_2_2:
  4145 00001C8C AC                      	lodsb
  4146 00001C8D 2C80                    	sub	al, 80h
  4147 00001C8F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4148 00001C93 66AB                    	stosw		; (L)
  4149 00001C95 AC                      	lodsb
  4150 00001C96 2C80                    	sub	al, 80h
  4151 00001C98 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4152 00001C9C 66AB                    	stosw		; (R)
  4153                                  
  4154 00001C9E 49                      	dec	ecx
  4155 00001C9F 748B                    	jz	short lff44s_3	
  4156 00001CA1 4D                      	dec	ebp
  4157 00001CA2 75E8                    	jnz	short lff44s_2_2
  4158                                  	
  4159 00001CA4 FE0D[F7220000]          	dec	byte [faz]
  4160 00001CAA 74C1                    	jz	short lff44s_9 
  4161 00001CAC BD0B000000              	mov	ebp, 11
  4162 00001CB1 EBC6                    	jmp	short lff44s_1
  4163                                  
  4164                                  load_44khz_mono_16_bit:
  4165                                  	; 18/11/2023
  4166 00001CB3 F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4167                                  					; last of the file?
  4168 00001CBA 7402                    	jz	short lff44m2_0		; no
  4169 00001CBC F9                      	stc
  4170 00001CBD C3                      	retn
  4171                                  
  4172                                  lff44m2_0:
  4173                                  	; 01/12/2024
  4174                                  	; edi = audio buffer address
  4175 00001CBE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4176                                          ;mov	edx, [loadsize]
  4177                                  
  4178                                  	; esi = buffer address
  4179                                  	;; edx = buffer size
  4180                                  
  4181                                  	; load file into memory
  4182                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001CC3 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001CC9 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001CCB 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001CD1 B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001CD6 CD40                <1>  int 40h
  4183 00001CD8 724D                    	jc	short lff44m2_7 ; error !
  4184                                  
  4185                                  	; 01/12/2024
  4186 00001CDA A3[907F0000]            	mov	[count], eax
  4187                                  	;;;
  4188                                  	; 07/12/2024
  4189                                  	;mov	edi, audio_buffer
  4190                                  	;;;
  4191 00001CDF D1E8                    	shr	eax, 1
  4192 00001CE1 7505                    	jnz	short lff44m2_8
  4193 00001CE3 E9B2F0FFFF              	jmp	lff44_eof
  4194                                  
  4195                                  lff44m2_8:
  4196 00001CE8 89C1                    	mov	ecx, eax	; word count
  4197                                  lff44m2_9:
  4198 00001CEA BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4199 00001CEF C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phases
  4200                                  lff44m2_1:
  4201                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4202                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4203 00001CF6 66AD                    	lodsw
  4204 00001CF8 31D2                    	xor	edx, edx
  4205 00001CFA 49                      	dec	ecx
  4206 00001CFB 7403                    	jz	short lff44m2_2_1
  4207 00001CFD 668B16                  	mov	dx, [esi]
  4208                                  lff44m2_2_1:	
  4209                                  	; ax = [previous_val]
  4210                                  	; dx = [next_val]
  4211 00001D00 E80B020000              	call	interpolating_2_16bit_mono
  4212 00001D05 E31B                    	jecxz	lff44m2_3
  4213                                  lff44m2_2_2:
  4214 00001D07 66AD                    	lodsw
  4215 00001D09 66AB                    	stosw		; (L)eft Channel
  4216 00001D0B 66AB                    	stosw		; (R)ight Channel
  4217                                  
  4218 00001D0D 49                      	dec	ecx
  4219 00001D0E 7412                    	jz	short lff44m2_3	
  4220 00001D10 4D                      	dec	ebp
  4221 00001D11 75F4                    	jnz	short lff44m2_2_2
  4222                                  	
  4223 00001D13 FE0D[F7220000]          	dec	byte [faz]
  4224 00001D19 74CF                    	jz	short lff44m2_9 
  4225 00001D1B BD0B000000              	mov	ebp, 11
  4226 00001D20 EBD4                    	jmp	short lff44m2_1
  4227                                  
  4228                                  lff44m2_3:
  4229                                  lff44s2_3:
  4230 00001D22 E95BF0FFFF              	jmp	lff44_3	; padfill
  4231                                  		; (put zeros in the remain words of the buffer)
  4232                                  lff44m2_7:
  4233                                  lff44s2_7:
  4234 00001D27 E977F0FFFF              	jmp	lff44_5  ; error
  4235                                  
  4236                                  load_44khz_stereo_16_bit:
  4237                                  	; 18/11/2023
  4238 00001D2C F605[0A7F0000]01                test    byte [flags], ENDOFFILE	; have we already read the
  4239                                  					; last of the file?
  4240 00001D33 7402                    	jz	short lff44s2_0		; no
  4241 00001D35 F9                      	stc
  4242 00001D36 C3                      	retn
  4243                                  
  4244                                  lff44s2_0:
  4245                                  	; 01/12/2024
  4246                                  	; edi = audio buffer address
  4247 00001D37 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4248                                          ;mov	edx, [loadsize]
  4249                                  
  4250                                  	; esi = buffer address
  4251                                  	;; edx = buffer size
  4252                                  
  4253                                  	; load file into memory
  4254                                  	sys 	_read, [filehandle], esi, [loadsize]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00001D3C 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00001D42 89F1                <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 00001D44 8B15[807F0000]      <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00001D4A B803000000          <1>  mov eax, %1
   100                              <1> 
   101 00001D4F CD40                <1>  int 40h
  4255 00001D51 72D4                    	jc	short lff44s2_7 ; error !
  4256                                  
  4257                                  	; 01/12/2024
  4258 00001D53 A3[907F0000]            	mov	[count], eax
  4259                                  	;;;
  4260                                  	; 07/12/2024
  4261                                  	;mov	edi, audio_buffer
  4262                                  	;;;
  4263 00001D58 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4264 00001D5B 7505                    	jnz	short lff44s2_8
  4265 00001D5D E938F0FFFF              	jmp	lff44_eof
  4266                                  
  4267                                  lff44s2_8:
  4268 00001D62 89C1                    	mov	ecx, eax	; dword count
  4269                                  lff44s2_9:
  4270 00001D64 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4271 00001D69 C605[F7220000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4272                                  lff44s2_1:
  4273                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4274                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4275 00001D70 66AD                    	lodsw
  4276 00001D72 89C3                    	mov	ebx, eax
  4277 00001D74 66AD                    	lodsw
  4278                                  	;mov	dx, [esi]
  4279                                  	;mov	[next_val_l], dx
  4280                                  	;mov	dx, [esi+2]
  4281                                  	; 26/11/2023
  4282 00001D76 8B16                    	mov	edx, [esi]
  4283 00001D78 668915[F3220000]        	mov	[next_val_l], dx
  4284 00001D7F C1EA10                  	shr	edx, 16
  4285 00001D82 49                      	dec	ecx
  4286 00001D83 7509                    	jnz	short lff44s2_2_1
  4287 00001D85 31D2                    	xor	edx, edx ; 0
  4288 00001D87 668915[F3220000]        	mov	[next_val_l], dx
  4289                                  lff44s2_2_1:
  4290                                  	; bx = [previous_val_l]
  4291                                  	; ax = [previous_val_r]
  4292                                  	; [next_val_l]
  4293                                  	; dx = [next_val_r]
  4294 00001D8E E895010000              	call	interpolating_2_16bit_stereo
  4295 00001D93 E38D                    	jecxz	lff44s2_3
  4296                                  lff44s2_2_2:
  4297                                  	;movsw		; (L)eft Channel
  4298                                  	;movsw		; (R)ight Channel
  4299 00001D95 A5                      	movsd
  4300                                  
  4301 00001D96 49                      	dec	ecx
  4302 00001D97 7489                    	jz	short lff44s2_3	
  4303 00001D99 4D                      	dec	ebp
  4304 00001D9A 75F9                    	jnz	short lff44s2_2_2
  4305                                  	
  4306 00001D9C FE0D[F7220000]          	dec	byte [faz]
  4307 00001DA2 74C0                    	jz	short lff44s2_9 
  4308 00001DA4 BD0B000000              	mov	ebp, 11
  4309 00001DA9 EBC5                    	jmp	short lff44s2_1
  4310                                  
  4311                                  ; .....................
  4312                                  
  4313                                  interpolating_3_8bit_mono:
  4314                                  	; 16/11/2023
  4315                                  	; al = [previous_val]
  4316                                  	; dl = [next_val]
  4317                                  	; original-interpolated-interpolated
  4318 00001DAB 88C3                    	mov	bl, al
  4319 00001DAD 2C80                    	sub	al, 80h
  4320 00001DAF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4321 00001DB3 66AB                    	stosw		; original sample (L)
  4322 00001DB5 66AB                    	stosw		; original sample (R)
  4323 00001DB7 88D8                    	mov	al, bl
  4324 00001DB9 00D0                    	add	al, dl
  4325 00001DBB D0D8                    	rcr	al, 1
  4326 00001DBD 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4327 00001DBF 00D8                    	add	al, bl
  4328 00001DC1 D0D8                    	rcr	al, 1
  4329 00001DC3 2C80                    	sub	al, 80h
  4330 00001DC5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4331 00001DC9 66AB                    	stosw		; interpolated sample 1 (L)
  4332 00001DCB 66AB                    	stosw		; interpolated sample 1 (R)
  4333 00001DCD 88F8                    	mov	al, bh
  4334 00001DCF 00D0                    	add	al, dl	; [next_val]
  4335 00001DD1 D0D8                    	rcr	al, 1
  4336 00001DD3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4337 00001DD7 66AB                    	stosw		; interpolated sample 2 (L)
  4338 00001DD9 66AB                    	stosw		; interpolated sample 2 (R)
  4339 00001DDB C3                      	retn
  4340                                  
  4341                                  interpolating_3_8bit_stereo:
  4342                                  	; 16/11/2023
  4343                                  	; al = [previous_val_l]
  4344                                  	; ah = [previous_val_r]
  4345                                  	; dl = [next_val_l]
  4346                                  	; dh = [next_val_r]
  4347                                  	; original-interpolated-interpolated
  4348 00001DDC 89C3                    	mov	ebx, eax
  4349 00001DDE 2C80                    	sub	al, 80h
  4350 00001DE0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4351 00001DE4 66AB                    	stosw		; original sample (L)
  4352 00001DE6 88F8                    	mov	al, bh
  4353 00001DE8 2C80                    	sub	al, 80h
  4354 00001DEA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4355 00001DEE 66AB                    	stosw		; original sample (R)
  4356 00001DF0 88D8                    	mov	al, bl
  4357 00001DF2 00D0                    	add	al, dl	; [next_val_l]
  4358 00001DF4 D0D8                    	rcr	al, 1
  4359 00001DF6 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4360 00001DF7 00D8                    	add	al, bl	; [previous_val_l]
  4361 00001DF9 D0D8                    	rcr	al, 1
  4362 00001DFB 2C80                    	sub	al, 80h
  4363 00001DFD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4364 00001E01 66AB                    	stosw		; interpolated sample 1 (L)
  4365 00001E03 88F8                    	mov	al, bh
  4366 00001E05 00F0                    	add	al, dh	; [next_val_r]
  4367 00001E07 D0D8                    	rcr	al, 1
  4368 00001E09 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4369 00001E0A 00F8                    	add	al, bh	; [previous_val_r]
  4370 00001E0C D0D8                    	rcr	al, 1
  4371 00001E0E 2C80                    	sub	al, 80h
  4372 00001E10 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4373 00001E14 66AB                    	stosw		; interpolated sample 1 (R)
  4374 00001E16 5B                      	pop	ebx ; **
  4375 00001E17 58                      	pop	eax ; *
  4376 00001E18 00D0                    	add	al, dl	; [next_val_l]
  4377 00001E1A D0D8                    	rcr	al, 1
  4378 00001E1C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4379 00001E20 66AB                    	stosw		; interpolated sample 2 (L)
  4380 00001E22 88D8                    	mov	al, bl
  4381 00001E24 00F0                    	add	al, dh	; [next_val_r]
  4382 00001E26 D0D8                    	rcr	al, 1
  4383 00001E28 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4384 00001E2C 66AB                    	stosw		; interpolated sample 2 (R)
  4385 00001E2E C3                      	retn
  4386                                  
  4387                                  interpolating_2_8bit_mono:
  4388                                  	; 16/11/2023
  4389                                  	; al = [previous_val]
  4390                                  	; dl = [next_val]
  4391                                  	; original-interpolated
  4392 00001E2F 88C3                    	mov	bl, al
  4393 00001E31 2C80                    	sub	al, 80h
  4394 00001E33 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4395 00001E37 66AB                    	stosw		; original sample (L)
  4396 00001E39 66AB                    	stosw		; original sample (R)
  4397 00001E3B 88D8                    	mov	al, bl
  4398 00001E3D 00D0                    	add	al, dl
  4399 00001E3F D0D8                    	rcr	al, 1
  4400 00001E41 2C80                    	sub	al, 80h
  4401 00001E43 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4402 00001E47 66AB                    	stosw		; interpolated sample (L)
  4403 00001E49 66AB                    	stosw		; interpolated sample (R)
  4404 00001E4B C3                      	retn
  4405                                  
  4406                                  interpolating_2_8bit_stereo:
  4407                                  	; 16/11/2023
  4408                                  	; al = [previous_val_l]
  4409                                  	; ah = [previous_val_r]
  4410                                  	; dl = [next_val_l]
  4411                                  	; dh = [next_val_r]
  4412                                  	; original-interpolated
  4413 00001E4C 89C3                    	mov	ebx, eax
  4414 00001E4E 2C80                    	sub	al, 80h
  4415 00001E50 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4416 00001E54 66AB                    	stosw		; original sample (L)
  4417 00001E56 88F8                    	mov	al, bh
  4418 00001E58 2C80                    	sub	al, 80h
  4419 00001E5A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4420 00001E5E 66AB                    	stosw		; original sample (R)
  4421 00001E60 88D8                    	mov	al, bl	; [previous_val_l]
  4422 00001E62 00D0                    	add	al, dl	; [next_val_l]
  4423 00001E64 D0D8                    	rcr	al, 1
  4424 00001E66 2C80                    	sub	al, 80h
  4425 00001E68 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4426 00001E6C 66AB                    	stosw		; interpolated sample (L)
  4427 00001E6E 88F8                    	mov	al, bh
  4428 00001E70 00F0                    	add	al, dh	; [next_val_r]
  4429 00001E72 D0D8                    	rcr	al, 1
  4430 00001E74 2C80                    	sub	al, 80h
  4431 00001E76 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4432 00001E7A 66AB                    	stosw		; interpolated sample (R)
  4433 00001E7C C3                      	retn
  4434                                  
  4435                                  interpolating_3_16bit_mono:
  4436                                  	; 16/11/2023
  4437                                  	; ax = [previous_val]
  4438                                  	; dx = [next_val]
  4439                                  	; original-interpolated-interpolated
  4440                                  
  4441 00001E7D 66AB                    	stosw		; original sample (L)
  4442 00001E7F 66AB                    	stosw		; original sample (R)
  4443 00001E81 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4444 00001E84 50                      	push	eax ; *	; [previous_val]
  4445 00001E85 80C680                  	add	dh, 80h
  4446 00001E88 6601D0                  	add	ax, dx
  4447 00001E8B 66D1D8                  	rcr	ax, 1
  4448 00001E8E 5B                      	pop	ebx ; *
  4449 00001E8F 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4450 00001E90 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4451 00001E93 66D1D8                  	rcr	ax, 1
  4452 00001E96 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4453 00001E99 66AB                    	stosw 		; interpolated sample 1 (L)
  4454 00001E9B 66AB                    	stosw		; interpolated sample 1 (R)
  4455 00001E9D 89D8                    	mov	eax, ebx
  4456 00001E9F 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4457 00001EA2 66D1D8                  	rcr	ax, 1
  4458 00001EA5 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4459 00001EA8 66AB                    	stosw		; interpolated sample 2 (L)
  4460 00001EAA 66AB                    	stosw		; interpolated sample 2 (R)
  4461 00001EAC C3                      	retn
  4462                                  
  4463                                  interpolating_3_16bit_stereo:
  4464                                  	; 16/11/2023
  4465                                  	; bx = [previous_val_l]
  4466                                  	; ax = [previous_val_r]
  4467                                  	; [next_val_l]
  4468                                  	; dx = [next_val_r]
  4469                                  	; original-interpolated-interpolated
  4470                                  
  4471 00001EAD 93                      	xchg	eax, ebx
  4472 00001EAE 66AB                    	stosw		; original sample (L)
  4473 00001EB0 93                      	xchg	eax, ebx
  4474 00001EB1 66AB                    	stosw		; original sample (R)
  4475 00001EB3 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4476 00001EB6 50                      	push	eax ; *	; [previous_val_r]
  4477 00001EB7 80C780                  	add	bh, 80h
  4478 00001EBA 8005[F4220000]80        	add	byte [next_val_l+1], 80h
  4479 00001EC1 66A1[F3220000]          	mov	ax, [next_val_l]
  4480 00001EC7 6601D8                  	add	ax, bx	; [previous_val_l]
  4481 00001ECA 66D1D8                  	rcr	ax, 1
  4482 00001ECD 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4483 00001ECE 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4484 00001ED1 66D1D8                  	rcr	ax, 1
  4485 00001ED4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4486 00001ED7 66AB                    	stosw 		; interpolated sample 1 (L)
  4487 00001ED9 58                      	pop	eax  ; *
  4488 00001EDA 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4489 00001EDD 52                      	push	edx  ; * ; [next_val_r]
  4490 00001EDE 92                      	xchg	eax, edx
  4491 00001EDF 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4492 00001EE2 66D1D8                  	rcr	ax, 1	; / 2
  4493 00001EE5 50                      	push	eax ; ** ; interpolated middle (R)
  4494 00001EE6 6601D0                  	add	ax, dx	; + [previous_val_r]
  4495 00001EE9 66D1D8                  	rcr	ax, 1
  4496 00001EEC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4497 00001EEF 66AB                    	stosw 		; interpolated sample 1 (R)
  4498 00001EF1 66A1[F3220000]          	mov	ax, [next_val_l]
  4499 00001EF7 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4500 00001EFA 66D1D8                  	rcr	ax, 1
  4501 00001EFD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4502 00001F00 66AB                    	stosw 		; interpolated sample 2 (L)
  4503 00001F02 58                      	pop	eax ; **
  4504 00001F03 5A                      	pop	edx ; *
  4505 00001F04 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4506 00001F07 66D1D8                  	rcr	ax, 1	; / 2
  4507 00001F0A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4508 00001F0D 66AB                    	stosw 		; interpolated sample 2 (L)
  4509 00001F0F C3                      	retn
  4510                                  
  4511                                  interpolating_2_16bit_mono:
  4512                                  	; 16/11/2023
  4513                                  	; ax = [previous_val]
  4514                                  	; dx = [next_val]
  4515                                  	; original-interpolated
  4516                                  
  4517 00001F10 66AB                    	stosw		; original sample (L)
  4518 00001F12 66AB                    	stosw		; original sample (R)
  4519 00001F14 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4520 00001F17 80C680                  	add	dh, 80h
  4521 00001F1A 6601D0                  	add	ax, dx
  4522 00001F1D 66D1D8                  	rcr	ax, 1
  4523 00001F20 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4524 00001F23 66AB                    	stosw		; interpolated sample (L)
  4525 00001F25 66AB                    	stosw		; interpolated sample (R)
  4526 00001F27 C3                      	retn
  4527                                  
  4528                                  interpolating_2_16bit_stereo:
  4529                                  	; 18/01/2025
  4530                                  	; 16/11/2023
  4531                                  	; bx = [previous_val_l]
  4532                                  	; ax = [previous_val_r]
  4533                                  	; [next_val_l]
  4534                                  	; dx = [next_val_r]
  4535                                  	; original-interpolated
  4536                                  
  4537 00001F28 93                      	xchg	eax, ebx
  4538 00001F29 66AB                    	stosw		; original sample (L)
  4539 00001F2B 93                      	xchg	eax, ebx
  4540 00001F2C 66AB                    	stosw		; original sample (R)
  4541 00001F2E 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4542 00001F31 80C680                  	add	dh, 80h
  4543 00001F34 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4544 00001F37 66D1D8                  	rcr	ax, 1	; / 2
  4545                                  	; 18/01/2025
  4546 00001F3A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4547                                  	;push	eax ; *	; interpolated sample (R)
  4548                                  	; 18/01/2025
  4549 00001F3D C1E010                  	shl	eax, 16
  4550 00001F40 66A1[F3220000]          	mov	ax, [next_val_l]
  4551 00001F46 80C480                  	add	ah, 80h
  4552 00001F49 80C780                  	add	bh, 80h
  4553 00001F4C 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4554 00001F4F 66D1D8                  	rcr	ax, 1	; / 2
  4555 00001F52 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4556                                  	; 18/01/2025
  4557                                  	;stosw 		; interpolated sample (L)
  4558                                  	;pop	eax ; *	
  4559                                  	;sub	ah, 80h	; -32768 to +32767 format again
  4560                                  	;stosw 		; interpolated sample (R)
  4561                                  	; 18/01/2025
  4562 00001F55 AB                      	stosd
  4563 00001F56 C3                      	retn
  4564                                  
  4565                                  interpolating_5_8bit_mono:
  4566                                  	; 17/11/2023
  4567                                  	; al = [previous_val]
  4568                                  	; dl = [next_val]
  4569                                  	; original-interpltd-interpltd-interpltd-interpltd
  4570 00001F57 88C3                    	mov	bl, al
  4571 00001F59 2C80                    	sub	al, 80h
  4572 00001F5B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4573 00001F5F 66AB                    	stosw		; original sample (L)
  4574 00001F61 66AB                    	stosw		; original sample (R)
  4575 00001F63 88D8                    	mov	al, bl
  4576 00001F65 00D0                    	add	al, dl
  4577 00001F67 D0D8                    	rcr	al, 1
  4578 00001F69 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4579 00001F6B 00D8                    	add	al, bl  ; [previous_val]
  4580 00001F6D D0D8                    	rcr	al, 1 	
  4581 00001F6F 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4582 00001F71 00D8                    	add	al, bl
  4583 00001F73 D0D8                    	rcr	al, 1
  4584 00001F75 2C80                    	sub	al, 80h
  4585 00001F77 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4586 00001F7B 66AB                    	stosw		; interpolated sample 1 (L)
  4587 00001F7D 66AB                    	stosw		; interpolated sample 1 (R)
  4588 00001F7F 88F8                    	mov	al, bh
  4589 00001F81 00F0                    	add	al, dh
  4590 00001F83 D0D8                    	rcr	al, 1
  4591 00001F85 2C80                    	sub	al, 80h
  4592 00001F87 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4593 00001F8B 66AB                    	stosw		; interpolated sample 2 (L)
  4594 00001F8D 66AB                    	stosw		; interpolated sample 2 (R)
  4595 00001F8F 88F8                    	mov	al, bh
  4596 00001F91 00D0                    	add	al, dl	; [next_val]
  4597 00001F93 D0D8                    	rcr	al, 1
  4598 00001F95 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4599 00001F97 00F8                    	add	al, bh
  4600 00001F99 D0D8                    	rcr	al, 1
  4601 00001F9B 2C80                    	sub	al, 80h
  4602 00001F9D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4603 00001FA1 66AB                    	stosw		; interpolated sample 3 (L)
  4604 00001FA3 66AB                    	stosw		; interpolated sample 3 (R)
  4605 00001FA5 88F0                    	mov	al, dh
  4606 00001FA7 00D0                    	add	al, dl
  4607 00001FA9 D0D8                    	rcr	al, 1
  4608 00001FAB 2C80                    	sub	al, 80h
  4609 00001FAD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4610 00001FB1 66AB                    	stosw		; interpolated sample 4 (L)
  4611 00001FB3 66AB                    	stosw		; interpolated sample 4 (R)
  4612 00001FB5 C3                      	retn
  4613                                  
  4614                                  interpolating_5_8bit_stereo:
  4615                                  	; 17/11/2023
  4616                                  	; al = [previous_val_l]
  4617                                  	; ah = [previous_val_r]
  4618                                  	; dl = [next_val_l]
  4619                                  	; dh = [next_val_r]
  4620                                  	; original-interpltd-interpltd-interpltd-interpltd
  4621 00001FB6 89C3                    	mov	ebx, eax
  4622 00001FB8 2C80                    	sub	al, 80h
  4623 00001FBA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4624 00001FBE 66AB                    	stosw		; original sample (L)
  4625 00001FC0 88F8                    	mov	al, bh
  4626 00001FC2 2C80                    	sub	al, 80h
  4627 00001FC4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4628 00001FC8 66AB                    	stosw		; original sample (R)
  4629 00001FCA 52                      	push	edx ; *
  4630 00001FCB 88D8                    	mov	al, bl
  4631 00001FCD 00D0                    	add	al, dl	; [next_val_l]
  4632 00001FCF D0D8                    	rcr	al, 1
  4633 00001FD1 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4634 00001FD2 00D8                    	add	al, bl	; [previous_val_l]
  4635 00001FD4 D0D8                    	rcr	al, 1
  4636 00001FD6 86D8                    	xchg	al, bl
  4637 00001FD8 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4638 00001FDA D0D8                    	rcr	al, 1
  4639 00001FDC 2C80                    	sub	al, 80h
  4640 00001FDE 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4641 00001FE2 66AB                    	stosw		; interpolated sample 1 (L)
  4642 00001FE4 88F8                    	mov	al, bh
  4643 00001FE6 00F0                    	add	al, dh	; [next_val_r]
  4644 00001FE8 D0D8                    	rcr	al, 1
  4645 00001FEA 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4646 00001FEB 00F8                    	add	al, bh	; [previous_val_r]
  4647 00001FED D0D8                    	rcr	al, 1
  4648 00001FEF 86F8                    	xchg	al, bh
  4649 00001FF1 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4650 00001FF3 D0D8                    	rcr	al, 1
  4651 00001FF5 2C80                    	sub	al, 80h
  4652 00001FF7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4653 00001FFB 66AB                    	stosw		; interpolated sample 1 (R)
  4654 00001FFD 5A                      	pop	edx ; ***
  4655 00001FFE 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4656 00001FFF 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4657 00002001 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4658 00002003 D0D8                    	rcr	al, 1
  4659 00002005 2C80                    	sub	al, 80h
  4660 00002007 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4661 0000200B 66AB                    	stosw		; interpolated sample 2 (L)
  4662 0000200D 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4663 0000200F 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4664 00002011 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4665 00002013 D0D8                    	rcr	al, 1
  4666 00002015 2C80                    	sub	al, 80h
  4667 00002017 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4668 0000201B 66AB                    	stosw		; interpolated sample 2 (R)
  4669 0000201D 5A                      	pop	edx ; *
  4670 0000201E 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4671 00002020 00D0                    	add	al, dl	; [next_val_l]
  4672 00002022 D0D8                    	rcr	al, 1
  4673 00002024 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4674 00002026 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4675 00002028 D0D8                    	rcr	al, 1
  4676 0000202A 2C80                    	sub	al, 80h
  4677 0000202C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4678 00002030 66AB                    	stosw		; interpolated sample 3 (L)
  4679 00002032 88F8                    	mov	al, bh	
  4680 00002034 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4681 00002036 D0D8                    	rcr	al, 1
  4682 00002038 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4683 0000203A 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4684 0000203C D0D8                    	rcr	al, 1
  4685 0000203E 2C80                    	sub	al, 80h
  4686 00002040 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4687 00002044 66AB                    	stosw		; interpolated sample 3 (R)
  4688 00002046 88D8                    	mov	al, bl
  4689 00002048 00D0                    	add	al, dl	; [next_val_l]
  4690 0000204A D0D8                    	rcr	al, 1
  4691 0000204C 2C80                    	sub	al, 80h
  4692 0000204E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4693 00002052 66AB                    	stosw		; interpolated sample 4 (L)
  4694 00002054 88F8                    	mov	al, bh
  4695 00002056 00F0                    	add	al, dh	; [next_val_r]
  4696 00002058 D0D8                    	rcr	al, 1
  4697 0000205A 2C80                    	sub	al, 80h
  4698 0000205C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4699 00002060 66AB                    	stosw		; interpolated sample 4 (R)
  4700 00002062 C3                      	retn
  4701                                  
  4702                                  interpolating_4_8bit_mono:
  4703                                  	; 17/11/2023
  4704                                  	; al = [previous_val]
  4705                                  	; dl = [next_val]
  4706                                  	; original-interpolated-interpolated-interpolated
  4707 00002063 88C3                    	mov	bl, al
  4708 00002065 2C80                    	sub	al, 80h
  4709 00002067 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4710 0000206B 66AB                    	stosw		; original sample (L)
  4711 0000206D 66AB                    	stosw		; original sample (R)
  4712 0000206F 88D8                    	mov	al, bl
  4713 00002071 00D0                    	add	al, dl	
  4714 00002073 D0D8                    	rcr	al, 1
  4715 00002075 86D8                    	xchg	al, bl  ; al = [previous_val]
  4716 00002077 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4717 00002079 D0D8                    	rcr	al, 1 	
  4718 0000207B 2C80                    	sub	al, 80h
  4719 0000207D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4720 00002081 66AB                    	stosw		; interpolated sample 1 (L)
  4721 00002083 66AB                    	stosw		; interpolated sample 1 (R)
  4722 00002085 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4723 00002087 2C80                    	sub	al, 80h
  4724 00002089 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4725 0000208D 66AB                    	stosw		; interpolated sample 2 (L)
  4726 0000208F 66AB                    	stosw		; interpolated sample 2 (R)
  4727 00002091 88D8                    	mov	al, bl
  4728 00002093 00D0                    	add	al, dl	; [next_val]
  4729 00002095 D0D8                    	rcr	al, 1
  4730 00002097 2C80                    	sub	al, 80h
  4731 00002099 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4732 0000209D 66AB                    	stosw		; interpolated sample 3 (L)
  4733 0000209F 66AB                    	stosw		; interpolated sample 3 (R)
  4734 000020A1 C3                      	retn
  4735                                  
  4736                                  interpolating_4_8bit_stereo:
  4737                                  	; 17/11/2023
  4738                                  	; al = [previous_val_l]
  4739                                  	; ah = [previous_val_r]
  4740                                  	; dl = [next_val_l]
  4741                                  	; dh = [next_val_r]	
  4742                                  	; original-interpolated-interpolated-interpolated
  4743 000020A2 89C3                    	mov	ebx, eax
  4744 000020A4 2C80                    	sub	al, 80h
  4745 000020A6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4746 000020AA 66AB                    	stosw		; original sample (L)
  4747 000020AC 88F8                    	mov	al, bh
  4748 000020AE 2C80                    	sub	al, 80h
  4749 000020B0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4750 000020B4 66AB                    	stosw		; original sample (R)
  4751 000020B6 88D8                    	mov	al, bl
  4752 000020B8 00D0                    	add	al, dl	; [next_val_l]
  4753 000020BA D0D8                    	rcr	al, 1
  4754 000020BC 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4755 000020BE 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4756 000020C0 D0D8                    	rcr	al, 1
  4757 000020C2 2C80                    	sub	al, 80h
  4758 000020C4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4759 000020C8 66AB                    	stosw		; interpolated sample 1 (L)
  4760 000020CA 88F8                    	mov	al, bh
  4761 000020CC 00F0                    	add	al, dh	; [next_val_r]
  4762 000020CE D0D8                    	rcr	al, 1
  4763 000020D0 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4764 000020D2 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4765 000020D4 D0D8                    	rcr	al, 1
  4766 000020D6 2C80                    	sub	al, 80h
  4767 000020D8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4768 000020DC 66AB                    	stosw		; interpolated sample 1 (R)
  4769 000020DE 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4770 000020E0 2C80                    	sub	al, 80h
  4771 000020E2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4772 000020E6 66AB                    	stosw		; interpolated sample 2 (L)
  4773 000020E8 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4774 000020EA 2C80                    	sub	al, 80h
  4775 000020EC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4776 000020F0 66AB                    	stosw		; interpolated sample 2 (L)
  4777 000020F2 88D8                    	mov	al, bl
  4778 000020F4 00D0                    	add	al, dl	; [next_val_l]
  4779 000020F6 D0D8                    	rcr	al, 1
  4780 000020F8 2C80                    	sub	al, 80h
  4781 000020FA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4782 000020FE 66AB                    	stosw		; interpolated sample 3 (L)
  4783 00002100 88F8                    	mov	al, bh
  4784 00002102 00F0                    	add	al, dh	; [next_val_r]
  4785 00002104 D0D8                    	rcr	al, 1
  4786 00002106 2C80                    	sub	al, 80h
  4787 00002108 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4788 0000210C 66AB                    	stosw		; interpolated sample 3 (R)
  4789 0000210E C3                      	retn
  4790                                  
  4791                                  interpolating_5_16bit_mono:
  4792                                  	; 18/11/2023
  4793                                  	; ax = [previous_val]
  4794                                  	; dx = [next_val]
  4795                                  	; original-interpltd-interpltd-interpltd-interpltd
  4796 0000210F 66AB                    	stosw		; original sample (L)
  4797 00002111 66AB                    	stosw		; original sample (R)
  4798 00002113 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4799 00002116 89C3                    	mov	ebx, eax ; [previous_val]
  4800 00002118 80C680                  	add	dh, 80h
  4801 0000211B 6601D0                  	add	ax, dx
  4802 0000211E 66D1D8                  	rcr	ax, 1
  4803 00002121 50                      	push	eax ; *	; interpolated middle (temporary)
  4804 00002122 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4805 00002125 66D1D8                  	rcr	ax, 1
  4806 00002128 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4807 00002129 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4808 0000212C 66D1D8                  	rcr	ax, 1	
  4809 0000212F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4810 00002132 66AB                    	stosw 		; interpolated sample 1 (L)
  4811 00002134 66AB                    	stosw		; interpolated sample 1 (R)
  4812 00002136 58                      	pop	eax ; **
  4813 00002137 5B                      	pop	ebx ; *
  4814 00002138 6601D8                  	add	ax, bx	; 1st quarter + middle
  4815 0000213B 66D1D8                  	rcr	ax, 1	; / 2
  4816 0000213E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4817 00002141 66AB                    	stosw		; interpolated sample 2 (L)
  4818 00002143 66AB                    	stosw		; interpolated sample 2 (R)
  4819 00002145 89D8                    	mov	eax, ebx
  4820 00002147 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4821 0000214A 66D1D8                  	rcr	ax, 1
  4822 0000214D 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4823 0000214E 6601D8                  	add	ax, bx	; + interpolated middle
  4824 00002151 66D1D8                  	rcr	ax, 1
  4825 00002154 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4826 00002157 66AB                    	stosw		; interpolated sample 3 (L)
  4827 00002159 66AB                    	stosw		; interpolated sample 3 (R)
  4828 0000215B 58                      	pop	eax ; *	
  4829 0000215C 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4830 0000215F 66D1D8                  	rcr	ax, 1	; / 2
  4831 00002162 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4832 00002165 66AB                    	stosw		; interpolated sample 4 (L)
  4833 00002167 66AB                    	stosw		; interpolated sample 4 (R)
  4834 00002169 C3                      	retn
  4835                                  
  4836                                  interpolating_5_16bit_stereo:
  4837                                  	; 18/11/2023
  4838                                  	; bx = [previous_val_l]
  4839                                  	; ax = [previous_val_r]
  4840                                  	; [next_val_l]
  4841                                  	; [next_val_r]
  4842                                  	; original-interpltd-interpltd-interpltd-interpltd
  4843 0000216A 51                      	push	ecx ; !
  4844 0000216B 93                      	xchg	eax, ebx
  4845 0000216C 66AB                    	stosw		; original sample (L)
  4846 0000216E 93                      	xchg	eax, ebx
  4847 0000216F 66AB                    	stosw		; original sample (R)
  4848 00002171 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4849 00002174 50                      	push	eax ; *	; [previous_val_r]
  4850 00002175 80C780                  	add	bh, 80h
  4851 00002178 8005[F4220000]80        	add	byte [next_val_l+1], 80h
  4852 0000217F 66A1[F3220000]          	mov	ax, [next_val_l]
  4853 00002185 6601D8                  	add	ax, bx	; [previous_val_l]
  4854 00002188 66D1D8                  	rcr	ax, 1
  4855 0000218B 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4856 0000218D 6601D8                  	add	ax, bx	
  4857 00002190 66D1D8                  	rcr	ax, 1
  4858 00002193 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4859 00002195 6601D8                  	add	ax, bx	; [previous_val_l]
  4860 00002198 66D1D8                  	rcr	ax, 1
  4861 0000219B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4862 0000219E 66AB                    	stosw 		; interpolated sample 1 (L)
  4863 000021A0 89C8                    	mov	eax, ecx
  4864 000021A2 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4865 000021A5 66D1D8                  	rcr	ax, 1	; / 2
  4866 000021A8 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4867 000021AA 5A                      	pop	edx ; *	; [previous_val_r]
  4868 000021AB 89D0                    	mov	eax, edx
  4869 000021AD 8005[F6220000]80        	add	byte [next_val_r+1], 80h
  4870 000021B4 660305[F5220000]        	add	ax, [next_val_r]
  4871 000021BB 66D1D8                  	rcr	ax, 1
  4872 000021BE 50                      	push	eax ; *	; interpolated middle (R)
  4873 000021BF 6601D0                  	add	ax, dx
  4874 000021C2 66D1D8                  	rcr	ax, 1
  4875 000021C5 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4876 000021C6 6601D0                  	add	ax, dx	; [previous_val_r]
  4877 000021C9 66D1D8                  	rcr	ax, 1
  4878 000021CC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4879 000021CF 66AB                    	stosw 		; interpolated sample 1 (R)
  4880 000021D1 89D8                    	mov	eax, ebx
  4881 000021D3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4882 000021D6 66AB                    	stosw 		; interpolated sample 2 (L)
  4883 000021D8 58                      	pop	eax ; **
  4884 000021D9 5A                      	pop	edx ; *
  4885 000021DA 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4886 000021DD 66D1D8                  	rcr	ax, 1	; / 2
  4887 000021E0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4888 000021E3 66AB                    	stosw 		; interpolated sample 2 (R)
  4889 000021E5 89C8                    	mov	eax, ecx
  4890 000021E7 660305[F3220000]        	add	ax, [next_val_l]
  4891 000021EE 66D1D8                  	rcr	ax, 1
  4892 000021F1 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4893 000021F2 6601C8                  	add	ax, cx	; interpolated middle (L)
  4894 000021F5 66D1D8                  	rcr	ax, 1
  4895 000021F8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4896 000021FB 66AB                    	stosw 		; interpolated sample 3 (L)
  4897 000021FD 89D0                    	mov	eax, edx
  4898 000021FF 660305[F5220000]        	add	ax, [next_val_r]
  4899 00002206 66D1D8                  	rcr	ax, 1
  4900 00002209 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4901 0000220A 6601D0                  	add	ax, dx	; interpolated middle (R)
  4902 0000220D 66D1D8                  	rcr	ax, 1
  4903 00002210 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4904 00002213 66AB                    	stosw 		; interpolated sample 3 (R)
  4905 00002215 5B                      	pop	ebx ; **
  4906 00002216 58                      	pop	eax ; *
  4907 00002217 660305[F3220000]        	add	ax, [next_val_l]
  4908 0000221E 66D1D8                  	rcr	ax, 1
  4909 00002221 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4910 00002224 66AB                    	stosw 		; interpolated sample 4 (L)
  4911 00002226 89D8                    	mov	eax, ebx
  4912 00002228 660305[F5220000]        	add	ax, [next_val_r]
  4913 0000222F 66D1D8                  	rcr	ax, 1
  4914 00002232 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4915 00002235 66AB                    	stosw 		; interpolated sample 4 (R)
  4916 00002237 59                      	pop	ecx ; !
  4917 00002238 C3                      	retn
  4918                                  
  4919                                  interpolating_4_16bit_mono:
  4920                                  	; 18/11/2023
  4921                                  	; ax = [previous_val]
  4922                                  	; dx = [next_val]
  4923                                  	; original-interpolated
  4924                                  
  4925 00002239 66AB                    	stosw		; original sample (L)
  4926 0000223B 66AB                    	stosw		; original sample (R)
  4927 0000223D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4928 00002240 89C3                    	mov	ebx, eax ; [previous_val]
  4929 00002242 80C680                  	add	dh, 80h
  4930 00002245 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4931 00002248 66D1D8                  	rcr	ax, 1
  4932 0000224B 93                      	xchg	eax, ebx
  4933 0000224C 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4934 0000224F 66D1D8                  	rcr	ax, 1
  4935 00002252 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4936 00002255 66AB                    	stosw 		; interpolated sample 1 (L)
  4937 00002257 66AB                    	stosw		; interpolated sample 1 (R)
  4938 00002259 89D8                    	mov	eax, ebx ; interpolated middle
  4939 0000225B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4940 0000225E 66AB                    	stosw 		; interpolated sample 2 (L)
  4941 00002260 66AB                    	stosw		; interpolated sample 2 (R)
  4942 00002262 89D8                    	mov	eax, ebx
  4943 00002264 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4944 00002267 66D1D8                  	rcr	ax, 1
  4945 0000226A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4946 0000226D 66AB                    	stosw		; interpolated sample 3 (L)
  4947 0000226F 66AB                    	stosw		; interpolated sample 3 (R)
  4948 00002271 C3                      	retn
  4949                                  
  4950                                  interpolating_4_16bit_stereo:
  4951                                  	; 18/11/2023
  4952                                  	; bx = [previous_val_l]
  4953                                  	; ax = [previous_val_r]
  4954                                  	; [next_val_l]
  4955                                  	; [next_val_r]
  4956                                  	; original-interpolated-interpolated-interpolated
  4957 00002272 93                      	xchg	eax, ebx
  4958 00002273 66AB                    	stosw		; original sample (L)
  4959 00002275 93                      	xchg	eax, ebx
  4960 00002276 66AB                    	stosw		; original sample (R)
  4961 00002278 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4962 0000227B 89C2                    	mov	edx, eax ; [previous_val_r]
  4963 0000227D 80C780                  	add	bh, 80h
  4964 00002280 8005[F4220000]80        	add	byte [next_val_l+1], 80h
  4965 00002287 66A1[F3220000]          	mov	ax, [next_val_l]
  4966 0000228D 6601D8                  	add	ax, bx	; [previous_val_l]
  4967 00002290 66D1D8                  	rcr	ax, 1
  4968 00002293 93                      	xchg	eax, ebx
  4969 00002294 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4970 00002297 66D1D8                  	rcr	ax, 1
  4971 0000229A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4972 0000229D 66AB                    	stosw 		; interpolated sample 1 (L)
  4973 0000229F 8005[F6220000]80        	add	byte [next_val_r+1], 80h
  4974 000022A6 89D0                    	mov	eax, edx ; [previous_val_r]
  4975 000022A8 660305[F5220000]        	add	ax, [next_val_r]
  4976 000022AF 66D1D8                  	rcr	ax, 1
  4977 000022B2 92                      	xchg	eax, edx
  4978 000022B3 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4979 000022B6 66D1D8                  	rcr	ax, 1
  4980 000022B9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4981 000022BC 66AB                    	stosw 		; interpolated sample 1 (R)
  4982 000022BE 89D8                    	mov	eax, ebx
  4983 000022C0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4984 000022C3 66AB                    	stosw 		; interpolated sample 2 (L)
  4985 000022C5 89D0                    	mov	eax, edx
  4986 000022C7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4987 000022CA 66AB                    	stosw 		; interpolated sample 2 (R)
  4988 000022CC 89D8                    	mov	eax, ebx
  4989 000022CE 660305[F3220000]        	add	ax, [next_val_l]
  4990 000022D5 66D1D8                  	rcr	ax, 1
  4991 000022D8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4992 000022DB 66AB                    	stosw 		; interpolated sample 3 (L)
  4993 000022DD 89D0                    	mov	eax, edx
  4994 000022DF 660305[F5220000]        	add	ax, [next_val_r]
  4995 000022E6 66D1D8                  	rcr	ax, 1
  4996 000022E9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4997 000022EC 66AB                    	stosw 		; interpolated sample 3 (R)
  4998 000022EE C3                      	retn
  4999                                  
  5000                                  ; 13/11/2023
  5001                                  previous_val:
  5002 000022EF 0000                    previous_val_l: dw 0
  5003 000022F1 0000                    previous_val_r: dw 0
  5004                                  next_val:
  5005 000022F3 0000                    next_val_l: dw 0
  5006 000022F5 0000                    next_val_r: dw 0
  5007                                  
  5008                                  ; 16/11/2023
  5009 000022F7 00                      faz:	db 0
  5010                                  
  5011                                  ; --------------------------------------------------------
  5012                                  ; --------------------------------------------------------
  5013                                  
  5014                                  ; 07/12/2024
  5015                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  5016                                  ;		'sysaudio' system call (23/08/2024)
  5017                                  ; 18/11/2024
  5018                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  5019                                  
  5020                                  ac97_stop: 
  5021                                  	; 18/11/2024
  5022 000022F8 C605[C87E0000]02        	mov	byte [stopped], 2
  5023                                  	; 07/12/2024
  5024                                  	sys	_audio, 0700h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000022FF BB00070000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00002304 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00002309 CD40                <1>  int 40h
  5025 0000230B C3                      	retn
  5026                                  
  5027                                  ac97_pause:
  5028                                  	; 18/11/2024
  5029 0000230C C605[C87E0000]01        	mov	byte [stopped], 1 ; paused
  5030                                  	; 07/12/2024
  5031                                  	sys	_audio, 0500h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00002313 BB00050000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00002318 B820000000          <1>  mov eax, %1
   100                              <1> 
   101 0000231D CD40                <1>  int 40h
  5032 0000231F C3                      	retn
  5033                                  
  5034                                  ac97_play: ; continue to play (after pause)
  5035                                  	; 18/11/2024
  5036 00002320 C605[C87E0000]00        	mov	byte [stopped], 0
  5037                                  	; 07/12/2024	
  5038                                  	sys	_audio, 0600h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00002327 BB00060000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000232C B820000000          <1>  mov eax, %1
   100                              <1> 
   101 00002331 CD40                <1>  int 40h
  5039 00002333 C3                      	retn
  5040                                  	
  5041                                  ; --------------------------------------------------------
  5042                                  ; 14/11/2024 - Erdogan Tan
  5043                                  ; --------------------------------------------------------
  5044                                  
  5045                                  	; 07/12/2024
  5046                                  	; 01/12/2024 (32bit registers)
  5047                                  	; 29/11/2024
  5048                                  checkUpdateEvents:
  5049 00002334 E8D0010000              	call	check4keyboardstop
  5050 00002339 7279                    	jc	short c4ue_ok
  5051                                  
  5052                                  	; 18/11/2024
  5053 0000233B 50                      	push	eax ; *
  5054 0000233C 09C0                    	or	eax, eax
  5055 0000233E 0F8406010000            	jz	c4ue_cpt
  5056                                  
  5057                                  	; 18/11/2024
  5058 00002344 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  5059 00002346 7543                    	jne	short c4ue_chk_s
  5060 00002348 803D[C87E0000]00        	cmp	byte [stopped], 0
  5061 0000234F 7714                    	ja	short c4ue_chk_ps
  5062                                  	; pause
  5063 00002351 E8B6FFFFFF              	call	ac97_pause
  5064                                  	; 21/11/2024
  5065 00002356 A0[C97E0000]            	mov	al, [tLO]
  5066 0000235B A2[CA7E0000]            	mov	byte [tLP], al
  5067 00002360 E9E5000000              	jmp	c4ue_cpt
  5068                                  c4ue_chk_ps:
  5069 00002365 803D[C87E0000]01        	cmp	byte [stopped], 1
  5070 0000236C 770A                    	ja	short c4ue_replay
  5071                                  	; continue to play (after a pause)
  5072 0000236E E8ADFFFFFF              	call	ac97_play 
  5073 00002373 E9D2000000              	jmp	c4ue_cpt
  5074                                  c4ue_replay:
  5075                                  	; 19/11/2024
  5076 00002378 58                      	pop	eax ; *
  5077 00002379 58                      	pop	eax ; return address
  5078                                  	; 07/02/2024
  5079                                  	;mov	al, [volume]
  5080                                  	;call	SetmasterVolume
  5081 0000237A C605[C87E0000]00        	mov	byte [stopped], 0
  5082 00002381 E89D040000              	call	move_to_beginning
  5083                                  	;jmp	PlayWav
  5084                                  	; 07/12/2024
  5085 00002386 E97FE3FFFF              	jmp	RePlayWav
  5086                                  
  5087                                  c4ue_chk_s:
  5088 0000238B 3C53                    	cmp	al, 'S'	; stop
  5089 0000238D 7526                    	jne	short c4ue_chk_fb
  5090 0000238F 803D[C87E0000]00        	cmp	byte [stopped], 0
  5091 00002396 0F87AE000000            	ja	c4ue_cpt ; Already stopped/paused
  5092 0000239C E857FFFFFF              	call	ac97_stop
  5093                                  	; 19/11/2024
  5094 000023A1 C605[C97E0000]00        	mov	byte [tLO], 0
  5095                                  	; 21/11/2024
  5096 000023A8 C605[CA7E0000]30        	mov	byte [tLP], '0'
  5097 000023AF E996000000              	jmp	c4ue_cpt
  5098                                  
  5099                                  	; 01/12/2024
  5100                                  	; 18/11/2024
  5101                                  c4ue_ok:
  5102 000023B4 C3                      	retn
  5103                                  
  5104                                  c4ue_chk_fb:
  5105                                  	; 17/11/2024
  5106 000023B5 3C46                    	cmp	al, 'F'
  5107 000023B7 750A                    	jne	short c4ue_chk_b
  5108 000023B9 E83D040000              	call 	Player_ProcessKey_Forwards
  5109 000023BE E987000000              	jmp	c4ue_cpt
  5110                                  
  5111                                  c4ue_chk_b:
  5112 000023C3 3C42                    	cmp	al, 'B'
  5113                                  	;;jne	short c4ue_cpt
  5114                                  	; 19/11/2024
  5115                                  	;jne	short c4ue_chk_h
  5116                                  	; 25/12/2024
  5117                                  	; 29/11/2024
  5118 000023C5 7507                    	jne	short c4ue_chk_n
  5119 000023C7 E82B040000              	call 	Player_ProcessKey_Backwards
  5120 000023CC EB7C                    	jmp	short c4ue_cpt
  5121                                  
  5122                                  	;;;
  5123                                  	; 25/12/2024
  5124                                  	; 29/11/2024
  5125                                  c4ue_chk_n:
  5126 000023CE 3C4E                    	cmp	al, 'N'
  5127 000023D0 7404                    	je	short c4ue_nps
  5128                                  c4ue_chk_p:
  5129 000023D2 3C50                    	cmp	al, 'P'
  5130 000023D4 7509                    	jne	short c4ue_chk_h
  5131                                  c4ue_nps:
  5132 000023D6 C605[C87E0000]03        	mov	byte [stopped], 3
  5133 000023DD EB6B                    	jmp	short c4ue_cpt
  5134                                  	;;;
  5135                                  
  5136                                  c4ue_chk_h:
  5137                                  	; 19/11/2024
  5138 000023DF 3C48                    	cmp	al, 'H'
  5139 000023E1 7515                    	jne	short c4ue_chk_cr
  5140 000023E3 C605[CB7E0000]00        	mov	byte [wleds], 0
  5141 000023EA E895E6FFFF              	call 	write_ac97_pci_dev_info
  5142                                  	;;;
  5143                                  	;24/12/2024 (wave lighting points option)
  5144 000023EF C605[D77E0000]01        	mov	byte [p_mode], 1
  5145                                  	;;;
  5146                                  	;mov	dh, 24
  5147                                  	;mov	dl, 79
  5148                                  	;call	setCursorPosition
  5149                                  	; 21/12/2024
  5150 000023F6 EB52                    	jmp	short c4ue_cpt
  5151                                  c4ue_chk_cr:
  5152                                  	;;;
  5153                                  	; 24/12/2024 (wave lighting points option)
  5154 000023F8 8A25[CB7E0000]          	mov	ah, [wleds]
  5155 000023FE 3C47                    	cmp	al, 'G'
  5156 00002400 7432                    	je	short c4ue_g
  5157                                  ;	;;;
  5158                                  ;	; 26/12/2024
  5159                                  ;	cmp	al, 'T'
  5160                                  ;	jne	short c4ue_chk_cr_@
  5161                                  ;	inc	byte [tcolor]
  5162                                  ;	and 	byte [tcolor], 0Fh
  5163                                  ;	jnz	short c4ue_cpt
  5164                                  ;	inc	byte [tcolor]
  5165                                  ;	jmp	short c4ue_cpt
  5166                                  ;c4ue_chk_cr_@:
  5167                                  ;	;;;
  5168                                  	; 19/11/2024
  5169 00002402 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  5170 00002404 7544                    	jne	short c4ue_cpt
  5171                                  	;inc	byte [wleds]
  5172                                  	;jnz	short c4ue_cpt
  5173                                  	;inc	byte [wleds]
  5174                                  	;;;
  5175                                  	; 24/12/2024
  5176                                  	; 22/12/2024 (faster method)
  5177                                  	; (UpdateWaveLeds procedure turns off previously
  5178                                  	;  lighting wave leds only)
  5179                                  	;call	reset_wave_leds ; prepare all leds as turned off
  5180                                  	;;;
  5181                                  	; 23/11/2024
  5182 00002406 31DB                    	xor	ebx, ebx
  5183                                  	; 24/12/2024 (wave lighting points option)
  5184 00002408 881D[D77E0000]          	mov	[p_mode], bl ; 0
  5185                                  	;
  5186                                  	;mov	bl, [wleds]
  5187 0000240E 88E3                    	mov	bl, ah ; 24/12/2024
  5188 00002410 FEC3                    	inc	bl
  5189 00002412 80E30F                  	and	bl, 0Fh
  5190 00002415 7501                    	jnz	short c4ue_sc
  5191 00002417 43                      	inc	ebx
  5192                                  c4ue_sc:
  5193 00002418 881D[CB7E0000]          	mov	[wleds], bl
  5194 0000241E D0EB                    	shr	bl, 1
  5195 00002420 8A83[65410000]          	mov	al, [ebx+colors]
  5196                                  	; 24/12/2024
  5197 00002426 A2[6D410000]            	mov	[ccolor], al
  5198 0000242B 7211                    	jc	short c4ue_g_@
  5199                                  	; 24/12/2024
  5200 0000242D E83B040000              	call	reset_wave_leds ; prepare all leds as turned off
  5201 00002432 EB16                    	jmp	short c4ue_cpt
  5202                                  	; 24/12/2024
  5203                                  c4ue_g:
  5204 00002434 08E4                    	or	ah, ah	; byte [wleds]
  5205 00002436 7506                    	jnz	short c4ue_g_@
  5206 00002438 FE05[CB7E0000]          	inc	byte [wleds]	; force wave lighting ('G' key)
  5207                                  c4ue_g_@:
  5208                                  	; 24/12/2024 (wave lighting points option)
  5209 0000243E C605[D77E0000]01        	mov	byte [p_mode], 1
  5210 00002445 E808040000              	call	clear_window
  5211                                  	;;;
  5212                                  c4ue_cpt:
  5213                                  	; 24/12/2024
  5214                                  	; 18/11/2024
  5215 0000244A 59                      	pop	ecx ; *
  5216                                  	;;;
  5217                                  	; 24/12/2024 (skip wave lighting if data is not loaded yet)
  5218 0000244B 803D[6F7F0000]00        	cmp	byte [SRB], 0
  5219 00002452 7751                    	ja	short c4ue_vb_ok
  5220                                  	;;;
  5221                                  	; 01/12/2024 (TRDOS 386)
  5222                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second),
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00002454 BB04000000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00002459 B80D000000          <1>  mov eax, %1
   100                              <1> 
   101 0000245E CD40                <1>  int 40h
  5223                                  	; 24/12/2024
  5224                                  	; 18/11/2024
  5225                                  	;pop	ecx ; *
  5226                                  	; 01/12/2024
  5227 00002460 3B05[987F0000]          	cmp	eax, [timerticks]
  5228                                  	;je	short c4ue_ok
  5229                                  	; 18/11/2024
  5230 00002466 7407                    	je	short c4ue_skip_utt
  5231                                  c4ue_utt:	
  5232                                  	; 01/12/2024
  5233 00002468 A3[987F0000]            	mov	[timerticks], eax
  5234 0000246D EB04                    	jmp	short c4ue_cpt_@
  5235                                  c4ue_skip_utt:
  5236                                  	; 18/11/2024
  5237 0000246F 21C9                    	and	ecx, ecx
  5238 00002471 7432                    	jz	short c4ue_vb_ok
  5239                                  c4ue_cpt_@:
  5240                                  	; 18/11/2024
  5241 00002473 803D[C87E0000]00        	cmp	byte [stopped], 0
  5242 0000247A 7729                    	ja	short c4ue_vb_ok
  5243                                  	
  5244 0000247C E8B9010000              	call	CalcProgressTime
  5245                                  
  5246                                  	;cmp	ax, [ProgressTime]
  5247                                  	; 01/12/2024
  5248 00002481 3B05[8C7F0000]          	cmp	eax, [ProgressTime]
  5249                                  	;je	short c4ue_vb_ok
  5250                                  			; same second, no need to update
  5251                                  	; 23/11/2024
  5252 00002487 7405                    	je	short c4ue_uvb
  5253                                  
  5254                                  	;call	UpdateProgressTime
  5255                                  	;call	UpdateProgressBar@
  5256 00002489 E8DD020000              	call	UpdateProgressBar
  5257                                  
  5258                                  	; 23/11/2024
  5259                                  c4ue_uvb:
  5260 0000248E 803D[CB7E0000]00        	cmp	byte [wleds], 0
  5261 00002495 760E                    	jna	short c4ue_vb_ok
  5262                                  
  5263                                  	; 24/12/2024 (wave points mode)
  5264 00002497 803D[D77E0000]00        	cmp	byte [p_mode], 0
  5265 0000249E 7706                    	ja	short c4ue_uwp
  5266                                  
  5267 000024A0 E812040000              	call	UpdateWaveLeds
  5268                                  
  5269                                  c4ue_vb_ok:
  5270 000024A5 C3                      	retn
  5271                                  
  5272                                  	; 22/12/2024
  5273                                  c4ue_uwp:
  5274                                  	;call	UpdateWavePoints
  5275                                  	;retn
  5276                                  
  5277                                  ; --------------------------------------------------------
  5278                                  ; 27/12/2024 - Erdogan Tan
  5279                                  ; --------------------------------------------------------
  5280                                  
  5281                                  	; 27/12/2024 (DMA Buffer Tracking)
  5282                                  	; 26/12/2024
  5283                                  	; 24/12/2024
  5284                                  UpdateWavePoints:
  5285 000024A6 BE[C8740000]            	mov	esi, prev_points
  5286 000024AB 833E00                  	cmp	dword [esi], 0
  5287 000024AE 740B                    	jz	short lights_off_ok
  5288 000024B0 B980020000              	mov	ecx, 640
  5289                                  light_off:
  5290 000024B5 AD                      	lodsd
  5291                                  	; eax = wave point (lighting point) address
  5292 000024B6 C60000                  	mov	byte [eax], 0 ; black point (light off)
  5293 000024B9 E2FA                    	loop	light_off	
  5294                                  
  5295                                  lights_off_ok:
  5296                                  	; 27/12/2024
  5297                                  	; ref: modplay8.s (02/06/2024)
  5298                                  	; ----------------------------
  5299                                  	; Get Current Sound Data (in DMA buffer) ((320 bytes))
  5300                                  	; 23/06/2017
  5301                                  	; 22/06/2017
  5302                                  	; bh = 15, get current sound data/samples
  5303                                  	; bl = 0, for PCM OUT
  5304                                  	; ecx = count of sample/data bytes (1 to 4096)
  5305                                  	; edx = destination buffer address 
  5306                                  	;	(page aligned address is better)
  5307                                  
  5308 000024BB BE[00800200]            	mov	esi, g_buff
  5309                                  
  5310                                  	sys	_audio, 0F00h, 640*4, esi ; 27/12/2024
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 000024C0 BB000F0000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 000024C5 B9000A0000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 000024CA 89F2                <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 000024CC B820000000          <1>  mov eax, %1
   100                              <1> 
   101 000024D1 CD40                <1>  int 40h
  5311                                  	;jnc	short lgbuff_ok
  5312                                  	; clear g_buff content
  5313                                  	;mov	edi, esi
  5314                                  	;sub	eax, eax
  5315                                  	;shr	ecx, 2
  5316                                  	;rep	stosd
  5317                                  	;mov	ecx, 640
  5318                                  ;lgbuff_ok:
  5319                                  
  5320 000024D3 B980020000              	mov	ecx, 640	
  5321 000024D8 89CD                    	mov	ebp, ecx
  5322                                  	; 26/12/2024
  5323 000024DA BF[C8740000]            	mov	edi, prev_points
  5324 000024DF 8B1D[B4740000]          	mov	ebx, [graphstart] ; start (top) line
  5325                                  lights_on_4:
  5326 000024E5 31C0                    	xor	eax, eax ; 0
  5327 000024E7 66AD                    	lodsw	; left
  5328 000024E9 80C480                  	add	ah, 80h
  5329 000024EC 89C2                    	mov	edx, eax
  5330 000024EE 66AD                    	lodsw	; right
  5331                                  	;add	ax, dx
  5332 000024F0 80C480                  	add	ah, 80h
  5333                                  	;shr	eax, 9	; 128 volume levels
  5334 000024F3 01D0                    	add	eax, edx
  5335                                  	;shr	eax, 10	; (L+R/2) & 128 volume levels
  5336 000024F5 C1E809                  	shr	eax, 9	; (L+R/2) & 256 volume levels
  5337 000024F8 F7E5                    	mul	ebp	; * 640 (row)
  5338 000024FA 01D8                    	add	eax, ebx ; + column
  5339 000024FC 8A15[6D410000]          	mov	dl, [ccolor]
  5340 00002502 8810                    	mov	[eax], dl ; pixel (light on) color
  5341 00002504 AB                      	stosd		; save light on addr in prev_points
  5342 00002505 43                      	inc	ebx
  5343 00002506 E2DD                    	loop	lights_on_4
  5344 00002508 C3                      	retn
  5345                                  
  5346                                  ; --------------------------------------------------------
  5347                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  5348                                  ; --------------------------------------------------------
  5349                                  
  5350                                  	; 25/12/2024
  5351                                  	; 07/12/2024
  5352                                  	; 01/12/2024 (TRDOS 386)
  5353                                  	; 29/11/2024
  5354                                  check4keyboardstop:
  5355                                  	; 19/05/2024
  5356                                  	; 08/11/2023
  5357                                  	; 04/11/2023
  5358 00002509 B401                    	mov	ah, 1
  5359                                  	;int	16h
  5360                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5361 0000250B CD32                    	int	32h
  5362                                  	;clc
  5363 0000250D 7433                    	jz	short _cksr
  5364                                  
  5365 0000250F 30E4                    	xor	ah, ah
  5366                                  	;int	16h
  5367                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  5368 00002511 CD32                    	int	32h
  5369                                  
  5370                                  	; 25/12/2024
  5371                                  	; 29/11/2024
  5372                                  	;mov	[command], al
  5373                                  
  5374                                  	;;;
  5375                                  	; 19/05/2024 (change PCM out volume)
  5376 00002513 3C2B                    	cmp	al, '+'
  5377 00002515 750D                    	jne	short p_1
  5378                                  	
  5379 00002517 A0[6C250000]            	mov	al, [volume]
  5380 0000251C 3C00                    	cmp	al, 0
  5381 0000251E 7624                    	jna	short p_3
  5382 00002520 FEC8                    	dec	al
  5383 00002522 EB0F                    	jmp	short p_2
  5384                                  p_1:
  5385 00002524 3C2D                    	cmp	al, '-'
  5386 00002526 751D                    	jne	short p_4
  5387                                  
  5388 00002528 A0[6C250000]            	mov	al, [volume]
  5389 0000252D 3C1F                    	cmp	al, 31
  5390 0000252F 7313                    	jnb	short p_3
  5391 00002531 FEC0                    	inc	al
  5392                                  p_2:
  5393 00002533 A2[6C250000]            	mov	[volume], al
  5394                                  	; 14/11/2024
  5395                                  	;call	SetPCMOutVolume
  5396                                  	; 15/11/2024 (QEMU)
  5397                                  	; 07/12/2024
  5398 00002538 E87AE3FFFF              	call	SetMasterVolume
  5399                                  	;call	UpdateVolume
  5400                                  	;;clc
  5401                                  	;retn
  5402 0000253D E999010000              	jmp	UpdateVolume
  5403                                  	;mov	ah, al
  5404                                  	;mov    dx, [NAMBAR]
  5405                                    	;;add   dx, CODEC_MASTER_VOL_REG
  5406                                  	;add	dx, CODEC_PCM_OUT_REG
  5407                                  	;out    dx, ax
  5408                                  	;
  5409                                  	;call   delay1_4ms
  5410                                          ;call   delay1_4ms
  5411                                          ;call   delay1_4ms
  5412                                          ;call   delay1_4ms
  5413                                  _cksr:		; 19/05/2024
  5414                                  	; 18/12/2024
  5415 00002542 31C0                    	xor	eax, eax
  5416                                  	;clc
  5417                                  p_3:
  5418 00002544 C3                      	retn
  5419                                  p_4:
  5420                                  	; 17/11/2024
  5421 00002545 80FC01                  	cmp	ah, 01h  ; ESC
  5422 00002548 7419                        	je	short p_q
  5423                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5424 0000254A 3C03                    	cmp	al, 03h  ; CTRL+C
  5425 0000254C 7415                    	je	short p_q
  5426                                  
  5427                                  	; 18/11/2024
  5428 0000254E 3C20                    	cmp	al, 20h
  5429 00002550 7419                    	je	short p_r
  5430                                  
  5431                                  	; 19/11/2024
  5432 00002552 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5433 00002554 7415                    	je	short p_r
  5434                                  
  5435 00002556 24DF                    	and	al, 0DFh
  5436                                  
  5437                                  	; 25/12/2024
  5438                                  	; 29/11/2024
  5439 00002558 A2[D87E0000]            	mov	[command], al
  5440                                  
  5441                                  	;cmp	al, 'B'
  5442                                  	;je	short p_r
  5443                                  	;cmp	al, 'F'
  5444                                  	;je	short p_r
  5445                                  
  5446                                  	; 29/11/2024
  5447                                  	;cmp	al, 'N'
  5448                                  	;je	short p_r
  5449                                  	;cmp	al, 'P'
  5450                                  	;je	short p_r
  5451                                  
  5452 0000255D 3C51                    	cmp	al, 'Q'
  5453                                  	;je	short p_q
  5454 0000255F 7409                    	je	short p_quit ; 29/11/2024
  5455                                  
  5456 00002561 F8                      	clc
  5457 00002562 C3                      	retn
  5458                                  
  5459                                  	;;;
  5460                                  ;_cskr:	
  5461                                  p_q:
  5462                                  	; 27/12/2024
  5463 00002563 C605[D87E0000]51        	mov	byte [command], 'Q'
  5464                                  p_quit:
  5465 0000256A F9                      	stc
  5466                                  p_r:
  5467 0000256B C3                      	retn
  5468                                  
  5469                                  ; 29/05/2024
  5470                                  ; 19/05/2024
  5471                                  volume: 
  5472                                  	;db	02h
  5473                                  ; 26/12/2024
  5474 0000256C 03                      	db	03h
  5475                                  
  5476                                  ; --------------------------------------------------------
  5477                                  
  5478                                  	; 22/12/2024
  5479                                  	; 21/12/2024
  5480                                  	; simulate cursor position in VGA (VESA VBE) mode
  5481                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5482                                  setCursorPosition:
  5483                                  	; dh = Row
  5484                                  	; dl = Column
  5485                                  	
  5486 0000256D 31C0                    	xor	eax, eax
  5487 0000256F B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5488 00002571 F6E6                    	mul	dh
  5489 00002573 6683C007                	add	ax, 7	; top margin
  5490 00002577 C1E010                  	shl	eax, 16
  5491 0000257A 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5492 0000257C 66C1E003                	shl	ax, 3
  5493                                  			; hw = row, ax = column
  5494 00002580 A3[BC740000]            	mov	[screenpos], eax
  5495                                  	; 22/12/2024
  5496 00002585 31C0                    	xor	eax, eax
  5497 00002587 C3                      	retn
  5498                                  	
  5499                                  ; --------------------------------------------------------
  5500                                  ; 14/11/2024
  5501                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5502                                  
  5503                                  ;; NAME:	SetTotalTime
  5504                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5505                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5506                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5507                                  ;; 		Output on the screen of the total time in seconds
  5508                                  
  5509                                  	; 01/12/2024 (32 bit registers)
  5510                                  SetTotalTime:
  5511                                  	;; Calculate total seconds in file
  5512                                  	;mov	ax, [DATA_SubchunkSize]
  5513                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5514                                  	;mov	bx, [WAVE_SampleRate]
  5515                                  	;div	bx
  5516                                  	;xor	dx, dx
  5517                                  	; 01/12/2024
  5518 00002588 A1[047F0000]            	mov	eax, [DATA_SubchunkSize]
  5519 0000258D 0FB71D[F47E0000]        	movzx	ebx, word [WAVE_SampleRate]
  5520 00002594 31D2                    	xor	edx, edx
  5521 00002596 F7F3                    	div	ebx
  5522                                  
  5523                                  	;mov	bx, [WAVE_BlockAlign]
  5524                                  	;div	bx
  5525                                  	; 01/12/2024
  5526 00002598 668B1D[FC7E0000]        	mov	bx, [WAVE_BlockAlign]
  5527 0000259F 31D2                    	xor	edx, edx
  5528 000025A1 F7F3                    	div	ebx
  5529                                  
  5530                                  	;mov	[TotalTime], ax
  5531 000025A3 A3[887F0000]            	mov	[TotalTime], eax
  5532                                  
  5533 000025A8 B33C                    	mov	bl, 60
  5534 000025AA F6F3                    	div	bl
  5535                                  
  5536                                  	;; al = minutes, ah = seconds
  5537 000025AC 50                      	push	eax ; **
  5538 000025AD 50                      	push	eax ; *
  5539                                  
  5540                                  	;mov	dh, 24
  5541                                  	; 21/12/2024 (640*480)
  5542 000025AE B620                    	mov	dh, 32
  5543 000025B0 B22A                    	mov	dl, 42
  5544 000025B2 E8B6FFFFFF              	call	setCursorPosition
  5545                                  
  5546 000025B7 58                      	pop	eax ; *
  5547 000025B8 30E4                    	xor	ah, ah
  5548 000025BA BD02000000              	mov	ebp, 2
  5549 000025BF E812000000              	call	PrintNumber
  5550                                  	
  5551                                  	;mov	dh, 24
  5552                                  	; 21/12/2024 (640*480)
  5553 000025C4 B620                    	mov	dh, 32
  5554 000025C6 B22D                    	mov	dl, 45
  5555 000025C8 E8A0FFFFFF              	call	setCursorPosition
  5556                                  
  5557 000025CD 58                      	pop	eax ; **
  5558 000025CE 88E0                    	mov	al, ah
  5559 000025D0 30E4                    	xor	ah, ah
  5560                                  	; 21/12/2024
  5561 000025D2 66BD0200                	mov	bp, 2
  5562                                  	;jmp	short PrintNumber
  5563                                  
  5564                                  ; --------------------------------------------------------
  5565                                  
  5566                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5567                                  	; 01/12/2024 (32bit registers)
  5568                                  PrintNumber:
  5569                                  	; eax = binary number
  5570                                  	; ebp = digits
  5571 000025D6 8B35[BC740000]          	mov	esi, [screenpos]
  5572                                  		; hw = row, si = column
  5573 000025DC BB0A000000              	mov	ebx, 10
  5574 000025E1 31C9                    	xor	ecx, ecx
  5575                                  printNumber_CutNumber:
  5576 000025E3 41                      	inc	ecx
  5577 000025E4 31D2                    	xor	edx, edx
  5578 000025E6 F7F3                    	div	ebx
  5579 000025E8 52                      	push	edx
  5580 000025E9 39E9                    	cmp	ecx, ebp
  5581 000025EB 7402                    	je	short printNumber_printloop
  5582 000025ED EBF4                    	jmp	printNumber_CutNumber
  5583                                  
  5584                                  printNumber_printloop:
  5585 000025EF 58                      	pop	eax
  5586                                  	; 21/12/2024
  5587                                  	; ebp = count of digits
  5588                                  	; eax <= 9
  5589                                  
  5590 000025F0 0430                    	add	al, '0'
  5591                                  	
  5592                                  	; esi = pixel position (hw = row, si = column)
  5593                                  	; eax = al = character
  5594                                  	;call	write_character
  5595                                  	; 22/12/2024
  5596 000025F2 E82A010000              	call	write_character_white
  5597                                  
  5598 000025F7 4D                      	dec	ebp
  5599 000025F8 7405                     	jz	short printNumber_ok
  5600 000025FA 83C608                  	add	esi, 8	; next column
  5601 000025FD EBF0                    	jmp	short printNumber_printloop
  5602                                  printNumber_ok:
  5603 000025FF C3                      	retn
  5604                                  
  5605                                  ; --------------------------------------------------------
  5606                                  
  5607                                  	; 14/11/2024 - Erdogan Tan
  5608                                  SetProgressTime:
  5609                                  	;; Calculate playing/progress seconds in file
  5610 00002600 E835000000              	call	CalcProgressTime
  5611                                  
  5612                                  	; 01/12/2024 (32bit registers)
  5613                                  UpdateProgressTime:
  5614                                  	; eax = (new) progress time 
  5615                                  
  5616 00002605 A3[8C7F0000]            	mov	[ProgressTime], eax
  5617                                  
  5618 0000260A B33C                    	mov	bl, 60
  5619 0000260C F6F3                    	div	bl
  5620                                  
  5621                                  	;; al = minutes, ah = seconds
  5622 0000260E 50                      	push	eax ; **
  5623 0000260F 50                      	push	eax ; *
  5624                                  
  5625                                  	;mov	dh, 24
  5626                                  	; 21/12/2024 (640*480)
  5627 00002610 B620                    	mov	dh, 32
  5628 00002612 B221                    	mov	dl, 33
  5629 00002614 E854FFFFFF              	call	setCursorPosition
  5630                                  
  5631 00002619 58                      	pop	eax ; *
  5632 0000261A 30E4                    	xor	ah, ah
  5633 0000261C BD02000000              	mov	ebp, 2
  5634 00002621 E8B0FFFFFF              	call	PrintNumber
  5635                                  	
  5636                                  	;mov	dh, 24
  5637                                  	; 21/12/2024 (640*480)
  5638 00002626 B620                    	mov	dh, 32
  5639 00002628 B224                    	mov	dl, 36
  5640 0000262A E83EFFFFFF              	call	setCursorPosition
  5641                                  
  5642 0000262F 58                      	pop	eax ; **
  5643 00002630 88E0                    	mov	al, ah
  5644 00002632 30E4                    	xor	ah, ah
  5645                                  	; 21/12/2024
  5646 00002634 66BD0200                	mov	bp, 2
  5647 00002638 EB9C                    	jmp	short PrintNumber
  5648                                  
  5649                                  ; --------------------------------------------------------
  5650                                  
  5651                                  	; 01/12/2024 (32bit registers)
  5652                                  	; 17/11/2024
  5653                                  	; 14/11/2024
  5654                                  CalcProgressTime:
  5655                                  	;mov	ax, [LoadedDataBytes]
  5656                                  	;mov	dx, [LoadedDataBytes+2]
  5657                                  	;mov	bx, ax
  5658                                  	;or	bx, dx
  5659                                  	;jz	short cpt_ok
  5660                                  	; 01/12/2024
  5661 0000263A A1[947F0000]            	mov	eax, [LoadedDataBytes]
  5662 0000263F 09C0                    	or	eax, eax
  5663 00002641 7416                    	jz	short cpt_ok
  5664                                  
  5665                                  	;mov	bx, [WAVE_SampleRate]
  5666                                  	;div	bx
  5667                                  	;xor	dx, dx
  5668                                  	;mov	bx, [WAVE_BlockAlign]
  5669                                  	;div	bx
  5670                                  	; 01/12/2024
  5671 00002643 0FB71D[F47E0000]        	movzx	ebx, word [WAVE_SampleRate]
  5672 0000264A 31D2                    	xor	edx, edx
  5673 0000264C F7F3                    	div	ebx
  5674 0000264E 31D2                    	xor	edx, edx
  5675 00002650 668B1D[FC7E0000]        	mov	bx, [WAVE_BlockAlign]
  5676 00002657 F7F3                    	div	ebx
  5677                                  cpt_ok:
  5678                                  	; eax = (new) progress time
  5679 00002659 C3                      	retn
  5680                                  
  5681                                  ; --------------------------------------------------------
  5682                                  ; 14/11/2024
  5683                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5684                                  
  5685                                  ;; DESCRIPTION: Update file information on template
  5686                                  ;; PARAMS:	WAVE parameters and other variables
  5687                                  ;; REGS:	AX(RW)
  5688                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5689                                  ;; RETURNS:	On-screen file info is updated.
  5690                                  
  5691                                  	; 01/12/2024 (32bit registers)
  5692                                  UpdateFileInfo:
  5693                                  	;; Print File Name
  5694                                  	;mov	dh, 9
  5695                                  	; 21/12/2024 (640*480 graphics display)
  5696 0000265A B608                    	mov	dh, 8
  5697 0000265C B217                    	mov	dl, 23
  5698 0000265E E80AFFFFFF              	call	setCursorPosition
  5699                                  	
  5700 00002663 BE[1C7F0000]            	mov	esi, wav_file_name
  5701                                  	
  5702                                  	;;;
  5703                                  	; 14/11/2024
  5704                                  	; skip directory separators
  5705                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5706 00002668 89F3                    	mov	ebx, esi
  5707                                  chk4_nxt_sep:
  5708 0000266A AC                      	lodsb
  5709 0000266B 3C2F                    	cmp	al, '/'	; 14/12/2024
  5710 0000266D 7406                    	je	short chg_fpos
  5711 0000266F 20C0                    	and	al, al
  5712 00002671 7406                    	jz	short chg_fpos_ok
  5713 00002673 EBF5                    	jmp	short chk4_nxt_sep
  5714                                  chg_fpos:
  5715 00002675 89F3                    	mov	ebx, esi
  5716 00002677 EBF1                    	jmp	short chk4_nxt_sep
  5717                                  chg_fpos_ok:
  5718 00002679 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5719                                  	;;;
  5720                                  _fnl_chk:
  5721                                  	; 26/12/2024 (file name length limit -display-)
  5722                                  	;mov	ebx, 12
  5723 0000267B BB11000000              	mov	ebx, 17 ; ????????.wav?????
  5724 00002680 56                      	push	esi
  5725                                  _fnl_chk_loop:
  5726 00002681 AC                      	lodsb
  5727 00002682 20C0                    	and	al, al
  5728 00002684 7406                    	jz	short _fnl_ok
  5729 00002686 4B                       	dec	ebx
  5730 00002687 75F8                    	jnz	short _fnl_chk_loop
  5731 00002689 C60600                  	mov	byte [esi], 0
  5732                                  _fnl_ok:
  5733 0000268C 5E                      	pop	esi
  5734                                  	;;;
  5735                                  
  5736 0000268D E870000000              	call	PrintString
  5737                                  	
  5738                                  	;; Print Frequency
  5739                                  	;mov	dh, 10
  5740                                  	; 21/12/2024 (640*480 graphics display)
  5741 00002692 B609                    	mov	dh, 9
  5742 00002694 B217                    	mov	dl, 23
  5743 00002696 E8D2FEFFFF              	call	setCursorPosition
  5744                                  	;movzx	eax, word [WAVE_SampleRate]
  5745                                  	; 22/12/2024
  5746                                  	; eax = 0
  5747 0000269B 66A1[F47E0000]          	mov	ax, [WAVE_SampleRate]
  5748 000026A1 BD05000000              	mov	ebp, 5
  5749 000026A6 E82BFFFFFF              	call	PrintNumber
  5750                                  
  5751                                  	;; Print BitRate
  5752                                  	;mov	dh, 9
  5753                                  	; 21/12/2024 (640*480 graphics display)
  5754 000026AB B608                    	mov	dh, 8
  5755 000026AD B239                    	mov	dl, 57
  5756 000026AF E8B9FEFFFF              	call	setCursorPosition
  5757 000026B4 66A1[FE7E0000]          	mov	ax, [WAVE_BitsPerSample]
  5758 000026BA 66BD0200                	mov	bp, 2
  5759 000026BE E813FFFFFF              	call	PrintNumber
  5760                                  
  5761                                  	;; Print Channel Number
  5762                                  	;mov	dh, 10
  5763                                  	; 21/12/2024 (640*480 graphics display)
  5764 000026C3 B609                    	mov	dh, 9
  5765 000026C5 B239                    	mov	dl, 57
  5766 000026C7 E8A1FEFFFF              	call	setCursorPosition
  5767 000026CC 66A1[F27E0000]          	mov	ax, [WAVE_NumChannels]
  5768 000026D2 66BD0100                	mov	bp, 1
  5769 000026D6 E8FBFEFFFF              	call	PrintNumber
  5770                                  
  5771                                  	;call	UpdateVolume
  5772                                  	;retn
  5773                                  
  5774                                  ; --------------------------------------------------------
  5775                                  
  5776                                  	; 14/11/2024
  5777                                  UpdateVolume:
  5778                                  	;; Print Volume
  5779                                  	;mov	dh, 24
  5780                                  	; 21/12/2024 (640*480)
  5781 000026DB B620                    	mov	dh, 32
  5782 000026DD B24B                    	mov	dl, 75
  5783 000026DF E889FEFFFF              	call	setCursorPosition
  5784                                  	; 22/12/2024
  5785                                  	; eax = 0
  5786                                  
  5787 000026E4 A0[6C250000]            	mov	al, [volume]
  5788                                  
  5789 000026E9 B364                    	mov	bl, 100
  5790 000026EB F6E3                    	mul	bl
  5791                                  
  5792 000026ED B31F                    	mov	bl, 31
  5793 000026EF F6F3                    	div	bl
  5794                                  
  5795                                  	;neg	ax
  5796                                  	;add	ax, 100	
  5797                                  	; 01/12/2024
  5798 000026F1 B464                    	mov	ah, 100
  5799 000026F3 28C4                    	sub	ah, al
  5800 000026F5 0FB6C4                  	movzx	eax, ah
  5801                                  	;xor	ah, ah
  5802                                  	;mov	bp, 3
  5803 000026F8 BD03000000              	mov	ebp, 3
  5804                                  	;call	PrintNumber
  5805                                  	;retn
  5806 000026FD E9D4FEFFFF              	jmp	PrintNumber	
  5807                                  
  5808                                  ; --------------------------------------------------------
  5809                                  
  5810                                  	; 21/12/2024
  5811                                  	; write text in VESA VBE graphics mode
  5812                                  PrintString:
  5813                                  	; esi = string address
  5814                                  printstr_loop:
  5815 00002702 31C0                    	xor	eax, eax
  5816 00002704 AC                      	lodsb
  5817 00002705 08C0                    	or	al, al
  5818 00002707 7417                    	jz	short printstr_ok
  5819                                  
  5820 00002709 56                      	push	esi
  5821                                  
  5822 0000270A 8B35[BC740000]          	mov	esi, [screenpos]
  5823                                  
  5824                                  	; esi = pixel position (hw = row, si = column)
  5825                                  	; eax = al = character
  5826                                  	;call	write_character
  5827                                  	; 22/12/2024
  5828 00002710 E80C000000              	call	write_character_white
  5829                                  
  5830 00002715 668305[BC740000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5831                                  
  5832 0000271D 5E                      	pop	esi
  5833 0000271E EBE2                    	jmp	short printstr_loop
  5834                                  
  5835                                  printstr_ok:
  5836 00002720 C3                      	retn
  5837                                  
  5838                                  ; --------------------------------------------------------
  5839                                  
  5840                                  	; 21/12/2024
  5841                                  	; write character (at cursor position)
  5842                                  	; in graphics mode (640*480, 256 colors)
  5843                                  	; 22/12/2024
  5844                                  write_character_white:
  5845 00002721 B90F000000              	mov	ecx, 0Fh
  5846                                  	; 26/12/2024
  5847                                  	;movzx	ecx, byte [tcolor]
  5848                                  write_character:
  5849                                  	; esi = pixel position (hw = row, si = column)
  5850                                  	; eax = al = character
  5851                                  	; cl = color
  5852 00002726 890D[C0740000]          	mov	[wcolor], ecx ; 22/12/2024
  5853                                  
  5854                                  	; 22/12/2024
  5855 0000272C 50                      	push	eax
  5856                                  	; clear previous character pixels
  5857 0000272D BF[55410000]            	mov	edi, fillblock
  5858                                  	sys	_video, 020Fh, 0, 8001h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00002732 BB0F020000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00002737 B900000000          <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000273C BA01800000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00002741 B81F000000          <1>  mov eax, %1
   100                              <1> 
   101 00002746 CD40                <1>  int 40h
  5859 00002748 58                      	pop	eax
  5860                                  
  5861 00002749 C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5862 0000274C BF[704F0000]            	mov	edi, fontbuff2 ; start of user font data
  5863 00002751 01C7                    	add	edi, eax
  5864                                  
  5865                                  	; 21/12/2024
  5866                                  	; NOTE:
  5867                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5868                                  	; system calls -in graphics mode-
  5869                                  	; because 8*16 pixel operations are faster
  5870                                  	;			than 8*14 pixel operations.
  5871                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5872                                  	; adding 2 empty lines))
  5873                                  	; (8*14 characters can be written via pixel operations)
  5874                                    	
  5875                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5876                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5877                                  	;sysvideo:
  5878                                  	;   function in BH
  5879                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5880                                  	;   sub function in BL
  5881                                  	;	0Fh: WRITE CHARACTER (FONT)
  5882                                  	;          CL = char's color (8 bit, 256 colors)
  5883                                  	;	If DH bit 7 = 1
  5884                                  	;	   USER FONT (from user buffer)
  5885                                  	;	         DL = 1 -> 8x16 pixel font
  5886                                   	;	   EDI = user's font buffer address
  5887                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5888                                  	;	   ESI = start position (row, column)
  5889                                  	;		(HW = row, SI = column)
  5890                                  	;;;;;;;;;;;;;;;;;
  5891                                  
  5892                                  	sys	_video, 020Fh, [wcolor], 8001h
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00002753 BB0F020000          <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93 00002758 8B0D[C0740000]      <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95 0000275E BA01800000          <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 00002763 B81F000000          <1>  mov eax, %1
   100                              <1> 
   101 00002768 CD40                <1>  int 40h
  5893                                  
  5894 0000276A C3                      	retn
  5895                                  
  5896                                  ; --------------------------------------------------------
  5897                                  
  5898                                  	; 22/12/2024
  5899                                  	; 21/12/2024
  5900                                  	; (write chars in VESA VBE graphics mode)
  5901                                  	; 14/11/2024
  5902                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5903                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5904                                  
  5905                                  	;PROGRESSBAR_ROW equ 23
  5906                                  	; 21/12/2024 (640*480)
  5907                                  	PROGRESSBAR_ROW equ 31
  5908                                  
  5909                                  UpdateProgressBar:
  5910 0000276B E890FEFFFF              	call	SetProgressTime	; 14/11/2024
  5911                                  
  5912                                  	; 01/12/2024 (32bit registers)
  5913 00002770 A1[8C7F0000]            	mov	eax, [ProgressTime]
  5914                                  UpdateProgressBar@:
  5915 00002775 BA50000000              	mov	edx, 80
  5916 0000277A F7E2                    	mul	edx
  5917 0000277C 8B1D[887F0000]          	mov	ebx, [TotalTime]
  5918 00002782 F7F3                    	div	ebx
  5919                                  
  5920                                  	; 22/12/2024
  5921                                  	; check progress bar indicator position if it is same 
  5922 00002784 3A05[C5740000]          	cmp	al, [pbprev]
  5923 0000278A 7430                    	je	short UpdateProgressBar_ok
  5924 0000278C A2[C5740000]            	mov	[pbprev], al
  5925                                  
  5926                                  UpdateProgressBar@@:
  5927                                  	;; Push for the 'Clean' part
  5928 00002791 50                      	push	eax ; **
  5929 00002792 50                      	push	eax ; *
  5930                                  
  5931                                  	;; Set cursor position
  5932 00002793 B61F                    	mov	dh, PROGRESSBAR_ROW
  5933 00002795 B200                    	mov	dl, 0
  5934 00002797 E8D1FDFFFF              	call	setCursorPosition
  5935                                  
  5936 0000279C 58                      	pop	eax ; *
  5937 0000279D 09C0                    	or	eax, eax
  5938 0000279F 742D                    	jz	short UpdateProgressBar_Clean
  5939                                  
  5940                                  UpdateProgressBar_DrawProgress:
  5941                                  	; 22/12/2024
  5942                                  	; 21/12/2024
  5943                                  	; (write progress bar chars in graphics mode)
  5944                                  	;;;;
  5945 000027A1 89C5                    	mov	ebp, eax
  5946 000027A3 50                      	push	eax ; ***
  5947 000027A4 8B35[BC740000]          	mov	esi, [screenpos]
  5948                                  UpdateProgressBar_DrawProgress_@:
  5949 000027AA B8DF000000              	mov	eax, 223
  5950                                  	
  5951                                  	; esi = pixel position (hw = row, si = column)
  5952                                  	; eax = al = character
  5953                                  	;call	write_character
  5954                                  	; 22/12/2024
  5955 000027AF E86DFFFFFF              	call	write_character_white
  5956                                  
  5957 000027B4 4D                      	dec	ebp
  5958 000027B5 7406                    	jz	short UpdateProgressBar_DrawCursor
  5959                                  
  5960 000027B7 83C608                  	add	esi, 8 ; next column
  5961 000027BA EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5962                                  	;;;
  5963                                  
  5964                                  UpdateProgressBar_ok:
  5965 000027BC C3                      	retn
  5966                                  
  5967                                  UpdateProgressBar_DrawCursor:
  5968                                  	; 22/12/2024
  5969 000027BD 5A                      	pop	edx ; ***
  5970 000027BE B61F                    	mov	dh, PROGRESSBAR_ROW
  5971 000027C0 E8A8FDFFFF              	call	setCursorPosition
  5972                                  
  5973                                  	; 21/12/2024
  5974                                  	; (write progress bar character in graphics mode)
  5975                                  	;;;;
  5976                                  	;;;mov	eax, 223
  5977                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5978                                  	;;mov	eax, 223*16
  5979                                  	;;mov	edi, fontbuff2 ; start of user font data
  5980                                  	;;add	edi, eax
  5981                                  	;mov	edi, fontbuff2+(223*16)
  5982                                  	;
  5983                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5984                                  	; 22/12/2024
  5985                                  	;mov	eax, 223
  5986                                  	; eax = 0
  5987 000027C5 B0DF                    	mov	al, 223
  5988 000027C7 B10C                    	mov	cl, 0Ch ; red
  5989 000027C9 E858FFFFFF              	call	write_character
  5990                                  	;;;;
  5991                                  
  5992                                  UpdateProgressBar_Clean:
  5993                                  	;pop	eax  ; **
  5994                                  	; 22/12/2024
  5995 000027CE 5A                      	pop	edx  ; **
  5996                                  	; 21/12/2024
  5997 000027CF BD50000000              	mov	ebp, 80
  5998                                  	;sub	bp, ax
  5999 000027D4 6629D5                  	sub	bp, dx ; 22/12/2024
  6000 000027D7 74E3                    	jz	short UpdateProgressBar_ok
  6001                                  
  6002 000027D9 B61F                    	mov	dh, PROGRESSBAR_ROW
  6003                                  	;mov	dl, al ; 22/12/2024
  6004 000027DB E88DFDFFFF              	call	setCursorPosition
  6005                                  
  6006                                  	; 21/12/2024
  6007                                  	; (write progress bar chars in graphics mode)
  6008                                  	;;;;
  6009 000027E0 8B35[BC740000]          	mov	esi, [screenpos]
  6010                                  UpdateProgressBar_Clean_@:
  6011                                  	;;;mov	eax, 223
  6012                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  6013                                  	;;mov	eax, 223*16
  6014                                  	;mov	edi, fontbuff2 ; start of user font data
  6015                                  	;add	edi, eax
  6016                                  	;mov	edi, fontbuff2+(223*16)
  6017                                  	;
  6018                                  	;sys	_video, 020Fh, 08h, 8001h
  6019                                  	; 22/12/2024
  6020                                  	;mov	eax, 223
  6021                                  	; eax = 0
  6022 000027E6 B0DF                    	mov	al, 223
  6023 000027E8 B108                    	mov	cl, 08h ; gray (dark)
  6024 000027EA E837FFFFFF              	call	write_character
  6025                                  	;;;;
  6026                                  
  6027 000027EF 4D                      	dec	ebp
  6028 000027F0 74CA                    	jz	short UpdateProgressBar_ok
  6029                                  
  6030 000027F2 83C608                  	add	esi, 8 ; next column
  6031 000027F5 EBEF                    	jmp	short UpdateProgressBar_Clean_@
  6032                                  	;;;;
  6033                                  
  6034                                  ; --------------------------------------------------------
  6035                                  ; 17/11/2024
  6036                                  
  6037                                  Player_ProcessKey_Backwards:
  6038                                  	;; In order to go backwards 5 seconds:
  6039                                  	;; Update file pointer to the beginning, skip headers
  6040 000027F7 B142                    	mov	cl, 'B'
  6041 000027F9 EB02                    	jmp	short Player_ProcessKey_B_or_F
  6042                                  
  6043                                  Player_ProcessKey_Forwards:
  6044                                  	;; In order to fast-forward 5 seconds, set the file pointer
  6045                                  	;; to CUR_SEEK + 5 * Freq
  6046                                  
  6047 000027FB B146                    	mov	cl, 'F'
  6048                                  	;jmp	short Player_ProcessKey_B_or_F
  6049                                  
  6050                                  	; 01/12/2024 (32bit regsisters)
  6051                                  Player_ProcessKey_B_or_F:
  6052                                  	; 17/11/2024
  6053                                  	; 04/11/2024
  6054                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  6055                                    
  6056                                  	; 04/11/2024
  6057 000027FD B805000000              	mov	eax, 5
  6058 00002802 0FB71D[FC7E0000]        	movzx	ebx, word [WAVE_BlockAlign]
  6059 00002809 F7E3                    	mul	ebx
  6060 0000280B 668B1D[F47E0000]        	mov	bx, [WAVE_SampleRate]
  6061 00002812 F7E3                    	mul	ebx
  6062                                  	; eax = transfer byte count for 5 seconds
  6063                                  	
  6064                                  	; 17/11/2024
  6065 00002814 80F942                  	cmp	cl, 'B'
  6066                                  	;mov	bx, [LoadedDataBytes]
  6067                                  	;mov	cx, [LoadedDataBytes+2]
  6068                                  	; 01/12/2024
  6069 00002817 8B0D[947F0000]          	mov	ecx, [LoadedDataBytes]
  6070 0000281D 7508                    	jne	short move_forward ; cl = 'F'
  6071                                  move_backward:
  6072                                  	;sub	bx, ax
  6073                                  	;sbb	cx, dx
  6074 0000281F 29C1                    	sub	ecx, eax
  6075 00002821 7316                    	jnc	short move_file_pointer
  6076                                  move_to_beginning:
  6077                                  	;xor	cx, cx ; 0
  6078                                  	;xor	bx, bx ; 0
  6079 00002823 31C9                    	xor	ecx, ecx
  6080 00002825 EB12                    	jmp	short move_file_pointer
  6081                                  move_forward: 
  6082                                  	;add	bx, ax
  6083                                  	;adc	cx, dx
  6084 00002827 01C1                    	add	ecx, eax
  6085 00002829 7208                    	jc	short move_to_end
  6086                                  	;cmp	cx, [DATA_SubchunkSize+2]
  6087                                  	;ja	short move_to_end
  6088                                  	;jb	short move_file_pointer
  6089                                  	;cmp	bx, [DATA_SubchunkSize]
  6090                                  	;jna	short move_file_pointer
  6091 0000282B 3B0D[047F0000]          	cmp	ecx, [DATA_SubchunkSize]
  6092 00002831 7606                    	jna	short move_file_pointer
  6093                                  move_to_end:
  6094                                  	;mov	bx, [DATA_SubchunkSize]
  6095                                  	;mov	cx, [DATA_SubchunkSize+2]
  6096 00002833 8B0D[047F0000]          	mov	ecx, [DATA_SubchunkSize]
  6097                                  move_file_pointer:
  6098                                  	;mov	dx, bx    
  6099                                  	;mov	[LoadedDataBytes], dx
  6100                                  	;mov	[LoadedDataBytes+2], cx
  6101 00002839 890D[947F0000]          	mov	[LoadedDataBytes], ecx
  6102                                  	;add	dx, 44 ; + header
  6103                                  	;adc	cx, 0
  6104 0000283F 83C12C                  	add	ecx, 44 
  6105                                  
  6106                                  	; seek
  6107                                  	;mov	bx, [filehandle]
  6108                                  	;mov	ax, 4200h
  6109                                  	;int	21h
  6110                                  	; 01/12/2024
  6111 00002842 31D2                    	xor	edx, edx ; offset from beginning of the file
  6112                                  	; ecx = offset	
  6113                                  	; ebx = file handle
  6114                                  	; edx = 0
  6115                                  	sys	_seek, [filehandle]
    86                              <1> 
    87                              <1> 
    88                              <1> 
    89                              <1> 
    90                              <1>  %if %0 >= 2
    91 00002844 8B1D[0C7F0000]      <1>  mov ebx, %2
    92                              <1>  %if %0 >= 3
    93                              <1>  mov ecx, %3
    94                              <1>  %if %0 = 4
    95                              <1>  mov edx, %4
    96                              <1>  %endif
    97                              <1>  %endif
    98                              <1>  %endif
    99 0000284A B813000000          <1>  mov eax, %1
   100                              <1> 
   101 0000284F CD40                <1>  int 40h
  6116 00002851 C3                      	retn
  6117                                  
  6118                                  ; --------------------------------------------------------
  6119                                  
  6120                                  	; 25/12/2024
  6121                                  	; 22/12/2024 (VESA VBE mode graphics) 
  6122                                  	; (640*480, 256 colors)
  6123                                  clear_window:
  6124 00002852 8B3D[B8740000]          	mov	edi, [LFB_ADDR]
  6125                                  	;add	edi, (13*80*8*14)
  6126                                  	; 25/12/2024
  6127 00002858 81C7009A0100            	add	edi, 164*640
  6128 0000285E 29C0                    	sub	eax, eax
  6129                                  	;mov	ecx, (16*640*14)/4 ; 16 rows
  6130 00002860 B900A00000              	mov	ecx, 64*640 ; 256 volume level points
  6131 00002865 F3AB                    	rep	stosd
  6132                                  	; 24/12/2024
  6133 00002867 A3[C8740000]            	mov	[prev_points], eax ; 0
  6134                                  	;
  6135 0000286C C3                      	retn
  6136                                  
  6137                                  ; --------------------------------------------------------
  6138                                  
  6139                                  	; 22/12/2024
  6140                                  	; 21/12/2024
  6141                                  	; (simulate wave leds in graphics mode)
  6142                                  	; (640*480, 256 colors)
  6143                                  reset_wave_leds:
  6144                                  	; 22/12/2024
  6145 0000286D C705[70730000]0000-     	mov	dword [prev_leds], 0
  6145 00002875 0000               
  6146                                  	;
  6147 00002877 BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  6148 0000287C BE[705F0000]            	mov	esi, wleds_addr
  6149                                  next_led:
  6150 00002881 AD                      	lodsd
  6151 00002882 89C7                    	mov	edi, eax
  6152 00002884 BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  6153 00002889 BB[505F0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6154                                  led_line:
  6155 0000288E 8A23                    	mov	ah, [ebx]
  6156 00002890 B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  6157                                  next_pixel:
  6158 00002895 D0E4                    	shl	ah, 1
  6159 00002897 7308                    	jnc	short skip_this
  6160 00002899 B008                    	mov	al, 8 ; gray
  6161 0000289B AA                      	stosb
  6162 0000289C 49                      	dec	ecx
  6163 0000289D 75F6                    	jnz	short next_pixel
  6164 0000289F EB06                    	jmp	short next_line
  6165                                  skip_this:
  6166 000028A1 B000                    	mov	al, 0 ; black
  6167 000028A3 AA                      	stosb
  6168 000028A4 49                      	dec	ecx
  6169 000028A5 75EE                    	jnz	short next_pixel
  6170                                  next_line:
  6171 000028A7 4A                      	dec	edx
  6172 000028A8 7504                    	jnz	short next_line_@
  6173 000028AA 4D                      	dec	ebp
  6174 000028AB 75D4                    	jnz	short next_led
  6175                                  	;clc	; 25/12/2024
  6176 000028AD C3                      	retn
  6177                                  next_line_@:
  6178                                  	; 22/12/2024
  6179 000028AE 81C778020000            	add	edi, 640-8 ; next line
  6180 000028B4 43                      	inc	ebx
  6181 000028B5 EBD7                    	jmp	short led_line	
  6182                                  
  6183                                  ; --------------------------------------------------------
  6184                                  
  6185                                  	; 22/12/2024 (graphics mode)
  6186                                  	; 09/12/2024
  6187                                  	; 19/11/2024
  6188                                  UpdateWaveLeds:
  6189                                  	; 23/11/2024
  6190                                  	;call	reset_wave_leds
  6191                                  	; 22/12/2024 (faster method, 80 against 80*16)
  6192                                  	; turn off previously lighting wave leds at first
  6193                                  	;;;
  6194 000028B7 BE[70730000]            	mov	esi, prev_leds
  6195 000028BC 833E00                  	cmp	dword [esi], 0
  6196 000028BF 7433                    	jz	short UpdateWaveLeds_ok
  6197 000028C1 B950000000              	mov	ecx, 80
  6198                                  turn_off_led:
  6199 000028C6 AD                      	lodsd
  6200 000028C7 89C7                    	mov	edi, eax
  6201                                  	; edi = wave led address
  6202 000028C9 BD0E000000              	mov	ebp, 14
  6203 000028CE BB[505F0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6204 000028D3 31D2                    	xor	edx, edx
  6205 000028D5 B008                    	mov	al, 8 ; gray (dark)
  6206                                  toffl_next_line:
  6207                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6208                                  	;mov	dl, 8
  6209 000028D7 88C2                    	mov	dl, al ; 8
  6210 000028D9 8A23                    	mov	ah, [ebx]
  6211                                  toffl_next_pixel:
  6212 000028DB D0E4                    	shl	ah, 1
  6213 000028DD 7310                    	jnc	short toffl_skip_this
  6214 000028DF AA                      	stosb
  6215                                  toffl_next_pixel_@:
  6216 000028E0 4A                      	dec	edx
  6217 000028E1 75F8                    	jnz	short toffl_next_pixel
  6218 000028E3 4D                      	dec	ebp
  6219 000028E4 740C                    	jz	short toffl_next_led
  6220 000028E6 81C778020000            	add	edi, 640-8 ; next line
  6221 000028EC 43                      	inc	ebx
  6222 000028ED EBE8                    	jmp	short toffl_next_line
  6223                                  toffl_skip_this:
  6224 000028EF 47                      	inc	edi
  6225 000028F0 EBEE                    	jmp	short toffl_next_pixel_@
  6226                                  toffl_next_led:
  6227 000028F2 E2D2                    	loop	turn_off_led
  6228                                  UpdateWaveLeds_ok:
  6229                                  	;;;
  6230                                  	; 09/12/2024
  6231                                  	;jmp	short turn_on_leds
  6232                                  
  6233                                  ; --------------------------------------------------------
  6234                                  
  6235                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  6236                                  	; 09/12/2024
  6237                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  6238                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  6239                                  	; 21/11/2024, 22/11/2024
  6240                                  	; 19/11/2024
  6241                                  turn_on_leds:
  6242                                  	; 09/12/2024
  6243                                  	; 07/12/2024
  6244 000028F4 8A15[D57E0000]          	mov	dl, [half_buffer]
  6245                                  tol_@:
  6246                                  	; 07/12/2024
  6247 000028FA 3815[D47E0000]          	cmp	[pbuf_s], dl
  6248 00002900 7520                    	jne	short tol_ns_buf
  6249 00002902 8B1D[CC7E0000]          	mov	ebx, [wleds_dif]
  6250 00002908 8B35[D07E0000]          	mov	esi, [pbuf_o]
  6251 0000290E 8B0D[847F0000]          	mov	ecx, [buffersize] ; bytes
  6252 00002914 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  6253 00002916 01DE                    	add	esi, ebx
  6254 00002918 7204                    	jc	short tol_o_@
  6255 0000291A 39CE                    	cmp	esi, ecx
  6256 0000291C 760C                    	jna	short tol_s_buf
  6257                                  tol_o_@:
  6258 0000291E 89CE                    	mov	esi, ecx
  6259 00002920 EB08                    	jmp	short tol_s_buf
  6260                                  
  6261                                  tol_ns_buf:
  6262 00002922 8815[D47E0000]          	mov	[pbuf_s], dl
  6263 00002928 31F6                    	xor	esi, esi ; 0
  6264                                  tol_s_buf:
  6265 0000292A 8935[D07E0000]          	mov	[pbuf_o], esi
  6266                                  
  6267                                  tol_buf_@:
  6268                                  	; 07/12/2024
  6269 00002930 81C6[00800000]          	add	esi, audio_buffer
  6270 00002936 B950000000              	mov	ecx, 80
  6271                                  	;xor	eax, eax ; 0
  6272 0000293B BB[705F0000]            	mov	ebx, wleds_addr
  6273                                  	; 22/12/2024
  6274 00002940 BF[70730000]            	mov	edi, prev_leds
  6275                                  tol_fill_c:
  6276 00002945 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  6277 00002947 66AD                    	lodsw	; left
  6278 00002949 80C480                  	add	ah, 80h	; 24/12/2024
  6279 0000294C 89C2                    	mov	edx, eax
  6280 0000294E 66AD                    	lodsw	; right
  6281                                  	;add	ax, dx
  6282 00002950 80C480                  	add	ah, 80h
  6283                                  	;; 21/12/2024 (16 volume levels)
  6284                                  	;shr	eax, 12
  6285                                  	; 24/12/2024
  6286 00002953 01D0                    	add	eax, edx
  6287 00002955 C1E80D                  	shr	eax, 13	; (L+R/2) & 16 volume levels
  6288                                  
  6289 00002958 53                      	push	ebx ; *
  6290                                  	; 01/12/2024
  6291 00002959 C1E002                  	shl	eax, 2
  6292 0000295C 01C3                    	add	ebx, eax
  6293                                  	; 01/12/2024 (32bit address)
  6294                                  	;mov	edi, [ebx]
  6295                                  	; 22/12/2024
  6296 0000295E 8B03                    	mov	eax, [ebx]
  6297 00002960 AB                      	stosd
  6298 00002961 57                      	push	edi ; **
  6299 00002962 89C7                    	mov	edi, eax
  6300                                  	;;;
  6301                                  	; 21/12/2024
  6302                                  	; (simulate wave leds in graphics mode)
  6303                                  	; (640*480, 256 colors)
  6304                                  turn_on_led:
  6305                                  	; edi = wave led address
  6306 00002964 BD0E000000              	mov	ebp, 14
  6307 00002969 BB[505F0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  6308 0000296E A0[6D410000]            	mov	al, [ccolor]
  6309                                  tol_next_line:
  6310 00002973 BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  6311 00002978 8A23                    	mov	ah, [ebx]
  6312                                  tol_next_pixel:
  6313 0000297A D0E4                    	shl	ah, 1
  6314 0000297C 7310                    	jnc	short tol_skip_this
  6315 0000297E AA                      	stosb
  6316                                  tol_next_pixel_@:
  6317 0000297F 4A                      	dec	edx
  6318 00002980 75F8                    	jnz	short tol_next_pixel
  6319 00002982 4D                      	dec	ebp
  6320 00002983 740C                    	jz	short tol_next_led
  6321                                  	; 22/12/2024
  6322 00002985 81C778020000            	add	edi, 640-8 ; next line
  6323 0000298B 43                      	inc	ebx
  6324 0000298C EBE5                    	jmp	short tol_next_line
  6325                                  tol_skip_this:
  6326 0000298E 47                      	inc	edi
  6327 0000298F EBEE                    	jmp	short tol_next_pixel_@
  6328                                  tol_next_led:
  6329                                  	; 22/12/2024
  6330 00002991 5F                      	pop	edi ; **
  6331                                  	;;;
  6332 00002992 5B                      	pop	ebx ; *
  6333 00002993 83C340                  	add	ebx, 16*4
  6334 00002996 E2AD                    	loop	tol_fill_c
  6335                                  
  6336 00002998 C3                      	retn
  6337                                  
  6338                                  ; -------------------------------------------------------------
  6339                                  
  6340                                  ; -------------------------------------------------------------
  6341                                  ; ac97.inc (11/11/2023)
  6342                                  ; -------------------------------------------------------------
  6343                                  
  6344                                  ; special characters
  6345                                  LF      EQU 10
  6346                                  CR      EQU 13
  6347                                  
  6348                                  ; PCI stuff
  6349                                  
  6350                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  6351                                  
  6352                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  6353                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6354                                  SIS_VID		equ	1039h
  6355                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  6356                                  AMD_VID		equ	1022h
  6357                                  
  6358                                  ICH_DID         equ     2415h           ; ICH device ID
  6359                                  ICH0_DID        equ     2425h           ; ICH0
  6360                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  6361                                                                          ; they all should be compatible.
  6362                                  
  6363                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  6364                                  ICH3_DID	equ     2485h           ; ICH3
  6365                                  ICH4_DID        equ     24C5h           ; ICH4
  6366                                  ICH5_DID	equ     24D5h           ; ICH5
  6367                                  ICH6_DID	equ     266Eh           ; ICH6
  6368                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  6369                                  ESB631X_DID	equ     2698h           ; 631XESB
  6370                                  ICH7_DID	equ	27DEh		; ICH7
  6371                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  6372                                  MX82440_DID	equ	7195h
  6373                                  SI7012_DID	equ	7012h
  6374                                  NFORCE_DID	equ	01B1h
  6375                                  NFORCE2_DID	equ	006Ah
  6376                                  AMD8111_DID	equ	746Dh
  6377                                  AMD768_DID	equ	7445h
  6378                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  6379                                  CK804_DID	equ	0059h
  6380                                  MCP04_DID	equ	003Ah
  6381                                  CK8_DID		equ	008Ah
  6382                                  NFORCE3_DID	equ	00DAh
  6383                                  CK8S_DID	equ	00EAh
  6384                                  
  6385                                  ; -------------------------------------------------------------
  6386                                  
  6387                                  ; 22/12/2024
  6388 00002999 90<rep 3h>              align 4
  6389                                  
  6390                                  ; 13/11/2024
  6391                                  ; ('<<' to 'shl' conversion for FASM)
  6392                                  ;
  6393                                  ; 29/05/2024 (TRDOS 386)
  6394                                  ; 17/02/2017
  6395                                  ; Valid ICH device IDs
  6396                                  
  6397                                  valid_ids:
  6398                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  6399 0000299C 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  6400 000029A0 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  6401 000029A4 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  6402 000029A8 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  6403 000029AC 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  6404 000029B0 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  6405 000029B4 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  6406 000029B8 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  6407 000029BC 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  6408 000029C0 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  6409                                  	; 03/11/2023 - Erdogan Tan
  6410 000029C4 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  6411 000029C8 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  6412 000029CC DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  6413 000029D0 DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  6414 000029D4 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  6415 000029D8 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  6416 000029DC DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  6417 000029E0 DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  6418 000029E4 DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  6419 000029E8 DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  6420 000029EC DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  6421                                  
  6422                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  6423                                  ; 13/11/2024
  6424                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  6425                                  
  6426 000029F0 00000000                	dd 0
  6427                                  
  6428                                  Credits:
  6429 000029F4 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  6429 000029FD 6C6179657220666F72-
  6429 00002A06 205452444F53203338-
  6429 00002A0F 36206279204572646F-
  6429 00002A18 67616E2054616E2E20 
  6430                                  	;db 'December 2024.', 10,13,0
  6431 00002A21 4A616E756172792032-     	db 'January 2025.', 10,13,0
  6431 00002A2A 3032352E0A0D00     
  6432                                  	;db '27/12/2024', 10,13
  6433 00002A31 31382F30312F323032-     	db '18/01/2025', 10,13
  6433 00002A3A 350A0D             
  6434                                  ; 15/11/2024
  6435                                  reset:
  6436 00002A3D 00                      	db 0
  6437                                  
  6438                                  msgAudioCardInfo:
  6439 00002A3E 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  6439 00002A47 204143393720284943-
  6439 00002A50 482920417564696F20-
  6439 00002A59 436F6E74726F6C6C65-
  6439 00002A62 722E0A0D00         
  6440                                  
  6441                                  	; 27/12/2024
  6442                                  msg_usage:
  6443 00002A67 75736167653A205647-     	db 'usage: VGAPLAY2 <FileName1> <FileName2> <...>',10,13,0
  6443 00002A70 41504C415932203C46-
  6443 00002A79 696C654E616D65313E-
  6443 00002A82 203C46696C654E616D-
  6443 00002A8B 65323E203C2E2E2E3E-
  6443 00002A94 0A0D00             
  6444                                  
  6445                                  noDevMsg:
  6446 00002A97 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  6446 00002AA0 61626C6520746F2066-
  6446 00002AA9 696E64204143393720-
  6446 00002AB2 617564696F20646576-
  6446 00002ABB 69636521           
  6447 00002ABF 0A0D00                  	db 10,13,0
  6448                                  
  6449                                  noFileErrMsg:
  6450 00002AC2 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  6450 00002ACB 6C65206E6F7420666F-
  6450 00002AD4 756E642E0A0D00     
  6451                                  
  6452                                  ; 07/12/2024
  6453                                  trdos386_err_msg:
  6454 00002ADB 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  6454 00002AE4 2053797374656D2063-
  6454 00002AED 616C6C206572726F72-
  6454 00002AF6 20210A0D00         
  6455                                  
  6456                                  ; 29/05/2024
  6457                                  ; 11/11/2023
  6458                                  msg_init_err:
  6459 00002AFB 0D0A                    	db CR, LF
  6460 00002AFD 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6460 00002B06 726F6C6C65722F436F-
  6460 00002B0F 64656320696E697469-
  6460 00002B18 616C697A6174696F6E-
  6460 00002B21 206572726F722021   
  6461 00002B29 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6462                                  
  6463                                  ; 25/11/2023
  6464                                  msg_no_vra:
  6465 00002B2C 0A0D                    	db 10,13
  6466 00002B2E 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6466 00002B37 70706F72742021204F-
  6466 00002B40 6E6C79203438206B48-
  6466 00002B49 5A2073616D706C6520-
  6466 00002B52 726174652073757070-
  6466 00002B5B 6F727465642021     
  6467 00002B62 0A0D00                  	db 10,13,0
  6468                                  
  6469                                  ; 19/11/2024
  6470                                  ; 03/06/2017
  6471                                  hex_chars:
  6472 00002B65 303132333435363738-     	db '0123456789ABCDEF', 0
  6472 00002B6E 3941424344454600   
  6473                                  msgAC97Info:
  6474 00002B76 0D0A                    	db 0Dh, 0Ah
  6475 00002B78 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6475 00002B81 696F20436F6E74726F-
  6475 00002B8A 6C6C6572202620436F-
  6475 00002B93 64656320496E666F0D-
  6475 00002B9C 0A                 
  6476 00002B9D 2056656E646F722049-     	db ' Vendor ID: '
  6476 00002BA6 443A20             
  6477                                  msgVendorId:
  6478 00002BA9 303030306820446576-     	db '0000h Device ID: '
  6478 00002BB2 6963652049443A20   
  6479                                  msgDevId:
  6480 00002BBA 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6481 00002BC1 204275733A20            	db ' Bus: '
  6482                                  msgBusNo:
  6483 00002BC7 303068204465766963-     	db '00h Device: '
  6483 00002BD0 653A20             
  6484                                  msgDevNo:
  6485 00002BD3 3030682046756E6374-     	db '00h Function: '
  6485 00002BDC 696F6E3A20         
  6486                                  msgFncNo:
  6487 00002BE1 303068                  	db '00h'
  6488 00002BE4 0D0A                    	db 0Dh, 0Ah
  6489 00002BE6 204E414D4241523A20      	db ' NAMBAR: '
  6490                                  msgNamBar:
  6491 00002BEF 30303030682020          	db '0000h  '
  6492 00002BF6 4E41424D4241523A20      	db 'NABMBAR: '
  6493                                  msgNabmBar:
  6494 00002BFF 303030306820204952-     	db '0000h  IRQ: '
  6494 00002C08 513A20             
  6495                                  msgIRQ:
  6496 00002C0B 3030                    	dw 3030h
  6497 00002C0D 0D0A00                  	db 0Dh, 0Ah, 0
  6498                                  ; 25/11/2023
  6499                                  msgVRAheader:
  6500 00002C10 205652412073757070-     	db ' VRA support: '
  6500 00002C19 6F72743A20         
  6501 00002C1E 00                      	db 0	
  6502                                  msgVRAyes:
  6503 00002C1F 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6504                                  msgVRAno:
  6505 00002C25 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6506 00002C2A 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6506 00002C33 6C617465642073616D-
  6506 00002C3C 706C65207261746520-
  6506 00002C45 706C6179696E67206D-
  6506 00002C4E 6574686F6429       
  6507 00002C54 0D0A00                  	db 0Dh, 0Ah, 0
  6508                                  
  6509 00002C57 90                      align 4
  6510                                  
  6511                                  ; -------------------------------------------------------------
  6512                                  
  6513                                  	; 21/12/2024
  6514                                  SplashScreen:
  6515 00002C58 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6515 00002C61 202020202020202020-
  6515 00002C6A 202020202020202020-
  6515 00002C73 202020202020202020-
  6515 00002C7C 202020202020202020-
  6515 00002C85 202020202020202020-
  6515 00002C8E 202020202020202020-
  6515 00002C97 202020202020202020-
  6515 00002CA0 2020202020DDDBDE   
  6516 00002CA8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6516 00002CB1 202020202020202020-
  6516 00002CBA 202020202020202020-
  6516 00002CC3 202020202020202020-
  6516 00002CCC 202020202020202020-
  6516 00002CD5 202020202020202020-
  6516 00002CDE 202020202020202020-
  6516 00002CE7 202020202020202020-
  6516 00002CF0 2020202020DDDBDE   
  6517 00002CF8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6517 00002D01 202020202020202020-
  6517 00002D0A 202020202020202020-
  6517 00002D13 202020202020202020-
  6517 00002D1C 202020202020202020-
  6517 00002D25 202020202020202020-
  6517 00002D2E 202020202020202020-
  6517 00002D37 202020202020202020-
  6517 00002D40 2020202020DDDBDE   
  6518 00002D48 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6518 00002D51 202020202020202020-
  6518 00002D5A 202020202020202020-
  6518 00002D63 202020202020202020-
  6518 00002D6C 202020202020202020-
  6518 00002D75 202020202020202020-
  6518 00002D7E 202020202020202020-
  6518 00002D87 202020202020202020-
  6518 00002D90 2020202020DDDBDE   
  6519 00002D98 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6519 00002DA1 202020202020202020-
  6519 00002DAA 202020202020202020-
  6519 00002DB3 202020202020202020-
  6519 00002DBC 202020202020202020-
  6519 00002DC5 202020202020202020-
  6519 00002DCE 202020202020202020-
  6519 00002DD7 202020202020202020-
  6519 00002DE0 2020202020DDDBDE   
  6520 00002DE8 DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6520 00002DF1 202020202020202020-
  6520 00002DFA 2020202020205F5F5F-
  6520 00002E03 5F5F5F5F2020205F5F-
  6520 00002E0C 5F5F5F5F2020202020-
  6520 00002E15 2020205F5F5F5F5F5F-
  6520 00002E1E 5F2E20202020202020-
  6520 00002E27 202020202020202020-
  6520 00002E30 2020202020DDDBDE   
  6521 00002E38 DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6521 00002E41 202020202020202020-
  6521 00002E4A 20202020207C202020-
  6521 00002E53 202020205C202F2020-
  6521 00002E5C 5F5F20205C20202020-
  6521 00002E65 20202F202020202020-
  6521 00002E6E 207C20202020202020-
  6521 00002E77 202020202020202020-
  6521 00002E80 2020202020DDDBDE   
  6522 00002E88 DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6522 00002E91 202020202020202020-
  6522 00002E9A 20202020207C20202E-
  6522 00002EA3 2D2D2E20207C20207C-
  6522 00002EAC 20207C20207C202020-
  6522 00002EB5 207C202020282D2D2D-
  6522 00002EBE 2D6020202020202020-
  6522 00002EC7 202020202020202020-
  6522 00002ED0 2020202020DDDBDE   
  6523 00002ED8 DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6523 00002EE1 202020202020202020-
  6523 00002EEA 20202020207C20207C-
  6523 00002EF3 20207C20207C20207C-
  6523 00002EFC 20207C20207C202020-
  6523 00002F05 20205C2020205C2020-
  6523 00002F0E 202020202020202020-
  6523 00002F17 202020202020202020-
  6523 00002F20 2020202020DDDBDE   
  6524 00002F28 DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6524 00002F31 202020202020202020-
  6524 00002F3A 20202020207C202027-
  6524 00002F43 2D2D2720207C202060-
  6524 00002F4C 2D2D2720207C202E2D-
  6524 00002F55 2D2D2D292020207C20-
  6524 00002F5E 202020202020202020-
  6524 00002F67 202020202020202020-
  6524 00002F70 2020202020DDDBDE   
  6525 00002F78 DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6525 00002F81 202020202020202020-
  6525 00002F8A 20202020207C5F5F5F-
  6525 00002F93 5F5F5F5F2F205C5F5F-
  6525 00002F9C 5F5F5F5F2F20207C5F-
  6525 00002FA5 5F5F5F5F5F5F2F2020-
  6525 00002FAE 202020202020202020-
  6525 00002FB7 202020202020202020-
  6525 00002FC0 2020202020DDDBDE   
  6526 00002FC8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6526 00002FD1 202020202020202020-
  6526 00002FDA 202020202020202020-
  6526 00002FE3 202020202020202020-
  6526 00002FEC 202020202020202020-
  6526 00002FF5 202020202020202020-
  6526 00002FFE 202020202020202020-
  6526 00003007 202020202020202020-
  6526 00003010 2020202020DDDBDE   
  6527 00003018 DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6527 00003021 5F5F5F5F5F5F202020-
  6527 0000302A 205F5F202020202020-
  6527 00003033 202020205F5F5F2020-
  6527 0000303C 205F5F5F5F20202020-
  6527 00003045 5F5F5F5F20205F5F5F-
  6527 0000304E 5F5F5F5F202E5F5F5F-
  6527 00003057 5F5F5F202020202020-
  6527 00003060 2020202020DDDBDE   
  6528 00003068 DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6528 00003071 2020205F20205C2020-
  6528 0000307A 7C20207C2020202020-
  6528 00003083 2020202F2020205C20-
  6528 0000308C 205C2020205C20202F-
  6528 00003095 2020202F207C202020-
  6528 0000309E 5F5F5F5F7C7C202020-
  6528 000030A7 5F20205C2020202020-
  6528 000030B0 2020202020DDDBDE   
  6529 000030B8 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6529 000030C1 20207C5F2920207C20-
  6529 000030CA 7C20207C2020202020-
  6529 000030D3 20202F20205E20205C-
  6529 000030DC 20205C2020205C2F20-
  6529 000030E5 20202F20207C20207C-
  6529 000030EE 5F5F2020207C20207C-
  6529 000030F7 5F2920207C20202020-
  6529 00003100 2020202020DDDBDE   
  6530 00003108 DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6530 00003111 2020205F5F5F2F2020-
  6530 0000311A 7C20207C2020202020-
  6530 00003123 202F20202F5F5C2020-
  6530 0000312C 5C20205C5F20202020-
  6530 00003135 5F2F2020207C202020-
  6530 0000313E 5F5F7C20207C202020-
  6530 00003147 2020202F2020202020-
  6530 00003150 2020202020DDDBDE   
  6531 00003158 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6531 00003161 20207C202020202020-
  6531 0000316A 7C2020602D2D2D2D2E-
  6531 00003173 2F20205F5F5F5F5F20-
  6531 0000317C 205C2020207C20207C-
  6531 00003185 20202020207C20207C-
  6531 0000318E 5F5F5F5F207C20207C-
  6531 00003197 5C20205C2D2D2D2D2E-
  6531 000031A0 2020202020DDDBDE   
  6532 000031A8 DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6532 000031B1 205F7C202020202020-
  6532 000031BA 7C5F5F5F5F5F5F5F2F-
  6532 000031C3 5F5F2F20202020205C-
  6532 000031CC 5F5F5C20207C5F5F7C-
  6532 000031D5 20202020207C5F5F5F-
  6532 000031DE 5F5F5F5F7C7C205F7C-
  6532 000031E7 20602E5F5F5F5F5F7C-
  6532 000031F0 2020202020DDDBDE   
  6533 000031F8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6533 00003201 202020202020202020-
  6533 0000320A 202020202020202020-
  6533 00003213 202020202020202020-
  6533 0000321C 202020202020202020-
  6533 00003225 202020202020202020-
  6533 0000322E 202020202020202020-
  6533 00003237 202020202020202020-
  6533 00003240 2020202020DDDBDE   
  6534 00003248 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6534 00003251 202020202020202020-
  6534 0000325A 202020202020202020-
  6534 00003263 202020202020202020-
  6534 0000326C 202020202020202020-
  6534 00003275 202020202020202020-
  6534 0000327E 202020202020202020-
  6534 00003287 202020202020202020-
  6534 00003290 2020202020DDDBDE   
  6535 00003298 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6535 000032A1 202020202020202020-
  6535 000032AA 202020202020202020-
  6535 000032B3 202020202020202020-
  6535 000032BC 202020202020202020-
  6535 000032C5 202020202020202020-
  6535 000032CE 202020202020202020-
  6535 000032D7 202020202020202020-
  6535 000032E0 2020202020DDDBDE   
  6536 000032E8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6536 000032F1 202020202020202020-
  6536 000032FA 202020202020202020-
  6536 00003303 202020202020202020-
  6536 0000330C 202020202020202020-
  6536 00003315 202020202020202020-
  6536 0000331E 202020202020202020-
  6536 00003327 202020202020202020-
  6536 00003330 2020202020DDDBDE   
  6537 00003338 DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6537 00003341 202020202020202020-
  6537 0000334A 202020202020202020-
  6537 00003353 202020202020202057-
  6537 0000335C 454C434F4D4520544F-
  6537 00003365 202020202020202020-
  6537 0000336E 202020202020202020-
  6537 00003377 202020202020202020-
  6537 00003380 2020202020DDDBDE   
  6538 00003388 DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6538 00003391 202020202020202020-
  6538 0000339A 202020202020202020-
  6538 000033A3 202020202020202044-
  6538 000033AC 4F5320504C41594552-
  6538 000033B5 202020202020202020-
  6538 000033BE 202020202020202020-
  6538 000033C7 202020202020202020-
  6538 000033D0 2020202020DDDBDE   
  6539 000033D8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6539 000033E1 202020202020202020-
  6539 000033EA 202020202020202020-
  6539 000033F3 202020202020202020-
  6539 000033FC 202020202020202020-
  6539 00003405 202020202020202020-
  6539 0000340E 202020202020202020-
  6539 00003417 202020202020202020-
  6539 00003420 2020202020DDDBDE   
  6540 00003428 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6540 00003431 202020202020202020-
  6540 0000343A 202020202020202020-
  6540 00003443 202020202020202020-
  6540 0000344C 202020202020202020-
  6540 00003455 202020202020202020-
  6540 0000345E 202020202020202020-
  6540 00003467 202020202020202020-
  6540 00003470 2020202020DDDBDE   
  6541 00003478 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6541 00003481 202020202020202020-
  6541 0000348A 202020202020202020-
  6541 00003493 202020202020202020-
  6541 0000349C 202020202020202020-
  6541 000034A5 202020202020202020-
  6541 000034AE 202020202020202020-
  6541 000034B7 202020202020202020-
  6541 000034C0 2020202020DDDBDE   
  6542 000034C8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6542 000034D1 202020202020202020-
  6542 000034DA 202020202020202020-
  6542 000034E3 202020202020202020-
  6542 000034EC 202020202020202020-
  6542 000034F5 202020202020202020-
  6542 000034FE 202020202020202020-
  6542 00003507 202020202020202020-
  6542 00003510 2020202020DDDBDE   
  6543 00003518 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6543 00003521 202020202020202020-
  6543 0000352A 202020202020202020-
  6543 00003533 202020202020202020-
  6543 0000353C 202020202020202020-
  6543 00003545 202020202020202020-
  6543 0000354E 202020202020202020-
  6543 00003557 202020202020202020-
  6543 00003560 2020202020DDDBDE   
  6544 00003568 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6544 00003571 202020202020202020-
  6544 0000357A 202020202020202020-
  6544 00003583 202020202020202020-
  6544 0000358C 202020202020202020-
  6544 00003595 202020202020202020-
  6544 0000359E 202020202020202020-
  6544 000035A7 202020202020202020-
  6544 000035B0 2020202020DDDBDE   
  6545 000035B8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6545 000035C1 202020202020202020-
  6545 000035CA 202020202020202020-
  6545 000035D3 202020202020202020-
  6545 000035DC 202020202020202020-
  6545 000035E5 202020202020202020-
  6545 000035EE 202020202020202020-
  6545 000035F7 202020202020202020-
  6545 00003600 2020202020DDDBDE   
  6546 00003608 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6546 00003611 202020202020202020-
  6546 0000361A 202020202020202020-
  6546 00003623 202020202020202020-
  6546 0000362C 202020202020202020-
  6546 00003635 202020202020202020-
  6546 0000363E 202020202020202020-
  6546 00003647 202020202020202020-
  6546 00003650 2020202020DDDBDE   
  6547 00003658 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6547 00003661 202020202020202020-
  6547 0000366A 202020202020202020-
  6547 00003673 202020202020202020-
  6547 0000367C 202020202020202020-
  6547 00003685 202020202020202020-
  6547 0000368E 202020202020202020-
  6547 00003697 202020202020202020-
  6547 000036A0 2020202020DDDBDE   
  6548 000036A8 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6548 000036B1 202020202020202020-
  6548 000036BA 202020202020202020-
  6548 000036C3 202020202020202020-
  6548 000036CC 202020202020202020-
  6548 000036D5 202020202020202020-
  6548 000036DE 202020202020202020-
  6548 000036E7 202020202020202020-
  6548 000036F0 2020202020DDDBDE   
  6549 000036F8 00                      	db 0
  6550                                  
  6551                                  ; -------------------------------------------------------------
  6552                                  
  6553                                  	; 25/12/2024
  6554                                  PlayingScreen:
  6555 000036F9 DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6555 00003702 DBDBDBDBDBDBDBDBDB-
  6555 0000370B DBDBDBDBDBDBDBDBDB-
  6555 00003714 DBDBDBDBDBDBDB2044-
  6555 0000371D 4F5320506C61796572-
  6555 00003726 20DBDBDBDBDBDBDBDB-
  6555 0000372F DBDBDBDBDBDBDBDBDB-
  6555 00003738 DBDBDBDBDBDBDBDBDB-
  6555 00003741 DBDBDBDBDBDBDBDB   
  6556 00003749 C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6556 00003752 CDCDCDCDCDCDCDCDCD-
  6556 0000375B CDCDCDCDCDCDCDCDCD-
  6556 00003764 CDCDCDCDCDCDCDCDCD-
  6556 0000376D CDCDCDCDCDCDCDCDCD-
  6556 00003776 CDCDCDCDCDCDCDCDCD-
  6556 0000377F CDCDCDCDCDCDCDCDCD-
  6556 00003788 CDCDCDCDCDCDCDCDCD-
  6556 00003791 CDCDCDCDCDCDCDBB   
  6557 00003799 BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6557 000037A2 202020202020202020-
  6557 000037AB 202020202020202020-
  6557 000037B4 202020202020202055-
  6557 000037BD 736572204775696465-
  6557 000037C6 202020202020202020-
  6557 000037CF 202020202020202020-
  6557 000037D8 202020202020202020-
  6557 000037E1 20202020202020BA   
  6558 000037E9 BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<N>/<P>         Next/Previous", 9 dup(32), 186
  6558 000037F2 706163653E20202020-
  6558 000037FB 2020202020506C6179-
  6558 00003804 2F5061757365202020-
  6558 0000380D 20202020203C4E3E2F-
  6558 00003816 3C503E202020202020-
  6558 0000381F 2020204E6578742F50-
  6558 00003828 726576696F75732020-
  6558 00003831 20202020202020BA   
  6559 00003839 BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>/<G>     Wave Lighting", 9 dup(32), 186
  6559 00003842 3E2020202020202020-
  6559 0000384B 202020202053746F70-
  6559 00003854 202020202020202020-
  6559 0000385D 20202020203C456E74-
  6559 00003866 65723E2F3C473E2020-
  6559 0000386F 20202057617665204C-
  6559 00003878 69676874696E672020-
  6559 00003881 20202020202020BA   
  6560 00003889 BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6560 00003892 3E2020202020202020-
  6560 0000389B 2020202020466F7277-
  6560 000038A4 617264732020202020-
  6560 000038AD 20202020203C2B3E2F-
  6560 000038B6 3C2D3E202020202020-
  6560 000038BF 202020496E632F4465-
  6560 000038C8 6320566F6C756D6520-
  6560 000038D1 20202020202020BA   
  6561 000038D9 BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6561 000038E2 3E2020202020202020-
  6561 000038EB 20202020204261636B-
  6561 000038F4 776172647320202020-
  6561 000038FD 20202020203C513E20-
  6561 00003906 202020202020202020-
  6561 0000390F 202020517569742050-
  6561 00003918 726F6772616D202020-
  6561 00003921 20202020202020BA   
  6562 00003929 CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6562 00003932 CDCDCDCDCDCDCDCDCD-
  6562 0000393B CDCDCDCDCDCDCDCDCD-
  6562 00003944 CDCDCDCDCDCDCDCDCD-
  6562 0000394D CDCDCDCDCDCDCDCDCD-
  6562 00003956 CDCDCDCDCDCDCDCDCD-
  6562 0000395F CDCDCDCDCDCDCDCDCD-
  6562 00003968 CDCDCDCDCDCDCDCDCD-
  6562 00003971 CDCDCDCDCDCDCDB9   
  6563 00003979 BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6563 00003982 6C65204E616D65203A-
  6563 0000398B 202020202020202020-
  6563 00003994 202020202020202020-
  6563 0000399D 20202020204269742D-
  6563 000039A6 5261746520203A2020-
  6563 000039AF 202020302020426974-
  6563 000039B8 732020202020202020-
  6563 000039C1 20202020202020BA   
  6564 000039C9 BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6564 000039D2 657175656E6379203A-
  6564 000039DB 202020202030202020-
  6564 000039E4 2020487A2020202020-
  6564 000039ED 2020202020232D4368-
  6564 000039F6 616E6E656C733A2020-
  6564 000039FF 202020302020202020-
  6564 00003A08 202020202020202020-
  6564 00003A11 20202020202020BA   
  6565 00003A19 C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6565 00003A22 CDCDCDCDCDCDCDCDCD-
  6565 00003A2B CDCDCDCDCDCDCDCDCD-
  6565 00003A34 CDCDCDCDCDCDCDCDCD-
  6565 00003A3D CDCDCDCDCDCDCDCDCD-
  6565 00003A46 CDCDCDCDCDCDCDCDCD-
  6565 00003A4F CDCDCDCDCDCDCDCDCD-
  6565 00003A58 CDCDCDCDCDCDCDCDCD-
  6565 00003A61 CDCDCDCDCDCDCDBC   
  6566 00003A69 202020202020202020-     	db  80 dup(32)
  6566 00003A72 202020202020202020-
  6566 00003A7B 202020202020202020-
  6566 00003A84 202020202020202020-
  6566 00003A8D 202020202020202020-
  6566 00003A96 202020202020202020-
  6566 00003A9F 202020202020202020-
  6566 00003AA8 202020202020202020-
  6566 00003AB1 2020202020202020   
  6567                                  improper_samplerate_txt:
  6568                                  read_error_txt:
  6569 00003AB9 202020202020202020-     	db  80 dup(32)
  6569 00003AC2 202020202020202020-
  6569 00003ACB 202020202020202020-
  6569 00003AD4 202020202020202020-
  6569 00003ADD 202020202020202020-
  6569 00003AE6 202020202020202020-
  6569 00003AEF 202020202020202020-
  6569 00003AF8 202020202020202020-
  6569 00003B01 2020202020202020   
  6570 00003B09 202020202020202020-     	db  80 dup(32)
  6570 00003B12 202020202020202020-
  6570 00003B1B 202020202020202020-
  6570 00003B24 202020202020202020-
  6570 00003B2D 202020202020202020-
  6570 00003B36 202020202020202020-
  6570 00003B3F 202020202020202020-
  6570 00003B48 202020202020202020-
  6570 00003B51 2020202020202020   
  6571 00003B59 202020202020202020-     	db  80 dup(32)
  6571 00003B62 202020202020202020-
  6571 00003B6B 202020202020202020-
  6571 00003B74 202020202020202020-
  6571 00003B7D 202020202020202020-
  6571 00003B86 202020202020202020-
  6571 00003B8F 202020202020202020-
  6571 00003B98 202020202020202020-
  6571 00003BA1 2020202020202020   
  6572 00003BA9 202020202020202020-     	db  80 dup(32)
  6572 00003BB2 202020202020202020-
  6572 00003BBB 202020202020202020-
  6572 00003BC4 202020202020202020-
  6572 00003BCD 202020202020202020-
  6572 00003BD6 202020202020202020-
  6572 00003BDF 202020202020202020-
  6572 00003BE8 202020202020202020-
  6572 00003BF1 2020202020202020   
  6573 00003BF9 202020202020202020-     	db  80 dup(32)
  6573 00003C02 202020202020202020-
  6573 00003C0B 202020202020202020-
  6573 00003C14 202020202020202020-
  6573 00003C1D 202020202020202020-
  6573 00003C26 202020202020202020-
  6573 00003C2F 202020202020202020-
  6573 00003C38 202020202020202020-
  6573 00003C41 2020202020202020   
  6574 00003C49 202020202020202020-     	db  80 dup(32)
  6574 00003C52 202020202020202020-
  6574 00003C5B 202020202020202020-
  6574 00003C64 202020202020202020-
  6574 00003C6D 202020202020202020-
  6574 00003C76 202020202020202020-
  6574 00003C7F 202020202020202020-
  6574 00003C88 202020202020202020-
  6574 00003C91 2020202020202020   
  6575 00003C99 202020202020202020-     	db  80 dup(32)
  6575 00003CA2 202020202020202020-
  6575 00003CAB 202020202020202020-
  6575 00003CB4 202020202020202020-
  6575 00003CBD 202020202020202020-
  6575 00003CC6 202020202020202020-
  6575 00003CCF 202020202020202020-
  6575 00003CD8 202020202020202020-
  6575 00003CE1 2020202020202020   
  6576 00003CE9 202020202020202020-     	db  80 dup(32)
  6576 00003CF2 202020202020202020-
  6576 00003CFB 202020202020202020-
  6576 00003D04 202020202020202020-
  6576 00003D0D 202020202020202020-
  6576 00003D16 202020202020202020-
  6576 00003D1F 202020202020202020-
  6576 00003D28 202020202020202020-
  6576 00003D31 2020202020202020   
  6577 00003D39 202020202020202020-     	db  80 dup(32)
  6577 00003D42 202020202020202020-
  6577 00003D4B 202020202020202020-
  6577 00003D54 202020202020202020-
  6577 00003D5D 202020202020202020-
  6577 00003D66 202020202020202020-
  6577 00003D6F 202020202020202020-
  6577 00003D78 202020202020202020-
  6577 00003D81 2020202020202020   
  6578 00003D89 202020202020202020-     	db  80 dup(32)
  6578 00003D92 202020202020202020-
  6578 00003D9B 202020202020202020-
  6578 00003DA4 202020202020202020-
  6578 00003DAD 202020202020202020-
  6578 00003DB6 202020202020202020-
  6578 00003DBF 202020202020202020-
  6578 00003DC8 202020202020202020-
  6578 00003DD1 2020202020202020   
  6579 00003DD9 202020202020202020-     	db  80 dup(32)
  6579 00003DE2 202020202020202020-
  6579 00003DEB 202020202020202020-
  6579 00003DF4 202020202020202020-
  6579 00003DFD 202020202020202020-
  6579 00003E06 202020202020202020-
  6579 00003E0F 202020202020202020-
  6579 00003E18 202020202020202020-
  6579 00003E21 2020202020202020   
  6580 00003E29 202020202020202020-     	db  80 dup(32)
  6580 00003E32 202020202020202020-
  6580 00003E3B 202020202020202020-
  6580 00003E44 202020202020202020-
  6580 00003E4D 202020202020202020-
  6580 00003E56 202020202020202020-
  6580 00003E5F 202020202020202020-
  6580 00003E68 202020202020202020-
  6580 00003E71 2020202020202020   
  6581 00003E79 202020202020202020-     	db  80 dup(32)
  6581 00003E82 202020202020202020-
  6581 00003E8B 202020202020202020-
  6581 00003E94 202020202020202020-
  6581 00003E9D 202020202020202020-
  6581 00003EA6 202020202020202020-
  6581 00003EAF 202020202020202020-
  6581 00003EB8 202020202020202020-
  6581 00003EC1 2020202020202020   
  6582 00003EC9 202020202020202020-     	db  80 dup(32)
  6582 00003ED2 202020202020202020-
  6582 00003EDB 202020202020202020-
  6582 00003EE4 202020202020202020-
  6582 00003EED 202020202020202020-
  6582 00003EF6 202020202020202020-
  6582 00003EFF 202020202020202020-
  6582 00003F08 202020202020202020-
  6582 00003F11 2020202020202020   
  6583 00003F19 202020202020202020-     	db  80 dup(32)
  6583 00003F22 202020202020202020-
  6583 00003F2B 202020202020202020-
  6583 00003F34 202020202020202020-
  6583 00003F3D 202020202020202020-
  6583 00003F46 202020202020202020-
  6583 00003F4F 202020202020202020-
  6583 00003F58 202020202020202020-
  6583 00003F61 2020202020202020   
  6584 00003F69 202020202020202020-     	db  80 dup(32)
  6584 00003F72 202020202020202020-
  6584 00003F7B 202020202020202020-
  6584 00003F84 202020202020202020-
  6584 00003F8D 202020202020202020-
  6584 00003F96 202020202020202020-
  6584 00003F9F 202020202020202020-
  6584 00003FA8 202020202020202020-
  6584 00003FB1 2020202020202020   
  6585 00003FB9 202020202020202020-     	db  80 dup(32)
  6585 00003FC2 202020202020202020-
  6585 00003FCB 202020202020202020-
  6585 00003FD4 202020202020202020-
  6585 00003FDD 202020202020202020-
  6585 00003FE6 202020202020202020-
  6585 00003FEF 202020202020202020-
  6585 00003FF8 202020202020202020-
  6585 00004001 2020202020202020   
  6586 00004009 202020202020202020-     	db  80 dup(32)
  6586 00004012 202020202020202020-
  6586 0000401B 202020202020202020-
  6586 00004024 202020202020202020-
  6586 0000402D 202020202020202020-
  6586 00004036 202020202020202020-
  6586 0000403F 202020202020202020-
  6586 00004048 202020202020202020-
  6586 00004051 2020202020202020   
  6587 00004059 CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6587 00004062 CDCDCDCDCDCDCDCDCD-
  6587 0000406B CDCDCDCDCDCDCDCDCD-
  6587 00004074 CDCDCDCDCDCDCDCDCD-
  6587 0000407D CDCDCDCDCDCDCDCDCD-
  6587 00004086 CDCDCDCDCDCDCDCDCD-
  6587 0000408F CDCDCDCDCDCDCDCDCD-
  6587 00004098 CDCDCDCDCDCDCDCDCD-
  6587 000040A1 CDCDCDCDCDCDCDCD   
  6588 000040A9 202020202020202020-     	db  80 dup(32)
  6588 000040B2 202020202020202020-
  6588 000040BB 202020202020202020-
  6588 000040C4 202020202020202020-
  6588 000040CD 202020202020202020-
  6588 000040D6 202020202020202020-
  6588 000040DF 202020202020202020-
  6588 000040E8 202020202020202020-
  6588 000040F1 2020202020202020   
  6589 000040F9 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6589 00004102 202020202020202020-
  6589 0000410B 202020202020202020-
  6589 00004114 20202020202030303A-
  6589 0000411D 303020AEAF2030303A-
  6589 00004126 303020202020202020-
  6589 0000412F 202020202020202020-
  6589 00004138 202020202020202056-
  6589 00004141 4F4C2030303025     
  6590 00004148 00                      	db 0
  6591                                  
  6592                                  ; 25/12/2024
  6593                                  ; 28/11/2024
  6594                                  IsInSplash:
  6595 00004149 01                      	db 1
  6596                                  
  6597                                  SplashFileName:
  6598 0000414A 53504C4153482E5741-     	db "SPLASH.WAV", 0
  6598 00004153 5600               
  6599                                  
  6600                                  ; -------------------------------------------------------------
  6601                                  
  6602                                  	; 22/12/2024
  6603                                  fillblock:
  6604 00004155 FF<rep Eh>              	times 14 db 0FFh
  6605 00004163 0000                    	dw 0
  6606                                  
  6607                                  ; -------------------------------------------------------------
  6608                                  
  6609                                  ; 23/11/2024
  6610                                  colors:
  6611 00004165 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6612                                  	; white, cyan, green, red, yellow, blue, magenta
  6613 0000416D 0B                      ccolor:	db 0Bh	; cyan
  6614                                  
  6615                                  EOF: 
  6616                                  
  6617                                  ; -------------------------------------------------------------
  6618                                  
  6619                                  bss:
  6620                                  
  6621                                  ABSOLUTE bss
  6622                                  
  6623 0000416E ????                    alignb 4
  6624                                  
  6625                                  ; 21/12/2024
  6626                                  fontbuff1:
  6627 00004170 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6628                                  fontbuff2:
  6629 00004F70 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6630                                  
  6631                                  ; 11/12/2024
  6632                                  wleds_addr:
  6633 00005F70 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6634                                  ; 22/12/2024
  6635                                  prev_leds:
  6636 00007370 <res 140h>              	resd 80	; previous lighting leds
  6637                                  
  6638                                  ; 24/12/2024
  6639                                  wpoints_dif:	; wave lighting points factor (differential) 
  6640 000074B0 ????????                	resd 1	; required bytes for 1/18 second wave lighting
  6641                                  graphstart:
  6642 000074B4 ????????                	resd 1	; start (top) line/row for wave lighting points 	 
  6643                                  
  6644                                  LFB_ADDR:
  6645 000074B8 ????????                	resd 1
  6646                                  ;nextrow:
  6647                                  	;resd 1
  6648                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6649 000074BC ????????                	resd 1
  6650 000074C0 ????????                wcolor:	resd 1
  6651                                  ; 26/12/2024
  6652                                  ;tcolor: resb 1 ; text color
  6653                                  columns:
  6654 000074C4 ??                      	resb 1
  6655 000074C5 ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6656                                  
  6657 000074C6 ????                    alignb 4
  6658                                  
  6659                                  bss_start:
  6660                                  
  6661                                  ; 24/12/2024
  6662                                  prev_points:
  6663 000074C8 <res A00h>              	resd 640 ; previous wave points (which are lighting)	
  6664                                  
  6665                                  ; 18/11/2024
  6666                                  stopped:
  6667 00007EC8 ??                      	resb 1
  6668 00007EC9 ??                      tLO:	resb 1
  6669                                  ; 21/11/2024
  6670 00007ECA ??                      tLP:	resb 1
  6671                                  ; 19/11/2024
  6672 00007ECB ??                      wleds:	resb 1
  6673                                  wleds_dif:
  6674 00007ECC ????????                	resd 1
  6675 00007ED0 ????????                pbuf_o:	resd 1
  6676                                  ; 07/12/2024
  6677 00007ED4 ??                      pbuf_s:	resb 1
  6678                                  
  6679                                  ; 07/12/2024
  6680                                  ; 24/11/2024
  6681                                  half_buffer:
  6682 00007ED5 ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6683                                  
  6684                                  ; 30/05/2024
  6685 00007ED6 ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6686                                  
  6687                                  ; 24/12/2024
  6688 00007ED7 ??                      p_mode: resb 1	; point mode (as alternative to LED mode)
  6689                                  
  6690                                  ; 25/12/2024
  6691                                  ; 29/11/2024
  6692                                  command:
  6693 00007ED8 ??                      	resb 1
  6694                                  filecount:
  6695 00007ED9 ??                      	resb 1
  6696                                  
  6697                                  ; 30/11/2024
  6698 00007EDA ????                    alignb 4
  6699                                  
  6700                                  ;;;;;;;;;;;;;;
  6701                                  ; 14/11/2024
  6702                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6703                                  WAVFILEHEADERbuff:
  6704                                  RIFF_ChunkID:
  6705 00007EDC ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6706                                  		; 0x52494646
  6707                                  RIFF_ChunkSize:
  6708 00007EE0 ????????                	resd 1	; Represents total file size, not 
  6709                                          	; including the first 2 fields 
  6710                                  		; (Total_File_Size - 8), little-endian
  6711                                  RIFF_Format:
  6712 00007EE4 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6713                                  		; 0x57415645
  6714                                  
  6715                                  ;; WAVE header parameters ("Sub-chunk")
  6716                                  WAVE_SubchunkID:
  6717 00007EE8 ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6718                                  		; 0x666d7420
  6719                                  WAVE_SubchunkSize:
  6720 00007EEC ????????                	resd 1	; Represents total chunk size
  6721                                  WAVE_AudioFormat:
  6722 00007EF0 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6723                                  		; of compression, not supported.
  6724                                  WAVE_NumChannels:
  6725 00007EF2 ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6726                                  WAVE_SampleRate:
  6727 00007EF4 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6728                                  WAVE_ByteRate:
  6729 00007EF8 ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6730                                  WAVE_BlockAlign:
  6731 00007EFC ????                    	resw 1	; NumChannels * BytesPerSample
  6732                                  		; Number of bytes for one sample.
  6733                                  WAVE_BitsPerSample:
  6734 00007EFE ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6735                                  
  6736                                  ;; DATA header parameters
  6737                                  DATA_SubchunkID:
  6738 00007F00 ????????                	resd 1	; Must be equal to "data" - big-endian
  6739                                          	; 0x64617461
  6740                                  DATA_SubchunkSize:
  6741 00007F04 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6742                                          	; Number of bytes in the data.
  6743                                  ;;;;;;;;;;;;;;
  6744                                  
  6745                                  ; 15/11/2024
  6746                                  cursortype:
  6747 00007F08 ????                    	resw 1
  6748 00007F0A ??                      flags:	resb 1
  6749                                  ; 06/11/2023
  6750                                  ac97_int_ln_reg:
  6751 00007F0B ??                      	resb 1
  6752                                  filehandle:
  6753 00007F0C ????????                	resd 1
  6754                                  
  6755                                  ; 25/12/2024
  6756                                  ; 30/11/2024
  6757                                  ;argc:	resb 1	; argument count
  6758 00007F10 ????????                argv:	resd 1	; current argument (wav file) ptr
  6759 00007F14 ????????                argvf:	resd 1	; 1st argument (wav file) ptr
  6760 00007F18 ????????                argvl:	resd 1	; last argument (wav file) ptr
  6761                                  
  6762                                  ; 30/05/2024
  6763                                  wav_file_name:
  6764 00007F1C <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6765 00007F6C ????                    	resw 1	; 30/11/2024
  6766                                  
  6767                                  ; 08/11/2023
  6768                                  ; 07/11/2023
  6769                                  fbs_shift:
  6770 00007F6E ??                      	resb 1
  6771                                  ; 07/12/2024
  6772 00007F6F ??                      SRB:	resb 1
  6773                                  
  6774                                  ; 12/11/2016 - Erdogan Tan
  6775                                  bus_dev_fn:
  6776 00007F70 ????????                	resd 1
  6777                                  dev_vendor:
  6778 00007F74 ????????                	resd 1
  6779                                  
  6780                                  ; 17/02/2017
  6781                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6782                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6783                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6784                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6785 00007F78 ????                    NAMBAR:	resw 1	; BAR for mixer
  6786                                  NABMBAR:
  6787 00007F7A ????                    	resw 1	; BAR for bus master regs
  6788                                  
  6789                                  ; 15/11/2024
  6790                                  loadfromwavfile:
  6791 00007F7C ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6792                                  loadsize:
  6793 00007F80 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6794                                  buffersize:
  6795 00007F84 ????????                	resd 1	; 16 bit samples (not bytes)
  6796                                  		
  6797                                  ; 14/11/2024
  6798                                  TotalTime:
  6799 00007F88 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6800                                  ProgressTime:
  6801 00007F8C ????????                	resd 1
  6802 00007F90 ????????                count:	resd 1	; byte count of one (wav file) read
  6803                                  LoadedDataBytes:
  6804 00007F94 ????????                	resd 1	; total read/load count
  6805                                  
  6806                                  timerticks:
  6807 00007F98 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6808                                  		; (in order to get the emulator/qemu to run correctly)
  6809                                  ; 14/11/2024
  6810                                  bss_end:
  6811                                  
  6812                                  ; 02/12/2024
  6813 00007F9C <res 64h>               alignb 4096
  6814                                  
  6815                                  ; 07/12/2024
  6816                                  ; 26/11/2023
  6817                                  audio_buffer:
  6818 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6819                                  
  6820                                  ; 01/12/2024
  6821                                  ; 26/11/2023
  6822                                  temp_buffer:
  6823 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
  6824                                  
  6825                                  ; 27/12/2024
  6826                                  alignb 4096
  6827 00028000 <res A00h>              g_buff:	resb 640*4
