     1                                  ; ****************************************************************************
     2                                  ; twavply2.s (for TRDOS 386)
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; TWAVPLY2.PRG ! AC'97 (ICH) WAV PLAYER & VGA DEMO program by Erdogan TAN
     5                                  ;
     6                                  ; 09/12/2023
     7                                  ;
     8                                  ; [ Last Modification: 14/12/2024 ]
     9                                  ;
    10                                  ; Modified from: twavplay.s (VIA VT8237R WAV PLAYER & VGA DEMO) program
    11                                  ;	         by Erdogan Tan (24/08/2020) 
    12                                  ;
    13                                  ; Modified from: 'playwav6.s' (AC'97 WAV player) source code
    14                                  ;		 by Erdogan Tan (27/11/2023)
    15                                  ; 
    16                                  ; Assembler: NASM 2.15
    17                                  ; ----------------------------------------------------------------------------
    18                                  ;	   nasm  twavplay.s -l twavplay.txt -o TWAVPLAY.PRG	
    19                                  ; ****************************************************************************
    20                                  
    21                                  ; 09/12/2023
    22                                  ; Modified from: twavplay.s (VIA VT8237R WAV PLAYER & VGA DEMO) program
    23                                  ;	         by Erdogan Tan (24/08/2020)
    24                                  
    25                                  ; 14/07/2020
    26                                  ; 31/12/2017
    27                                  ; TRDOS 386 (v2.0) system calls
    28                                  _ver 	equ 0
    29                                  _exit 	equ 1
    30                                  _fork 	equ 2
    31                                  _read 	equ 3
    32                                  _write	equ 4
    33                                  _open	equ 5
    34                                  _close 	equ 6
    35                                  _wait 	equ 7
    36                                  _create	equ 8
    37                                  _rename	equ 9
    38                                  _delete	equ 10
    39                                  _exec	equ 11
    40                                  _chdir	equ 12
    41                                  _time 	equ 13
    42                                  _mkdir 	equ 14
    43                                  _chmod	equ 15
    44                                  _rmdir	equ 16
    45                                  _break	equ 17
    46                                  _drive	equ 18
    47                                  _seek	equ 19
    48                                  _tell 	equ 20
    49                                  _memory	equ 21
    50                                  _prompt	equ 22
    51                                  _path	equ 23
    52                                  _env	equ 24
    53                                  _stime	equ 25
    54                                  _quit	equ 26
    55                                  _intr	equ 27
    56                                  _dir	equ 28
    57                                  _emt 	equ 29
    58                                  _ldrvt 	equ 30
    59                                  _video 	equ 31
    60                                  _audio	equ 32
    61                                  _timer	equ 33
    62                                  _sleep	equ 34
    63                                  _msg    equ 35
    64                                  _geterr	equ 36
    65                                  _fpstat	equ 37
    66                                  _pri	equ 38
    67                                  _rele	equ 39
    68                                  _fff	equ 40
    69                                  _fnf	equ 41
    70                                  _alloc	equ 42
    71                                  _dalloc equ 43
    72                                  _calbac equ 44
    73                                  _dma	equ 45		
    74                                  
    75                                  %macro sys 1-4
    76                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)	
    77                                      ; 03/09/2015	
    78                                      ; 13/04/2015
    79                                      ; Retro UNIX 386 v1 system call.	
    80                                      %if %0 >= 2   
    81                                          mov ebx, %2
    82                                          %if %0 >= 3    
    83                                              mov ecx, %3
    84                                              %if %0 = 4
    85                                                 mov edx, %4   
    86                                              %endif
    87                                          %endif
    88                                      %endif
    89                                      mov eax, %1
    90                                      ;int 30h
    91                                      int 40h ; TRDOS 386 (TRDOS v2.0)	   
    92                                  %endmacro
    93                                  
    94                                  ; TRDOS 386 (and Retro UNIX 386 v1) system call format:
    95                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
    96                                  
    97                                  ; 19/06/2017
    98                                  BUFFERSIZE equ 32768
    99                                  ; 23/08/2020
   100                                  ENDOFFILE equ 1	; flag for knowing end of file
   101                                  
   102                                  ; ----------------------------------------------------------------------------
   103                                  ; Tiny MOD Player v0.1b by Carlos Hasan.
   104                                  ;	July 14th, 1993.
   105                                  
   106                                  ;=============================================================================
   107                                  ;  
   108                                  ;=============================================================================
   109                                  
   110                                  [BITS 32]
   111                                  [org 0]
   112                                  
   113                                  Start:
   114                                  	; clear bss
   115 00000000 B9[00000500]            	mov	ecx, EOF
   116 00000005 BF[12680000]            	mov	edi, bss_start
   117 0000000A 29F9                    	sub	ecx, edi
   118 0000000C D1E9                    	shr	ecx, 1
   119 0000000E 31C0                    	xor	eax, eax
   120 00000010 F366AB                  	rep	stosw
   121                                  
   122                                  	; 09/12/2023
   123                                  	; Detect (& Enable) AC'97 Audio Device
   124 00000013 E8D1040000              	call	DetectAC97
   125 00000018 731B                    	jnc     short GetFileName
   126                                  
   127                                  _dev_not_ready:
   128                                  ; couldn't find the audio device!
   129                                  	sys	_msg, noDevMsg, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000001A BB[3A660000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000001F B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000024 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000029 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 0000002E CD40                <1>  int 40h
   130 00000030 E98E040000                      jmp     Exit
   131                                  
   132                                  GetFileName:
   133 00000035 89E6                    	mov	esi, esp
   134 00000037 AD                      	lodsd
   135 00000038 83F802                  	cmp	eax, 2 ; two arguments 
   136                                  		; (program file name & mod file name)
   137                                  	;jb	pmsg_usage ; nothing to do
   138                                  	; 09/12/2023
   139 0000003B 7305                    	jnb	short _x
   140 0000003D E98F040000              	jmp	pmsg_usage
   141                                  
   142                                  _x:
   143 00000042 AD                      	lodsd ; program file name address 
   144 00000043 AD                      	lodsd ; wav file name address (file to be read)
   145 00000044 89C6                    	mov	esi, eax
   146 00000046 BF[48680000]            	mov	edi, wav_file_name
   147                                  ScanName:       
   148 0000004B AC                      	lodsb
   149 0000004C 84C0                    	test	al, al
   150                                  	;jz	pmsg_usage
   151                                  	; 09/12/2023
   152 0000004E 7505                    	jnz	short _y
   153 00000050 E97C040000              	jmp	pmsg_usage
   154                                  _y:
   155 00000055 3C20                    	cmp	al, 20h
   156 00000057 74F2                    	je	short ScanName	; scan start of name.
   157 00000059 AA                      	stosb
   158 0000005A B4FF                    	mov	ah, 0FFh
   159                                  a_0:	
   160 0000005C FEC4                    	inc	ah
   161                                  a_1:
   162 0000005E AC                      	lodsb
   163 0000005F AA                      	stosb
   164 00000060 3C2E                    	cmp	al, '.'
   165 00000062 74F8                    	je	short a_0	
   166 00000064 20C0                    	and	al, al
   167 00000066 75F6                    	jnz	short a_1
   168                                  
   169 00000068 08E4                    	or	ah, ah		 ; if period NOT found,
   170 0000006A 750B                    	jnz	short PrintPMesg ; then add a .MOD extension.
   171                                  SetExt:
   172 0000006C 4F                      	dec	edi
   173 0000006D C7072E574156            	mov	dword [edi], '.WAV'
   174 00000073 C6470400                	mov	byte [edi+4], 0
   175                                  PrintPMesg: 
   176                                  	; 23/08/2020
   177 00000077 C605[F2650000]00        	mov	byte [credits_zero], 0
   178                                       
   179                                  	; Prints the Credits Text.
   180                                  	sys	_msg, Credits, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000007E BB[8C650000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000083 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000088 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000008D B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000092 CD40                <1>  int 40h
   181                                  _1:
   182                                  	; 19/06/2017
   183                                  	; Allocate Audio Buffer (for user)
   184                                  	;sys	_audio, 0200h, BUFFERSIZE, audio_buffer
   185                                  	; 09/12/2023
   186                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000094 BB00020000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000099 8B0D[E1030000]      <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000009F BA[00800000]        <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000000A4 B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000000A9 CD40                <1>  int 40h
   187 000000AB 7218                    	jc	short error_exit
   188                                  _2:
   189                                  	; 23/08/2020
   190                                  	; Initialize Audio Device (bl = 1 -> Interrupt method)
   191                                  	;sys	_audio, 0301h, 0, audio_int_handler 
   192                                  	;jc	short error_exit
   193                                  	
   194                                  	; 24/08/2020
   195                                  
   196                                  	; 20/10/2017
   197                                  	; Initialize Audio Device (bl = 0 -> SRB method)
   198                                  	sys	_audio, 0300h, 1, srb
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000000AD BB00030000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000000B2 B901000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000000B7 BA[A9680000]        <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000000BC B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000000C1 CD40                <1>  int 40h
   199                                  	;jc	short error_exit
   200                                  	; 09/12/2023
   201 000000C3 731B                    	jnc	short open_wav_file
   202                                  
   203                                  error_exit:
   204                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000000C5 BB[7E660000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000000CA B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000000CF BA0E000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000000D4 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 000000D9 CD40                <1>  int 40h
   205 000000DB E9E3030000              	jmp	Exit
   206                                  
   207                                  	; 09/12/2023
   208                                  open_wav_file:
   209                                  	; 23/08/2020
   210                                  
   211                                  ; open the wav file
   212                                          ; open existing file
   213 000000E0 E826040000                      call    openFile ; no error? ok.
   214 000000E5 731B                            jnc     short _3
   215                                  
   216                                  ; file not found!
   217                                  	sys	_msg, noFileErrMsg, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000000E7 BB[65660000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000000EC B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000000F1 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000000F6 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 000000FB CD40                <1>  int 40h
   218                                  _z:
   219 000000FD E9C1030000                      jmp	Exit
   220                                  
   221                                  _3:
   222 00000102 E83E040000                     	call    getSampleRate	; read the sample rate
   223                                                               	; pass it onto codec.
   224                                  	;jc	Exit
   225                                  	; 09/12/2023
   226 00000107 72F4                    	jc	short _z
   227                                  
   228 00000109 66A3[26680000]          	mov	[sample_rate], ax
   229 0000010F 880D[24680000]          	mov	[stmo], cl
   230 00000115 8815[25680000]          	mov	[bps], dl
   231                                  
   232                                  	; 09/12/2023
   233                                  	; 'playwav6.s (27/11/2023)
   234                                  	
   235                                  	; 26/11/2023
   236 0000011B C605[9B680000]00        	mov	byte [fbs_shift], 0 ; 0 = stereo and 16 bit
   237 00000122 FEC9                    	dec	cl
   238 00000124 7506                    	jnz	short _gsr_1 ; stereo
   239 00000126 FE05[9B680000]          	inc	byte [fbs_shift] ; 1 = mono or 8 bit
   240                                  _gsr_1:	
   241 0000012C 80FA08                  	cmp	dl, 8 
   242 0000012F 7706                    	ja	short _gsr_2 ; 16 bit samples
   243 00000131 FE05[9B680000]          	inc	byte [fbs_shift] ; 2 = mono and 8 bit
   244                                  _gsr_2:
   245                                  
   246                                  	; 10/06/2017
   247                                  	sys	_audio, 0E00h ; get audio controller info
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000137 BB000E0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000013C B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000141 CD40                <1>  int 40h
   248                                  	;jc	error_exit
   249                                  	; 09/12/2023
   250 00000143 7280                    	jc	short error_exit
   251                                  
   252                                  	; 09/12/2023
   253                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
   254                                  	;jne	_dev_not_ready		
   255                                  
   256                                  	; EAX = IRQ Number in AL
   257                                  	;	Audio Device Number in AH 
   258                                  	; EBX = DEV/VENDOR ID
   259                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
   260                                  	; ECX = BUS/DEV/FN 
   261                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
   262                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
   263                                  	; EDX = NABMBAR/NAMBAR (for AC97)
   264                                  	;      (Low word, DX = NAMBAR address)
   265                                  
   266                                  	; 09/12/2023
   267 00000145 A2[9A680000]            	mov	[ac97_int_ln_reg], al
   268 0000014A 891D[9C680000]          	mov	[dev_vendor], ebx
   269 00000150 890D[A0680000]          	mov	[bus_dev_fn], ecx
   270                                  	;mov	[ac97_NamBar], dx
   271                                  	;shr	dx, 16
   272                                  	;mov	[ac97_NabmBar], dx
   273 00000156 8915[A4680000]          	mov	[ac97_NamBar], edx	
   274                                  
   275                                  	; 09/12/2023  
   276 0000015C E801070000              	call	write_ac97_pci_dev_info
   277                                  	; 09/12/2023
   278 00000161 E8C3080000              	call	write_VRA_info
   279                                  
   280                                  	; 24/08/2020
   281 00000166 E82C060000              	call	write_wav_file_info
   282                                  
   283                                  ; 09/12/2023
   284                                  ; -----------------------------------
   285                                  ; 'playwav6.s' (27/11/2023)
   286                                  
   287 0000016B 803D[AC680000]01        	cmp	byte [VRA], 1
   288 00000172 7205                    	jb	short chk_sample_rate
   289                                  
   290                                  playwav_48_khz:	
   291                                  	;mov	dword [loadfromwavfile], loadFromFile
   292                                  	;mov	dword [buffersize], 65536
   293 00000174 E96C020000              	jmp	PlayNow
   294                                  
   295                                  chk_sample_rate:
   296                                  	; set conversion parameters
   297                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   298 00000179 66A1[26680000]          	mov	ax, [sample_rate]
   299 0000017F 663D80BB                	cmp	ax, 48000
   300 00000183 74EF                    	je	short playwav_48_khz
   301                                  chk_22khz:
   302 00000185 663D2256                	cmp	ax, 22050
   303 00000189 7545                    	jne	short chk_11khz
   304 0000018B 803D[25680000]08        	cmp	byte [bps], 8
   305 00000192 7615                    	jna	short chk_22khz_1
   306 00000194 BB[B0160000]            	mov	ebx, load_22khz_stereo_16_bit
   307 00000199 803D[24680000]01        	cmp	byte [stmo], 1 
   308 000001A0 751A                    	jne	short chk_22khz_2
   309 000001A2 BB[23160000]            	mov	ebx, load_22khz_mono_16_bit
   310 000001A7 EB13                    	jmp	short chk_22khz_2
   311                                  chk_22khz_1:
   312 000001A9 BB[9C150000]            	mov	ebx, load_22khz_stereo_8_bit
   313 000001AE 803D[24680000]01        	cmp	byte [stmo], 1 
   314 000001B5 7505                    	jne	short chk_22khz_2
   315 000001B7 BB[13150000]            	mov	ebx, load_22khz_mono_8_bit
   316                                  chk_22khz_2:
   317 000001BC B85A1D0000              	mov	eax, 7514  ; (442*17)
   318 000001C1 BA25000000              	mov	edx, 37
   319 000001C6 B911000000              	mov	ecx, 17 
   320 000001CB E9BA010000              	jmp	set_sizes	
   321                                  chk_11khz:
   322 000001D0 663D112B                	cmp	ax, 11025
   323 000001D4 7545                    	jne	short chk_44khz
   324 000001D6 803D[25680000]08        	cmp	byte [bps], 8
   325 000001DD 7615                    	jna	short chk_11khz_1
   326 000001DF BB[CC180000]            	mov	ebx, load_11khz_stereo_16_bit
   327 000001E4 803D[24680000]01        	cmp	byte [stmo], 1 
   328 000001EB 751A                    	jne	short chk_11khz_2
   329 000001ED BB[53180000]            	mov	ebx, load_11khz_mono_16_bit
   330 000001F2 EB13                    	jmp	short chk_11khz_2
   331                                  chk_11khz_1:
   332 000001F4 BB[D9170000]            	mov	ebx, load_11khz_stereo_8_bit
   333 000001F9 803D[24680000]01        	cmp	byte [stmo], 1 
   334 00000200 7505                    	jne	short chk_11khz_2
   335 00000202 BB[61170000]            	mov	ebx, load_11khz_mono_8_bit
   336                                  chk_11khz_2:
   337 00000207 B8AD0E0000              	mov	eax, 3757  ; (221*17)
   338 0000020C BA4A000000              	mov	edx, 74
   339 00000211 B911000000              	mov	ecx, 17
   340 00000216 E96F010000              	jmp	set_sizes 
   341                                  chk_44khz:
   342 0000021B 663D44AC                	cmp	ax, 44100
   343 0000021F 7545                    	jne	short chk_16khz
   344 00000221 803D[25680000]08        	cmp	byte [bps], 8
   345 00000228 7615                    	jna	short chk_44khz_1
   346 0000022A BB[F31A0000]            	mov	ebx, load_44khz_stereo_16_bit
   347 0000022F 803D[24680000]01        	cmp	byte [stmo], 1 
   348 00000236 751A                    	jne	short chk_44khz_2
   349 00000238 BB[7A1A0000]            	mov	ebx, load_44khz_mono_16_bit
   350 0000023D EB13                    	jmp	short chk_44khz_2
   351                                  chk_44khz_1:
   352 0000023F BB[FD190000]            	mov	ebx, load_44khz_stereo_8_bit
   353 00000244 803D[24680000]01        	cmp	byte [stmo], 1 
   354 0000024B 7505                    	jne	short chk_44khz_2
   355 0000024D BB[81190000]            	mov	ebx, load_44khz_mono_8_bit
   356                                  chk_44khz_2:
   357 00000252 B8D93A0000              	mov	eax, 15065 ; (655*23)
   358 00000257 BA19000000              	mov	edx, 25
   359 0000025C B917000000              	mov	ecx, 23
   360 00000261 E924010000              	jmp	set_sizes 
   361                                  chk_16khz:
   362 00000266 663D803E                	cmp	ax, 16000
   363 0000026A 7545                    	jne	short chk_8khz
   364 0000026C 803D[25680000]08        	cmp	byte [bps], 8
   365 00000273 7615                    	jna	short chk_16khz_1
   366 00000275 BB[58100000]            	mov	ebx, load_16khz_stereo_16_bit
   367 0000027A 803D[24680000]01        	cmp	byte [stmo], 1 
   368 00000281 751A                    	jne	short chk_16khz_2
   369 00000283 BB[D70F0000]            	mov	ebx, load_16khz_mono_16_bit
   370 00000288 EB13                    	jmp	short chk_16khz_2
   371                                  chk_16khz_1:
   372 0000028A BB[1D0F0000]            	mov	ebx, load_16khz_stereo_8_bit
   373 0000028F 803D[24680000]01        	cmp	byte [stmo], 1 
   374 00000296 7505                    	jne	short chk_16khz_2
   375 00000298 BB[9E0E0000]            	mov	ebx, load_16khz_mono_8_bit
   376                                  chk_16khz_2:
   377 0000029D B855150000              	mov	eax, 5461
   378 000002A2 BA03000000              	mov	edx, 3
   379 000002A7 B901000000              	mov	ecx, 1
   380 000002AC E9D9000000              	jmp	set_sizes 
   381                                  chk_8khz:
   382 000002B1 663D401F                	cmp	ax, 8000
   383 000002B5 7545                    	jne	short chk_24khz
   384 000002B7 803D[25680000]08        	cmp	byte [bps], 8
   385 000002BE 7615                    	jna	short chk_8khz_1
   386 000002C0 BB[530D0000]            	mov	ebx, load_8khz_stereo_16_bit
   387 000002C5 803D[24680000]01        	cmp	byte [stmo], 1 
   388 000002CC 751A                    	jne	short chk_8khz_2
   389 000002CE BB[830C0000]            	mov	ebx, load_8khz_mono_16_bit
   390 000002D3 EB13                    	jmp	short chk_8khz_2
   391                                  chk_8khz_1:
   392 000002D5 BB[530B0000]            	mov	ebx, load_8khz_stereo_8_bit
   393 000002DA 803D[24680000]01        	cmp	byte [stmo], 1 
   394 000002E1 7505                    	jne	short chk_8khz_2
   395 000002E3 BB[760A0000]            	mov	ebx, load_8khz_mono_8_bit
   396                                  chk_8khz_2:
   397 000002E8 B8AA0A0000              	mov	eax, 2730
   398 000002ED BA06000000              	mov	edx, 6
   399 000002F2 B901000000              	mov	ecx, 1
   400 000002F7 E98E000000              	jmp	set_sizes 
   401                                  chk_24khz:
   402 000002FC 663DC05D                	cmp	ax, 24000
   403 00000300 7542                    	jne	short chk_32khz
   404 00000302 803D[25680000]08        	cmp	byte [bps], 8
   405 00000309 7615                    	jna	short chk_24khz_1
   406 0000030B BB[82120000]            	mov	ebx, load_24khz_stereo_16_bit
   407 00000310 803D[24680000]01        	cmp	byte [stmo], 1 
   408 00000317 751A                    	jne	short chk_24khz_2
   409 00000319 BB[1F120000]            	mov	ebx, load_24khz_mono_16_bit
   410 0000031E EB13                    	jmp	short chk_24khz_2
   411                                  chk_24khz_1:
   412 00000320 BB[95110000]            	mov	ebx, load_24khz_stereo_8_bit
   413 00000325 803D[24680000]01        	cmp	byte [stmo], 1 
   414 0000032C 7505                    	jne	short chk_24khz_2
   415 0000032E BB[2E110000]            	mov	ebx, load_24khz_mono_8_bit
   416                                  chk_24khz_2:
   417 00000333 B800200000              	mov	eax, 8192
   418 00000338 BA02000000              	mov	edx, 2
   419 0000033D B901000000              	mov	ecx, 1
   420 00000342 EB46                    	jmp	short set_sizes 
   421                                  chk_32khz:
   422 00000344 663D007D                	cmp	ax, 32000
   423 00000348 7574                    	jne	short vra_needed
   424 0000034A 803D[25680000]08        	cmp	byte [bps], 8
   425 00000351 7615                    	jna	short chk_32khz_1
   426 00000353 BB[83140000]            	mov	ebx, load_32khz_stereo_16_bit
   427 00000358 803D[24680000]01        	cmp	byte [stmo], 1 
   428 0000035F 751A                    	jne	short chk_32khz_2
   429 00000361 BB[19140000]            	mov	ebx, load_32khz_mono_16_bit
   430 00000366 EB13                    	jmp	short chk_32khz_2
   431                                  chk_32khz_1:
   432 00000368 BB[7C130000]            	mov	ebx, load_32khz_stereo_8_bit
   433 0000036D 803D[24680000]01        	cmp	byte [stmo], 1 
   434 00000374 7505                    	jne	short chk_32khz_2
   435 00000376 BB[09130000]            	mov	ebx, load_32khz_mono_8_bit
   436                                  chk_32khz_2:
   437 0000037B B8AA2A0000              	mov	eax, 10922
   438 00000380 BA03000000              	mov	edx, 3
   439 00000385 B902000000              	mov	ecx, 2
   440                                  	;jmp	short set_sizes 
   441                                  set_sizes:
   442 0000038A 803D[24680000]01        	cmp	byte [stmo], 1
   443 00000391 7402                    	je	short ss_1
   444 00000393 D1E0                    	shl	eax, 1
   445                                  ss_1:
   446 00000395 803D[25680000]08        	cmp	byte [bps], 8
   447 0000039C 7602                    	jna	short ss_2
   448                                  	; 16 bit samples
   449 0000039E D1E0                    	shl	eax, 1
   450                                  ss_2:
   451 000003A0 A3[DD030000]            	mov	[loadsize], eax
   452 000003A5 F7E2                    	mul	edx
   453                                  	;cmp	ecx, 1
   454                                  	;je	short ss_3
   455                                  ;ss_3:
   456 000003A7 F7F1                    	div	ecx
   457 000003A9 8A0D[9B680000]          	mov	cl, [fbs_shift]
   458 000003AF D3E0                    	shl	eax, cl
   459                                  	; 26/11/2023
   460                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   461 000003B1 A3[E1030000]            	mov	[buffersize], eax ; buffer size in bytes 
   462 000003B6 891D[D9030000]          	mov	[loadfromwavfile], ebx
   463 000003BC EB27                    	jmp	short PlayNow
   464                                  
   465                                  vra_needed:
   466                                  	sys	_msg, msg_no_vra, 255, 07h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000003BE BB[9E660000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000003C3 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000003C8 BA07000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000003CD B823000000          <1>  mov eax, %1
    90                              <1> 
    91 000003D2 CD40                <1>  int 40h
   467 000003D4 E9EA000000              	jmp	Exit
   468                                  
   469                                  	; 26/11/2023
   470                                  	; 13/11/2023
   471                                  loadfromwavfile:
   472 000003D9 [A3050000]              	dd	loadFromFile
   473                                  loadsize:	; read from wav file
   474 000003DD 00000000                	dd	0
   475                                  buffersize:	; write to DMA buffer
   476 000003E1 00000100                	dd	65536 ; bytes
   477                                  
   478                                  ; -----------------------------------
   479                                  
   480                                  	; 23/08/2020
   481                                  PlayNow: 
   482                                  	; 27/10/2017
   483 000003E5 66B90001                	mov	cx, 256
   484 000003E9 31DB                    	xor	ebx, ebx
   485 000003EB BF[B0680000]            	mov	edi, RowOfs
   486                                  MakeOfs:
   487                                  	; 29/10/2017
   488                                  	;mov	ax, 128
   489                                  	;mul	bx
   490                                  	;mov	al, ah
   491                                  	;mov	ah, 80
   492                                  	;mul	ah
   493 000003F0 89D8                    	mov	eax, ebx
   494 000003F2 66C1E007                	shl	ax, 7 ; * 128
   495 000003F6 B050                    	mov	al, 80
   496 000003F8 F6E4                    	mul	ah
   497 000003FA 66AB                    	stosw
   498 000003FC 43                      	inc	ebx
   499 000003FD E2F1                    	loop	MakeOfs
   500                                  
   501                                  	; 23/08/2020
   502                                  
   503                                  	; DIRECT VGA MEMORY ACCESS
   504                                  	; bl = 0, bh = 5
   505                                  	; Direct access/map to VGA memory (0A0000h)
   506                                  
   507                                  	sys	_video, 0500h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000003FF BB00050000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000404 B81F000000          <1>  mov eax, %1
    90                              <1> 
    91 00000409 CD40                <1>  int 40h
   508 0000040B 3D00000A00              	cmp	eax, 0A0000h
   509 00000410 7405                    	je	short _4
   510                                  	; 09/12/2023
   511 00000412 E9AEFCFFFF              	jmp	error_exit
   512                                  
   513                                  
   514                                  ; Note: Normally IRQ 0 calls the ModPlay Polling at 18.2Hz thru
   515                                  ;       the software interrupt 1Ch. If the IRQ 0 is disabled, then
   516                                  ;       the INT 1Ch MUST BE CALLED at least MixSpeed/1024 times per
   517                                  ;       second, or the module will sound "looped".
   518                                  ;       Because we need better sync with the ModPlayer to draw the scope,
   519                                  ;       the polling is called from my routine, and then the irq 0 must be
   520                                  ;       disabled. The [DmaBuffer] points to the current buffer of 8-bit
   521                                  ;       samples played by the Sound Blaster. Note that some samples are
   522                                  ;       discarded in the next code, just for fun!
   523                                  
   524                                  _4:
   525                                  	;mov     ax, 0013h	; Set Mode 320x200x256
   526                                  	;int     31h
   527                                  
   528                                  	; 21/10/2017
   529                                  	;mov	ax, 0012h	; Set Mode 640x480x16
   530                                  	;int	31h
   531                                  
   532                                  	; 22/10/2017
   533 00000417 E8A51C0000              	call	setgraphmode	; Set video mode to 640*480x16
   534                                  
   535                                  	; 22/10/2017
   536                                  	;call	loadlbm
   537                                  	;jc	short loadlbm_err
   538                                  
   539 0000041C BE[EE220000]            	mov	esi, LOGO_ADDRESS
   540 00000421 E88D1D0000              	call	putlbm
   541                                  	;jnc	short loadlbm_ok
   542 00000426 731D                    	jnc	short _5 ; 
   543                                  
   544                                  	;mov	byte [error_color], 0Eh ; Yellow
   545                                  
   546                                  loadlbm_err:
   547                                  	; 21/10/2017
   548                                  	;mov	ax, 0003h	; Set Text Mode 80x25x16
   549                                  	;int	31h
   550                                  	; 22/10/2017
   551 00000428 E8B11C0000              	call	settextmode
   552                                  
   553                                  	sys	_msg, LOGO_ERROR_MSG, 255, 0Ch
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000042D BB[C1220000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000432 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000437 BA0C000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000043C B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000441 CD40                <1>  int 40h
   554 00000443 EB7E                    	jmp	short Exit
   555                                  
   556                                  loadlbm_ok: 
   557                                  	; 21/10/2017
   558                                  _5:
   559                                  	; 09/10/2017 (2*BUFFERSIZE, 64K)
   560                                  	; 23/06/2017
   561                                  	; Map DMA buffer to user's memory space
   562                                  	;sys	_audio, 0D00h, 2*BUFFERSIZE, DMA_Buffer
   563                                  	; 09/12/2023
   564 00000445 A1[E1030000]            	mov	eax, [buffersize]
   565 0000044A D1E0                    	shl	eax, 1 ; *2
   566                                  	; round up to page boundary (may not be necessary)
   567 0000044C 05FF0F0000              	add	eax, 4095
   568 00000451 2500F0FFFF              	and	eax, ~4095
   569 00000456 A3[B0720000]            	mov	[DMA_buffer_size], eax
   570                                  	;sys	_audio, 0D00h, 131072, DMA_Buffer
   571                                  	sys	_audio, 0D00h, [DMA_buffer_size], DMA_Buffer
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000045B BB000D0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000460 8B0D[B0720000]      <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000466 BA[00000200]        <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000046B B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000470 CD40                <1>  int 40h
   572                                  	;jc	error_exit
   573                                  
   574                                  	; 23/08/2020
   575                                  
   576                                  ; position file pointer to start in actual wav data
   577                                  ; MUCH improvement should really be done here to check if sample size is
   578                                  ; supported, make sure there are 2 channels, etc.  
   579                                  ;
   580                                          ;mov     ah, 42h
   581                                          ;mov     al, 0	; from start of file
   582                                          ;mov     bx, [FileHandle]
   583                                          ;xor     cx, cx
   584                                          ;mov     dx, 44	; jump past .wav/riff header
   585                                          ;int     21h
   586                                  
   587                                  	sys	_seek, [FileHandle], 44, 0
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000472 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000478 B92C000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000047D BA00000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000482 B813000000          <1>  mov eax, %1
    90                              <1> 
    91 00000487 CD40                <1>  int 40h
   588                                  
   589                                  ; play the .wav file. Most of the good stuff is in here.
   590                                  
   591 00000489 E8C8010000                      call    PlayWav
   592                                  
   593                                  ; close the .wav file and exit.
   594                                  
   595                                  StopPlaying:
   596                                  	; Stop Playing
   597                                  	sys	_audio, 0700h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000048E BB00070000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000493 B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000498 CD40                <1>  int 40h
   598                                  	; Cancel callback service (for user)
   599                                  	sys	_audio, 0900h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000049A BB00090000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000049F B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000004A4 CD40                <1>  int 40h
   600                                  	; Deallocate Audio Buffer (for user)
   601                                  	sys	_audio, 0A00h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000004A6 BB000A0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000004AB B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000004B0 CD40                <1>  int 40h
   602                                  	; Disable Audio Device
   603                                  	sys	_audio, 0C00h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000004B2 BB000C0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000004B7 B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000004BC CD40                <1>  int 40h
   604                                  
   605                                  	; 23/08/2020
   606 000004BE E81B1C0000              	call	settextmode
   607                                  Exit:  
   608 000004C3 E85C000000                      call    closeFile
   609                                           
   610                                  	sys	_exit	; Bye!
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81                              <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000004C8 B801000000          <1>  mov eax, %1
    90                              <1> 
    91 000004CD CD40                <1>  int 40h
   611                                  here:
   612 000004CF EBFE                    	jmp	short here
   613                                  
   614                                  pmsg_usage:
   615                                  	sys	_msg, msg_usage, 255, 0Bh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000004D1 BB[8C650000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000004D6 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000004DB BA0B000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000004E0 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 000004E5 CD40                <1>  int 40h
   616 000004E7 EBDA                    	jmp	short Exit
   617                                  
   618                                  DetectAC97:
   619                                  	; 09/12/2023
   620                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
   621                                          sys	_audio, 0102h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000004E9 BB02010000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000004EE B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000004F3 CD40                <1>  int 40h
   622 000004F5 7213                    	jc	short DetectAC97_retn
   623                                  
   624                                  	; Get AC'97 Codec info
   625                                  	; (Function 14, sub function 1)
   626                                  	sys	_audio, 0E01h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000004F7 BB010E0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000004FC B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000501 CD40                <1>  int 40h
   627                                  	; Save Variable Rate Audio support bit
   628 00000503 2401                    	and	al, 1
   629 00000505 A2[AC680000]            	mov	[VRA], al
   630                                  
   631                                  DetectAC97_retn:
   632 0000050A C3                      	retn
   633                                  	
   634                                  	; 23/08/2020
   635                                  
   636                                  ;open or create file
   637                                  ;
   638                                  ;input: ds:dx-->filename (asciiz)
   639                                  ;       al=file Mode (create or open)
   640                                  ;output: none  cs:[FileHandle] filled
   641                                  ;
   642                                  openFile:
   643                                  	;mov	ah, 3Bh	; start with a mode
   644                                  	;add	ah, al	; add in create or open mode
   645                                  	;xor	cx, cx
   646                                  	;int	21h
   647                                  	;jc	short _of1
   648                                  	;;mov	[cs:FileHandle], ax
   649                                  
   650                                  	sys	_open, wav_file_name, 0
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000050B BB[48680000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000510 B900000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000515 B805000000          <1>  mov eax, %1
    90                              <1> 
    91 0000051A CD40                <1>  int 40h
   651 0000051C 7205                    	jc	short _of1
   652                                  
   653 0000051E A3[87650000]            	mov	[FileHandle], eax
   654                                  _of1:
   655 00000523 C3                      	retn
   656                                  
   657                                  ; close the currently open file
   658                                  ; input: none, uses cs:[FileHandle]
   659                                  closeFile:
   660 00000524 833D[87650000]FF        	cmp	dword [FileHandle], -1
   661 0000052B 7417                    	je	short _cf1
   662                                  	;mov    bx, [FileHandle]  
   663                                  	;mov    ax, 3E00h
   664                                          ;int    21h              ;close file
   665                                  
   666                                  	sys	_close, [FileHandle]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000052D 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000533 B806000000          <1>  mov eax, %1
    90                              <1> 
    91 00000538 CD40                <1>  int 40h
   667 0000053A C705[87650000]FFFF-     	mov 	dword [FileHandle], -1
   667 00000542 FFFF               
   668                                  _cf1:
   669 00000544 C3                      	retn
   670                                  
   671                                  getSampleRate:
   672                                  	
   673                                  ; reads the sample rate from the .wav file.
   674                                  ; entry: none - assumes file is already open
   675                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
   676                                  ;	cx = number of channels (mono=1, stereo=2)
   677                                  ;	dx = bits per sample (8, 16)
   678                                  
   679 00000545 53                      	push    ebx
   680                                  
   681                                          ;mov	ah, 42h
   682                                          ;mov	al, 0	; from start of file
   683                                          ;mov	bx, [FileHandle]
   684                                          ;xor	cx, cx
   685                                          ;mov	dx, 08h	; "WAVE"
   686                                          ;int	21h
   687                                  	
   688                                  	sys	_seek, [FileHandle], 8, 0
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000546 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000054C B908000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000551 BA00000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000556 B813000000          <1>  mov eax, %1
    90                              <1> 
    91 0000055B CD40                <1>  int 40h
   689                                  
   690                                          ;mov	dx, smpRBuff
   691                                          ;mov	cx, 28	; 28 bytes
   692                                  	;mov	ah, 3fh
   693                                          ;int	21h
   694                                  
   695                                  	sys	_read, [FileHandle], smpRBuff, 28
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000055D 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000563 B9[2C680000]        <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000568 BA1C000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000056D B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000572 CD40                <1>  int 40h
   696                                  
   697 00000574 813D[2C680000]5741-     	cmp	dword [smpRBuff], 'WAVE'
   697 0000057C 5645               
   698 0000057E 7520                    	jne	short gsr_stc
   699                                  
   700 00000580 66833D[38680000]01      	cmp	word [smpRBuff+12], 1	; Offset 20, must be 1 (= PCM)
   701 00000588 7516                    	jne	short gsr_stc
   702                                  
   703 0000058A 668B0D[3A680000]        	mov	cx, [smpRBuff+14]	; return num of channels in CX
   704 00000591 66A1[3C680000]                  mov     ax, [smpRBuff+16]	; return sample rate in AX
   705 00000597 668B15[46680000]        	mov	dx, [smpRBuff+26]	; return bits per sample value in DX
   706                                  gsr_retn:
   707 0000059E 5B                              pop     ebx
   708 0000059F C3                              retn
   709                                  gsr_stc:
   710 000005A0 F9                      	stc
   711 000005A1 EBFB                    	jmp	short gsr_retn
   712                                  
   713                                  ;=============================================================================
   714                                  
   715                                  ; 09/12/2023	
   716                                  %if 0
   717                                  	; 'playwav6.s'  (27/11/2023)
   718                                  
   719                                  audio_int_handler:
   720                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
   721                                  
   722                                  	;mov	byte [srb], 1 ; interrupt (or signal response byte)
   723                                  	
   724                                  	;cmp	byte [cbs_busy], 1
   725                                  	;jnb	short _callback_bsy_retn
   726                                  	
   727                                  	;mov	byte [cbs_busy], 1
   728                                  
   729                                  	mov	al, [half_buff]
   730                                  
   731                                  	cmp	al, 1
   732                                  	jb	short _callback_retn
   733                                  
   734                                  	; 18/08/2020
   735                                  	mov	byte [srb], 1
   736                                  
   737                                  	xor	byte [half_buff], 3 ; 2->1, 1->2
   738                                  
   739                                  	add	al, '0'
   740                                  tL0:	; 26/11/2023
   741                                  	mov	ah, 4Eh
   742                                  	mov	ebx, 0B8000h ; video display page address
   743                                  	mov	[ebx], ax ; show playing buffer (1, 2)
   744                                  _callback_retn:
   745                                  	;mov	byte [cbs_busy], 0
   746                                  _callback_bsy_retn:
   747                                  	sys	_rele ; return from callback service 
   748                                  	; we must not come here !
   749                                  	sys	_exit
   750                                  
   751                                  %endif
   752                                  
   753                                  ;=============================================================================
   754                                  
   755                                  ; 09/12/2023
   756                                  ; 'playwav6.s' (27/11/2023)
   757                                  
   758                                  loadFromFile:
   759                                  	; 26/11/2023
   760 000005A3 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
   761                                  					; last of the file?
   762 000005AA 7402                    	jz	short lff_0		; no
   763 000005AC F9                      	stc
   764 000005AD C3                      	retn
   765                                  lff_0:
   766                                  	; 13/06/2017
   767                                  	;mov	edx, BUFFERSIZE
   768                                  	; 26/11/2023
   769 000005AE BF[00800000]            	mov	edi, audio_buffer
   770 000005B3 8B15[E1030000]          	mov	edx, [buffersize]	; bytes
   771 000005B9 8A0D[9B680000]          	mov	cl, [fbs_shift]
   772 000005BF 20C9                    	and	cl, cl
   773 000005C1 7409                    	jz	short lff_1 ; stereo, 16 bit
   774                                  
   775                                  	; fbs_shift =
   776                                  	;	2 for mono and 8 bit sample (multiplier = 4)
   777                                  	;	1 for mono or 8 bit sample (multiplier = 2)
   778 000005C3 D3EA                    	shr	edx, cl
   779                                  	;inc	edx
   780                                  
   781 000005C5 BE[00000400]            	mov     esi, temp_buffer
   782 000005CA EB02                    	jmp	short lff_2
   783                                  lff_1:
   784                                  	;mov	esi, audio_buffer
   785 000005CC 89FE                    	mov	esi, edi ; audio_buffer
   786                                  lff_2:
   787                                  	; 17/03/2017
   788                                  	; esi = buffer address
   789                                  	; edx = buffer size
   790                                   
   791                                  	; 26/11/2023
   792                                  	; load file into memory
   793                                  	sys 	_read, [FileHandle], esi
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000005CE 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000005D4 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000005D6 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000005DB CD40                <1>  int 40h
   794                                  	; 14/12/2024
   795 000005DD 8B0D[E1030000]          	mov	ecx, [buffersize]
   796                                  	;jc	short padfill ; error !
   797                                  	; 14/12/2024
   798 000005E3 7255                    	jc	short lff_10
   799                                  
   800 000005E5 21C0                    	and	eax, eax
   801 000005E7 7453                    	jz	short padfill
   802                                  lff_3:
   803                                  	; 26/11/2023
   804 000005E9 8A1D[9B680000]          	mov	bl, [fbs_shift]
   805 000005EF 20DB                    	and	bl, bl
   806 000005F1 7456                    	jz	short lff_11
   807                                  
   808                                  	; 14/12/2024
   809                                  	;sub	ecx, eax
   810                                  	;mov	ebp, ecx
   811                                  	; 14/12/2024
   812 000005F3 29C2                    	sub	edx, eax
   813                                  
   814                                  	;mov	esi, temp_buffer
   815                                  	;mov	edi, audio_buffer
   816 000005F5 89C1                    	mov	ecx, eax   ; byte count
   817                                  
   818 000005F7 803D[25680000]08        	cmp	byte [bps], 8 ; bits per sample (8 or 16)
   819 000005FE 751E                    	jne	short lff_6 ; 16 bit samples
   820                                  	; 8 bit samples
   821 00000600 FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
   822 00000602 740E                    	jz	short lff_5 ; 8 bit, stereo
   823                                  lff_4:
   824                                  	; mono & 8 bit
   825 00000604 AC                      	lodsb
   826 00000605 2C80                    	sub	al, 80h ; 08/11/2023
   827 00000607 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
   828 0000060A 66AB                    	stosw	; left channel
   829 0000060C 66AB                    	stosw	; right channel
   830 0000060E E2F4                    	loop	lff_4
   831 00000610 EB16                    	jmp	short lff_8
   832                                  lff_5:
   833                                  	; stereo & 8 bit
   834 00000612 AC                      	lodsb
   835 00000613 2C80                    	sub	al, 80h ; 08/11/2023
   836 00000615 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
   837 00000618 66AB                    	stosw
   838 0000061A E2F6                    	loop	lff_5
   839 0000061C EB0A                    	jmp	short lff_8
   840                                  lff_6:
   841 0000061E D1E9                    	shr	ecx, 1 ; word count
   842                                  lff_7:
   843 00000620 66AD                    	lodsw
   844 00000622 66AB                    	stosw	; left channel
   845 00000624 66AB                    	stosw	; right channel
   846 00000626 E2F8                    	loop	lff_7
   847                                  lff_8:
   848                                  	; 27/11/2023
   849 00000628 F8                      	clc
   850                                  	; 14/12/2024
   851                                  	;mov	ecx, ebp
   852                                  	;jecxz	endLFF_retn
   853 00000629 09D2                    	or	edx, edx
   854 0000062B 741B                    	jz	short endLFF_retn
   855                                  
   856                                  	; 14/12/2024
   857 0000062D B9[00800000]            	mov	ecx, audio_buffer
   858 00000632 030D[E1030000]          	add	ecx, [buffersize]
   859 00000638 29F9                    	sub	ecx, edi
   860                                  
   861                                  	; 14/12/2024
   862                                  lff_10:
   863 0000063A 31C0                    	xor	eax, eax ; silence
   864                                  padfill:
   865 0000063C D1E9                    	shr	ecx, 1
   866 0000063E F366AB                  	rep	stosw
   867                                  lff_9:
   868 00000641 800D[A8680000]01                or	byte [flags], ENDOFFILE	; end of file flag
   869                                  endLFF_retn:
   870 00000648 C3                              retn
   871                                  
   872                                  lff_11:
   873                                  	; 16 bit stereo
   874                                  	; ecx = buffer size
   875                                  	; eax = read count
   876 00000649 29C1                    	sub	ecx, eax
   877 0000064B 76FB                    	jna	short endLFF_retn
   878 0000064D 01C7                    	add	edi, eax  ; audio_buffer + eax
   879 0000064F EBE9                    	jmp	short lff_10 ; padfill
   880                                  
   881                                  error_exit_2:
   882                                  	; 26/11/2023 - temporary
   883                                  	;sys	_msg, test_2, 255, 0Ch
   884 00000651 E96FFAFFFF              	jmp	error_exit
   885                                  
   886                                  ;=============================================================================
   887                                  ;      
   888                                  ;=============================================================================
   889                                  
   890                                  PlayWav:
   891                                  	; 09/12/2023
   892                                  	;; 23/08/2020
   893                                  	;; load 32768 bytes into audio buffer
   894                                  	;;mov	edi, audio_buffer
   895                                  	;;mov	edx, BUFFERSIZE
   896                                  	;call	loadFromFile
   897                                  	; 09/12/2023
   898 00000656 FF15[D9030000]          	call	dword [loadfromwavfile]
   899 0000065C 72F3                    	jc	short error_exit_2
   900                                  
   901                                  	;mov	byte [half_buff], 1 ; (DMA) Buffer 1
   902                                  
   903                                  	; 18/08/2020 (27/07/2020, 'wavplay2.s')
   904 0000065E F605[A8680000]01        	test    byte [flags], ENDOFFILE  ; end of file
   905 00000665 7512                    	jnz	short _6 ; yes
   906                                  			 ; bypass filling dma half buffer 2
   907                                  
   908                                  	; bh = 16 : update (current, first) dma half buffer
   909                                  	; bl = 0  : then switch to the next (second) half buffer
   910                                  	sys	_audio, 1000h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000667 BB00100000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000066C B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000671 CD40                <1>  int 40h
   911                                  
   912                                  	; 27/07/2020
   913                                  	; [audio_flag] = 1  (in TRDOS 386 kernel)
   914                                  
   915                                  	; audio_buffer must be filled again after above system call 
   916                                  	; (Because audio interrupt will be generated by VT8237R
   917                                  	; at the end of the first half of dma buffer.. so, 
   918                                  	; the second half must be ready. 'sound_play' will use it.)
   919                                  
   920                                  	; 09/12/2023
   921                                  	;; 13/10/2017
   922                                  	;;mov	edi, audio_buffer
   923                                  	;;mov	edx, BUFFERSIZE
   924                                  	;call    loadFromFile
   925                                  	; 09/12/2023
   926 00000673 FF15[D9030000]          	call	dword [loadfromwavfile]
   927                                  	;jc	short p_return
   928                                  
   929                                  _6:
   930                                  	; Set Master Volume Level
   931                                  	sys	_audio, 0B00h, 1D1Dh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000679 BB000B0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000067E B91D1D0000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000683 B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000688 CD40                <1>  int 40h
   932                                  	; 24/06/2017
   933                                  	;mov	byte [volume_level], 1Dh
   934 0000068A 880D[AB680000]          	mov	[volume_level], cl	
   935                                  
   936                                  	;mov	byte [srb], 0
   937                                  
   938                                  	; Start	to play
   939 00000690 A0[25680000]            	mov	al, [bps]
   940 00000695 C0E804                  	shr	al, 4 ; 8 -> 0, 16 -> 1
   941 00000698 D0E0                    	shl	al, 1 ; 16 -> 2, 8 -> 0
   942 0000069A 8A1D[24680000]          	mov	bl, [stmo]
   943 000006A0 FECB                    	dec	bl
   944 000006A2 08C3                    	or	bl, al
   945 000006A4 668B0D[26680000]        	mov	cx, [sample_rate] 
   946 000006AB B704                    	mov	bh, 4 ; start to play	
   947                                  	sys	_audio
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81                              <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000006AD B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000006B2 CD40                <1>  int 40h
   948                                  
   949                                  	; 27/07/2020
   950                                  	; Here..
   951                                  	; If byte [flags] <> ENDOFFILE ...
   952                                  	; user's audio_buffer has been copied to dma half buffer 2
   953                                  
   954                                  	; [audio_flag] = 0  (in TRDOS 386 kernel)
   955                                  
   956                                  	; audio_buffer must be filled again after above system call 
   957                                  	; (Because, audio interrupt will be generated by VT8237R
   958                                  	; at the end of the first half of dma buffer.. so, 
   959                                  	; the 2nd half of dma buffer is ready but the 1st half
   960                                  	; must be filled again.)
   961                                  
   962                                  ; 14/12/2024
   963                                  %if 0
   964                                  	; 18/08/2020
   965                                  	test    byte [flags], ENDOFFILE  ; end of file
   966                                  	jnz	short p_loop ; yes
   967                                  
   968                                  	; 18/08/2020
   969                                  	; load 32768 bytes into audio buffer
   970                                  	;; (for the second half of DMA buffer)
   971                                  	; 27/11/2023
   972                                  	; 20/05/2017
   973                                  	;mov	edi, audio_buffer
   974                                  	;mov	edx, BUFFERSIZE
   975                                  	; 26/11/2023
   976                                  	;mov	edx, [buffersize]
   977                                  	;call	loadFromFile
   978                                  	; 26/11/2023
   979                                  	call	dword [loadfromwavfile]
   980                                  	;jc	short p_return
   981                                  	;mov	byte [half_buff], 2 ; (DMA) Buffer 2
   982                                  %endif
   983                                  
   984                                  	; we need to wait for 'SRB' (audio interrupt)
   985                                  	; (we can not return from 'PlayWav' here 
   986                                  	;  even if we have got an error from file reading)
   987                                  	; ((!!current audio data must be played!!))
   988                                  
   989                                  	;mov	ebx, 0B8000h ; video display page address
   990                                  	;mov	ah, 4Eh
   991                                  	;add	al, [half_buffer]
   992                                  	;mov	[ebx], ax ; show playing buffer (1, 2)
   993                                  
   994                                  	;; load 32768 bytes into audio buffer
   995                                  	;; (for the second half of DMA buffer)
   996                                  	;; 20/05/2017
   997                                  	;mov	edi, audio_buffer
   998                                  	;mov	edx, BUFFERSIZE
   999                                  	;call	loadFromFile
  1000                                  	;jc	short p_return
  1001                                  	;mov	byte [half_buff], 2 ; (DMA) Buffer 2
  1002                                  
  1003                                  	; 23/08/2020
  1004                                  
  1005                                  	; 27/10/2017
  1006                                  	
  1007                                  	; 03/08/2020
  1008                                       	;jmp	short modp_gs ; 23/06/2017
  1009                                  
  1010                                  	; 24/08/2020
  1011 000006B4 FE05[AA680000]          	inc	byte [counter]
  1012                                  p_loop:
  1013 000006BA 803D[A9680000]00        	cmp	byte [srb], 0
  1014 000006C1 761D                    	jna	short q_loop
  1015                                  
  1016 000006C3 C605[A9680000]00        	mov	byte [srb], 0
  1017                                  modp_gs:
  1018                                  	; 24/08/2020
  1019                                  	;mov	edi, audio_buffer
  1020                                  	;mov	edx, BUFFERSIZE
  1021                                  	; 09/12/2023
  1022                                  	;call	loadFromFile
  1023                                  	;mov	edx, [buffersize]
  1024 000006CA FF15[D9030000]          	call	dword [loadfromwavfile]
  1025 000006D0 7246                    	jc	short q_return
  1026                                  
  1027                                  	; 14/12/2024
  1028                                  	;;;
  1029                                  	; bh = 16 : update (current, first) dma half buffer
  1030                                  	; bl = 0  : then switch to the other half buffer
  1031                                  	sys	_audio, 1000h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000006D2 BB00100000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000006D7 B820000000          <1>  mov eax, %1
    90                              <1> 
    91 000006DC CD40                <1>  int 40h
  1032                                  	;;;
  1033                                  
  1034                                  	; 23/08/2020
  1035 000006DE EB6B                    	jmp	r_loop
  1036                                  q_loop:
  1037                                  	; 24/08/2020
  1038 000006E0 F605[AA680000]3F        	test	byte [counter], 63
  1039 000006E7 7562                    	jnz	short r_loop
  1040                                  k_loop:
  1041 000006E9 B401                    	mov     ah, 1		; any key pressed?
  1042 000006EB CD32                    	int     32h		; no, Loop.
  1043 000006ED 745C                    	jz	short r_loop
  1044                                  
  1045 000006EF B400                    	mov     ah, 0		; flush key buffer...
  1046 000006F1 CD32                    	int     32h
  1047                                  
  1048                                  	; 19/10/2017 (modplay6.s)
  1049 000006F3 3C20                    	cmp	al, 20h
  1050 000006F5 740E                    	je	short change_pan
  1051                                  	; 09/10/2017 (playmod5.s)
  1052 000006F7 3C2B                    	cmp	al, '+' ; increase sound volume
  1053 000006F9 741E                    	je	short inc_volume_level
  1054 000006FB 3C2D                    	cmp	al, '-'
  1055 000006FD 743D                    	je	short dec_volume_level
  1056                                  
  1057                                  	; 19/10/2017 (modplay6.s)
  1058 000006FF 24DF                    	and	al, 0DFh
  1059 00000701 3C50                    	cmp	al, 'P'
  1060 00000703 7513                    	jne	short q_return
  1061                                  
  1062                                  change_pan:
  1063                                  	; 19/10/2017 (modplay6.s)
  1064 00000705 8A0D[AD680000]          	mov	cl, [pan_shift]
  1065 0000070B FEC1                    	inc	cl
  1066 0000070D 80E103                  	and	cl, 3
  1067 00000710 880D[AD680000]          	mov	[pan_shift], cl
  1068 00000716 EB33                    	jmp	short r_loop
  1069                                  
  1070                                  q_return:
  1071 00000718 C3                      	retn
  1072                                  
  1073                                  	; 09/10/2017 (playmod5.s)
  1074                                  	; 24/06/2017 (wavplay2.s)
  1075                                  inc_volume_level:
  1076 00000719 8A0D[AB680000]          	mov	cl, [volume_level]
  1077 0000071F 80F91F                  	cmp	cl, 1Fh ; 31
  1078                                  	;jnb	short r_loop
  1079                                  	; 09/12/2023
  1080 00000722 73C5                    	jnb	short k_loop
  1081 00000724 FEC1                    	inc	cl
  1082                                  change_volume_level:
  1083 00000726 880D[AB680000]          	mov	[volume_level], cl
  1084 0000072C 88CD                    	mov	ch, cl
  1085                                  	; Set Master Volume Level
  1086                                  	sys	_audio, 0B00h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000072E BB000B0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83                              <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000733 B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000738 CD40                <1>  int 40h
  1087 0000073A EB0F                    	jmp	short r_loop
  1088                                  dec_volume_level:
  1089 0000073C 8A0D[AB680000]          	mov	cl, [volume_level]
  1090 00000742 80F901                  	cmp	cl, 1 ; 1
  1091                                  	;jna	short r_loop
  1092                                  	; 09/12/2023
  1093 00000745 76A2                    	jna	short k_loop
  1094 00000747 FEC9                    	dec	cl
  1095 00000749 EBDB                    	jmp	short change_volume_level
  1096                                  
  1097                                  r_loop:
  1098                                  	; 24/08/2020
  1099 0000074B FE05[AA680000]          	inc	byte [counter]
  1100                                  	; 09/12/2023
  1101                                  	;jnz	short q_loop
  1102                                  	;test	byte [counter], 0Fh
  1103 00000751 758D                    	jnz	short q_loop
  1104                                  _10:
  1105                                  	; 09/12/2023
  1106 00000753 F605[9B680000]FF        	test	byte [fbs_shift], 0FFh
  1107 0000075A 7405                    	jz	short _9
  1108                                  
  1109                                  	; 23/08/2020
  1110                                  	;test	byte [stmo], 2
  1111                                  	;;jz	p_loop
  1112                                  	;; 09/12/2023
  1113                                  	;jz	short _8
  1114                                  	;cmp	byte [bps], 16
  1115                                  	;;jne	p_loop
  1116                                  	;; 09/12/2023
  1117                                  	;je	short _9
  1118                                  _8:
  1119 0000075C E959FFFFFF              	jmp	p_loop
  1120                                  
  1121                                  _9:
  1122                                  	; 27/10/2017
  1123                                  	; Get Current DMA buffer Pointer 
  1124                                  	; 23/06/2017 ('modplay6.s')
  1125                                  	; bh = 15, get current pointer (DMA buffer offset)
  1126                                  	; bl = 0, for PCM OUT
  1127                                  	; ecx = 0
  1128                                  	;
  1129                                  	sys	_audio, 0F00h, 0
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000761 BB000F0000          <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000766 B900000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85                              <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000076B B820000000          <1>  mov eax, %1
    90                              <1> 
    91 00000770 CD40                <1>  int 40h
  1130                                  
  1131                                  	; 28/10/2017
  1132 00000772 24FC                    	and	al, 0FCh  ; dword alignment (stereo, 16 bit)	
  1133                                  	; 23/06/2017
  1134 00000774 BE[00000200]            	mov     esi, DMA_Buffer
  1135 00000779 01C6                    	add     esi, eax	; add offset value
  1136                                  
  1137                                  	; 24/06/2017
  1138                                  	;mov	ecx, DMA_Buffer + (65536 - (256*4))
  1139                                  	; 09/12/2023
  1140 0000077B 8B0D[B0720000]          	mov	ecx, [DMA_buffer_size]
  1141 00000781 81C1[00FC0100]          	add	ecx, DMA_Buffer - (256*4)
  1142                                  
  1143 00000787 39CE                    	cmp	esi, ecx 
  1144 00000789 7602                    	jna	short _7
  1145 0000078B 89CE                    	mov	esi, ecx
  1146                                  _7:
  1147                                  	; 23/10/2017 ('tmodplay.s')
  1148 0000078D E853190000              	call	drawscopes
  1149                                  
  1150 00000792 E923FFFFFF              	jmp	p_loop
  1151                                  
  1152                                  ;=============================================================================
  1153                                  ; 
  1154                                  ;=============================================================================
  1155                                  
  1156                                  ;dword2str:
  1157                                  ;	; 13/11/2016 - Erdogan Tan 
  1158                                  ;	; eax = dword value
  1159                                  ;	;
  1160                                  ;	call	dwordtohex
  1161                                  ;	mov	[dword_str], edx
  1162                                  ;	mov	[dword_str+4], eax
  1163                                  ;	mov	si, dword_str
  1164                                  ;	retn
  1165                                  
  1166                                  	; 05/03/2017 (TRDOS 386)
  1167                                  	; trdos386.s (unix386.s) - 10/05/2015
  1168                                  	; Convert binary number to hexadecimal string
  1169                                  
  1170                                  ;bytetohex:
  1171                                  ;	; INPUT ->
  1172                                  ;	; 	AL = byte (binary number)
  1173                                  ;	; OUTPUT ->
  1174                                  ;	;	AX = hexadecimal string
  1175                                  ;	;
  1176                                  ;	push	ebx
  1177                                  ;	movzx	ebx, al
  1178                                  ;	shr	bl, 4
  1179                                  ;	mov	bl, [ebx+hex_chars] 	 	
  1180                                  ;	xchg	bl, al
  1181                                  ;	and	bl, 0Fh
  1182                                  ;	mov	ah, [ebx+hex_chars] 
  1183                                  ;	pop	ebx	
  1184                                  ;	retn
  1185                                  
  1186                                  ;wordtohex:
  1187                                  ;	; INPUT ->
  1188                                  ;	; 	AX = word (binary number)
  1189                                  ;	; OUTPUT ->
  1190                                  ;	;	EAX = hexadecimal string
  1191                                  ;	;
  1192                                  ;	push	ebx
  1193                                  ;	xor	ebx, ebx
  1194                                  ;	xchg	ah, al
  1195                                  ;	push	eax
  1196                                  ;	mov	bl, ah
  1197                                  ;	shr	bl, 4
  1198                                  ;	mov	al, [ebx+hex_chars] 	 	
  1199                                  ;	mov	bl, ah
  1200                                  ;	and	bl, 0Fh
  1201                                  ;	mov	ah, [ebx+hex_chars]
  1202                                  ;	shl	eax, 16
  1203                                  ;	pop	eax
  1204                                  ;	pop	ebx
  1205                                  ;	jmp	short bytetohex
  1206                                  
  1207                                  ;dwordtohex:
  1208                                  ;	; INPUT ->
  1209                                  ;	; 	EAX = dword (binary number)
  1210                                  ;	; OUTPUT ->
  1211                                  ;	;	EDX:EAX = hexadecimal string
  1212                                  ;	;
  1213                                  ;	push	eax
  1214                                  ;	shr	eax, 16
  1215                                  ;	call	wordtohex
  1216                                  ;	mov	edx, eax
  1217                                  ;	pop	eax
  1218                                  ;	call	wordtohex
  1219                                  ;	retn
  1220                                  
  1221                                  ; 09/12/2023
  1222                                  ; 'playwav6.s' (27/11/2023)
  1223                                  
  1224                                  write_wav_file_info:
  1225                                  	; 01/05/2017
  1226                                  	sys	_msg, msgWavFileName, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000797 BB[7E670000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000079C B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000007A1 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000007A6 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 000007AB CD40                <1>  int 40h
  1227                                  	sys	_msg, wav_file_name, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000007AD BB[48680000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000007B2 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000007B7 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000007BC B823000000          <1>  mov eax, %1
    90                              <1> 
    91 000007C1 CD40                <1>  int 40h
  1228                                  
  1229                                  write_sample_rate:
  1230                                  	; 01/05/2017
  1231 000007C3 66A1[26680000]          	mov	ax, [sample_rate]
  1232                                  	; ax = sample rate (hertz)
  1233 000007C9 31D2                    	xor	edx, edx
  1234 000007CB 66B90A00                	mov	cx, 10
  1235 000007CF 66F7F1                  	div	cx
  1236 000007D2 0015[A3670000]          	add	[msgHertz+4], dl
  1237 000007D8 29D2                    	sub	edx, edx
  1238 000007DA 66F7F1                  	div	cx
  1239 000007DD 0015[A2670000]          	add	[msgHertz+3], dl
  1240 000007E3 29D2                    	sub	edx, edx
  1241 000007E5 66F7F1                  	div	cx
  1242 000007E8 0015[A1670000]          	add	[msgHertz+2], dl
  1243 000007EE 29D2                    	sub	edx, edx
  1244 000007F0 66F7F1                  	div	cx
  1245 000007F3 0015[A0670000]          	add	[msgHertz+1], dl
  1246 000007F9 0005[9F670000]          	add	[msgHertz], al
  1247                                  	
  1248                                  	sys	_msg, msgSampleRate, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000007FF BB[90670000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000804 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000809 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000080E B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000813 CD40                <1>  int 40h
  1249                                  
  1250 00000815 BE[BA670000]            	mov	esi, msg16Bits
  1251 0000081A 803D[25680000]10        	cmp	byte [bps], 16
  1252 00000821 7405                    	je	short wsr_1
  1253 00000823 BE[AA670000]            	mov	esi, msg8Bits
  1254                                  wsr_1:
  1255                                  	sys	_msg, esi, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000828 89F3                <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000082A B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000082F BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000834 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000839 CD40                <1>  int 40h
  1256                                  
  1257 0000083B BE[B3670000]            	mov	esi, msgMono
  1258 00000840 803D[24680000]01        	cmp	byte [stmo], 1
  1259 00000847 7405                    	je	short wsr_2
  1260 00000849 BE[C4670000]            	mov	esi, msgStereo		
  1261                                  wsr_2:
  1262                                  	sys	_msg, esi, 255, 0Fh
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000084E 89F3                <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000850 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000855 BA0F000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000085A B823000000          <1>  mov eax, %1
    90                              <1> 
    91 0000085F CD40                <1>  int 40h
  1263 00000861 C3                              retn
  1264                                  
  1265                                  write_ac97_pci_dev_info:
  1266                                  	; 06/06/2017
  1267                                  	; 03/06/2017
  1268                                  	; BUS/DEV/FN
  1269                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1270                                  	; DEV/VENDOR
  1271                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1272                                  
  1273 00000862 8B35[9C680000]          	mov	esi, [dev_vendor]
  1274 00000868 89F0                    	mov	eax, esi
  1275 0000086A 0FB6D8                  	movzx	ebx, al
  1276 0000086D 88DA                    	mov	dl, bl
  1277 0000086F 80E30F                  	and	bl, 0Fh
  1278 00000872 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1279 00000878 A2[1C670000]            	mov	[msgVendorId+3], al
  1280 0000087D 88D3                    	mov	bl, dl
  1281 0000087F C0EB04                  	shr	bl, 4
  1282 00000882 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1283 00000888 A2[1B670000]            	mov	[msgVendorId+2], al
  1284 0000088D 88E3                    	mov	bl, ah
  1285 0000088F 88DA                    	mov	dl, bl
  1286 00000891 80E30F                  	and	bl, 0Fh
  1287 00000894 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1288 0000089A A2[1A670000]            	mov	[msgVendorId+1], al
  1289 0000089F 88D3                    	mov	bl, dl
  1290 000008A1 C0EB04                  	shr	bl, 4
  1291 000008A4 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1292 000008AA A2[19670000]            	mov	[msgVendorId], al
  1293 000008AF C1E810                  	shr	eax, 16
  1294 000008B2 88C3                    	mov	bl, al
  1295 000008B4 88DA                    	mov	dl, bl
  1296 000008B6 80E30F                  	and	bl, 0Fh
  1297 000008B9 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1298 000008BF A2[2D670000]            	mov	[msgDevId+3], al
  1299 000008C4 88D3                    	mov	bl, dl
  1300 000008C6 C0EB04                  	shr	bl, 4
  1301 000008C9 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1302 000008CF A2[2C670000]            	mov	[msgDevId+2], al
  1303 000008D4 88E3                    	mov	bl, ah
  1304 000008D6 88DA                    	mov	dl, bl
  1305 000008D8 80E30F                  	and	bl, 0Fh
  1306 000008DB 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1307 000008E1 A2[2B670000]            	mov	[msgDevId+1], al
  1308 000008E6 88D3                    	mov	bl, dl
  1309 000008E8 C0EB04                  	shr	bl, 4
  1310 000008EB 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1311 000008F1 A2[2A670000]            	mov	[msgDevId], al
  1312                                  
  1313 000008F6 8B35[A0680000]          	mov	esi, [bus_dev_fn]
  1314 000008FC C1EE08                  	shr	esi, 8
  1315 000008FF 6689F0                  	mov	ax, si
  1316 00000902 88C3                    	mov	bl, al
  1317 00000904 88DA                    	mov	dl, bl
  1318 00000906 80E307                  	and	bl, 7 ; bit 0,1,2
  1319 00000909 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1320 0000090F A2[51670000]            	mov	[msgFncNo+1], al
  1321 00000914 88D3                    	mov	bl, dl
  1322 00000916 C0EB03                  	shr	bl, 3
  1323 00000919 88DA                    	mov	dl, bl
  1324 0000091B 80E30F                  	and	bl, 0Fh
  1325 0000091E 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1326 00000924 A2[43670000]            	mov	[msgDevNo+1], al
  1327 00000929 88D3                    	mov	bl, dl
  1328 0000092B C0EB04                  	shr	bl, 4
  1329 0000092E 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1330 00000934 A2[42670000]            	mov	[msgDevNo], al
  1331 00000939 88E3                    	mov	bl, ah
  1332 0000093B 88DA                    	mov	dl, bl
  1333 0000093D 80E30F                  	and	bl, 0Fh
  1334 00000940 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1335 00000946 A2[37670000]            	mov	[msgBusNo+1], al
  1336 0000094B 88D3                    	mov	bl, dl
  1337 0000094D C0EB04                  	shr	bl, 4
  1338 00000950 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1339 00000956 A2[36670000]            	mov	[msgBusNo], al
  1340                                  
  1341 0000095B 66A1[A4680000]          	mov	ax, [ac97_NamBar]
  1342 00000961 88C3                    	mov	bl, al
  1343 00000963 88DA                    	mov	dl, bl
  1344 00000965 80E30F                  	and	bl, 0Fh
  1345 00000968 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1346 0000096E A2[60670000]            	mov	[msgNamBar+3], al
  1347 00000973 88D3                    	mov	bl, dl
  1348 00000975 C0EB04                  	shr	bl, 4
  1349 00000978 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1350 0000097E A2[5F670000]            	mov	[msgNamBar+2], al
  1351 00000983 88E3                    	mov	bl, ah
  1352 00000985 88DA                    	mov	dl, bl
  1353 00000987 80E30F                  	and	bl, 0Fh
  1354 0000098A 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1355 00000990 A2[5E670000]            	mov	[msgNamBar+1], al
  1356 00000995 88D3                    	mov	bl, dl
  1357 00000997 C0EB04                  	shr	bl, 4
  1358 0000099A 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1359 000009A0 A2[5D670000]            	mov	[msgNamBar], al
  1360                                  
  1361 000009A5 66A1[A6680000]          	mov	ax, [ac97_NabmBar]
  1362 000009AB 88C3                    	mov	bl, al
  1363 000009AD 88DA                    	mov	dl, bl
  1364 000009AF 80E30F                  	and	bl, 0Fh
  1365 000009B2 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1366 000009B8 A2[70670000]            	mov	[msgNabmBar+3], al
  1367 000009BD 88D3                    	mov	bl, dl
  1368 000009BF C0EB04                  	shr	bl, 4
  1369 000009C2 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1370 000009C8 A2[6F670000]            	mov	[msgNabmBar+2], al
  1371 000009CD 88E3                    	mov	bl, ah
  1372 000009CF 88DA                    	mov	dl, bl
  1373 000009D1 80E30F                  	and	bl, 0Fh
  1374 000009D4 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1375 000009DA A2[6E670000]            	mov	[msgNabmBar+1], al
  1376 000009DF 88D3                    	mov	bl, dl
  1377 000009E1 C0EB04                  	shr	bl, 4
  1378 000009E4 8A83[D7660000]          	mov	al, [ebx+hex_chars]
  1379 000009EA A2[6D670000]            	mov	[msgNabmBar], al
  1380                                  
  1381 000009EF 30E4                    	xor	ah, ah
  1382 000009F1 A0[9A680000]            	mov	al, [ac97_int_ln_reg]
  1383 000009F6 B10A                    	mov	cl, 10
  1384 000009F8 F6F1                    	div	cl
  1385 000009FA 660105[79670000]        	add	[msgIRQ], ax
  1386 00000A01 20C0                    	and	al, al
  1387 00000A03 750D                    	jnz	short _w_ac97imsg_
  1388 00000A05 A0[7A670000]            	mov	al, [msgIRQ+1]
  1389 00000A0A B420                    	mov	ah, ' '
  1390 00000A0C 66A3[79670000]          	mov	[msgIRQ], ax
  1391                                  _w_ac97imsg_:
  1392                                  	sys	_msg, msgAC97Info, 255, 07h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000A12 BB[E8660000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000A17 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000A1C BA07000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000A21 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000A26 CD40                <1>  int 40h
  1393                                  
  1394 00000A28 C3                              retn
  1395                                  
  1396                                  write_VRA_info:
  1397                                  	; 25/11/2023
  1398                                  	sys	_msg, msgVRAheader, 255, 07h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000A29 BB[CD670000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000A2E B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000A33 BA07000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000A38 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000A3D CD40                <1>  int 40h
  1399 00000A3F 803D[AC680000]00        	cmp	byte [VRA], 0
  1400 00000A46 7617                    	jna	short _w_VRAi_no
  1401                                  _w_VRAi_yes:
  1402                                  	sys	_msg, msgVRAyes, 255, 07h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000A48 BB[DB670000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000A4D B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000A52 BA07000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000A57 B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000A5C CD40                <1>  int 40h
  1403 00000A5E C3                      	retn
  1404                                  _w_VRAi_no:
  1405                                  	sys	_msg, msgVRAno, 255, 07h
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000A5F BB[E1670000]        <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000A64 B9FF000000          <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000A69 BA07000000          <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000A6E B823000000          <1>  mov eax, %1
    90                              <1> 
    91 00000A73 CD40                <1>  int 40h
  1406 00000A75 C3                      	retn
  1407                                  
  1408                                  ; 09/12/2023
  1409                                  ; --------------------------------------------------------
  1410                                  ; 'playwav6.s' (27/11/2023)
  1411                                  
  1412                                  ; 26/11/2023
  1413                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1414                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1415                                  ; 14/11/2023
  1416                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1417                                  ; --------------------------------------------------------
  1418                                  
  1419                                  ;;Note:	At the end of every buffer load,
  1420                                  ;;	during buffer switch/swap, there will be discontinuity
  1421                                  ;;	between the last converted sample and the 1st sample
  1422                                  ;;	of the next buffer.
  1423                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1424                                  ;;	-To avoid this defect, the 1st sample of
  1425                                  ;;	the next buffer may be read from the wav file but
  1426                                  ;;	the file pointer would need to be set to 1 sample back
  1427                                  ;;	again via seek system call. Time comsumption problem! -
  1428                                  ;;
  1429                                  ;;	Erdogan Tan - 15/11/2023
  1430                                  ;;
  1431                                  ;;	((If entire wav data would be loaded at once.. conversion
  1432                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1433                                  ;;	64KB buffer limit is important also it is important
  1434                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1435                                  ;;	I have tested this program by using 2-30MB wav files.))
  1436                                  ;;
  1437                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1438                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1439                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1440                                  ;;			Realtek ALC850 codec.
  1441                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1442                                  
  1443                                  load_8khz_mono_8_bit:
  1444                                  	; 15/11/2023
  1445                                  	; 14/11/2023
  1446                                  	; 13/11/2023
  1447 00000A76 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1448                                  					; last of the file?
  1449 00000A7D 7402                    	jz	short lff8m_0		; no
  1450 00000A7F F9                      	stc
  1451 00000A80 C3                      	retn
  1452                                  
  1453                                  lff8m_0:
  1454 00000A81 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1455                                          ;mov	edx, [loadsize]
  1456                                  
  1457                                  	; esi = buffer address
  1458                                  	;; edx = buffer size
  1459                                  
  1460                                  	; load file into memory
  1461                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000A86 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000A8C 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000A8E 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000A94 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000A99 CD40                <1>  int 40h
  1462 00000A9B 7305                    	jnc	short lff8m_6
  1463 00000A9D E9AF000000              	jmp	lff8m_5  ; error !
  1464                                  
  1465                                  lff8m_6:
  1466 00000AA2 BF[00800000]            	mov	edi, audio_buffer
  1467 00000AA7 21C0                    	and	eax, eax
  1468 00000AA9 0F8499000000            	jz	lff8_eof
  1469                                  
  1470 00000AAF 89C1                    	mov	ecx, eax		; byte count
  1471                                  lff8m_1:
  1472 00000AB1 AC                      	lodsb
  1473 00000AB2 A2[B8200000]            	mov	[previous_val], al
  1474 00000AB7 2C80                    	sub	al, 80h
  1475 00000AB9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1476 00000ABD 66AB                    	stosw		; original sample (left channel)
  1477 00000ABF 66AB                    	stosw		; original sample (right channel)
  1478                                  	;xor	eax, eax
  1479 00000AC1 B080                    	mov	al, 80h
  1480 00000AC3 49                      	dec	ecx
  1481 00000AC4 7402                    	jz	short lff8m_2
  1482 00000AC6 8A06                    	mov	al, [esi]
  1483                                  lff8m_2:
  1484                                  	;mov	[next_val], ax
  1485 00000AC8 88C7                    	mov	bh, al	; [next_val]
  1486 00000ACA 8A25[B8200000]          	mov	ah, [previous_val]
  1487 00000AD0 00E0                    	add	al, ah	; [previous_val]
  1488 00000AD2 D0D8                    	rcr	al, 1
  1489 00000AD4 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1490 00000AD6 00E0                    	add	al, ah	; [previous_val]
  1491 00000AD8 D0D8                    	rcr	al, 1	
  1492 00000ADA 88C3                    	mov	bl, al 	; this is temporary interpolation value	
  1493 00000ADC 00E0                    	add	al, ah	; [previous_val]
  1494 00000ADE D0D8                    	rcr	al, 1
  1495 00000AE0 2C80                    	sub	al, 80h
  1496 00000AE2 66C1E008                	shl	ax, 8	
  1497 00000AE6 66AB                    	stosw		; this is 1st interpolated sample (L)
  1498 00000AE8 66AB                    	stosw		; this is 1st interpolated sample (R)
  1499 00000AEA 88D8                    	mov	al, bl
  1500 00000AEC 00D0                    	add	al, dl
  1501 00000AEE D0D8                    	rcr	al, 1
  1502 00000AF0 2C80                    	sub	al, 80h
  1503 00000AF2 66C1E008                	shl	ax, 8
  1504 00000AF6 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1505 00000AF8 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1506 00000AFA 88D0                    	mov	al, dl
  1507 00000AFC 2C80                    	sub	al, 80h
  1508 00000AFE 66C1E008                	shl	ax, 8
  1509 00000B02 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1510 00000B04 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1511                                  	;mov	al, [next_val]
  1512 00000B06 88F8                    	mov	al, bh
  1513 00000B08 00D0                    	add	al, dl
  1514 00000B0A D0D8                    	rcr	al, 1
  1515 00000B0C 88C3                    	mov	bl, al	; this is temporary interpolation value
  1516 00000B0E 00D0                    	add	al, dl
  1517 00000B10 D0D8                    	rcr	al, 1
  1518 00000B12 2C80                    	sub	al, 80h
  1519 00000B14 66C1E008                	shl	ax, 8
  1520 00000B18 66AB                    	stosw		; this is 4th interpolated sample (L)
  1521 00000B1A 66AB                    	stosw		; this is 4th interpolated sample (R)
  1522                                  	;mov	al, [next_val]
  1523 00000B1C 88F8                    	mov	al, bh
  1524 00000B1E 00D8                    	add	al, bl
  1525 00000B20 D0D8                    	rcr	al, 1
  1526 00000B22 2C80                    	sub	al, 80h
  1527 00000B24 66C1E008                	shl	ax, 8
  1528 00000B28 66AB                    	stosw		; this is 5th interpolated sample (L)
  1529 00000B2A 66AB                    	stosw		; this is 5th interpolated sample (R)
  1530                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1531 00000B2C 09C9                    	or	ecx, ecx
  1532 00000B2E 7581                    	jnz	short lff8m_1
  1533                                  
  1534                                  	; --------------
  1535                                  
  1536                                  lff8s_3:
  1537                                  lff8m_3:
  1538                                  lff8s2_3:
  1539                                  lff8m2_3:
  1540                                  lff16s_3:
  1541                                  lff16m_3:
  1542                                  lff16s2_3:
  1543                                  lff16m2_3:
  1544                                  lff24_3:
  1545                                  lff32_3:
  1546                                  lff44_3:
  1547                                  lff22_3:
  1548                                  lff11_3:
  1549                                  	; 08/12/2024 (BugFix)
  1550                                  	; 01/06/2024 (BugFix)
  1551 00000B30 8B0D[E1030000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  1552                                  	;shl	ecx, 1	; byte count ; Bug !
  1553                                  	; 08/12/2024
  1554 00000B36 81C1[00800000]          	add	ecx, audio_buffer
  1555 00000B3C 29F9                    	sub	ecx, edi
  1556 00000B3E 7607                    	jna	short lff8m_4
  1557                                  	;inc	ecx
  1558 00000B40 C1E902                  	shr	ecx, 2
  1559 00000B43 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  1560 00000B45 F3AB                    	rep	stosd
  1561                                  lff8m_4:
  1562                                  	; 01/06/2024 (BugFix)
  1563                                  	; cf=1 ; Bug !
  1564                                  	; 08/12/2024
  1565                                  	;clc
  1566 00000B47 C3                      	retn
  1567                                  
  1568                                  lff8_eof:
  1569                                  lff16_eof:
  1570                                  lff24_eof:
  1571                                  lff32_eof:
  1572                                  lff44_eof:
  1573                                  lff22_eof:
  1574                                  lff11_eof:
  1575                                  	; 15/11/2023
  1576 00000B48 C605[A8680000]01        	mov	byte [flags], ENDOFFILE
  1577 00000B4F EBDF                    	jmp	short lff8m_3
  1578                                  
  1579                                  lff8s_5:
  1580                                  lff8m_5:
  1581                                  lff8s2_5:
  1582                                  lff8m2_5:
  1583                                  lff16s_5:
  1584                                  lff16m_5:
  1585                                  lff16s2_5:
  1586                                  lff16m2_5:
  1587                                  lff24_5:
  1588                                  lff32_5:
  1589                                  lff44_5:
  1590                                  lff22_5:
  1591                                  lff11_5:
  1592                                  	; 09/12/2023	
  1593                                  	;mov	al, '!'  ; error
  1594                                  	;call	tL0
  1595                                  	
  1596                                  	;jmp	short lff8m_3
  1597                                  	; 15/11/2023
  1598 00000B51 EBF5                    	jmp	lff8_eof
  1599                                  
  1600                                  	; --------------
  1601                                  
  1602                                  load_8khz_stereo_8_bit:
  1603                                  	; 15/11/2023
  1604                                  	; 14/11/2023
  1605                                  	; 13/11/2023
  1606 00000B53 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1607                                  					; last of the file?
  1608 00000B5A 7402                    	jz	short lff8s_0		; no
  1609 00000B5C F9                      	stc
  1610 00000B5D C3                      	retn
  1611                                  
  1612                                  lff8s_0:
  1613 00000B5E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1614                                          ;mov	edx, [loadsize]
  1615                                  
  1616                                  	; esi = buffer address
  1617                                  	;; edx = buffer size
  1618                                  
  1619                                  	; load file into memory
  1620                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000B63 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000B69 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000B6B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000B71 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000B76 CD40                <1>  int 40h
  1621 00000B78 72D7                    	jc	short lff8s_5 ; error !
  1622                                  
  1623 00000B7A BF[00800000]            	mov	edi, audio_buffer
  1624                                  	
  1625 00000B7F D1E8                    	shr	eax, 1
  1626 00000B81 74C5                    	jz	short lff8_eof
  1627                                  
  1628 00000B83 89C1                    	mov	ecx, eax	; word count
  1629                                  lff8s_1:
  1630 00000B85 AC                      	lodsb
  1631 00000B86 A2[B8200000]            	mov	[previous_val_l], al
  1632 00000B8B 2C80                    	sub	al, 80h
  1633 00000B8D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1634 00000B91 66AB                    	stosw		; original sample (L)
  1635 00000B93 AC                      	lodsb
  1636 00000B94 A2[BA200000]            	mov	[previous_val_r], al
  1637 00000B99 2C80                    	sub	al, 80h
  1638 00000B9B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1639 00000B9F 66AB                    	stosw		; original sample (R)
  1640                                  
  1641                                  	;xor	eax, eax
  1642 00000BA1 66B88080                	mov	ax, 8080h
  1643 00000BA5 49                      	dec	ecx
  1644 00000BA6 7403                    	jz	short lff8s_2
  1645                                  		; convert 8 bit sample to 16 bit sample
  1646 00000BA8 668B06                  	mov	ax, [esi]
  1647                                  lff8s_2:
  1648 00000BAB A2[BC200000]            	mov	[next_val_l], al
  1649 00000BB0 8825[BE200000]          	mov	[next_val_r], ah
  1650 00000BB6 8A25[B8200000]          	mov	ah, [previous_val_l]
  1651 00000BBC 00E0                    	add	al, ah
  1652 00000BBE D0D8                    	rcr	al, 1
  1653 00000BC0 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  1654 00000BC2 00E0                    	add	al, ah
  1655 00000BC4 D0D8                    	rcr	al, 1	
  1656 00000BC6 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1657 00000BC8 00E0                    	add	al, ah
  1658 00000BCA D0D8                    	rcr	al, 1
  1659 00000BCC 2C80                    	sub	al, 80h
  1660 00000BCE 66C1E008                	shl	ax, 8
  1661 00000BD2 66AB                    	stosw		; this is 1st interpolated sample (L)
  1662 00000BD4 A0[BE200000]            	mov	al, [next_val_r]
  1663 00000BD9 8A25[BA200000]          	mov	ah, [previous_val_r]
  1664 00000BDF 00E0                    	add	al, ah
  1665 00000BE1 D0D8                    	rcr	al, 1
  1666 00000BE3 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  1667 00000BE5 00E0                    	add	al, ah
  1668 00000BE7 D0D8                    	rcr	al, 1
  1669 00000BE9 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1670 00000BEB 00E0                    	add	al, ah
  1671 00000BED D0D8                    	rcr	al, 1
  1672 00000BEF 2C80                    	sub	al, 80h
  1673 00000BF1 66C1E008                	shl	ax, 8
  1674 00000BF5 66AB                    	stosw		; this is 1st interpolated sample (R)
  1675 00000BF7 88D8                    	mov	al, bl
  1676 00000BF9 00D0                    	add	al, dl
  1677 00000BFB D0D8                    	rcr	al, 1
  1678 00000BFD 2C80                    	sub	al, 80h
  1679 00000BFF 66C1E008                	shl	ax, 8
  1680 00000C03 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1681 00000C05 88F8                    	mov	al, bh
  1682 00000C07 00F0                    	add	al, dh
  1683 00000C09 D0D8                    	rcr	al, 1
  1684 00000C0B 2C80                    	sub	al, 80h
  1685 00000C0D 66C1E008                	shl	ax, 8
  1686 00000C11 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1687 00000C13 88D0                    	mov	al, dl
  1688 00000C15 2C80                    	sub	al, 80h
  1689 00000C17 66C1E008                	shl	ax, 8
  1690 00000C1B 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1691 00000C1D 88F0                    	mov	al, dh
  1692 00000C1F 2C80                    	sub	al, 80h
  1693 00000C21 66C1E008                	shl	ax, 8
  1694 00000C25 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1695 00000C27 A0[BC200000]            	mov	al, [next_val_l]
  1696 00000C2C 00D0                    	add	al, dl
  1697 00000C2E D0D8                    	rcr	al, 1
  1698 00000C30 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1699 00000C32 00D0                    	add	al, dl
  1700 00000C34 D0D8                    	rcr	al, 1
  1701 00000C36 2C80                    	sub	al, 80h
  1702 00000C38 66C1E008                	shl	ax, 8
  1703 00000C3C 66AB                    	stosw		; this is 4th interpolated sample (L)
  1704 00000C3E A0[BE200000]            	mov	al, [next_val_r]
  1705 00000C43 00F0                    	add	al, dh
  1706 00000C45 D0D8                    	rcr	al, 1
  1707 00000C47 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1708 00000C49 00F0                    	add	al, dh
  1709 00000C4B D0D8                    	rcr	al, 1
  1710 00000C4D 2C80                    	sub	al, 80h
  1711 00000C4F 66C1E008                	shl	ax, 8
  1712 00000C53 66AB                    	stosw		; this is 4th interpolated sample (R)
  1713 00000C55 A0[BC200000]            	mov	al, [next_val_l]
  1714 00000C5A 00D8                    	add	al, bl
  1715 00000C5C D0D8                    	rcr	al, 1
  1716 00000C5E 2C80                    	sub	al, 80h
  1717 00000C60 66C1E008                	shl	ax, 8
  1718 00000C64 66AB                    	stosw		; this is 5th interpolated sample (L)
  1719 00000C66 A0[BE200000]            	mov	al, [next_val_r]
  1720 00000C6B 00F8                    	add	al, bh
  1721 00000C6D D0D8                    	rcr	al, 1
  1722 00000C6F 2C80                    	sub	al, 80h
  1723 00000C71 66C1E008                	shl	ax, 8
  1724 00000C75 66AB                    	stosw		; this is 5th interpolated sample (R)
  1725                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1726 00000C77 E305                    	jecxz	lff8s_6
  1727 00000C79 E907FFFFFF              	jmp	lff8s_1
  1728                                  lff8s_6:
  1729 00000C7E E9ADFEFFFF              	jmp	lff8s_3
  1730                                  
  1731                                  load_8khz_mono_16_bit:
  1732                                  	; 13/11/2023
  1733 00000C83 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1734                                  					; last of the file?
  1735 00000C8A 7402                    	jz	short lff8m2_0		; no
  1736 00000C8C F9                      	stc
  1737 00000C8D C3                      	retn
  1738                                  
  1739                                  lff8m2_0:
  1740 00000C8E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1741                                          ;mov	edx, [loadsize]
  1742                                  
  1743                                  	; esi = buffer address
  1744                                  	;; edx = buffer size
  1745                                  
  1746                                  	; load file into memory
  1747                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000C93 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000C99 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000C9B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000CA1 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000CA6 CD40                <1>  int 40h
  1748 00000CA8 0F82A0000000            	jc	lff8m2_7 ; error !
  1749                                  
  1750 00000CAE BF[00800000]            	mov	edi, audio_buffer
  1751                                  	
  1752 00000CB3 D1E8                    	shr	eax, 1
  1753 00000CB5 7505                    	jnz	short lff8m2_8
  1754 00000CB7 E98CFEFFFF              	jmp	lff8_eof
  1755                                  
  1756                                  lff8m2_8:
  1757 00000CBC 89C1                    	mov	ecx, eax	; word count
  1758                                  lff8m2_1:
  1759 00000CBE 66AD                    	lodsw
  1760 00000CC0 66AB                    	stosw		; original sample (left channel)
  1761 00000CC2 66AB                    	stosw		; original sample (right channel)
  1762 00000CC4 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1763 00000CC7 66A3[B8200000]          	mov	[previous_val], ax
  1764 00000CCD 31C0                    	xor	eax, eax
  1765 00000CCF 49                      	dec	ecx
  1766 00000CD0 7403                    	jz	short lff8m2_2
  1767 00000CD2 668B06                  	mov	ax, [esi]
  1768                                  lff8m2_2:
  1769 00000CD5 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  1770 00000CD8 89C5                    	mov	ebp, eax	; [next_val]
  1771 00000CDA 660305[B8200000]        	add	ax, [previous_val]
  1772 00000CE1 66D1D8                  	rcr	ax, 1
  1773 00000CE4 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  1774 00000CE6 660305[B8200000]        	add	ax, [previous_val]
  1775 00000CED 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  1776 00000CF0 89C3                    	mov	ebx, eax 		
  1777 00000CF2 660305[B8200000]        	add	ax, [previous_val]
  1778 00000CF9 66D1D8                  	rcr	ax, 1
  1779 00000CFC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1780 00000CFF 66AB                    	stosw		; this is 1st interpolated sample (L)
  1781 00000D01 66AB                    	stosw		; this is 1st interpolated sample (R)
  1782 00000D03 89D8                    	mov	eax, ebx
  1783 00000D05 6601D0                  	add	ax, dx
  1784 00000D08 66D1D8                  	rcr	ax, 1
  1785 00000D0B 80EC80                  	sub	ah, 80h
  1786 00000D0E 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1787 00000D10 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1788 00000D12 89D0                    	mov	eax, edx
  1789 00000D14 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1790 00000D17 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1791 00000D19 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1792 00000D1B 89E8                    	mov	eax, ebp
  1793 00000D1D 6601D0                  	add	ax, dx
  1794 00000D20 66D1D8                  	rcr	ax, 1
  1795 00000D23 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  1796 00000D25 6601D0                  	add	ax, dx
  1797 00000D28 66D1D8                  	rcr	ax, 1
  1798 00000D2B 80EC80                  	sub	ah, 80h
  1799 00000D2E 66AB                    	stosw		; this is 4th interpolated sample (L)
  1800 00000D30 66AB                    	stosw		; this is 4th interpolated sample (R)
  1801 00000D32 89E8                    	mov	eax, ebp
  1802 00000D34 6601D8                  	add	ax, bx
  1803 00000D37 66D1D8                  	rcr	ax, 1
  1804 00000D3A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1805 00000D3D 66AB                    	stosw		; this is 5th interpolated sample (L)
  1806 00000D3F 66AB                    	stosw		; this is 5th interpolated sample (R)
  1807                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1808 00000D41 09C9                    	or	ecx, ecx
  1809 00000D43 0F8575FFFFFF            	jnz	lff8m2_1
  1810 00000D49 E9E2FDFFFF              	jmp	lff8m2_3
  1811                                  
  1812                                  lff8m2_7:
  1813                                  lff8s2_7:
  1814 00000D4E E9FEFDFFFF              	jmp	lff8m2_5  ; error
  1815                                  
  1816                                  load_8khz_stereo_16_bit:
  1817                                  	; 16/11/2023
  1818                                  	; 15/11/2023
  1819                                  	; 13/11/2023
  1820 00000D53 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1821                                  					; last of the file?
  1822 00000D5A 7402                    	jz	short lff8s2_0		; no
  1823 00000D5C F9                      	stc
  1824 00000D5D C3                      	retn
  1825                                  
  1826                                  lff8s2_0:
  1827 00000D5E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1828                                          ;mov	edx, [loadsize]
  1829                                  
  1830                                  	; esi = buffer address
  1831                                  	;; edx = buffer size
  1832                                  
  1833                                  	; load file into memory
  1834                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000D63 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000D69 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000D6B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000D71 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000D76 CD40                <1>  int 40h
  1835 00000D78 72D4                    	jc	short lff8s2_7 ; error !
  1836                                  
  1837 00000D7A BF[00800000]            	mov	edi, audio_buffer
  1838                                  	
  1839 00000D7F C1E802                  	shr	eax, 2
  1840 00000D82 7505                    	jnz	short lff8s2_8
  1841 00000D84 E9BFFDFFFF              	jmp	lff8_eof
  1842                                  
  1843                                  lff8s2_8:
  1844 00000D89 89C1                    	mov	ecx, eax ; dword count
  1845                                  lff8s2_1:
  1846 00000D8B 66AD                    	lodsw
  1847 00000D8D 66AB                    	stosw		; original sample (L)
  1848                                  	; 15/11/2023
  1849 00000D8F 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1850 00000D92 66A3[B8200000]          	mov	[previous_val_l], ax
  1851 00000D98 66AD                    	lodsw
  1852 00000D9A 66AB                    	stosw		; original sample (R)
  1853 00000D9C 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1854 00000D9F 66A3[BA200000]          	mov	[previous_val_r], ax
  1855 00000DA5 31D2                    	xor	edx, edx
  1856 00000DA7 31C0                    	xor	eax, eax
  1857                                  	; 16/11/2023
  1858 00000DA9 49                      	dec	ecx
  1859 00000DAA 7407                    	jz	short lff8s2_2
  1860 00000DAC 668B06                  	mov	ax, [esi]
  1861 00000DAF 668B5602                	mov	dx, [esi+2]
  1862                                  lff8s2_2:
  1863 00000DB3 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1864 00000DB6 66A3[BC200000]          	mov	[next_val_l], ax
  1865 00000DBC 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  1866 00000DBF 668915[BE200000]        	mov	[next_val_r], dx
  1867 00000DC6 660305[B8200000]        	add	ax, [previous_val_l]
  1868 00000DCD 66D1D8                  	rcr	ax, 1
  1869 00000DD0 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  1870 00000DD2 660305[B8200000]        	add	ax, [previous_val_l]
  1871 00000DD9 66D1D8                  	rcr	ax, 1	
  1872 00000DDC 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  1873 00000DDE 660305[B8200000]        	add	ax, [previous_val_l]
  1874 00000DE5 66D1D8                  	rcr	ax, 1
  1875 00000DE8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1876 00000DEB 66AB                    	stosw		; this is 1st interpolated sample (L)
  1877 00000DED 66A1[BE200000]          	mov	ax, [next_val_r]
  1878 00000DF3 660305[BA200000]        	add	ax, [previous_val_r]
  1879 00000DFA 66D1D8                  	rcr	ax, 1
  1880 00000DFD 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  1881 00000DFF 660305[BA200000]        	add	ax, [previous_val_r]
  1882 00000E06 66D1D8                  	rcr	ax, 1
  1883 00000E09 50                      	push	eax ; *	; this is temporary interpolation value (R)
  1884 00000E0A 660305[BA200000]        	add	ax, [previous_val_r]
  1885 00000E11 66D1D8                  	rcr	ax, 1
  1886 00000E14 80EC80                  	sub	ah, 80h
  1887 00000E17 66AB                    	stosw		; this is 1st interpolated sample (R)
  1888 00000E19 89D8                    	mov	eax, ebx
  1889 00000E1B 6601D0                  	add	ax, dx
  1890 00000E1E 66D1D8                  	rcr	ax, 1
  1891 00000E21 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1892 00000E24 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1893 00000E26 58                      	pop	eax ; *
  1894 00000E27 6601E8                  	add	ax, bp
  1895 00000E2A 66D1D8                  	rcr	ax, 1
  1896 00000E2D 80EC80                  	sub	ah, 80h
  1897 00000E30 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1898 00000E32 89D0                    	mov	eax, edx
  1899 00000E34 80EC80                  	sub	ah, 80h
  1900 00000E37 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1901 00000E39 89E8                    	mov	eax, ebp
  1902 00000E3B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1903 00000E3E 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1904 00000E40 66A1[BC200000]          	mov	ax, [next_val_l]
  1905 00000E46 6601D0                  	add	ax, dx
  1906 00000E49 66D1D8                  	rcr	ax, 1
  1907 00000E4C 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  1908 00000E4E 6601D0                  	add	ax, dx
  1909 00000E51 66D1D8                  	rcr	ax, 1
  1910 00000E54 80EC80                  	sub	ah, 80h
  1911 00000E57 66AB                    	stosw		; this is 4th interpolated sample (L)
  1912 00000E59 66A1[BE200000]          	mov	ax, [next_val_r]
  1913 00000E5F 6601E8                  	add	ax, bp
  1914 00000E62 66D1D8                  	rcr	ax, 1
  1915 00000E65 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  1916 00000E66 6601E8                  	add	ax, bp
  1917 00000E69 66D1D8                  	rcr	ax, 1
  1918 00000E6C 80EC80                  	sub	ah, 80h
  1919 00000E6F 66AB                    	stosw		; this is 4th interpolated sample (R)
  1920 00000E71 66A1[BC200000]          	mov	ax, [next_val_l]
  1921 00000E77 6601D8                  	add	ax, bx
  1922 00000E7A 66D1D8                  	rcr	ax, 1
  1923 00000E7D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  1924 00000E80 66AB                    	stosw		; this is 5th interpolated sample (L)
  1925 00000E82 58                      	pop	eax ; **
  1926 00000E83 660305[BE200000]        	add	ax, [next_val_r]
  1927 00000E8A 66D1D8                  	rcr	ax, 1
  1928 00000E8D 80EC80                  	sub	ah, 80h
  1929 00000E90 66AB                    	stosw		; this is 5th interpolated sample (R)
  1930                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1931 00000E92 E305                    	jecxz	lff8_s2_9
  1932 00000E94 E9F2FEFFFF              	jmp	lff8s2_1
  1933                                  lff8_s2_9:
  1934 00000E99 E992FCFFFF              	jmp	lff8s2_3
  1935                                  
  1936                                  ; .....................
  1937                                  
  1938                                  load_16khz_mono_8_bit:
  1939                                  	; 14/11/2023
  1940                                  	; 13/11/2023
  1941 00000E9E F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1942                                  					; last of the file?
  1943 00000EA5 7402                    	jz	short lff16m_0		; no
  1944 00000EA7 F9                      	stc
  1945 00000EA8 C3                      	retn
  1946                                  
  1947                                  lff16m_0:
  1948 00000EA9 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1949                                          ;mov	edx, [loadsize]
  1950                                  
  1951                                  	; esi = buffer address
  1952                                  	;; edx = buffer size
  1953                                  
  1954                                  	; load file into memory
  1955                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000EAE 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000EB4 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000EB6 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000EBC B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000EC1 CD40                <1>  int 40h
  1956 00000EC3 7253                    	jc	short lff16m_7 ; error !
  1957                                  
  1958 00000EC5 BF[00800000]            	mov	edi, audio_buffer
  1959                                  	
  1960 00000ECA 21C0                    	and	eax, eax
  1961 00000ECC 7505                    	jnz	short lff16m_8
  1962 00000ECE E975FCFFFF              	jmp	lff16_eof
  1963                                  
  1964                                  lff16m_8:
  1965 00000ED3 89C1                    	mov	ecx, eax		; byte count
  1966                                  lff16m_1:
  1967 00000ED5 AC                      	lodsb
  1968                                  	;mov	[previous_val], al
  1969 00000ED6 88C3                    	mov	bl, al
  1970 00000ED8 2C80                    	sub	al, 80h
  1971 00000EDA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1972 00000EDE 66AB                    	stosw		; original sample (left channel)
  1973 00000EE0 66AB                    	stosw		; original sample (right channel)
  1974                                  	;xor	ax, ax
  1975                                  	; 14/11/22023
  1976 00000EE2 B080                    	mov	al, 80h
  1977 00000EE4 49                      	dec	ecx
  1978 00000EE5 7402                    	jz	short lff16m_2
  1979 00000EE7 8A06                    	mov	al, [esi]
  1980                                  lff16m_2:
  1981                                  	;mov	[next_val], al
  1982 00000EE9 88C7                    	mov	bh, al
  1983                                  	;add	al, [previous_val]
  1984 00000EEB 00D8                    	add	al, bl
  1985 00000EED D0D8                    	rcr	al, 1
  1986 00000EEF 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  1987                                  	;add	al, [previous_val]
  1988 00000EF1 00D8                    	add	al, bl
  1989 00000EF3 D0D8                    	rcr	al, 1
  1990 00000EF5 2C80                    	sub	al, 80h
  1991 00000EF7 66C1E008                	shl	ax, 8
  1992 00000EFB 66AB                    	stosw		; this is 1st interpolated sample (L)
  1993 00000EFD 66AB                    	stosw		; this is 1st interpolated sample (R)
  1994                                  	;mov	al, [next_val]
  1995 00000EFF 88F8                    	mov	al, bh
  1996 00000F01 00D0                    	add	al, dl
  1997 00000F03 D0D8                    	rcr	al, 1
  1998 00000F05 2C80                    	sub	al, 80h
  1999 00000F07 66C1E008                	shl	ax, 8
  2000 00000F0B 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2001 00000F0D 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2002                                  	
  2003                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2004 00000F0F 09C9                    	or	ecx, ecx
  2005 00000F11 75C2                    	jnz	short lff16m_1
  2006 00000F13 E918FCFFFF              	jmp	lff16m_3
  2007                                  
  2008                                  lff16m_7:
  2009                                  lff16s_7:
  2010 00000F18 E934FCFFFF              	jmp	lff16m_5  ; error
  2011                                  
  2012                                  load_16khz_stereo_8_bit:
  2013                                  	; 14/11/2023
  2014                                  	; 13/11/2023
  2015 00000F1D F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2016                                  					; last of the file?
  2017 00000F24 7402                    	jz	short lff16s_0		; no
  2018 00000F26 F9                      	stc
  2019 00000F27 C3                      	retn
  2020                                  
  2021                                  lff16s_0:
  2022 00000F28 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2023                                          ;mov	edx, [loadsize]
  2024                                  
  2025                                  	; esi = buffer address
  2026                                  	;; edx = buffer size
  2027                                  
  2028                                  	; load file into memory
  2029                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000F2D 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000F33 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000F35 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000F3B B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000F40 CD40                <1>  int 40h
  2030 00000F42 72D4                    	jc	short lff16s_7 ; error !
  2031                                  
  2032 00000F44 BF[00800000]            	mov	edi, audio_buffer
  2033                                  	
  2034 00000F49 D1E8                    	shr	eax, 1
  2035 00000F4B 7505                    	jnz	short lff16s_8
  2036 00000F4D E9F6FBFFFF              	jmp	lff16_eof
  2037                                  
  2038                                  lff16s_8:
  2039 00000F52 89C1                    	mov	ecx, eax	; word count
  2040                                  lff16s_1:
  2041 00000F54 AC                      	lodsb
  2042 00000F55 A2[B8200000]            	mov	[previous_val_l], al
  2043 00000F5A 2C80                    	sub	al, 80h
  2044 00000F5C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2045 00000F60 66AB                    	stosw		; original sample (L)
  2046 00000F62 AC                      	lodsb
  2047 00000F63 A2[BA200000]            	mov	[previous_val_r], al
  2048 00000F68 2C80                    	sub	al, 80h
  2049 00000F6A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2050 00000F6E 66AB                    	stosw		; original sample (R)
  2051                                  
  2052                                  	;xor	eax, eax
  2053 00000F70 66B88080                	mov	ax, 8080h
  2054 00000F74 49                      	dec	ecx
  2055 00000F75 7403                    	jz	short lff16s_2
  2056                                  		; convert 8 bit sample to 16 bit sample
  2057 00000F77 668B06                  	mov	ax, [esi]
  2058                                  lff16s_2:
  2059                                  	;mov	[next_val_l], al
  2060                                  	;mov	[next_val_r], ah
  2061 00000F7A 89C3                    	mov	ebx, eax
  2062 00000F7C 0205[B8200000]          	add	al, [previous_val_l]
  2063 00000F82 D0D8                    	rcr	al, 1
  2064 00000F84 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2065 00000F86 0205[B8200000]          	add	al, [previous_val_l]
  2066 00000F8C D0D8                    	rcr	al, 1
  2067 00000F8E 2C80                    	sub	al, 80h
  2068 00000F90 66C1E008                	shl	ax, 8
  2069 00000F94 66AB                    	stosw		; this is 1st interpolated sample (L)
  2070 00000F96 88F8                    	mov	al, bh	; [next_val_r]
  2071 00000F98 0205[BA200000]          	add	al, [previous_val_r]
  2072 00000F9E D0D8                    	rcr	al, 1
  2073 00000FA0 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2074 00000FA2 0205[BA200000]          	add	al, [previous_val_r]
  2075 00000FA8 D0D8                    	rcr	al, 1
  2076 00000FAA 2C80                    	sub	al, 80h
  2077 00000FAC 66C1E008                	shl	ax, 8
  2078 00000FB0 66AB                    	stosw		; this is 1st interpolated sample (R)
  2079 00000FB2 88D0                    	mov	al, dl
  2080 00000FB4 00D8                    	add	al, bl	; [next_val_l]
  2081 00000FB6 D0D8                    	rcr	al, 1
  2082 00000FB8 2C80                    	sub	al, 80h
  2083 00000FBA 66C1E008                	shl	ax, 8
  2084 00000FBE 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2085 00000FC0 88F0                    	mov	al, dh
  2086 00000FC2 00F8                    	add	al, bh	; [next_val_r]
  2087 00000FC4 D0D8                    	rcr	al, 1
  2088 00000FC6 2C80                    	sub	al, 80h
  2089 00000FC8 66C1E008                	shl	ax, 8
  2090 00000FCC 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2091                                  	
  2092                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2093 00000FCE 09C9                    	or	ecx, ecx
  2094 00000FD0 7582                    	jnz	short lff16s_1
  2095 00000FD2 E959FBFFFF              	jmp	lff16s_3
  2096                                  
  2097                                  load_16khz_mono_16_bit:
  2098                                  	; 15/11/2023
  2099                                  	; 13/11/2023
  2100 00000FD7 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2101                                  					; last of the file?
  2102 00000FDE 7402                    	jz	short lff16m2_0		; no
  2103 00000FE0 F9                      	stc
  2104 00000FE1 C3                      	retn
  2105                                  
  2106                                  lff16m2_0:
  2107 00000FE2 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2108                                          ;mov	edx, [loadsize]
  2109                                  
  2110                                  	; esi = buffer address
  2111                                  	;; edx = buffer size
  2112                                  
  2113                                  	; load file into memory
  2114                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00000FE7 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00000FED 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00000FEF 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00000FF5 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00000FFA CD40                <1>  int 40h
  2115 00000FFC 7255                    	jc	short lff16m2_7 ; error !
  2116                                  
  2117 00000FFE BF[00800000]            	mov	edi, audio_buffer
  2118                                  	
  2119 00001003 D1E8                    	shr	eax, 1
  2120 00001005 7505                    	jnz	short lff16m2_8
  2121 00001007 E93CFBFFFF              	jmp	lff16_eof
  2122                                  
  2123                                  lff16m2_8:
  2124 0000100C 89C1                    	mov	ecx, eax  ; word count
  2125                                  lff16m2_1:
  2126 0000100E 66AD                    	lodsw
  2127 00001010 66AB                    	stosw		; original sample (left channel)
  2128 00001012 66AB                    	stosw		; original sample (right channel)
  2129 00001014 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2130                                  	;mov	[previous_val], ax
  2131 00001017 89C3                    	mov	ebx, eax	
  2132 00001019 31C0                    	xor	eax, eax
  2133 0000101B 49                      	dec	ecx
  2134 0000101C 7403                    	jz	short lff16m2_2
  2135 0000101E 668B06                  	mov	ax, [esi]
  2136                                  lff16m2_2:
  2137 00001021 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2138 00001024 89C5                    	mov	ebp, eax	; [next_val]
  2139                                  	;add	ax, [previous_val]
  2140 00001026 6601D8                  	add	ax, bx
  2141 00001029 66D1D8                  	rcr	ax, 1
  2142 0000102C 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2143                                  	;add	ax, [previous_val]
  2144 0000102E 6601D8                  	add	ax, bx
  2145 00001031 66D1D8                  	rcr	ax, 1
  2146 00001034 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2147 00001037 66AB                    	stosw		; this is 1st interpolated sample (L)
  2148 00001039 66AB                    	stosw		; this is 1st interpolated sample (R)
  2149 0000103B 89E8                    	mov	eax, ebp 
  2150 0000103D 6601D0                  	add	ax, dx
  2151 00001040 66D1D8                  	rcr	ax, 1
  2152 00001043 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2153 00001046 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2154 00001048 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2155                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2156 0000104A 09C9                    	or	ecx, ecx
  2157 0000104C 75C0                    	jnz	short lff16m2_1
  2158 0000104E E9DDFAFFFF              	jmp	lff16m2_3
  2159                                  
  2160                                  lff16m2_7:
  2161                                  lff16s2_7:
  2162 00001053 E9F9FAFFFF              	jmp	lff16m2_5  ; error
  2163                                  
  2164                                  load_16khz_stereo_16_bit:
  2165                                  	; 16/11/2023
  2166                                  	; 15/11/2023
  2167                                  	; 13/11/2023
  2168 00001058 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2169                                  					; last of the file?
  2170 0000105F 7402                    	jz	short lff16s2_0		; no
  2171 00001061 F9                      	stc
  2172 00001062 C3                      	retn
  2173                                  
  2174                                  lff16s2_0:
  2175 00001063 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2176                                          ;mov	edx, [loadsize]
  2177                                  
  2178                                  	; esi = buffer address
  2179                                  	;; edx = buffer size
  2180                                  
  2181                                  	; load file into memory
  2182                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001068 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000106E 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001070 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001076 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 0000107B CD40                <1>  int 40h
  2183 0000107D 72D4                    	jc	short lff16s2_7 ; error !
  2184                                  
  2185 0000107F BF[00800000]            	mov	edi, audio_buffer
  2186                                  	
  2187 00001084 C1E802                  	shr	eax, 2
  2188 00001087 7505                    	jnz	short lff16s2_8
  2189 00001089 E9BAFAFFFF              	jmp	lff16_eof
  2190                                  
  2191                                  lff16s2_8:
  2192 0000108E 89C1                    	mov	ecx, eax  ; dword count
  2193                                  lff16s2_1:
  2194 00001090 66AD                    	lodsw
  2195 00001092 66AB                    	stosw		; original sample (L)
  2196 00001094 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2197 00001097 66A3[B8200000]          	mov	[previous_val_l], ax
  2198 0000109D 66AD                    	lodsw
  2199 0000109F 66AB                    	stosw		; original sample (R)
  2200 000010A1 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2201 000010A4 66A3[BA200000]          	mov	[previous_val_r], ax
  2202 000010AA 31D2                    	xor	edx, edx
  2203 000010AC 31C0                    	xor	eax, eax
  2204                                  	; 16/11/2023
  2205 000010AE 49                      	dec	ecx
  2206 000010AF 7407                    	jz	short lff16s2_2
  2207 000010B1 668B06                  	mov	ax, [esi]
  2208 000010B4 668B5602                	mov	dx, [esi+2]
  2209                                  lff16s2_2:
  2210 000010B8 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2211                                  	;mov	[next_val_l], ax
  2212 000010BB 89C5                    	mov	ebp, eax
  2213 000010BD 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format 
  2214 000010C0 668915[BE200000]        	mov	[next_val_r], dx
  2215 000010C7 660305[B8200000]        	add	ax, [previous_val_l]
  2216 000010CE 66D1D8                  	rcr	ax, 1
  2217 000010D1 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2218 000010D3 660305[B8200000]        	add	ax, [previous_val_l]
  2219 000010DA 66D1D8                  	rcr	ax, 1
  2220 000010DD 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2221 000010E0 66AB                    	stosw		; this is 1st interpolated sample (L)
  2222 000010E2 66A1[BE200000]          	mov	ax, [next_val_r]
  2223 000010E8 660305[BA200000]        	add	ax, [previous_val_r]
  2224 000010EF 66D1D8                  	rcr	ax, 1
  2225 000010F2 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2226 000010F4 660305[BA200000]        	add	ax, [previous_val_r]
  2227 000010FB 66D1D8                  	rcr	ax, 1
  2228 000010FE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2229 00001101 66AB                    	stosw		; this is 1st interpolated sample (R)
  2230                                  	;mov	ax, [next_val_l]
  2231 00001103 89E8                    	mov	eax, ebp
  2232 00001105 6601D0                  	add	ax, dx
  2233 00001108 66D1D8                  	rcr	ax, 1
  2234 0000110B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2235 0000110E 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2236 00001110 66A1[BE200000]          	mov	ax, [next_val_r]
  2237 00001116 6601D8                  	add	ax, bx
  2238 00001119 66D1D8                  	rcr	ax, 1
  2239 0000111C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2240 0000111F 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2241                                  	
  2242                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2243 00001121 09C9                    	or	ecx, ecx
  2244 00001123 0F8567FFFFFF            	jnz	lff16s2_1
  2245 00001129 E902FAFFFF              	jmp	lff16s2_3
  2246                                  
  2247                                  ; .....................
  2248                                  
  2249                                  load_24khz_mono_8_bit:
  2250                                  	; 15/11/2023
  2251 0000112E F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2252                                  					; last of the file?
  2253 00001135 7402                    	jz	short lff24m_0		; no
  2254 00001137 F9                      	stc
  2255 00001138 C3                      	retn
  2256                                  
  2257                                  lff24m_0:
  2258 00001139 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2259                                          ;mov	edx, [loadsize]
  2260                                  
  2261                                  	; esi = buffer address
  2262                                  	;; edx = buffer size
  2263                                  
  2264                                  	; load file into memory
  2265                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000113E 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001144 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001146 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000114C B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001151 CD40                <1>  int 40h
  2266 00001153 723B                    	jc	short lff24m_7 ; error !
  2267                                  
  2268 00001155 BF[00800000]            	mov	edi, audio_buffer
  2269                                  	
  2270 0000115A 21C0                    	and	eax, eax
  2271 0000115C 7505                    	jnz	short lff24m_8
  2272 0000115E E9E5F9FFFF              	jmp	lff24_eof
  2273                                  
  2274                                  lff24m_8:
  2275 00001163 89C1                    	mov	ecx, eax	; byte count
  2276                                  lff24m_1:
  2277 00001165 AC                      	lodsb
  2278                                  	;mov	[previous_val], al
  2279 00001166 88C3                    	mov	bl, al
  2280 00001168 2C80                    	sub	al, 80h
  2281 0000116A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2282 0000116E 66AB                    	stosw		; original sample (left channel)
  2283 00001170 66AB                    	stosw		; original sample (right channel)
  2284                                  	;xor	eax, eax
  2285 00001172 B080                    	mov	al, 80h
  2286 00001174 49                      	dec	ecx
  2287 00001175 7402                    	jz	short lff24m_2
  2288 00001177 8A06                    	mov	al, [esi]
  2289                                  lff24m_2:
  2290                                  	;;mov	[next_val], al
  2291                                  	;mov	bh, al
  2292                                  	;add	al, [previous_val]
  2293 00001179 00D8                    	add	al, bl
  2294 0000117B D0D8                    	rcr	al, 1
  2295 0000117D 2C80                    	sub	al, 80h
  2296 0000117F 66C1E008                	shl	ax, 8
  2297 00001183 66AB                    	stosw		; this is interpolated sample (L)
  2298 00001185 66AB                    	stosw		; this is interpolated sample (R)
  2299                                  	
  2300                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2301 00001187 09C9                    	or	ecx, ecx
  2302 00001189 75DA                    	jnz	short lff24m_1
  2303 0000118B E9A0F9FFFF              	jmp	lff24_3
  2304                                  
  2305                                  lff24m_7:
  2306                                  lff24s_7:
  2307 00001190 E9BCF9FFFF              	jmp	lff24_5  ; error
  2308                                  
  2309                                  load_24khz_stereo_8_bit:
  2310                                  	; 15/11/2023
  2311 00001195 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2312                                  					; last of the file?
  2313 0000119C 7402                    	jz	short lff24s_0		; no
  2314 0000119E F9                      	stc
  2315 0000119F C3                      	retn
  2316                                  
  2317                                  lff24s_0:
  2318 000011A0 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2319                                          ;mov	edx, [loadsize]
  2320                                  
  2321                                  	; esi = buffer address
  2322                                  	;; edx = buffer size
  2323                                  
  2324                                  	; load file into memory
  2325                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000011A5 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000011AB 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000011AD 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000011B3 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000011B8 CD40                <1>  int 40h
  2326 000011BA 72D4                    	jc	short lff24s_7 ; error !
  2327                                  
  2328 000011BC BF[00800000]            	mov	edi, audio_buffer
  2329                                  	
  2330 000011C1 D1E8                    	shr	eax, 1
  2331 000011C3 7505                    	jnz	short lff24s_8
  2332 000011C5 E97EF9FFFF              	jmp	lff24_eof
  2333                                  
  2334                                  lff24s_8:
  2335 000011CA 89C1                    	mov	ecx, eax  ; word count
  2336                                  lff24s_1:
  2337 000011CC AC                      	lodsb
  2338 000011CD A2[B8200000]            	mov	[previous_val_l], al
  2339 000011D2 2C80                    	sub	al, 80h
  2340 000011D4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2341 000011D8 66AB                    	stosw		; original sample (L)
  2342 000011DA AC                      	lodsb
  2343 000011DB A2[BA200000]            	mov	[previous_val_r], al
  2344 000011E0 2C80                    	sub	al, 80h
  2345 000011E2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2346 000011E6 66AB                    	stosw		; original sample (R)
  2347                                  
  2348                                  	;xor	eax, eax
  2349 000011E8 66B88080                	mov	ax, 8080h
  2350 000011EC 49                      	dec	ecx
  2351 000011ED 7403                    	jz	short lff24s_2
  2352                                  		; convert 8 bit sample to 16 bit sample
  2353 000011EF 668B06                  	mov	ax, [esi]
  2354                                  lff24s_2:
  2355                                  	;;mov	[next_val_l], al
  2356                                  	;;mov	[next_val_r], ah
  2357                                  	;mov	bx, ax
  2358 000011F2 88E7                    	mov	bh, ah
  2359 000011F4 0205[B8200000]          	add	al, [previous_val_l]
  2360 000011FA D0D8                    	rcr	al, 1
  2361                                  	;mov	dl, al
  2362 000011FC 2C80                    	sub	al, 80h
  2363 000011FE 66C1E008                	shl	ax, 8
  2364 00001202 66AB                    	stosw		; this is interpolated sample (L)
  2365 00001204 88F8                    	mov	al, bh	; [next_val_r]
  2366 00001206 0205[BA200000]          	add	al, [previous_val_r]
  2367 0000120C D0D8                    	rcr	al, 1
  2368                                  	;mov	dh, al
  2369 0000120E 2C80                    	sub	al, 80h
  2370 00001210 66C1E008                	shl	ax, 8
  2371 00001214 66AB                    	stosw		; this is interpolated sample (R)
  2372                                  		
  2373                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2374 00001216 09C9                    	or	ecx, ecx
  2375 00001218 75B2                    	jnz	short lff24s_1
  2376 0000121A E911F9FFFF              	jmp	lff24_3
  2377                                  
  2378                                  load_24khz_mono_16_bit:
  2379                                  	; 15/11/2023
  2380 0000121F F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2381                                  					; last of the file?
  2382 00001226 7402                    	jz	short lff24m2_0		; no
  2383 00001228 F9                      	stc
  2384 00001229 C3                      	retn
  2385                                  
  2386                                  lff24m2_0:
  2387 0000122A BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2388                                          ;mov	edx, [loadsize]
  2389                                  
  2390                                  	; esi = buffer address
  2391                                  	;; edx = buffer size
  2392                                  
  2393                                  	; load file into memory
  2394                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000122F 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001235 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001237 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000123D B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001242 CD40                <1>  int 40h
  2395 00001244 7237                    	jc	short lff24m2_7 ; error !
  2396                                  
  2397 00001246 BF[00800000]            	mov	edi, audio_buffer
  2398                                  	
  2399 0000124B D1E8                    	shr	eax, 1
  2400 0000124D 7505                    	jnz	short lff24m2_8
  2401 0000124F E9F4F8FFFF              	jmp	lff24_eof
  2402                                  
  2403                                  lff24m2_8:
  2404 00001254 89C1                    	mov	ecx, eax  ; word count
  2405                                  lff24m2_1:
  2406 00001256 66AD                    	lodsw
  2407 00001258 66AB                    	stosw		; original sample (left channel)
  2408 0000125A 66AB                    	stosw		; original sample (right channel)
  2409 0000125C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2410                                  	;mov	[previous_val], ax
  2411                                  	;mov	ebx, eax	
  2412                                  	;xor	eax, eax
  2413 0000125F 31DB                    	xor	ebx, ebx
  2414 00001261 49                      	dec	ecx
  2415 00001262 7403                    	jz	short lff24m2_2
  2416                                  	;mov	ax, [esi]
  2417 00001264 668B1E                  	mov	bx, [esi]
  2418                                  lff24m2_2:
  2419                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2420                                  	;mov	ebp, eax	; [next_val]
  2421                                  	;add	ax, [previous_val]
  2422                                  	; ax = [previous_val]
  2423                                  	; bx = [next_val]
  2424 00001267 6601D8                  	add	ax, bx
  2425 0000126A 66D1D8                  	rcr	ax, 1
  2426 0000126D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2427 00001270 66AB                    	stosw		; this is interpolated sample (L)
  2428 00001272 66AB                    	stosw		; this is interpolated sample (R)
  2429                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2430 00001274 09C9                    	or	ecx, ecx
  2431 00001276 75DE                    	jnz	short lff24m2_1
  2432 00001278 E9B3F8FFFF              	jmp	lff24_3
  2433                                  
  2434                                  lff24m2_7:
  2435                                  lff24s2_7:
  2436 0000127D E9CFF8FFFF              	jmp	lff24_5  ; error
  2437                                  
  2438                                  load_24khz_stereo_16_bit:
  2439                                  	; 16/11/2023
  2440                                  	; 15/11/2023
  2441 00001282 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2442                                  					; last of the file?
  2443 00001289 7402                    	jz	short lff24s2_0		; no
  2444 0000128B F9                      	stc
  2445 0000128C C3                      	retn
  2446                                  
  2447                                  lff24s2_0:
  2448 0000128D BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2449                                          ;mov	edx, [loadsize]
  2450                                  
  2451                                  	; esi = buffer address
  2452                                  	;; edx = buffer size
  2453                                  
  2454                                  	; load file into memory
  2455                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001292 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001298 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000129A 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000012A0 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000012A5 CD40                <1>  int 40h
  2456 000012A7 72D4                    	jc	short lff24s2_7 ; error !
  2457                                  
  2458 000012A9 BF[00800000]            	mov	edi, audio_buffer
  2459                                  	
  2460 000012AE C1E802                  	shr	eax, 2
  2461 000012B1 7505                    	jnz	short lff24s2_8
  2462 000012B3 E990F8FFFF              	jmp	lff24_eof
  2463                                  
  2464                                  lff24s2_8:
  2465 000012B8 89C1                    	mov	ecx, eax  ; dword count
  2466                                  lff24s2_1:
  2467 000012BA 66AD                    	lodsw
  2468 000012BC 66AB                    	stosw		; original sample (L)
  2469 000012BE 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2470 000012C1 66A3[B8200000]          	mov	[previous_val_l], ax
  2471 000012C7 66AD                    	lodsw
  2472 000012C9 66AB                    	stosw		; original sample (R)
  2473 000012CB 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2474                                  	;mov	[previous_val_r], ax
  2475 000012CE 89C3                    	mov	ebx, eax
  2476 000012D0 31D2                    	xor	edx, edx
  2477 000012D2 31C0                    	xor	eax, eax
  2478                                  	; 16/11/2023
  2479 000012D4 49                      	dec	ecx
  2480 000012D5 7407                    	jz	short lff24s2_2
  2481 000012D7 668B06                  	mov	ax, [esi]
  2482 000012DA 668B5602                	mov	dx, [esi+2]
  2483                                  lff24s2_2:
  2484 000012DE 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2485                                  	;;mov	[next_val_l], ax
  2486                                  	;mov	ebp, eax
  2487 000012E1 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format 
  2488                                  	;mov	[next_val_r], dx
  2489 000012E4 660305[B8200000]        	add	ax, [previous_val_l]
  2490 000012EB 66D1D8                  	rcr	ax, 1
  2491 000012EE 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2492 000012F1 66AB                    	stosw		; this is interpolated sample (L)
  2493                                  	;mov	ax, [next_val_r]
  2494 000012F3 89D0                    	mov	eax, edx
  2495                                  	;add	ax, [previous_val_r]
  2496 000012F5 6601D8                  	add	ax, bx
  2497 000012F8 66D1D8                  	rcr	ax, 1
  2498 000012FB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2499 000012FE 66AB                    	stosw		; this is interpolated sample (R)
  2500                                  	
  2501                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2502 00001300 09C9                    	or	ecx, ecx
  2503 00001302 75B6                    	jnz	short lff24s2_1
  2504 00001304 E927F8FFFF              	jmp	lff24_3
  2505                                  
  2506                                  ; .....................
  2507                                  
  2508                                  load_32khz_mono_8_bit:
  2509                                  	; 15/11/2023
  2510 00001309 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2511                                  					; last of the file?
  2512 00001310 7402                    	jz	short lff32m_0		; no
  2513 00001312 F9                      	stc
  2514 00001313 C3                      	retn
  2515                                  
  2516                                  lff32m_0:
  2517 00001314 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2518                                          ;mov	edx, [loadsize]
  2519                                  
  2520                                  	; esi = buffer address
  2521                                  	;; edx = buffer size
  2522                                  
  2523                                  	; load file into memory
  2524                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001319 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000131F 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001321 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001327 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 0000132C CD40                <1>  int 40h
  2525 0000132E 7247                    	jc	short lff32m_7 ; error !
  2526                                  
  2527 00001330 BF[00800000]            	mov	edi, audio_buffer
  2528                                  	
  2529 00001335 21C0                    	and	eax, eax
  2530 00001337 7505                    	jnz	short lff32m_8
  2531 00001339 E90AF8FFFF              	jmp	lff32_eof
  2532                                  
  2533                                  lff32m_8:
  2534 0000133E 89C1                    	mov	ecx, eax	; byte count
  2535                                  lff32m_1:
  2536 00001340 AC                      	lodsb
  2537                                  	;mov	[previous_val], al
  2538 00001341 88C3                    	mov	bl, al
  2539 00001343 2C80                    	sub	al, 80h
  2540 00001345 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2541 00001349 66AB                    	stosw		; original sample (left channel)
  2542 0000134B 66AB                    	stosw		; original sample (right channel)
  2543                                  	;xor	eax, eax
  2544 0000134D B080                    	mov	al, 80h
  2545 0000134F 49                      	dec	ecx
  2546 00001350 7402                    	jz	short lff32m_2
  2547 00001352 8A06                    	mov	al, [esi]
  2548                                  lff32m_2:
  2549                                  	;;mov	[next_val], al
  2550                                  	;mov	bh, al
  2551                                  	;add	al, [previous_val]
  2552 00001354 00D8                    	add	al, bl
  2553 00001356 D0D8                    	rcr	al, 1
  2554 00001358 2C80                    	sub	al, 80h
  2555 0000135A 66C1E008                	shl	ax, 8
  2556 0000135E 66AB                    	stosw		; this is interpolated sample (L)
  2557 00001360 66AB                    	stosw		; this is interpolated sample (R)
  2558                                  	
  2559                                  	; different than 8-16-24 kHZ !
  2560                                  	; 'original-interpolated-original' trio samples 
  2561 00001362 E30E                    	jecxz	lff32m_3
  2562                                  
  2563 00001364 AC                      	lodsb
  2564 00001365 2C80                    	sub	al, 80h
  2565 00001367 66C1E008                	shl	ax, 8
  2566 0000136B 66AB                    	stosw		; original sample (left channel)
  2567 0000136D 66AB                    	stosw		; original sample (right channel)
  2568                                  
  2569                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2570 0000136F 49                      	dec	ecx
  2571 00001370 75CE                    	jnz	short lff32m_1
  2572                                  lff32m_3:
  2573 00001372 E9B9F7FFFF              	jmp	lff32_3
  2574                                  
  2575                                  lff32m_7:
  2576                                  lff32s_7:
  2577 00001377 E9D5F7FFFF              	jmp	lff32_5  ; error
  2578                                  
  2579                                  load_32khz_stereo_8_bit:
  2580                                  	; 15/11/2023
  2581 0000137C F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2582                                  					; last of the file?
  2583 00001383 7402                    	jz	short lff32s_0		; no
  2584 00001385 F9                      	stc
  2585 00001386 C3                      	retn
  2586                                  
  2587                                  lff32s_0:
  2588 00001387 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2589                                          ;mov	edx, [loadsize]
  2590                                  
  2591                                  	; esi = buffer address
  2592                                  	;; edx = buffer size
  2593                                  
  2594                                  	; load file into memory
  2595                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 0000138C 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001392 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001394 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000139A B803000000          <1>  mov eax, %1
    90                              <1> 
    91 0000139F CD40                <1>  int 40h
  2596 000013A1 72D4                    	jc	short lff32s_7 ; error !
  2597                                  
  2598 000013A3 BF[00800000]            	mov	edi, audio_buffer
  2599                                  	
  2600 000013A8 D1E8                    	shr	eax, 1
  2601 000013AA 7505                    	jnz	short lff32s_8
  2602 000013AC E997F7FFFF              	jmp	lff32_eof
  2603                                  
  2604                                  lff32s_8:
  2605 000013B1 89C1                    	mov	ecx, eax  ; word count
  2606                                  lff32s_1:
  2607 000013B3 AC                      	lodsb
  2608 000013B4 A2[B8200000]            	mov	[previous_val_l], al
  2609 000013B9 2C80                    	sub	al, 80h
  2610 000013BB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2611 000013BF 66AB                    	stosw		; original sample (L)
  2612 000013C1 AC                      	lodsb
  2613 000013C2 A2[BA200000]            	mov	[previous_val_r], al
  2614 000013C7 2C80                    	sub	al, 80h
  2615 000013C9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2616 000013CD 66AB                    	stosw		; original sample (R)
  2617                                  
  2618                                  	;xor	eax, eax
  2619 000013CF 66B88080                	mov	ax, 8080h
  2620 000013D3 49                      	dec	ecx
  2621 000013D4 7403                    	jz	short lff32s_2
  2622                                  		; convert 8 bit sample to 16 bit sample
  2623 000013D6 668B06                  	mov	ax, [esi]
  2624                                  lff32s_2:
  2625                                  	;;mov	[next_val_l], al
  2626                                  	;;mov	[next_val_r], ah
  2627                                  	;mov	bx, ax
  2628 000013D9 88E7                    	mov	bh, ah
  2629 000013DB 0205[B8200000]          	add	al, [previous_val_l]
  2630 000013E1 D0D8                    	rcr	al, 1
  2631                                  	;mov	dl, al
  2632 000013E3 2C80                    	sub	al, 80h
  2633 000013E5 66C1E008                	shl	ax, 8
  2634 000013E9 66AB                    	stosw		; this is interpolated sample (L)
  2635 000013EB 88F8                    	mov	al, bh	; [next_val_r]
  2636 000013ED 0205[BA200000]          	add	al, [previous_val_r]
  2637 000013F3 D0D8                    	rcr	al, 1
  2638                                  	;mov	dh, al
  2639 000013F5 2C80                    	sub	al, 80h
  2640 000013F7 66C1E008                	shl	ax, 8
  2641 000013FB 66AB                    	stosw		; this is interpolated sample (R)
  2642                                  
  2643                                  	; different than 8-16-24 kHZ !
  2644                                  	; 'original-interpolated-original' trio samples 
  2645 000013FD E315                    	jecxz	lff32s_3
  2646                                  
  2647 000013FF AC                      	lodsb
  2648 00001400 2C80                    	sub	al, 80h
  2649 00001402 66C1E008                	shl	ax, 8
  2650 00001406 66AB                    	stosw		; original sample (left channel)
  2651                                  
  2652 00001408 AC                      	lodsb
  2653 00001409 2C80                    	sub	al, 80h
  2654 0000140B 66C1E008                	shl	ax, 8
  2655 0000140F 66AB                    	stosw		; original sample (right channel)
  2656                                  		
  2657                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2658 00001411 49                      	dec	ecx
  2659 00001412 759F                    	jnz	short lff32s_1
  2660                                  lff32s_3:
  2661 00001414 E917F7FFFF              	jmp	lff32_3
  2662                                  
  2663                                  load_32khz_mono_16_bit:
  2664                                  	; 15/11/2023
  2665 00001419 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2666                                  					; last of the file?
  2667 00001420 7402                    	jz	short lff32m2_0		; no
  2668 00001422 F9                      	stc
  2669 00001423 C3                      	retn
  2670                                  
  2671                                  lff32m2_0:
  2672 00001424 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2673                                          ;mov	edx, [loadsize]
  2674                                  
  2675                                  	; esi = buffer address
  2676                                  	;; edx = buffer size
  2677                                  
  2678                                  	; load file into memory
  2679                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001429 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 0000142F 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001431 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001437 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 0000143C CD40                <1>  int 40h
  2680 0000143E 723E                    	jc	short lff32m2_7 ; error !
  2681                                  
  2682 00001440 BF[00800000]            	mov	edi, audio_buffer
  2683                                  	
  2684 00001445 D1E8                    	shr	eax, 1
  2685 00001447 7505                    	jnz	short lff32m2_8
  2686 00001449 E9FAF6FFFF              	jmp	lff32_eof
  2687                                  
  2688                                  lff32m2_8:
  2689 0000144E 89C1                    	mov	ecx, eax  ; word count
  2690                                  lff32m2_1:
  2691 00001450 66AD                    	lodsw
  2692 00001452 66AB                    	stosw		; original sample (left channel)
  2693 00001454 66AB                    	stosw		; original sample (right channel)
  2694 00001456 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2695                                  	;mov	[previous_val], ax
  2696                                  	;mov	ebx, eax	
  2697                                  	;xor	eax, eax
  2698 00001459 31DB                    	xor	ebx, ebx
  2699 0000145B 49                      	dec	ecx
  2700 0000145C 7403                    	jz	short lff32m2_2
  2701                                  	;mov	ax, [esi]
  2702 0000145E 668B1E                  	mov	bx, [esi]
  2703                                  lff32m2_2:
  2704                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2705                                  	;mov	ebp, eax	; [next_val]
  2706                                  	;add	ax, [previous_val]
  2707                                  	; ax = [previous_val]
  2708                                  	; bx = [next_val]
  2709 00001461 6601D8                  	add	ax, bx
  2710 00001464 66D1D8                  	rcr	ax, 1
  2711 00001467 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2712 0000146A 66AB                    	stosw		; this is interpolated sample (L)
  2713 0000146C 66AB                    	stosw		; this is interpolated sample (R)
  2714                                  
  2715                                  	; different than 8-16-24 kHZ !
  2716                                  	; 'original-interpolated-original' trio samples 
  2717 0000146E E309                    	jecxz	lff32m2_3
  2718                                  
  2719 00001470 66AD                    	lodsw
  2720 00001472 66AB                    	stosw		; original sample (left channel)
  2721 00001474 66AB                    	stosw		; original sample (right channel)
  2722                                  
  2723                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2724 00001476 49                      	dec	ecx
  2725 00001477 75D7                    	jnz	short lff32m2_1
  2726                                  lff32m2_3:
  2727 00001479 E9B2F6FFFF              	jmp	lff32_3
  2728                                  
  2729                                  lff32m2_7:
  2730                                  lff32s2_7:
  2731 0000147E E9CEF6FFFF              	jmp	lff32_5  ; error
  2732                                  
  2733                                  load_32khz_stereo_16_bit:
  2734                                  	; 16/11/2023
  2735                                  	; 15/11/2023
  2736 00001483 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2737                                  					; last of the file?
  2738 0000148A 7402                    	jz	short lff32s2_0		; no
  2739 0000148C F9                      	stc
  2740 0000148D C3                      	retn
  2741                                  
  2742                                  lff32s2_0:
  2743 0000148E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2744                                          ;mov	edx, [loadsize]
  2745                                  
  2746                                  	; esi = buffer address
  2747                                  	;; edx = buffer size
  2748                                  
  2749                                  	; load file into memory
  2750                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001493 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001499 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000149B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000014A1 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000014A6 CD40                <1>  int 40h
  2751 000014A8 72D4                    	jc	short lff32s2_7 ; error !
  2752                                  
  2753 000014AA BF[00800000]            	mov	edi, audio_buffer
  2754                                  	
  2755 000014AF C1E802                  	shr	eax, 2
  2756 000014B2 7505                    	jnz	short lff32s2_8
  2757 000014B4 E98FF6FFFF              	jmp	lff32_eof
  2758                                  
  2759                                  lff32s2_8:
  2760 000014B9 89C1                    	mov	ecx, eax ; dword count
  2761                                  lff32s2_1:
  2762 000014BB 66AD                    	lodsw
  2763 000014BD 66AB                    	stosw		; original sample (L)
  2764 000014BF 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2765 000014C2 66A3[B8200000]          	mov	[previous_val_l], ax
  2766 000014C8 66AD                    	lodsw
  2767 000014CA 66AB                    	stosw		; original sample (R)
  2768 000014CC 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2769                                  	;mov	[previous_val_r], ax
  2770 000014CF 89C3                    	mov	ebx, eax
  2771 000014D1 31D2                    	xor	edx, edx
  2772 000014D3 31C0                    	xor	eax, eax
  2773                                  	; 16/11/2023
  2774 000014D5 49                      	dec	ecx
  2775 000014D6 7407                    	jz	short lff32s2_2
  2776 000014D8 668B06                  	mov	ax, [esi]
  2777 000014DB 668B5602                	mov	dx, [esi+2]
  2778                                  lff32s2_2:
  2779 000014DF 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  2780                                  	;;mov	[next_val_l], ax
  2781                                  	;mov	ebp, eax
  2782 000014E2 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format 
  2783                                  	;mov	[next_val_r], dx
  2784 000014E5 660305[B8200000]        	add	ax, [previous_val_l]
  2785 000014EC 66D1D8                  	rcr	ax, 1
  2786 000014EF 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2787 000014F2 66AB                    	stosw		; this is interpolated sample (L)
  2788                                  	;mov	ax, [next_val_r]
  2789 000014F4 89D0                    	mov	eax, edx
  2790                                  	;add	ax, [previous_val_r]
  2791 000014F6 6601D8                  	add	ax, bx
  2792 000014F9 66D1D8                  	rcr	ax, 1
  2793 000014FC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2794 000014FF 66AB                    	stosw		; this is interpolated sample (R)
  2795                                  
  2796                                  	; different than 8-16-24 kHZ !
  2797                                  	; 'original-interpolated-original' trio samples 
  2798 00001501 E30B                    	jecxz	lff32s2_3
  2799                                  
  2800 00001503 66AD                    	lodsw
  2801 00001505 66AB                    	stosw	; original sample (L)
  2802 00001507 66AD                    	lodsw
  2803 00001509 66AB                    	stosw	; original sample (R)
  2804                                  	
  2805                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2806 0000150B 49                      	dec	ecx
  2807 0000150C 75AD                    	jnz	short lff32s2_1
  2808                                  lff32s2_3:
  2809 0000150E E91DF6FFFF              	jmp	lff32_3
  2810                                  
  2811                                  ; .....................
  2812                                  
  2813                                  load_22khz_mono_8_bit:
  2814                                  	; 16/11/2023
  2815 00001513 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2816                                  					; last of the file?
  2817 0000151A 7402                    	jz	short lff22m_0		; no
  2818 0000151C F9                      	stc
  2819 0000151D C3                      	retn
  2820                                  
  2821                                  lff22m_0:
  2822 0000151E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2823                                          ;mov	edx, [loadsize]
  2824                                  
  2825                                  	; esi = buffer address
  2826                                  	;; edx = buffer size
  2827                                  
  2828                                  	; load file into memory
  2829                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001523 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001529 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000152B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001531 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001536 CD40                <1>  int 40h
  2830 00001538 725D                    	jc	short lff22m_7 ; error !
  2831                                  
  2832 0000153A BF[00800000]            	mov	edi, audio_buffer
  2833                                  	
  2834 0000153F 21C0                    	and	eax, eax
  2835 00001541 7505                    	jnz	short lff22m_8
  2836 00001543 E900F6FFFF              	jmp	lff22_eof
  2837                                  
  2838                                  lff22m_8:
  2839 00001548 89C1                    	mov	ecx, eax	; byte count
  2840                                  lff22m_9:
  2841 0000154A BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  2842 0000154F C605[C0200000]03        	mov	byte [faz], 3  ; 3 steps/phases
  2843                                  lff22m_1:
  2844                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  2845 00001556 AC                      	lodsb
  2846 00001557 B280                    	mov	dl, 80h
  2847 00001559 49                      	dec	ecx
  2848 0000155A 7402                    	jz	short lff22m_2_1
  2849 0000155C 8A16                    	mov	dl, [esi]
  2850                                  lff22m_2_1:	
  2851                                  	; al = [previous_val]
  2852                                  	; dl = [next_val]
  2853 0000155E E80F060000              	call	interpolating_3_8bit_mono ; 1 of 17
  2854 00001563 E32D                    	jecxz	lff22m_3
  2855                                  lff22m_2_2:
  2856 00001565 AC                      	lodsb
  2857 00001566 B280                    	mov	dl, 80h
  2858 00001568 49                      	dec	ecx
  2859 00001569 7402                    	jz	short lff22m_2_3
  2860 0000156B 8A16                    	mov	dl, [esi]
  2861                                  lff22m_2_3:
  2862 0000156D E884060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  2863 00001572 E31E                    	jecxz	lff22m_3
  2864 00001574 4D                      	dec	ebp
  2865 00001575 75EE                    	jnz	short lff22m_2_2
  2866                                  
  2867 00001577 A0[C0200000]            	mov	al, [faz]
  2868 0000157C FEC8                    	dec	al
  2869 0000157E 74CA                    	jz	short lff22m_9
  2870 00001580 FE0D[C0200000]          	dec	byte [faz]
  2871 00001586 BD04000000              	mov	ebp, 4
  2872 0000158B FEC8                    	dec	al
  2873 0000158D 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  2874 0000158F 45                      	inc	ebp ; 5
  2875 00001590 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  2876                                  
  2877                                  lff22m_3:
  2878                                  lff22s_3:
  2879 00001592 E999F5FFFF              	jmp	lff22_3	; padfill
  2880                                  		; (put zeros in the remain words of the buffer)
  2881                                  lff22m_7:
  2882                                  lff22s_7:
  2883 00001597 E9B5F5FFFF              	jmp	lff22_5  ; error
  2884                                  
  2885                                  load_22khz_stereo_8_bit:
  2886                                  	; 16/11/2023
  2887 0000159C F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2888                                  					; last of the file?
  2889 000015A3 7402                    	jz	short lff22s_0		; no
  2890 000015A5 F9                      	stc
  2891 000015A6 C3                      	retn
  2892                                  
  2893                                  lff22s_0:
  2894 000015A7 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2895                                          ;mov	edx, [loadsize]
  2896                                  
  2897                                  	; esi = buffer address
  2898                                  	;; edx = buffer size
  2899                                  
  2900                                  	; load file into memory
  2901                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000015AC 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000015B2 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000015B4 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000015BA B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000015BF CD40                <1>  int 40h
  2902 000015C1 72D4                    	jc	short lff22s_7 ; error !
  2903                                  
  2904 000015C3 BF[00800000]            	mov	edi, audio_buffer
  2905                                  	
  2906 000015C8 D1E8                    	shr	eax, 1
  2907 000015CA 7505                    	jnz	short lff22s_8
  2908 000015CC E977F5FFFF              	jmp	lff22_eof
  2909                                  
  2910                                  lff22s_8:
  2911 000015D1 89C1                    	mov	ecx, eax	; word count
  2912                                  lff22s_9:
  2913 000015D3 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  2914 000015D8 C605[C0200000]03        	mov	byte [faz], 3  ; 3 steps/phase
  2915                                  lff22s_1:
  2916                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  2917 000015DF 66AD                    	lodsw
  2918 000015E1 66BA8080                	mov	dx, 8080h
  2919 000015E5 49                      	dec	ecx
  2920 000015E6 7403                    	jz	short lff22s_2_1 
  2921 000015E8 668B16                  	mov	dx, [esi]
  2922                                  lff22s_2_1:	
  2923                                  	; al = [previous_val_l]
  2924                                  	; ah = [previous_val_r]
  2925                                  	; dl = [next_val_l]
  2926                                  	; dh = [next_val_r]	
  2927 000015EB E8B3050000              	call	interpolating_3_8bit_stereo ; 1 of 17 
  2928 000015F0 E3A0                    	jecxz	lff22s_3
  2929                                  lff22s_2_2:
  2930 000015F2 66AD                    	lodsw
  2931 000015F4 66BA8080                	mov	dx, 8080h
  2932 000015F8 49                      	dec	ecx
  2933 000015F9 7403                    	jz	short lff22s_2_3
  2934 000015FB 668B16                  	mov	dx, [esi]
  2935                                  lff22s_2_3:
  2936 000015FE E810060000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  2937 00001603 E38D                    	jecxz	lff22s_3
  2938 00001605 4D                      	dec	ebp
  2939 00001606 75EA                    	jnz	short lff22s_2_2
  2940                                  
  2941 00001608 A0[C0200000]            	mov	al, [faz]
  2942 0000160D FEC8                    	dec	al
  2943 0000160F 74C2                    	jz	short lff22s_9
  2944 00001611 FE0D[C0200000]          	dec	byte [faz]
  2945 00001617 BD04000000              	mov	ebp, 4
  2946 0000161C FEC8                    	dec	al
  2947 0000161E 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  2948 00001620 45                      	inc	ebp ; 5
  2949 00001621 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  2950                                  
  2951                                  load_22khz_mono_16_bit:
  2952                                  	; 16/11/2023
  2953 00001623 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2954                                  					; last of the file?
  2955 0000162A 7402                    	jz	short lff22m2_0		; no
  2956 0000162C F9                      	stc
  2957 0000162D C3                      	retn
  2958                                  
  2959                                  lff22m2_0:
  2960 0000162E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2961                                          ;mov	edx, [loadsize]
  2962                                  
  2963                                  	; esi = buffer address
  2964                                  	;; edx = buffer size
  2965                                  
  2966                                  	; load file into memory
  2967                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001633 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001639 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000163B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001641 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001646 CD40                <1>  int 40h
  2968 00001648 7261                    	jc	short lff22m2_7 ; error !
  2969                                  
  2970 0000164A BF[00800000]            	mov	edi, audio_buffer
  2971                                  	
  2972 0000164F D1E8                    	shr	eax, 1
  2973 00001651 7505                    	jnz	short lff22m2_8
  2974 00001653 E9F0F4FFFF              	jmp	lff22_eof
  2975                                  
  2976                                  lff22m2_8:
  2977 00001658 89C1                    	mov	ecx, eax	; word count
  2978                                  lff22m2_9:
  2979 0000165A BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  2980 0000165F C605[C0200000]03        	mov	byte [faz], 3  ; 3 steps/phases
  2981                                  lff22m2_1:
  2982                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  2983 00001666 66AD                    	lodsw
  2984 00001668 31D2                    	xor	edx, edx
  2985 0000166A 49                      	dec	ecx
  2986 0000166B 7403                    	jz	short lff22m2_2_1
  2987 0000166D 668B16                  	mov	dx, [esi]
  2988                                  lff22m2_2_1:	
  2989                                  	; ax = [previous_val]
  2990                                  	; dx = [next_val]
  2991 00001670 E8CF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  2992 00001675 E32F                    	jecxz	lff22m2_3
  2993                                  lff22m2_2_2:
  2994 00001677 66AD                    	lodsw
  2995 00001679 31D2                    	xor	edx, edx
  2996 0000167B 49                      	dec	ecx
  2997 0000167C 7403                    	jz	short lff22m2_2_3
  2998 0000167E 668B16                  	mov	dx, [esi]
  2999                                  lff22m2_2_3:
  3000 00001681 E851060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3001 00001686 E31E                    	jecxz	lff22m2_3
  3002 00001688 4D                      	dec	ebp
  3003 00001689 75EC                    	jnz	short lff22m2_2_2
  3004                                  
  3005 0000168B A0[C0200000]            	mov	al, [faz]
  3006 00001690 FEC8                    	dec	al
  3007 00001692 74C6                    	jz	short lff22m2_9
  3008 00001694 FE0D[C0200000]          	dec	byte [faz]
  3009 0000169A BD04000000              	mov	ebp, 4
  3010 0000169F FEC8                    	dec	al
  3011 000016A1 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3012 000016A3 45                      	inc	ebp ; 5
  3013 000016A4 EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3014                                  
  3015                                  lff22m2_3:
  3016                                  lff22s2_3:
  3017 000016A6 E985F4FFFF              	jmp	lff22_3	; padfill
  3018                                  		; (put zeros in the remain words of the buffer)
  3019                                  lff22m2_7:
  3020                                  lff22s2_7:
  3021 000016AB E9A1F4FFFF              	jmp	lff22_5  ; error
  3022                                  
  3023                                  load_22khz_stereo_16_bit:
  3024                                  	; 16/11/2023
  3025 000016B0 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3026                                  					; last of the file?
  3027 000016B7 7402                    	jz	short lff22s2_0		; no
  3028 000016B9 F9                      	stc
  3029 000016BA C3                      	retn
  3030                                  
  3031                                  lff22s2_0:
  3032 000016BB BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3033                                          ;mov	edx, [loadsize]
  3034                                  
  3035                                  	; esi = buffer address
  3036                                  	;; edx = buffer size
  3037                                  
  3038                                  	; load file into memory
  3039                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000016C0 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000016C6 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000016C8 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000016CE B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000016D3 CD40                <1>  int 40h
  3040 000016D5 72D4                    	jc	short lff22s2_7 ; error !
  3041                                  
  3042 000016D7 BF[00800000]            	mov	edi, audio_buffer
  3043                                  	
  3044 000016DC C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3045 000016DF 7505                    	jnz	short lff22s2_8
  3046 000016E1 E962F4FFFF              	jmp	lff22_eof
  3047                                  
  3048                                  lff22s2_8:
  3049 000016E6 89C1                    	mov	ecx, eax	; dword count
  3050                                  lff22s2_9:
  3051 000016E8 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3052 000016ED C605[C0200000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3053                                  lff22s2_1:
  3054                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3055 000016F4 66AD                    	lodsw
  3056 000016F6 89C3                    	mov	ebx, eax
  3057 000016F8 66AD                    	lodsw
  3058 000016FA 8B16                    	mov	edx, [esi]
  3059 000016FC 668915[BC200000]        	mov	[next_val_l], dx
  3060                                  	; 26/11/2023
  3061 00001703 C1EA10                  	shr	edx, 16
  3062 00001706 49                      	dec	ecx
  3063 00001707 7509                    	jnz	short lff22s2_2_1
  3064 00001709 31D2                    	xor	edx, edx ; 0
  3065 0000170B 668915[BC200000]        	mov	[next_val_l], dx
  3066                                  lff22s2_2_1:
  3067                                  	; bx = [previous_val_l]
  3068                                  	; ax = [previous_val_r]
  3069                                  	; [next_val_l]
  3070                                  	; dx = [next_val_r]
  3071 00001712 E85D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3072 00001717 E38D                    	jecxz	lff22s2_3
  3073                                  lff22s2_2_2:
  3074 00001719 66AD                    	lodsw
  3075 0000171B 89C3                    	mov	ebx, eax
  3076 0000171D 66AD                    	lodsw
  3077 0000171F 8B16                    	mov	edx, [esi]
  3078 00001721 668915[BC200000]        	mov	[next_val_l], dx
  3079                                  	; 26/11/2023
  3080 00001728 C1EA10                  	shr	edx, 16
  3081 0000172B 49                      	dec	ecx
  3082 0000172C 7509                    	jnz	short lff22s2_2_3
  3083 0000172E 31D2                    	xor	edx, edx ; 0
  3084 00001730 668915[BC200000]        	mov	[next_val_l], dx
  3085                                  lff22s2_2_3:
  3086 00001737 E8B3050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3087 0000173C E31E                    	jecxz	lff22s2_2_4
  3088                                  
  3089 0000173E 4D                      	dec	ebp
  3090 0000173F 75D8                    	jnz	short lff22s2_2_2
  3091                                  
  3092 00001741 A0[C0200000]            	mov	al, [faz]
  3093 00001746 FEC8                    	dec	al
  3094 00001748 749E                    	jz	short lff22s2_9
  3095 0000174A FE0D[C0200000]          	dec	byte [faz]
  3096 00001750 BD04000000              	mov	ebp, 4
  3097 00001755 FEC8                    	dec	al
  3098 00001757 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3099 00001759 45                      	inc	ebp ; 5
  3100 0000175A EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3101                                  
  3102                                  lff22s2_2_4:
  3103                                  	; 26/11/2023
  3104 0000175C E9CFF3FFFF              	jmp	lff22_3	; padfill
  3105                                  
  3106                                  ; .....................
  3107                                  
  3108                                  load_11khz_mono_8_bit:
  3109                                  	; 18/11/2023
  3110 00001761 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3111                                  					; last of the file?
  3112 00001768 7402                    	jz	short lff11m_0		; no
  3113 0000176A F9                      	stc
  3114 0000176B C3                      	retn
  3115                                  
  3116                                  lff11m_0:
  3117 0000176C BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3118                                          ;mov	edx, [loadsize]
  3119                                  
  3120                                  	; esi = buffer address
  3121                                  	;; edx = buffer size
  3122                                  
  3123                                  	; load file into memory
  3124                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001771 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001777 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001779 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000177F B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001784 CD40                <1>  int 40h
  3125 00001786 7247                    	jc	short lff11m_7 ; error !
  3126                                  
  3127 00001788 BF[00800000]            	mov	edi, audio_buffer
  3128                                  	
  3129 0000178D 21C0                    	and	eax, eax
  3130 0000178F 7505                    	jnz	short lff11m_8
  3131 00001791 E9B2F3FFFF              	jmp	lff11_eof
  3132                                  
  3133                                  lff11m_8:
  3134 00001796 89C1                    	mov	ecx, eax		; byte count
  3135                                  lff11m_9:
  3136 00001798 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3137                                  lff11m_1:
  3138                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3139 0000179D AC                      	lodsb
  3140 0000179E B280                    	mov	dl, 80h
  3141 000017A0 49                      	dec	ecx
  3142 000017A1 7402                    	jz	short lff11m_2_1
  3143 000017A3 8A16                    	mov	dl, [esi]
  3144                                  lff11m_2_1:	
  3145                                  	; al = [previous_val]
  3146                                  	; dl = [next_val]
  3147 000017A5 E876050000              	call	interpolating_5_8bit_mono
  3148 000017AA E328                    	jecxz	lff11m_3
  3149                                  lff11m_2_2:
  3150 000017AC AC                      	lodsb
  3151 000017AD B280                    	mov	dl, 80h
  3152 000017AF 49                      	dec	ecx
  3153 000017B0 7402                    	jz	short lff11m_2_3
  3154 000017B2 8A16                    	mov	dl, [esi]
  3155                                  lff11m_2_3:
  3156 000017B4 E873060000               	call	interpolating_4_8bit_mono
  3157 000017B9 E319                    	jecxz	lff11m_3
  3158                                  
  3159 000017BB 4D                      	dec	ebp
  3160 000017BC 74DA                    	jz	short lff11m_9
  3161                                  
  3162 000017BE AC                      	lodsb
  3163 000017BF B280                    	mov	dl, 80h
  3164 000017C1 49                      	dec	ecx
  3165 000017C2 7402                    	jz	short lff11m_2_4
  3166 000017C4 8A16                    	mov	dl, [esi]
  3167                                  lff11m_2_4:
  3168 000017C6 E861060000              	call	interpolating_4_8bit_mono
  3169 000017CB E307                    	jecxz	lff11m_3
  3170 000017CD EBCE                    	jmp	short lff11m_1
  3171                                  
  3172                                  lff11m_7:
  3173                                  lff11s_7:
  3174 000017CF E97DF3FFFF              	jmp	lff11_5  ; error
  3175                                  
  3176                                  lff11m_3:
  3177                                  lff11s_3:
  3178 000017D4 E957F3FFFF              	jmp	lff11_3	; padfill
  3179                                  		; (put zeros in the remain words of the buffer)
  3180                                  
  3181                                  load_11khz_stereo_8_bit:
  3182                                  	; 18/11/2023
  3183 000017D9 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3184                                  					; last of the file?
  3185 000017E0 7402                    	jz	short lff11s_0		; no
  3186 000017E2 F9                      	stc
  3187 000017E3 C3                      	retn
  3188                                  
  3189                                  lff11s_0:
  3190 000017E4 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3191                                          ;mov	edx, [loadsize]
  3192                                  
  3193                                  	; esi = buffer address
  3194                                  	;; edx = buffer size
  3195                                  
  3196                                  	; load file into memory
  3197                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000017E9 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000017EF 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000017F1 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000017F7 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000017FC CD40                <1>  int 40h
  3198 000017FE 72CF                    	jc	short lff11s_7 ; error !
  3199                                  
  3200 00001800 BF[00800000]            	mov	edi, audio_buffer
  3201                                  	
  3202 00001805 D1E8                    	shr	eax, 1
  3203 00001807 7505                    	jnz	short lff11s_8
  3204 00001809 E93AF3FFFF              	jmp	lff11_eof
  3205                                  
  3206                                  lff11s_8:
  3207 0000180E 89C1                    	mov	ecx, eax	; word count
  3208                                  lff11s_9:
  3209 00001810 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3210                                  lff11s_1:
  3211                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3212 00001815 66AD                    	lodsw
  3213 00001817 66BA8080                	mov	dx, 8080h
  3214 0000181B 49                      	dec	ecx
  3215 0000181C 7403                    	jz	short lff11s_2_1 
  3216 0000181E 668B16                  	mov	dx, [esi]
  3217                                  lff11s_2_1:	
  3218                                  	; al = [previous_val_l]
  3219                                  	; ah = [previous_val_r]
  3220                                  	; dl = [next_val_l]
  3221                                  	; dh = [next_val_r]	
  3222 00001821 E859050000              	call	interpolating_5_8bit_stereo
  3223 00001826 E3AC                    	jecxz	lff11s_3
  3224                                  lff11s_2_2:
  3225 00001828 66AD                    	lodsw
  3226 0000182A 66BA8080                	mov	dx, 8080h
  3227 0000182E 49                      	dec	ecx
  3228 0000182F 7403                    	jz	short lff11s_2_3
  3229 00001831 668B16                  	mov	dx, [esi]
  3230                                  lff11s_2_3:
  3231 00001834 E832060000               	call	interpolating_4_8bit_stereo
  3232 00001839 E399                    	jecxz	lff11s_3
  3233                                  	
  3234 0000183B 4D                      	dec	ebp
  3235 0000183C 74D2                    	jz	short lff11s_9
  3236                                  
  3237 0000183E 66AD                    	lodsw
  3238 00001840 66BA8080                	mov	dx, 8080h
  3239 00001844 49                      	dec	ecx
  3240 00001845 7403                    	jz	short lff11s_2_4
  3241 00001847 668B16                  	mov	dx, [esi]
  3242                                  lff11s_2_4:
  3243 0000184A E81C060000              	call	interpolating_4_8bit_stereo
  3244 0000184F E383                    	jecxz	lff11s_3
  3245 00001851 EBC2                    	jmp	short lff11s_1
  3246                                  
  3247                                  load_11khz_mono_16_bit:
  3248                                  	; 18/11/2023
  3249 00001853 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3250                                  					; last of the file?
  3251 0000185A 7402                    	jz	short lff11m2_0		; no
  3252 0000185C F9                      	stc
  3253 0000185D C3                      	retn
  3254                                  
  3255                                  lff11m2_0:
  3256 0000185E BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3257                                          ;mov	edx, [loadsize]
  3258                                  
  3259                                  	; esi = buffer address
  3260                                  	;; edx = buffer size
  3261                                  
  3262                                  	; load file into memory
  3263                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001863 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001869 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 0000186B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001871 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001876 CD40                <1>  int 40h
  3264 00001878 724D                    	jc	short lff11m2_7 ; error !
  3265                                  
  3266 0000187A BF[00800000]            	mov	edi, audio_buffer
  3267                                  	
  3268 0000187F D1E8                    	shr	eax, 1
  3269 00001881 7505                    	jnz	short lff11m2_8
  3270 00001883 E9C0F2FFFF              	jmp	lff11_eof
  3271                                  
  3272                                  lff11m2_8:
  3273 00001888 89C1                    	mov	ecx, eax	; word count
  3274                                  lff11m2_9:
  3275 0000188A BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3276                                  lff11m2_1:
  3277                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3278 0000188F 66AD                    	lodsw
  3279 00001891 31D2                    	xor	edx, edx
  3280 00001893 49                      	dec	ecx
  3281 00001894 7403                    	jz	short lff11m2_2_1
  3282 00001896 668B16                  	mov	dx, [esi]
  3283                                  lff11m2_2_1:	
  3284                                  	; ax = [previous_val]
  3285                                  	; dx = [next_val]
  3286 00001899 E83A060000              	call	interpolating_5_16bit_mono
  3287 0000189E E362                    	jecxz	lff11m2_3
  3288                                  lff11m2_2_2:
  3289 000018A0 66AD                    	lodsw
  3290 000018A2 31D2                    	xor	edx, edx
  3291 000018A4 49                      	dec	ecx
  3292 000018A5 7403                    	jz	short lff11m2_2_3
  3293 000018A7 668B16                  	mov	dx, [esi]
  3294                                  lff11m2_2_3:
  3295 000018AA E853070000               	call	interpolating_4_16bit_mono
  3296 000018AF E351                    	jecxz	lff11m2_3
  3297                                  
  3298 000018B1 4D                      	dec	ebp
  3299 000018B2 74D6                    	jz	short lff11m2_9
  3300                                  
  3301 000018B4 66AD                    	lodsw
  3302 000018B6 31D2                    	xor	edx, edx
  3303 000018B8 49                      	dec	ecx
  3304 000018B9 7403                    	jz	short lff11m2_2_4
  3305 000018BB 668B16                  	mov	dx, [esi]
  3306                                  lff11m2_2_4:
  3307 000018BE E83F070000               	call	interpolating_4_16bit_mono
  3308 000018C3 E33D                    	jecxz	lff11m2_3
  3309 000018C5 EBC8                    	jmp	short lff11m2_1
  3310                                  
  3311                                  lff11m2_7:
  3312                                  lff11s2_7:
  3313 000018C7 E985F2FFFF              	jmp	lff11_5  ; error
  3314                                  
  3315                                  load_11khz_stereo_16_bit:
  3316                                  	; 18/11/2023
  3317 000018CC F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3318                                  					; last of the file?
  3319 000018D3 7402                    	jz	short lff11s2_0		; no
  3320 000018D5 F9                      	stc
  3321 000018D6 C3                      	retn
  3322                                  
  3323                                  lff11s2_0:
  3324 000018D7 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3325                                          ;mov	edx, [loadsize]
  3326                                  
  3327                                  	; esi = buffer address
  3328                                  	;; edx = buffer size
  3329                                  
  3330                                  	; load file into memory
  3331                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 000018DC 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 000018E2 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 000018E4 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 000018EA B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000018EF CD40                <1>  int 40h
  3332 000018F1 72D4                    	jc	short lff11s2_7 ; error !
  3333                                  
  3334 000018F3 BF[00800000]            	mov	edi, audio_buffer
  3335                                  	
  3336 000018F8 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3337 000018FB 750A                    	jnz	short lff11s2_8
  3338 000018FD E946F2FFFF              	jmp	lff11_eof
  3339                                  
  3340                                  lff11m2_3:
  3341                                  lff11s2_3:
  3342 00001902 E929F2FFFF              	jmp	lff11_3	; padfill
  3343                                  		; (put zeros in the remain words of the buffer)
  3344                                  
  3345                                  lff11s2_8:
  3346 00001907 89C1                    	mov	ecx, eax	; dword count
  3347                                  lff11s2_9:
  3348 00001909 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3349                                  lff11s2_1:
  3350                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3351 0000190E 66AD                    	lodsw
  3352 00001910 89C3                    	mov	ebx, eax
  3353 00001912 66AD                    	lodsw
  3354 00001914 8B16                    	mov	edx, [esi]
  3355 00001916 8915[BC200000]          	mov	[next_val_l], edx
  3356                                  	; 26/11/2023
  3357 0000191C C1EA10                  	shr	edx, 16
  3358                                  	;mov	[next_val_r], dx
  3359 0000191F 49                      	dec	ecx
  3360 00001920 7509                    	jnz	short lff11s2_2_1
  3361 00001922 31D2                    	xor	edx, edx ; 0
  3362 00001924 668915[BC200000]        	mov	[next_val_l], dx
  3363                                  	;mov	[next_val_r], dx
  3364                                  lff11s2_2_1:
  3365                                  	; bx = [previous_val_l]
  3366                                  	; ax = [previous_val_r]
  3367                                  	; [next_val_l]
  3368                                  	; dx = [next_val_r]
  3369 0000192B E803060000              	call	interpolating_5_16bit_stereo
  3370 00001930 E3D0                    	jecxz	lff11s2_3
  3371                                  lff11s2_2_2:
  3372 00001932 66AD                    	lodsw
  3373 00001934 89C3                    	mov	ebx, eax
  3374 00001936 66AD                    	lodsw
  3375 00001938 8B16                    	mov	edx, [esi]
  3376 0000193A 668915[BC200000]        	mov	[next_val_l], dx
  3377                                  	; 26/11/2023
  3378 00001941 C1EA10                  	shr	edx, 16
  3379                                  	;mov	[next_val_r], dx
  3380 00001944 49                      	dec	ecx
  3381 00001945 7509                    	jnz	short lff11s2_2_3
  3382 00001947 31D2                    	xor	edx, edx ; 0
  3383 00001949 668915[BC200000]        	mov	[next_val_l], dx
  3384                                  	;mov	[next_val_r], dx
  3385                                  lff11s2_2_3:
  3386 00001950 E8E6060000               	call	interpolating_4_16bit_stereo
  3387 00001955 E3AB                    	jecxz	lff11s2_3
  3388                                  	
  3389 00001957 4D                      	dec	ebp
  3390 00001958 74AF                    	jz	short lff11s2_9
  3391                                  
  3392 0000195A 66AD                    	lodsw
  3393 0000195C 89C3                    	mov	ebx, eax
  3394 0000195E 66AD                    	lodsw
  3395 00001960 8B16                    	mov	edx, [esi]
  3396 00001962 668915[BC200000]        	mov	[next_val_l], dx
  3397                                  	; 26/11/2023
  3398 00001969 C1EA10                  	shr	edx, 16
  3399                                  	;mov	[next_val_r], dx
  3400 0000196C 49                      	dec	ecx
  3401 0000196D 7509                    	jnz	short lff11s2_2_4
  3402 0000196F 31D2                    	xor	edx, edx ; 0
  3403 00001971 668915[BC200000]        	mov	[next_val_l], dx
  3404                                  	;mov	[next_val_r], dx
  3405                                  lff11s2_2_4:
  3406 00001978 E8BE060000               	call	interpolating_4_16bit_stereo
  3407 0000197D E383                    	jecxz	lff11s2_3
  3408 0000197F EB8D                    	jmp	short lff11s2_1
  3409                                  
  3410                                  ; .....................
  3411                                  
  3412                                  load_44khz_mono_8_bit:
  3413                                  	; 18/11/2023
  3414 00001981 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3415                                  					; last of the file?
  3416 00001988 7402                    	jz	short lff44m_0		; no
  3417 0000198A F9                      	stc
  3418 0000198B C3                      	retn
  3419                                  
  3420                                  lff44m_0:
  3421 0000198C BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3422                                          ;mov	edx, [loadsize]
  3423                                  
  3424                                  	; esi = buffer address
  3425                                  	;; edx = buffer size
  3426                                  
  3427                                  	; load file into memory
  3428                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001991 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001997 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001999 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 0000199F B803000000          <1>  mov eax, %1
    90                              <1> 
    91 000019A4 CD40                <1>  int 40h
  3429 000019A6 7250                    	jc	short lff44m_7 ; error !
  3430                                  
  3431 000019A8 BF[00800000]            	mov	edi, audio_buffer
  3432                                  	
  3433 000019AD 21C0                    	and	eax, eax
  3434 000019AF 7505                    	jnz	short lff44m_8
  3435 000019B1 E992F1FFFF              	jmp	lff44_eof
  3436                                  
  3437                                  lff44m_8:
  3438 000019B6 89C1                    	mov	ecx, eax	; byte count
  3439                                  lff44m_9:
  3440 000019B8 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3441 000019BD C605[C0200000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3442                                  lff44m_1:
  3443                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3444                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3445 000019C4 AC                      	lodsb
  3446 000019C5 B280                    	mov	dl, 80h
  3447 000019C7 49                      	dec	ecx
  3448 000019C8 7402                    	jz	short lff44m_2_1
  3449 000019CA 8A16                    	mov	dl, [esi]
  3450                                  lff44m_2_1:	
  3451                                  	; al = [previous_val]
  3452                                  	; dl = [next_val]
  3453 000019CC E825020000              	call	interpolating_2_8bit_mono
  3454 000019D1 E320                    	jecxz	lff44m_3
  3455                                  lff44m_2_2:
  3456 000019D3 AC                      	lodsb
  3457 000019D4 2C80                    	sub	al, 80h
  3458 000019D6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3459 000019DA 66AB                    	stosw		; (L)
  3460 000019DC 66AB                    	stosw		; (R)	
  3461                                  
  3462 000019DE 49                      	dec	ecx
  3463 000019DF 7412                    	jz	short lff44m_3	
  3464 000019E1 4D                      	dec	ebp
  3465 000019E2 75EF                    	jnz	short lff44m_2_2
  3466                                  	
  3467 000019E4 FE0D[C0200000]          	dec	byte [faz]
  3468 000019EA 74CC                    	jz	short lff44m_9 
  3469 000019EC BD0B000000              	mov	ebp, 11
  3470 000019F1 EBD1                    	jmp	short lff44m_1
  3471                                  
  3472                                  lff44m_3:
  3473                                  lff44s_3:
  3474 000019F3 E938F1FFFF              	jmp	lff44_3	; padfill
  3475                                  		; (put zeros in the remain words of the buffer)
  3476                                  lff44m_7:
  3477                                  lff44s_7:
  3478 000019F8 E954F1FFFF              	jmp	lff44_5  ; error
  3479                                  
  3480                                  load_44khz_stereo_8_bit:
  3481                                  	; 16/11/2023
  3482 000019FD F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3483                                  					; last of the file?
  3484 00001A04 7402                    	jz	short lff44s_0		; no
  3485 00001A06 F9                      	stc
  3486 00001A07 C3                      	retn
  3487                                  
  3488                                  lff44s_0:
  3489 00001A08 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3490                                          ;mov	edx, [loadsize]
  3491                                  
  3492                                  	; esi = buffer address
  3493                                  	;; edx = buffer size
  3494                                  
  3495                                  	; load file into memory
  3496                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001A0D 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001A13 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001A15 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001A1B B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001A20 CD40                <1>  int 40h
  3497 00001A22 72D4                    	jc	short lff44s_7 ; error !
  3498                                  
  3499 00001A24 BF[00800000]            	mov	edi, audio_buffer
  3500                                  	
  3501 00001A29 D1E8                    	shr	eax, 1
  3502 00001A2B 7505                    	jnz	short lff44s_8
  3503 00001A2D E916F1FFFF              	jmp	lff44_eof
  3504                                  
  3505                                  lff44s_8:
  3506 00001A32 89C1                    	mov	ecx, eax	; word count
  3507                                  lff44s_9:
  3508 00001A34 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3509 00001A39 C605[C0200000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3510                                  lff44s_1:
  3511                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3512                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3513 00001A40 66AD                    	lodsw
  3514 00001A42 66BA8080                	mov	dx, 8080h
  3515 00001A46 49                      	dec	ecx
  3516 00001A47 7403                    	jz	short lff44s_2_1 
  3517 00001A49 668B16                  	mov	dx, [esi]
  3518                                  lff44s_2_1:	
  3519                                  	; al = [previous_val_l]
  3520                                  	; ah = [previous_val_r]
  3521                                  	; dl = [next_val_l]
  3522                                  	; dh = [next_val_r]	
  3523 00001A4C E8C2010000              	call	interpolating_2_8bit_stereo
  3524 00001A51 E3A0                    	jecxz	lff44s_3
  3525                                  lff44s_2_2:
  3526 00001A53 AC                      	lodsb
  3527 00001A54 2C80                    	sub	al, 80h
  3528 00001A56 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3529 00001A5A 66AB                    	stosw		; (L)
  3530 00001A5C AC                      	lodsb
  3531 00001A5D 2C80                    	sub	al, 80h
  3532 00001A5F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3533 00001A63 66AB                    	stosw		; (R)
  3534                                  
  3535 00001A65 49                      	dec	ecx
  3536 00001A66 748B                    	jz	short lff44s_3	
  3537 00001A68 4D                      	dec	ebp
  3538 00001A69 75E8                    	jnz	short lff44s_2_2
  3539                                  	
  3540 00001A6B FE0D[C0200000]          	dec	byte [faz]
  3541 00001A71 74C1                    	jz	short lff44s_9 
  3542 00001A73 BD0B000000              	mov	ebp, 11
  3543 00001A78 EBC6                    	jmp	short lff44s_1
  3544                                  
  3545                                  load_44khz_mono_16_bit:
  3546                                  	; 18/11/2023
  3547 00001A7A F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3548                                  					; last of the file?
  3549 00001A81 7402                    	jz	short lff44m2_0		; no
  3550 00001A83 F9                      	stc
  3551 00001A84 C3                      	retn
  3552                                  
  3553                                  lff44m2_0:
  3554 00001A85 BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3555                                          ;mov	edx, [loadsize]
  3556                                  
  3557                                  	; esi = buffer address
  3558                                  	;; edx = buffer size
  3559                                  
  3560                                  	; load file into memory
  3561                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001A8A 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001A90 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001A92 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001A98 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001A9D CD40                <1>  int 40h
  3562 00001A9F 724D                    	jc	short lff44m2_7 ; error !
  3563                                  
  3564 00001AA1 BF[00800000]            	mov	edi, audio_buffer
  3565                                  	
  3566 00001AA6 D1E8                    	shr	eax, 1
  3567 00001AA8 7505                    	jnz	short lff44m2_8
  3568 00001AAA E999F0FFFF              	jmp	lff44_eof
  3569                                  
  3570                                  lff44m2_8:
  3571 00001AAF 89C1                    	mov	ecx, eax	; word count
  3572                                  lff44m2_9:
  3573 00001AB1 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3574 00001AB6 C605[C0200000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3575                                  lff44m2_1:
  3576                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3577                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3578 00001ABD 66AD                    	lodsw
  3579 00001ABF 31D2                    	xor	edx, edx
  3580 00001AC1 49                      	dec	ecx
  3581 00001AC2 7403                    	jz	short lff44m2_2_1
  3582 00001AC4 668B16                  	mov	dx, [esi]
  3583                                  lff44m2_2_1:	
  3584                                  	; ax = [previous_val]
  3585                                  	; dx = [next_val]
  3586 00001AC7 E80B020000              	call	interpolating_2_16bit_mono
  3587 00001ACC E31B                    	jecxz	lff44m2_3
  3588                                  lff44m2_2_2:
  3589 00001ACE 66AD                    	lodsw
  3590 00001AD0 66AB                    	stosw		; (L)eft Channel
  3591 00001AD2 66AB                    	stosw		; (R)ight Channel
  3592                                  
  3593 00001AD4 49                      	dec	ecx
  3594 00001AD5 7412                    	jz	short lff44m2_3	
  3595 00001AD7 4D                      	dec	ebp
  3596 00001AD8 75F4                    	jnz	short lff44m2_2_2
  3597                                  	
  3598 00001ADA FE0D[C0200000]          	dec	byte [faz]
  3599 00001AE0 74CF                    	jz	short lff44m2_9 
  3600 00001AE2 BD0B000000              	mov	ebp, 11
  3601 00001AE7 EBD4                    	jmp	short lff44m2_1
  3602                                  
  3603                                  lff44m2_3:
  3604                                  lff44s2_3:
  3605 00001AE9 E942F0FFFF              	jmp	lff44_3	; padfill
  3606                                  		; (put zeros in the remain words of the buffer)
  3607                                  lff44m2_7:
  3608                                  lff44s2_7:
  3609 00001AEE E95EF0FFFF              	jmp	lff44_5  ; error
  3610                                  
  3611                                  load_44khz_stereo_16_bit:
  3612                                  	; 18/11/2023
  3613 00001AF3 F605[A8680000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3614                                  					; last of the file?
  3615 00001AFA 7402                    	jz	short lff44s2_0		; no
  3616 00001AFC F9                      	stc
  3617 00001AFD C3                      	retn
  3618                                  
  3619                                  lff44s2_0:
  3620 00001AFE BE[00000400]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3621                                          ;mov	edx, [loadsize]
  3622                                  
  3623                                  	; esi = buffer address
  3624                                  	;; edx = buffer size
  3625                                  
  3626                                  	; load file into memory
  3627                                  	sys 	_read, [FileHandle], esi, [loadsize]
    76                              <1> 
    77                              <1> 
    78                              <1> 
    79                              <1> 
    80                              <1>  %if %0 >= 2
    81 00001B03 8B1D[87650000]      <1>  mov ebx, %2
    82                              <1>  %if %0 >= 3
    83 00001B09 89F1                <1>  mov ecx, %3
    84                              <1>  %if %0 = 4
    85 00001B0B 8B15[DD030000]      <1>  mov edx, %4
    86                              <1>  %endif
    87                              <1>  %endif
    88                              <1>  %endif
    89 00001B11 B803000000          <1>  mov eax, %1
    90                              <1> 
    91 00001B16 CD40                <1>  int 40h
  3628 00001B18 72D4                    	jc	short lff44s2_7 ; error !
  3629                                  
  3630 00001B1A BF[00800000]            	mov	edi, audio_buffer
  3631                                  	
  3632 00001B1F C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3633 00001B22 7505                    	jnz	short lff44s2_8
  3634 00001B24 E91FF0FFFF              	jmp	lff44_eof
  3635                                  
  3636                                  lff44s2_8:
  3637 00001B29 89C1                    	mov	ecx, eax	; dword count
  3638                                  lff44s2_9:
  3639 00001B2B BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3640 00001B30 C605[C0200000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3641                                  lff44s2_1:
  3642                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3643                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3644 00001B37 66AD                    	lodsw
  3645 00001B39 89C3                    	mov	ebx, eax
  3646 00001B3B 66AD                    	lodsw
  3647                                  	;mov	dx, [esi]
  3648                                  	;mov	[next_val_l], dx
  3649                                  	;mov	dx, [esi+2]
  3650                                  	; 26/11/2023
  3651 00001B3D 8B16                    	mov	edx, [esi]
  3652 00001B3F 668915[BC200000]        	mov	[next_val_l], dx
  3653 00001B46 C1EA10                  	shr	edx, 16
  3654 00001B49 49                      	dec	ecx
  3655 00001B4A 7509                    	jnz	short lff44s2_2_1
  3656 00001B4C 31D2                    	xor	edx, edx ; 0
  3657 00001B4E 668915[BC200000]        	mov	[next_val_l], dx
  3658                                  lff44s2_2_1:
  3659                                  	; bx = [previous_val_l]
  3660                                  	; ax = [previous_val_r]
  3661                                  	; [next_val_l]
  3662                                  	; dx = [next_val_r]
  3663 00001B55 E895010000              	call	interpolating_2_16bit_stereo
  3664 00001B5A E38D                    	jecxz	lff44s2_3
  3665                                  lff44s2_2_2:
  3666                                  	;movsw		; (L)eft Channel
  3667                                  	;movsw		; (R)ight Channel
  3668 00001B5C A5                      	movsd
  3669                                  
  3670 00001B5D 49                      	dec	ecx
  3671 00001B5E 7489                    	jz	short lff44s2_3	
  3672 00001B60 4D                      	dec	ebp
  3673 00001B61 75F9                    	jnz	short lff44s2_2_2
  3674                                  	
  3675 00001B63 FE0D[C0200000]          	dec	byte [faz]
  3676 00001B69 74C0                    	jz	short lff44s2_9 
  3677 00001B6B BD0B000000              	mov	ebp, 11
  3678 00001B70 EBC5                    	jmp	short lff44s2_1
  3679                                  
  3680                                  ; .....................
  3681                                  
  3682                                  interpolating_3_8bit_mono:
  3683                                  	; 16/11/2023
  3684                                  	; al = [previous_val]
  3685                                  	; dl = [next_val]
  3686                                  	; original-interpolated-interpolated
  3687 00001B72 88C3                    	mov	bl, al
  3688 00001B74 2C80                    	sub	al, 80h
  3689 00001B76 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3690 00001B7A 66AB                    	stosw		; original sample (L)
  3691 00001B7C 66AB                    	stosw		; original sample (R)
  3692 00001B7E 88D8                    	mov	al, bl
  3693 00001B80 00D0                    	add	al, dl	
  3694 00001B82 D0D8                    	rcr	al, 1
  3695 00001B84 88C7                    	mov	bh, al	; interpolated middle (temporary)
  3696 00001B86 00D8                    	add	al, bl
  3697 00001B88 D0D8                    	rcr	al, 1
  3698 00001B8A 2C80                    	sub	al, 80h
  3699 00001B8C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3700 00001B90 66AB                    	stosw		; interpolated sample 1 (L)
  3701 00001B92 66AB                    	stosw		; interpolated sample 1 (R)
  3702 00001B94 88F8                    	mov	al, bh
  3703 00001B96 00D0                    	add	al, dl	; [next_val]
  3704 00001B98 D0D8                    	rcr	al, 1
  3705 00001B9A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3706 00001B9E 66AB                    	stosw		; interpolated sample 2 (L)
  3707 00001BA0 66AB                    	stosw		; interpolated sample 2 (R)
  3708 00001BA2 C3                      	retn
  3709                                  
  3710                                  interpolating_3_8bit_stereo:
  3711                                  	; 16/11/2023
  3712                                  	; al = [previous_val_l]
  3713                                  	; ah = [previous_val_r]
  3714                                  	; dl = [next_val_l]
  3715                                  	; dh = [next_val_r]	
  3716                                  	; original-interpolated-interpolated
  3717 00001BA3 89C3                    	mov	ebx, eax
  3718 00001BA5 2C80                    	sub	al, 80h
  3719 00001BA7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3720 00001BAB 66AB                    	stosw		; original sample (L)
  3721 00001BAD 88F8                    	mov	al, bh
  3722 00001BAF 2C80                    	sub	al, 80h
  3723 00001BB1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3724 00001BB5 66AB                    	stosw		; original sample (R)
  3725 00001BB7 88D8                    	mov	al, bl
  3726 00001BB9 00D0                    	add	al, dl	; [next_val_l]	
  3727 00001BBB D0D8                    	rcr	al, 1
  3728 00001BBD 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  3729 00001BBE 00D8                    	add	al, bl	; [previous_val_l]
  3730 00001BC0 D0D8                    	rcr	al, 1
  3731 00001BC2 2C80                    	sub	al, 80h
  3732 00001BC4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3733 00001BC8 66AB                    	stosw		; interpolated sample 1 (L)
  3734 00001BCA 88F8                    	mov	al, bh
  3735 00001BCC 00F0                    	add	al, dh	; [next_val_r]
  3736 00001BCE D0D8                    	rcr	al, 1
  3737 00001BD0 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  3738 00001BD1 00F8                    	add	al, bh	; [previous_val_r]
  3739 00001BD3 D0D8                    	rcr	al, 1
  3740 00001BD5 2C80                    	sub	al, 80h
  3741 00001BD7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3742 00001BDB 66AB                    	stosw		; interpolated sample 1 (R)
  3743 00001BDD 5B                      	pop	ebx ; **
  3744 00001BDE 58                      	pop	eax ; *
  3745 00001BDF 00D0                    	add	al, dl	; [next_val_l]
  3746 00001BE1 D0D8                    	rcr	al, 1
  3747 00001BE3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3748 00001BE7 66AB                    	stosw		; interpolated sample 2 (L)
  3749 00001BE9 88D8                    	mov	al, bl
  3750 00001BEB 00F0                    	add	al, dh	; [next_val_r]
  3751 00001BED D0D8                    	rcr	al, 1
  3752 00001BEF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3753 00001BF3 66AB                    	stosw		; interpolated sample 2 (R)
  3754 00001BF5 C3                      	retn
  3755                                  
  3756                                  interpolating_2_8bit_mono:
  3757                                  	; 16/11/2023
  3758                                  	; al = [previous_val]
  3759                                  	; dl = [next_val]
  3760                                  	; original-interpolated
  3761 00001BF6 88C3                    	mov	bl, al
  3762 00001BF8 2C80                    	sub	al, 80h
  3763 00001BFA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3764 00001BFE 66AB                    	stosw		; original sample (L)
  3765 00001C00 66AB                    	stosw		; original sample (R)
  3766 00001C02 88D8                    	mov	al, bl
  3767 00001C04 00D0                    	add	al, dl	
  3768 00001C06 D0D8                    	rcr	al, 1
  3769 00001C08 2C80                    	sub	al, 80h
  3770 00001C0A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3771 00001C0E 66AB                    	stosw		; interpolated sample (L)
  3772 00001C10 66AB                    	stosw		; interpolated sample (R)
  3773 00001C12 C3                      	retn
  3774                                  
  3775                                  interpolating_2_8bit_stereo:
  3776                                  	; 16/11/2023
  3777                                  	; al = [previous_val_l]
  3778                                  	; ah = [previous_val_r]
  3779                                  	; dl = [next_val_l]
  3780                                  	; dh = [next_val_r]	
  3781                                  	; original-interpolated
  3782 00001C13 89C3                    	mov	ebx, eax
  3783 00001C15 2C80                    	sub	al, 80h
  3784 00001C17 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3785 00001C1B 66AB                    	stosw		; original sample (L)
  3786 00001C1D 88F8                    	mov	al, bh
  3787 00001C1F 2C80                    	sub	al, 80h
  3788 00001C21 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3789 00001C25 66AB                    	stosw		; original sample (R)
  3790 00001C27 88D8                    	mov	al, bl	; [previous_val_l]
  3791 00001C29 00D0                    	add	al, dl	; [next_val_l]	
  3792 00001C2B D0D8                    	rcr	al, 1
  3793 00001C2D 2C80                    	sub	al, 80h
  3794 00001C2F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3795 00001C33 66AB                    	stosw		; interpolated sample (L)
  3796 00001C35 88F8                    	mov	al, bh
  3797 00001C37 00F0                    	add	al, dh	; [next_val_r]
  3798 00001C39 D0D8                    	rcr	al, 1
  3799 00001C3B 2C80                    	sub	al, 80h
  3800 00001C3D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3801 00001C41 66AB                    	stosw		; interpolated sample (R)
  3802 00001C43 C3                      	retn
  3803                                  
  3804                                  interpolating_3_16bit_mono:
  3805                                  	; 16/11/2023
  3806                                  	; ax = [previous_val]
  3807                                  	; dx = [next_val]
  3808                                  	; original-interpolated-interpolated
  3809                                  
  3810 00001C44 66AB                    	stosw		; original sample (L)
  3811 00001C46 66AB                    	stosw		; original sample (R)
  3812 00001C48 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3813 00001C4B 50                      	push	eax ; *	; [previous_val]
  3814 00001C4C 80C680                  	add	dh, 80h
  3815 00001C4F 6601D0                  	add	ax, dx
  3816 00001C52 66D1D8                  	rcr	ax, 1
  3817 00001C55 5B                      	pop	ebx ; *		
  3818 00001C56 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  3819 00001C57 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  3820 00001C5A 66D1D8                  	rcr	ax, 1
  3821 00001C5D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3822 00001C60 66AB                    	stosw 		; interpolated sample 1 (L)
  3823 00001C62 66AB                    	stosw		; interpolated sample 1 (R)
  3824 00001C64 89D8                    	mov	eax, ebx
  3825 00001C66 6601D0                  	add	ax, dx	 ;interpolated middle + [next_val]
  3826 00001C69 66D1D8                  	rcr	ax, 1
  3827 00001C6C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3828 00001C6F 66AB                    	stosw		; interpolated sample 2 (L)
  3829 00001C71 66AB                    	stosw		; interpolated sample 2 (R)
  3830 00001C73 C3                      	retn
  3831                                  
  3832                                  interpolating_3_16bit_stereo:
  3833                                  	; 16/11/2023
  3834                                  	; bx = [previous_val_l]
  3835                                  	; ax = [previous_val_r]
  3836                                  	; [next_val_l]
  3837                                  	; dx = [next_val_r]
  3838                                  	; original-interpolated-interpolated
  3839                                  
  3840 00001C74 93                      	xchg	eax, ebx
  3841 00001C75 66AB                    	stosw		; original sample (L)
  3842 00001C77 93                      	xchg	eax, ebx
  3843 00001C78 66AB                    	stosw		; original sample (R)
  3844 00001C7A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3845 00001C7D 50                      	push	eax ; *	; [previous_val_r]
  3846 00001C7E 80C780                  	add	bh, 80h
  3847 00001C81 8005[BD200000]80        	add	byte [next_val_l+1], 80h
  3848 00001C88 66A1[BC200000]          	mov	ax, [next_val_l]
  3849 00001C8E 6601D8                  	add	ax, bx	; [previous_val_l]
  3850 00001C91 66D1D8                  	rcr	ax, 1
  3851 00001C94 93                      	xchg	eax, ebx ; ax = [previous_val_l]	
  3852 00001C95 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  3853 00001C98 66D1D8                  	rcr	ax, 1
  3854 00001C9B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3855 00001C9E 66AB                    	stosw 		; interpolated sample 1 (L)
  3856 00001CA0 58                      	pop	eax  ; *
  3857 00001CA1 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  3858 00001CA4 52                      	push	edx  ; * ; [next_val_r]
  3859 00001CA5 92                      	xchg	eax, edx
  3860 00001CA6 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  3861 00001CA9 66D1D8                  	rcr	ax, 1	; / 2
  3862 00001CAC 50                      	push	eax ; ** ; interpolated middle (R)
  3863 00001CAD 6601D0                  	add	ax, dx	; + [previous_val_r]
  3864 00001CB0 66D1D8                  	rcr	ax, 1
  3865 00001CB3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3866 00001CB6 66AB                    	stosw 		; interpolated sample 1 (R)
  3867 00001CB8 66A1[BC200000]          	mov	ax, [next_val_l]
  3868 00001CBE 6601D8                  	add	ax, bx	; + interpolated middle (L)
  3869 00001CC1 66D1D8                  	rcr	ax, 1
  3870 00001CC4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3871 00001CC7 66AB                    	stosw 		; interpolated sample 2 (L)
  3872 00001CC9 58                      	pop	eax ; **
  3873 00001CCA 5A                      	pop	edx ; *	
  3874 00001CCB 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  3875 00001CCE 66D1D8                  	rcr	ax, 1	; / 2
  3876 00001CD1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3877 00001CD4 66AB                    	stosw 		; interpolated sample 2 (L)
  3878 00001CD6 C3                      	retn
  3879                                  
  3880                                  interpolating_2_16bit_mono:
  3881                                  	; 16/11/2023
  3882                                  	; ax = [previous_val]
  3883                                  	; dx = [next_val]
  3884                                  	; original-interpolated
  3885                                  
  3886 00001CD7 66AB                    	stosw		; original sample (L)
  3887 00001CD9 66AB                    	stosw		; original sample (R)
  3888 00001CDB 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3889 00001CDE 80C680                  	add	dh, 80h
  3890 00001CE1 6601D0                  	add	ax, dx
  3891 00001CE4 66D1D8                  	rcr	ax, 1
  3892 00001CE7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3893 00001CEA 66AB                    	stosw		; interpolated sample (L)
  3894 00001CEC 66AB                    	stosw		; interpolated sample (R)
  3895 00001CEE C3                      	retn
  3896                                  
  3897                                  interpolating_2_16bit_stereo:
  3898                                  	; 16/11/2023
  3899                                  	; bx = [previous_val_l]
  3900                                  	; ax = [previous_val_r]
  3901                                  	; [next_val_l]
  3902                                  	; dx = [next_val_r]
  3903                                  	; original-interpolated
  3904                                  
  3905 00001CEF 93                      	xchg	eax, ebx
  3906 00001CF0 66AB                    	stosw		; original sample (L)
  3907 00001CF2 93                      	xchg	eax, ebx
  3908 00001CF3 66AB                    	stosw		; original sample (R)
  3909 00001CF5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  3910 00001CF8 80C680                  	add	dh, 80h
  3911 00001CFB 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  3912 00001CFE 66D1D8                  	rcr	ax, 1	; / 2
  3913 00001D01 50                      	push	eax ; *	; interpolated sample (R)
  3914 00001D02 66A1[BC200000]          	mov	ax, [next_val_l]
  3915 00001D08 80C480                  	add	ah, 80h
  3916 00001D0B 80C780                  	add	bh, 80h
  3917 00001D0E 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  3918 00001D11 66D1D8                  	rcr	ax, 1	; / 2		
  3919 00001D14 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3920 00001D17 66AB                    	stosw 		; interpolated sample (L)
  3921 00001D19 58                      	pop	eax ; *	
  3922 00001D1A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3923 00001D1D 66AB                    	stosw 		; interpolated sample (R)
  3924 00001D1F C3                      	retn
  3925                                  
  3926                                  interpolating_5_8bit_mono:
  3927                                  	; 17/11/2023
  3928                                  	; al = [previous_val]
  3929                                  	; dl = [next_val]
  3930                                  	; original-interpltd-interpltd-interpltd-interpltd
  3931 00001D20 88C3                    	mov	bl, al
  3932 00001D22 2C80                    	sub	al, 80h
  3933 00001D24 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3934 00001D28 66AB                    	stosw		; original sample (L)
  3935 00001D2A 66AB                    	stosw		; original sample (R)
  3936 00001D2C 88D8                    	mov	al, bl
  3937 00001D2E 00D0                    	add	al, dl	
  3938 00001D30 D0D8                    	rcr	al, 1
  3939 00001D32 88C7                    	mov	bh, al	; interpolated middle (temporary)
  3940 00001D34 00D8                    	add	al, bl  ; [previous_val]
  3941 00001D36 D0D8                    	rcr	al, 1 	
  3942 00001D38 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  3943 00001D3A 00D8                    	add	al, bl
  3944 00001D3C D0D8                    	rcr	al, 1
  3945 00001D3E 2C80                    	sub	al, 80h
  3946 00001D40 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3947 00001D44 66AB                    	stosw		; interpolated sample 1 (L)
  3948 00001D46 66AB                    	stosw		; interpolated sample 1 (R)
  3949 00001D48 88F8                    	mov	al, bh
  3950 00001D4A 00F0                    	add	al, dh
  3951 00001D4C D0D8                    	rcr	al, 1
  3952 00001D4E 2C80                    	sub	al, 80h
  3953 00001D50 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3954 00001D54 66AB                    	stosw		; interpolated sample 2 (L)
  3955 00001D56 66AB                    	stosw		; interpolated sample 2 (R)
  3956 00001D58 88F8                    	mov	al, bh
  3957 00001D5A 00D0                    	add	al, dl	; [next_val]
  3958 00001D5C D0D8                    	rcr	al, 1
  3959 00001D5E 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  3960 00001D60 00F8                    	add	al, bh
  3961 00001D62 D0D8                    	rcr	al, 1
  3962 00001D64 2C80                    	sub	al, 80h
  3963 00001D66 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3964 00001D6A 66AB                    	stosw		; interpolated sample 3 (L)
  3965 00001D6C 66AB                    	stosw		; interpolated sample 3 (R)
  3966 00001D6E 88F0                    	mov	al, dh
  3967 00001D70 00D0                    	add	al, dl
  3968 00001D72 D0D8                    	rcr	al, 1
  3969 00001D74 2C80                    	sub	al, 80h
  3970 00001D76 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3971 00001D7A 66AB                    	stosw		; interpolated sample 4 (L)
  3972 00001D7C 66AB                    	stosw		; interpolated sample 4 (R)
  3973 00001D7E C3                      	retn
  3974                                  
  3975                                  interpolating_5_8bit_stereo:
  3976                                  	; 17/11/2023
  3977                                  	; al = [previous_val_l]
  3978                                  	; ah = [previous_val_r]
  3979                                  	; dl = [next_val_l]
  3980                                  	; dh = [next_val_r]	
  3981                                  	; original-interpltd-interpltd-interpltd-interpltd
  3982 00001D7F 89C3                    	mov	ebx, eax
  3983 00001D81 2C80                    	sub	al, 80h
  3984 00001D83 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3985 00001D87 66AB                    	stosw		; original sample (L)
  3986 00001D89 88F8                    	mov	al, bh
  3987 00001D8B 2C80                    	sub	al, 80h
  3988 00001D8D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3989 00001D91 66AB                    	stosw		; original sample (R)
  3990 00001D93 52                      	push	edx ; *
  3991 00001D94 88D8                    	mov	al, bl
  3992 00001D96 00D0                    	add	al, dl	; [next_val_l]
  3993 00001D98 D0D8                    	rcr	al, 1
  3994 00001D9A 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  3995 00001D9B 00D8                    	add	al, bl	; [previous_val_l]
  3996 00001D9D D0D8                    	rcr	al, 1
  3997 00001D9F 86D8                    	xchg	al, bl	
  3998 00001DA1 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  3999 00001DA3 D0D8                    	rcr	al, 1
  4000 00001DA5 2C80                    	sub	al, 80h
  4001 00001DA7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4002 00001DAB 66AB                    	stosw		; interpolated sample 1 (L)
  4003 00001DAD 88F8                    	mov	al, bh
  4004 00001DAF 00F0                    	add	al, dh	; [next_val_r]
  4005 00001DB1 D0D8                    	rcr	al, 1
  4006 00001DB3 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4007 00001DB4 00F8                    	add	al, bh	; [previous_val_r]
  4008 00001DB6 D0D8                    	rcr	al, 1
  4009 00001DB8 86F8                    	xchg	al, bh	
  4010 00001DBA 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4011 00001DBC D0D8                    	rcr	al, 1
  4012 00001DBE 2C80                    	sub	al, 80h
  4013 00001DC0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4014 00001DC4 66AB                    	stosw		; interpolated sample 1 (R)
  4015 00001DC6 5A                      	pop	edx ; ***
  4016 00001DC7 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4017 00001DC8 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4018 00001DCA 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4019 00001DCC D0D8                    	rcr	al, 1
  4020 00001DCE 2C80                    	sub	al, 80h
  4021 00001DD0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4022 00001DD4 66AB                    	stosw		; interpolated sample 2 (L)	
  4023 00001DD6 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4024 00001DD8 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4025 00001DDA 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4026 00001DDC D0D8                    	rcr	al, 1
  4027 00001DDE 2C80                    	sub	al, 80h
  4028 00001DE0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4029 00001DE4 66AB                    	stosw		; interpolated sample 2 (R)
  4030 00001DE6 5A                      	pop	edx ; *
  4031 00001DE7 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4032 00001DE9 00D0                    	add	al, dl	; [next_val_l]
  4033 00001DEB D0D8                    	rcr	al, 1
  4034 00001DED 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)	
  4035 00001DEF 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp) 
  4036 00001DF1 D0D8                    	rcr	al, 1
  4037 00001DF3 2C80                    	sub	al, 80h
  4038 00001DF5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4039 00001DF9 66AB                    	stosw		; interpolated sample 3 (L)
  4040 00001DFB 88F8                    	mov	al, bh	
  4041 00001DFD 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4042 00001DFF D0D8                    	rcr	al, 1
  4043 00001E01 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4044 00001E03 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4045 00001E05 D0D8                    	rcr	al, 1
  4046 00001E07 2C80                    	sub	al, 80h
  4047 00001E09 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4048 00001E0D 66AB                    	stosw		; interpolated sample 3 (R)
  4049 00001E0F 88D8                    	mov	al, bl
  4050 00001E11 00D0                    	add	al, dl	; [next_val_l]
  4051 00001E13 D0D8                    	rcr	al, 1
  4052 00001E15 2C80                    	sub	al, 80h
  4053 00001E17 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4054 00001E1B 66AB                    	stosw		; interpolated sample 4 (L)
  4055 00001E1D 88F8                    	mov	al, bh
  4056 00001E1F 00F0                    	add	al, dh	; [next_val_r]
  4057 00001E21 D0D8                    	rcr	al, 1
  4058 00001E23 2C80                    	sub	al, 80h
  4059 00001E25 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4060 00001E29 66AB                    	stosw		; interpolated sample 4 (R)
  4061 00001E2B C3                      	retn
  4062                                  
  4063                                  interpolating_4_8bit_mono:
  4064                                  	; 17/11/2023
  4065                                  	; al = [previous_val]
  4066                                  	; dl = [next_val]
  4067                                  	; original-interpolated-interpolated-interpolated
  4068 00001E2C 88C3                    	mov	bl, al
  4069 00001E2E 2C80                    	sub	al, 80h
  4070 00001E30 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4071 00001E34 66AB                    	stosw		; original sample (L)
  4072 00001E36 66AB                    	stosw		; original sample (R)
  4073 00001E38 88D8                    	mov	al, bl
  4074 00001E3A 00D0                    	add	al, dl	
  4075 00001E3C D0D8                    	rcr	al, 1
  4076 00001E3E 86D8                    	xchg	al, bl  ; al = [previous_val]
  4077 00001E40 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4078 00001E42 D0D8                    	rcr	al, 1 	
  4079 00001E44 2C80                    	sub	al, 80h
  4080 00001E46 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4081 00001E4A 66AB                    	stosw		; interpolated sample 1 (L)
  4082 00001E4C 66AB                    	stosw		; interpolated sample 1 (R)
  4083 00001E4E 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4084 00001E50 2C80                    	sub	al, 80h
  4085 00001E52 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4086 00001E56 66AB                    	stosw		; interpolated sample 2 (L)
  4087 00001E58 66AB                    	stosw		; interpolated sample 2 (R)
  4088 00001E5A 88D8                    	mov	al, bl
  4089 00001E5C 00D0                    	add	al, dl	; [next_val]
  4090 00001E5E D0D8                    	rcr	al, 1
  4091 00001E60 2C80                    	sub	al, 80h
  4092 00001E62 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4093 00001E66 66AB                    	stosw		; interpolated sample 3 (L)
  4094 00001E68 66AB                    	stosw		; interpolated sample 3 (R)
  4095 00001E6A C3                      	retn
  4096                                  
  4097                                  interpolating_4_8bit_stereo:
  4098                                  	; 17/11/2023
  4099                                  	; al = [previous_val_l]
  4100                                  	; ah = [previous_val_r]
  4101                                  	; dl = [next_val_l]
  4102                                  	; dh = [next_val_r]	
  4103                                  	; original-interpolated-interpolated-interpolated
  4104 00001E6B 89C3                    	mov	ebx, eax
  4105 00001E6D 2C80                    	sub	al, 80h
  4106 00001E6F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4107 00001E73 66AB                    	stosw		; original sample (L)
  4108 00001E75 88F8                    	mov	al, bh
  4109 00001E77 2C80                    	sub	al, 80h
  4110 00001E79 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4111 00001E7D 66AB                    	stosw		; original sample (R)
  4112 00001E7F 88D8                    	mov	al, bl
  4113 00001E81 00D0                    	add	al, dl	; [next_val_l]
  4114 00001E83 D0D8                    	rcr	al, 1
  4115 00001E85 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4116 00001E87 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4117 00001E89 D0D8                    	rcr	al, 1
  4118 00001E8B 2C80                    	sub	al, 80h
  4119 00001E8D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4120 00001E91 66AB                    	stosw		; interpolated sample 1 (L)
  4121 00001E93 88F8                    	mov	al, bh
  4122 00001E95 00F0                    	add	al, dh	; [next_val_r]
  4123 00001E97 D0D8                    	rcr	al, 1
  4124 00001E99 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4125 00001E9B 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4126 00001E9D D0D8                    	rcr	al, 1
  4127 00001E9F 2C80                    	sub	al, 80h
  4128 00001EA1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4129 00001EA5 66AB                    	stosw		; interpolated sample 1 (R)
  4130 00001EA7 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4131 00001EA9 2C80                    	sub	al, 80h
  4132 00001EAB 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4133 00001EAF 66AB                    	stosw		; interpolated sample 2 (L)
  4134 00001EB1 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4135 00001EB3 2C80                    	sub	al, 80h
  4136 00001EB5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4137 00001EB9 66AB                    	stosw		; interpolated sample 2 (L)
  4138 00001EBB 88D8                    	mov	al, bl
  4139 00001EBD 00D0                    	add	al, dl	; [next_val_l]
  4140 00001EBF D0D8                    	rcr	al, 1
  4141 00001EC1 2C80                    	sub	al, 80h
  4142 00001EC3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4143 00001EC7 66AB                    	stosw		; interpolated sample 3 (L)
  4144 00001EC9 88F8                    	mov	al, bh
  4145 00001ECB 00F0                    	add	al, dh	; [next_val_r]
  4146 00001ECD D0D8                    	rcr	al, 1
  4147 00001ECF 2C80                    	sub	al, 80h
  4148 00001ED1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4149 00001ED5 66AB                    	stosw		; interpolated sample 3 (R)
  4150 00001ED7 C3                      	retn
  4151                                  
  4152                                  interpolating_5_16bit_mono:
  4153                                  	; 18/11/2023
  4154                                  	; ax = [previous_val]
  4155                                  	; dx = [next_val]
  4156                                  	; original-interpltd-interpltd-interpltd-interpltd
  4157 00001ED8 66AB                    	stosw		; original sample (L)
  4158 00001EDA 66AB                    	stosw		; original sample (R)
  4159 00001EDC 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4160 00001EDF 89C3                    	mov	ebx, eax ; [previous_val]
  4161 00001EE1 80C680                  	add	dh, 80h
  4162 00001EE4 6601D0                  	add	ax, dx
  4163 00001EE7 66D1D8                  	rcr	ax, 1
  4164 00001EEA 50                      	push	eax ; *	; interpolated middle (temporary)
  4165 00001EEB 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4166 00001EEE 66D1D8                  	rcr	ax, 1
  4167 00001EF1 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4168 00001EF2 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4169 00001EF5 66D1D8                  	rcr	ax, 1	
  4170 00001EF8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4171 00001EFB 66AB                    	stosw 		; interpolated sample 1 (L)
  4172 00001EFD 66AB                    	stosw		; interpolated sample 1 (R)
  4173 00001EFF 58                      	pop	eax ; **	
  4174 00001F00 5B                      	pop	ebx ; *
  4175 00001F01 6601D8                  	add	ax, bx	; 1st quarter + middle
  4176 00001F04 66D1D8                  	rcr	ax, 1	; / 2
  4177 00001F07 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4178 00001F0A 66AB                    	stosw		; interpolated sample 2 (L)
  4179 00001F0C 66AB                    	stosw		; interpolated sample 2 (R)		
  4180 00001F0E 89D8                    	mov	eax, ebx
  4181 00001F10 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4182 00001F13 66D1D8                  	rcr	ax, 1
  4183 00001F16 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4184 00001F17 6601D8                  	add	ax, bx	; + interpolated middle
  4185 00001F1A 66D1D8                  	rcr	ax, 1
  4186 00001F1D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4187 00001F20 66AB                    	stosw		; interpolated sample 3 (L)
  4188 00001F22 66AB                    	stosw		; interpolated sample 3 (R)
  4189 00001F24 58                      	pop	eax ; *	
  4190 00001F25 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4191 00001F28 66D1D8                  	rcr	ax, 1	; / 2
  4192 00001F2B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4193 00001F2E 66AB                    	stosw		; interpolated sample 4 (L)
  4194 00001F30 66AB                    	stosw		; interpolated sample 4 (R)
  4195 00001F32 C3                      	retn
  4196                                  
  4197                                  interpolating_5_16bit_stereo:
  4198                                  	; 18/11/2023
  4199                                  	; bx = [previous_val_l]
  4200                                  	; ax = [previous_val_r]
  4201                                  	; [next_val_l]
  4202                                  	; [next_val_r]
  4203                                  	; original-interpltd-interpltd-interpltd-interpltd
  4204 00001F33 51                      	push	ecx ; !
  4205 00001F34 93                      	xchg	eax, ebx
  4206 00001F35 66AB                    	stosw		; original sample (L)
  4207 00001F37 93                      	xchg	eax, ebx
  4208 00001F38 66AB                    	stosw		; original sample (R)
  4209 00001F3A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4210 00001F3D 50                      	push	eax ; *	; [previous_val_r]
  4211 00001F3E 80C780                  	add	bh, 80h
  4212 00001F41 8005[BD200000]80        	add	byte [next_val_l+1], 80h
  4213 00001F48 66A1[BC200000]          	mov	ax, [next_val_l]
  4214 00001F4E 6601D8                  	add	ax, bx	; [previous_val_l]
  4215 00001F51 66D1D8                  	rcr	ax, 1
  4216 00001F54 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4217 00001F56 6601D8                  	add	ax, bx	
  4218 00001F59 66D1D8                  	rcr	ax, 1
  4219 00001F5C 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)	
  4220 00001F5E 6601D8                  	add	ax, bx	; [previous_val_l]
  4221 00001F61 66D1D8                  	rcr	ax, 1
  4222 00001F64 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4223 00001F67 66AB                    	stosw 		; interpolated sample 1 (L)
  4224 00001F69 89C8                    	mov	eax, ecx
  4225 00001F6B 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L) 
  4226 00001F6E 66D1D8                  	rcr	ax, 1	; / 2
  4227 00001F71 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4228 00001F73 5A                      	pop	edx ; *	; [previous_val_r]
  4229 00001F74 89D0                    	mov	eax, edx
  4230 00001F76 8005[BF200000]80        	add	byte [next_val_r+1], 80h
  4231 00001F7D 660305[BE200000]        	add	ax, [next_val_r]
  4232 00001F84 66D1D8                  	rcr	ax, 1
  4233 00001F87 50                      	push	eax ; *	; interpolated middle (R)
  4234 00001F88 6601D0                  	add	ax, dx
  4235 00001F8B 66D1D8                  	rcr	ax, 1
  4236 00001F8E 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4237 00001F8F 6601D0                  	add	ax, dx	; [previous_val_r]
  4238 00001F92 66D1D8                  	rcr	ax, 1
  4239 00001F95 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4240 00001F98 66AB                    	stosw 		; interpolated sample 1 (R)
  4241 00001F9A 89D8                    	mov	eax, ebx
  4242 00001F9C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4243 00001F9F 66AB                    	stosw 		; interpolated sample 2 (L)
  4244 00001FA1 58                      	pop	eax ; **
  4245 00001FA2 5A                      	pop	edx ; *
  4246 00001FA3 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4247 00001FA6 66D1D8                  	rcr	ax, 1	; / 2
  4248 00001FA9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4249 00001FAC 66AB                    	stosw 		; interpolated sample 2 (R)
  4250 00001FAE 89C8                    	mov	eax, ecx
  4251 00001FB0 660305[BC200000]        	add	ax, [next_val_l]
  4252 00001FB7 66D1D8                  	rcr	ax, 1
  4253 00001FBA 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4254 00001FBB 6601C8                  	add	ax, cx	; interpolated middle (L)
  4255 00001FBE 66D1D8                  	rcr	ax, 1
  4256 00001FC1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4257 00001FC4 66AB                    	stosw 		; interpolated sample 3 (L)
  4258 00001FC6 89D0                    	mov	eax, edx
  4259 00001FC8 660305[BE200000]        	add	ax, [next_val_r]
  4260 00001FCF 66D1D8                  	rcr	ax, 1
  4261 00001FD2 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4262 00001FD3 6601D0                  	add	ax, dx	; interpolated middle (R)
  4263 00001FD6 66D1D8                  	rcr	ax, 1
  4264 00001FD9 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4265 00001FDC 66AB                    	stosw 		; interpolated sample 3 (R)
  4266 00001FDE 5B                      	pop	ebx ; **
  4267 00001FDF 58                      	pop	eax ; *
  4268 00001FE0 660305[BC200000]        	add	ax, [next_val_l]
  4269 00001FE7 66D1D8                  	rcr	ax, 1
  4270 00001FEA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4271 00001FED 66AB                    	stosw 		; interpolated sample 4 (L)
  4272 00001FEF 89D8                    	mov	eax, ebx	
  4273 00001FF1 660305[BE200000]        	add	ax, [next_val_r]
  4274 00001FF8 66D1D8                  	rcr	ax, 1
  4275 00001FFB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4276 00001FFE 66AB                    	stosw 		; interpolated sample 4 (R)
  4277 00002000 59                      	pop	ecx ; !
  4278 00002001 C3                      	retn
  4279                                  
  4280                                  interpolating_4_16bit_mono:
  4281                                  	; 18/11/2023
  4282                                  	; ax = [previous_val]
  4283                                  	; dx = [next_val]
  4284                                  	; original-interpolated
  4285                                  
  4286 00002002 66AB                    	stosw		; original sample (L)
  4287 00002004 66AB                    	stosw		; original sample (R)
  4288 00002006 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4289 00002009 89C3                    	mov	ebx, eax ; [previous_val]
  4290 0000200B 80C680                  	add	dh, 80h
  4291 0000200E 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4292 00002011 66D1D8                  	rcr	ax, 1
  4293 00002014 93                      	xchg	eax, ebx	
  4294 00002015 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4295 00002018 66D1D8                  	rcr	ax, 1
  4296 0000201B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4297 0000201E 66AB                    	stosw 		; interpolated sample 1 (L)
  4298 00002020 66AB                    	stosw		; interpolated sample 1 (R)
  4299 00002022 89D8                    	mov	eax, ebx ; interpolated middle
  4300 00002024 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4301 00002027 66AB                    	stosw 		; interpolated sample 2 (L)
  4302 00002029 66AB                    	stosw		; interpolated sample 2 (R)
  4303 0000202B 89D8                    	mov	eax, ebx
  4304 0000202D 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4305 00002030 66D1D8                  	rcr	ax, 1
  4306 00002033 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4307 00002036 66AB                    	stosw		; interpolated sample 3 (L)
  4308 00002038 66AB                    	stosw		; interpolated sample 3 (R)
  4309 0000203A C3                      	retn
  4310                                  
  4311                                  interpolating_4_16bit_stereo:
  4312                                  	; 18/11/2023
  4313                                  	; bx = [previous_val_l]
  4314                                  	; ax = [previous_val_r]
  4315                                  	; [next_val_l]
  4316                                  	; [next_val_r]
  4317                                  	; original-interpolated-interpolated-interpolated
  4318 0000203B 93                      	xchg	eax, ebx
  4319 0000203C 66AB                    	stosw		; original sample (L)
  4320 0000203E 93                      	xchg	eax, ebx
  4321 0000203F 66AB                    	stosw		; original sample (R)
  4322 00002041 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4323 00002044 89C2                    	mov	edx, eax ; [previous_val_r]
  4324 00002046 80C780                  	add	bh, 80h
  4325 00002049 8005[BD200000]80        	add	byte [next_val_l+1], 80h
  4326 00002050 66A1[BC200000]          	mov	ax, [next_val_l]
  4327 00002056 6601D8                  	add	ax, bx	; [previous_val_l]
  4328 00002059 66D1D8                  	rcr	ax, 1
  4329 0000205C 93                      	xchg	eax, ebx	
  4330 0000205D 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4331 00002060 66D1D8                  	rcr	ax, 1
  4332 00002063 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4333 00002066 66AB                    	stosw 		; interpolated sample 1 (L)
  4334 00002068 8005[BF200000]80        	add	byte [next_val_r+1], 80h
  4335 0000206F 89D0                    	mov	eax, edx ; [previous_val_r]
  4336 00002071 660305[BE200000]        	add	ax, [next_val_r]
  4337 00002078 66D1D8                  	rcr	ax, 1
  4338 0000207B 92                      	xchg	eax, edx	
  4339 0000207C 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4340 0000207F 66D1D8                  	rcr	ax, 1
  4341 00002082 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4342 00002085 66AB                    	stosw 		; interpolated sample 1 (R)
  4343 00002087 89D8                    	mov	eax, ebx
  4344 00002089 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4345 0000208C 66AB                    	stosw 		; interpolated sample 2 (L)
  4346 0000208E 89D0                    	mov	eax, edx
  4347 00002090 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4348 00002093 66AB                    	stosw 		; interpolated sample 2 (R)
  4349 00002095 89D8                    	mov	eax, ebx
  4350 00002097 660305[BC200000]        	add	ax, [next_val_l]
  4351 0000209E 66D1D8                  	rcr	ax, 1
  4352 000020A1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4353 000020A4 66AB                    	stosw 		; interpolated sample 3 (L)
  4354 000020A6 89D0                    	mov	eax, edx
  4355 000020A8 660305[BE200000]        	add	ax, [next_val_r]
  4356 000020AF 66D1D8                  	rcr	ax, 1
  4357 000020B2 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4358 000020B5 66AB                    	stosw 		; interpolated sample 3 (R)
  4359 000020B7 C3                      	retn
  4360                                  
  4361                                  ; 13/11/2023
  4362                                  previous_val:
  4363 000020B8 0000                    previous_val_l: dw 0
  4364 000020BA 0000                    previous_val_r: dw 0
  4365                                  next_val:
  4366 000020BC 0000                    next_val_l: dw 0
  4367 000020BE 0000                    next_val_r: dw 0
  4368                                  
  4369                                  ; 16/11/2023
  4370 000020C0 00                      faz:	db 0	
  4371                                  	
  4372                                  ;=============================================================================
  4373                                  ;	gfx.asm - draw scopes in VGA 640x480x16 mode      
  4374                                  ;=============================================================================
  4375                                  
  4376                                  ; EX1A.ASM (21/6/1994, Carlos Hasan; MSDOS, 'RUNME.EXE', 'TNYPL211')
  4377                                  
  4378                                  ;-----------------------------------------------------------------------------
  4379                                  ; setgraphmode - setup the VGA 640x480x16 graphics mode
  4380                                  ;-----------------------------------------------------------------------------
  4381                                  	; 22/10/2017
  4382                                  setgraphmode:
  4383                                  	;pushad
  4384 000020C1 66B81200                	mov	ax,0012h
  4385                                  	;int	10h
  4386 000020C5 CD31                    	int 	31h
  4387 000020C7 66BAC003                	mov	dx,3C0h
  4388 000020CB 30C0                    	xor	al,al
  4389                                  setgraphmodel0:
  4390                                  	;out	dx,al
  4391 000020CD B401                    	mov	ah, 1 ; outb
  4392 000020CF CD34                    	int	34h
  4393                                  	;out	dx, al
  4394                                  	;mov	ah, 1
  4395 000020D1 CD34                    	int	34h
  4396 000020D3 FEC0                    	inc	al
  4397 000020D5 3C10                    	cmp	al, 10h
  4398 000020D7 72F4                    	jb	short setgraphmodel0
  4399 000020D9 B020                    	mov	al, 20h
  4400                                  	;out	dx, al
  4401                                  	;mov	ah, 1
  4402 000020DB CD34                    	int	34h
  4403                                  	;popad
  4404 000020DD C3                      	retn
  4405                                  
  4406                                  ;-----------------------------------------------------------------------------
  4407                                  ; settextmode - restore the VGA 80x25x16 text mode
  4408                                  ;-----------------------------------------------------------------------------
  4409                                  	; 22/10/2017
  4410                                  settextmode:
  4411                                  	;pushad
  4412 000020DE 66B80300                	mov	ax, 0003h
  4413                                  	;int	10h
  4414 000020E2 CD31                    	int	31h
  4415                                  	;popad
  4416 000020E4 C3                      	retn
  4417                                  
  4418                                  ;-----------------------------------------------------------------------------
  4419                                  ; drawscopes - draw the track voices sample scopes
  4420                                  ; In:
  4421                                  ;  ESI = (current) sample buffer
  4422                                  ;-----------------------------------------------------------------------------
  4423                                  	; 29/10/2017
  4424                                  	; 28/10/2017
  4425                                  	; (ESI = Current DMA buffer offset)
  4426                                  	; 27/10/2017
  4427                                  	; 26/10/2017
  4428                                  	; 23/10/2017
  4429                                  drawscopes:
  4430                                  	;pushad
  4431                                    	;mov	esi, g_buff
  4432                                  	;mov	esi, edx
  4433 000020E5 31C9                    	xor     ecx, ecx	
  4434 000020E7 31D2                    	xor     edx, edx
  4435 000020E9 31FF                    	xor	edi, edi
  4436                                  drawscope0:
  4437 000020EB 66AD                    	lodsw
  4438 000020ED 80F480                  	xor	ah, 80h
  4439 000020F0 0FB6DC                  	movzx	ebx, ah  ; Left Channel
  4440 000020F3 66D1E3                  	shl	bx, 1
  4441 000020F6 668B83[B0680000]        	mov	ax, [RowOfs+ebx]
  4442 000020FD 668987[B06A0000]        	mov	[NewScope_L+edi], ax
  4443 00002104 30FF                    	xor	bh, bh
  4444 00002106 66AD                    	lodsw
  4445 00002108 80F480                  	xor	ah, 80h
  4446 0000210B 88E3                    	mov	bl, ah	; Right Channel
  4447 0000210D 66D1E3                  	shl	bx, 1
  4448 00002110 668B83[B0680000]        	mov	ax, [RowOfs+ebx]
  4449 00002117 668987[B06C0000]        	mov	[NewScope_R+edi], ax
  4450 0000211E 6683C702                	add	di, 2
  4451 00002122 FEC1                    	inc	cl
  4452 00002124 75C5                    	jnz	short drawscope0	
  4453                                  
  4454 00002126 66BAC403                        mov	dx, 3C4h
  4455                                          ;mov	ax, 0802h
  4456                                          ;out	dx, ax
  4457 0000212A 66BB0208                        mov	bx, 0802h
  4458 0000212E B403                    	mov	ah, 3 ; outw
  4459 00002130 CD34                    	int	34h
  4460 00002132 66BACE03                	mov	dx, 3CEh
  4461 00002136 B008                            mov	al, 08h
  4462                                         ;out	dx, al
  4463 00002138 B401                            mov	ah, 1 ; outb
  4464 0000213A CD34                    	int	34h
  4465 0000213C 6642                    	inc	dx
  4466                                  
  4467                                  	; 26/10/2017
  4468 0000213E 31F6                            xor	esi, esi
  4469                                         ;xor	edi, edi
  4470 00002140 BB45060A00                      mov     ebx, 0A0645h
  4471                                  drawscopel4:
  4472 00002145 B080                            mov     al, 80h
  4473                                  drawscopel2:
  4474 00002147 50                              push    eax ; *
  4475 00002148 52                              push    edx ; **
  4476                                  	;out	dx, al
  4477 00002149 B401                    	mov	ah, 1 ; outb
  4478 0000214B CD34                    	int	34h
  4479                                  
  4480 0000214D B4FF                            mov	ah, 0FFh
  4481                                          ;mov	ecx, 32
  4482 0000214F B120                    	mov	cl, 32
  4483 00002151 28C0                    	sub     al, al
  4484                                  drawscopel3:
  4485                                  	; 23/10/2017
  4486 00002153 668B96[B06E0000]                mov	dx, [OldScope_L+esi]
  4487 0000215A 663B96[B06A0000]                cmp	dx, [NewScope_L+esi]
  4488 00002161 7414                            je	short drawscopef3
  4489 00002163 88041A                          mov	[edx+ebx], al ; L
  4490 00002166 668B96[B06A0000]                mov     dx, [NewScope_L+esi]
  4491 0000216D 88241A                  	mov	[edx+ebx], ah ; L
  4492 00002170 668996[B06E0000]                mov     [OldScope_L+esi], dx
  4493                                  drawscopef3:
  4494                                  	; 27/10/2017
  4495 00002177 668B96[B0700000]                mov	dx, [OldScope_R+esi]
  4496 0000217E 663B96[B06C0000]                cmp	dx, [NewScope_R+esi]
  4497 00002185 7416                            je	short drawscopef4
  4498 00002187 88441A26                	mov	[edx+ebx+38], al ; R
  4499 0000218B 668B96[B06C0000]                mov     dx, [NewScope_R+esi]
  4500 00002192 88641A26                        mov	[edx+ebx+38], ah ; R
  4501 00002196 668996[B0700000]                mov     [OldScope_R+esi], dx
  4502                                  drawscopef4:
  4503 0000219D 83C610                  	add	esi, 2*8
  4504 000021A0 43                      	inc	ebx
  4505 000021A1 E2B0                    	loop    drawscopel3
  4506                                  
  4507 000021A3 5A                              pop     edx ; **
  4508 000021A4 58                              pop     eax ; *
  4509 000021A5 81EEFE010000            	sub	esi, 2*256-2
  4510 000021AB 83EB20                  	sub	ebx, 32
  4511 000021AE D0E8                            shr     al, 1
  4512 000021B0 7595                            jnz	short drawscopel2
  4513                                  	;popad
  4514 000021B2 C3                              retn
  4515                                  
  4516                                  ;=============================================================================
  4517                                  ;	Load IFF/ILBM files for VGA 640x480x16 graphics mode       
  4518                                  ;=============================================================================
  4519                                  
  4520                                  ; EX1B.ASM (21/6/1994, Carlos Hasan; MSDOS, 'RUNME.EXE', 'TNYPL211')
  4521                                  
  4522                                  ; 21/10/2017 (TRDOS 386, 'tmodplay.s', Erdogan Tan, NASM syntax)
  4523                                  
  4524                                  ;-----------------------------------------------------------------------------
  4525                                  ; EQUATES AND STRUCTURES
  4526                                  ;-----------------------------------------------------------------------------
  4527                                  
  4528                                  ID_FORM equ 4D524F46h		; IFF/ILBM chunk IDs
  4529                                  ID_ILBM equ 4D424C49h
  4530                                  ID_BMHD equ 44484D42h
  4531                                  ID_CMAP equ 50414D43h
  4532                                  ID_BODY equ 59444F42h
  4533                                  
  4534                                  struc Form			; IFF/ILBM header file format
  4535 00000000 ????????                  .ID:		resd 1
  4536 00000004 ????????                  .Length:	resd 1
  4537 00000008 ????????                  .Type:	resd 1
  4538                                    .size:
  4539                                  endstruc
  4540                                  
  4541                                  struc Chunk			; IFF/ILBM header chunk format
  4542 00000000 ????????                  .ID:		resd 1
  4543 00000004 ????????                  .Length:	resd 1
  4544                                    .size:	
  4545                                  endstruc
  4546                                  
  4547                                  struc BMHD			; IFF/ILBM BMHD chunk format
  4548 00000000 ????                      .Width: 	resw 1
  4549 00000002 ????                      .Height:	resw 1
  4550 00000004 ????                      .PosX:	resw 1
  4551 00000006 ????                      .PosY:	resw 1
  4552 00000008 ??                        .Planes:	resb 1
  4553 00000009 ??                        .Masking:	resb 1
  4554 0000000A ??                        .Compression:	resb 1
  4555 0000000B ??                        .Pad:		resb 1
  4556 0000000C ????                      .Transparent:	resw 1
  4557 0000000E ??                        .AspectX	resb 1
  4558 0000000F ??                        .AspectY:	resb 1
  4559 00000010 ????                      .PageWidth:	resw 1
  4560 00000012 ????                      .PageHeight:	resw 1
  4561                                    .size:	
  4562                                  endstruc
  4563                                  
  4564                                  struc CMAP			; IFF/ILBM CMAP chunk format
  4565 00000000 <res 300h>                .Colors:	resb 768
  4566                                    .size:	
  4567                                  endstruc
  4568                                  
  4569                                  ;LOGO_ADDRESS	equ 100000h	; virtual address at the end of the 1st 1MB
  4570                                  
  4571                                  ;------------------------------------------------------------------------------
  4572                                  ; bswap - macro to reverse the byte order of a 32-bit register, converting
  4573                                  ;         a value in little/big endian form to big/little endian form.
  4574                                  ;------------------------------------------------------------------------------
  4575                                  %macro	bswap   1
  4576                                          xchg    al, ah
  4577                                          rol     eax, 16
  4578                                          xchg    al, ah
  4579                                  %endmacro
  4580                                  
  4581                                  ;------------------------------------------------------------------------------
  4582                                  ; putlbm - draw the IFF/ILBM picture on VGA 640x480x16 graphics mode
  4583                                  ; In:
  4584                                  ;  ESI = IFF/ILBM image file address
  4585                                  ;------------------------------------------------------------------------------
  4586                                  putlbm:
  4587 000021B3 60                              pushad
  4588                                  
  4589                                  ; check if this is a valid IFF/ILBM Deluxe Paint file
  4590                                  
  4591 000021B4 813E464F524D                    cmp     dword [esi+Form.ID], ID_FORM
  4592 000021BA 7551                            jne     short putlbmd0
  4593 000021BC 817E08494C424D                  cmp     dword [esi+Form.Type], ID_ILBM
  4594 000021C3 7548                            jne     short putlbmd0
  4595                                  
  4596                                  ; get the IFF/ILBM file length in bytes
  4597                                  
  4598 000021C5 8B4604                          mov     eax, [esi+Form.Length]
  4599                                          bswap   eax
  4576 000021C8 86E0                <1>  xchg al, ah
  4577 000021CA C1C010              <1>  rol eax, 16
  4578 000021CD 86E0                <1>  xchg al, ah
  4600 000021CF 89C1                            mov     ecx, eax
  4601                                  
  4602                                  ; decrease the file length and update the file pointer
  4603                                  
  4604 000021D1 83E904                          sub     ecx, 4
  4605 000021D4 83C60C                          add     esi, Form.size
  4606                                  
  4607                                  ; IFF/ILBM main parser body loop
  4608                                  
  4609                                  putlbml0:
  4610 000021D7 85C9                            test    ecx, ecx
  4611 000021D9 7E64                            jle     short putlbmd1
  4612                                  
  4613                                  ; get the next chunk ID and length in bytes
  4614                                  
  4615 000021DB 8B1E                            mov     ebx, [esi+Chunk.ID]
  4616 000021DD 8B4604                          mov     eax, [esi+Chunk.Length]
  4617                                          bswap   eax
  4576 000021E0 86E0                <1>  xchg al, ah
  4577 000021E2 C1C010              <1>  rol eax, 16
  4578 000021E5 86E0                <1>  xchg al, ah
  4618 000021E7 93                              xchg    ebx, eax
  4619 000021E8 83C608                          add     esi, Chunk.size
  4620                                  
  4621                                  ; word align the chunk length and decrease the file length counter
  4622                                  
  4623 000021EB 43                              inc     ebx
  4624 000021EC 80E3FE                          and     bl, 0FEh ; ~1
  4625 000021EF 83E908                          sub     ecx, Chunk.size
  4626 000021F2 29D9                            sub     ecx, ebx
  4627                                  
  4628                                  ; check for the BMHD/CMAP/BODY chunk headers
  4629                                  
  4630 000021F4 3D424D4844                      cmp     eax, ID_BMHD
  4631 000021F9 7415                            je      short putlbmf0
  4632 000021FB 3D434D4150                      cmp     eax, ID_CMAP
  4633 00002200 7440                            je      short putlbmf1
  4634 00002202 3D424F4459                      cmp     eax, ID_BODY
  4635 00002207 7455                            je      short putlbmf2
  4636                                  
  4637                                  ; advance to the next IFF/ILBM chunk structure
  4638                                  
  4639                                  putlbmc0:
  4640 00002209 01DE                            add     esi, ebx
  4641 0000220B EBCA                            jmp     short putlbml0
  4642                                  
  4643                                  putlbmd0:
  4644 0000220D F9                              stc
  4645 0000220E 61                              popad
  4646 0000220F C3                              retn
  4647                                  
  4648                                  ; process the BMHD bitmap header chunk
  4649                                  
  4650                                  putlbmf0:
  4651 00002210 807E0804                        cmp     byte [esi+BMHD.Planes], 4
  4652 00002214 75F7                            jne     short putlbmd0
  4653 00002216 807E0A01                        cmp     byte [esi+BMHD.Compression], 1
  4654 0000221A 75F1                            jne     short putlbmd0
  4655 0000221C 807E0B00                        cmp     byte [esi+BMHD.Pad], 0
  4656 00002220 75EB                            jne     short putlbmd0
  4657 00002222 0FB706                          movzx   eax, word [esi+BMHD.Width]
  4658 00002225 86E0                            xchg    al, ah
  4659 00002227 83C007                          add     eax, 7
  4660 0000222A C1E803                          shr     eax, 3
  4661 0000222D A3[1C680000]                    mov     [picture.width], eax
  4662 00002232 0FB74602                        movzx   eax, word [esi+BMHD.Height]
  4663 00002236 86E0                            xchg    al, ah
  4664 00002238 A3[20680000]                    mov     [picture.height], eax
  4665 0000223D EBCA                            jmp     short putlbmc0
  4666                                  
  4667                                  putlbmd1:
  4668 0000223F F8                              clc
  4669 00002240 61                              popad
  4670 00002241 C3                              retn
  4671                                  
  4672                                  ; process the CMAP colormap chunk
  4673                                  
  4674                                  putlbmf1:
  4675 00002242 66BAC803                        mov     dx, 3C8h
  4676 00002246 30C0                            xor     al, al
  4677                                          ;out	dx, al
  4678 00002248 B401                    	mov	ah, 1 ; outb
  4679 0000224A CD34                    	int	34h
  4680 0000224C 6642                            inc     dx
  4681                                  putlbml1:
  4682 0000224E 8A06                            mov     al, [esi]
  4683 00002250 C0E802                          shr     al, 2
  4684                                          ;out	dx, al
  4685                                  	;mov	ah, 1 ; outb
  4686 00002253 CD34                    	int	34h ; IOCTL interrupt (IN/OUT)
  4687 00002255 46                              inc     esi
  4688 00002256 4B                              dec     ebx
  4689 00002257 7FF5                            jg      short putlbml1
  4690 00002259 E979FFFFFF                      jmp     putlbml0
  4691                                  
  4692                                  ; process the BODY bitmap body chunk
  4693                                  
  4694                                  putlbmf2:
  4695 0000225E 60                              pushad
  4696 0000225F BF00000A00                      mov     edi, 0A0000h
  4697                                          ;cld
  4698 00002264 66BACE03                        mov     dx, 3CEh
  4699                                          ;mov	ax, 0FF08h
  4700                                          ;out	dx, ax
  4701 00002268 66BB08FF                	mov	bx, 0FF08h
  4702 0000226C B403                    	mov	ah, 3 ; outw
  4703 0000226E CD34                    	int	34h ; IOCTL interrupt (IN/OUT)
  4704 00002270 66BAC403                        mov     dx, 3C4h
  4705 00002274 B002                            mov     al, 02h
  4706                                          ;out	dx, al
  4707 00002276 B401                    	mov	ah, 1 ; outb
  4708 00002278 CD34                    	int	34h ; IOCTL interrupt (IN/OUT)
  4709 0000227A 6642                            inc     dx
  4710 0000227C 8B0D[20680000]                  mov     ecx, [picture.height]
  4711                                  putlbml2:
  4712 00002282 51                              push    ecx
  4713 00002283 B011                            mov     al, 11h
  4714                                  putlbml3:
  4715 00002285 50                              push    eax
  4716 00002286 57                              push    edi
  4717                                          ;out	dx, al
  4718 00002287 B401                    	mov	ah, 1 ; outb
  4719 00002289 CD34                    	int	34h ; IOCTL interrupt (IN/OUT)
  4720 0000228B 8B1D[1C680000]                  mov     ebx, [picture.width]
  4721                                  putlbml4:
  4722 00002291 AC                              lodsb
  4723 00002292 84C0                            test    al, al
  4724 00002294 7C0A                            jl      short putlbmf3
  4725 00002296 0FB6C8                          movzx   ecx, al
  4726 00002299 41                              inc     ecx
  4727 0000229A 29CB                            sub     ebx, ecx
  4728 0000229C F3A4                            rep     movsb
  4729 0000229E EB0B                            jmp     short putlbmc4
  4730                                  putlbmf3:
  4731 000022A0 F6D8                            neg     al
  4732 000022A2 0FB6C8                          movzx   ecx, al
  4733 000022A5 41                              inc     ecx
  4734 000022A6 29CB                            sub     ebx, ecx
  4735 000022A8 AC                              lodsb
  4736 000022A9 F3AA                            rep     stosb
  4737                                  putlbmc4:
  4738 000022AB 85DB                            test    ebx, ebx
  4739 000022AD 7FE2                            jg      short putlbml4
  4740 000022AF 5F                              pop     edi
  4741 000022B0 58                              pop     eax
  4742 000022B1 00C0                            add     al, al
  4743 000022B3 73D0                            jnc     short putlbml3
  4744 000022B5 83C750                          add     edi, 80
  4745 000022B8 59                              pop     ecx
  4746 000022B9 E2C7                            loop    putlbml2
  4747 000022BB 61                      	popad
  4748 000022BC E948FFFFFF                      jmp	putlbmc0
  4749                                  
  4750                                  ; EX1.C (Carlos Hasan, 21/06/1994)
  4751                                  ;------------------------------------------------------------------------------
  4752                                  ; loadlbm - load the IFF/ILBM image file ("LOGO.LBM") at memory
  4753                                  ;  ESI = IFF/ILBM image file address
  4754                                  ;------------------------------------------------------------------------------
  4755                                  
  4756                                  ;if ((Logo = loadlbm("LOGO.LBM")) == NULL) {
  4757                                  ;       printf("Error loading the IFF/ILBM logo picture\n");
  4758                                  ;       MODStopModule();
  4759                                  ;       MODFreeModule(Song);
  4760                                  ;       return;
  4761                                  ;   }
  4762                                  ;   setgraphmode();
  4763                                  ;   putlbm(Logo);
  4764                                  ;   while (!kbhit())
  4765                                  ;       drawscopes(Song->NumTracks);
  4766                                  ;   settextmode();
  4767                                  ;   free(Logo);
  4768                                  ;   MODStopModule();
  4769                                  ;   MODFreeModule(Song);
  4770                                  
  4771                                  ;loadlbm:
  4772                                  ;	; ebx = ASCIIZ file name address
  4773                                  ;	; ecx = open mode (0 = open for read)	
  4774                                  ;	sys	_open, LOGO_FILE_NAME, 0 ; open for reading
  4775                                  ;	jc	short loadlbm_retn
  4776                                  ;
  4777                                  ;	mov     [LBM_FileHandle], eax
  4778                                  ;
  4779                                  ;	; get file size by moving file pointer to the end of file
  4780                                  ;	; ebx = file handle/number
  4781                                  ;	; ecx : offset = 0
  4782                                  ;	; edx : switch = 2 (move fp to end of file + offset)
  4783                                  ;	sys	_seek, eax, 0, 2
  4784                                  ;	jc	short loadlbm_cf
  4785                                  ;
  4786                                  ;	mov	[LBM_FileSize], eax
  4787                                  ;
  4788                                  ;	; move file pointer to the beginning of the file
  4789                                  ;	; ecx = 0
  4790                                  ;	; edx = 0
  4791                                  ;	;xor	ecx, ecx
  4792                                  ; 	xor	dl, dl
  4793                                  ;	; ebx = [LBM_FileHandle]
  4794                                  ;	sys	_seek
  4795                                  ;	;jc	short loadlbm_cf
  4796                                  ;
  4797                                  ;	; ebx = File handle
  4798                                  ;	; ecx = Buffer address
  4799                                  ;	; edx = Byte count
  4800                                  ;	;sys	_read, [LBM_FileHandle], LOGO_ADDRESS, [LBM_FileSize]
  4801                                  ;	mov	ecx, LOGO_ADDRESS
  4802                                  ;	mov	edx, [LBM_FileSize]
  4803                                  ;	sys	_read
  4804                                  ;	jc	short loadlbm_cf
  4805                                  ;
  4806                                  ;	cmp	eax, edx  ; read count = file size ?
  4807                                  ;	;jb	short loadlbm_cf		 
  4808                                  ;loadlbm_cf:
  4809                                  ;	pushf
  4810                                  ;	sys	_close, [LBM_FileHandle]	
  4811                                  ;	popf
  4812                                  ;loadlbm_retn:
  4813                                  ;	retn	
  4814                                  ;
  4815                                  ;LOGO_FILE_NAME:
  4816                                  ;	db	"LOGO.LBM", 0
  4817                                  
  4818                                  LOGO_ERROR_MSG:
  4819 000022C1 4572726F72206C6F61-     	db	"Error loading the IFF/ILBM logo picture !", 0Dh, 0Ah, 0 
  4819 000022CA 64696E672074686520-
  4819 000022D3 4946462F494C424D20-
  4819 000022DC 6C6F676F2070696374-
  4819 000022E5 75726520210D0A00   
  4820                                  
  4821 000022ED 90                      align 2
  4822                                  ; 22/10/2017
  4823                                  LOGO_ADDRESS:
  4824                                  ;incbin "LOGO.LBM"	  	 
  4825                                  ; 27/10/2017
  4826 000022EE <bin 4298h>             incbin "TINYPLAY.LBM"
  4827                                  
  4828                                  ;=============================================================================
  4829                                  ;               preinitialized data
  4830                                  ;=============================================================================
  4831                                  	
  4832 00006586 00                      	db	0
  4833                                  	; 23/08/2020
  4834                                  FileHandle:	
  4835 00006587 FFFFFFFF                	dd	-1
  4836 0000658B 00                      	db	0
  4837                                  Credits:
  4838                                  msg_usage:
  4839                                  	; 09/12/2023
  4840 0000658C 54696E792057415620-     	db	'Tiny WAV Player for TRDOS 386 by Erdogan Tan',10,13
  4840 00006595 506C6179657220666F-
  4840 0000659E 72205452444F532033-
  4840 000065A7 383620627920457264-
  4840 000065B0 6F67616E2054616E0A-
  4840 000065B9 0D                 
  4841 000065BA 666F7220496E74656C-     	db 	'for Intel AC97 (ICH) Audio Controller.',10,13
  4841 000065C3 204143393720284943-
  4841 000065CC 482920417564696F20-
  4841 000065D5 436F6E74726F6C6C65-
  4841 000065DE 722E0A0D           
  4842                                  	;db	'December 2023.',10,13
  4843 000065E2 446563656D62657220-     	db	'December 2024.',10,13
  4843 000065EB 323032342E0A0D     
  4844                                  credits_zero:
  4845 000065F2 0A0D                    	db	10,13
  4846 000065F4 75736167653A207477-     	db	'usage: twavplay filename.wav',10,13,0
  4846 000065FD 6176706C6179206669-
  4846 00006606 6C656E616D652E7761-
  4846 0000660F 760A0D00           
  4847 00006613 32342F30382F323032-     	db	'24/08/2020',10,13,0
  4847 0000661C 300A0D00           
  4848 00006620 30392F31322F323032-     	db	'09/12/2023',10,13,0
  4848 00006629 330A0D00           
  4849                                  	;db	'08/12/2024',10,13,0
  4850 0000662D 31342F31322F323032-     	db	'14/12/2024',10,13,0
  4850 00006636 340A0D00           
  4851                                  
  4852                                  noDevMsg:
  4853                                  	; 09/12/2023
  4854 0000663A 4572726F723A20556E-     	db	'Error: Unable to find AC97 audio device!'
  4854 00006643 61626C6520746F2066-
  4854 0000664C 696E64204143393720-
  4854 00006655 617564696F20646576-
  4854 0000665E 69636521           
  4855 00006662 0A0D00                  	db	10,13,0
  4856                                  
  4857                                  noFileErrMsg:
  4858 00006665 4572726F723A206669-     	db	'Error: file not found.',10,13,0
  4858 0000666E 6C65206E6F7420666F-
  4858 00006677 756E642E0A0D00     
  4859                                  
  4860                                  trdos386_err_msg:
  4861 0000667E 5452444F5320333836-     	db	'TRDOS 386 System call error !',10,13,0
  4861 00006687 2053797374656D2063-
  4861 00006690 616C6C206572726F72-
  4861 00006699 20210A0D00         
  4862                                  
  4863                                  ; 09/12/2023
  4864                                  msg_no_vra:
  4865 0000669E 0A0D                    	db	10,13
  4866 000066A0 4E6F20565241207375-     	db	"No VRA support ! Only 48 kHZ sample rate supported !"
  4866 000066A9 70706F72742021204F-
  4866 000066B2 6E6C79203438206B48-
  4866 000066BB 5A2073616D706C6520-
  4866 000066C4 726174652073757070-
  4866 000066CD 6F727465642021     
  4867 000066D4 0A0D00                  	db	10,13,0
  4868                                  
  4869                                  ; 13/11/2016
  4870 000066D7 303132333435363738-     hex_chars:	db "0123456789ABCDEF", 0
  4870 000066E0 3941424344454600   
  4871                                  ;
  4872                                  msgAC97Info:	
  4873 000066E8 0D0A                    		db 0Dh, 0Ah
  4874 000066EA 414339372041756469-     		db "AC97 Audio Controller & Codec Info", 0Dh, 0Ah 
  4874 000066F3 6F20436F6E74726F6C-
  4874 000066FC 6C6572202620436F64-
  4874 00006705 656320496E666F0D0A 
  4875 0000670E 56656E646F72204944-     		db "Vendor ID: "
  4875 00006717 3A20               
  4876 00006719 303030306820446576-     msgVendorId:	db "0000h Device ID: "
  4876 00006722 6963652049443A20   
  4877 0000672A 30303030680D0A          msgDevId:	db "0000h", 0Dh, 0Ah
  4878 00006731 4275733A20              		db "Bus: "
  4879 00006736 303068204465766963-     msgBusNo	db "00h Device: "
  4879 0000673F 653A20             
  4880 00006742 3030682046756E6374-     msgDevNo	db "00h Function: "
  4880 0000674B 696F6E3A20         
  4881 00006750 303068                  msgFncNo	db "00h"
  4882 00006753 0D0A                    		db 0Dh, 0Ah
  4883                                  ; 09/12/2023
  4884 00006755 4E414D4241523A20        		db "NAMBAR: "
  4885 0000675D 30303030682020          msgNamBar	db "0000h  "
  4886 00006764 4E41424D4241523A20      		db "NABMBAR: "
  4887 0000676D 303030306820204952-     msgNabmBar	db "0000h  IRQ: "
  4887 00006776 513A20             
  4888 00006779 3030                    msgIRQ		dw 3030h
  4889 0000677B 0D0A00                  		db 0Dh, 0Ah, 0
  4890                                  
  4891 0000677E 0D0A5741562046696C-     msgWavFileName:	db 0Dh, 0Ah, "WAV File Name: ",0
  4891 00006787 65204E616D653A2000 
  4892 00006790 0D0A53616D706C6520-     msgSampleRate:	db 0Dh, 0Ah, "Sample Rate: "
  4892 00006799 526174653A20       
  4893 0000679F 303030303020487A2C-     msgHertz:	db "00000 Hz, ", 0 
  4893 000067A8 2000               
  4894 000067AA 3820626974732C2000      msg8Bits:	db "8 bits, ", 0 
  4895 000067B3 4D6F6E6F0D0A00          msgMono:	db "Mono", 0Dh, 0Ah, 0
  4896 000067BA 313620626974732C20-     msg16Bits:	db "16 bits, ", 0 
  4896 000067C3 00                 
  4897 000067C4 53746572656F            msgStereo:	db "Stereo"
  4898 000067CA 0D0A00                  nextline:	db 0Dh, 0Ah, 0
  4899                                  
  4900                                  ; 09/12/2023
  4901 000067CD 56524120737570706F-     msgVRAheader:	db "VRA support: "
  4901 000067D6 72743A20           
  4902 000067DA 00                      		db 0	
  4903 000067DB 5945530D0A00            msgVRAyes:	db "YES", 0Dh, 0Ah, 0
  4904 000067E1 4E4F200D0A              msgVRAno:	db "NO ", 0Dh, 0Ah
  4905 000067E6 28496E746572706F6C-     		db "(Interpolated sample rate playing method)"
  4905 000067EF 617465642073616D70-
  4905 000067F8 6C6520726174652070-
  4905 00006801 6C6179696E67206D65-
  4905 0000680A 74686F6429         
  4906 0000680F 0D0A00                  		db 0Dh, 0Ah, 0
  4907                                  
  4908                                  ;=============================================================================
  4909                                  ;		uninitialized data
  4910                                  ;=============================================================================
  4911                                  
  4912                                  ; 23/08/2020
  4913                                  
  4914                                  ; BSS
  4915                                  
  4916                                  bss_start:
  4917                                  
  4918                                  ABSOLUTE bss_start
  4919                                  
  4920 00006812 ????                    alignb 4
  4921                                  
  4922                                  ;------------------------------------------------------------------------------
  4923                                  ; IFF/ILBM DATA
  4924                                  ;------------------------------------------------------------------------------
  4925                                  
  4926 00006814 ????????                LBM_FileHandle:	resd 1
  4927 00006818 ????????                LBM_FileSize:	resd 1
  4928                                  ;
  4929 0000681C ????????                picture.width:	resd 1 		; current picture width and height
  4930 00006820 ????????                picture.height:	resd 1
  4931                                  
  4932                                  ;------------------------------------------------------------------------------
  4933                                  
  4934                                  ;alignb 4
  4935                                  
  4936 00006824 ??                      stmo:		resb 1 ; stereo or mono (1=stereo) 
  4937 00006825 ??                      bps:		resb 1 ; bits per sample (8,16)
  4938 00006826 ????                    sample_rate:	resw 1 ; Sample Frequency (Hz)
  4939                                  
  4940                                  ; 09/12/2023
  4941                                  ; 'playwav6.s' (27/11/2023)
  4942                                  ; .......
  4943                                  ; 25/11/2023
  4944 00006828 ????????                bufferSize:	resd 1
  4945                                  
  4946 0000682C <res 1Ch>               smpRBuff:	resw 14 
  4947                                  
  4948                                  wav_file_name:
  4949 00006848 <res 50h>               		resb 80 ; wave file, path name (<= 80 bytes)
  4950                                  ;alignb 4
  4951 00006898 ????                    		resw 1
  4952                                  
  4953 0000689A ??                      ac97_int_ln_reg: resb 1
  4954 0000689B ??                      fbs_shift:	resb 1 ; 26/11/2023
  4955                                  
  4956 0000689C ????????                dev_vendor:	resd 1
  4957 000068A0 ????????                bus_dev_fn:	resd 1
  4958 000068A4 ????                    ac97_NamBar:	resw 1
  4959 000068A6 ????                    ac97_NabmBar:	resw 1
  4960                                  
  4961 000068A8 ??                      flags:		resb 1
  4962                                  ;half_buff:	resb 1
  4963 000068A9 ??                      srb:		resb 1
  4964                                  ; 23/08/2020
  4965 000068AA ??                      counter:	resb 1
  4966                                  ; 18/08/2020
  4967 000068AB ??                      volume_level:	resb 1
  4968                                  ; 25/11/2023
  4969 000068AC ??                      VRA:		resb 1	; Variable Rate Audio Support Status
  4970                                  ; 09/12/2023
  4971 000068AD ??                      pan_shift:	resb 1
  4972                                  ; .......
  4973                                  
  4974 000068AE ????                    alignb 16
  4975                                  
  4976                                  ; PLAY.ASM
  4977                                  ;Scope:		resw 320
  4978 000068B0 <res 200h>              RowOfs:		resw 256
  4979                                  
  4980                                  ; 23/10/2017
  4981 00006AB0 <res 200h>              NewScope_L:	resw 256
  4982 00006CB0 <res 200h>              NewScope_R:	resw 256
  4983 00006EB0 <res 200h>              OldScope_L:	resw 256
  4984 000070B0 <res 200h>              OldScope_R:	resw 256
  4985                                  
  4986                                  ; 20/10/2017 (modplay7.s, SB16)
  4987                                  ; 19/10/2017 (modplay6.s, AC97)
  4988                                  ;pan_shift:	resb 1
  4989                                  ;volume_level:	resb 1
  4990                                  
  4991                                  ; 09/12/2023
  4992 000072B0 ????????                DMA_buffer_size: resd 1	
  4993                                  
  4994 000072B4 <res D4Ch>              alignb 4096
  4995                                  
  4996                                  ;audio_buffer:	resb BUFFERSIZE ; DMA Buffer Size / 2  (32768)
  4997                                  ; 09/12/2023
  4998 00008000 <res 10000h>            audio_buffer:	resb 65536
  4999                                  
  5000 00018000 <res 8000h>             alignb 65536
  5001                                  
  5002                                  ;DMA_Buffer:	resb 2*BUFFERSIZE  ; 65536 ; 09/10/2017
  5003                                  ; 09/12/2023
  5004 00020000 <res 20000h>            DMA_Buffer:	resb 2*65536
  5005                                   
  5006                                  ; 13/06/2017
  5007                                  ;temp_buffer:	resb BUFFERSIZE
  5008                                  ; 26/11/2023
  5009 00040000 <res 10000h>            temp_buffer:	resb 65536
  5010                                  
  5011                                  EOF:
