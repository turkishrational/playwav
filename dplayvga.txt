     1                                  ; ****************************************************************************
     2                                  ; dplayvga.s - TRDOS 386 (TRDOS v2.0.3) Test Program - 'sysvideo' pixel tests
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; DPLAYVGA.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 21/12/2024
     7                                  ;
     8                                  ; [ Last Modification: 22/12/2024 ]
     9                                  ;
    10                                  ; Modified from PLAYWAV9.PRG .wav player program by Erdogan Tan, 18/12/2024
    11                                  ;
    12                                  ; ****************************************************************************
    13                                  ; nasm dplayvga.s -l dplayvga.txt -o DPLAYVGA.PRG -Z error.txt
    14                                  ; (modified from 'circle10.s', 18/02/2021)
    15                                  
    16                                  ; Draw graphics by using 'sysvideo' bx=0305h
    17                                  ; and display text by using bx=010Fh
    18                                  
    19                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    20                                  ; ------------------------------------------------------------
    21                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    22                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    23                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    24                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    25                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    26                                  
    27                                  ; ------------------------------------------------------------
    28                                  
    29                                  ; 30/11/2024
    30                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    31                                  ; 29/04/2016
    32                                  _ver 	equ 0
    33                                  _exit 	equ 1
    34                                  _fork 	equ 2
    35                                  _read 	equ 3
    36                                  _write	equ 4
    37                                  _open	equ 5
    38                                  _close 	equ 6
    39                                  _wait 	equ 7
    40                                  _creat 	equ 8
    41                                  _link 	equ 9
    42                                  _unlink	equ 10
    43                                  _exec	equ 11
    44                                  _chdir	equ 12
    45                                  _time 	equ 13
    46                                  _mkdir 	equ 14
    47                                  _chmod	equ 15
    48                                  _chown	equ 16
    49                                  _break	equ 17
    50                                  _stat	equ 18
    51                                  _seek	equ 19
    52                                  _tell 	equ 20
    53                                  _mount	equ 21
    54                                  _umount	equ 22
    55                                  _setuid	equ 23
    56                                  _getuid	equ 24
    57                                  _stime	equ 25
    58                                  _quit	equ 26
    59                                  _intr	equ 27
    60                                  _fstat	equ 28
    61                                  _emt 	equ 29
    62                                  _mdate 	equ 30
    63                                  _video 	equ 31
    64                                  _audio	equ 32
    65                                  _timer	equ 33
    66                                  _sleep	equ 34
    67                                  _msg    equ 35
    68                                  _geterr	equ 36
    69                                  _fpsave	equ 37
    70                                  _pri	equ 38
    71                                  _rele	equ 39
    72                                  _fff	equ 40
    73                                  _fnf	equ 41
    74                                  _alloc	equ 42
    75                                  _dalloc equ 43
    76                                  _calbac equ 44
    77                                  _dma	equ 45
    78                                  _stdio  equ 46
    79                                  
    80                                  ; ------------------------------------------------------------
    81                                  
    82                                  %macro sys 1-4
    83                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    84                                      ; 03/09/2015
    85                                      ; 13/04/2015
    86                                      ; Retro UNIX 386 v1 system call.
    87                                      %if %0 >= 2
    88                                          mov ebx, %2
    89                                          %if %0 >= 3
    90                                              mov ecx, %3
    91                                              %if %0 = 4
    92                                                 mov edx, %4
    93                                              %endif
    94                                          %endif
    95                                      %endif
    96                                      mov eax, %1
    97                                      ;int 30h
    98                                      int 40h ; TRDOS 386 (TRDOS v2.0)
    99                                  %endmacro
   100                                  
   101                                  ; Retro UNIX 386 v1 system call format:
   102                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   103                                  
   104                                  ; ------------------------------------------------------------
   105                                  
   106                                  ; player internal variables and other equates.
   107                                  BUFFERSIZE	equ 65536
   108                                  ENDOFFILE	equ 1		; flag for knowing end of file
   109                                  
   110                                  ; ------------------------------------------------------------
   111                                  
   112                                  [BITS 32] ; 32-bit intructions
   113                                  
   114                                  [ORG 0]
   115                                  
   116                                  START_CODE:
   117                                  	; clear bss
   118 00000000 BF[DC720000]            	mov	edi, bss_start
   119 00000005 B931000000              	mov	ecx, (bss_end - bss_start)/4
   120                                  	;xor	eax, eax
   121 0000000A F3AB                    	rep	stosd
   122                                  
   123                                  	; 21/12/2024
   124                                  	; program message
   125 0000000C BE[E13E0000]            	mov	esi, program_msg
   126 00000011 E81F050000              	call	print_msg
   127                                  
   128 00000016 30E4                    	xor	ah, ah
   129                                  	;int	16h	; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
   130                                  			; Return: AH = scan code, AL = character
   131 00000018 CD32                    	int	32h	; TRDOS 386 Keyboard interrupt
   132                                  
   133                                  	; set video mode to 03h (clear screen)
   134 0000001A 66B80300                	mov	ax, 03h
   135 0000001E CD31                    	int	31h
   136                                  
   137                                  	; Prints the Credits Text.
   138                                  	sys	_msg, Credits, 255, 0Bh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000020 BB[9C270000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000025 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000002A BA0B000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000002F B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000034 CD40                <1>  int 40h
   139                                  
   140                                  ; -------------------------------------------------------------
   141                                  
   142                                  	; 21/12/2024
   143                                  	; Detect (& Enable) AC'97 Audio Device
   144 00000036 E8FA060000              	call	DetectAC97
   145 0000003B 731B                    	jnc	short ac97_hardware_ready
   146                                  
   147                                  	; 30/11/2024
   148                                  	; 30/05/2024
   149                                  _dev_not_ready:
   150                                  	; couldn't find the audio device!
   151                                  	sys	_msg, noDevMsg, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000003D BB[2F280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000042 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000047 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000004C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000051 CD40                <1>  int 40h
   152 00000053 E97A040000                      jmp     Exit
   153                                  
   154                                  ac97_hardware_ready:
   155 00000058 E877080000              	call	write_audio_dev_info
   156                                  
   157                                  ; -------------------------------------------------------------
   158                                  
   159                                  	; 21/12/2024
   160                                  	;;;
   161                                  	; Read (copy) 8x14 system fonts
   162 0000005D BE[8C3F0000]            	mov	esi, fontbuff1
   163                                  	sys	_video, 0C03h, 256, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000062 BB030C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000067 B900010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000006C BA00000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000071 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000076 CD40                <1>  int 40h
   164                                  
   165                                  	; convert 8x14 fonts to 8x16 fonts
   166                                  	; by inserting 2 empty rows to each characters
   167                                  	;mov	esi, fontbuff1
   168 00000078 BF[8C4D0000]            	mov	edi, fontbuff2
   169                                  	; 18/02/2021
   170                                  	;mov	cx, 256
   171                                  fontconvert:
   172 0000007D 51                      	push	ecx
   173 0000007E 66B90E00                	mov	cx, 14
   174 00000082 F3A4                    	rep	movsb
   175 00000084 28C0                    	sub	al, al
   176 00000086 AA                      	stosb
   177 00000087 AA                      	stosb
   178 00000088 59                      	pop	ecx
   179 00000089 E2F2                    	loop	fontconvert
   180                                  	;;;
   181                                  
   182                                  ; ------------------------------------------------------------- 
   183                                  
   184                                  	; 21/12/2024
   185                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   186                                  	sys	_video, 08FFh, 101h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000008B BBFF080000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000090 B901010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000095 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000009A CD40                <1>  int 40h
   187 0000009C 09C0                    	or	eax, eax
   188 0000009E 0F8429040000            	jz	terminate    ; nothing to do				
   189                                  	;jz	trdos386_err ; write (OS) error msg and exit
   190                                  
   191                                  set_vesa_mode_101h_ok:
   192                                  	; linear frame buffer access
   193                                  	sys	_video, 06FFh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000000A4 BBFF060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000000A9 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000000AE CD40                <1>  int 40h
   194 000000B0 21C0                    	and	eax, eax
   195 000000B2 0F8460040000            	jz	error_exit ; set text mode and write err msg
   196 000000B8 A3[CC720000]            	mov	[LFB_ADDR], eax
   197                                  
   198                                  ; -------------------------------------------------------------
   199                                  
   200                                  	; 07/12/2024
   201                                  GetFileName_@:
   202                                  	; 30/11/2024
   203                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   204                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   205                                  	;			.. argv0text, argv1text ..) 
   206                                  	; ---- argc, argv[] ----
   207 000000BD 89E6                    	mov	esi, esp
   208 000000BF AD                      	lodsd
   209 000000C0 83F802                  	cmp	eax, 2 ; two arguments 
   210                                  		; (program file name & mod file name)
   211 000000C3 0F8212040000            	jb	pmsg_usage ; nothing to do
   212                                  	; 07/12/2024
   213 000000C9 AD                      	lodsd	; skip program (PRG) file name
   214                                  
   215                                  	; 30/11/2024 (32bit)
   216                                  	; 29/11/2024
   217                                  	; 30/05/2024
   218                                  GetFileName:
   219 000000CA BF[20730000]            	mov	edi, wav_file_name 
   220                                  	; 07/12/2024
   221 000000CF 8B36                    	mov	esi, [esi]
   222 000000D1 31C9                    	xor	ecx, ecx ; 0
   223                                  ScanName:
   224 000000D3 AC                      	lodsb
   225                                  	;test	al, al
   226                                  	;jz	short a_4
   227                                  	; 29/11/2024
   228 000000D4 3C0D                    	cmp	al, 0Dh
   229 000000D6 7638                    	jna	short a_4
   230 000000D8 3C20                    	cmp	al, 20h
   231 000000DA 74F7                    	je	short ScanName	; scan start of name.
   232 000000DC AA                      	stosb
   233 000000DD B4FF                    	mov	ah, 0FFh
   234                                  	;;;
   235                                  	; 14/11/2024
   236                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   237                                  	;xor	ecx, ecx ; 0
   238                                  	;;;
   239                                  a_0:	
   240 000000DF FEC4                    	inc	ah
   241                                  a_1:
   242                                  	;;;
   243                                  	; 14/11/2024
   244 000000E1 41                      	inc	ecx
   245                                  	;;;
   246 000000E2 AC                      	lodsb
   247 000000E3 AA                      	stosb
   248 000000E4 3C2E                    	cmp	al, '.'
   249 000000E6 74F7                    	je	short a_0
   250                                  	; 29/11/2024
   251 000000E8 3C20                    	cmp	al, 20h
   252                                  	;and	al, al
   253                                  	;jnz	short a_1
   254                                  	;;;
   255                                  	; 14/11/2024
   256 000000EA 7613                    	jna	short a_3
   257 000000EC 20E4                    	and	ah, ah
   258 000000EE 7406                    	jz	short a_2
   259 000000F0 3C2F                    	cmp	al, '/'	; 14/12/2024
   260 000000F2 7502                    	jne	short a_2
   261 000000F4 B400                    	mov	ah, 0
   262                                  a_2:
   263 000000F6 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   264 000000F9 72E6                    	jb	short a_1
   265                                  	; 29/11/2024
   266 000000FB 29C9                    	sub	ecx, ecx
   267 000000FD EB11                    	jmp	short a_4
   268                                  a_3:
   269                                  	; 29/11/2024
   270 000000FF 4F                      	dec	edi
   271                                  	;;;
   272 00000100 08E4                    	or	ah, ah		; if period NOT found,
   273 00000102 750C                    	jnz	short a_4 	; then add a .WAV extension.
   274                                  SetExt:
   275                                  	; 29/11/2024
   276                                  	;dec	edi
   277 00000104 C7072E574156            	mov	dword [edi], '.WAV'
   278                                  				; ! 64+12 is DOS limit
   279                                  				; but writing +4 must not
   280                                  				; destroy the following data	 
   281                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   282                                  	; 29/11/2024
   283 0000010A 83C104                  	add	ecx, 4
   284 0000010D 83C704                  	add	edi, 4
   285                                  a_4:	
   286 00000110 C60700                  	mov	byte [edi], 0
   287                                  
   288                                          ; open existing file
   289                                  	; 28/11/2024
   290                                  	;mov	edx, wav_file_name
   291 00000113 E86F060000                      call    openFile ; no error? ok.
   292 00000118 7325                            jnc     short getwavparms
   293                                  
   294                                  	; 21/12/2024
   295 0000011A E897040000              	call	set_text_mode
   296                                  	; file not found!
   297                                  	; 30/11/2024
   298                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000011F BB[5A280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000124 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000129 BA0C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000012E B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000133 CD40                <1>  int 40h
   299 00000135 E998030000                      jmp     Exit
   300                                  
   301                                  _exit_:
   302 0000013A E98E030000              	jmp	terminate
   303                                  
   304                                  ; -------------------------------------------------------------
   305                                  
   306                                  getwavparms:
   307                                  	; 14/11/2024
   308 0000013F E878060000                     	call    getWAVParameters
   309 00000144 72F4                    	jc	short _exit_		; nothing to do
   310                                  
   311                                  	; 17/11/2024
   312 00000146 B304                    	mov	bl, 4
   313 00000148 2A1D[0C730000]          	sub	bl, byte [WAVE_BlockAlign]
   314                                  			; = 0 for 16 bit stereo
   315                                  			; = 2 for 8 bit stereo or 16 bit mono
   316                                  			; = 3 for 8 bit mono	
   317                                  
   318 0000014E D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   319                                  	; 15/11/2024
   320 00000150 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   321 00000153 881D[72730000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   322                                  					; = 0 stereo and 16 bit
   323                                  					; = 1 mono or 8 bit
   324                                  
   325                                  ; -------------------------------------------------------------
   326                                  
   327                                  	; 21/12/2024
   328 00000159 C605[D8720000]0F        	mov	byte [tcolor], 15
   329                                  
   330                                  Player_SplashScreen:
   331                                  _0:
   332 00000160 E8F1030000              	call	drawsplashscreen
   333                                  
   334                                  	; 21/12/2024
   335                                  	;;;
   336                                  	; set wave volume led addresses
   337 00000165 8B1D[CC720000]          	mov	ebx, [LFB_ADDR]
   338 0000016B 81C300C70100            	add	ebx, (13*80*8*14)
   339 00000171 BD50000000              	mov	ebp, 80
   340 00000176 BF[8C5D0000]            	mov	edi, wleds_addr
   341                                  wleds_sa_1:
   342 0000017B B90F000000              	mov	ecx, 15
   343                                  wleds_sa_2:
   344 00000180 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   345 00000185 F7E1                    	mul	ecx
   346 00000187 01D8                    	add	eax, ebx
   347 00000189 AB                      	stosd
   348 0000018A E2F4                    	loop	wleds_sa_2
   349 0000018C 89D8                    	mov	eax, ebx
   350 0000018E AB                      	stosd
   351 0000018F 83C308                  	add	ebx, 8
   352 00000192 4D                      	dec	ebp
   353 00000193 75E6                    	jnz	short wleds_sa_1
   354                                  	;;;
   355                                  
   356                                  	; 07/12/2024
   357                                  	;;; wait for 2 seconds
   358                                  	sys	_time, 0 ; get time in unix epoch format
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000195 BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000019A B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 0000019F CD40                <1>  int 40h
   359 000001A1 89C1                    	mov	ecx, eax
   360 000001A3 83C102                  	add	ecx, 2
   361                                  _wait_2s:
   362 000001A6 90                      	nop
   363                                  	sys	_time, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000001A7 BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000001AC B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 000001B1 CD40                <1>  int 40h
   364 000001B3 39C8                    	cmp	eax, ecx
   365 000001B5 72EF                    	jb	short _wait_2s
   366                                  	;;;
   367                                  
   368                                  ; -------------------------------------------------------------
   369                                  
   370                                  	; 07/12/2024 (playwav9.s)
   371                                  
   372                                  	; 18/11/2023 (ich_wav4.asm)
   373                                  	; 13/11/2023 (ich_wav3.asm)
   374                                  
   375 000001B7 803D[EA720000]01        	cmp	byte [VRA], 1
   376 000001BE 7226                    	jb	short chk_sample_rate
   377                                  
   378                                  playwav_48_khz:
   379 000001C0 C705[80730000]-         	mov	dword [loadfromwavfile], loadFromFile
   379 000001C6 [06080000]         
   380                                  	;mov	dword [loadsize], 0 ; 65536
   381                                  	;;;
   382                                  	; 17/11/2024
   383                                  	;mov	word [buffersize], 32768
   384                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   385                                  	; 30/11/2024
   386                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   387                                  	; 07/12/2024
   388 000001CA B800000100              	mov	eax, BUFFERSIZE ; 65536
   389 000001CF A3[88730000]            	mov	[buffersize], eax	; 16 bit samples
   390                                  	; 07/12/2024
   391                                  	;shl	eax, 1			; bytes
   392 000001D4 8A0D[72730000]          	mov	cl, [fbs_shift]
   393 000001DA D3E8                    	shr	eax, cl 
   394                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   395 000001DC A3[84730000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   396                                  	;;;
   397                                  	;jmp	PlayNow ; 30/05/2024
   398                                  	; 07/12/2024
   399 000001E1 E95D020000              	jmp	Player_Template
   400                                  
   401                                  chk_sample_rate:
   402                                  	; set conversion parameters
   403                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   404 000001E6 66A1[04730000]          	mov	ax, [WAVE_SampleRate]
   405 000001EC 663D80BB                	cmp	ax, 48000
   406 000001F0 74CE                    	je	short playwav_48_khz
   407                                  chk_22khz:
   408 000001F2 663D2256                	cmp	ax, 22050
   409 000001F6 7545                    	jne	short chk_11khz
   410 000001F8 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   411 000001FF 7615                    	jna	short chk_22khz_1
   412 00000201 BB[70170000]            	mov	ebx, load_22khz_stereo_16_bit
   413 00000206 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   414 0000020D 751A                    	jne	short chk_22khz_2
   415 0000020F BB[E3160000]            	mov	ebx, load_22khz_mono_16_bit
   416 00000214 EB13                    	jmp	short chk_22khz_2
   417                                  chk_22khz_1:
   418 00000216 BB[5C160000]            	mov	ebx, load_22khz_stereo_8_bit
   419 0000021B 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   420 00000222 7505                    	jne	short chk_22khz_2
   421 00000224 BB[D3150000]            	mov	ebx, load_22khz_mono_8_bit
   422                                  chk_22khz_2:
   423 00000229 B85A1D0000              	mov	eax, 7514  ; (442*17)
   424 0000022E BA25000000              	mov	edx, 37
   425 00000233 B911000000              	mov	ecx, 17
   426 00000238 E9D9010000              	jmp	set_sizes
   427                                  chk_11khz:
   428 0000023D 663D112B                	cmp	ax, 11025
   429 00000241 7545                    	jne	short chk_44khz
   430 00000243 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   431 0000024A 7615                    	jna	short chk_11khz_1
   432 0000024C BB[8C190000]            	mov	ebx, load_11khz_stereo_16_bit
   433 00000251 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   434 00000258 751A                    	jne	short chk_11khz_2
   435 0000025A BB[13190000]            	mov	ebx, load_11khz_mono_16_bit
   436 0000025F EB13                    	jmp	short chk_11khz_2
   437                                  chk_11khz_1:
   438 00000261 BB[99180000]            	mov	ebx, load_11khz_stereo_8_bit
   439 00000266 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1 
   440 0000026D 7505                    	jne	short chk_11khz_2
   441 0000026F BB[21180000]            	mov	ebx, load_11khz_mono_8_bit
   442                                  chk_11khz_2:
   443 00000274 B8AD0E0000              	mov	eax, 3757  ; (221*17)
   444 00000279 BA4A000000              	mov	edx, 74
   445 0000027E B911000000              	mov	ecx, 17
   446 00000283 E98E010000              	jmp	set_sizes
   447                                  chk_44khz:
   448 00000288 663D44AC                	cmp	ax, 44100
   449 0000028C 7545                    	jne	short chk_16khz
   450 0000028E 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   451 00000295 7615                    	jna	short chk_44khz_1
   452 00000297 BB[B31B0000]            	mov	ebx, load_44khz_stereo_16_bit
   453 0000029C 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   454 000002A3 751A                    	jne	short chk_44khz_2
   455 000002A5 BB[3A1B0000]            	mov	ebx, load_44khz_mono_16_bit
   456 000002AA EB13                    	jmp	short chk_44khz_2
   457                                  chk_44khz_1:
   458 000002AC BB[BD1A0000]            	mov	ebx, load_44khz_stereo_8_bit
   459 000002B1 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   460 000002B8 7505                    	jne	short chk_44khz_2
   461 000002BA BB[411A0000]            	mov	ebx, load_44khz_mono_8_bit
   462                                  chk_44khz_2:
   463                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   464 000002BF B8D93A0000              	mov	eax, 15065 ; (655*23)
   465                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   466                                  	;mov	ax, 14076 ; (612*23)
   467                                  	; 17/11/2024
   468                                  	;mov	ax, 12650 ; (550*23)
   469 000002C4 BA19000000              	mov	edx, 25
   470 000002C9 B917000000              	mov	ecx, 23
   471 000002CE E943010000              	jmp	set_sizes
   472                                  chk_16khz:
   473 000002D3 663D803E                	cmp	ax, 16000
   474 000002D7 7545                    	jne	short chk_8khz
   475 000002D9 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   476 000002E0 7615                    	jna	short chk_16khz_1
   477 000002E2 BB[18110000]            	mov	ebx, load_16khz_stereo_16_bit
   478 000002E7 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1 
   479 000002EE 751A                    	jne	short chk_16khz_2
   480 000002F0 BB[97100000]            	mov	ebx, load_16khz_mono_16_bit
   481 000002F5 EB13                    	jmp	short chk_16khz_2
   482                                  chk_16khz_1:
   483 000002F7 BB[DD0F0000]            	mov	ebx, load_16khz_stereo_8_bit
   484 000002FC 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   485 00000303 7505                    	jne	short chk_16khz_2
   486 00000305 BB[5E0F0000]            	mov	ebx, load_16khz_mono_8_bit
   487                                  chk_16khz_2:
   488                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   489 0000030A B855150000              	mov	eax, 5461
   490                                  	; 17/11/2024
   491                                  	;mov	ax, 5460
   492 0000030F BA03000000              	mov	edx, 3
   493 00000314 B901000000              	mov	ecx, 1
   494 00000319 E9F8000000              	jmp	set_sizes
   495                                  chk_8khz:
   496 0000031E 663D401F                	cmp	ax, 8000
   497 00000322 7545                    	jne	short chk_24khz
   498 00000324 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   499 0000032B 7615                    	jna	short chk_8khz_1
   500 0000032D BB[130E0000]            	mov	ebx, load_8khz_stereo_16_bit
   501 00000332 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   502 00000339 751A                    	jne	short chk_8khz_2
   503 0000033B BB[430D0000]            	mov	ebx, load_8khz_mono_16_bit
   504 00000340 EB13                    	jmp	short chk_8khz_2
   505                                  chk_8khz_1:
   506 00000342 BB[130C0000]            	mov	ebx, load_8khz_stereo_8_bit
   507 00000347 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1 
   508 0000034E 7505                    	jne	short chk_8khz_2
   509 00000350 BB[2F0B0000]            	mov	ebx, load_8khz_mono_8_bit
   510                                  chk_8khz_2:
   511 00000355 B8AA0A0000              	mov	eax, 2730
   512 0000035A BA06000000              	mov	edx, 6
   513 0000035F B901000000              	mov	ecx, 1
   514 00000364 E9AD000000              	jmp	set_sizes
   515                                  chk_24khz:
   516 00000369 663DC05D                	cmp	ax, 24000
   517 0000036D 7561                    	jne	short chk_32khz
   518 0000036F 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   519 00000376 7613                    	jna	short chk_24khz_1
   520 00000378 66BB[4213]              	mov	bx, load_24khz_stereo_16_bit
   521 0000037C 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1 
   522 00000383 7519                    	jne	short chk_24khz_2
   523 00000385 66BB[DF12]              	mov	bx, load_24khz_mono_16_bit
   524 00000389 EB13                    	jmp	short chk_24khz_2
   525                                  chk_24khz_1:
   526 0000038B BB[55120000]            	mov	ebx, load_24khz_stereo_8_bit
   527 00000390 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1 
   528 00000397 7505                    	jne	short chk_24khz_2
   529 00000399 BB[EE110000]            	mov	ebx, load_24khz_mono_8_bit
   530                                  chk_24khz_2:
   531                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   532 0000039E B800200000              	mov	eax, 8192
   533                                  	; 17/11/2024
   534                                  	;mov	ax, 8190
   535 000003A3 BA02000000              	mov	edx, 2
   536 000003A8 B901000000              	mov	ecx, 1
   537 000003AD EB67                    	jmp	short set_sizes
   538                                  
   539                                  	; 07/12/2024
   540                                  vra_needed:
   541                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   542                                  	; 13/11/2023
   543 000003AF 58                      	pop	eax ; discard return address to the caller
   544                                  	; 30/05/2024
   545                                  vra_err:
   546                                  	; 21/12/2024
   547 000003B0 E801020000              	call	set_text_mode
   548                                  	; 30/11/2024
   549                                  	sys	_msg, msg_no_vra, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000003B5 BB[C4280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000003BA B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000003BF BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000003C4 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000003C9 CD40                <1>  int 40h
   550 000003CB E902010000              	jmp	Exit
   551                                  
   552                                  chk_32khz:
   553 000003D0 663D007D                	cmp	ax, 32000
   554 000003D4 75D9                    	jne	short vra_needed
   555 000003D6 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8
   556 000003DD 7615                    	jna	short chk_32khz_1
   557 000003DF BB[43150000]            	mov	ebx, load_32khz_stereo_16_bit
   558 000003E4 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   559 000003EB 751A                    	jne	short chk_32khz_2
   560 000003ED BB[D9140000]            	mov	ebx, load_32khz_mono_16_bit
   561 000003F2 EB13                    	jmp	short chk_32khz_2
   562                                  chk_32khz_1:
   563 000003F4 BB[3C140000]            	mov	ebx, load_32khz_stereo_8_bit
   564 000003F9 803D[02730000]01        	cmp	byte [WAVE_NumChannels], 1
   565 00000400 7505                    	jne	short chk_32khz_2
   566 00000402 BB[C9130000]            	mov	ebx, load_32khz_mono_8_bit
   567                                  chk_32khz_2:
   568                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   569 00000407 B8AA2A0000              	mov	eax, 10922
   570                                  	; 17/11/2024
   571                                  	;mov	ax, 10920
   572 0000040C BA03000000              	mov	edx, 3
   573 00000411 B902000000              	mov	ecx, 2
   574                                  	;jmp	short set_sizes
   575                                  set_sizes:
   576                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   577                                  	;;;
   578                                  	; 17/11/2024
   579 00000416 51                      	push	ecx
   580 00000417 B102                    	mov	cl, 2
   581 00000419 2A0D[72730000]          	sub	cl, [fbs_shift]
   582                                  		; = 2 for 16 bit stereo
   583                                  		; = 1 for 16 bit mono or 8 bit stereo
   584                                  		; = 0 for 8 bit mono
   585 0000041F D3E0                    	shl	eax, cl
   586 00000421 59                      	pop	ecx	
   587 00000422 A3[84730000]            	mov	[loadsize], eax	; (one) read count in bytes
   588                                  	;;;
   589 00000427 F7E2                    	mul	edx
   590 00000429 83F901                  	cmp	ecx, 1
   591 0000042C 7402                    	je	short s_2
   592                                  s_1:
   593 0000042E F7F1                    	div	ecx
   594                                  s_2:
   595                                  	;;;
   596                                  	; eax = byte count of (to be) converted samples 
   597                                  	
   598                                  	; 17/11/2024
   599                                  	;;;
   600 00000430 8A0D[72730000]          	mov	cl, [fbs_shift]
   601                                  
   602 00000436 D3E0                    	shl	eax, cl
   603                                  		; *1 for 16 bit stereo
   604                                  		; *2 for 16 bit mono or 8 bit stereo
   605                                  		; *4 for for 8 bit mono
   606                                  	;;;
   607                                  
   608                                  	; eax = 16 bit stereo byte count (target buffer size)
   609                                  	
   610                                  	; 07/12/2024
   611                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   612 00000438 A3[88730000]            	mov	[buffersize], eax ; buffer size in bytes
   613 0000043D 891D[80730000]          	mov	[loadfromwavfile], ebx
   614                                  
   615                                  ; -------------------------------------------------------------
   616                                  
   617                                  Player_Template:
   618                                  	; 21/12/2024
   619 00000443 E8FE000000              	call	clearscreen
   620 00000448 E815010000              	call	drawplayingscreen
   621                                  
   622                                  	; 14/11/2024
   623 0000044D E8FA1E0000              	call	SetTotalTime
   624 00000452 E8C71F0000              	call	UpdateFileInfo
   625                                  
   626                                  ; -------------------------------------------------------------
   627                                  
   628                                  StartPlay:
   629                                  	; 21/12/2024 (VGA/LFB modifications)
   630                                  	; (Direct access/map to the LFB is already done here)
   631                                  	; ((this program is in VESA/VBE graphics mode here))
   632                                  PlayNow:
   633                                  	; 07/12/2024
   634                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000457 BB00020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000045C 8B0D[88730000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000462 BA[00800000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000467 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000046C CD40                <1>  int 40h
   635 0000046E 0F82A4000000            	jc	error_exit ; return to text mode and print err msg
   636                                  
   637                                  	; 01/06/2024
   638                                  	; Initialize Audio Device (bh = 3)
   639                                  	sys	_audio, 0301h, 0, audio_int_handler
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000474 BB01030000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000479 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000047E BA[F2070000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000483 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000488 CD40                <1>  int 40h
   640                                  	;jc	short error_exit
   641 0000048A 726C                    	jc	init_err ; return to text mode and print err msg
   642                                  
   643                                  	;;;
   644                                  	; 14/11/2024
   645 0000048C B003                    	mov	al, 3	; 0 = max, 31 = min
   646                                  	; 15/11/2024
   647 0000048E E888020000              	call	SetMasterVolume
   648                                  	; 07/12/2024
   649                                  	;call	SetPCMOutVolume
   650 00000493 E8F51F0000              	call	UpdateVolume
   651                                  	;;;
   652                                  	;
   653                                  	; 14/11/2024
   654 00000498 E880200000              	call	UpdateProgressBar
   655                                  	;;;
   656                                  
   657                                   	; 30/05/2024
   658                                  	; playwav4.asm
   659                                  _2:	
   660 0000049D E8371E0000              	call	check4keyboardstop	; flush keyboard buffer
   661 000004A2 72F9                    	jc	short _2		; 07/11/2023
   662                                  
   663                                  ; play the .wav file. Most of the good stuff is in here.
   664                                  	
   665                                  	; 05/12/2024
   666 000004A4 E814010000              	call    PlayWav
   667                                  
   668                                  ; close the .wav file and exit.
   669                                  
   670                                  	; 07/12/2024
   671                                  	;;;
   672                                  	; Stop Playing
   673                                  	;sys	_audio, 0700h
   674                                  	; Cancel callback service (for user)
   675                                  	sys	_audio, 0900h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004A9 BB00090000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004AE B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004B3 CD40                <1>  int 40h
   676                                  	; Deallocate Audio Buffer (for user)
   677                                  	sys	_audio, 0A00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004B5 BB000A0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004BA B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004BF CD40                <1>  int 40h
   678                                  	; Disable Audio Device
   679                                  	sys	_audio, 0C00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004C1 BB000C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004C6 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004CB CD40                <1>  int 40h
   680                                  	;;;
   681                                  
   682                                  terminate:
   683 000004CD E8E4000000              	call	set_text_mode
   684                                  Exit:
   685                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004D2 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 000004D7 CD40                <1>  int 40h
   686                                  halt:
   687 000004D9 EBFE                    	jmp	short halt
   688                                  
   689                                  ; -------------------------------------------------------------
   690                                  
   691                                  	; 30/05/2024
   692                                  pmsg_usage:
   693                                  	; 21/12/2024
   694 000004DB E8D6000000              	call	set_text_mode
   695                                  	; 01/12/2024
   696                                  	sys	_msg, msg_usage, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004E0 BB[10280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000004E5 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000004EA BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004EF B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000004F4 CD40                <1>  int 40h
   697 000004F6 EBDA                    	jmp	short Exit
   698                                  
   699                                  ; -------------------------------------------------------------
   700                                  
   701                                  	; 30/05/2024
   702                                  init_err:
   703                                  	; 21/12/2024
   704 000004F8 E8B9000000              	call	set_text_mode
   705                                  	; 01/12/2024
   706                                  	sys	_msg, msg_init_err, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004FD BB[93280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000502 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000507 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000050C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000511 CD40                <1>  int 40h
   707 00000513 EBBD                    	jmp	short Exit
   708                                  
   709                                  ; -------------------------------------------------------------
   710                                  
   711                                  	; 02/12/2024
   712                                  Player_Quit@:
   713 00000515 58                      	pop	eax ; return addr (call PlayWav@)
   714                                  	
   715                                  	; 29/11/2024
   716                                  Player_Quit:
   717 00000516 EBB5                    	jmp	 short terminate
   718                                  
   719                                  
   720                                  ; -------------------------------------------------------------
   721                                  
   722                                  	; 07/12/2024
   723                                  error_exit:
   724                                  	; 21/12/2024
   725 00000518 E899000000              	call	set_text_mode
   726                                  trdos386_error:
   727                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000051D BB[73280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000522 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000527 BA0E000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000052C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000531 CD40                <1>  int 40h
   728 00000533 EB9D                    	jmp	short Exit
   729                                  
   730                                  ; -------------------------------------------------------------
   731                                  
   732                                  	; 21/12/2024
   733                                  print_msg:
   734 00000535 B40E                    	mov	ah, 0Eh
   735 00000537 BB07000000              	mov	ebx, 7
   736                                  	;mov	bl, 7 ; char attribute & color
   737                                  p_next_chr:
   738 0000053C AC                      	lodsb
   739 0000053D 08C0                    	or	al, al
   740 0000053F 7404                    	jz	short p_retn ; retn
   741 00000541 CD31                    	int	31h
   742 00000543 EBF7                    	jmp	short p_next_chr
   743                                  p_retn:
   744 00000545 C3                      	retn
   745                                  
   746                                  ; -------------------------------------------------------------
   747                                  
   748                                  	; 21/12/2024
   749                                  clearscreen:
   750                                  	; fast clear
   751                                  	; 640*480, 256 colors
   752 00000546 8B3D[CC720000]          	mov	edi, [LFB_ADDR]
   753 0000054C B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   754 00000551 31C0                    	xor	eax, eax
   755 00000553 F3AB                    	rep	stosd
   756 00000555 C3                      	retn
   757                                  
   758                                  ; -------------------------------------------------------------
   759                                  
   760                                  	; 21/12/2024
   761                                  drawsplashscreen:
   762 00000556 BD[F0290000]            	mov	ebp, SplashScreen
   763                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   764                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   765                                  	;mov	esi, 0 ; row 0, column 0
   766 0000055B BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   767 00000560 EB0A                    	jmp	short p_d_x
   768                                  drawplayingscreen:
   769 00000562 BD[91340000]            	mov	ebp, PlayingScreen
   770                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   771                                  	;mov	esi, 0 ; row 0, column 0
   772 00000567 BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   773                                  p_d_x:
   774 0000056C C605[D9720000]50        	mov	byte [columns], 80
   775                                  p_d_x_n:
   776 00000573 31D2                    	xor	edx, edx
   777 00000575 8A5500                  	mov	dl, [ebp]
   778 00000578 20D2                    	and	dl, dl
   779 0000057A 7439                    	jz	short p_d_x_ok
   780 0000057C C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   781                                  
   782 0000057F BF[8C4D0000]            	mov	edi, fontbuff2 ; start of user font data
   783 00000584 01D7                    	add	edi, edx
   784                                  	
   785                                  	;; NOTE: Following system call writes fonts at
   786                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   787                                  	;; screen width as 640 pixels (instead of 320 pixels)
   788                                  	;; so 8Fh is sub function 0Fh (write char)
   789                                  	;; with 640 pixels screen witdh. 
   790                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   791                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   792                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   793                                  	;; region, the text is appeared on screen
   794                                  	;; while LFB is at C0000000h or E0000000h.)
   795                                  
   796                                  	;sys	_video, 018Fh, [tcolor], 8001h
   797                                  			;; use STD VGA video memory
   798                                  			;; (0A0000h)
   799                                  	sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000586 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000058B 8B0D[D8720000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000591 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000596 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000059B CD40                <1>  int 40h
   800                                  		 ; use LFB for current VBE mode
   801                                  		 ; for writing fonts on screen
   802 0000059D 45                      	inc	ebp
   803 0000059E 6683C608                	add	si, 8 ; next char pos
   804 000005A2 FE0D[D9720000]          	dec	byte [columns]
   805 000005A8 75C9                    	jnz	short p_d_x_n	; next column
   806 000005AA 6631F6                  	xor	si, si
   807                                  	;;add	esi, 00100000h	; next row ; 8*16
   808                                  	;add	esi, [nextrow]
   809 000005AD 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   810 000005B3 EBB7                    	jmp	short p_d_x
   811                                  p_d_x_ok:
   812 000005B5 C3                      	retn
   813                                  
   814                                  ; -------------------------------------------------------------
   815                                  
   816                                  	; 21/12/2024
   817                                  set_text_mode:
   818 000005B6 30E4                    	xor    ah, ah
   819 000005B8 B003                    	mov    al, 3                        
   820                                   	;int   10h ; al = 03h text mode, int 10 video
   821 000005BA CD31                    	int    31h ; TRDOS 386 - Video interrupt
   822 000005BC C3                      	retn
   823                                  
   824                                  ; -------------------------------------------------------------
   825                                  
   826                                  	; 07/12/2024 (playwav9.s)
   827                                  	; 26/11/2023 (playwav8.s)
   828                                  PlayWav:
   829                                  	; 19/11/2024
   830 000005BD C605[DF720000]01        	mov	byte [wleds], 1
   831                                  
   832                                  	;;;
   833                                  	; 09/12/2024
   834 000005C4 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
   835 000005C9 803D[EA720000]00        	cmp	byte [VRA], 0
   836 000005D0 7614                    	jna	short _3 ; 48kHZ (interpolation)
   837                                  	;;;
   838                                  	; 01/12/2024 (32bit)
   839                                  	;movzx	eax, word [WAVE_SampleRate]
   840                                  	; 09/12/2024
   841 000005D2 66A1[04730000]          	mov	ax, [WAVE_SampleRate]
   842 000005D8 B90A000000              	mov	ecx, 10
   843 000005DD F7E1                    	mul	ecx
   844 000005DF B1B6                    	mov	cl, 182
   845 000005E1 F7F1                    	div	ecx
   846                                  	; ax = samples per 1/18.2 second
   847                                  	;mov	cl, byte [WAVE_BlockAlign]
   848                                  	; 09/12/2024 
   849                                  	;mov	cl, 4 ; 16 bit, stereo
   850                                  	;mul	ecx
   851 000005E3 C1E002                  	shl	eax, 2 ; * 4
   852                                  _3:
   853 000005E6 A3[E0720000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
   854                                  				; for wave volume leds update
   855                                  				; (byte stream per 1/18.2 second)
   856                                  RePlayWav:
   857                                  	; 07/12/2024
   858 000005EB BF[00800000]            	mov	edi, audio_buffer
   859 000005F0 FF15[80730000]          	call	dword [loadfromwavfile]
   860 000005F6 0F821CFFFFFF            	jc	error_exit
   861                                  
   862 000005FC C605[E9720000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
   863                                  
   864 00000603 A1[94730000]            	mov	eax, [count]
   865 00000608 0105[98730000]          	add	[LoadedDataBytes], eax
   866                                  
   867 0000060E F605[1A730000]01        	test    byte [flags], ENDOFFILE  ; end of file
   868 00000615 752C                    	jnz	short _4 ; yes
   869                                  			 ; bypass filling dma half buffer 2
   870                                  
   871                                  	; bh = 16 : update (current, first) dma half buffer
   872                                  	; bl = 0  : then switch to the next (second) half buffer
   873                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000617 BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000061C B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000621 CD40                <1>  int 40h
   874                                  
   875                                  	; 18/12/2024
   876 00000623 C705[94730000]0000-     	mov	dword [count], 0
   876 0000062B 0000               
   877                                  
   878                                  	; 07/12/2024
   879 0000062D BF[00800000]            	mov	edi, audio_buffer
   880 00000632 FF15[80730000]          	call	dword [loadfromwavfile]
   881                                  	;jc	error_exit
   882                                  	
   883 00000638 A1[94730000]            	mov	eax, [count]
   884 0000063D 0105[98730000]          	add	[LoadedDataBytes], eax
   885                                  _4:
   886                                  	; 07/12/2024
   887 00000643 668B0D[04730000]         	mov	cx, [WAVE_SampleRate]
   888 0000064A B303                    	mov	bl, 3	; 16 bit, stereo
   889 0000064C B704                    	mov	bh, 4	; start to play
   890                                  	sys	_audio
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000064E B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000653 CD40                <1>  int 40h
   891                                  
   892                                  ; -------------------------------------------
   893                                  
   894                                  	; 22/12/2024
   895                                   	; prepare all leds as turned off
   896 00000655 E8C01F0000              	call	reset_wave_leds
   897                                  
   898                                  ; -------------------------------------------
   899                                  
   900                                  	; 07/12/2024 (playwav9.s)
   901                                  	; 01/12/2024 (32bit)
   902                                  	; 29/11/2024
   903                                  tuneLoop:
   904                                  	; 30/05/2024
   905                                  	; 18/11/2023 (ich_wav4.asm)
   906                                  	; 08/11/2023
   907                                  	; 06/11/2023
   908                                  tLWait:
   909                                  	; 18/11/2024
   910 0000065A 803D[DC720000]00        	cmp	byte [stopped], 0
   911                                  	; 24/11/2024
   912 00000661 761E                    	jna	short tL1
   913                                  tLWait@:	; 21/11/2024
   914 00000663 E8551B0000              	call	checkUpdateEvents
   915 00000668 726E                    	jc	_exitt_
   916 0000066A 803D[DD720000]30        	cmp	byte [tLO], '0'
   917 00000671 74E7                    	je	short tLWait
   918 00000673 E86A000000              	call	tLZ
   919 00000678 C605[DD720000]30        	mov	byte [tLO], '0'
   920 0000067F EBD9                    	jmp	short tLWait
   921                                  tL1:
   922                                  	; 27/11/2024
   923                                  	; Check AC'97 interrupt status
   924 00000681 803D[73730000]00        	cmp	byte [SRB], 0
   925 00000688 7709                    	ja	short tL3
   926                                  tL2:
   927 0000068A E82E1B0000              	call	checkUpdateEvents
   928 0000068F 7247                    	jc	_exitt_
   929 00000691 EBC7                    	jmp	short tLWait
   930                                  tL3:
   931 00000693 8035[E9720000]01        	xor	byte [half_buffer], 1
   932                                  	; 07/12/2024
   933 0000069A C605[73730000]00        	mov	byte [SRB], 0
   934                                  
   935                                  	; 07/12/2024
   936 000006A1 BF[00800000]            	mov	edi, audio_buffer
   937                                  	;call	loadFromFile
   938                                  	; 18/11/2023
   939                                  	;call	word [loadfromwavfile]
   940                                  	; 01/12/2024
   941 000006A6 FF15[80730000]          	call	dword [loadfromwavfile]
   942 000006AC 722A                    	jc	short _exitt_	; end of file
   943                                  
   944                                  	; 07/12/2024
   945                                  	;;;;
   946                                  	; bh = 16 : update (current, first) dma half buffer
   947                                  	; bl = 0  : then switch to the other half buffer
   948                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000006AE BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000006B3 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000006B8 CD40                <1>  int 40h
   949                                  	;;;;
   950                                  
   951                                  	; 26/11/2024
   952 000006BA A0[E9720000]            	mov	al, [half_buffer]
   953 000006BF 0431                    	add	al, '1'
   954                                  	; 19/11/2024
   955 000006C1 A2[DD720000]            	mov	[tLO], al
   956 000006C6 E819000000              	call	tL0
   957                                  
   958                                  	; 24/11/2024
   959                                  	; 14/11/2024
   960                                  	;mov	ax, [count]
   961                                  	;add	[LoadedDataBytes], ax
   962                                  	;adc	word [LoadedDataBytes+2], 0
   963                                  	; 01/12/2024
   964 000006CB A1[94730000]            	mov	eax, [count]
   965 000006D0 0105[98730000]          	add	[LoadedDataBytes], eax
   966                                  
   967                                  	; 07/12/2024 (playwav9.s)
   968                                  	; 27/11/2024 (playwav9.asm)
   969 000006D6 EBB2                    	jmp	short tL2
   970                                  
   971                                  _exitt_:
   972                                  	; 07/12/2024
   973                                  	; Stop Playing
   974                                  	;mov	byte [stopped], 2
   975                                  	;sys	_audio, 0700h
   976 000006D8 E8A41A0000              	call	ac97_stop
   977                                  
   978                                  	;;;
   979                                  	; 14/11/2024
   980 000006DD E83B1E0000              	call	UpdateProgressBar
   981                                  	;;;
   982                                  
   983                                  	; 18/11/2024
   984                                  tLZ:
   985                                  	; 30/05/2024
   986 000006E2 B030                    	mov	al, '0'
   987                                  
   988                                  	;add	al, '0'
   989                                  	;call	tL0
   990                                  	;
   991                                  	;retn
   992                                  	; 06/11/2023
   993                                  	;jmp	short tL0
   994                                  	;retn
   995                                  
   996                                  	; 06/11/2023
   997                                  tL0:
   998                                  	; 29/05/2024 (TRDOS 386)
   999                                  	; 08/11/2023
  1000                                  	; 05/11/2023
  1001                                  	; 17/02/2017 - Buffer switch test (temporary)
  1002                                  	; 06/11/2023
  1003                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1004                                  
  1005                                  	; 22/12/2024 (graphics mode modification)
  1006                                  	; (640*480, 256 colors)
  1007                                  	;;;
  1008                                  	;mov	ebp, 16
  1009 000006E4 BD0E000000              	mov	ebp, 14
  1010 000006E9 8B3D[CC720000]          	mov	edi, [LFB_ADDR]
  1011 000006EF 0FB6F0                  	movzx	esi, al
  1012 000006F2 C1E604                  	shl	esi, 4 ; * 16
  1013 000006F5 81C6[8C4D0000]          	add	esi, fontbuff2
  1014                                  tL0_1:
  1015 000006FB BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1016 00000700 8A26                    	mov	ah, [esi]
  1017                                  tL0_2:
  1018 00000702 B00C                    	mov	al, 0Ch ; red
  1019 00000704 D0E4                    	shl	ah, 1
  1020 00000706 7302                    	jnc	short tL0_3
  1021 00000708 B00E                    	mov	al, 0Eh ; yellow
  1022                                  tL0_3:
  1023 0000070A AA                      	stosb
  1024 0000070B 4A                      	dec	edx
  1025 0000070C 75F4                    	jnz	short tL0_2
  1026 0000070E 4D                      	dec	ebp
  1027 0000070F 7409                    	jz	short tL0_4
  1028 00000711 81C778020000            	add	edi, 640-8 ; next line
  1029 00000717 46                      	inc	esi
  1030 00000718 EBE1                    	jmp	short tL0_1
  1031                                  tL0_4:
  1032                                  	;;;
  1033 0000071A C3                      	retn
  1034                                  
  1035                                  ; -------------------------------------------
  1036                                  
  1037                                  	; 07/12/2024
  1038                                  SetMasterVolume:
  1039                                  	;cmp	al, 31
  1040                                  	;ja	short setvolume_ok
  1041 0000071B A2[30230000]            	mov	[volume], al  ; max = 0, min = 31
  1042                                  
  1043 00000720 B41F                    	mov	ah, 31
  1044 00000722 28C4                    	sub	ah, al
  1045 00000724 88E0                    	mov	al, ah
  1046                                  
  1047                                  	; Set Master Volume Level (BL=0 or 80h)
  1048                                  	; 	for next playing (BL>=80h)
  1049                                  	;sys	_audio, 0B80h, eax
  1050                                  	sys	_audio, 0B00h, eax
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000726 BB000B0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000072B 89C1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000072D B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000732 CD40                <1>  int 40h
  1051                                  	
  1052                                  setvolume_ok:
  1053                                  ac97_not_detected:
  1054 00000734 C3                      	retn
  1055                                  
  1056                                  ; -------------------------------------------
  1057                                  
  1058                                  	; 07/12/2024 (playwav9.s)
  1059                                  DetectAC97:
  1060                                  DetectICH:
  1061                                  	; 25/11/2023 (playwav8.s)
  1062                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1063                                          sys	_audio, 0102h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000735 BB02010000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000073A B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000073F CD40                <1>  int 40h
  1064                                  	;jnc	short d_ac97_@
  1065                                  	;retn
  1066 00000741 72F1                    	jc	short ac97_not_detected
  1067                                  d_ac97_@:
  1068                                  	; 07/12/2024 (playwav9.s)
  1069                                  	; 06/06/2017
  1070                                  	sys	_audio, 0E00h ; get audio controller info
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000743 BB000E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000748 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000074D CD40                <1>  int 40h
  1071 0000074F 0F82C3FDFFFF            	jc	error_exit ; 25/11/2023
  1072                                  
  1073                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1074                                  	;jne	_dev_not_ready	
  1075                                  
  1076                                  	; EAX = IRQ Number in AL
  1077                                  	;	Audio Device Number in AH 
  1078                                  	; EBX = DEV/VENDOR ID
  1079                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1080                                  	; ECX = BUS/DEV/FN 
  1081                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1082                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1083                                  	;      (Low word, DX = NAMBAR address)
  1084                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1085                                  
  1086 00000755 891D[78730000]          	mov	[dev_vendor], ebx
  1087 0000075B 890D[74730000]          	mov	[bus_dev_fn], ecx
  1088                                  
  1089 00000761 668915[7C730000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1090                                  	;shr	edx, 16
  1091                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1092 00000768 8915[7C730000]          	mov	[NAMBAR], edx
  1093                                  
  1094 0000076E A2[1B730000]            	mov	[ac97_int_ln_reg], al
  1095                                  
  1096                                  	; 07/12/2024
  1097                                  	; 01/06/2024
  1098                                  	; 25/11/2023
  1099                                  	; Get AC'97 Codec info
  1100                                  	; (Function 14, sub function 1)
  1101                                  	sys	_audio, 0E01h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000773 BB010E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000778 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000077D CD40                <1>  int 40h
  1102                                  	; Save Variable Rate Audio support bit
  1103 0000077F 2401                    	and	al, 1
  1104 00000781 A2[EA720000]            	mov	[VRA], al
  1105                                  
  1106                                  	;clc
  1107                                  
  1108 00000786 C3                      	retn
  1109                                  
  1110                                  ; ----------------------------------
  1111                                  	
  1112                                  	; 01/12/2024
  1113                                  	; 14/11/2024
  1114                                  	; INPUT: ds:dx = file name address
  1115                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1116                                  openFile:
  1117                                  	;mov	ax, 3D00h	; open File for read
  1118                                  	;int	21h
  1119                                  	;jnc	short _of1
  1120                                  	; 01/12/2024 (TRDOS 386)
  1121                                  	;sys	_open, edx, 0
  1122                                  	; 07/12/2024
  1123                                  	sys	_open, wav_file_name, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000787 BB[20730000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000078C B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000791 B805000000          <1>  mov eax, %1
    97                              <1> 
    98 00000796 CD40                <1>  int 40h
  1124 00000798 7305                    	jnc	short _of1
  1125                                  
  1126 0000079A B8FFFFFFFF              	mov	eax, -1
  1127                                  	; cf = 1 -> not found or access error
  1128                                  _of1:
  1129 0000079F A3[1C730000]            	mov	[filehandle], eax
  1130 000007A4 C3                      	retn
  1131                                  
  1132                                  ; ----------------------------------
  1133                                  
  1134                                  ; close the currently open file
  1135                                  
  1136                                  	; 01/12/2024
  1137                                  	; 14/11/2024
  1138                                  	; INPUT: [filehandle] ; -1 = not open
  1139                                  	; OUTPUT: none
  1140                                  closeFile:
  1141 000007A5 833D[1C730000]FF        	cmp	dword [filehandle], -1
  1142 000007AC 740D                    	jz	short _cf1
  1143                                  	;mov	bx, [filehandle]  
  1144                                  	;mov	ax, 3E00h
  1145                                          ;int	21h              ; close file
  1146                                  	; 01/12/2024
  1147                                  	sys	_close, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007AE 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007B4 B806000000          <1>  mov eax, %1
    97                              <1> 
    98 000007B9 CD40                <1>  int 40h
  1148                                  	;mov 	dword [filehandle], -1
  1149                                  _cf1:
  1150 000007BB C3                      	retn
  1151                                  
  1152                                  ; ----------------------------------
  1153                                  
  1154                                  	; 01/12/2024
  1155                                  	; 14/11/2024 - Erdogan Tan
  1156                                  getWAVParameters:
  1157                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1158                                  ; entry: none - assumes file is already open
  1159                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1160                                  ;	cx = number of channels (mono=1, stereo=2)
  1161                                  ;	dx = bits per sample (8, 16)
  1162                                  ;	bx = number of bytes per sample (1 to 4)
  1163                                  
  1164                                          ;mov	dx, WAVFILEHEADERbuff
  1165                                  	;mov	bx, [filehandle]
  1166                                          ;mov	cx, 44			; 44 bytes
  1167                                  	;mov	ah, 3Fh
  1168                                          ;int	21h
  1169                                  	;jc	short gwavp_retn
  1170                                  	; 01/12/2024 (TRDOS 386)
  1171                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007BC 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000007C2 B9[EC720000]        <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000007C7 BA2C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007CC B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000007D1 CD40                <1>  int 40h
  1172 000007D3 721C                    	jc	short gwavp_retn
  1173                                  
  1174 000007D5 83F82C                  	cmp	eax, 44
  1175 000007D8 7217                    	jb	short gwavp_retn
  1176                                  
  1177 000007DA 813D[F4720000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1177 000007E2 5645               
  1178 000007E4 750A                    	jne	short gwavp_stc_retn
  1179                                  
  1180 000007E6 66833D[00730000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1181                                  	;jne	short gwavp_stc_retn
  1182 000007EE 7401                    	je	short gwavp_retn ; 15/11/2024
  1183                                  
  1184                                  	; 15/11/2024
  1185                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1186                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1187                                  	;mov	dx, [WAVE_BitsPerSample] 
  1188                                  					; return bits per sample value in DX
  1189                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1190                                  ;gwavp_retn:
  1191                                          ;retn
  1192                                  
  1193                                  gwavp_stc_retn:
  1194 000007F0 F9                      	stc
  1195                                  gwavp_retn:
  1196 000007F1 C3                      	retn
  1197                                  
  1198                                  ; --------------------------------------------------------
  1199                                  ; 07/12/2024
  1200                                  ; --------------------------------------------------------
  1201                                  ; ref: playwav8.s (04/06/2024)
  1202                                  
  1203                                  audio_int_handler:
  1204                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1205                                  
  1206                                  	; 07/12/2024
  1207                                  	;mov	al, [stopped]
  1208                                  	;cmp	al, 2
  1209                                  	;je	short _callback_retn
  1210                                  
  1211                                  	; 18/08/2020
  1212                                  	;mov	byte [SRB], 1
  1213                                  	; 07/12/2024
  1214 000007F2 FE05[73730000]          	inc	byte [SRB]
  1215                                  
  1216                                  ;_callback_retn:
  1217                                  	sys	_rele ; return from callback service 
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007F8 B827000000          <1>  mov eax, %1
    97                              <1> 
    98 000007FD CD40                <1>  int 40h
  1218                                  	; we must not come here !
  1219                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007FF B801000000          <1>  mov eax, %1
    97                              <1> 
    98 00000804 CD40                <1>  int 40h
  1220                                  
  1221                                  ; --------------------------------------------------------
  1222                                  ; 07/12/2024
  1223                                  ; --------------------------------------------------------
  1224                                  
  1225                                  ; /////
  1226                                  	; 14/12/2024
  1227                                  	; 07/12/2024
  1228                                  	; 01/12/2024
  1229                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1230                                  loadFromFile:
  1231                                  	; 07/11/2023
  1232                                  
  1233 00000806 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1234                                  					; last of the file?
  1235 0000080D 7402                    	jz	short lff_0		; no
  1236 0000080F F9                      	stc
  1237 00000810 C3                      	retn
  1238                                  
  1239                                  lff_0:
  1240                                  	; 07/12/2024
  1241                                  	; 26/11/2023 (playwav8.s)
  1242                                  	;mov	edi, audio_buffer
  1243                                  
  1244                                  	; 01/12/2024 (TRDOS 386)
  1245                                  	; edi = audio buffer address
  1246                                  
  1247                                  	; 14/12/2024
  1248                                  	; 01/12/2024
  1249                                  	; 17/11/2024
  1250                                  	;mov	ebx, [filehandle]
  1251                                  	; 02/12/2024
  1252                                  	;mov	edx, [loadsize] 
  1253                                  
  1254                                  	; 17/11/2024
  1255 00000811 803D[72730000]00        	cmp	byte [fbs_shift], 0
  1256 00000818 7677                    	jna	short lff_1 ; stereo, 16 bit
  1257                                  
  1258                                  lff_2:
  1259                                  	; 01/12/2024
  1260 0000081A BE[00800100]            	mov	esi, temp_buffer 
  1261                                  	; 14/12/2024
  1262                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000081F 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000825 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000827 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000082D B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000832 CD40                <1>  int 40h
  1263 00000834 0F8289000000            	jc	lff_4 ; error !
  1264                                  
  1265                                  	; 01/12/2024
  1266                                  	; 14/11/2024
  1267 0000083A A3[94730000]            	mov	[count], eax
  1268                                  
  1269                                  	; 01/12/2024
  1270 0000083F 21C0                    	and	eax, eax
  1271                                  	;jz	short lff_3
  1272                                  	; 14/12/2024
  1273 00000841 0F8485000000            	jz	lff_10
  1274                                  
  1275 00000847 8A1D[72730000]          	mov	bl, [fbs_shift]
  1276                                  
  1277                                  	; 14/12/2024
  1278 0000084D 89FA                    	mov	edx, edi ; audio buffer start address
  1279                                  
  1280                                  	; 01/12/2024
  1281 0000084F 89C1                    	mov	ecx, eax
  1282 00000851 803D[0E730000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1283 00000858 751E                    	jne	short lff_7 ; 16 bit samples
  1284                                  	; 8 bit samples
  1285 0000085A FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1286 0000085C 740E                    	jz	short lff_6 ; 8 bit, stereo
  1287                                  	; 01/12/2024 (32bit registers)
  1288                                  lff_5:
  1289                                  	; mono & 8 bit
  1290 0000085E AC                      	lodsb
  1291 0000085F 2C80                    	sub	al, 80h ; 08/11/2023
  1292 00000861 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1293 00000864 66AB                    	stosw	; left channel
  1294 00000866 66AB                    	stosw	; right channel
  1295 00000868 E2F4                    	loop	lff_5
  1296 0000086A EB16                    	jmp	short lff_9
  1297                                  lff_6:
  1298                                  	; stereo & 8 bit
  1299 0000086C AC                      	lodsb
  1300 0000086D 2C80                    	sub	al, 80h ; 08/11/2023
  1301 0000086F C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1302 00000872 66AB                    	stosw
  1303 00000874 E2F6                    	loop	lff_6
  1304 00000876 EB0A                    	jmp	short lff_9
  1305                                  lff_7:
  1306 00000878 D1E9                    	shr	ecx, 1 ; word count
  1307                                  lff_8:
  1308 0000087A 66AD                    	lodsw
  1309 0000087C 66AB                    	stosw	; left channel
  1310 0000087E 66AB                    	stosw	; right channel
  1311 00000880 E2F8                    	loop	lff_8
  1312                                  lff_9:
  1313                                  	; 14/12/2024
  1314 00000882 89F8                    	mov	eax, edi
  1315 00000884 8B0D[88730000]          	mov	ecx, [buffersize] 
  1316 0000088A 01D1                    	add	ecx, edx ; + buffer start address
  1317 0000088C 39C8                    	cmp	eax, ecx	
  1318 0000088E 7225                    	jb	short lff_3
  1319 00000890 C3                      	retn
  1320                                  	
  1321                                  lff_1:  
  1322                                  	; 07/12/2024
  1323                                  	; 01/12/2024
  1324                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1325                                  	; 14/12/2024
  1326                                  	sys 	_read, [filehandle], edi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000891 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000897 89F9                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000899 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000089F B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000008A4 CD40                <1>  int 40h
  1327                                  	; 07/11/2023
  1328 000008A6 721B                    	jc	short lff_4 ; error !
  1329                                  
  1330                                  	; 01/12/2024
  1331                                  	; 14/11/2024
  1332 000008A8 A3[94730000]            	mov	[count], eax
  1333                                  
  1334                                  	; 02/12/2024
  1335 000008AD 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1336 000008AF 7411                    	je	short endLFF
  1337                                  	; edi = buffer (start) address
  1338 000008B1 01C7                    	add	edi, eax
  1339 000008B3 89D1                    	mov	ecx, edx
  1340                                  lff_3:
  1341                                  	;call	padfill			; blank pad the remainder
  1342                                  	; 21/12/2024
  1343                                  padfill:
  1344                                  	; 14/12/2024
  1345                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1346                                  	; 17/11/2024
  1347                                  	;   di = offset (to be filled with ZEROs)
  1348                                  	;   bp = buffer segment
  1349                                  	;   ax = di = number of bytes loaded
  1350                                  	;   cx = buffer size (> loaded bytes)	
  1351                                  	; 07/11/2023
  1352                                  	; 06/11/2023
  1353                                  	; 17/02/2017
  1354                                  	; 01/12/2024
  1355 000008B5 29C1                    	sub	ecx, eax
  1356                                  	; 01/12/2024
  1357                                  	; 25/11/2024
  1358 000008B7 31C0                    	xor	eax, eax
  1359                                  	; 14/12/2024
  1360 000008B9 F3AA                    	rep	stosb
  1361                                  	; 21/12/2024
  1362                                  	;retn
  1363                                  	; ----------
  1364                                          ;clc				; don't exit with CY yet.
  1365 000008BB 800D[1A730000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1366                                  endLFF:
  1367 000008C2 C3                              retn
  1368                                  lff_4:
  1369                                  	; 08/11/2023
  1370 000008C3 B021                    	mov	al, '!'  ; error
  1371 000008C5 E81AFEFFFF              	call	tL0
  1372                                  
  1373                                  	; 01/12/2024
  1374 000008CA 31C0                    	xor	eax, eax
  1375                                  lff_10:
  1376                                  	; 14/12/2024
  1377 000008CC 8B0D[88730000]          	mov	ecx, [buffersize]
  1378 000008D2 EBE1                    	jmp	short lff_3
  1379                                  
  1380                                  ; /////
  1381                                  
  1382                                  ; --------------------------------------------------------
  1383                                  ; --------------------------------------------------------
  1384                                  	
  1385                                  write_audio_dev_info:
  1386                                  	; 30/05/2024
  1387                                       	;sys_msg msgAudioCardInfo, 0Fh
  1388                                  	; 01/12/2024
  1389                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008D4 BB[E7270000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000008D9 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000008DE BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008E3 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000008E8 CD40                <1>  int 40h
  1390 000008EA C3                      	retn
  1391                                  
  1392                                  ; --------------------------------------------------------
  1393                                  
  1394                                  write_ac97_pci_dev_info:
  1395                                  	; 19/11/2024
  1396                                  	; 30/05/2024
  1397                                  	; 06/06/2017
  1398                                  	; 03/06/2017
  1399                                  	; BUS/DEV/FN
  1400                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1401                                  	; DEV/VENDOR
  1402                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1403                                  
  1404 000008EB A1[78730000]            	mov	eax, [dev_vendor]
  1405 000008F0 31DB                    	xor	ebx, ebx
  1406 000008F2 88C3                    	mov	bl, al
  1407 000008F4 88DA                    	mov	dl, bl
  1408 000008F6 80E30F                  	and	bl, 0Fh
  1409 000008F9 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1410 000008FF A2[44290000]            	mov	[msgVendorId+3], al
  1411 00000904 88D3                    	mov	bl, dl
  1412 00000906 C0EB04                  	shr	bl, 4
  1413 00000909 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1414 0000090F A2[43290000]            	mov	[msgVendorId+2], al
  1415 00000914 88E3                    	mov	bl, ah
  1416 00000916 88DA                    	mov	dl, bl
  1417 00000918 80E30F                  	and	bl, 0Fh
  1418 0000091B 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1419 00000921 A2[42290000]            	mov	[msgVendorId+1], al
  1420 00000926 88D3                    	mov	bl, dl
  1421 00000928 C0EB04                  	shr	bl, 4
  1422 0000092B 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1423 00000931 A2[41290000]            	mov	[msgVendorId], al
  1424 00000936 C1E810                  	shr	eax, 16
  1425 00000939 88C3                    	mov	bl, al
  1426 0000093B 88DA                    	mov	dl, bl
  1427 0000093D 80E30F                  	and	bl, 0Fh
  1428 00000940 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1429 00000946 A2[55290000]            	mov	[msgDevId+3], al
  1430 0000094B 88D3                    	mov	bl, dl
  1431 0000094D C0EB04                  	shr	bl, 4
  1432 00000950 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1433 00000956 A2[54290000]            	mov	[msgDevId+2], al
  1434 0000095B 88E3                    	mov	bl, ah
  1435 0000095D 88DA                    	mov	dl, bl
  1436 0000095F 80E30F                  	and	bl, 0Fh
  1437 00000962 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1438 00000968 A2[53290000]            	mov	[msgDevId+1], al
  1439 0000096D 88D3                    	mov	bl, dl
  1440 0000096F C0EB04                  	shr	bl, 4
  1441 00000972 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1442 00000978 A2[52290000]            	mov	[msgDevId], al
  1443                                  
  1444 0000097D A1[74730000]            	mov	eax, [bus_dev_fn]
  1445 00000982 C1E808                  	shr	eax, 8
  1446 00000985 88C3                    	mov	bl, al
  1447 00000987 88DA                    	mov	dl, bl
  1448 00000989 80E307                  	and	bl, 7 ; bit 0,1,2
  1449 0000098C 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1450 00000992 A2[7A290000]            	mov	[msgFncNo+1], al
  1451 00000997 88D3                    	mov	bl, dl
  1452 00000999 C0EB03                  	shr	bl, 3
  1453 0000099C 88DA                    	mov	dl, bl
  1454 0000099E 80E30F                  	and	bl, 0Fh
  1455 000009A1 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1456 000009A7 A2[6C290000]            	mov	[msgDevNo+1], al
  1457 000009AC 88D3                    	mov	bl, dl
  1458 000009AE C0EB04                  	shr	bl, 4
  1459 000009B1 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1460 000009B7 A2[6B290000]            	mov	[msgDevNo], al
  1461 000009BC 88E3                    	mov	bl, ah
  1462 000009BE 88DA                    	mov	dl, bl
  1463 000009C0 80E30F                  	and	bl, 0Fh
  1464 000009C3 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1465 000009C9 A2[60290000]            	mov	[msgBusNo+1], al
  1466 000009CE 88D3                    	mov	bl, dl
  1467 000009D0 C0EB04                  	shr	bl, 4
  1468 000009D3 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1469 000009D9 A2[5F290000]            	mov	[msgBusNo], al
  1470                                  
  1471                                  	;mov	ax, [ac97_NamBar]
  1472 000009DE 66A1[7C730000]          	mov	ax, [NAMBAR]
  1473 000009E4 88C3                    	mov	bl, al
  1474 000009E6 88DA                    	mov	dl, bl
  1475 000009E8 80E30F                  	and	bl, 0Fh
  1476 000009EB 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1477 000009F1 A2[8A290000]            	mov	[msgNamBar+3], al
  1478 000009F6 88D3                    	mov	bl, dl
  1479 000009F8 C0EB04                  	shr	bl, 4
  1480 000009FB 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1481 00000A01 A2[89290000]            	mov	[msgNamBar+2], al
  1482 00000A06 88E3                    	mov	bl, ah
  1483 00000A08 88DA                    	mov	dl, bl
  1484 00000A0A 80E30F                  	and	bl, 0Fh
  1485 00000A0D 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1486 00000A13 A2[88290000]            	mov	[msgNamBar+1], al
  1487 00000A18 88D3                    	mov	bl, dl
  1488 00000A1A C0EB04                  	shr	bl, 4
  1489 00000A1D 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1490 00000A23 A2[87290000]            	mov	[msgNamBar], al
  1491                                  
  1492                                  	;mov	ax, [ac97_NabmBar]
  1493 00000A28 66A1[7E730000]          	mov	ax, [NABMBAR]
  1494 00000A2E 88C3                    	mov	bl, al
  1495 00000A30 88DA                    	mov	dl, bl
  1496 00000A32 80E30F                  	and	bl, 0Fh
  1497 00000A35 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1498 00000A3B A2[9A290000]            	mov	[msgNabmBar+3], al
  1499 00000A40 88D3                    	mov	bl, dl
  1500 00000A42 C0EB04                  	shr	bl, 4
  1501 00000A45 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1502 00000A4B A2[99290000]            	mov	[msgNabmBar+2], al
  1503 00000A50 88E3                    	mov	bl, ah
  1504 00000A52 88DA                    	mov	dl, bl
  1505 00000A54 80E30F                  	and	bl, 0Fh
  1506 00000A57 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1507 00000A5D A2[98290000]            	mov	[msgNabmBar+1], al
  1508 00000A62 88D3                    	mov	bl, dl
  1509 00000A64 C0EB04                  	shr	bl, 4
  1510 00000A67 8A83[FD280000]          	mov	al, [hex_chars+ebx]
  1511 00000A6D A2[97290000]            	mov	[msgNabmBar], al
  1512                                  
  1513 00000A72 31C0                    	xor	eax, eax
  1514 00000A74 A0[1B730000]            	mov	al, [ac97_int_ln_reg]
  1515 00000A79 B10A                    	mov	cl, 10
  1516 00000A7B F6F1                    	div	cl
  1517                                  	; 23/11/2024
  1518                                  	;add	[msgIRQ], ax
  1519 00000A7D 66053030                	add	ax, 3030h
  1520 00000A81 66A3[A3290000]          	mov	[msgIRQ], ax
  1521                                  	;and	al, al
  1522 00000A87 3C30                    	cmp	al, 30h
  1523 00000A89 750D                    	jnz	short _w_ac97imsg_
  1524 00000A8B A0[A4290000]            	mov	al, byte [msgIRQ+1]
  1525 00000A90 B420                    	mov	ah, ' '
  1526 00000A92 66A3[A3290000]          	mov	[msgIRQ], ax
  1527                                  _w_ac97imsg_:
  1528                                  	; 19/11/2024
  1529 00000A98 E8671B0000              	call 	clear_window
  1530 00000A9D B60D                    	mov	dh, 13
  1531 00000A9F B200                    	mov	dl, 0
  1532 00000AA1 E88B180000              	call	setCursorPosition
  1533                                  	;;;
  1534                                  	; 21/12/2024
  1535 00000AA6 BD[0E290000]            	mov	ebp, msgAC97Info ; message
  1536                                  	; 22/12/2024
  1537                                  	;mov	cl, 07h ; color 
  1538 00000AAB E81F000000              	call	sys_gmsg
  1539                                  	;
  1540                                  	; 30/05/2024
  1541                                  write_VRA_info:
  1542                                  	; 21/12/2024
  1543 00000AB0 BD[A8290000]            	mov	ebp, msgVRAheader ; message
  1544                                  	;mov	cl, 07h ; color 
  1545 00000AB5 E815000000              	call	sys_gmsg
  1546                                  	;
  1547 00000ABA 803D[EA720000]00        	cmp	byte [VRA], 0
  1548 00000AC1 7607                    	jna	short _w_VRAi_no
  1549                                  _w_VRAi_yes:
  1550 00000AC3 BD[B7290000]            	mov	ebp, msgVRAyes
  1551 00000AC8 EB05                    	jmp	short _w_VRAi_yn_msg
  1552                                  _w_VRAi_no:
  1553 00000ACA BD[BD290000]            	mov	ebp, msgVRAno
  1554                                  _w_VRAi_yn_msg:
  1555                                  	;mov	cl, 07h ; color 
  1556                                  	;call	sys_msg
  1557                                  	;retn
  1558                                  	;jmp	short sys_gmsg
  1559                                  	;;;
  1560                                  ; --------------------------------------------------------
  1561                                  
  1562                                  	; 22/12/2024
  1563                                  	;;;
  1564                                  	; 21/12/2024
  1565                                  	; (write message in VGA/VESA-VBE mode)
  1566                                  sys_gmsg:
  1567 00000ACF 8A4500                  	mov	al, [ebp]
  1568 00000AD2 20C0                    	and	al, al
  1569 00000AD4 7458                    	jz	short sys_gmsg_ok
  1570 00000AD6 3C20                    	cmp	al, 20h
  1571 00000AD8 731E                    	jnb	short sys_gmsg_3
  1572 00000ADA 3C0D                    	cmp	al, CR ; 13
  1573 00000ADC 750C                    	jne	short sys_gmsg_2
  1574                                  	; carriege return, move cursor to column 0
  1575 00000ADE 66C705[D0720000]00-     	mov	word [screenpos], 0
  1575 00000AE6 00                 
  1576                                  sys_gmsg_1:
  1577 00000AE7 45                      	inc	ebp
  1578 00000AE8 EBE5                    	jmp	short sys_gmsg
  1579                                  sys_gmsg_2:
  1580 00000AEA 3C0A                    	cmp	al, LF ; 10
  1581 00000AEC 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1582                                  	; line feed, move cursor to next row
  1583 00000AEE 668305[D2720000]10      	add	word [screenpos+2], 16
  1584 00000AF6 EBEF                    	jmp	short sys_gmsg_1
  1585                                  sys_gmsg_3:
  1586 00000AF8 8B35[D0720000]          	mov	esi, [screenpos]
  1587                                  		; hw = (cursor) row
  1588                                  		; si = (cursor) column
  1589 00000AFE B907000000              	mov	ecx, 07h ; gray (light)
  1590 00000B03 E8D0190000              	call	write_character
  1591 00000B08 83C608                  	add	esi, 8
  1592                                  	;;;
  1593 00000B0B 6681FE8002              	cmp	si, 640
  1594 00000B10 7213                    	jb	short sys_gmsg_5
  1595 00000B12 C1EE10                  	shr	esi, 16
  1596 00000B15 6683C610                	add	si, 16
  1597 00000B19 6681FEE001              	cmp	si, 480
  1598 00000B1E 7202                    	jb	short sys_gmsg_4
  1599 00000B20 31F6                    	xor	esi, esi
  1600                                  sys_gmsg_4:
  1601 00000B22 C1E610                  	shl	esi, 16
  1602                                  	;;;
  1603                                  sys_gmsg_5:
  1604 00000B25 8935[D0720000]          	mov	[screenpos], esi
  1605 00000B2B 45                      	inc	ebp
  1606 00000B2C EBA1                    	jmp	short sys_gmsg
  1607                                  sys_gmsg_ok:
  1608 00000B2E C3                      	retn
  1609                                  	;;;
  1610                                  
  1611                                  ; --------------------------------------------------------
  1612                                  
  1613                                  ; 07/12/2024 - playwav9.s
  1614                                  ; 01/12/2024 - ac97play.s
  1615                                  ; 29/05/2024
  1616                                  ; 26/11/2023
  1617                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1618                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1619                                  ; 14/11/2023
  1620                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1621                                  ; --------------------------------------------------------
  1622                                  
  1623                                  ;;Note:	At the end of every buffer load,
  1624                                  ;;	during buffer switch/swap, there will be discontinuity
  1625                                  ;;	between the last converted sample and the 1st sample
  1626                                  ;;	of the next buffer.
  1627                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1628                                  ;;	-To avoid this defect, the 1st sample of
  1629                                  ;;	the next buffer may be read from the wav file but
  1630                                  ;;	the file pointer would need to be set to 1 sample back
  1631                                  ;;	again via seek system call. Time comsumption problem! -
  1632                                  ;;
  1633                                  ;;	Erdogan Tan - 15/11/2023
  1634                                  ;;
  1635                                  ;;	((If entire wav data would be loaded at once.. conversion
  1636                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1637                                  ;;	64KB buffer limit is important also it is important
  1638                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1639                                  ;;	I have tested this program by using 2-30MB wav files.))
  1640                                  ;;
  1641                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1642                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1643                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1644                                  ;;			Realtek ALC850 codec.
  1645                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1646                                  
  1647                                  load_8khz_mono_8_bit:
  1648                                  	; 15/11/2023
  1649                                  	; 14/11/2023
  1650                                  	; 13/11/2023
  1651 00000B2F F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1652                                  					; last of the file?
  1653 00000B36 7402                    	jz	short lff8m_0		; no
  1654 00000B38 F9                      	stc
  1655 00000B39 C3                      	retn
  1656                                  
  1657                                  lff8m_0:
  1658                                  	; 01/12/2024
  1659                                  	; edi = audio buffer address
  1660 00000B3A BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1661                                          ;mov	edx, [loadsize]
  1662                                  
  1663                                  	; esi = buffer address
  1664                                  	;; edx = buffer size
  1665                                  
  1666                                  	; load file into memory
  1667                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000B3F 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000B45 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000B47 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000B4D B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000B52 CD40                <1>  int 40h
  1668 00000B54 7305                    	jnc	short lff8m_6
  1669 00000B56 E9AF000000              	jmp	lff8m_5  ; error !
  1670                                  
  1671                                  lff8m_6:
  1672                                  	; 01/12/2024
  1673 00000B5B A3[94730000]            	mov	[count], eax
  1674                                  	;;;
  1675                                  	; 07/12/2024
  1676                                  	;mov	edi, audio_buffer
  1677                                  	;;;
  1678 00000B60 21C0                    	and	eax, eax
  1679 00000B62 0F8499000000            	jz	lff8_eof
  1680                                  
  1681 00000B68 89C1                    	mov	ecx, eax		; byte count
  1682                                  lff8m_1:
  1683 00000B6A AC                      	lodsb
  1684 00000B6B A2[78210000]            	mov	[previous_val], al
  1685 00000B70 2C80                    	sub	al, 80h
  1686 00000B72 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1687 00000B76 66AB                    	stosw		; original sample (left channel)
  1688 00000B78 66AB                    	stosw		; original sample (right channel)
  1689                                  	;xor	eax, eax
  1690 00000B7A B080                    	mov	al, 80h
  1691 00000B7C 49                      	dec	ecx
  1692 00000B7D 7402                    	jz	short lff8m_2
  1693 00000B7F 8A06                    	mov	al, [esi]
  1694                                  lff8m_2:
  1695                                  	;mov	[next_val], ax
  1696 00000B81 88C7                    	mov	bh, al	; [next_val]
  1697 00000B83 8A25[78210000]          	mov	ah, [previous_val]
  1698 00000B89 00E0                    	add	al, ah	; [previous_val]
  1699 00000B8B D0D8                    	rcr	al, 1
  1700 00000B8D 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1701 00000B8F 00E0                    	add	al, ah	; [previous_val]
  1702 00000B91 D0D8                    	rcr	al, 1	
  1703 00000B93 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1704 00000B95 00E0                    	add	al, ah	; [previous_val]
  1705 00000B97 D0D8                    	rcr	al, 1
  1706 00000B99 2C80                    	sub	al, 80h
  1707 00000B9B 66C1E008                	shl	ax, 8	
  1708 00000B9F 66AB                    	stosw		; this is 1st interpolated sample (L)
  1709 00000BA1 66AB                    	stosw		; this is 1st interpolated sample (R)
  1710 00000BA3 88D8                    	mov	al, bl
  1711 00000BA5 00D0                    	add	al, dl
  1712 00000BA7 D0D8                    	rcr	al, 1
  1713 00000BA9 2C80                    	sub	al, 80h
  1714 00000BAB 66C1E008                	shl	ax, 8
  1715 00000BAF 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1716 00000BB1 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1717 00000BB3 88D0                    	mov	al, dl
  1718 00000BB5 2C80                    	sub	al, 80h
  1719 00000BB7 66C1E008                	shl	ax, 8
  1720 00000BBB 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1721 00000BBD 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1722                                  	;mov	al, [next_val]
  1723 00000BBF 88F8                    	mov	al, bh
  1724 00000BC1 00D0                    	add	al, dl
  1725 00000BC3 D0D8                    	rcr	al, 1
  1726 00000BC5 88C3                    	mov	bl, al	; this is temporary interpolation value
  1727 00000BC7 00D0                    	add	al, dl
  1728 00000BC9 D0D8                    	rcr	al, 1
  1729 00000BCB 2C80                    	sub	al, 80h
  1730 00000BCD 66C1E008                	shl	ax, 8
  1731 00000BD1 66AB                    	stosw		; this is 4th interpolated sample (L)
  1732 00000BD3 66AB                    	stosw		; this is 4th interpolated sample (R)
  1733                                  	;mov	al, [next_val]
  1734 00000BD5 88F8                    	mov	al, bh
  1735 00000BD7 00D8                    	add	al, bl
  1736 00000BD9 D0D8                    	rcr	al, 1
  1737 00000BDB 2C80                    	sub	al, 80h
  1738 00000BDD 66C1E008                	shl	ax, 8
  1739 00000BE1 66AB                    	stosw		; this is 5th interpolated sample (L)
  1740 00000BE3 66AB                    	stosw		; this is 5th interpolated sample (R)
  1741                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1742 00000BE5 09C9                    	or	ecx, ecx
  1743 00000BE7 7581                    	jnz	short lff8m_1
  1744                                  
  1745                                  	; --------------
  1746                                  
  1747                                  lff8s_3:
  1748                                  lff8m_3:
  1749                                  lff8s2_3:
  1750                                  lff8m2_3:
  1751                                  lff16s_3:
  1752                                  lff16m_3:
  1753                                  lff16s2_3:
  1754                                  lff16m2_3:
  1755                                  lff24_3:
  1756                                  lff32_3:
  1757                                  lff44_3:
  1758                                  lff22_3:
  1759                                  lff11_3:
  1760                                  	; 08/12/2024 (BugFix)
  1761                                  	; 31/05/2024 (BugFix)
  1762 00000BE9 8B0D[88730000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  1763                                  	;shl	ecx, 1	; byte count ; Bug !
  1764                                  	; 08/12/2024
  1765 00000BEF 81C1[00800000]          	add	ecx, audio_buffer
  1766 00000BF5 29F9                    	sub	ecx, edi
  1767 00000BF7 7607                    	jna	short lff8m_4
  1768                                  	;inc	ecx
  1769 00000BF9 C1E902                  	shr	ecx, 2
  1770 00000BFC 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  1771 00000BFE F3AB                    	rep	stosd
  1772                                  lff8m_4:
  1773                                  	; 31/05/2024 (BugFix)
  1774                                  	; cf=1 ; Bug !
  1775                                  	; 08/12/2024
  1776                                  	;clc
  1777 00000C00 C3                      	retn
  1778                                  
  1779                                  lff8_eof:
  1780                                  lff16_eof:
  1781                                  lff24_eof:
  1782                                  lff32_eof:
  1783                                  lff44_eof:
  1784                                  lff22_eof:
  1785                                  lff11_eof:
  1786                                  	; 15/11/2023
  1787 00000C01 C605[1A730000]01        	mov	byte [flags], ENDOFFILE
  1788 00000C08 EBDF                    	jmp	short lff8m_3
  1789                                  
  1790                                  lff8s_5:
  1791                                  lff8m_5:
  1792                                  lff8s2_5:
  1793                                  lff8m2_5:
  1794                                  lff16s_5:
  1795                                  lff16m_5:
  1796                                  lff16s2_5:
  1797                                  lff16m2_5:
  1798                                  lff24_5:
  1799                                  lff32_5:
  1800                                  lff44_5:
  1801                                  lff22_5:
  1802                                  lff11_5:
  1803 00000C0A B021                    	mov	al, '!'  ; error
  1804 00000C0C E8D3FAFFFF              	call	tL0
  1805                                  	
  1806                                  	;jmp	short lff8m_3
  1807                                  	; 15/11/2023
  1808 00000C11 EBEE                    	jmp	lff8_eof
  1809                                  
  1810                                  	; --------------
  1811                                  
  1812                                  load_8khz_stereo_8_bit:
  1813                                  	; 15/11/2023
  1814                                  	; 14/11/2023
  1815                                  	; 13/11/2023
  1816 00000C13 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1817                                  					; last of the file?
  1818 00000C1A 7402                    	jz	short lff8s_0		; no
  1819 00000C1C F9                      	stc
  1820 00000C1D C3                      	retn
  1821                                  
  1822                                  lff8s_0:
  1823                                  	; 01/12/2024
  1824                                  	; edi = audio buffer address
  1825 00000C1E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1826                                          ;mov	edx, [loadsize]
  1827                                  
  1828                                  	; esi = buffer address
  1829                                  	;; edx = buffer size
  1830                                  
  1831                                  	; load file into memory
  1832                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000C23 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000C29 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000C2B 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000C31 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000C36 CD40                <1>  int 40h
  1833 00000C38 72D0                    	jc	short lff8s_5 ; error !
  1834                                  
  1835                                  	; 01/12/2024
  1836 00000C3A A3[94730000]            	mov	[count], eax
  1837                                  	;;;
  1838                                  	; 07/12/2024
  1839                                  	;mov	edi, audio_buffer
  1840                                  	;;;
  1841 00000C3F D1E8                    	shr	eax, 1
  1842 00000C41 74BE                    	jz	short lff8_eof
  1843                                  
  1844 00000C43 89C1                    	mov	ecx, eax	; word count
  1845                                  lff8s_1:
  1846 00000C45 AC                      	lodsb
  1847 00000C46 A2[78210000]            	mov	[previous_val_l], al
  1848 00000C4B 2C80                    	sub	al, 80h
  1849 00000C4D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1850 00000C51 66AB                    	stosw		; original sample (L)
  1851 00000C53 AC                      	lodsb
  1852 00000C54 A2[7A210000]            	mov	[previous_val_r], al
  1853 00000C59 2C80                    	sub	al, 80h
  1854 00000C5B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1855 00000C5F 66AB                    	stosw		; original sample (R)
  1856                                  
  1857                                  	;xor	eax, eax
  1858 00000C61 66B88080                	mov	ax, 8080h
  1859 00000C65 49                      	dec	ecx
  1860 00000C66 7403                    	jz	short lff8s_2
  1861                                  		; convert 8 bit sample to 16 bit sample
  1862 00000C68 668B06                  	mov	ax, [esi]
  1863                                  lff8s_2:
  1864 00000C6B A2[7C210000]            	mov	[next_val_l], al
  1865 00000C70 8825[7E210000]          	mov	[next_val_r], ah
  1866 00000C76 8A25[78210000]          	mov	ah, [previous_val_l]
  1867 00000C7C 00E0                    	add	al, ah
  1868 00000C7E D0D8                    	rcr	al, 1
  1869 00000C80 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  1870 00000C82 00E0                    	add	al, ah
  1871 00000C84 D0D8                    	rcr	al, 1
  1872 00000C86 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1873 00000C88 00E0                    	add	al, ah
  1874 00000C8A D0D8                    	rcr	al, 1
  1875 00000C8C 2C80                    	sub	al, 80h
  1876 00000C8E 66C1E008                	shl	ax, 8
  1877 00000C92 66AB                    	stosw		; this is 1st interpolated sample (L)
  1878 00000C94 A0[7E210000]            	mov	al, [next_val_r]
  1879 00000C99 8A25[7A210000]          	mov	ah, [previous_val_r]
  1880 00000C9F 00E0                    	add	al, ah
  1881 00000CA1 D0D8                    	rcr	al, 1
  1882 00000CA3 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  1883 00000CA5 00E0                    	add	al, ah
  1884 00000CA7 D0D8                    	rcr	al, 1
  1885 00000CA9 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1886 00000CAB 00E0                    	add	al, ah
  1887 00000CAD D0D8                    	rcr	al, 1
  1888 00000CAF 2C80                    	sub	al, 80h
  1889 00000CB1 66C1E008                	shl	ax, 8
  1890 00000CB5 66AB                    	stosw		; this is 1st interpolated sample (R)
  1891 00000CB7 88D8                    	mov	al, bl
  1892 00000CB9 00D0                    	add	al, dl
  1893 00000CBB D0D8                    	rcr	al, 1
  1894 00000CBD 2C80                    	sub	al, 80h
  1895 00000CBF 66C1E008                	shl	ax, 8
  1896 00000CC3 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1897 00000CC5 88F8                    	mov	al, bh
  1898 00000CC7 00F0                    	add	al, dh
  1899 00000CC9 D0D8                    	rcr	al, 1
  1900 00000CCB 2C80                    	sub	al, 80h
  1901 00000CCD 66C1E008                	shl	ax, 8
  1902 00000CD1 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1903 00000CD3 88D0                    	mov	al, dl
  1904 00000CD5 2C80                    	sub	al, 80h
  1905 00000CD7 66C1E008                	shl	ax, 8
  1906 00000CDB 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1907 00000CDD 88F0                    	mov	al, dh
  1908 00000CDF 2C80                    	sub	al, 80h
  1909 00000CE1 66C1E008                	shl	ax, 8
  1910 00000CE5 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1911 00000CE7 A0[7C210000]            	mov	al, [next_val_l]
  1912 00000CEC 00D0                    	add	al, dl
  1913 00000CEE D0D8                    	rcr	al, 1
  1914 00000CF0 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1915 00000CF2 00D0                    	add	al, dl
  1916 00000CF4 D0D8                    	rcr	al, 1
  1917 00000CF6 2C80                    	sub	al, 80h
  1918 00000CF8 66C1E008                	shl	ax, 8
  1919 00000CFC 66AB                    	stosw		; this is 4th interpolated sample (L)
  1920 00000CFE A0[7E210000]            	mov	al, [next_val_r]
  1921 00000D03 00F0                    	add	al, dh
  1922 00000D05 D0D8                    	rcr	al, 1
  1923 00000D07 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1924 00000D09 00F0                    	add	al, dh
  1925 00000D0B D0D8                    	rcr	al, 1
  1926 00000D0D 2C80                    	sub	al, 80h
  1927 00000D0F 66C1E008                	shl	ax, 8
  1928 00000D13 66AB                    	stosw		; this is 4th interpolated sample (R)
  1929 00000D15 A0[7C210000]            	mov	al, [next_val_l]
  1930 00000D1A 00D8                    	add	al, bl
  1931 00000D1C D0D8                    	rcr	al, 1
  1932 00000D1E 2C80                    	sub	al, 80h
  1933 00000D20 66C1E008                	shl	ax, 8
  1934 00000D24 66AB                    	stosw		; this is 5th interpolated sample (L)
  1935 00000D26 A0[7E210000]            	mov	al, [next_val_r]
  1936 00000D2B 00F8                    	add	al, bh
  1937 00000D2D D0D8                    	rcr	al, 1
  1938 00000D2F 2C80                    	sub	al, 80h
  1939 00000D31 66C1E008                	shl	ax, 8
  1940 00000D35 66AB                    	stosw		; this is 5th interpolated sample (R)
  1941                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1942 00000D37 E305                    	jecxz	lff8s_6
  1943 00000D39 E907FFFFFF              	jmp	lff8s_1
  1944                                  lff8s_6:
  1945 00000D3E E9A6FEFFFF              	jmp	lff8s_3
  1946                                  
  1947                                  load_8khz_mono_16_bit:
  1948                                  	; 13/11/2023
  1949 00000D43 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1950                                  					; last of the file?
  1951 00000D4A 7402                    	jz	short lff8m2_0		; no
  1952 00000D4C F9                      	stc
  1953 00000D4D C3                      	retn
  1954                                  
  1955                                  lff8m2_0:
  1956                                  	; 01/12/2024
  1957                                  	; edi = audio buffer address
  1958 00000D4E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1959                                          ;mov	edx, [loadsize]
  1960                                  
  1961                                  	; esi = buffer address
  1962                                  	;; edx = buffer size
  1963                                  
  1964                                  	; load file into memory
  1965                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000D53 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000D59 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000D5B 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000D61 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000D66 CD40                <1>  int 40h
  1966 00000D68 0F82A0000000            	jc	lff8m2_7 ; error !
  1967                                  
  1968                                  	; 01/12/2024
  1969 00000D6E A3[94730000]            	mov	[count], eax
  1970                                  	;;;
  1971                                  	; 07/12/2024
  1972                                  	;mov	edi, audio_buffer
  1973                                  	;;;
  1974 00000D73 D1E8                    	shr	eax, 1
  1975 00000D75 7505                    	jnz	short lff8m2_8
  1976 00000D77 E985FEFFFF              	jmp	lff8_eof
  1977                                  
  1978                                  lff8m2_8:
  1979 00000D7C 89C1                    	mov	ecx, eax	; word count
  1980                                  lff8m2_1:
  1981 00000D7E 66AD                    	lodsw
  1982 00000D80 66AB                    	stosw		; original sample (left channel)
  1983 00000D82 66AB                    	stosw		; original sample (right channel)
  1984 00000D84 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1985 00000D87 66A3[78210000]          	mov	[previous_val], ax
  1986 00000D8D 31C0                    	xor	eax, eax
  1987 00000D8F 49                      	dec	ecx
  1988 00000D90 7403                    	jz	short lff8m2_2
  1989 00000D92 668B06                  	mov	ax, [esi]
  1990                                  lff8m2_2:
  1991 00000D95 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  1992 00000D98 89C5                    	mov	ebp, eax	; [next_val]
  1993 00000D9A 660305[78210000]        	add	ax, [previous_val]
  1994 00000DA1 66D1D8                  	rcr	ax, 1
  1995 00000DA4 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  1996 00000DA6 660305[78210000]        	add	ax, [previous_val]
  1997 00000DAD 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  1998 00000DB0 89C3                    	mov	ebx, eax 		
  1999 00000DB2 660305[78210000]        	add	ax, [previous_val]
  2000 00000DB9 66D1D8                  	rcr	ax, 1
  2001 00000DBC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2002 00000DBF 66AB                    	stosw		; this is 1st interpolated sample (L)
  2003 00000DC1 66AB                    	stosw		; this is 1st interpolated sample (R)
  2004 00000DC3 89D8                    	mov	eax, ebx
  2005 00000DC5 6601D0                  	add	ax, dx
  2006 00000DC8 66D1D8                  	rcr	ax, 1
  2007 00000DCB 80EC80                  	sub	ah, 80h
  2008 00000DCE 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2009 00000DD0 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2010 00000DD2 89D0                    	mov	eax, edx
  2011 00000DD4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2012 00000DD7 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2013 00000DD9 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2014 00000DDB 89E8                    	mov	eax, ebp
  2015 00000DDD 6601D0                  	add	ax, dx
  2016 00000DE0 66D1D8                  	rcr	ax, 1
  2017 00000DE3 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2018 00000DE5 6601D0                  	add	ax, dx
  2019 00000DE8 66D1D8                  	rcr	ax, 1
  2020 00000DEB 80EC80                  	sub	ah, 80h
  2021 00000DEE 66AB                    	stosw		; this is 4th interpolated sample (L)
  2022 00000DF0 66AB                    	stosw		; this is 4th interpolated sample (R)
  2023 00000DF2 89E8                    	mov	eax, ebp
  2024 00000DF4 6601D8                  	add	ax, bx
  2025 00000DF7 66D1D8                  	rcr	ax, 1
  2026 00000DFA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2027 00000DFD 66AB                    	stosw		; this is 5th interpolated sample (L)
  2028 00000DFF 66AB                    	stosw		; this is 5th interpolated sample (R)
  2029                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2030 00000E01 09C9                    	or	ecx, ecx
  2031 00000E03 0F8575FFFFFF            	jnz	lff8m2_1
  2032 00000E09 E9DBFDFFFF              	jmp	lff8m2_3
  2033                                  
  2034                                  lff8m2_7:
  2035                                  lff8s2_7:
  2036 00000E0E E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2037                                  
  2038                                  load_8khz_stereo_16_bit:
  2039                                  	; 16/11/2023
  2040                                  	; 15/11/2023
  2041                                  	; 13/11/2023
  2042 00000E13 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2043                                  					; last of the file?
  2044 00000E1A 7402                    	jz	short lff8s2_0		; no
  2045 00000E1C F9                      	stc
  2046 00000E1D C3                      	retn
  2047                                  
  2048                                  lff8s2_0:
  2049                                  	; 01/12/2024
  2050                                  	; edi = audio buffer address
  2051 00000E1E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2052                                          ;mov	edx, [loadsize]
  2053                                  
  2054                                  	; esi = buffer address
  2055                                  	;; edx = buffer size
  2056                                  
  2057                                  	; load file into memory
  2058                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000E23 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000E29 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000E2B 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000E31 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000E36 CD40                <1>  int 40h
  2059 00000E38 72D4                    	jc	short lff8s2_7 ; error !
  2060                                  
  2061                                  	; 01/12/2024
  2062 00000E3A A3[94730000]            	mov	[count], eax
  2063                                  	;;;
  2064                                  	; 07/12/2024
  2065                                  	;mov	edi, audio_buffer
  2066                                  	;;;
  2067 00000E3F C1E802                  	shr	eax, 2
  2068 00000E42 7505                    	jnz	short lff8s2_8
  2069 00000E44 E9B8FDFFFF              	jmp	lff8_eof
  2070                                  
  2071                                  lff8s2_8:
  2072 00000E49 89C1                    	mov	ecx, eax ; dword count
  2073                                  lff8s2_1:
  2074 00000E4B 66AD                    	lodsw
  2075 00000E4D 66AB                    	stosw		; original sample (L)
  2076                                  	; 15/11/2023
  2077 00000E4F 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2078 00000E52 66A3[78210000]          	mov	[previous_val_l], ax
  2079 00000E58 66AD                    	lodsw
  2080 00000E5A 66AB                    	stosw		; original sample (R)
  2081 00000E5C 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2082 00000E5F 66A3[7A210000]          	mov	[previous_val_r], ax
  2083 00000E65 31D2                    	xor	edx, edx
  2084 00000E67 31C0                    	xor	eax, eax
  2085                                  	; 16/11/2023
  2086 00000E69 49                      	dec	ecx
  2087 00000E6A 7407                    	jz	short lff8s2_2
  2088 00000E6C 668B06                  	mov	ax, [esi]
  2089 00000E6F 668B5602                	mov	dx, [esi+2]
  2090                                  lff8s2_2:
  2091 00000E73 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2092 00000E76 66A3[7C210000]          	mov	[next_val_l], ax
  2093 00000E7C 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2094 00000E7F 668915[7E210000]        	mov	[next_val_r], dx
  2095 00000E86 660305[78210000]        	add	ax, [previous_val_l]
  2096 00000E8D 66D1D8                  	rcr	ax, 1
  2097 00000E90 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2098 00000E92 660305[78210000]        	add	ax, [previous_val_l]
  2099 00000E99 66D1D8                  	rcr	ax, 1	
  2100 00000E9C 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2101 00000E9E 660305[78210000]        	add	ax, [previous_val_l]
  2102 00000EA5 66D1D8                  	rcr	ax, 1
  2103 00000EA8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2104 00000EAB 66AB                    	stosw		; this is 1st interpolated sample (L)
  2105 00000EAD 66A1[7E210000]          	mov	ax, [next_val_r]
  2106 00000EB3 660305[7A210000]        	add	ax, [previous_val_r]
  2107 00000EBA 66D1D8                  	rcr	ax, 1
  2108 00000EBD 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2109 00000EBF 660305[7A210000]        	add	ax, [previous_val_r]
  2110 00000EC6 66D1D8                  	rcr	ax, 1
  2111 00000EC9 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2112 00000ECA 660305[7A210000]        	add	ax, [previous_val_r]
  2113 00000ED1 66D1D8                  	rcr	ax, 1
  2114 00000ED4 80EC80                  	sub	ah, 80h
  2115 00000ED7 66AB                    	stosw		; this is 1st interpolated sample (R)
  2116 00000ED9 89D8                    	mov	eax, ebx
  2117 00000EDB 6601D0                  	add	ax, dx
  2118 00000EDE 66D1D8                  	rcr	ax, 1
  2119 00000EE1 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2120 00000EE4 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2121 00000EE6 58                      	pop	eax ; *
  2122 00000EE7 6601E8                  	add	ax, bp
  2123 00000EEA 66D1D8                  	rcr	ax, 1
  2124 00000EED 80EC80                  	sub	ah, 80h
  2125 00000EF0 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2126 00000EF2 89D0                    	mov	eax, edx
  2127 00000EF4 80EC80                  	sub	ah, 80h
  2128 00000EF7 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2129 00000EF9 89E8                    	mov	eax, ebp
  2130 00000EFB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2131 00000EFE 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2132 00000F00 66A1[7C210000]          	mov	ax, [next_val_l]
  2133 00000F06 6601D0                  	add	ax, dx
  2134 00000F09 66D1D8                  	rcr	ax, 1
  2135 00000F0C 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2136 00000F0E 6601D0                  	add	ax, dx
  2137 00000F11 66D1D8                  	rcr	ax, 1
  2138 00000F14 80EC80                  	sub	ah, 80h
  2139 00000F17 66AB                    	stosw		; this is 4th interpolated sample (L)
  2140 00000F19 66A1[7E210000]          	mov	ax, [next_val_r]
  2141 00000F1F 6601E8                  	add	ax, bp
  2142 00000F22 66D1D8                  	rcr	ax, 1
  2143 00000F25 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2144 00000F26 6601E8                  	add	ax, bp
  2145 00000F29 66D1D8                  	rcr	ax, 1
  2146 00000F2C 80EC80                  	sub	ah, 80h
  2147 00000F2F 66AB                    	stosw		; this is 4th interpolated sample (R)
  2148 00000F31 66A1[7C210000]          	mov	ax, [next_val_l]
  2149 00000F37 6601D8                  	add	ax, bx
  2150 00000F3A 66D1D8                  	rcr	ax, 1
  2151 00000F3D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2152 00000F40 66AB                    	stosw		; this is 5th interpolated sample (L)
  2153 00000F42 58                      	pop	eax ; **
  2154 00000F43 660305[7E210000]        	add	ax, [next_val_r]
  2155 00000F4A 66D1D8                  	rcr	ax, 1
  2156 00000F4D 80EC80                  	sub	ah, 80h
  2157 00000F50 66AB                    	stosw		; this is 5th interpolated sample (R)
  2158                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2159 00000F52 E305                    	jecxz	lff8_s2_9
  2160 00000F54 E9F2FEFFFF              	jmp	lff8s2_1
  2161                                  lff8_s2_9:
  2162 00000F59 E98BFCFFFF              	jmp	lff8s2_3
  2163                                  
  2164                                  ; .....................
  2165                                  
  2166                                  load_16khz_mono_8_bit:
  2167                                  	; 14/11/2023
  2168                                  	; 13/11/2023
  2169 00000F5E F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2170                                  					; last of the file?
  2171 00000F65 7402                    	jz	short lff16m_0		; no
  2172 00000F67 F9                      	stc
  2173 00000F68 C3                      	retn
  2174                                  
  2175                                  lff16m_0:
  2176                                  	; 01/12/2024
  2177                                  	; edi = audio buffer address
  2178 00000F69 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2179                                          ;mov	edx, [loadsize]
  2180                                  
  2181                                  	; esi = buffer address
  2182                                  	;; edx = buffer size
  2183                                  
  2184                                  	; load file into memory
  2185                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000F6E 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000F74 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000F76 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000F7C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000F81 CD40                <1>  int 40h
  2186 00000F83 7253                    	jc	short lff16m_7 ; error !
  2187                                  
  2188                                  	; 01/12/2024
  2189 00000F85 A3[94730000]            	mov	[count], eax
  2190                                  	;;;
  2191                                  	; 07/12/2024
  2192                                  	;mov	edi, audio_buffer
  2193                                  	;;;
  2194 00000F8A 21C0                    	and	eax, eax
  2195 00000F8C 7505                    	jnz	short lff16m_8
  2196 00000F8E E96EFCFFFF              	jmp	lff16_eof
  2197                                  
  2198                                  lff16m_8:
  2199 00000F93 89C1                    	mov	ecx, eax		; byte count
  2200                                  lff16m_1:
  2201 00000F95 AC                      	lodsb
  2202                                  	;mov	[previous_val], al
  2203 00000F96 88C3                    	mov	bl, al
  2204 00000F98 2C80                    	sub	al, 80h
  2205 00000F9A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2206 00000F9E 66AB                    	stosw		; original sample (left channel)
  2207 00000FA0 66AB                    	stosw		; original sample (right channel)
  2208                                  	;xor	ax, ax
  2209                                  	; 14/11/22023
  2210 00000FA2 B080                    	mov	al, 80h
  2211 00000FA4 49                      	dec	ecx
  2212 00000FA5 7402                    	jz	short lff16m_2
  2213 00000FA7 8A06                    	mov	al, [esi]
  2214                                  lff16m_2:
  2215                                  	;mov	[next_val], al
  2216 00000FA9 88C7                    	mov	bh, al
  2217                                  	;add	al, [previous_val]
  2218 00000FAB 00D8                    	add	al, bl
  2219 00000FAD D0D8                    	rcr	al, 1
  2220 00000FAF 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2221                                  	;add	al, [previous_val]
  2222 00000FB1 00D8                    	add	al, bl
  2223 00000FB3 D0D8                    	rcr	al, 1
  2224 00000FB5 2C80                    	sub	al, 80h
  2225 00000FB7 66C1E008                	shl	ax, 8
  2226 00000FBB 66AB                    	stosw		; this is 1st interpolated sample (L)
  2227 00000FBD 66AB                    	stosw		; this is 1st interpolated sample (R)
  2228                                  	;mov	al, [next_val]
  2229 00000FBF 88F8                    	mov	al, bh
  2230 00000FC1 00D0                    	add	al, dl
  2231 00000FC3 D0D8                    	rcr	al, 1
  2232 00000FC5 2C80                    	sub	al, 80h
  2233 00000FC7 66C1E008                	shl	ax, 8
  2234 00000FCB 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2235 00000FCD 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2236                                  	
  2237                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2238 00000FCF 09C9                    	or	ecx, ecx
  2239 00000FD1 75C2                    	jnz	short lff16m_1
  2240 00000FD3 E911FCFFFF              	jmp	lff16m_3
  2241                                  
  2242                                  lff16m_7:
  2243                                  lff16s_7:
  2244 00000FD8 E92DFCFFFF              	jmp	lff16m_5  ; error
  2245                                  
  2246                                  load_16khz_stereo_8_bit:
  2247                                  	; 14/11/2023
  2248                                  	; 13/11/2023
  2249 00000FDD F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2250                                  					; last of the file?
  2251 00000FE4 7402                    	jz	short lff16s_0		; no
  2252 00000FE6 F9                      	stc
  2253 00000FE7 C3                      	retn
  2254                                  
  2255                                  lff16s_0:
  2256                                  	; 01/12/2024
  2257                                  	; edi = audio buffer address
  2258 00000FE8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2259                                          ;mov	edx, [loadsize]
  2260                                  
  2261                                  	; esi = buffer address
  2262                                  	;; edx = buffer size
  2263                                  
  2264                                  	; load file into memory
  2265                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000FED 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000FF3 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000FF5 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000FFB B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001000 CD40                <1>  int 40h
  2266 00001002 72D4                    	jc	short lff16s_7 ; error !
  2267                                  
  2268                                  	; 01/12/2024
  2269 00001004 A3[94730000]            	mov	[count], eax
  2270                                  	;;;
  2271                                  	; 07/12/2024
  2272                                  	;mov	edi, audio_buffer
  2273                                  	;;;
  2274 00001009 D1E8                    	shr	eax, 1
  2275 0000100B 7505                    	jnz	short lff16s_8
  2276 0000100D E9EFFBFFFF              	jmp	lff16_eof
  2277                                  
  2278                                  lff16s_8:
  2279 00001012 89C1                    	mov	ecx, eax	; word count
  2280                                  lff16s_1:
  2281 00001014 AC                      	lodsb
  2282 00001015 A2[78210000]            	mov	[previous_val_l], al
  2283 0000101A 2C80                    	sub	al, 80h
  2284 0000101C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2285 00001020 66AB                    	stosw		; original sample (L)
  2286 00001022 AC                      	lodsb
  2287 00001023 A2[7A210000]            	mov	[previous_val_r], al
  2288 00001028 2C80                    	sub	al, 80h
  2289 0000102A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2290 0000102E 66AB                    	stosw		; original sample (R)
  2291                                  
  2292                                  	;xor	eax, eax
  2293 00001030 66B88080                	mov	ax, 8080h
  2294 00001034 49                      	dec	ecx
  2295 00001035 7403                    	jz	short lff16s_2
  2296                                  		; convert 8 bit sample to 16 bit sample
  2297 00001037 668B06                  	mov	ax, [esi]
  2298                                  lff16s_2:
  2299                                  	;mov	[next_val_l], al
  2300                                  	;mov	[next_val_r], ah
  2301 0000103A 89C3                    	mov	ebx, eax
  2302 0000103C 0205[78210000]          	add	al, [previous_val_l]
  2303 00001042 D0D8                    	rcr	al, 1
  2304 00001044 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2305 00001046 0205[78210000]          	add	al, [previous_val_l]
  2306 0000104C D0D8                    	rcr	al, 1
  2307 0000104E 2C80                    	sub	al, 80h
  2308 00001050 66C1E008                	shl	ax, 8
  2309 00001054 66AB                    	stosw		; this is 1st interpolated sample (L)
  2310 00001056 88F8                    	mov	al, bh	; [next_val_r]
  2311 00001058 0205[7A210000]          	add	al, [previous_val_r]
  2312 0000105E D0D8                    	rcr	al, 1
  2313 00001060 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2314 00001062 0205[7A210000]          	add	al, [previous_val_r]
  2315 00001068 D0D8                    	rcr	al, 1
  2316 0000106A 2C80                    	sub	al, 80h
  2317 0000106C 66C1E008                	shl	ax, 8
  2318 00001070 66AB                    	stosw		; this is 1st interpolated sample (R)
  2319 00001072 88D0                    	mov	al, dl
  2320 00001074 00D8                    	add	al, bl	; [next_val_l]
  2321 00001076 D0D8                    	rcr	al, 1
  2322 00001078 2C80                    	sub	al, 80h
  2323 0000107A 66C1E008                	shl	ax, 8
  2324 0000107E 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2325 00001080 88F0                    	mov	al, dh
  2326 00001082 00F8                    	add	al, bh	; [next_val_r]
  2327 00001084 D0D8                    	rcr	al, 1
  2328 00001086 2C80                    	sub	al, 80h
  2329 00001088 66C1E008                	shl	ax, 8
  2330 0000108C 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2331                                  	
  2332                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2333 0000108E 09C9                    	or	ecx, ecx
  2334 00001090 7582                    	jnz	short lff16s_1
  2335 00001092 E952FBFFFF              	jmp	lff16s_3
  2336                                  
  2337                                  load_16khz_mono_16_bit:
  2338                                  	; 15/11/2023
  2339                                  	; 13/11/2023
  2340 00001097 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2341                                  					; last of the file?
  2342 0000109E 7402                    	jz	short lff16m2_0		; no
  2343 000010A0 F9                      	stc
  2344 000010A1 C3                      	retn
  2345                                  
  2346                                  lff16m2_0:
  2347                                  	; 01/12/2024
  2348                                  	; edi = audio buffer address
  2349 000010A2 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2350                                          ;mov	edx, [loadsize]
  2351                                  
  2352                                  	; esi = buffer address
  2353                                  	;; edx = buffer size
  2354                                  
  2355                                  	; load file into memory
  2356                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000010A7 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000010AD 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000010AF 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000010B5 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000010BA CD40                <1>  int 40h
  2357 000010BC 7255                    	jc	short lff16m2_7 ; error !
  2358                                  
  2359                                  	; 01/12/2024
  2360 000010BE A3[94730000]            	mov	[count], eax
  2361                                  	;;;
  2362                                  	; 07/12/2024
  2363                                  	;mov	edi, audio_buffer
  2364                                  	;;;
  2365 000010C3 D1E8                    	shr	eax, 1
  2366 000010C5 7505                    	jnz	short lff16m2_8
  2367 000010C7 E935FBFFFF              	jmp	lff16_eof
  2368                                  
  2369                                  lff16m2_8:
  2370 000010CC 89C1                    	mov	ecx, eax  ; word count
  2371                                  lff16m2_1:
  2372 000010CE 66AD                    	lodsw
  2373 000010D0 66AB                    	stosw		; original sample (left channel)
  2374 000010D2 66AB                    	stosw		; original sample (right channel)
  2375 000010D4 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2376                                  	;mov	[previous_val], ax
  2377 000010D7 89C3                    	mov	ebx, eax
  2378 000010D9 31C0                    	xor	eax, eax
  2379 000010DB 49                      	dec	ecx
  2380 000010DC 7403                    	jz	short lff16m2_2
  2381 000010DE 668B06                  	mov	ax, [esi]
  2382                                  lff16m2_2:
  2383 000010E1 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2384 000010E4 89C5                    	mov	ebp, eax	; [next_val]
  2385                                  	;add	ax, [previous_val]
  2386 000010E6 6601D8                  	add	ax, bx
  2387 000010E9 66D1D8                  	rcr	ax, 1
  2388 000010EC 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2389                                  	;add	ax, [previous_val]
  2390 000010EE 6601D8                  	add	ax, bx
  2391 000010F1 66D1D8                  	rcr	ax, 1
  2392 000010F4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2393 000010F7 66AB                    	stosw		; this is 1st interpolated sample (L)
  2394 000010F9 66AB                    	stosw		; this is 1st interpolated sample (R)
  2395 000010FB 89E8                    	mov	eax, ebp
  2396 000010FD 6601D0                  	add	ax, dx
  2397 00001100 66D1D8                  	rcr	ax, 1
  2398 00001103 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2399 00001106 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2400 00001108 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2401                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2402 0000110A 09C9                    	or	ecx, ecx
  2403 0000110C 75C0                    	jnz	short lff16m2_1
  2404 0000110E E9D6FAFFFF              	jmp	lff16m2_3
  2405                                  
  2406                                  lff16m2_7:
  2407                                  lff16s2_7:
  2408 00001113 E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2409                                  
  2410                                  load_16khz_stereo_16_bit:
  2411                                  	; 16/11/2023
  2412                                  	; 15/11/2023
  2413                                  	; 13/11/2023
  2414 00001118 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2415                                  					; last of the file?
  2416 0000111F 7402                    	jz	short lff16s2_0		; no
  2417 00001121 F9                      	stc
  2418 00001122 C3                      	retn
  2419                                  
  2420                                  lff16s2_0:
  2421                                  	; 01/12/2024
  2422                                  	; edi = audio buffer address
  2423 00001123 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2424                                          ;mov	edx, [loadsize]
  2425                                  
  2426                                  	; esi = buffer address
  2427                                  	;; edx = buffer size
  2428                                  
  2429                                  	; load file into memory
  2430                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001128 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000112E 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001130 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001136 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000113B CD40                <1>  int 40h
  2431 0000113D 72D4                    	jc	short lff16s2_7 ; error !
  2432                                  
  2433                                  	; 01/12/2024
  2434 0000113F A3[94730000]            	mov	[count], eax
  2435                                  	;;;
  2436                                  	; 07/12/2024
  2437                                  	;mov	edi, audio_buffer
  2438                                  	;;;
  2439 00001144 C1E802                  	shr	eax, 2
  2440 00001147 7505                    	jnz	short lff16s2_8
  2441 00001149 E9B3FAFFFF              	jmp	lff16_eof
  2442                                  
  2443                                  lff16s2_8:
  2444 0000114E 89C1                    	mov	ecx, eax  ; dword count
  2445                                  lff16s2_1:
  2446 00001150 66AD                    	lodsw
  2447 00001152 66AB                    	stosw		; original sample (L)
  2448 00001154 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2449 00001157 66A3[78210000]          	mov	[previous_val_l], ax
  2450 0000115D 66AD                    	lodsw
  2451 0000115F 66AB                    	stosw		; original sample (R)
  2452 00001161 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2453 00001164 66A3[7A210000]          	mov	[previous_val_r], ax
  2454 0000116A 31D2                    	xor	edx, edx
  2455 0000116C 31C0                    	xor	eax, eax
  2456                                  	; 16/11/2023
  2457 0000116E 49                      	dec	ecx
  2458 0000116F 7407                    	jz	short lff16s2_2
  2459 00001171 668B06                  	mov	ax, [esi]
  2460 00001174 668B5602                	mov	dx, [esi+2]
  2461                                  lff16s2_2:
  2462 00001178 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2463                                  	;mov	[next_val_l], ax
  2464 0000117B 89C5                    	mov	ebp, eax
  2465 0000117D 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2466 00001180 668915[7E210000]        	mov	[next_val_r], dx
  2467 00001187 660305[78210000]        	add	ax, [previous_val_l]
  2468 0000118E 66D1D8                  	rcr	ax, 1
  2469 00001191 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2470 00001193 660305[78210000]        	add	ax, [previous_val_l]
  2471 0000119A 66D1D8                  	rcr	ax, 1
  2472 0000119D 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2473 000011A0 66AB                    	stosw		; this is 1st interpolated sample (L)
  2474 000011A2 66A1[7E210000]          	mov	ax, [next_val_r]
  2475 000011A8 660305[7A210000]        	add	ax, [previous_val_r]
  2476 000011AF 66D1D8                  	rcr	ax, 1
  2477 000011B2 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2478 000011B4 660305[7A210000]        	add	ax, [previous_val_r]
  2479 000011BB 66D1D8                  	rcr	ax, 1
  2480 000011BE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2481 000011C1 66AB                    	stosw		; this is 1st interpolated sample (R)
  2482                                  	;mov	ax, [next_val_l]
  2483 000011C3 89E8                    	mov	eax, ebp
  2484 000011C5 6601D0                  	add	ax, dx
  2485 000011C8 66D1D8                  	rcr	ax, 1
  2486 000011CB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2487 000011CE 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2488 000011D0 66A1[7E210000]          	mov	ax, [next_val_r]
  2489 000011D6 6601D8                  	add	ax, bx
  2490 000011D9 66D1D8                  	rcr	ax, 1
  2491 000011DC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2492 000011DF 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2493                                  	
  2494                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2495 000011E1 09C9                    	or	ecx, ecx
  2496 000011E3 0F8567FFFFFF            	jnz	lff16s2_1
  2497 000011E9 E9FBF9FFFF              	jmp	lff16s2_3
  2498                                  
  2499                                  ; .....................
  2500                                  
  2501                                  load_24khz_mono_8_bit:
  2502                                  	; 15/11/2023
  2503 000011EE F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2504                                  					; last of the file?
  2505 000011F5 7402                    	jz	short lff24m_0		; no
  2506 000011F7 F9                      	stc
  2507 000011F8 C3                      	retn
  2508                                  
  2509                                  lff24m_0:
  2510                                  	; 01/12/2024
  2511                                  	; edi = audio buffer address
  2512 000011F9 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2513                                          ;mov	edx, [loadsize]
  2514                                  
  2515                                  	; esi = buffer address
  2516                                  	;; edx = buffer size
  2517                                  
  2518                                  	; load file into memory
  2519                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000011FE 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001204 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001206 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000120C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001211 CD40                <1>  int 40h
  2520 00001213 723B                    	jc	short lff24m_7 ; error !
  2521                                  
  2522                                  	; 01/12/2024
  2523 00001215 A3[94730000]            	mov	[count], eax
  2524                                  	;;;
  2525                                  	; 07/12/2024
  2526                                  	;mov	edi, audio_buffer
  2527                                  	;;;
  2528 0000121A 21C0                    	and	eax, eax
  2529 0000121C 7505                    	jnz	short lff24m_8
  2530 0000121E E9DEF9FFFF              	jmp	lff24_eof
  2531                                  
  2532                                  lff24m_8:
  2533 00001223 89C1                    	mov	ecx, eax	; byte count
  2534                                  lff24m_1:
  2535 00001225 AC                      	lodsb
  2536                                  	;mov	[previous_val], al
  2537 00001226 88C3                    	mov	bl, al
  2538 00001228 2C80                    	sub	al, 80h
  2539 0000122A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2540 0000122E 66AB                    	stosw		; original sample (left channel)
  2541 00001230 66AB                    	stosw		; original sample (right channel)
  2542                                  	;xor	eax, eax
  2543 00001232 B080                    	mov	al, 80h
  2544 00001234 49                      	dec	ecx
  2545 00001235 7402                    	jz	short lff24m_2
  2546 00001237 8A06                    	mov	al, [esi]
  2547                                  lff24m_2:
  2548                                  	;;mov	[next_val], al
  2549                                  	;mov	bh, al
  2550                                  	;add	al, [previous_val]
  2551 00001239 00D8                    	add	al, bl
  2552 0000123B D0D8                    	rcr	al, 1
  2553 0000123D 2C80                    	sub	al, 80h
  2554 0000123F 66C1E008                	shl	ax, 8
  2555 00001243 66AB                    	stosw		; this is interpolated sample (L)
  2556 00001245 66AB                    	stosw		; this is interpolated sample (R)
  2557                                  	
  2558                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2559 00001247 09C9                    	or	ecx, ecx
  2560 00001249 75DA                    	jnz	short lff24m_1
  2561 0000124B E999F9FFFF              	jmp	lff24_3
  2562                                  
  2563                                  lff24m_7:
  2564                                  lff24s_7:
  2565 00001250 E9B5F9FFFF              	jmp	lff24_5  ; error
  2566                                  
  2567                                  load_24khz_stereo_8_bit:
  2568                                  	; 15/11/2023
  2569 00001255 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2570                                  					; last of the file?
  2571 0000125C 7402                    	jz	short lff24s_0		; no
  2572 0000125E F9                      	stc
  2573 0000125F C3                      	retn
  2574                                  
  2575                                  lff24s_0:
  2576                                  	; 01/12/2024
  2577                                  	; edi = audio buffer address
  2578 00001260 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2579                                          ;mov	edx, [loadsize]
  2580                                  
  2581                                  	; esi = buffer address
  2582                                  	;; edx = buffer size
  2583                                  
  2584                                  	; load file into memory
  2585                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001265 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000126B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000126D 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001273 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001278 CD40                <1>  int 40h
  2586 0000127A 72D4                    	jc	short lff24s_7 ; error !
  2587                                  
  2588                                  	; 01/12/2024
  2589 0000127C A3[94730000]            	mov	[count], eax
  2590                                  	;;;
  2591                                  	; 07/12/2024
  2592                                  	;mov	edi, audio_buffer
  2593                                  	;;;
  2594 00001281 D1E8                    	shr	eax, 1
  2595 00001283 7505                    	jnz	short lff24s_8
  2596 00001285 E977F9FFFF              	jmp	lff24_eof
  2597                                  
  2598                                  lff24s_8:
  2599 0000128A 89C1                    	mov	ecx, eax  ; word count
  2600                                  lff24s_1:
  2601 0000128C AC                      	lodsb
  2602 0000128D A2[78210000]            	mov	[previous_val_l], al
  2603 00001292 2C80                    	sub	al, 80h
  2604 00001294 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2605 00001298 66AB                    	stosw		; original sample (L)
  2606 0000129A AC                      	lodsb
  2607 0000129B A2[7A210000]            	mov	[previous_val_r], al
  2608 000012A0 2C80                    	sub	al, 80h
  2609 000012A2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2610 000012A6 66AB                    	stosw		; original sample (R)
  2611                                  
  2612                                  	;xor	eax, eax
  2613 000012A8 66B88080                	mov	ax, 8080h
  2614 000012AC 49                      	dec	ecx
  2615 000012AD 7403                    	jz	short lff24s_2
  2616                                  		; convert 8 bit sample to 16 bit sample
  2617 000012AF 668B06                  	mov	ax, [esi]
  2618                                  lff24s_2:
  2619                                  	;;mov	[next_val_l], al
  2620                                  	;;mov	[next_val_r], ah
  2621                                  	;mov	bx, ax
  2622 000012B2 88E7                    	mov	bh, ah
  2623 000012B4 0205[78210000]          	add	al, [previous_val_l]
  2624 000012BA D0D8                    	rcr	al, 1
  2625                                  	;mov	dl, al
  2626 000012BC 2C80                    	sub	al, 80h
  2627 000012BE 66C1E008                	shl	ax, 8
  2628 000012C2 66AB                    	stosw		; this is interpolated sample (L)
  2629 000012C4 88F8                    	mov	al, bh	; [next_val_r]
  2630 000012C6 0205[7A210000]          	add	al, [previous_val_r]
  2631 000012CC D0D8                    	rcr	al, 1
  2632                                  	;mov	dh, al
  2633 000012CE 2C80                    	sub	al, 80h
  2634 000012D0 66C1E008                	shl	ax, 8
  2635 000012D4 66AB                    	stosw		; this is interpolated sample (R)
  2636                                  		
  2637                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2638 000012D6 09C9                    	or	ecx, ecx
  2639 000012D8 75B2                    	jnz	short lff24s_1
  2640 000012DA E90AF9FFFF              	jmp	lff24_3
  2641                                  
  2642                                  load_24khz_mono_16_bit:
  2643                                  	; 15/11/2023
  2644 000012DF F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2645                                  					; last of the file?
  2646 000012E6 7402                    	jz	short lff24m2_0		; no
  2647 000012E8 F9                      	stc
  2648 000012E9 C3                      	retn
  2649                                  
  2650                                  lff24m2_0:
  2651                                  	; 01/12/2024
  2652                                  	; edi = audio buffer address
  2653 000012EA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2654                                          ;mov	edx, [loadsize]
  2655                                  
  2656                                  	; esi = buffer address
  2657                                  	;; edx = buffer size
  2658                                  
  2659                                  	; load file into memory
  2660                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000012EF 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000012F5 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000012F7 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000012FD B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001302 CD40                <1>  int 40h
  2661 00001304 7237                    	jc	short lff24m2_7 ; error !
  2662                                  
  2663                                  	; 01/12/2024
  2664 00001306 A3[94730000]            	mov	[count], eax
  2665                                  	;;;
  2666                                  	; 07/12/2024
  2667                                  	;mov	edi, audio_buffer
  2668                                  	;;;
  2669 0000130B D1E8                    	shr	eax, 1
  2670 0000130D 7505                    	jnz	short lff24m2_8
  2671 0000130F E9EDF8FFFF              	jmp	lff24_eof
  2672                                  
  2673                                  lff24m2_8:
  2674 00001314 89C1                    	mov	ecx, eax  ; word count
  2675                                  lff24m2_1:
  2676 00001316 66AD                    	lodsw
  2677 00001318 66AB                    	stosw		; original sample (left channel)
  2678 0000131A 66AB                    	stosw		; original sample (right channel)
  2679 0000131C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2680                                  	;mov	[previous_val], ax
  2681                                  	;mov	ebx, eax
  2682                                  	;xor	eax, eax
  2683 0000131F 31DB                    	xor	ebx, ebx
  2684 00001321 49                      	dec	ecx
  2685 00001322 7403                    	jz	short lff24m2_2
  2686                                  	;mov	ax, [esi]
  2687 00001324 668B1E                  	mov	bx, [esi]
  2688                                  lff24m2_2:
  2689                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2690                                  	;mov	ebp, eax	; [next_val]
  2691                                  	;add	ax, [previous_val]
  2692                                  	; ax = [previous_val]
  2693                                  	; bx = [next_val]
  2694 00001327 6601D8                  	add	ax, bx
  2695 0000132A 66D1D8                  	rcr	ax, 1
  2696 0000132D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2697 00001330 66AB                    	stosw		; this is interpolated sample (L)
  2698 00001332 66AB                    	stosw		; this is interpolated sample (R)
  2699                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2700 00001334 09C9                    	or	ecx, ecx
  2701 00001336 75DE                    	jnz	short lff24m2_1
  2702 00001338 E9ACF8FFFF              	jmp	lff24_3
  2703                                  
  2704                                  lff24m2_7:
  2705                                  lff24s2_7:
  2706 0000133D E9C8F8FFFF              	jmp	lff24_5  ; error
  2707                                  
  2708                                  load_24khz_stereo_16_bit:
  2709                                  	; 16/11/2023
  2710                                  	; 15/11/2023
  2711 00001342 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2712                                  					; last of the file?
  2713 00001349 7402                    	jz	short lff24s2_0		; no
  2714 0000134B F9                      	stc
  2715 0000134C C3                      	retn
  2716                                  
  2717                                  lff24s2_0:
  2718                                  	; 01/12/2024
  2719                                  	; edi = audio buffer address
  2720 0000134D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2721                                          ;mov	edx, [loadsize]
  2722                                  
  2723                                  	; esi = buffer address
  2724                                  	;; edx = buffer size
  2725                                  
  2726                                  	; load file into memory
  2727                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001352 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001358 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000135A 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001360 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001365 CD40                <1>  int 40h
  2728 00001367 72D4                    	jc	short lff24s2_7 ; error !
  2729                                  
  2730                                  	; 01/12/2024
  2731 00001369 A3[94730000]            	mov	[count], eax
  2732                                  	;;;
  2733                                  	; 07/12/2024
  2734                                  	;mov	edi, audio_buffer
  2735                                  	;;;
  2736 0000136E C1E802                  	shr	eax, 2
  2737 00001371 7505                    	jnz	short lff24s2_8
  2738 00001373 E989F8FFFF              	jmp	lff24_eof
  2739                                  
  2740                                  lff24s2_8:
  2741 00001378 89C1                    	mov	ecx, eax  ; dword count
  2742                                  lff24s2_1:
  2743 0000137A 66AD                    	lodsw
  2744 0000137C 66AB                    	stosw		; original sample (L)
  2745 0000137E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2746 00001381 66A3[78210000]          	mov	[previous_val_l], ax
  2747 00001387 66AD                    	lodsw
  2748 00001389 66AB                    	stosw		; original sample (R)
  2749 0000138B 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2750                                  	;mov	[previous_val_r], ax
  2751 0000138E 89C3                    	mov	ebx, eax
  2752 00001390 31D2                    	xor	edx, edx
  2753 00001392 31C0                    	xor	eax, eax
  2754                                  	; 16/11/2023
  2755 00001394 49                      	dec	ecx
  2756 00001395 7407                    	jz	short lff24s2_2
  2757 00001397 668B06                  	mov	ax, [esi]
  2758 0000139A 668B5602                	mov	dx, [esi+2]
  2759                                  lff24s2_2:
  2760 0000139E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2761                                  	;;mov	[next_val_l], ax
  2762                                  	;mov	ebp, eax
  2763 000013A1 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2764                                  	;mov	[next_val_r], dx
  2765 000013A4 660305[78210000]        	add	ax, [previous_val_l]
  2766 000013AB 66D1D8                  	rcr	ax, 1
  2767 000013AE 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2768 000013B1 66AB                    	stosw		; this is interpolated sample (L)
  2769                                  	;mov	ax, [next_val_r]
  2770 000013B3 89D0                    	mov	eax, edx
  2771                                  	;add	ax, [previous_val_r]
  2772 000013B5 6601D8                  	add	ax, bx
  2773 000013B8 66D1D8                  	rcr	ax, 1
  2774 000013BB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2775 000013BE 66AB                    	stosw		; this is interpolated sample (R)
  2776                                  	
  2777                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2778 000013C0 09C9                    	or	ecx, ecx
  2779 000013C2 75B6                    	jnz	short lff24s2_1
  2780 000013C4 E920F8FFFF              	jmp	lff24_3
  2781                                  
  2782                                  ; .....................
  2783                                  
  2784                                  load_32khz_mono_8_bit:
  2785                                  	; 15/11/2023
  2786 000013C9 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2787                                  					; last of the file?
  2788 000013D0 7402                    	jz	short lff32m_0		; no
  2789 000013D2 F9                      	stc
  2790 000013D3 C3                      	retn
  2791                                  
  2792                                  lff32m_0:
  2793                                  	; 01/12/2024
  2794                                  	; edi = audio buffer address
  2795 000013D4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2796                                          ;mov	edx, [loadsize]
  2797                                  
  2798                                  	; esi = buffer address
  2799                                  	;; edx = buffer size
  2800                                  
  2801                                  	; load file into memory
  2802                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000013D9 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000013DF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000013E1 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000013E7 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000013EC CD40                <1>  int 40h
  2803 000013EE 7247                    	jc	short lff32m_7 ; error !
  2804                                  
  2805                                  	; 01/12/2024
  2806 000013F0 A3[94730000]            	mov	[count], eax
  2807                                  	;;;
  2808                                  	; 07/12/2024
  2809                                  	;mov	edi, audio_buffer
  2810                                  	;;;
  2811 000013F5 21C0                    	and	eax, eax
  2812 000013F7 7505                    	jnz	short lff32m_8
  2813 000013F9 E903F8FFFF              	jmp	lff32_eof
  2814                                  
  2815                                  lff32m_8:
  2816 000013FE 89C1                    	mov	ecx, eax	; byte count
  2817                                  lff32m_1:
  2818 00001400 AC                      	lodsb
  2819                                  	;mov	[previous_val], al
  2820 00001401 88C3                    	mov	bl, al
  2821 00001403 2C80                    	sub	al, 80h
  2822 00001405 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2823 00001409 66AB                    	stosw		; original sample (left channel)
  2824 0000140B 66AB                    	stosw		; original sample (right channel)
  2825                                  	;xor	eax, eax
  2826 0000140D B080                    	mov	al, 80h
  2827 0000140F 49                      	dec	ecx
  2828 00001410 7402                    	jz	short lff32m_2
  2829 00001412 8A06                    	mov	al, [esi]
  2830                                  lff32m_2:
  2831                                  	;;mov	[next_val], al
  2832                                  	;mov	bh, al
  2833                                  	;add	al, [previous_val]
  2834 00001414 00D8                    	add	al, bl
  2835 00001416 D0D8                    	rcr	al, 1
  2836 00001418 2C80                    	sub	al, 80h
  2837 0000141A 66C1E008                	shl	ax, 8
  2838 0000141E 66AB                    	stosw		; this is interpolated sample (L)
  2839 00001420 66AB                    	stosw		; this is interpolated sample (R)
  2840                                  	
  2841                                  	; different than 8-16-24 kHZ !
  2842                                  	; 'original-interpolated-original' trio samples
  2843 00001422 E30E                    	jecxz	lff32m_3
  2844                                  
  2845 00001424 AC                      	lodsb
  2846 00001425 2C80                    	sub	al, 80h
  2847 00001427 66C1E008                	shl	ax, 8
  2848 0000142B 66AB                    	stosw		; original sample (left channel)
  2849 0000142D 66AB                    	stosw		; original sample (right channel)
  2850                                  
  2851                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2852 0000142F 49                      	dec	ecx
  2853 00001430 75CE                    	jnz	short lff32m_1
  2854                                  lff32m_3:
  2855 00001432 E9B2F7FFFF              	jmp	lff32_3
  2856                                  
  2857                                  lff32m_7:
  2858                                  lff32s_7:
  2859 00001437 E9CEF7FFFF              	jmp	lff32_5  ; error
  2860                                  
  2861                                  load_32khz_stereo_8_bit:
  2862                                  	; 15/11/2023
  2863 0000143C F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2864                                  					; last of the file?
  2865 00001443 7402                    	jz	short lff32s_0		; no
  2866 00001445 F9                      	stc
  2867 00001446 C3                      	retn
  2868                                  
  2869                                  lff32s_0:
  2870                                  	; 01/12/2024
  2871                                  	; edi = audio buffer address
  2872 00001447 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2873                                          ;mov	edx, [loadsize]
  2874                                  
  2875                                  	; esi = buffer address
  2876                                  	;; edx = buffer size
  2877                                  
  2878                                  	; load file into memory
  2879                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000144C 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001452 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001454 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000145A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000145F CD40                <1>  int 40h
  2880 00001461 72D4                    	jc	short lff32s_7 ; error !
  2881                                  
  2882                                  	; 01/12/2024
  2883 00001463 A3[94730000]            	mov	[count], eax
  2884                                  	;;;
  2885                                  	; 07/12/2024
  2886                                  	;mov	edi, audio_buffer
  2887                                  	;;;
  2888 00001468 D1E8                    	shr	eax, 1
  2889 0000146A 7505                    	jnz	short lff32s_8
  2890 0000146C E990F7FFFF              	jmp	lff32_eof
  2891                                  
  2892                                  lff32s_8:
  2893 00001471 89C1                    	mov	ecx, eax  ; word count
  2894                                  lff32s_1:
  2895 00001473 AC                      	lodsb
  2896 00001474 A2[78210000]            	mov	[previous_val_l], al
  2897 00001479 2C80                    	sub	al, 80h
  2898 0000147B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2899 0000147F 66AB                    	stosw		; original sample (L)
  2900 00001481 AC                      	lodsb
  2901 00001482 A2[7A210000]            	mov	[previous_val_r], al
  2902 00001487 2C80                    	sub	al, 80h
  2903 00001489 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2904 0000148D 66AB                    	stosw		; original sample (R)
  2905                                  
  2906                                  	;xor	eax, eax
  2907 0000148F 66B88080                	mov	ax, 8080h
  2908 00001493 49                      	dec	ecx
  2909 00001494 7403                    	jz	short lff32s_2
  2910                                  		; convert 8 bit sample to 16 bit sample
  2911 00001496 668B06                  	mov	ax, [esi]
  2912                                  lff32s_2:
  2913                                  	;;mov	[next_val_l], al
  2914                                  	;;mov	[next_val_r], ah
  2915                                  	;mov	bx, ax
  2916 00001499 88E7                    	mov	bh, ah
  2917 0000149B 0205[78210000]          	add	al, [previous_val_l]
  2918 000014A1 D0D8                    	rcr	al, 1
  2919                                  	;mov	dl, al
  2920 000014A3 2C80                    	sub	al, 80h
  2921 000014A5 66C1E008                	shl	ax, 8
  2922 000014A9 66AB                    	stosw		; this is interpolated sample (L)
  2923 000014AB 88F8                    	mov	al, bh	; [next_val_r]
  2924 000014AD 0205[7A210000]          	add	al, [previous_val_r]
  2925 000014B3 D0D8                    	rcr	al, 1
  2926                                  	;mov	dh, al
  2927 000014B5 2C80                    	sub	al, 80h
  2928 000014B7 66C1E008                	shl	ax, 8
  2929 000014BB 66AB                    	stosw		; this is interpolated sample (R)
  2930                                  
  2931                                  	; different than 8-16-24 kHZ !
  2932                                  	; 'original-interpolated-original' trio samples
  2933 000014BD E315                    	jecxz	lff32s_3
  2934                                  
  2935 000014BF AC                      	lodsb
  2936 000014C0 2C80                    	sub	al, 80h
  2937 000014C2 66C1E008                	shl	ax, 8
  2938 000014C6 66AB                    	stosw		; original sample (left channel)
  2939                                  
  2940 000014C8 AC                      	lodsb
  2941 000014C9 2C80                    	sub	al, 80h
  2942 000014CB 66C1E008                	shl	ax, 8
  2943 000014CF 66AB                    	stosw		; original sample (right channel)
  2944                                  		
  2945                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2946 000014D1 49                      	dec	ecx
  2947 000014D2 759F                    	jnz	short lff32s_1
  2948                                  lff32s_3:
  2949 000014D4 E910F7FFFF              	jmp	lff32_3
  2950                                  
  2951                                  load_32khz_mono_16_bit:
  2952                                  	; 15/11/2023
  2953 000014D9 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2954                                  					; last of the file?
  2955 000014E0 7402                    	jz	short lff32m2_0		; no
  2956 000014E2 F9                      	stc
  2957 000014E3 C3                      	retn
  2958                                  
  2959                                  lff32m2_0:
  2960                                  	; 01/12/2024
  2961                                  	; edi = audio buffer address
  2962 000014E4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2963                                          ;mov	edx, [loadsize]
  2964                                  
  2965                                  	; esi = buffer address
  2966                                  	;; edx = buffer size
  2967                                  
  2968                                  	; load file into memory
  2969                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000014E9 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000014EF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000014F1 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000014F7 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000014FC CD40                <1>  int 40h
  2970 000014FE 723E                    	jc	short lff32m2_7 ; error !
  2971                                  
  2972                                  	; 01/12/2024
  2973 00001500 A3[94730000]            	mov	[count], eax
  2974                                  	;;;
  2975                                  	; 07/12/2024
  2976                                  	;mov	edi, audio_buffer
  2977                                  	;;;
  2978 00001505 D1E8                    	shr	eax, 1
  2979 00001507 7505                    	jnz	short lff32m2_8
  2980 00001509 E9F3F6FFFF              	jmp	lff32_eof
  2981                                  
  2982                                  lff32m2_8:
  2983 0000150E 89C1                    	mov	ecx, eax  ; word count
  2984                                  lff32m2_1:
  2985 00001510 66AD                    	lodsw
  2986 00001512 66AB                    	stosw		; original sample (left channel)
  2987 00001514 66AB                    	stosw		; original sample (right channel)
  2988 00001516 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2989                                  	;mov	[previous_val], ax
  2990                                  	;mov	ebx, eax
  2991                                  	;xor	eax, eax
  2992 00001519 31DB                    	xor	ebx, ebx
  2993 0000151B 49                      	dec	ecx
  2994 0000151C 7403                    	jz	short lff32m2_2
  2995                                  	;mov	ax, [esi]
  2996 0000151E 668B1E                  	mov	bx, [esi]
  2997                                  lff32m2_2:
  2998                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2999                                  	;mov	ebp, eax ; [next_val]
  3000                                  	;add	ax, [previous_val]
  3001                                  	; ax = [previous_val]
  3002                                  	; bx = [next_val]
  3003 00001521 6601D8                  	add	ax, bx
  3004 00001524 66D1D8                  	rcr	ax, 1
  3005 00001527 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3006 0000152A 66AB                    	stosw		; this is interpolated sample (L)
  3007 0000152C 66AB                    	stosw		; this is interpolated sample (R)
  3008                                  
  3009                                  	; different than 8-16-24 kHZ !
  3010                                  	; 'original-interpolated-original' trio samples 
  3011 0000152E E309                    	jecxz	lff32m2_3
  3012                                  
  3013 00001530 66AD                    	lodsw
  3014 00001532 66AB                    	stosw		; original sample (left channel)
  3015 00001534 66AB                    	stosw		; original sample (right channel)
  3016                                  
  3017                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3018 00001536 49                      	dec	ecx
  3019 00001537 75D7                    	jnz	short lff32m2_1
  3020                                  lff32m2_3:
  3021 00001539 E9ABF6FFFF              	jmp	lff32_3
  3022                                  
  3023                                  lff32m2_7:
  3024                                  lff32s2_7:
  3025 0000153E E9C7F6FFFF              	jmp	lff32_5  ; error
  3026                                  
  3027                                  load_32khz_stereo_16_bit:
  3028                                  	; 16/11/2023
  3029                                  	; 15/11/2023
  3030 00001543 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3031                                  					; last of the file?
  3032 0000154A 7402                    	jz	short lff32s2_0		; no
  3033 0000154C F9                      	stc
  3034 0000154D C3                      	retn
  3035                                  
  3036                                  lff32s2_0:
  3037                                  	; 01/12/2024
  3038                                  	; edi = audio buffer address
  3039 0000154E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3040                                          ;mov	edx, [loadsize]
  3041                                  
  3042                                  	; esi = buffer address
  3043                                  	;; edx = buffer size
  3044                                  
  3045                                  	; load file into memory
  3046                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001553 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001559 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000155B 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001561 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001566 CD40                <1>  int 40h
  3047 00001568 72D4                    	jc	short lff32s2_7 ; error !
  3048                                  
  3049                                  	; 01/12/2024
  3050 0000156A A3[94730000]            	mov	[count], eax
  3051                                  	;;;
  3052                                  	; 07/12/2024
  3053                                  	;mov	edi, audio_buffer
  3054                                  	;;;
  3055 0000156F C1E802                  	shr	eax, 2
  3056 00001572 7505                    	jnz	short lff32s2_8
  3057 00001574 E988F6FFFF              	jmp	lff32_eof
  3058                                  
  3059                                  lff32s2_8:
  3060 00001579 89C1                    	mov	ecx, eax ; dword count
  3061                                  lff32s2_1:
  3062 0000157B 66AD                    	lodsw
  3063 0000157D 66AB                    	stosw		; original sample (L)
  3064 0000157F 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3065 00001582 66A3[78210000]          	mov	[previous_val_l], ax
  3066 00001588 66AD                    	lodsw
  3067 0000158A 66AB                    	stosw		; original sample (R)
  3068 0000158C 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3069                                  	;mov	[previous_val_r], ax
  3070 0000158F 89C3                    	mov	ebx, eax
  3071 00001591 31D2                    	xor	edx, edx
  3072 00001593 31C0                    	xor	eax, eax
  3073                                  	; 16/11/2023
  3074 00001595 49                      	dec	ecx
  3075 00001596 7407                    	jz	short lff32s2_2
  3076 00001598 668B06                  	mov	ax, [esi]
  3077 0000159B 668B5602                	mov	dx, [esi+2]
  3078                                  lff32s2_2:
  3079 0000159F 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3080                                  	;;mov	[next_val_l], ax
  3081                                  	;mov	ebp, eax
  3082 000015A2 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3083                                  	;mov	[next_val_r], dx
  3084 000015A5 660305[78210000]        	add	ax, [previous_val_l]
  3085 000015AC 66D1D8                  	rcr	ax, 1
  3086 000015AF 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3087 000015B2 66AB                    	stosw		; this is interpolated sample (L)
  3088                                  	;mov	ax, [next_val_r]
  3089 000015B4 89D0                    	mov	eax, edx
  3090                                  	;add	ax, [previous_val_r]
  3091 000015B6 6601D8                  	add	ax, bx
  3092 000015B9 66D1D8                  	rcr	ax, 1
  3093 000015BC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3094 000015BF 66AB                    	stosw		; this is interpolated sample (R)
  3095                                  
  3096                                  	; different than 8-16-24 kHZ !
  3097                                  	; 'original-interpolated-original' trio samples
  3098 000015C1 E30B                    	jecxz	lff32s2_3
  3099                                  
  3100 000015C3 66AD                    	lodsw
  3101 000015C5 66AB                    	stosw	; original sample (L)
  3102 000015C7 66AD                    	lodsw
  3103 000015C9 66AB                    	stosw	; original sample (R)
  3104                                  	
  3105                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3106 000015CB 49                      	dec	ecx
  3107 000015CC 75AD                    	jnz	short lff32s2_1
  3108                                  lff32s2_3:
  3109 000015CE E916F6FFFF              	jmp	lff32_3
  3110                                  
  3111                                  ; .....................
  3112                                  
  3113                                  load_22khz_mono_8_bit:
  3114                                  	; 16/11/2023
  3115 000015D3 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3116                                  					; last of the file?
  3117 000015DA 7402                    	jz	short lff22m_0		; no
  3118 000015DC F9                      	stc
  3119 000015DD C3                      	retn
  3120                                  
  3121                                  lff22m_0:
  3122                                  	; 01/12/2024
  3123                                  	; edi = audio buffer address
  3124 000015DE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3125                                          ;mov	edx, [loadsize]
  3126                                  
  3127                                  	; esi = buffer address
  3128                                  	;; edx = buffer size
  3129                                  
  3130                                  	; load file into memory
  3131                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000015E3 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000015E9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000015EB 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000015F1 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000015F6 CD40                <1>  int 40h
  3132 000015F8 725D                    	jc	short lff22m_7 ; error !
  3133                                  
  3134                                  	; 01/12/2024
  3135 000015FA A3[94730000]            	mov	[count], eax
  3136                                  	;;;
  3137                                  	; 07/12/2024
  3138                                  	;mov	edi, audio_buffer
  3139                                  	;;;
  3140 000015FF 21C0                    	and	eax, eax
  3141 00001601 7505                    	jnz	short lff22m_8
  3142 00001603 E9F9F5FFFF              	jmp	lff22_eof
  3143                                  
  3144                                  lff22m_8:
  3145 00001608 89C1                    	mov	ecx, eax	; byte count
  3146                                  lff22m_9:
  3147 0000160A BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3148 0000160F C605[80210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3149                                  lff22m_1:
  3150                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3151 00001616 AC                      	lodsb
  3152 00001617 B280                    	mov	dl, 80h
  3153 00001619 49                      	dec	ecx
  3154 0000161A 7402                    	jz	short lff22m_2_1
  3155 0000161C 8A16                    	mov	dl, [esi]
  3156                                  lff22m_2_1:	
  3157                                  	; al = [previous_val]
  3158                                  	; dl = [next_val]
  3159 0000161E E80F060000              	call	interpolating_3_8bit_mono ; 1 of 17
  3160 00001623 E32D                    	jecxz	lff22m_3
  3161                                  lff22m_2_2:
  3162 00001625 AC                      	lodsb
  3163 00001626 B280                    	mov	dl, 80h
  3164 00001628 49                      	dec	ecx
  3165 00001629 7402                    	jz	short lff22m_2_3
  3166 0000162B 8A16                    	mov	dl, [esi]
  3167                                  lff22m_2_3:
  3168 0000162D E884060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3169 00001632 E31E                    	jecxz	lff22m_3
  3170 00001634 4D                      	dec	ebp
  3171 00001635 75EE                    	jnz	short lff22m_2_2
  3172                                  
  3173 00001637 A0[80210000]            	mov	al, [faz]
  3174 0000163C FEC8                    	dec	al
  3175 0000163E 74CA                    	jz	short lff22m_9
  3176 00001640 FE0D[80210000]          	dec	byte [faz]
  3177 00001646 BD04000000              	mov	ebp, 4
  3178 0000164B FEC8                    	dec	al
  3179 0000164D 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3180 0000164F 45                      	inc	ebp ; 5
  3181 00001650 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3182                                  
  3183                                  lff22m_3:
  3184                                  lff22s_3:
  3185 00001652 E992F5FFFF              	jmp	lff22_3	; padfill
  3186                                  		; (put zeros in the remain words of the buffer)
  3187                                  lff22m_7:
  3188                                  lff22s_7:
  3189 00001657 E9AEF5FFFF              	jmp	lff22_5  ; error
  3190                                  
  3191                                  load_22khz_stereo_8_bit:
  3192                                  	; 16/11/2023
  3193 0000165C F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3194                                  					; last of the file?
  3195 00001663 7402                    	jz	short lff22s_0		; no
  3196 00001665 F9                      	stc
  3197 00001666 C3                      	retn
  3198                                  
  3199                                  lff22s_0:
  3200                                  	; 01/12/2024
  3201                                  	; edi = audio buffer address
  3202 00001667 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3203                                          ;mov	edx, [loadsize]
  3204                                  
  3205                                  	; esi = buffer address
  3206                                  	;; edx = buffer size
  3207                                  
  3208                                  	; load file into memory
  3209                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000166C 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001672 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001674 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000167A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000167F CD40                <1>  int 40h
  3210 00001681 72D4                    	jc	short lff22s_7 ; error !
  3211                                  
  3212                                  	; 01/12/2024
  3213 00001683 A3[94730000]            	mov	[count], eax
  3214                                  	;;;
  3215                                  	; 07/12/2024
  3216                                  	;mov	edi, audio_buffer
  3217                                  	;;;
  3218 00001688 D1E8                    	shr	eax, 1
  3219 0000168A 7505                    	jnz	short lff22s_8
  3220 0000168C E970F5FFFF              	jmp	lff22_eof
  3221                                  
  3222                                  lff22s_8:
  3223 00001691 89C1                    	mov	ecx, eax	; word count
  3224                                  lff22s_9:
  3225 00001693 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3226 00001698 C605[80210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3227                                  lff22s_1:
  3228                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3229 0000169F 66AD                    	lodsw
  3230 000016A1 66BA8080                	mov	dx, 8080h
  3231 000016A5 49                      	dec	ecx
  3232 000016A6 7403                    	jz	short lff22s_2_1
  3233 000016A8 668B16                  	mov	dx, [esi]
  3234                                  lff22s_2_1:	
  3235                                  	; al = [previous_val_l]
  3236                                  	; ah = [previous_val_r]
  3237                                  	; dl = [next_val_l]
  3238                                  	; dh = [next_val_r]
  3239 000016AB E8B3050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3240 000016B0 E3A0                    	jecxz	lff22s_3
  3241                                  lff22s_2_2:
  3242 000016B2 66AD                    	lodsw
  3243 000016B4 66BA8080                	mov	dx, 8080h
  3244 000016B8 49                      	dec	ecx
  3245 000016B9 7403                    	jz	short lff22s_2_3
  3246 000016BB 668B16                  	mov	dx, [esi]
  3247                                  lff22s_2_3:
  3248 000016BE E810060000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3249 000016C3 E38D                    	jecxz	lff22s_3
  3250 000016C5 4D                      	dec	ebp
  3251 000016C6 75EA                    	jnz	short lff22s_2_2
  3252                                  
  3253 000016C8 A0[80210000]            	mov	al, [faz]
  3254 000016CD FEC8                    	dec	al
  3255 000016CF 74C2                    	jz	short lff22s_9
  3256 000016D1 FE0D[80210000]          	dec	byte [faz]
  3257 000016D7 BD04000000              	mov	ebp, 4
  3258 000016DC FEC8                    	dec	al
  3259 000016DE 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3260 000016E0 45                      	inc	ebp ; 5
  3261 000016E1 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3262                                  
  3263                                  load_22khz_mono_16_bit:
  3264                                  	; 16/11/2023
  3265 000016E3 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3266                                  					; last of the file?
  3267 000016EA 7402                    	jz	short lff22m2_0		; no
  3268 000016EC F9                      	stc
  3269 000016ED C3                      	retn
  3270                                  
  3271                                  lff22m2_0:
  3272                                  	; 01/12/2024
  3273                                  	; edi = audio buffer address
  3274 000016EE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3275                                          ;mov	edx, [loadsize]
  3276                                  
  3277                                  	; esi = buffer address
  3278                                  	;; edx = buffer size
  3279                                  
  3280                                  	; load file into memory
  3281                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000016F3 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000016F9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000016FB 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001701 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001706 CD40                <1>  int 40h
  3282 00001708 7261                    	jc	short lff22m2_7 ; error !
  3283                                  
  3284                                  	; 01/12/2024
  3285 0000170A A3[94730000]            	mov	[count], eax
  3286                                  	;;;
  3287                                  	; 07/12/2024
  3288                                  	;mov	edi, audio_buffer
  3289                                  	;;;
  3290 0000170F D1E8                    	shr	eax, 1
  3291 00001711 7505                    	jnz	short lff22m2_8
  3292 00001713 E9E9F4FFFF              	jmp	lff22_eof
  3293                                  
  3294                                  lff22m2_8:
  3295 00001718 89C1                    	mov	ecx, eax	; word count
  3296                                  lff22m2_9:
  3297 0000171A BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3298 0000171F C605[80210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3299                                  lff22m2_1:
  3300                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3301 00001726 66AD                    	lodsw
  3302 00001728 31D2                    	xor	edx, edx
  3303 0000172A 49                      	dec	ecx
  3304 0000172B 7403                    	jz	short lff22m2_2_1
  3305 0000172D 668B16                  	mov	dx, [esi]
  3306                                  lff22m2_2_1:	
  3307                                  	; ax = [previous_val]
  3308                                  	; dx = [next_val]
  3309 00001730 E8CF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3310 00001735 E32F                    	jecxz	lff22m2_3
  3311                                  lff22m2_2_2:
  3312 00001737 66AD                    	lodsw
  3313 00001739 31D2                    	xor	edx, edx
  3314 0000173B 49                      	dec	ecx
  3315 0000173C 7403                    	jz	short lff22m2_2_3
  3316 0000173E 668B16                  	mov	dx, [esi]
  3317                                  lff22m2_2_3:
  3318 00001741 E851060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3319 00001746 E31E                    	jecxz	lff22m2_3
  3320 00001748 4D                      	dec	ebp
  3321 00001749 75EC                    	jnz	short lff22m2_2_2
  3322                                  
  3323 0000174B A0[80210000]            	mov	al, [faz]
  3324 00001750 FEC8                    	dec	al
  3325 00001752 74C6                    	jz	short lff22m2_9
  3326 00001754 FE0D[80210000]          	dec	byte [faz]
  3327 0000175A BD04000000              	mov	ebp, 4
  3328 0000175F FEC8                    	dec	al
  3329 00001761 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3330 00001763 45                      	inc	ebp ; 5
  3331 00001764 EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3332                                  
  3333                                  lff22m2_3:
  3334                                  lff22s2_3:
  3335 00001766 E97EF4FFFF              	jmp	lff22_3	; padfill
  3336                                  		; (put zeros in the remain words of the buffer)
  3337                                  lff22m2_7:
  3338                                  lff22s2_7:
  3339 0000176B E99AF4FFFF              	jmp	lff22_5  ; error
  3340                                  
  3341                                  load_22khz_stereo_16_bit:
  3342                                  	; 16/11/2023
  3343 00001770 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3344                                  					; last of the file?
  3345 00001777 7402                    	jz	short lff22s2_0		; no
  3346 00001779 F9                      	stc
  3347 0000177A C3                      	retn
  3348                                  
  3349                                  lff22s2_0:
  3350                                  	; 01/12/2024
  3351                                  	; edi = audio buffer address
  3352 0000177B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3353                                          ;mov	edx, [loadsize]
  3354                                  
  3355                                  	; esi = buffer address
  3356                                  	;; edx = buffer size
  3357                                  
  3358                                  	; load file into memory
  3359                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001780 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001786 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001788 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000178E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001793 CD40                <1>  int 40h
  3360 00001795 72D4                    	jc	short lff22s2_7 ; error !
  3361                                  
  3362                                  	; 01/12/2024
  3363 00001797 A3[94730000]            	mov	[count], eax
  3364                                  	;;;
  3365                                  	; 07/12/2024
  3366                                  	;mov	edi, audio_buffer
  3367                                  	;;;
  3368 0000179C C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3369 0000179F 7505                    	jnz	short lff22s2_8
  3370 000017A1 E95BF4FFFF              	jmp	lff22_eof
  3371                                  
  3372                                  lff22s2_8:
  3373 000017A6 89C1                    	mov	ecx, eax	; dword count
  3374                                  lff22s2_9:
  3375 000017A8 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3376 000017AD C605[80210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3377                                  lff22s2_1:
  3378                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3379 000017B4 66AD                    	lodsw
  3380 000017B6 89C3                    	mov	ebx, eax
  3381 000017B8 66AD                    	lodsw
  3382 000017BA 8B16                    	mov	edx, [esi]
  3383 000017BC 668915[7C210000]        	mov	[next_val_l], dx
  3384                                  	; 26/11/2023
  3385 000017C3 C1EA10                  	shr	edx, 16
  3386 000017C6 49                      	dec	ecx
  3387 000017C7 7509                    	jnz	short lff22s2_2_1
  3388 000017C9 31D2                    	xor	edx, edx ; 0
  3389 000017CB 668915[7C210000]        	mov	[next_val_l], dx
  3390                                  lff22s2_2_1:
  3391                                  	; bx = [previous_val_l]
  3392                                  	; ax = [previous_val_r]
  3393                                  	; [next_val_l]
  3394                                  	; dx = [next_val_r]
  3395 000017D2 E85D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3396 000017D7 E38D                    	jecxz	lff22s2_3
  3397                                  lff22s2_2_2:
  3398 000017D9 66AD                    	lodsw
  3399 000017DB 89C3                    	mov	ebx, eax
  3400 000017DD 66AD                    	lodsw
  3401 000017DF 8B16                    	mov	edx, [esi]
  3402 000017E1 668915[7C210000]        	mov	[next_val_l], dx
  3403                                  	; 26/11/2023
  3404 000017E8 C1EA10                  	shr	edx, 16
  3405 000017EB 49                      	dec	ecx
  3406 000017EC 7509                    	jnz	short lff22s2_2_3
  3407 000017EE 31D2                    	xor	edx, edx ; 0
  3408 000017F0 668915[7C210000]        	mov	[next_val_l], dx
  3409                                  lff22s2_2_3:
  3410 000017F7 E8B3050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3411 000017FC E31E                    	jecxz	lff22s2_2_4
  3412                                  
  3413 000017FE 4D                      	dec	ebp
  3414 000017FF 75D8                    	jnz	short lff22s2_2_2
  3415                                  
  3416 00001801 A0[80210000]            	mov	al, [faz]
  3417 00001806 FEC8                    	dec	al
  3418 00001808 749E                    	jz	short lff22s2_9
  3419 0000180A FE0D[80210000]          	dec	byte [faz]
  3420 00001810 BD04000000              	mov	ebp, 4
  3421 00001815 FEC8                    	dec	al
  3422 00001817 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3423 00001819 45                      	inc	ebp ; 5
  3424 0000181A EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3425                                  
  3426                                  lff22s2_2_4:
  3427                                  	; 26/11/2023
  3428 0000181C E9C8F3FFFF              	jmp	lff22_3	; padfill
  3429                                  
  3430                                  ; .....................
  3431                                  
  3432                                  load_11khz_mono_8_bit:
  3433                                  	; 18/11/2023
  3434 00001821 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3435                                  					; last of the file?
  3436 00001828 7402                    	jz	short lff11m_0		; no
  3437 0000182A F9                      	stc
  3438 0000182B C3                      	retn
  3439                                  
  3440                                  lff11m_0:
  3441                                  	; 01/12/2024
  3442                                  	; edi = audio buffer address
  3443 0000182C BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3444                                          ;mov	edx, [loadsize]
  3445                                  
  3446                                  	; esi = buffer address
  3447                                  	;; edx = buffer size
  3448                                  
  3449                                  	; load file into memory
  3450                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001831 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001837 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001839 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000183F B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001844 CD40                <1>  int 40h
  3451 00001846 7247                    	jc	short lff11m_7 ; error !
  3452                                  
  3453                                  	; 01/12/2024
  3454 00001848 A3[94730000]            	mov	[count], eax
  3455                                  	;;;
  3456                                  	; 07/12/2024
  3457                                  	;mov	edi, audio_buffer
  3458                                  	;;;
  3459 0000184D 21C0                    	and	eax, eax
  3460 0000184F 7505                    	jnz	short lff11m_8
  3461 00001851 E9ABF3FFFF              	jmp	lff11_eof
  3462                                  
  3463                                  lff11m_8:
  3464 00001856 89C1                    	mov	ecx, eax		; byte count
  3465                                  lff11m_9:
  3466 00001858 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3467                                  lff11m_1:
  3468                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3469 0000185D AC                      	lodsb
  3470 0000185E B280                    	mov	dl, 80h
  3471 00001860 49                      	dec	ecx
  3472 00001861 7402                    	jz	short lff11m_2_1
  3473 00001863 8A16                    	mov	dl, [esi]
  3474                                  lff11m_2_1:	
  3475                                  	; al = [previous_val]
  3476                                  	; dl = [next_val]
  3477 00001865 E876050000              	call	interpolating_5_8bit_mono
  3478 0000186A E328                    	jecxz	lff11m_3
  3479                                  lff11m_2_2:
  3480 0000186C AC                      	lodsb
  3481 0000186D B280                    	mov	dl, 80h
  3482 0000186F 49                      	dec	ecx
  3483 00001870 7402                    	jz	short lff11m_2_3
  3484 00001872 8A16                    	mov	dl, [esi]
  3485                                  lff11m_2_3:
  3486 00001874 E873060000               	call	interpolating_4_8bit_mono
  3487 00001879 E319                    	jecxz	lff11m_3
  3488                                  
  3489 0000187B 4D                      	dec	ebp
  3490 0000187C 74DA                    	jz	short lff11m_9
  3491                                  
  3492 0000187E AC                      	lodsb
  3493 0000187F B280                    	mov	dl, 80h
  3494 00001881 49                      	dec	ecx
  3495 00001882 7402                    	jz	short lff11m_2_4
  3496 00001884 8A16                    	mov	dl, [esi]
  3497                                  lff11m_2_4:
  3498 00001886 E861060000              	call	interpolating_4_8bit_mono
  3499 0000188B E307                    	jecxz	lff11m_3
  3500 0000188D EBCE                    	jmp	short lff11m_1
  3501                                  
  3502                                  lff11m_7:
  3503                                  lff11s_7:
  3504 0000188F E976F3FFFF              	jmp	lff11_5  ; error
  3505                                  
  3506                                  lff11m_3:
  3507                                  lff11s_3:
  3508 00001894 E950F3FFFF              	jmp	lff11_3	; padfill
  3509                                  		; (put zeros in the remain words of the buffer)
  3510                                  
  3511                                  load_11khz_stereo_8_bit:
  3512                                  	; 18/11/2023
  3513 00001899 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3514                                  					; last of the file?
  3515 000018A0 7402                    	jz	short lff11s_0		; no
  3516 000018A2 F9                      	stc
  3517 000018A3 C3                      	retn
  3518                                  
  3519                                  lff11s_0:
  3520                                  	; 01/12/2024
  3521                                  	; edi = audio buffer address
  3522 000018A4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3523                                          ;mov	edx, [loadsize]
  3524                                  
  3525                                  	; esi = buffer address
  3526                                  	;; edx = buffer size
  3527                                  
  3528                                  	; load file into memory
  3529                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000018A9 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000018AF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000018B1 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000018B7 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000018BC CD40                <1>  int 40h
  3530 000018BE 72CF                    	jc	short lff11s_7 ; error !
  3531                                  
  3532                                  	; 01/12/2024
  3533 000018C0 A3[94730000]            	mov	[count], eax
  3534                                  	;;;
  3535                                  	; 07/12/2024
  3536                                  	;mov	edi, audio_buffer
  3537                                  	;;;
  3538 000018C5 D1E8                    	shr	eax, 1
  3539 000018C7 7505                    	jnz	short lff11s_8
  3540 000018C9 E933F3FFFF              	jmp	lff11_eof
  3541                                  
  3542                                  lff11s_8:
  3543 000018CE 89C1                    	mov	ecx, eax	; word count
  3544                                  lff11s_9:
  3545 000018D0 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3546                                  lff11s_1:
  3547                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3548 000018D5 66AD                    	lodsw
  3549 000018D7 66BA8080                	mov	dx, 8080h
  3550 000018DB 49                      	dec	ecx
  3551 000018DC 7403                    	jz	short lff11s_2_1
  3552 000018DE 668B16                  	mov	dx, [esi]
  3553                                  lff11s_2_1:	
  3554                                  	; al = [previous_val_l]
  3555                                  	; ah = [previous_val_r]
  3556                                  	; dl = [next_val_l]
  3557                                  	; dh = [next_val_r]
  3558 000018E1 E859050000              	call	interpolating_5_8bit_stereo
  3559 000018E6 E3AC                    	jecxz	lff11s_3
  3560                                  lff11s_2_2:
  3561 000018E8 66AD                    	lodsw
  3562 000018EA 66BA8080                	mov	dx, 8080h
  3563 000018EE 49                      	dec	ecx
  3564 000018EF 7403                    	jz	short lff11s_2_3
  3565 000018F1 668B16                  	mov	dx, [esi]
  3566                                  lff11s_2_3:
  3567 000018F4 E832060000               	call	interpolating_4_8bit_stereo
  3568 000018F9 E399                    	jecxz	lff11s_3
  3569                                  	
  3570 000018FB 4D                      	dec	ebp
  3571 000018FC 74D2                    	jz	short lff11s_9
  3572                                  
  3573 000018FE 66AD                    	lodsw
  3574 00001900 66BA8080                	mov	dx, 8080h
  3575 00001904 49                      	dec	ecx
  3576 00001905 7403                    	jz	short lff11s_2_4
  3577 00001907 668B16                  	mov	dx, [esi]
  3578                                  lff11s_2_4:
  3579 0000190A E81C060000              	call	interpolating_4_8bit_stereo
  3580 0000190F E383                    	jecxz	lff11s_3
  3581 00001911 EBC2                    	jmp	short lff11s_1
  3582                                  
  3583                                  load_11khz_mono_16_bit:
  3584                                  	; 18/11/2023
  3585 00001913 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3586                                  					; last of the file?
  3587 0000191A 7402                    	jz	short lff11m2_0		; no
  3588 0000191C F9                      	stc
  3589 0000191D C3                      	retn
  3590                                  
  3591                                  lff11m2_0:
  3592                                  	; 01/12/2024
  3593                                  	; edi = audio buffer address
  3594 0000191E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3595                                          ;mov	edx, [loadsize]
  3596                                  
  3597                                  	; esi = buffer address
  3598                                  	;; edx = buffer size
  3599                                  
  3600                                  	; load file into memory
  3601                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001923 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001929 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000192B 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001931 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001936 CD40                <1>  int 40h
  3602 00001938 724D                    	jc	short lff11m2_7 ; error !
  3603                                  
  3604                                  	; 01/12/2024
  3605 0000193A A3[94730000]            	mov	[count], eax
  3606                                  	;;;
  3607                                  	; 07/12/2024
  3608                                  	;mov	edi, audio_buffer
  3609                                  	;;;
  3610 0000193F D1E8                    	shr	eax, 1
  3611 00001941 7505                    	jnz	short lff11m2_8
  3612 00001943 E9B9F2FFFF              	jmp	lff11_eof
  3613                                  
  3614                                  lff11m2_8:
  3615 00001948 89C1                    	mov	ecx, eax	; word count
  3616                                  lff11m2_9:
  3617 0000194A BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3618                                  lff11m2_1:
  3619                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3620 0000194F 66AD                    	lodsw
  3621 00001951 31D2                    	xor	edx, edx
  3622 00001953 49                      	dec	ecx
  3623 00001954 7403                    	jz	short lff11m2_2_1
  3624 00001956 668B16                  	mov	dx, [esi]
  3625                                  lff11m2_2_1:	
  3626                                  	; ax = [previous_val]
  3627                                  	; dx = [next_val]
  3628 00001959 E83A060000              	call	interpolating_5_16bit_mono
  3629 0000195E E362                    	jecxz	lff11m2_3
  3630                                  lff11m2_2_2:
  3631 00001960 66AD                    	lodsw
  3632 00001962 31D2                    	xor	edx, edx
  3633 00001964 49                      	dec	ecx
  3634 00001965 7403                    	jz	short lff11m2_2_3
  3635 00001967 668B16                  	mov	dx, [esi]
  3636                                  lff11m2_2_3:
  3637 0000196A E853070000               	call	interpolating_4_16bit_mono
  3638 0000196F E351                    	jecxz	lff11m2_3
  3639                                  
  3640 00001971 4D                      	dec	ebp
  3641 00001972 74D6                    	jz	short lff11m2_9
  3642                                  
  3643 00001974 66AD                    	lodsw
  3644 00001976 31D2                    	xor	edx, edx
  3645 00001978 49                      	dec	ecx
  3646 00001979 7403                    	jz	short lff11m2_2_4
  3647 0000197B 668B16                  	mov	dx, [esi]
  3648                                  lff11m2_2_4:
  3649 0000197E E83F070000               	call	interpolating_4_16bit_mono
  3650 00001983 E33D                    	jecxz	lff11m2_3
  3651 00001985 EBC8                    	jmp	short lff11m2_1
  3652                                  
  3653                                  lff11m2_7:
  3654                                  lff11s2_7:
  3655 00001987 E97EF2FFFF              	jmp	lff11_5  ; error
  3656                                  
  3657                                  load_11khz_stereo_16_bit:
  3658                                  	; 18/11/2023
  3659 0000198C F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3660                                  					; last of the file?
  3661 00001993 7402                    	jz	short lff11s2_0		; no
  3662 00001995 F9                      	stc
  3663 00001996 C3                      	retn
  3664                                  
  3665                                  lff11s2_0:
  3666                                  	; 01/12/2024
  3667                                  	; edi = audio buffer address
  3668 00001997 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3669                                          ;mov	edx, [loadsize]
  3670                                  
  3671                                  	; esi = buffer address
  3672                                  	;; edx = buffer size
  3673                                  
  3674                                  	; load file into memory
  3675                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000199C 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000019A2 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000019A4 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000019AA B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000019AF CD40                <1>  int 40h
  3676 000019B1 72D4                    	jc	short lff11s2_7 ; error !
  3677                                  
  3678                                  	; 01/12/2024
  3679 000019B3 A3[94730000]            	mov	[count], eax
  3680                                  	;;;
  3681                                  	; 07/12/2024
  3682                                  	;mov	edi, audio_buffer
  3683                                  	;;;
  3684 000019B8 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3685 000019BB 750A                    	jnz	short lff11s2_8
  3686 000019BD E93FF2FFFF              	jmp	lff11_eof
  3687                                  
  3688                                  lff11m2_3:
  3689                                  lff11s2_3:
  3690 000019C2 E922F2FFFF              	jmp	lff11_3	; padfill
  3691                                  		; (put zeros in the remain words of the buffer)
  3692                                  
  3693                                  lff11s2_8:
  3694 000019C7 89C1                    	mov	ecx, eax	; dword count
  3695                                  lff11s2_9:
  3696 000019C9 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3697                                  lff11s2_1:
  3698                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3699 000019CE 66AD                    	lodsw
  3700 000019D0 89C3                    	mov	ebx, eax
  3701 000019D2 66AD                    	lodsw
  3702 000019D4 8B16                    	mov	edx, [esi]
  3703 000019D6 8915[7C210000]          	mov	[next_val_l], edx
  3704                                  	; 26/11/2023
  3705 000019DC C1EA10                  	shr	edx, 16
  3706                                  	;mov	[next_val_r], dx
  3707 000019DF 49                      	dec	ecx
  3708 000019E0 7509                    	jnz	short lff11s2_2_1
  3709 000019E2 31D2                    	xor	edx, edx ; 0
  3710 000019E4 668915[7C210000]        	mov	[next_val_l], dx
  3711                                  	;mov	[next_val_r], dx
  3712                                  lff11s2_2_1:
  3713                                  	; bx = [previous_val_l]
  3714                                  	; ax = [previous_val_r]
  3715                                  	; [next_val_l]
  3716                                  	; dx = [next_val_r]
  3717 000019EB E803060000              	call	interpolating_5_16bit_stereo
  3718 000019F0 E3D0                    	jecxz	lff11s2_3
  3719                                  lff11s2_2_2:
  3720 000019F2 66AD                    	lodsw
  3721 000019F4 89C3                    	mov	ebx, eax
  3722 000019F6 66AD                    	lodsw
  3723 000019F8 8B16                    	mov	edx, [esi]
  3724 000019FA 668915[7C210000]        	mov	[next_val_l], dx
  3725                                  	; 26/11/2023
  3726 00001A01 C1EA10                  	shr	edx, 16
  3727                                  	;mov	[next_val_r], dx
  3728 00001A04 49                      	dec	ecx
  3729 00001A05 7509                    	jnz	short lff11s2_2_3
  3730 00001A07 31D2                    	xor	edx, edx ; 0
  3731 00001A09 668915[7C210000]        	mov	[next_val_l], dx
  3732                                  	;mov	[next_val_r], dx
  3733                                  lff11s2_2_3:
  3734 00001A10 E8E6060000               	call	interpolating_4_16bit_stereo
  3735 00001A15 E3AB                    	jecxz	lff11s2_3
  3736                                  	
  3737 00001A17 4D                      	dec	ebp
  3738 00001A18 74AF                    	jz	short lff11s2_9
  3739                                  
  3740 00001A1A 66AD                    	lodsw
  3741 00001A1C 89C3                    	mov	ebx, eax
  3742 00001A1E 66AD                    	lodsw
  3743 00001A20 8B16                    	mov	edx, [esi]
  3744 00001A22 668915[7C210000]        	mov	[next_val_l], dx
  3745                                  	; 26/11/2023
  3746 00001A29 C1EA10                  	shr	edx, 16
  3747                                  	;mov	[next_val_r], dx
  3748 00001A2C 49                      	dec	ecx
  3749 00001A2D 7509                    	jnz	short lff11s2_2_4
  3750 00001A2F 31D2                    	xor	edx, edx ; 0
  3751 00001A31 668915[7C210000]        	mov	[next_val_l], dx
  3752                                  	;mov	[next_val_r], dx
  3753                                  lff11s2_2_4:
  3754 00001A38 E8BE060000               	call	interpolating_4_16bit_stereo
  3755 00001A3D E383                    	jecxz	lff11s2_3
  3756 00001A3F EB8D                    	jmp	short lff11s2_1
  3757                                  
  3758                                  ; .....................
  3759                                  
  3760                                  load_44khz_mono_8_bit:
  3761                                  	; 18/11/2023
  3762 00001A41 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3763                                  					; last of the file?
  3764 00001A48 7402                    	jz	short lff44m_0		; no
  3765 00001A4A F9                      	stc
  3766 00001A4B C3                      	retn
  3767                                  
  3768                                  lff44m_0:
  3769                                  	; 01/12/2024
  3770                                  	; edi = audio buffer address
  3771 00001A4C BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3772                                          ;mov	edx, [loadsize]
  3773                                  
  3774                                  	; esi = buffer address
  3775                                  	;; edx = buffer size
  3776                                  
  3777                                  	; load file into memory
  3778                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001A51 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001A57 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001A59 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001A5F B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001A64 CD40                <1>  int 40h
  3779 00001A66 7250                    	jc	short lff44m_7 ; error !
  3780                                  
  3781                                  	; 01/12/2024
  3782 00001A68 A3[94730000]            	mov	[count], eax
  3783                                  	;;;
  3784                                  	; 07/12/2024
  3785                                  	;mov	edi, audio_buffer
  3786                                  	;;;
  3787 00001A6D 21C0                    	and	eax, eax
  3788 00001A6F 7505                    	jnz	short lff44m_8
  3789 00001A71 E98BF1FFFF              	jmp	lff44_eof
  3790                                  
  3791                                  lff44m_8:
  3792 00001A76 89C1                    	mov	ecx, eax	; byte count
  3793                                  lff44m_9:
  3794 00001A78 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3795 00001A7D C605[80210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3796                                  lff44m_1:
  3797                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3798                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3799 00001A84 AC                      	lodsb
  3800 00001A85 B280                    	mov	dl, 80h
  3801 00001A87 49                      	dec	ecx
  3802 00001A88 7402                    	jz	short lff44m_2_1
  3803 00001A8A 8A16                    	mov	dl, [esi]
  3804                                  lff44m_2_1:	
  3805                                  	; al = [previous_val]
  3806                                  	; dl = [next_val]
  3807 00001A8C E825020000              	call	interpolating_2_8bit_mono
  3808 00001A91 E320                    	jecxz	lff44m_3
  3809                                  lff44m_2_2:
  3810 00001A93 AC                      	lodsb
  3811 00001A94 2C80                    	sub	al, 80h
  3812 00001A96 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3813 00001A9A 66AB                    	stosw		; (L)
  3814 00001A9C 66AB                    	stosw		; (R)
  3815                                  
  3816 00001A9E 49                      	dec	ecx
  3817 00001A9F 7412                    	jz	short lff44m_3
  3818 00001AA1 4D                      	dec	ebp
  3819 00001AA2 75EF                    	jnz	short lff44m_2_2
  3820                                  	
  3821 00001AA4 FE0D[80210000]          	dec	byte [faz]
  3822 00001AAA 74CC                    	jz	short lff44m_9 
  3823 00001AAC BD0B000000              	mov	ebp, 11
  3824 00001AB1 EBD1                    	jmp	short lff44m_1
  3825                                  
  3826                                  lff44m_3:
  3827                                  lff44s_3:
  3828 00001AB3 E931F1FFFF              	jmp	lff44_3	; padfill
  3829                                  		; (put zeros in the remain words of the buffer)
  3830                                  lff44m_7:
  3831                                  lff44s_7:
  3832 00001AB8 E94DF1FFFF              	jmp	lff44_5  ; error
  3833                                  
  3834                                  load_44khz_stereo_8_bit:
  3835                                  	; 16/11/2023
  3836 00001ABD F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3837                                  					; last of the file?
  3838 00001AC4 7402                    	jz	short lff44s_0		; no
  3839 00001AC6 F9                      	stc
  3840 00001AC7 C3                      	retn
  3841                                  
  3842                                  lff44s_0:
  3843                                  	; 01/12/2024
  3844                                  	; edi = audio buffer address
  3845 00001AC8 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3846                                          ;mov	edx, [loadsize]
  3847                                  
  3848                                  	; esi = buffer address
  3849                                  	;; edx = buffer size
  3850                                  
  3851                                  	; load file into memory
  3852                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001ACD 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001AD3 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001AD5 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001ADB B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001AE0 CD40                <1>  int 40h
  3853 00001AE2 72D4                    	jc	short lff44s_7 ; error !
  3854                                  
  3855                                  	; 01/12/2024
  3856 00001AE4 A3[94730000]            	mov	[count], eax
  3857                                  	;;;
  3858                                  	; 07/12/2024
  3859                                  	;mov	edi, audio_buffer
  3860                                  	;;;
  3861 00001AE9 D1E8                    	shr	eax, 1
  3862 00001AEB 7505                    	jnz	short lff44s_8
  3863 00001AED E90FF1FFFF              	jmp	lff44_eof
  3864                                  
  3865                                  lff44s_8:
  3866 00001AF2 89C1                    	mov	ecx, eax	; word count
  3867                                  lff44s_9:
  3868 00001AF4 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3869 00001AF9 C605[80210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3870                                  lff44s_1:
  3871                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3872                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3873 00001B00 66AD                    	lodsw
  3874 00001B02 66BA8080                	mov	dx, 8080h
  3875 00001B06 49                      	dec	ecx
  3876 00001B07 7403                    	jz	short lff44s_2_1
  3877 00001B09 668B16                  	mov	dx, [esi]
  3878                                  lff44s_2_1:	
  3879                                  	; al = [previous_val_l]
  3880                                  	; ah = [previous_val_r]
  3881                                  	; dl = [next_val_l]
  3882                                  	; dh = [next_val_r]
  3883 00001B0C E8C2010000              	call	interpolating_2_8bit_stereo
  3884 00001B11 E3A0                    	jecxz	lff44s_3
  3885                                  lff44s_2_2:
  3886 00001B13 AC                      	lodsb
  3887 00001B14 2C80                    	sub	al, 80h
  3888 00001B16 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3889 00001B1A 66AB                    	stosw		; (L)
  3890 00001B1C AC                      	lodsb
  3891 00001B1D 2C80                    	sub	al, 80h
  3892 00001B1F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3893 00001B23 66AB                    	stosw		; (R)
  3894                                  
  3895 00001B25 49                      	dec	ecx
  3896 00001B26 748B                    	jz	short lff44s_3	
  3897 00001B28 4D                      	dec	ebp
  3898 00001B29 75E8                    	jnz	short lff44s_2_2
  3899                                  	
  3900 00001B2B FE0D[80210000]          	dec	byte [faz]
  3901 00001B31 74C1                    	jz	short lff44s_9 
  3902 00001B33 BD0B000000              	mov	ebp, 11
  3903 00001B38 EBC6                    	jmp	short lff44s_1
  3904                                  
  3905                                  load_44khz_mono_16_bit:
  3906                                  	; 18/11/2023
  3907 00001B3A F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3908                                  					; last of the file?
  3909 00001B41 7402                    	jz	short lff44m2_0		; no
  3910 00001B43 F9                      	stc
  3911 00001B44 C3                      	retn
  3912                                  
  3913                                  lff44m2_0:
  3914                                  	; 01/12/2024
  3915                                  	; edi = audio buffer address
  3916 00001B45 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3917                                          ;mov	edx, [loadsize]
  3918                                  
  3919                                  	; esi = buffer address
  3920                                  	;; edx = buffer size
  3921                                  
  3922                                  	; load file into memory
  3923                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001B4A 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001B50 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001B52 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001B58 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001B5D CD40                <1>  int 40h
  3924 00001B5F 724D                    	jc	short lff44m2_7 ; error !
  3925                                  
  3926                                  	; 01/12/2024
  3927 00001B61 A3[94730000]            	mov	[count], eax
  3928                                  	;;;
  3929                                  	; 07/12/2024
  3930                                  	;mov	edi, audio_buffer
  3931                                  	;;;
  3932 00001B66 D1E8                    	shr	eax, 1
  3933 00001B68 7505                    	jnz	short lff44m2_8
  3934 00001B6A E992F0FFFF              	jmp	lff44_eof
  3935                                  
  3936                                  lff44m2_8:
  3937 00001B6F 89C1                    	mov	ecx, eax	; word count
  3938                                  lff44m2_9:
  3939 00001B71 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3940 00001B76 C605[80210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3941                                  lff44m2_1:
  3942                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3943                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3944 00001B7D 66AD                    	lodsw
  3945 00001B7F 31D2                    	xor	edx, edx
  3946 00001B81 49                      	dec	ecx
  3947 00001B82 7403                    	jz	short lff44m2_2_1
  3948 00001B84 668B16                  	mov	dx, [esi]
  3949                                  lff44m2_2_1:	
  3950                                  	; ax = [previous_val]
  3951                                  	; dx = [next_val]
  3952 00001B87 E80B020000              	call	interpolating_2_16bit_mono
  3953 00001B8C E31B                    	jecxz	lff44m2_3
  3954                                  lff44m2_2_2:
  3955 00001B8E 66AD                    	lodsw
  3956 00001B90 66AB                    	stosw		; (L)eft Channel
  3957 00001B92 66AB                    	stosw		; (R)ight Channel
  3958                                  
  3959 00001B94 49                      	dec	ecx
  3960 00001B95 7412                    	jz	short lff44m2_3	
  3961 00001B97 4D                      	dec	ebp
  3962 00001B98 75F4                    	jnz	short lff44m2_2_2
  3963                                  	
  3964 00001B9A FE0D[80210000]          	dec	byte [faz]
  3965 00001BA0 74CF                    	jz	short lff44m2_9 
  3966 00001BA2 BD0B000000              	mov	ebp, 11
  3967 00001BA7 EBD4                    	jmp	short lff44m2_1
  3968                                  
  3969                                  lff44m2_3:
  3970                                  lff44s2_3:
  3971 00001BA9 E93BF0FFFF              	jmp	lff44_3	; padfill
  3972                                  		; (put zeros in the remain words of the buffer)
  3973                                  lff44m2_7:
  3974                                  lff44s2_7:
  3975 00001BAE E957F0FFFF              	jmp	lff44_5  ; error
  3976                                  
  3977                                  load_44khz_stereo_16_bit:
  3978                                  	; 18/11/2023
  3979 00001BB3 F605[1A730000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3980                                  					; last of the file?
  3981 00001BBA 7402                    	jz	short lff44s2_0		; no
  3982 00001BBC F9                      	stc
  3983 00001BBD C3                      	retn
  3984                                  
  3985                                  lff44s2_0:
  3986                                  	; 01/12/2024
  3987                                  	; edi = audio buffer address
  3988 00001BBE BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3989                                          ;mov	edx, [loadsize]
  3990                                  
  3991                                  	; esi = buffer address
  3992                                  	;; edx = buffer size
  3993                                  
  3994                                  	; load file into memory
  3995                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001BC3 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001BC9 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001BCB 8B15[84730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001BD1 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001BD6 CD40                <1>  int 40h
  3996 00001BD8 72D4                    	jc	short lff44s2_7 ; error !
  3997                                  
  3998                                  	; 01/12/2024
  3999 00001BDA A3[94730000]            	mov	[count], eax
  4000                                  	;;;
  4001                                  	; 07/12/2024
  4002                                  	;mov	edi, audio_buffer
  4003                                  	;;;
  4004 00001BDF C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4005 00001BE2 7505                    	jnz	short lff44s2_8
  4006 00001BE4 E918F0FFFF              	jmp	lff44_eof
  4007                                  
  4008                                  lff44s2_8:
  4009 00001BE9 89C1                    	mov	ecx, eax	; dword count
  4010                                  lff44s2_9:
  4011 00001BEB BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4012 00001BF0 C605[80210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4013                                  lff44s2_1:
  4014                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4015                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4016 00001BF7 66AD                    	lodsw
  4017 00001BF9 89C3                    	mov	ebx, eax
  4018 00001BFB 66AD                    	lodsw
  4019                                  	;mov	dx, [esi]
  4020                                  	;mov	[next_val_l], dx
  4021                                  	;mov	dx, [esi+2]
  4022                                  	; 26/11/2023
  4023 00001BFD 8B16                    	mov	edx, [esi]
  4024 00001BFF 668915[7C210000]        	mov	[next_val_l], dx
  4025 00001C06 C1EA10                  	shr	edx, 16
  4026 00001C09 49                      	dec	ecx
  4027 00001C0A 7509                    	jnz	short lff44s2_2_1
  4028 00001C0C 31D2                    	xor	edx, edx ; 0
  4029 00001C0E 668915[7C210000]        	mov	[next_val_l], dx
  4030                                  lff44s2_2_1:
  4031                                  	; bx = [previous_val_l]
  4032                                  	; ax = [previous_val_r]
  4033                                  	; [next_val_l]
  4034                                  	; dx = [next_val_r]
  4035 00001C15 E895010000              	call	interpolating_2_16bit_stereo
  4036 00001C1A E38D                    	jecxz	lff44s2_3
  4037                                  lff44s2_2_2:
  4038                                  	;movsw		; (L)eft Channel
  4039                                  	;movsw		; (R)ight Channel
  4040 00001C1C A5                      	movsd
  4041                                  
  4042 00001C1D 49                      	dec	ecx
  4043 00001C1E 7489                    	jz	short lff44s2_3	
  4044 00001C20 4D                      	dec	ebp
  4045 00001C21 75F9                    	jnz	short lff44s2_2_2
  4046                                  	
  4047 00001C23 FE0D[80210000]          	dec	byte [faz]
  4048 00001C29 74C0                    	jz	short lff44s2_9 
  4049 00001C2B BD0B000000              	mov	ebp, 11
  4050 00001C30 EBC5                    	jmp	short lff44s2_1
  4051                                  
  4052                                  ; .....................
  4053                                  
  4054                                  interpolating_3_8bit_mono:
  4055                                  	; 16/11/2023
  4056                                  	; al = [previous_val]
  4057                                  	; dl = [next_val]
  4058                                  	; original-interpolated-interpolated
  4059 00001C32 88C3                    	mov	bl, al
  4060 00001C34 2C80                    	sub	al, 80h
  4061 00001C36 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4062 00001C3A 66AB                    	stosw		; original sample (L)
  4063 00001C3C 66AB                    	stosw		; original sample (R)
  4064 00001C3E 88D8                    	mov	al, bl
  4065 00001C40 00D0                    	add	al, dl
  4066 00001C42 D0D8                    	rcr	al, 1
  4067 00001C44 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4068 00001C46 00D8                    	add	al, bl
  4069 00001C48 D0D8                    	rcr	al, 1
  4070 00001C4A 2C80                    	sub	al, 80h
  4071 00001C4C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4072 00001C50 66AB                    	stosw		; interpolated sample 1 (L)
  4073 00001C52 66AB                    	stosw		; interpolated sample 1 (R)
  4074 00001C54 88F8                    	mov	al, bh
  4075 00001C56 00D0                    	add	al, dl	; [next_val]
  4076 00001C58 D0D8                    	rcr	al, 1
  4077 00001C5A 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4078 00001C5E 66AB                    	stosw		; interpolated sample 2 (L)
  4079 00001C60 66AB                    	stosw		; interpolated sample 2 (R)
  4080 00001C62 C3                      	retn
  4081                                  
  4082                                  interpolating_3_8bit_stereo:
  4083                                  	; 16/11/2023
  4084                                  	; al = [previous_val_l]
  4085                                  	; ah = [previous_val_r]
  4086                                  	; dl = [next_val_l]
  4087                                  	; dh = [next_val_r]
  4088                                  	; original-interpolated-interpolated
  4089 00001C63 89C3                    	mov	ebx, eax
  4090 00001C65 2C80                    	sub	al, 80h
  4091 00001C67 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4092 00001C6B 66AB                    	stosw		; original sample (L)
  4093 00001C6D 88F8                    	mov	al, bh
  4094 00001C6F 2C80                    	sub	al, 80h
  4095 00001C71 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4096 00001C75 66AB                    	stosw		; original sample (R)
  4097 00001C77 88D8                    	mov	al, bl
  4098 00001C79 00D0                    	add	al, dl	; [next_val_l]
  4099 00001C7B D0D8                    	rcr	al, 1
  4100 00001C7D 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4101 00001C7E 00D8                    	add	al, bl	; [previous_val_l]
  4102 00001C80 D0D8                    	rcr	al, 1
  4103 00001C82 2C80                    	sub	al, 80h
  4104 00001C84 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4105 00001C88 66AB                    	stosw		; interpolated sample 1 (L)
  4106 00001C8A 88F8                    	mov	al, bh
  4107 00001C8C 00F0                    	add	al, dh	; [next_val_r]
  4108 00001C8E D0D8                    	rcr	al, 1
  4109 00001C90 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4110 00001C91 00F8                    	add	al, bh	; [previous_val_r]
  4111 00001C93 D0D8                    	rcr	al, 1
  4112 00001C95 2C80                    	sub	al, 80h
  4113 00001C97 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4114 00001C9B 66AB                    	stosw		; interpolated sample 1 (R)
  4115 00001C9D 5B                      	pop	ebx ; **
  4116 00001C9E 58                      	pop	eax ; *
  4117 00001C9F 00D0                    	add	al, dl	; [next_val_l]
  4118 00001CA1 D0D8                    	rcr	al, 1
  4119 00001CA3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4120 00001CA7 66AB                    	stosw		; interpolated sample 2 (L)
  4121 00001CA9 88D8                    	mov	al, bl
  4122 00001CAB 00F0                    	add	al, dh	; [next_val_r]
  4123 00001CAD D0D8                    	rcr	al, 1
  4124 00001CAF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4125 00001CB3 66AB                    	stosw		; interpolated sample 2 (R)
  4126 00001CB5 C3                      	retn
  4127                                  
  4128                                  interpolating_2_8bit_mono:
  4129                                  	; 16/11/2023
  4130                                  	; al = [previous_val]
  4131                                  	; dl = [next_val]
  4132                                  	; original-interpolated
  4133 00001CB6 88C3                    	mov	bl, al
  4134 00001CB8 2C80                    	sub	al, 80h
  4135 00001CBA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4136 00001CBE 66AB                    	stosw		; original sample (L)
  4137 00001CC0 66AB                    	stosw		; original sample (R)
  4138 00001CC2 88D8                    	mov	al, bl
  4139 00001CC4 00D0                    	add	al, dl
  4140 00001CC6 D0D8                    	rcr	al, 1
  4141 00001CC8 2C80                    	sub	al, 80h
  4142 00001CCA 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4143 00001CCE 66AB                    	stosw		; interpolated sample (L)
  4144 00001CD0 66AB                    	stosw		; interpolated sample (R)
  4145 00001CD2 C3                      	retn
  4146                                  
  4147                                  interpolating_2_8bit_stereo:
  4148                                  	; 16/11/2023
  4149                                  	; al = [previous_val_l]
  4150                                  	; ah = [previous_val_r]
  4151                                  	; dl = [next_val_l]
  4152                                  	; dh = [next_val_r]
  4153                                  	; original-interpolated
  4154 00001CD3 89C3                    	mov	ebx, eax
  4155 00001CD5 2C80                    	sub	al, 80h
  4156 00001CD7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4157 00001CDB 66AB                    	stosw		; original sample (L)
  4158 00001CDD 88F8                    	mov	al, bh
  4159 00001CDF 2C80                    	sub	al, 80h
  4160 00001CE1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4161 00001CE5 66AB                    	stosw		; original sample (R)
  4162 00001CE7 88D8                    	mov	al, bl	; [previous_val_l]
  4163 00001CE9 00D0                    	add	al, dl	; [next_val_l]
  4164 00001CEB D0D8                    	rcr	al, 1
  4165 00001CED 2C80                    	sub	al, 80h
  4166 00001CEF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4167 00001CF3 66AB                    	stosw		; interpolated sample (L)
  4168 00001CF5 88F8                    	mov	al, bh
  4169 00001CF7 00F0                    	add	al, dh	; [next_val_r]
  4170 00001CF9 D0D8                    	rcr	al, 1
  4171 00001CFB 2C80                    	sub	al, 80h
  4172 00001CFD 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4173 00001D01 66AB                    	stosw		; interpolated sample (R)
  4174 00001D03 C3                      	retn
  4175                                  
  4176                                  interpolating_3_16bit_mono:
  4177                                  	; 16/11/2023
  4178                                  	; ax = [previous_val]
  4179                                  	; dx = [next_val]
  4180                                  	; original-interpolated-interpolated
  4181                                  
  4182 00001D04 66AB                    	stosw		; original sample (L)
  4183 00001D06 66AB                    	stosw		; original sample (R)
  4184 00001D08 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4185 00001D0B 50                      	push	eax ; *	; [previous_val]
  4186 00001D0C 80C680                  	add	dh, 80h
  4187 00001D0F 6601D0                  	add	ax, dx
  4188 00001D12 66D1D8                  	rcr	ax, 1
  4189 00001D15 5B                      	pop	ebx ; *
  4190 00001D16 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4191 00001D17 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4192 00001D1A 66D1D8                  	rcr	ax, 1
  4193 00001D1D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4194 00001D20 66AB                    	stosw 		; interpolated sample 1 (L)
  4195 00001D22 66AB                    	stosw		; interpolated sample 1 (R)
  4196 00001D24 89D8                    	mov	eax, ebx
  4197 00001D26 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4198 00001D29 66D1D8                  	rcr	ax, 1
  4199 00001D2C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4200 00001D2F 66AB                    	stosw		; interpolated sample 2 (L)
  4201 00001D31 66AB                    	stosw		; interpolated sample 2 (R)
  4202 00001D33 C3                      	retn
  4203                                  
  4204                                  interpolating_3_16bit_stereo:
  4205                                  	; 16/11/2023
  4206                                  	; bx = [previous_val_l]
  4207                                  	; ax = [previous_val_r]
  4208                                  	; [next_val_l]
  4209                                  	; dx = [next_val_r]
  4210                                  	; original-interpolated-interpolated
  4211                                  
  4212 00001D34 93                      	xchg	eax, ebx
  4213 00001D35 66AB                    	stosw		; original sample (L)
  4214 00001D37 93                      	xchg	eax, ebx
  4215 00001D38 66AB                    	stosw		; original sample (R)
  4216 00001D3A 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4217 00001D3D 50                      	push	eax ; *	; [previous_val_r]
  4218 00001D3E 80C780                  	add	bh, 80h
  4219 00001D41 8005[7D210000]80        	add	byte [next_val_l+1], 80h
  4220 00001D48 66A1[7C210000]          	mov	ax, [next_val_l]
  4221 00001D4E 6601D8                  	add	ax, bx	; [previous_val_l]
  4222 00001D51 66D1D8                  	rcr	ax, 1
  4223 00001D54 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4224 00001D55 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4225 00001D58 66D1D8                  	rcr	ax, 1
  4226 00001D5B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4227 00001D5E 66AB                    	stosw 		; interpolated sample 1 (L)
  4228 00001D60 58                      	pop	eax  ; *
  4229 00001D61 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4230 00001D64 52                      	push	edx  ; * ; [next_val_r]
  4231 00001D65 92                      	xchg	eax, edx
  4232 00001D66 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4233 00001D69 66D1D8                  	rcr	ax, 1	; / 2
  4234 00001D6C 50                      	push	eax ; ** ; interpolated middle (R)
  4235 00001D6D 6601D0                  	add	ax, dx	; + [previous_val_r]
  4236 00001D70 66D1D8                  	rcr	ax, 1
  4237 00001D73 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4238 00001D76 66AB                    	stosw 		; interpolated sample 1 (R)
  4239 00001D78 66A1[7C210000]          	mov	ax, [next_val_l]
  4240 00001D7E 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4241 00001D81 66D1D8                  	rcr	ax, 1
  4242 00001D84 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4243 00001D87 66AB                    	stosw 		; interpolated sample 2 (L)
  4244 00001D89 58                      	pop	eax ; **
  4245 00001D8A 5A                      	pop	edx ; *
  4246 00001D8B 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4247 00001D8E 66D1D8                  	rcr	ax, 1	; / 2
  4248 00001D91 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4249 00001D94 66AB                    	stosw 		; interpolated sample 2 (L)
  4250 00001D96 C3                      	retn
  4251                                  
  4252                                  interpolating_2_16bit_mono:
  4253                                  	; 16/11/2023
  4254                                  	; ax = [previous_val]
  4255                                  	; dx = [next_val]
  4256                                  	; original-interpolated
  4257                                  
  4258 00001D97 66AB                    	stosw		; original sample (L)
  4259 00001D99 66AB                    	stosw		; original sample (R)
  4260 00001D9B 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4261 00001D9E 80C680                  	add	dh, 80h
  4262 00001DA1 6601D0                  	add	ax, dx
  4263 00001DA4 66D1D8                  	rcr	ax, 1
  4264 00001DA7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4265 00001DAA 66AB                    	stosw		; interpolated sample (L)
  4266 00001DAC 66AB                    	stosw		; interpolated sample (R)
  4267 00001DAE C3                      	retn
  4268                                  
  4269                                  interpolating_2_16bit_stereo:
  4270                                  	; 16/11/2023
  4271                                  	; bx = [previous_val_l]
  4272                                  	; ax = [previous_val_r]
  4273                                  	; [next_val_l]
  4274                                  	; dx = [next_val_r]
  4275                                  	; original-interpolated
  4276                                  
  4277 00001DAF 93                      	xchg	eax, ebx
  4278 00001DB0 66AB                    	stosw		; original sample (L)
  4279 00001DB2 93                      	xchg	eax, ebx
  4280 00001DB3 66AB                    	stosw		; original sample (R)
  4281 00001DB5 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4282 00001DB8 80C680                  	add	dh, 80h
  4283 00001DBB 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4284 00001DBE 66D1D8                  	rcr	ax, 1	; / 2
  4285 00001DC1 50                      	push	eax ; *	; interpolated sample (R)
  4286 00001DC2 66A1[7C210000]          	mov	ax, [next_val_l]
  4287 00001DC8 80C480                  	add	ah, 80h
  4288 00001DCB 80C780                  	add	bh, 80h
  4289 00001DCE 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4290 00001DD1 66D1D8                  	rcr	ax, 1	; / 2
  4291 00001DD4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4292 00001DD7 66AB                    	stosw 		; interpolated sample (L)
  4293 00001DD9 58                      	pop	eax ; *	
  4294 00001DDA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4295 00001DDD 66AB                    	stosw 		; interpolated sample (R)
  4296 00001DDF C3                      	retn
  4297                                  
  4298                                  interpolating_5_8bit_mono:
  4299                                  	; 17/11/2023
  4300                                  	; al = [previous_val]
  4301                                  	; dl = [next_val]
  4302                                  	; original-interpltd-interpltd-interpltd-interpltd
  4303 00001DE0 88C3                    	mov	bl, al
  4304 00001DE2 2C80                    	sub	al, 80h
  4305 00001DE4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4306 00001DE8 66AB                    	stosw		; original sample (L)
  4307 00001DEA 66AB                    	stosw		; original sample (R)
  4308 00001DEC 88D8                    	mov	al, bl
  4309 00001DEE 00D0                    	add	al, dl
  4310 00001DF0 D0D8                    	rcr	al, 1
  4311 00001DF2 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4312 00001DF4 00D8                    	add	al, bl  ; [previous_val]
  4313 00001DF6 D0D8                    	rcr	al, 1 	
  4314 00001DF8 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4315 00001DFA 00D8                    	add	al, bl
  4316 00001DFC D0D8                    	rcr	al, 1
  4317 00001DFE 2C80                    	sub	al, 80h
  4318 00001E00 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4319 00001E04 66AB                    	stosw		; interpolated sample 1 (L)
  4320 00001E06 66AB                    	stosw		; interpolated sample 1 (R)
  4321 00001E08 88F8                    	mov	al, bh
  4322 00001E0A 00F0                    	add	al, dh
  4323 00001E0C D0D8                    	rcr	al, 1
  4324 00001E0E 2C80                    	sub	al, 80h
  4325 00001E10 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4326 00001E14 66AB                    	stosw		; interpolated sample 2 (L)
  4327 00001E16 66AB                    	stosw		; interpolated sample 2 (R)
  4328 00001E18 88F8                    	mov	al, bh
  4329 00001E1A 00D0                    	add	al, dl	; [next_val]
  4330 00001E1C D0D8                    	rcr	al, 1
  4331 00001E1E 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4332 00001E20 00F8                    	add	al, bh
  4333 00001E22 D0D8                    	rcr	al, 1
  4334 00001E24 2C80                    	sub	al, 80h
  4335 00001E26 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4336 00001E2A 66AB                    	stosw		; interpolated sample 3 (L)
  4337 00001E2C 66AB                    	stosw		; interpolated sample 3 (R)
  4338 00001E2E 88F0                    	mov	al, dh
  4339 00001E30 00D0                    	add	al, dl
  4340 00001E32 D0D8                    	rcr	al, 1
  4341 00001E34 2C80                    	sub	al, 80h
  4342 00001E36 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4343 00001E3A 66AB                    	stosw		; interpolated sample 4 (L)
  4344 00001E3C 66AB                    	stosw		; interpolated sample 4 (R)
  4345 00001E3E C3                      	retn
  4346                                  
  4347                                  interpolating_5_8bit_stereo:
  4348                                  	; 17/11/2023
  4349                                  	; al = [previous_val_l]
  4350                                  	; ah = [previous_val_r]
  4351                                  	; dl = [next_val_l]
  4352                                  	; dh = [next_val_r]
  4353                                  	; original-interpltd-interpltd-interpltd-interpltd
  4354 00001E3F 89C3                    	mov	ebx, eax
  4355 00001E41 2C80                    	sub	al, 80h
  4356 00001E43 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4357 00001E47 66AB                    	stosw		; original sample (L)
  4358 00001E49 88F8                    	mov	al, bh
  4359 00001E4B 2C80                    	sub	al, 80h
  4360 00001E4D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4361 00001E51 66AB                    	stosw		; original sample (R)
  4362 00001E53 52                      	push	edx ; *
  4363 00001E54 88D8                    	mov	al, bl
  4364 00001E56 00D0                    	add	al, dl	; [next_val_l]
  4365 00001E58 D0D8                    	rcr	al, 1
  4366 00001E5A 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4367 00001E5B 00D8                    	add	al, bl	; [previous_val_l]
  4368 00001E5D D0D8                    	rcr	al, 1
  4369 00001E5F 86D8                    	xchg	al, bl
  4370 00001E61 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4371 00001E63 D0D8                    	rcr	al, 1
  4372 00001E65 2C80                    	sub	al, 80h
  4373 00001E67 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4374 00001E6B 66AB                    	stosw		; interpolated sample 1 (L)
  4375 00001E6D 88F8                    	mov	al, bh
  4376 00001E6F 00F0                    	add	al, dh	; [next_val_r]
  4377 00001E71 D0D8                    	rcr	al, 1
  4378 00001E73 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4379 00001E74 00F8                    	add	al, bh	; [previous_val_r]
  4380 00001E76 D0D8                    	rcr	al, 1
  4381 00001E78 86F8                    	xchg	al, bh
  4382 00001E7A 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4383 00001E7C D0D8                    	rcr	al, 1
  4384 00001E7E 2C80                    	sub	al, 80h
  4385 00001E80 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4386 00001E84 66AB                    	stosw		; interpolated sample 1 (R)
  4387 00001E86 5A                      	pop	edx ; ***
  4388 00001E87 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4389 00001E88 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4390 00001E8A 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4391 00001E8C D0D8                    	rcr	al, 1
  4392 00001E8E 2C80                    	sub	al, 80h
  4393 00001E90 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4394 00001E94 66AB                    	stosw		; interpolated sample 2 (L)
  4395 00001E96 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4396 00001E98 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4397 00001E9A 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4398 00001E9C D0D8                    	rcr	al, 1
  4399 00001E9E 2C80                    	sub	al, 80h
  4400 00001EA0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4401 00001EA4 66AB                    	stosw		; interpolated sample 2 (R)
  4402 00001EA6 5A                      	pop	edx ; *
  4403 00001EA7 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4404 00001EA9 00D0                    	add	al, dl	; [next_val_l]
  4405 00001EAB D0D8                    	rcr	al, 1
  4406 00001EAD 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4407 00001EAF 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4408 00001EB1 D0D8                    	rcr	al, 1
  4409 00001EB3 2C80                    	sub	al, 80h
  4410 00001EB5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4411 00001EB9 66AB                    	stosw		; interpolated sample 3 (L)
  4412 00001EBB 88F8                    	mov	al, bh	
  4413 00001EBD 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4414 00001EBF D0D8                    	rcr	al, 1
  4415 00001EC1 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4416 00001EC3 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4417 00001EC5 D0D8                    	rcr	al, 1
  4418 00001EC7 2C80                    	sub	al, 80h
  4419 00001EC9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4420 00001ECD 66AB                    	stosw		; interpolated sample 3 (R)
  4421 00001ECF 88D8                    	mov	al, bl
  4422 00001ED1 00D0                    	add	al, dl	; [next_val_l]
  4423 00001ED3 D0D8                    	rcr	al, 1
  4424 00001ED5 2C80                    	sub	al, 80h
  4425 00001ED7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4426 00001EDB 66AB                    	stosw		; interpolated sample 4 (L)
  4427 00001EDD 88F8                    	mov	al, bh
  4428 00001EDF 00F0                    	add	al, dh	; [next_val_r]
  4429 00001EE1 D0D8                    	rcr	al, 1
  4430 00001EE3 2C80                    	sub	al, 80h
  4431 00001EE5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4432 00001EE9 66AB                    	stosw		; interpolated sample 4 (R)
  4433 00001EEB C3                      	retn
  4434                                  
  4435                                  interpolating_4_8bit_mono:
  4436                                  	; 17/11/2023
  4437                                  	; al = [previous_val]
  4438                                  	; dl = [next_val]
  4439                                  	; original-interpolated-interpolated-interpolated
  4440 00001EEC 88C3                    	mov	bl, al
  4441 00001EEE 2C80                    	sub	al, 80h
  4442 00001EF0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4443 00001EF4 66AB                    	stosw		; original sample (L)
  4444 00001EF6 66AB                    	stosw		; original sample (R)
  4445 00001EF8 88D8                    	mov	al, bl
  4446 00001EFA 00D0                    	add	al, dl	
  4447 00001EFC D0D8                    	rcr	al, 1
  4448 00001EFE 86D8                    	xchg	al, bl  ; al = [previous_val]
  4449 00001F00 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4450 00001F02 D0D8                    	rcr	al, 1 	
  4451 00001F04 2C80                    	sub	al, 80h
  4452 00001F06 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4453 00001F0A 66AB                    	stosw		; interpolated sample 1 (L)
  4454 00001F0C 66AB                    	stosw		; interpolated sample 1 (R)
  4455 00001F0E 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4456 00001F10 2C80                    	sub	al, 80h
  4457 00001F12 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4458 00001F16 66AB                    	stosw		; interpolated sample 2 (L)
  4459 00001F18 66AB                    	stosw		; interpolated sample 2 (R)
  4460 00001F1A 88D8                    	mov	al, bl
  4461 00001F1C 00D0                    	add	al, dl	; [next_val]
  4462 00001F1E D0D8                    	rcr	al, 1
  4463 00001F20 2C80                    	sub	al, 80h
  4464 00001F22 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4465 00001F26 66AB                    	stosw		; interpolated sample 3 (L)
  4466 00001F28 66AB                    	stosw		; interpolated sample 3 (R)
  4467 00001F2A C3                      	retn
  4468                                  
  4469                                  interpolating_4_8bit_stereo:
  4470                                  	; 17/11/2023
  4471                                  	; al = [previous_val_l]
  4472                                  	; ah = [previous_val_r]
  4473                                  	; dl = [next_val_l]
  4474                                  	; dh = [next_val_r]	
  4475                                  	; original-interpolated-interpolated-interpolated
  4476 00001F2B 89C3                    	mov	ebx, eax
  4477 00001F2D 2C80                    	sub	al, 80h
  4478 00001F2F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4479 00001F33 66AB                    	stosw		; original sample (L)
  4480 00001F35 88F8                    	mov	al, bh
  4481 00001F37 2C80                    	sub	al, 80h
  4482 00001F39 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4483 00001F3D 66AB                    	stosw		; original sample (R)
  4484 00001F3F 88D8                    	mov	al, bl
  4485 00001F41 00D0                    	add	al, dl	; [next_val_l]
  4486 00001F43 D0D8                    	rcr	al, 1
  4487 00001F45 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4488 00001F47 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4489 00001F49 D0D8                    	rcr	al, 1
  4490 00001F4B 2C80                    	sub	al, 80h
  4491 00001F4D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4492 00001F51 66AB                    	stosw		; interpolated sample 1 (L)
  4493 00001F53 88F8                    	mov	al, bh
  4494 00001F55 00F0                    	add	al, dh	; [next_val_r]
  4495 00001F57 D0D8                    	rcr	al, 1
  4496 00001F59 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4497 00001F5B 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4498 00001F5D D0D8                    	rcr	al, 1
  4499 00001F5F 2C80                    	sub	al, 80h
  4500 00001F61 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4501 00001F65 66AB                    	stosw		; interpolated sample 1 (R)
  4502 00001F67 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4503 00001F69 2C80                    	sub	al, 80h
  4504 00001F6B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4505 00001F6F 66AB                    	stosw		; interpolated sample 2 (L)
  4506 00001F71 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4507 00001F73 2C80                    	sub	al, 80h
  4508 00001F75 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4509 00001F79 66AB                    	stosw		; interpolated sample 2 (L)
  4510 00001F7B 88D8                    	mov	al, bl
  4511 00001F7D 00D0                    	add	al, dl	; [next_val_l]
  4512 00001F7F D0D8                    	rcr	al, 1
  4513 00001F81 2C80                    	sub	al, 80h
  4514 00001F83 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4515 00001F87 66AB                    	stosw		; interpolated sample 3 (L)
  4516 00001F89 88F8                    	mov	al, bh
  4517 00001F8B 00F0                    	add	al, dh	; [next_val_r]
  4518 00001F8D D0D8                    	rcr	al, 1
  4519 00001F8F 2C80                    	sub	al, 80h
  4520 00001F91 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4521 00001F95 66AB                    	stosw		; interpolated sample 3 (R)
  4522 00001F97 C3                      	retn
  4523                                  
  4524                                  interpolating_5_16bit_mono:
  4525                                  	; 18/11/2023
  4526                                  	; ax = [previous_val]
  4527                                  	; dx = [next_val]
  4528                                  	; original-interpltd-interpltd-interpltd-interpltd
  4529 00001F98 66AB                    	stosw		; original sample (L)
  4530 00001F9A 66AB                    	stosw		; original sample (R)
  4531 00001F9C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4532 00001F9F 89C3                    	mov	ebx, eax ; [previous_val]
  4533 00001FA1 80C680                  	add	dh, 80h
  4534 00001FA4 6601D0                  	add	ax, dx
  4535 00001FA7 66D1D8                  	rcr	ax, 1
  4536 00001FAA 50                      	push	eax ; *	; interpolated middle (temporary)
  4537 00001FAB 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4538 00001FAE 66D1D8                  	rcr	ax, 1
  4539 00001FB1 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4540 00001FB2 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4541 00001FB5 66D1D8                  	rcr	ax, 1	
  4542 00001FB8 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4543 00001FBB 66AB                    	stosw 		; interpolated sample 1 (L)
  4544 00001FBD 66AB                    	stosw		; interpolated sample 1 (R)
  4545 00001FBF 58                      	pop	eax ; **
  4546 00001FC0 5B                      	pop	ebx ; *
  4547 00001FC1 6601D8                  	add	ax, bx	; 1st quarter + middle
  4548 00001FC4 66D1D8                  	rcr	ax, 1	; / 2
  4549 00001FC7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4550 00001FCA 66AB                    	stosw		; interpolated sample 2 (L)
  4551 00001FCC 66AB                    	stosw		; interpolated sample 2 (R)
  4552 00001FCE 89D8                    	mov	eax, ebx
  4553 00001FD0 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4554 00001FD3 66D1D8                  	rcr	ax, 1
  4555 00001FD6 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4556 00001FD7 6601D8                  	add	ax, bx	; + interpolated middle
  4557 00001FDA 66D1D8                  	rcr	ax, 1
  4558 00001FDD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4559 00001FE0 66AB                    	stosw		; interpolated sample 3 (L)
  4560 00001FE2 66AB                    	stosw		; interpolated sample 3 (R)
  4561 00001FE4 58                      	pop	eax ; *	
  4562 00001FE5 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4563 00001FE8 66D1D8                  	rcr	ax, 1	; / 2
  4564 00001FEB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4565 00001FEE 66AB                    	stosw		; interpolated sample 4 (L)
  4566 00001FF0 66AB                    	stosw		; interpolated sample 4 (R)
  4567 00001FF2 C3                      	retn
  4568                                  
  4569                                  interpolating_5_16bit_stereo:
  4570                                  	; 18/11/2023
  4571                                  	; bx = [previous_val_l]
  4572                                  	; ax = [previous_val_r]
  4573                                  	; [next_val_l]
  4574                                  	; [next_val_r]
  4575                                  	; original-interpltd-interpltd-interpltd-interpltd
  4576 00001FF3 51                      	push	ecx ; !
  4577 00001FF4 93                      	xchg	eax, ebx
  4578 00001FF5 66AB                    	stosw		; original sample (L)
  4579 00001FF7 93                      	xchg	eax, ebx
  4580 00001FF8 66AB                    	stosw		; original sample (R)
  4581 00001FFA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4582 00001FFD 50                      	push	eax ; *	; [previous_val_r]
  4583 00001FFE 80C780                  	add	bh, 80h
  4584 00002001 8005[7D210000]80        	add	byte [next_val_l+1], 80h
  4585 00002008 66A1[7C210000]          	mov	ax, [next_val_l]
  4586 0000200E 6601D8                  	add	ax, bx	; [previous_val_l]
  4587 00002011 66D1D8                  	rcr	ax, 1
  4588 00002014 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4589 00002016 6601D8                  	add	ax, bx	
  4590 00002019 66D1D8                  	rcr	ax, 1
  4591 0000201C 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4592 0000201E 6601D8                  	add	ax, bx	; [previous_val_l]
  4593 00002021 66D1D8                  	rcr	ax, 1
  4594 00002024 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4595 00002027 66AB                    	stosw 		; interpolated sample 1 (L)
  4596 00002029 89C8                    	mov	eax, ecx
  4597 0000202B 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4598 0000202E 66D1D8                  	rcr	ax, 1	; / 2
  4599 00002031 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4600 00002033 5A                      	pop	edx ; *	; [previous_val_r]
  4601 00002034 89D0                    	mov	eax, edx
  4602 00002036 8005[7F210000]80        	add	byte [next_val_r+1], 80h
  4603 0000203D 660305[7E210000]        	add	ax, [next_val_r]
  4604 00002044 66D1D8                  	rcr	ax, 1
  4605 00002047 50                      	push	eax ; *	; interpolated middle (R)
  4606 00002048 6601D0                  	add	ax, dx
  4607 0000204B 66D1D8                  	rcr	ax, 1
  4608 0000204E 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4609 0000204F 6601D0                  	add	ax, dx	; [previous_val_r]
  4610 00002052 66D1D8                  	rcr	ax, 1
  4611 00002055 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4612 00002058 66AB                    	stosw 		; interpolated sample 1 (R)
  4613 0000205A 89D8                    	mov	eax, ebx
  4614 0000205C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4615 0000205F 66AB                    	stosw 		; interpolated sample 2 (L)
  4616 00002061 58                      	pop	eax ; **
  4617 00002062 5A                      	pop	edx ; *
  4618 00002063 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4619 00002066 66D1D8                  	rcr	ax, 1	; / 2
  4620 00002069 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4621 0000206C 66AB                    	stosw 		; interpolated sample 2 (R)
  4622 0000206E 89C8                    	mov	eax, ecx
  4623 00002070 660305[7C210000]        	add	ax, [next_val_l]
  4624 00002077 66D1D8                  	rcr	ax, 1
  4625 0000207A 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4626 0000207B 6601C8                  	add	ax, cx	; interpolated middle (L)
  4627 0000207E 66D1D8                  	rcr	ax, 1
  4628 00002081 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4629 00002084 66AB                    	stosw 		; interpolated sample 3 (L)
  4630 00002086 89D0                    	mov	eax, edx
  4631 00002088 660305[7E210000]        	add	ax, [next_val_r]
  4632 0000208F 66D1D8                  	rcr	ax, 1
  4633 00002092 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4634 00002093 6601D0                  	add	ax, dx	; interpolated middle (R)
  4635 00002096 66D1D8                  	rcr	ax, 1
  4636 00002099 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4637 0000209C 66AB                    	stosw 		; interpolated sample 3 (R)
  4638 0000209E 5B                      	pop	ebx ; **
  4639 0000209F 58                      	pop	eax ; *
  4640 000020A0 660305[7C210000]        	add	ax, [next_val_l]
  4641 000020A7 66D1D8                  	rcr	ax, 1
  4642 000020AA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4643 000020AD 66AB                    	stosw 		; interpolated sample 4 (L)
  4644 000020AF 89D8                    	mov	eax, ebx
  4645 000020B1 660305[7E210000]        	add	ax, [next_val_r]
  4646 000020B8 66D1D8                  	rcr	ax, 1
  4647 000020BB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4648 000020BE 66AB                    	stosw 		; interpolated sample 4 (R)
  4649 000020C0 59                      	pop	ecx ; !
  4650 000020C1 C3                      	retn
  4651                                  
  4652                                  interpolating_4_16bit_mono:
  4653                                  	; 18/11/2023
  4654                                  	; ax = [previous_val]
  4655                                  	; dx = [next_val]
  4656                                  	; original-interpolated
  4657                                  
  4658 000020C2 66AB                    	stosw		; original sample (L)
  4659 000020C4 66AB                    	stosw		; original sample (R)
  4660 000020C6 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4661 000020C9 89C3                    	mov	ebx, eax ; [previous_val]
  4662 000020CB 80C680                  	add	dh, 80h
  4663 000020CE 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4664 000020D1 66D1D8                  	rcr	ax, 1
  4665 000020D4 93                      	xchg	eax, ebx
  4666 000020D5 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4667 000020D8 66D1D8                  	rcr	ax, 1
  4668 000020DB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4669 000020DE 66AB                    	stosw 		; interpolated sample 1 (L)
  4670 000020E0 66AB                    	stosw		; interpolated sample 1 (R)
  4671 000020E2 89D8                    	mov	eax, ebx ; interpolated middle
  4672 000020E4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4673 000020E7 66AB                    	stosw 		; interpolated sample 2 (L)
  4674 000020E9 66AB                    	stosw		; interpolated sample 2 (R)
  4675 000020EB 89D8                    	mov	eax, ebx
  4676 000020ED 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4677 000020F0 66D1D8                  	rcr	ax, 1
  4678 000020F3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4679 000020F6 66AB                    	stosw		; interpolated sample 3 (L)
  4680 000020F8 66AB                    	stosw		; interpolated sample 3 (R)
  4681 000020FA C3                      	retn
  4682                                  
  4683                                  interpolating_4_16bit_stereo:
  4684                                  	; 18/11/2023
  4685                                  	; bx = [previous_val_l]
  4686                                  	; ax = [previous_val_r]
  4687                                  	; [next_val_l]
  4688                                  	; [next_val_r]
  4689                                  	; original-interpolated-interpolated-interpolated
  4690 000020FB 93                      	xchg	eax, ebx
  4691 000020FC 66AB                    	stosw		; original sample (L)
  4692 000020FE 93                      	xchg	eax, ebx
  4693 000020FF 66AB                    	stosw		; original sample (R)
  4694 00002101 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4695 00002104 89C2                    	mov	edx, eax ; [previous_val_r]
  4696 00002106 80C780                  	add	bh, 80h
  4697 00002109 8005[7D210000]80        	add	byte [next_val_l+1], 80h
  4698 00002110 66A1[7C210000]          	mov	ax, [next_val_l]
  4699 00002116 6601D8                  	add	ax, bx	; [previous_val_l]
  4700 00002119 66D1D8                  	rcr	ax, 1
  4701 0000211C 93                      	xchg	eax, ebx
  4702 0000211D 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4703 00002120 66D1D8                  	rcr	ax, 1
  4704 00002123 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4705 00002126 66AB                    	stosw 		; interpolated sample 1 (L)
  4706 00002128 8005[7F210000]80        	add	byte [next_val_r+1], 80h
  4707 0000212F 89D0                    	mov	eax, edx ; [previous_val_r]
  4708 00002131 660305[7E210000]        	add	ax, [next_val_r]
  4709 00002138 66D1D8                  	rcr	ax, 1
  4710 0000213B 92                      	xchg	eax, edx
  4711 0000213C 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4712 0000213F 66D1D8                  	rcr	ax, 1
  4713 00002142 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4714 00002145 66AB                    	stosw 		; interpolated sample 1 (R)
  4715 00002147 89D8                    	mov	eax, ebx
  4716 00002149 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4717 0000214C 66AB                    	stosw 		; interpolated sample 2 (L)
  4718 0000214E 89D0                    	mov	eax, edx
  4719 00002150 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4720 00002153 66AB                    	stosw 		; interpolated sample 2 (R)
  4721 00002155 89D8                    	mov	eax, ebx
  4722 00002157 660305[7C210000]        	add	ax, [next_val_l]
  4723 0000215E 66D1D8                  	rcr	ax, 1
  4724 00002161 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4725 00002164 66AB                    	stosw 		; interpolated sample 3 (L)
  4726 00002166 89D0                    	mov	eax, edx
  4727 00002168 660305[7E210000]        	add	ax, [next_val_r]
  4728 0000216F 66D1D8                  	rcr	ax, 1
  4729 00002172 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4730 00002175 66AB                    	stosw 		; interpolated sample 3 (R)
  4731 00002177 C3                      	retn
  4732                                  
  4733                                  ; 13/11/2023
  4734                                  previous_val:
  4735 00002178 0000                    previous_val_l: dw 0
  4736 0000217A 0000                    previous_val_r: dw 0
  4737                                  next_val:
  4738 0000217C 0000                    next_val_l: dw 0
  4739 0000217E 0000                    next_val_r: dw 0
  4740                                  
  4741                                  ; 16/11/2023
  4742 00002180 00                      faz:	db 0
  4743                                  
  4744                                  ; --------------------------------------------------------
  4745                                  ; --------------------------------------------------------
  4746                                  
  4747                                  ; 07/12/2024
  4748                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  4749                                  ;		'sysaudio' system call (23/08/2024)
  4750                                  ; 18/11/2024
  4751                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  4752                                  
  4753                                  ac97_stop: 
  4754                                  	; 18/11/2024
  4755 00002181 C605[DC720000]02        	mov	byte [stopped], 2
  4756                                  	; 07/12/2024
  4757                                  	sys	_audio, 0700h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002188 BB00070000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000218D B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002192 CD40                <1>  int 40h
  4758 00002194 C3                      	retn
  4759                                  
  4760                                  ac97_pause:
  4761                                  	; 18/11/2024
  4762 00002195 C605[DC720000]01        	mov	byte [stopped], 1 ; paused
  4763                                  	; 07/12/2024
  4764                                  	sys	_audio, 0500h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000219C BB00050000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000021A1 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000021A6 CD40                <1>  int 40h
  4765 000021A8 C3                      	retn
  4766                                  
  4767                                  ac97_play: ; continue to play (after pause)
  4768                                  	; 18/11/2024
  4769 000021A9 C605[DC720000]00        	mov	byte [stopped], 0
  4770                                  	; 07/12/2024	
  4771                                  	sys	_audio, 0600h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000021B0 BB00060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000021B5 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000021BA CD40                <1>  int 40h
  4772 000021BC C3                      	retn
  4773                                  	
  4774                                  ; --------------------------------------------------------
  4775                                  ; 14/11/2024 - Erdogan Tan
  4776                                  ; --------------------------------------------------------
  4777                                  
  4778                                  	; 07/12/2024
  4779                                  	; 01/12/2024 (32bit registers)
  4780                                  	; 29/11/2024
  4781                                  checkUpdateEvents:
  4782 000021BD E817010000              	call	check4keyboardstop
  4783 000021C2 727D                    	jc	short c4ue_ok
  4784                                  
  4785                                  	; 18/11/2024
  4786 000021C4 50                      	push	eax ; *
  4787 000021C5 09C0                    	or	eax, eax
  4788 000021C7 0F84C2000000            	jz	c4ue_cpt
  4789                                  
  4790                                  	; 18/11/2024
  4791 000021CD 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  4792 000021CF 7543                    	jne	short ch4ue_chk_s
  4793 000021D1 803D[DC720000]00        	cmp	byte [stopped], 0
  4794 000021D8 7714                    	ja	short c4ue_chk_ps
  4795                                  	; pause
  4796 000021DA E8B6FFFFFF              	call	ac97_pause
  4797                                  	; 21/11/2024
  4798 000021DF A0[DD720000]            	mov	al, [tLO]
  4799 000021E4 A2[DE720000]            	mov	byte [tLP], al
  4800 000021E9 E9A1000000              	jmp	c4ue_cpt
  4801                                  c4ue_chk_ps:
  4802 000021EE 803D[DC720000]01        	cmp	byte [stopped], 1
  4803 000021F5 770A                    	ja	short c4ue_replay
  4804                                  	; continue to play (after a pause)
  4805 000021F7 E8ADFFFFFF              	call	ac97_play 
  4806 000021FC E98E000000              	jmp	c4ue_cpt
  4807                                  c4ue_replay:
  4808                                  	; 19/11/2024
  4809 00002201 58                      	pop	eax ; *
  4810 00002202 58                      	pop	eax ; return address
  4811                                  	; 07/02/2024
  4812                                  	;mov	al, [volume]
  4813                                  	;call	SetmasterVolume
  4814 00002203 C605[DC720000]00        	mov	byte [stopped], 0
  4815 0000220A E8C6030000              	call	move_to_beginning
  4816                                  	;jmp	PlayWav
  4817                                  	; 07/12/2024
  4818 0000220F E9D7E3FFFF              	jmp	RePlayWav
  4819                                  
  4820                                  ch4ue_chk_s:
  4821 00002214 3C53                    	cmp	al, 'S'	; stop
  4822 00002216 751E                    	jne	short ch4ue_chk_fb
  4823 00002218 803D[DC720000]00        	cmp	byte [stopped], 0
  4824 0000221F 776E                    	ja	c4ue_cpt ; Already stopped/paused
  4825 00002221 E85BFFFFFF              	call	ac97_stop
  4826                                  	; 19/11/2024
  4827 00002226 C605[DD720000]00        	mov	byte [tLO], 0
  4828                                  	; 21/11/2024
  4829 0000222D C605[DE720000]30        	mov	byte [tLP], '0'
  4830 00002234 EB59                    	jmp	short c4ue_cpt
  4831                                  
  4832                                  ch4ue_chk_fb:
  4833                                  	; 17/11/2024
  4834 00002236 3C46                    	cmp	al, 'F'
  4835 00002238 7508                    	jne	short c4ue_chk_b
  4836 0000223A E86E030000              	call 	Player_ProcessKey_Forwards
  4837 0000223F EB4E                    	jmp	short c4ue_cpt
  4838                                  
  4839                                  	; 01/12/2024
  4840                                  	; 18/11/2024
  4841                                  c4ue_ok:
  4842 00002241 C3                      	retn
  4843                                  	
  4844                                  c4ue_chk_b:
  4845 00002242 3C42                    	cmp	al, 'B'
  4846                                  	;;jne	short c4ue_cpt
  4847                                  	; 19/11/2024
  4848 00002244 7507                    	jne	short c4ue_chk_h
  4849 00002246 E85E030000              	call 	Player_ProcessKey_Backwards
  4850 0000224B EB42                    	jmp	short c4ue_cpt
  4851                                  
  4852                                  c4ue_chk_h:
  4853                                  	; 19/11/2024
  4854 0000224D 3C48                    	cmp	al, 'H'
  4855 0000224F 750E                    	jne	short c4ue_chk_cr
  4856 00002251 C605[DF720000]00        	mov	byte [wleds], 0
  4857 00002258 E88EE6FFFF              	call 	write_ac97_pci_dev_info
  4858                                  	;mov	dh, 24
  4859                                  	;mov	dl, 79
  4860                                  	;call	setCursorPosition
  4861                                  	; 21/12/2024
  4862 0000225D EB30                    	jmp	short c4ue_cpt
  4863                                  c4ue_chk_cr:
  4864                                  	; 19/11/2024
  4865 0000225F 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  4866 00002261 752C                    	jne	short c4ue_cpt
  4867                                  	;inc	byte [wleds]
  4868                                  	;jnz	short c4ue_cpt
  4869                                  	;inc	byte [wleds]
  4870                                  	;;;
  4871                                  	; 22/12/2024 (faster method)
  4872                                  	; (UpdateWaveLeds procedure turns off previously
  4873                                  	;  lighting wave leds only)
  4874 00002263 E8B2030000              	call	reset_wave_leds ; prepare all leds as turned off
  4875                                  	;;;
  4876                                  	; 23/11/2024
  4877 00002268 31DB                    	xor	ebx, ebx
  4878 0000226A 8A1D[DF720000]          	mov	bl, [wleds]
  4879 00002270 FEC3                    	inc	bl
  4880 00002272 80E30F                  	and	bl, 0Fh
  4881 00002275 7501                    	jnz	short c4ue_sc
  4882 00002277 43                      	inc	ebx
  4883                                  c4ue_sc:
  4884 00002278 881D[DF720000]          	mov	[wleds], bl
  4885 0000227E D0EB                    	shr	bl, 1
  4886 00002280 8A83[823F0000]          	mov	al, [ebx+colors]
  4887 00002286 7302                    	jnc	short c4ue_sc_@
  4888 00002288 0C10                    	or	al, 10h ; blue (dark) background
  4889                                  c4ue_sc_@:
  4890 0000228A A2[8A3F0000]            	mov	[ccolor], al
  4891                                  	;;;
  4892                                  c4ue_cpt:
  4893                                  	; 01/12/2024 (TRDOS 386)
  4894                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second)
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000228F BB04000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002294 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 00002299 CD40                <1>  int 40h
  4895                                  	; 18/11/2024
  4896 0000229B 59                      	pop	ecx ; *
  4897                                  	; 01/12/2024
  4898 0000229C 3B05[9C730000]          	cmp	eax, [timerticks]
  4899                                  	;je	short c4ue_ok
  4900                                  	; 18/11/2024
  4901 000022A2 7407                    	je	short c4ue_skip_utt
  4902                                  c4ue_utt:	
  4903                                  	; 01/12/2024
  4904 000022A4 A3[9C730000]            	mov	[timerticks], eax
  4905 000022A9 EB04                    	jmp	short c4ue_cpt_@
  4906                                  c4ue_skip_utt:
  4907                                  	; 18/11/2024
  4908 000022AB 21C9                    	and	ecx, ecx
  4909 000022AD 7492                    	jz	short c4ue_ok
  4910                                  c4ue_cpt_@:
  4911                                  	; 18/11/2024
  4912 000022AF 803D[DC720000]00        	cmp	byte [stopped], 0
  4913 000022B6 7789                    	ja	short c4ue_ok
  4914                                  	
  4915 000022B8 E841010000              	call	CalcProgressTime
  4916                                  
  4917                                  	;cmp	ax, [ProgressTime]
  4918                                  	; 01/12/2024
  4919 000022BD 3B05[90730000]          	cmp	eax, [ProgressTime]
  4920                                  	;je	short c4ue_ok
  4921                                  			; same second, no need to update
  4922                                  	; 23/11/2024
  4923 000022C3 7405                    	je	short c4ue_uvb
  4924                                  
  4925                                  	;call	UpdateProgressTime
  4926                                  	;call	UpdateProgressBar@
  4927 000022C5 E853020000              	call	UpdateProgressBar
  4928                                  
  4929                                  	; 23/11/2024
  4930                                  c4ue_uvb:
  4931 000022CA 803D[DF720000]00        	cmp	byte [wleds], 0
  4932 000022D1 7605                    	jna	short c4ue_vb_ok
  4933                                  
  4934 000022D3 E88C030000              	call	UpdateWaveLeds
  4935                                  
  4936                                  c4ue_vb_ok:
  4937 000022D8 C3                      	retn	
  4938                                  
  4939                                  ; --------------------------------------------------------
  4940                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  4941                                  ; --------------------------------------------------------
  4942                                  
  4943                                  	; 07/12/2024
  4944                                  	; 01/12/2024 (TRDOS 386)
  4945                                  	; 29/11/2024
  4946                                  check4keyboardstop:
  4947                                  	; 19/05/2024
  4948                                  	; 08/11/2023
  4949                                  	; 04/11/2023
  4950 000022D9 B401                    	mov	ah, 1
  4951                                  	;int	16h
  4952                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  4953 000022DB CD32                    	int	32h
  4954                                  	;clc
  4955 000022DD 7433                    	jz	short _cksr
  4956                                  
  4957 000022DF 30E4                    	xor	ah, ah
  4958                                  	;int	16h
  4959                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  4960 000022E1 CD32                    	int	32h
  4961                                  
  4962                                  	;;;
  4963                                  	; 19/05/2024 (change PCM out volume)
  4964 000022E3 3C2B                    	cmp	al, '+'
  4965 000022E5 750D                    	jne	short p_1
  4966                                  	
  4967 000022E7 A0[30230000]            	mov	al, [volume]
  4968 000022EC 3C00                    	cmp	al, 0
  4969 000022EE 7624                    	jna	short p_3
  4970 000022F0 FEC8                    	dec	al
  4971 000022F2 EB0F                    	jmp	short p_2
  4972                                  p_1:
  4973 000022F4 3C2D                    	cmp	al, '-'
  4974 000022F6 751D                    	jne	short p_4
  4975                                  
  4976 000022F8 A0[30230000]            	mov	al, [volume]
  4977 000022FD 3C1F                    	cmp	al, 31
  4978 000022FF 7313                    	jnb	short p_3
  4979 00002301 FEC0                    	inc	al
  4980                                  p_2:
  4981 00002303 A2[30230000]            	mov	[volume], al
  4982                                  	; 14/11/2024
  4983                                  	;call	SetPCMOutVolume
  4984                                  	; 15/11/2024 (QEMU)
  4985                                  	; 07/12/2024
  4986 00002308 E80EE4FFFF              	call	SetMasterVolume
  4987                                  	;call	UpdateVolume
  4988                                  	;;clc
  4989                                  	;retn
  4990 0000230D E97B010000              	jmp	UpdateVolume
  4991                                  	;mov	ah, al
  4992                                  	;mov    dx, [NAMBAR]
  4993                                    	;;add   dx, CODEC_MASTER_VOL_REG
  4994                                  	;add	dx, CODEC_PCM_OUT_REG
  4995                                  	;out    dx, ax
  4996                                  	;
  4997                                  	;call   delay1_4ms
  4998                                          ;call   delay1_4ms
  4999                                          ;call   delay1_4ms
  5000                                          ;call   delay1_4ms
  5001                                  _cksr:		; 19/05/2024
  5002                                  	; 18/12/2024
  5003 00002312 31C0                    	xor	eax, eax
  5004                                  	;clc
  5005                                  p_3:
  5006 00002314 C3                      	retn
  5007                                  p_4:
  5008                                  	; 17/11/2024
  5009 00002315 80FC01                  	cmp	ah, 01h  ; ESC
  5010 00002318 7414                        	je	short p_q
  5011                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5012 0000231A 3C03                    	cmp	al, 03h  ; CTRL+C
  5013 0000231C 7410                    	je	short p_q
  5014                                  
  5015                                  	; 18/11/2024
  5016 0000231E 3C20                    	cmp	al, 20h
  5017 00002320 740D                    	je	short p_r
  5018                                  
  5019                                  	; 19/11/2024
  5020 00002322 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5021 00002324 7409                    	je	short p_r
  5022                                  
  5023 00002326 24DF                    	and	al, 0DFh
  5024                                  
  5025                                  	;cmp	al, 'B'
  5026                                  	;je	short p_r
  5027                                  	;cmp	al, 'F'
  5028                                  	;je	short p_r
  5029                                  
  5030 00002328 3C51                    	cmp	al, 'Q'
  5031                                  	;je	short p_q
  5032 0000232A 7402                    	je	short p_quit ; 29/11/2024
  5033                                  
  5034 0000232C F8                      	clc
  5035 0000232D C3                      	retn
  5036                                  
  5037                                  	;;;
  5038                                  ;_cskr:	
  5039                                  p_q:
  5040                                  p_quit:
  5041 0000232E F9                      	stc
  5042                                  p_r:
  5043 0000232F C3                      	retn
  5044                                  
  5045                                  ; 29/05/2024
  5046                                  ; 19/05/2024
  5047 00002330 02                      volume: db	02h
  5048                                  
  5049                                  ; --------------------------------------------------------
  5050                                  
  5051                                  	; 22/12/2024
  5052                                  	; 21/12/2024
  5053                                  	; simulate cursor position in VGA (VESA VBE) mode
  5054                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5055                                  setCursorPosition:
  5056                                  	; dh = Row
  5057                                  	; dl = Column
  5058                                  	
  5059 00002331 31C0                    	xor	eax, eax
  5060 00002333 B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5061 00002335 F6E6                    	mul	dh
  5062 00002337 6683C007                	add	ax, 7	; top margin
  5063 0000233B C1E010                  	shl	eax, 16
  5064 0000233E 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5065 00002340 66C1E003                	shl	ax, 3
  5066                                  			; hw = row, ax = column
  5067 00002344 A3[D0720000]            	mov	[screenpos], eax
  5068                                  	; 22/12/2024
  5069 00002349 31C0                    	xor	eax, eax
  5070 0000234B C3                      	retn
  5071                                  	
  5072                                  ; --------------------------------------------------------
  5073                                  ; 14/11/2024
  5074                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5075                                  
  5076                                  ;; NAME:	SetTotalTime
  5077                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5078                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5079                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5080                                  ;; 		Output on the screen of the total time in seconds
  5081                                  
  5082                                  	; 01/12/2024 (32 bit registers)
  5083                                  SetTotalTime:
  5084                                  	;; Calculate total seconds in file
  5085                                  	;mov	ax, [DATA_SubchunkSize]
  5086                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5087                                  	;mov	bx, [WAVE_SampleRate]
  5088                                  	;div	bx
  5089                                  	;xor	dx, dx
  5090                                  	; 01/12/2024
  5091 0000234C A1[14730000]            	mov	eax, [DATA_SubchunkSize]
  5092 00002351 0FB71D[04730000]        	movzx	ebx, word [WAVE_SampleRate]
  5093 00002358 31D2                    	xor	edx, edx
  5094 0000235A F7F3                    	div	ebx
  5095                                  
  5096                                  	;mov	bx, [WAVE_BlockAlign]
  5097                                  	;div	bx
  5098                                  	; 01/12/2024
  5099 0000235C 668B1D[0C730000]        	mov	bx, [WAVE_BlockAlign]
  5100 00002363 31D2                    	xor	edx, edx
  5101 00002365 F7F3                    	div	ebx
  5102                                  
  5103                                  	;mov	[TotalTime], ax
  5104 00002367 A3[8C730000]            	mov	[TotalTime], eax
  5105                                  
  5106 0000236C B33C                    	mov	bl, 60
  5107 0000236E F6F3                    	div	bl
  5108                                  
  5109                                  	;; al = minutes, ah = seconds
  5110 00002370 50                      	push	eax ; **
  5111 00002371 50                      	push	eax ; *
  5112                                  
  5113                                  	;mov	dh, 24
  5114                                  	; 21/12/2024 (640*480)
  5115 00002372 B620                    	mov	dh, 32
  5116 00002374 B22A                    	mov	dl, 42
  5117 00002376 E8B6FFFFFF              	call	setCursorPosition
  5118                                  
  5119 0000237B 58                      	pop	eax ; *
  5120 0000237C 30E4                    	xor	ah, ah
  5121 0000237E BD02000000              	mov	ebp, 2
  5122 00002383 E812000000              	call	PrintNumber
  5123                                  	
  5124                                  	;mov	dh, 24
  5125                                  	; 21/12/2024 (640*480)
  5126 00002388 B620                    	mov	dh, 32
  5127 0000238A B22D                    	mov	dl, 45
  5128 0000238C E8A0FFFFFF              	call	setCursorPosition
  5129                                  
  5130 00002391 58                      	pop	eax ; **
  5131 00002392 88E0                    	mov	al, ah
  5132 00002394 30E4                    	xor	ah, ah
  5133                                  	; 21/12/2024
  5134 00002396 66BD0200                	mov	bp, 2
  5135                                  	;jmp	short PrintNumber
  5136                                  
  5137                                  ; --------------------------------------------------------
  5138                                  
  5139                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5140                                  	; 01/12/2024 (32bit registers)
  5141                                  PrintNumber:
  5142                                  	; eax = binary number
  5143                                  	; ebp = digits
  5144 0000239A 8B35[D0720000]          	mov	esi, [screenpos]
  5145                                  		; hw = row, si = column
  5146 000023A0 BB0A000000              	mov	ebx, 10
  5147 000023A5 31C9                    	xor	ecx, ecx
  5148                                  printNumber_CutNumber:
  5149 000023A7 41                      	inc	ecx
  5150 000023A8 31D2                    	xor	edx, edx
  5151 000023AA F7F3                    	div	ebx
  5152 000023AC 52                      	push	edx
  5153 000023AD 39E9                    	cmp	ecx, ebp
  5154 000023AF 7402                    	je	short printNumber_printloop
  5155 000023B1 EBF4                    	jmp	printNumber_CutNumber
  5156                                  
  5157                                  printNumber_printloop:
  5158 000023B3 58                      	pop	eax
  5159                                  	; 21/12/2024
  5160                                  	; ebp = count of digits
  5161                                  	; eax <= 9
  5162                                  
  5163 000023B4 0430                    	add	al, '0'
  5164                                  	
  5165                                  	; esi = pixel position (hw = row, si = column)
  5166                                  	; eax = al = character
  5167                                  	;call	write_character
  5168                                  	; 22/12/2024
  5169 000023B6 E818010000              	call	write_character_white
  5170                                  
  5171 000023BB 4D                      	dec	ebp
  5172 000023BC 7405                     	jz	short printNumber_ok
  5173 000023BE 83C608                  	add	esi, 8	; next column
  5174 000023C1 EBF0                    	jmp	short printNumber_printloop
  5175                                  printNumber_ok:
  5176 000023C3 C3                      	retn
  5177                                  
  5178                                  ; --------------------------------------------------------
  5179                                  
  5180                                  	; 14/11/2024 - Erdogan Tan
  5181                                  SetProgressTime:
  5182                                  	;; Calculate playing/progress seconds in file
  5183 000023C4 E835000000              	call	CalcProgressTime
  5184                                  
  5185                                  	; 01/12/2024 (32bit registers)
  5186                                  UpdateProgressTime:
  5187                                  	; eax = (new) progress time 
  5188                                  
  5189 000023C9 A3[90730000]            	mov	[ProgressTime], eax
  5190                                  
  5191 000023CE B33C                    	mov	bl, 60
  5192 000023D0 F6F3                    	div	bl
  5193                                  
  5194                                  	;; al = minutes, ah = seconds
  5195 000023D2 50                      	push	eax ; **
  5196 000023D3 50                      	push	eax ; *
  5197                                  
  5198                                  	;mov	dh, 24
  5199                                  	; 21/12/2024 (640*480)
  5200 000023D4 B620                    	mov	dh, 32
  5201 000023D6 B221                    	mov	dl, 33
  5202 000023D8 E854FFFFFF              	call	setCursorPosition
  5203                                  
  5204 000023DD 58                      	pop	eax ; *
  5205 000023DE 30E4                    	xor	ah, ah
  5206 000023E0 BD02000000              	mov	ebp, 2
  5207 000023E5 E8B0FFFFFF              	call	PrintNumber
  5208                                  	
  5209                                  	;mov	dh, 24
  5210                                  	; 21/12/2024 (640*480)
  5211 000023EA B620                    	mov	dh, 32
  5212 000023EC B224                    	mov	dl, 36
  5213 000023EE E83EFFFFFF              	call	setCursorPosition
  5214                                  
  5215 000023F3 58                      	pop	eax ; **
  5216 000023F4 88E0                    	mov	al, ah
  5217 000023F6 30E4                    	xor	ah, ah
  5218                                  	; 21/12/2024
  5219 000023F8 66BD0200                	mov	bp, 2
  5220 000023FC EB9C                    	jmp	short PrintNumber
  5221                                  
  5222                                  ; --------------------------------------------------------
  5223                                  
  5224                                  	; 01/12/2024 (32bit registers)
  5225                                  	; 17/11/2024
  5226                                  	; 14/11/2024
  5227                                  CalcProgressTime:
  5228                                  	;mov	ax, [LoadedDataBytes]
  5229                                  	;mov	dx, [LoadedDataBytes+2]
  5230                                  	;mov	bx, ax
  5231                                  	;or	bx, dx
  5232                                  	;jz	short cpt_ok
  5233                                  	; 01/12/2024
  5234 000023FE A1[98730000]            	mov	eax, [LoadedDataBytes]
  5235 00002403 09C0                    	or	eax, eax
  5236 00002405 7416                    	jz	short cpt_ok
  5237                                  
  5238                                  	;mov	bx, [WAVE_SampleRate]
  5239                                  	;div	bx
  5240                                  	;xor	dx, dx
  5241                                  	;mov	bx, [WAVE_BlockAlign]
  5242                                  	;div	bx
  5243                                  	; 01/12/2024
  5244 00002407 0FB71D[04730000]        	movzx	ebx, word [WAVE_SampleRate]
  5245 0000240E 31D2                    	xor	edx, edx
  5246 00002410 F7F3                    	div	ebx
  5247 00002412 31D2                    	xor	edx, edx
  5248 00002414 668B1D[0C730000]        	mov	bx, [WAVE_BlockAlign]
  5249 0000241B F7F3                    	div	ebx
  5250                                  cpt_ok:
  5251                                  	; eax = (new) progress time
  5252 0000241D C3                      	retn
  5253                                  
  5254                                  ; --------------------------------------------------------
  5255                                  ; 14/11/2024
  5256                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5257                                  
  5258                                  ;; DESCRIPTION: Update file information on template
  5259                                  ;; PARAMS:	WAVE parameters and other variables
  5260                                  ;; REGS:	AX(RW)
  5261                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5262                                  ;; RETURNS:	On-screen file info is updated.
  5263                                  
  5264                                  	; 01/12/2024 (32bit registers)
  5265                                  UpdateFileInfo:
  5266                                  	;; Print File Name
  5267                                  	;mov	dh, 9
  5268                                  	; 21/12/2024 (640*480 graphics display)
  5269 0000241E B608                    	mov	dh, 8
  5270 00002420 B217                    	mov	dl, 23
  5271 00002422 E80AFFFFFF              	call	setCursorPosition
  5272                                  	
  5273 00002427 BE[20730000]            	mov	esi, wav_file_name
  5274                                  	
  5275                                  	;;;
  5276                                  	; 14/11/2024
  5277                                  	; skip directory separators
  5278                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5279 0000242C 89F3                    	mov	ebx, esi
  5280                                  chk4_nxt_sep:
  5281 0000242E AC                      	lodsb
  5282 0000242F 3C2F                    	cmp	al, '/'	; 14/12/2024
  5283 00002431 7406                    	je	short chg_fpos
  5284 00002433 20C0                    	and	al, al
  5285 00002435 7406                    	jz	short chg_fpos_ok
  5286 00002437 EBF5                    	jmp	short chk4_nxt_sep
  5287                                  chg_fpos:
  5288 00002439 89F3                    	mov	ebx, esi
  5289 0000243B EBF1                    	jmp	short chk4_nxt_sep
  5290                                  chg_fpos_ok:
  5291 0000243D 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5292                                  	;;;
  5293                                  
  5294 0000243F E870000000              	call	PrintString
  5295                                  	
  5296                                  	;; Print Frequency
  5297                                  	;mov	dh, 10
  5298                                  	; 21/12/2024 (640*480 graphics display)
  5299 00002444 B609                    	mov	dh, 9
  5300 00002446 B217                    	mov	dl, 23
  5301 00002448 E8E4FEFFFF              	call	setCursorPosition
  5302                                  	;movzx	eax, word [WAVE_SampleRate]
  5303                                  	; 22/12/2024
  5304                                  	; eax = 0
  5305 0000244D 66A1[04730000]          	mov	ax, [WAVE_SampleRate]
  5306 00002453 BD05000000              	mov	ebp, 5
  5307 00002458 E83DFFFFFF              	call	PrintNumber
  5308                                  
  5309                                  	;; Print BitRate
  5310                                  	;mov	dh, 9
  5311                                  	; 21/12/2024 (640*480 graphics display)
  5312 0000245D B608                    	mov	dh, 8
  5313 0000245F B239                    	mov	dl, 57
  5314 00002461 E8CBFEFFFF              	call	setCursorPosition
  5315 00002466 66A1[0E730000]          	mov	ax, [WAVE_BitsPerSample]
  5316 0000246C 66BD0200                	mov	bp, 2
  5317 00002470 E825FFFFFF              	call	PrintNumber
  5318                                  
  5319                                  	;; Print Channel Number
  5320                                  	;mov	dh, 10
  5321                                  	; 21/12/2024 (640*480 graphics display)
  5322 00002475 B609                    	mov	dh, 9
  5323 00002477 B239                    	mov	dl, 57
  5324 00002479 E8B3FEFFFF              	call	setCursorPosition
  5325 0000247E 66A1[02730000]          	mov	ax, [WAVE_NumChannels]
  5326 00002484 66BD0100                	mov	bp, 1
  5327 00002488 E80DFFFFFF              	call	PrintNumber
  5328                                  
  5329                                  	;call	UpdateVolume
  5330                                  	;retn
  5331                                  
  5332                                  ; --------------------------------------------------------
  5333                                  
  5334                                  	; 14/11/2024
  5335                                  UpdateVolume:
  5336                                  	;; Print Volume
  5337                                  	;mov	dh, 24
  5338                                  	; 21/12/2024 (640*480)
  5339 0000248D B620                    	mov	dh, 32
  5340 0000248F B24B                    	mov	dl, 75
  5341 00002491 E89BFEFFFF              	call	setCursorPosition
  5342                                  	; 22/12/2024
  5343                                  	; eax = 0
  5344                                  
  5345 00002496 A0[30230000]            	mov	al, [volume]
  5346                                  
  5347 0000249B B364                    	mov	bl, 100
  5348 0000249D F6E3                    	mul	bl
  5349                                  
  5350 0000249F B31F                    	mov	bl, 31
  5351 000024A1 F6F3                    	div	bl
  5352                                  
  5353                                  	;neg	ax
  5354                                  	;add	ax, 100	
  5355                                  	; 01/12/2024
  5356 000024A3 B464                    	mov	ah, 100
  5357 000024A5 28C4                    	sub	ah, al
  5358 000024A7 0FB6C4                  	movzx	eax, ah
  5359                                  	;xor	ah, ah
  5360                                  	;mov	bp, 3
  5361 000024AA BD03000000              	mov	ebp, 3
  5362                                  	;call	PrintNumber
  5363                                  	;retn
  5364 000024AF E9E6FEFFFF              	jmp	PrintNumber	
  5365                                  
  5366                                  ; --------------------------------------------------------
  5367                                  
  5368                                  	; 21/12/2024
  5369                                  	; write text in VESA VBE graphics mode
  5370                                  PrintString:
  5371                                  	; esi = string address
  5372                                  printstr_loop:
  5373 000024B4 31C0                    	xor	eax, eax
  5374 000024B6 AC                      	lodsb
  5375 000024B7 08C0                    	or	al, al
  5376 000024B9 7417                    	jz	short printstr_ok
  5377                                  
  5378 000024BB 56                      	push	esi
  5379                                  
  5380 000024BC 8B35[D0720000]          	mov	esi, [screenpos]
  5381                                  
  5382                                  	; esi = pixel position (hw = row, si = column)
  5383                                  	; eax = al = character
  5384                                  	;call	write_character
  5385                                  	; 22/12/2024
  5386 000024C2 E80C000000              	call	write_character_white
  5387                                  
  5388 000024C7 668305[D0720000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5389                                  
  5390 000024CF 5E                      	pop	esi
  5391 000024D0 EBE2                    	jmp	short printstr_loop
  5392                                  
  5393                                  printstr_ok:
  5394 000024D2 C3                      	retn
  5395                                  
  5396                                  ; --------------------------------------------------------
  5397                                  
  5398                                  	; 21/12/2024
  5399                                  	; write character (at cursor position)
  5400                                  	; in graphics mode (640*480, 256 colors)
  5401                                  	; 22/12/2024
  5402                                  write_character_white:
  5403 000024D3 B90F000000              	mov	ecx, 0Fh
  5404                                  write_character:
  5405                                  	; esi = pixel position (hw = row, si = column)
  5406                                  	; eax = al = character
  5407                                  	; cl = color
  5408 000024D8 890D[D4720000]          	mov	[wcolor], ecx ; 22/12/2024
  5409                                  
  5410                                  	; 22/12/2024
  5411 000024DE 50                      	push	eax
  5412                                  	; clear previous character pixels
  5413 000024DF BF[723F0000]            	mov	edi, fillblock
  5414                                  	sys	_video, 020Fh, 0, 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000024E4 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000024E9 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000024EE BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000024F3 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000024F8 CD40                <1>  int 40h
  5415 000024FA 58                      	pop	eax
  5416                                  
  5417 000024FB C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5418 000024FE BF[8C4D0000]            	mov	edi, fontbuff2 ; start of user font data
  5419 00002503 01C7                    	add	edi, eax
  5420                                  
  5421                                  	; 21/12/2024
  5422                                  	; NOTE:
  5423                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5424                                  	; system calls -in graphics mode-
  5425                                  	; because 8*16 pixel operations are faster
  5426                                  	;			than 8*14 pixel operations.
  5427                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5428                                  	; adding 2 empty lines))
  5429                                  	; (8*14 characters can be written via pixel operations)
  5430                                    	
  5431                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5432                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5433                                  	;sysvideo:
  5434                                  	;   function in BH
  5435                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5436                                  	;   sub function in BL
  5437                                  	;	0Fh: WRITE CHARACTER (FONT)
  5438                                  	;          CL = char's color (8 bit, 256 colors)
  5439                                  	;	If DH bit 7 = 1
  5440                                  	;	   USER FONT (from user buffer)
  5441                                  	;	         DL = 1 -> 8x16 pixel font
  5442                                   	;	   EDI = user's font buffer address
  5443                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5444                                  	;	   ESI = start position (row, column)
  5445                                  	;		(HW = row, SI = column)
  5446                                  	;;;;;;;;;;;;;;;;;
  5447                                  
  5448                                  	sys	_video, 020Fh, [wcolor], 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002505 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000250A 8B0D[D4720000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00002510 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002515 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000251A CD40                <1>  int 40h
  5449                                  
  5450 0000251C C3                      	retn
  5451                                  
  5452                                  ; --------------------------------------------------------
  5453                                  
  5454                                  	; 22/12/2024
  5455                                  	; 21/12/2024
  5456                                  	; (write chars in VESA VBE graphics mode)
  5457                                  	; 14/11/2024
  5458                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5459                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5460                                  
  5461                                  	;PROGRESSBAR_ROW equ 23
  5462                                  	; 21/12/2024 (640*480)
  5463                                  	PROGRESSBAR_ROW equ 31
  5464                                  
  5465                                  UpdateProgressBar:
  5466 0000251D E8A2FEFFFF              	call	SetProgressTime	; 14/11/2024
  5467                                  
  5468                                  	; 01/12/2024 (32bit registers)
  5469 00002522 A1[90730000]            	mov	eax, [ProgressTime]
  5470                                  UpdateProgressBar@:
  5471 00002527 BA50000000              	mov	edx, 80
  5472 0000252C F7E2                    	mul	edx
  5473 0000252E 8B1D[8C730000]          	mov	ebx, [TotalTime]
  5474 00002534 F7F3                    	div	ebx
  5475                                  
  5476                                  	; 22/12/2024
  5477                                  	; check progress bar indicator position if it is same 
  5478 00002536 3A05[DA720000]          	cmp	al, [pbprev]
  5479 0000253C 7430                    	je	short UpdateProgressBar_ok
  5480 0000253E A2[DA720000]            	mov	[pbprev], al
  5481                                  
  5482                                  UpdateProgressBar@@:
  5483                                  	;; Push for the 'Clean' part
  5484 00002543 50                      	push	eax ; **
  5485 00002544 50                      	push	eax ; *
  5486                                  
  5487                                  	;; Set cursor position
  5488 00002545 B61F                    	mov	dh, PROGRESSBAR_ROW
  5489 00002547 B200                    	mov	dl, 0
  5490 00002549 E8E3FDFFFF              	call	setCursorPosition
  5491                                  
  5492 0000254E 58                      	pop	eax ; *
  5493 0000254F 09C0                    	or	eax, eax
  5494 00002551 742D                    	jz	short UpdateProgressBar_Clean
  5495                                  
  5496                                  UpdateProgressBar_DrawProgress:
  5497                                  	; 22/12/2024
  5498                                  	; 21/12/2024
  5499                                  	; (write progress bar chars in graphics mode)
  5500                                  	;;;;
  5501 00002553 89C5                    	mov	ebp, eax
  5502 00002555 50                      	push	eax ; ***
  5503 00002556 8B35[D0720000]          	mov	esi, [screenpos]
  5504                                  UpdateProgressBar_DrawProgress_@:
  5505 0000255C B8DF000000              	mov	eax, 223
  5506                                  	
  5507                                  	; esi = pixel position (hw = row, si = column)
  5508                                  	; eax = al = character
  5509                                  	;call	write_character
  5510                                  	; 22/12/2024
  5511 00002561 E86DFFFFFF              	call	write_character_white
  5512                                  
  5513 00002566 4D                      	dec	ebp
  5514 00002567 7406                    	jz	short UpdateProgressBar_DrawCursor
  5515                                  
  5516 00002569 83C608                  	add	esi, 8 ; next column
  5517 0000256C EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5518                                  	;;;
  5519                                  
  5520                                  UpdateProgressBar_ok:
  5521 0000256E C3                      	retn
  5522                                  
  5523                                  UpdateProgressBar_DrawCursor:
  5524                                  	; 22/12/2024
  5525 0000256F 5A                      	pop	edx ; ***
  5526 00002570 B61F                    	mov	dh, PROGRESSBAR_ROW
  5527 00002572 E8BAFDFFFF              	call	setCursorPosition
  5528                                  
  5529                                  	; 21/12/2024
  5530                                  	; (write progress bar character in graphics mode)
  5531                                  	;;;;
  5532                                  	;;;mov	eax, 223
  5533                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5534                                  	;;mov	eax, 223*16
  5535                                  	;;mov	edi, fontbuff2 ; start of user font data
  5536                                  	;;add	edi, eax
  5537                                  	;mov	edi, fontbuff2+(223*16)
  5538                                  	;
  5539                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5540                                  	; 22/12/2024
  5541                                  	;mov	eax, 223
  5542                                  	; eax = 0
  5543 00002577 B0DF                    	mov	al, 223
  5544 00002579 B10C                    	mov	cl, 0Ch ; red
  5545 0000257B E858FFFFFF              	call	write_character
  5546                                  	;;;;
  5547                                  
  5548                                  UpdateProgressBar_Clean:
  5549                                  	;pop	eax  ; **
  5550                                  	; 22/12/2024
  5551 00002580 5A                      	pop	edx  ; **
  5552                                  	; 21/12/2024
  5553 00002581 BD50000000              	mov	ebp, 80
  5554                                  	;sub	bp, ax
  5555 00002586 6629D5                  	sub	bp, dx ; 22/12/2024
  5556 00002589 74E3                    	jz	short UpdateProgressBar_ok
  5557                                  
  5558 0000258B B61F                    	mov	dh, PROGRESSBAR_ROW
  5559                                  	;mov	dl, al ; 22/12/2024
  5560 0000258D E89FFDFFFF              	call	setCursorPosition
  5561                                  
  5562                                  	; 21/12/2024
  5563                                  	; (write progress bar chars in graphics mode)
  5564                                  	;;;;
  5565 00002592 8B35[D0720000]          	mov	esi, [screenpos]
  5566                                  UpdateProgressBar_Clean_@:
  5567                                  	;;;mov	eax, 223
  5568                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5569                                  	;;mov	eax, 223*16
  5570                                  	;mov	edi, fontbuff2 ; start of user font data
  5571                                  	;add	edi, eax
  5572                                  	;mov	edi, fontbuff2+(223*16)
  5573                                  	;
  5574                                  	;sys	_video, 020Fh, 08h, 8001h
  5575                                  	; 22/12/2024
  5576                                  	;mov	eax, 223
  5577                                  	; eax = 0
  5578 00002598 B0DF                    	mov	al, 223
  5579 0000259A B108                    	mov	cl, 08h ; gray (dark)
  5580 0000259C E837FFFFFF              	call	write_character
  5581                                  	;;;;
  5582                                  
  5583 000025A1 4D                      	dec	ebp
  5584 000025A2 74CA                    	jz	short UpdateProgressBar_ok
  5585                                  
  5586 000025A4 83C608                  	add	esi, 8 ; next column
  5587 000025A7 EBEF                    	jmp	short UpdateProgressBar_Clean_@
  5588                                  	;;;;
  5589                                  
  5590                                  ; --------------------------------------------------------
  5591                                  ; 17/11/2024
  5592                                  
  5593                                  Player_ProcessKey_Backwards:
  5594                                  	;; In order to go backwards 5 seconds:
  5595                                  	;; Update file pointer to the beginning, skip headers
  5596 000025A9 B142                    	mov	cl, 'B'
  5597 000025AB EB02                    	jmp	short Player_ProcessKey_B_or_F
  5598                                  
  5599                                  Player_ProcessKey_Forwards:
  5600                                  	;; In order to fast-forward 5 seconds, set the file pointer
  5601                                  	;; to CUR_SEEK + 5 * Freq
  5602                                  
  5603 000025AD B146                    	mov	cl, 'F'
  5604                                  	;jmp	short Player_ProcessKey_B_or_F
  5605                                  
  5606                                  	; 01/12/2024 (32bit regsisters)
  5607                                  Player_ProcessKey_B_or_F:
  5608                                  	; 17/11/2024
  5609                                  	; 04/11/2024
  5610                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5611                                    
  5612                                  	; 04/11/2024
  5613 000025AF B805000000              	mov	eax, 5
  5614 000025B4 0FB71D[0C730000]        	movzx	ebx, word [WAVE_BlockAlign]
  5615 000025BB F7E3                    	mul	ebx
  5616 000025BD 668B1D[04730000]        	mov	bx, [WAVE_SampleRate]
  5617 000025C4 F7E3                    	mul	ebx
  5618                                  	; eax = transfer byte count for 5 seconds
  5619                                  	
  5620                                  	; 17/11/2024
  5621 000025C6 80F942                  	cmp	cl, 'B'
  5622                                  	;mov	bx, [LoadedDataBytes]
  5623                                  	;mov	cx, [LoadedDataBytes+2]
  5624                                  	; 01/12/2024
  5625 000025C9 8B0D[98730000]          	mov	ecx, [LoadedDataBytes]
  5626 000025CF 7508                    	jne	short move_forward ; cl = 'F'
  5627                                  move_backward:
  5628                                  	;sub	bx, ax
  5629                                  	;sbb	cx, dx
  5630 000025D1 29C1                    	sub	ecx, eax
  5631 000025D3 7316                    	jnc	short move_file_pointer
  5632                                  move_to_beginning:
  5633                                  	;xor	cx, cx ; 0
  5634                                  	;xor	bx, bx ; 0
  5635 000025D5 31C9                    	xor	ecx, ecx
  5636 000025D7 EB12                    	jmp	short move_file_pointer
  5637                                  move_forward: 
  5638                                  	;add	bx, ax
  5639                                  	;adc	cx, dx
  5640 000025D9 01C1                    	add	ecx, eax
  5641 000025DB 7208                    	jc	short move_to_end
  5642                                  	;cmp	cx, [DATA_SubchunkSize+2]
  5643                                  	;ja	short move_to_end
  5644                                  	;jb	short move_file_pointer
  5645                                  	;cmp	bx, [DATA_SubchunkSize]
  5646                                  	;jna	short move_file_pointer
  5647 000025DD 3B0D[14730000]          	cmp	ecx, [DATA_SubchunkSize]
  5648 000025E3 7606                    	jna	short move_file_pointer
  5649                                  move_to_end:
  5650                                  	;mov	bx, [DATA_SubchunkSize]
  5651                                  	;mov	cx, [DATA_SubchunkSize+2]
  5652 000025E5 8B0D[14730000]          	mov	ecx, [DATA_SubchunkSize]
  5653                                  move_file_pointer:
  5654                                  	;mov	dx, bx    
  5655                                  	;mov	[LoadedDataBytes], dx
  5656                                  	;mov	[LoadedDataBytes+2], cx
  5657 000025EB 890D[98730000]          	mov	[LoadedDataBytes], ecx
  5658                                  	;add	dx, 44 ; + header
  5659                                  	;adc	cx, 0
  5660 000025F1 83C12C                  	add	ecx, 44 
  5661                                  
  5662                                  	; seek
  5663                                  	;mov	bx, [filehandle]
  5664                                  	;mov	ax, 4200h
  5665                                  	;int	21h
  5666                                  	; 01/12/2024
  5667 000025F4 31D2                    	xor	edx, edx ; offset from beginning of the file
  5668                                  	; ecx = offset	
  5669                                  	; ebx = file handle
  5670                                  	; edx = 0
  5671                                  	sys	_seek, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000025F6 8B1D[1C730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000025FC B813000000          <1>  mov eax, %1
    97                              <1> 
    98 00002601 CD40                <1>  int 40h
  5672 00002603 C3                      	retn
  5673                                  
  5674                                  ; --------------------------------------------------------
  5675                                  
  5676                                  	; 22/12/2024 (VESA VBE mode graphics) 
  5677                                  	; (640*480, 256 colors)
  5678                                  clear_window:
  5679 00002604 8B3D[CC720000]          	mov	edi, [LFB_ADDR]
  5680 0000260A 81C700C70100            	add	edi, (13*80*8*14)
  5681 00002610 29C0                    	sub	eax, eax
  5682 00002612 B9008C0000              	mov	ecx, (16*640*14)/4 ; 16 rows
  5683 00002617 F3AB                    	rep	stosd
  5684 00002619 C3                      	retn
  5685                                  
  5686                                  ; --------------------------------------------------------
  5687                                  
  5688                                  	; 22/12/2024
  5689                                  	; 21/12/2024
  5690                                  	; (simulate wave leds in graphics mode)
  5691                                  	; (640*480, 256 colors)
  5692                                  reset_wave_leds:
  5693                                  	; 22/12/2024
  5694 0000261A C705[8C710000]0000-     	mov	dword [prev_leds], 0
  5694 00002622 0000               
  5695                                  	;
  5696 00002624 BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  5697 00002629 BE[8C5D0000]            	mov	esi, wleds_addr
  5698                                  next_led:
  5699 0000262E AD                      	lodsd
  5700 0000262F 89C7                    	mov	edi, eax
  5701 00002631 BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  5702 00002636 BB[6C5D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5703                                  led_line:
  5704 0000263B 8A23                    	mov	ah, [ebx]
  5705 0000263D B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  5706                                  next_pixel:
  5707 00002642 D0E4                    	shl	ah, 1
  5708 00002644 7308                    	jnc	short skip_this
  5709 00002646 B008                    	mov	al, 8 ; gray
  5710 00002648 AA                      	stosb
  5711 00002649 49                      	dec	ecx
  5712 0000264A 75F6                    	jnz	short next_pixel
  5713 0000264C EB06                    	jmp	short next_line
  5714                                  skip_this:
  5715 0000264E B000                    	mov	al, 0 ; black
  5716 00002650 AA                      	stosb
  5717 00002651 49                      	dec	ecx
  5718 00002652 75EE                    	jnz	short next_pixel
  5719                                  next_line:
  5720 00002654 4A                      	dec	edx
  5721 00002655 7504                    	jnz	short next_line_@
  5722 00002657 4D                      	dec	ebp
  5723 00002658 75D4                    	jnz	short next_led
  5724 0000265A C3                      	retn
  5725                                  next_line_@:
  5726                                  	; 22/12/2024
  5727 0000265B 81C778020000            	add	edi, 640-8 ; next line
  5728 00002661 43                      	inc	ebx
  5729 00002662 EBD7                    	jmp	short led_line	
  5730                                  
  5731                                  ; --------------------------------------------------------
  5732                                  
  5733                                  	; 22/12/2024 (graphics mode)
  5734                                  	; 09/12/2024
  5735                                  	; 19/11/2024
  5736                                  UpdateWaveLeds:
  5737                                  	; 23/11/2024
  5738                                  	;call	reset_wave_leds
  5739                                  	; 22/12/2024 (faster method, 80 against 80*16)
  5740                                  	; turn off previously lighting wave leds at first
  5741                                  	;;;
  5742 00002664 BE[8C710000]            	mov	esi, prev_leds
  5743 00002669 833E00                  	cmp	dword [esi], 0
  5744 0000266C 7433                    	jz	short UpdateWaveLeds_ok
  5745 0000266E B950000000              	mov	ecx, 80
  5746                                  turn_off_led:
  5747 00002673 AD                      	lodsd
  5748 00002674 89C7                    	mov	edi, eax
  5749                                  	; edi = wave led address
  5750 00002676 BD0E000000              	mov	ebp, 14
  5751 0000267B BB[6C5D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5752 00002680 31D2                    	xor	edx, edx
  5753 00002682 B008                    	mov	al, 8 ; gray (dark)
  5754                                  toffl_next_line:
  5755                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5756                                  	;mov	dl, 8
  5757 00002684 88C2                    	mov	dl, al ; 8
  5758 00002686 8A23                    	mov	ah, [ebx]
  5759                                  toffl_next_pixel:
  5760 00002688 D0E4                    	shl	ah, 1
  5761 0000268A 7310                    	jnc	short toffl_skip_this
  5762 0000268C AA                      	stosb
  5763                                  toffl_next_pixel_@:
  5764 0000268D 4A                      	dec	edx
  5765 0000268E 75F8                    	jnz	short toffl_next_pixel
  5766 00002690 4D                      	dec	ebp
  5767 00002691 740C                    	jz	short toffl_next_led
  5768 00002693 81C778020000            	add	edi, 640-8 ; next line
  5769 00002699 43                      	inc	ebx
  5770 0000269A EBE8                    	jmp	short toffl_next_line
  5771                                  toffl_skip_this:
  5772 0000269C 47                      	inc	edi
  5773 0000269D EBEE                    	jmp	short toffl_next_pixel_@
  5774                                  toffl_next_led:
  5775 0000269F E2D2                    	loop	turn_off_led
  5776                                  UpdateWaveLeds_ok:
  5777                                  	;;;
  5778                                  	; 09/12/2024
  5779                                  	;jmp	short turn_on_leds
  5780                                  
  5781                                  ; --------------------------------------------------------
  5782                                  
  5783                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  5784                                  	; 09/12/2024
  5785                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  5786                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  5787                                  	; 21/11/2024, 22/11/2024
  5788                                  	; 19/11/2024
  5789                                  turn_on_leds:
  5790                                  	; 09/12/2024
  5791                                  	; 07/12/2024
  5792 000026A1 8A15[E9720000]          	mov	dl, [half_buffer]
  5793                                  tol_@:
  5794                                  	; 07/12/2024
  5795 000026A7 3815[E8720000]          	cmp	[pbuf_s], dl
  5796 000026AD 7520                    	jne	short tol_ns_buf
  5797 000026AF 8B1D[E0720000]          	mov	ebx, [wleds_dif]
  5798 000026B5 8B35[E4720000]          	mov	esi, [pbuf_o]
  5799 000026BB 8B0D[88730000]          	mov	ecx, [buffersize] ; bytes
  5800 000026C1 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  5801 000026C3 01DE                    	add	esi, ebx
  5802 000026C5 7204                    	jc	short tol_o_@
  5803 000026C7 39CE                    	cmp	esi, ecx
  5804 000026C9 760C                    	jna	short tol_s_buf
  5805                                  tol_o_@:
  5806 000026CB 89CE                    	mov	esi, ecx
  5807 000026CD EB08                    	jmp	short tol_s_buf
  5808                                  
  5809                                  tol_ns_buf:
  5810 000026CF 8815[E8720000]          	mov	[pbuf_s], dl
  5811 000026D5 31F6                    	xor	esi, esi ; 0
  5812                                  tol_s_buf:
  5813 000026D7 8935[E4720000]          	mov	[pbuf_o], esi
  5814                                  
  5815                                  tol_buf_@:
  5816                                  	; 07/12/2024
  5817 000026DD 81C6[00800000]          	add	esi, audio_buffer
  5818 000026E3 B950000000              	mov	ecx, 80
  5819                                  	;xor	eax, eax ; 0
  5820 000026E8 BB[8C5D0000]            	mov	ebx, wleds_addr
  5821                                  	; 22/12/2024
  5822 000026ED BF[8C710000]            	mov	edi, prev_leds
  5823                                  tol_fill_c:
  5824 000026F2 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  5825 000026F4 66AD                    	lodsw	; left
  5826 000026F6 89C2                    	mov	edx, eax
  5827 000026F8 66AD                    	lodsw	; right
  5828 000026FA 6601D0                  	add	ax, dx
  5829 000026FD 80C480                  	add	ah, 80h
  5830                                  	; 21/12/2024 (16 volume levels)
  5831 00002700 C1E80C                  	shr	eax, 12
  5832                                  
  5833 00002703 53                      	push	ebx ; *
  5834                                  	; 01/12/2024
  5835 00002704 C1E002                  	shl	eax, 2
  5836 00002707 01C3                    	add	ebx, eax
  5837                                  	; 01/12/2024 (32bit address)
  5838                                  	;mov	edi, [ebx]
  5839                                  	; 22/12/2024
  5840 00002709 8B03                    	mov	eax, [ebx]
  5841 0000270B AB                      	stosd
  5842 0000270C 57                      	push	edi ; **
  5843 0000270D 89C7                    	mov	edi, eax
  5844                                  	;;;
  5845                                  	; 21/12/2024
  5846                                  	; (simulate wave leds in graphics mode)
  5847                                  	; (640*480, 256 colors)
  5848                                  turn_on_led:
  5849                                  	; edi = wave led address
  5850 0000270F BD0E000000              	mov	ebp, 14
  5851 00002714 BB[6C5D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5852 00002719 A0[8A3F0000]            	mov	al, [ccolor]
  5853                                  tol_next_line:
  5854 0000271E BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5855 00002723 8A23                    	mov	ah, [ebx]
  5856                                  tol_next_pixel:
  5857 00002725 D0E4                    	shl	ah, 1
  5858 00002727 7310                    	jnc	short tol_skip_this
  5859 00002729 AA                      	stosb
  5860                                  tol_next_pixel_@:
  5861 0000272A 4A                      	dec	edx
  5862 0000272B 75F8                    	jnz	short tol_next_pixel
  5863 0000272D 4D                      	dec	ebp
  5864 0000272E 740C                    	jz	short tol_next_led
  5865                                  	; 22/12/2024
  5866 00002730 81C778020000            	add	edi, 640-8 ; next line
  5867 00002736 43                      	inc	ebx
  5868 00002737 EBE5                    	jmp	short tol_next_line
  5869                                  tol_skip_this:
  5870 00002739 47                      	inc	edi
  5871 0000273A EBEE                    	jmp	short tol_next_pixel_@
  5872                                  tol_next_led:
  5873                                  	; 22/12/2024
  5874 0000273C 5F                      	pop	edi ; **
  5875                                  	;;;
  5876 0000273D 5B                      	pop	ebx ; *
  5877 0000273E 83C340                  	add	ebx, 16*4
  5878 00002741 E2AF                    	loop	tol_fill_c
  5879                                  
  5880 00002743 C3                      	retn
  5881                                  
  5882                                  ; -------------------------------------------------------------
  5883                                  
  5884                                  ; -------------------------------------------------------------
  5885                                  ; ac97.inc (11/11/2023)
  5886                                  ; -------------------------------------------------------------
  5887                                  
  5888                                  ; special characters
  5889                                  LF      EQU 10
  5890                                  CR      EQU 13
  5891                                  
  5892                                  ; PCI stuff
  5893                                  
  5894                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  5895                                  
  5896                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  5897                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  5898                                  SIS_VID		equ	1039h
  5899                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  5900                                  AMD_VID		equ	1022h
  5901                                  
  5902                                  ICH_DID         equ     2415h           ; ICH device ID
  5903                                  ICH0_DID        equ     2425h           ; ICH0
  5904                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  5905                                                                          ; they all should be compatible.
  5906                                  
  5907                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  5908                                  ICH3_DID	equ     2485h           ; ICH3
  5909                                  ICH4_DID        equ     24C5h           ; ICH4
  5910                                  ICH5_DID	equ     24D5h           ; ICH5
  5911                                  ICH6_DID	equ     266Eh           ; ICH6
  5912                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  5913                                  ESB631X_DID	equ     2698h           ; 631XESB
  5914                                  ICH7_DID	equ	27DEh		; ICH7
  5915                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  5916                                  MX82440_DID	equ	7195h
  5917                                  SI7012_DID	equ	7012h
  5918                                  NFORCE_DID	equ	01B1h
  5919                                  NFORCE2_DID	equ	006Ah
  5920                                  AMD8111_DID	equ	746Dh
  5921                                  AMD768_DID	equ	7445h
  5922                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  5923                                  CK804_DID	equ	0059h
  5924                                  MCP04_DID	equ	003Ah
  5925                                  CK8_DID		equ	008Ah
  5926                                  NFORCE3_DID	equ	00DAh
  5927                                  CK8S_DID	equ	00EAh
  5928                                  
  5929                                  ; -------------------------------------------------------------
  5930                                  
  5931                                  ; 22/12/2024
  5932                                  align 4
  5933                                  
  5934                                  ; 13/11/2024
  5935                                  ; ('<<' to 'shl' conversion for FASM)
  5936                                  ;
  5937                                  ; 29/05/2024 (TRDOS 386)
  5938                                  ; 17/02/2017
  5939                                  ; Valid ICH device IDs
  5940                                  
  5941                                  valid_ids:
  5942                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  5943 00002744 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  5944 00002748 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  5945 0000274C 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  5946 00002750 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  5947 00002754 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  5948 00002758 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  5949 0000275C 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  5950 00002760 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  5951 00002764 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  5952 00002768 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  5953                                  	; 03/11/2023 - Erdogan Tan
  5954 0000276C 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  5955 00002770 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  5956 00002774 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  5957 00002778 DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  5958 0000277C 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  5959 00002780 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  5960 00002784 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  5961 00002788 DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  5962 0000278C DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  5963 00002790 DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  5964 00002794 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  5965                                  
  5966                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  5967                                  ; 13/11/2024
  5968                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  5969                                  
  5970 00002798 00000000                	dd 0
  5971                                  
  5972                                  Credits:
  5973 0000279C 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  5973 000027A5 6C6179657220666F72-
  5973 000027AE 205452444F53203338-
  5973 000027B7 36206279204572646F-
  5973 000027C0 67616E2054616E2E20 
  5974 000027C9 446563656D62657220-     	db 'December 2024.',10,13,0
  5974 000027D2 323032342E0A0D00   
  5975 000027DA 32322F31322F323032-     	db '22/12/2024', 10,13
  5975 000027E3 340A0D             
  5976                                  ; 15/11/2024
  5977                                  reset:
  5978 000027E6 00                      	db 0
  5979                                  
  5980                                  msgAudioCardInfo:
  5981 000027E7 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  5981 000027F0 204143393720284943-
  5981 000027F9 482920417564696F20-
  5981 00002802 436F6E74726F6C6C65-
  5981 0000280B 722E0A0D00         
  5982                                  
  5983                                  	; 21/12/2024
  5984                                  msg_usage:
  5985 00002810 75736167653A206470-     	db 'usage: dplayvga filename.wav',10,13,0
  5985 00002819 6C6179766761206669-
  5985 00002822 6C656E616D652E7761-
  5985 0000282B 760A0D00           
  5986                                  
  5987                                  noDevMsg:
  5988 0000282F 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  5988 00002838 61626C6520746F2066-
  5988 00002841 696E64204143393720-
  5988 0000284A 617564696F20646576-
  5988 00002853 69636521           
  5989 00002857 0A0D00                  	db 10,13,0
  5990                                  
  5991                                  noFileErrMsg:
  5992 0000285A 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  5992 00002863 6C65206E6F7420666F-
  5992 0000286C 756E642E0A0D00     
  5993                                  
  5994                                  ; 07/12/2024
  5995                                  trdos386_err_msg:
  5996 00002873 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  5996 0000287C 2053797374656D2063-
  5996 00002885 616C6C206572726F72-
  5996 0000288E 20210A0D00         
  5997                                  
  5998                                  ; 29/05/2024
  5999                                  ; 11/11/2023
  6000                                  msg_init_err:
  6001 00002893 0D0A                    	db CR, LF
  6002 00002895 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6002 0000289E 726F6C6C65722F436F-
  6002 000028A7 64656320696E697469-
  6002 000028B0 616C697A6174696F6E-
  6002 000028B9 206572726F722021   
  6003 000028C1 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6004                                  
  6005                                  ; 25/11/2023
  6006                                  msg_no_vra:
  6007 000028C4 0A0D                    	db 10,13
  6008 000028C6 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6008 000028CF 70706F72742021204F-
  6008 000028D8 6E6C79203438206B48-
  6008 000028E1 5A2073616D706C6520-
  6008 000028EA 726174652073757070-
  6008 000028F3 6F727465642021     
  6009 000028FA 0A0D00                  	db 10,13,0
  6010                                  
  6011                                  ; 19/11/2024
  6012                                  ; 03/06/2017
  6013                                  hex_chars:
  6014 000028FD 303132333435363738-     	db '0123456789ABCDEF', 0
  6014 00002906 3941424344454600   
  6015                                  msgAC97Info:
  6016 0000290E 0D0A                    	db 0Dh, 0Ah
  6017 00002910 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6017 00002919 696F20436F6E74726F-
  6017 00002922 6C6C6572202620436F-
  6017 0000292B 64656320496E666F0D-
  6017 00002934 0A                 
  6018 00002935 2056656E646F722049-     	db ' Vendor ID: '
  6018 0000293E 443A20             
  6019                                  msgVendorId:
  6020 00002941 303030306820446576-     	db '0000h Device ID: '
  6020 0000294A 6963652049443A20   
  6021                                  msgDevId:
  6022 00002952 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6023 00002959 204275733A20            	db ' Bus: '
  6024                                  msgBusNo:
  6025 0000295F 303068204465766963-     	db '00h Device: '
  6025 00002968 653A20             
  6026                                  msgDevNo:
  6027 0000296B 3030682046756E6374-     	db '00h Function: '
  6027 00002974 696F6E3A20         
  6028                                  msgFncNo:
  6029 00002979 303068                  	db '00h'
  6030 0000297C 0D0A                    	db 0Dh, 0Ah
  6031 0000297E 204E414D4241523A20      	db ' NAMBAR: '
  6032                                  msgNamBar:
  6033 00002987 30303030682020          	db '0000h  '
  6034 0000298E 4E41424D4241523A20      	db 'NABMBAR: '
  6035                                  msgNabmBar:
  6036 00002997 303030306820204952-     	db '0000h  IRQ: '
  6036 000029A0 513A20             
  6037                                  msgIRQ:
  6038 000029A3 3030                    	dw 3030h
  6039 000029A5 0D0A00                  	db 0Dh, 0Ah, 0
  6040                                  ; 25/11/2023
  6041                                  msgVRAheader:
  6042 000029A8 205652412073757070-     	db ' VRA support: '
  6042 000029B1 6F72743A20         
  6043 000029B6 00                      	db 0	
  6044                                  msgVRAyes:
  6045 000029B7 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6046                                  msgVRAno:
  6047 000029BD 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6048 000029C2 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6048 000029CB 6C617465642073616D-
  6048 000029D4 706C65207261746520-
  6048 000029DD 706C6179696E67206D-
  6048 000029E6 6574686F6429       
  6049 000029EC 0D0A00                  	db 0Dh, 0Ah, 0
  6050                                  
  6051 000029EF 90                      align 4
  6052                                  
  6053                                  ; -------------------------------------------------------------
  6054                                  
  6055                                  	; 21/12/2024
  6056                                  SplashScreen:
  6057 000029F0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6057 000029F9 202020202020202020-
  6057 00002A02 202020202020202020-
  6057 00002A0B 202020202020202020-
  6057 00002A14 202020202020202020-
  6057 00002A1D 202020202020202020-
  6057 00002A26 202020202020202020-
  6057 00002A2F 202020202020202020-
  6057 00002A38 2020202020DDDBDE   
  6058 00002A40 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6058 00002A49 202020202020202020-
  6058 00002A52 202020202020202020-
  6058 00002A5B 202020202020202020-
  6058 00002A64 202020202020202020-
  6058 00002A6D 202020202020202020-
  6058 00002A76 202020202020202020-
  6058 00002A7F 202020202020202020-
  6058 00002A88 2020202020DDDBDE   
  6059 00002A90 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6059 00002A99 202020202020202020-
  6059 00002AA2 202020202020202020-
  6059 00002AAB 202020202020202020-
  6059 00002AB4 202020202020202020-
  6059 00002ABD 202020202020202020-
  6059 00002AC6 202020202020202020-
  6059 00002ACF 202020202020202020-
  6059 00002AD8 2020202020DDDBDE   
  6060 00002AE0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6060 00002AE9 202020202020202020-
  6060 00002AF2 202020202020202020-
  6060 00002AFB 202020202020202020-
  6060 00002B04 202020202020202020-
  6060 00002B0D 202020202020202020-
  6060 00002B16 202020202020202020-
  6060 00002B1F 202020202020202020-
  6060 00002B28 2020202020DDDBDE   
  6061 00002B30 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6061 00002B39 202020202020202020-
  6061 00002B42 202020202020202020-
  6061 00002B4B 202020202020202020-
  6061 00002B54 202020202020202020-
  6061 00002B5D 202020202020202020-
  6061 00002B66 202020202020202020-
  6061 00002B6F 202020202020202020-
  6061 00002B78 2020202020DDDBDE   
  6062 00002B80 DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6062 00002B89 202020202020202020-
  6062 00002B92 2020202020205F5F5F-
  6062 00002B9B 5F5F5F5F2020205F5F-
  6062 00002BA4 5F5F5F5F2020202020-
  6062 00002BAD 2020205F5F5F5F5F5F-
  6062 00002BB6 5F2E20202020202020-
  6062 00002BBF 202020202020202020-
  6062 00002BC8 2020202020DDDBDE   
  6063 00002BD0 DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6063 00002BD9 202020202020202020-
  6063 00002BE2 20202020207C202020-
  6063 00002BEB 202020205C202F2020-
  6063 00002BF4 5F5F20205C20202020-
  6063 00002BFD 20202F202020202020-
  6063 00002C06 207C20202020202020-
  6063 00002C0F 202020202020202020-
  6063 00002C18 2020202020DDDBDE   
  6064 00002C20 DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6064 00002C29 202020202020202020-
  6064 00002C32 20202020207C20202E-
  6064 00002C3B 2D2D2E20207C20207C-
  6064 00002C44 20207C20207C202020-
  6064 00002C4D 207C202020282D2D2D-
  6064 00002C56 2D6020202020202020-
  6064 00002C5F 202020202020202020-
  6064 00002C68 2020202020DDDBDE   
  6065 00002C70 DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6065 00002C79 202020202020202020-
  6065 00002C82 20202020207C20207C-
  6065 00002C8B 20207C20207C20207C-
  6065 00002C94 20207C20207C202020-
  6065 00002C9D 20205C2020205C2020-
  6065 00002CA6 202020202020202020-
  6065 00002CAF 202020202020202020-
  6065 00002CB8 2020202020DDDBDE   
  6066 00002CC0 DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6066 00002CC9 202020202020202020-
  6066 00002CD2 20202020207C202027-
  6066 00002CDB 2D2D2720207C202060-
  6066 00002CE4 2D2D2720207C202E2D-
  6066 00002CED 2D2D2D292020207C20-
  6066 00002CF6 202020202020202020-
  6066 00002CFF 202020202020202020-
  6066 00002D08 2020202020DDDBDE   
  6067 00002D10 DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6067 00002D19 202020202020202020-
  6067 00002D22 20202020207C5F5F5F-
  6067 00002D2B 5F5F5F5F2F205C5F5F-
  6067 00002D34 5F5F5F5F2F20207C5F-
  6067 00002D3D 5F5F5F5F5F5F2F2020-
  6067 00002D46 202020202020202020-
  6067 00002D4F 202020202020202020-
  6067 00002D58 2020202020DDDBDE   
  6068 00002D60 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6068 00002D69 202020202020202020-
  6068 00002D72 202020202020202020-
  6068 00002D7B 202020202020202020-
  6068 00002D84 202020202020202020-
  6068 00002D8D 202020202020202020-
  6068 00002D96 202020202020202020-
  6068 00002D9F 202020202020202020-
  6068 00002DA8 2020202020DDDBDE   
  6069 00002DB0 DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6069 00002DB9 5F5F5F5F5F5F202020-
  6069 00002DC2 205F5F202020202020-
  6069 00002DCB 202020205F5F5F2020-
  6069 00002DD4 205F5F5F5F20202020-
  6069 00002DDD 5F5F5F5F20205F5F5F-
  6069 00002DE6 5F5F5F5F202E5F5F5F-
  6069 00002DEF 5F5F5F202020202020-
  6069 00002DF8 2020202020DDDBDE   
  6070 00002E00 DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6070 00002E09 2020205F20205C2020-
  6070 00002E12 7C20207C2020202020-
  6070 00002E1B 2020202F2020205C20-
  6070 00002E24 205C2020205C20202F-
  6070 00002E2D 2020202F207C202020-
  6070 00002E36 5F5F5F5F7C7C202020-
  6070 00002E3F 5F20205C2020202020-
  6070 00002E48 2020202020DDDBDE   
  6071 00002E50 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6071 00002E59 20207C5F2920207C20-
  6071 00002E62 7C20207C2020202020-
  6071 00002E6B 20202F20205E20205C-
  6071 00002E74 20205C2020205C2F20-
  6071 00002E7D 20202F20207C20207C-
  6071 00002E86 5F5F2020207C20207C-
  6071 00002E8F 5F2920207C20202020-
  6071 00002E98 2020202020DDDBDE   
  6072 00002EA0 DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6072 00002EA9 2020205F5F5F2F2020-
  6072 00002EB2 7C20207C2020202020-
  6072 00002EBB 202F20202F5F5C2020-
  6072 00002EC4 5C20205C5F20202020-
  6072 00002ECD 5F2F2020207C202020-
  6072 00002ED6 5F5F7C20207C202020-
  6072 00002EDF 2020202F2020202020-
  6072 00002EE8 2020202020DDDBDE   
  6073 00002EF0 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6073 00002EF9 20207C202020202020-
  6073 00002F02 7C2020602D2D2D2D2E-
  6073 00002F0B 2F20205F5F5F5F5F20-
  6073 00002F14 205C2020207C20207C-
  6073 00002F1D 20202020207C20207C-
  6073 00002F26 5F5F5F5F207C20207C-
  6073 00002F2F 5C20205C2D2D2D2D2E-
  6073 00002F38 2020202020DDDBDE   
  6074 00002F40 DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6074 00002F49 205F7C202020202020-
  6074 00002F52 7C5F5F5F5F5F5F5F2F-
  6074 00002F5B 5F5F2F20202020205C-
  6074 00002F64 5F5F5C20207C5F5F7C-
  6074 00002F6D 20202020207C5F5F5F-
  6074 00002F76 5F5F5F5F7C7C205F7C-
  6074 00002F7F 20602E5F5F5F5F5F7C-
  6074 00002F88 2020202020DDDBDE   
  6075 00002F90 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6075 00002F99 202020202020202020-
  6075 00002FA2 202020202020202020-
  6075 00002FAB 202020202020202020-
  6075 00002FB4 202020202020202020-
  6075 00002FBD 202020202020202020-
  6075 00002FC6 202020202020202020-
  6075 00002FCF 202020202020202020-
  6075 00002FD8 2020202020DDDBDE   
  6076 00002FE0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6076 00002FE9 202020202020202020-
  6076 00002FF2 202020202020202020-
  6076 00002FFB 202020202020202020-
  6076 00003004 202020202020202020-
  6076 0000300D 202020202020202020-
  6076 00003016 202020202020202020-
  6076 0000301F 202020202020202020-
  6076 00003028 2020202020DDDBDE   
  6077 00003030 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6077 00003039 202020202020202020-
  6077 00003042 202020202020202020-
  6077 0000304B 202020202020202020-
  6077 00003054 202020202020202020-
  6077 0000305D 202020202020202020-
  6077 00003066 202020202020202020-
  6077 0000306F 202020202020202020-
  6077 00003078 2020202020DDDBDE   
  6078 00003080 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6078 00003089 202020202020202020-
  6078 00003092 202020202020202020-
  6078 0000309B 202020202020202020-
  6078 000030A4 202020202020202020-
  6078 000030AD 202020202020202020-
  6078 000030B6 202020202020202020-
  6078 000030BF 202020202020202020-
  6078 000030C8 2020202020DDDBDE   
  6079 000030D0 DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6079 000030D9 202020202020202020-
  6079 000030E2 202020202020202020-
  6079 000030EB 202020202020202057-
  6079 000030F4 454C434F4D4520544F-
  6079 000030FD 202020202020202020-
  6079 00003106 202020202020202020-
  6079 0000310F 202020202020202020-
  6079 00003118 2020202020DDDBDE   
  6080 00003120 DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6080 00003129 202020202020202020-
  6080 00003132 202020202020202020-
  6080 0000313B 202020202020202044-
  6080 00003144 4F5320504C41594552-
  6080 0000314D 202020202020202020-
  6080 00003156 202020202020202020-
  6080 0000315F 202020202020202020-
  6080 00003168 2020202020DDDBDE   
  6081 00003170 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6081 00003179 202020202020202020-
  6081 00003182 202020202020202020-
  6081 0000318B 202020202020202020-
  6081 00003194 202020202020202020-
  6081 0000319D 202020202020202020-
  6081 000031A6 202020202020202020-
  6081 000031AF 202020202020202020-
  6081 000031B8 2020202020DDDBDE   
  6082 000031C0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6082 000031C9 202020202020202020-
  6082 000031D2 202020202020202020-
  6082 000031DB 202020202020202020-
  6082 000031E4 202020202020202020-
  6082 000031ED 202020202020202020-
  6082 000031F6 202020202020202020-
  6082 000031FF 202020202020202020-
  6082 00003208 2020202020DDDBDE   
  6083 00003210 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6083 00003219 202020202020202020-
  6083 00003222 202020202020202020-
  6083 0000322B 202020202020202020-
  6083 00003234 202020202020202020-
  6083 0000323D 202020202020202020-
  6083 00003246 202020202020202020-
  6083 0000324F 202020202020202020-
  6083 00003258 2020202020DDDBDE   
  6084 00003260 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6084 00003269 202020202020202020-
  6084 00003272 202020202020202020-
  6084 0000327B 202020202020202020-
  6084 00003284 202020202020202020-
  6084 0000328D 202020202020202020-
  6084 00003296 202020202020202020-
  6084 0000329F 202020202020202020-
  6084 000032A8 2020202020DDDBDE   
  6085 000032B0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6085 000032B9 202020202020202020-
  6085 000032C2 202020202020202020-
  6085 000032CB 202020202020202020-
  6085 000032D4 202020202020202020-
  6085 000032DD 202020202020202020-
  6085 000032E6 202020202020202020-
  6085 000032EF 202020202020202020-
  6085 000032F8 2020202020DDDBDE   
  6086 00003300 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6086 00003309 202020202020202020-
  6086 00003312 202020202020202020-
  6086 0000331B 202020202020202020-
  6086 00003324 202020202020202020-
  6086 0000332D 202020202020202020-
  6086 00003336 202020202020202020-
  6086 0000333F 202020202020202020-
  6086 00003348 2020202020DDDBDE   
  6087 00003350 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6087 00003359 202020202020202020-
  6087 00003362 202020202020202020-
  6087 0000336B 202020202020202020-
  6087 00003374 202020202020202020-
  6087 0000337D 202020202020202020-
  6087 00003386 202020202020202020-
  6087 0000338F 202020202020202020-
  6087 00003398 2020202020DDDBDE   
  6088 000033A0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6088 000033A9 202020202020202020-
  6088 000033B2 202020202020202020-
  6088 000033BB 202020202020202020-
  6088 000033C4 202020202020202020-
  6088 000033CD 202020202020202020-
  6088 000033D6 202020202020202020-
  6088 000033DF 202020202020202020-
  6088 000033E8 2020202020DDDBDE   
  6089 000033F0 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6089 000033F9 202020202020202020-
  6089 00003402 202020202020202020-
  6089 0000340B 202020202020202020-
  6089 00003414 202020202020202020-
  6089 0000341D 202020202020202020-
  6089 00003426 202020202020202020-
  6089 0000342F 202020202020202020-
  6089 00003438 2020202020DDDBDE   
  6090 00003440 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6090 00003449 202020202020202020-
  6090 00003452 202020202020202020-
  6090 0000345B 202020202020202020-
  6090 00003464 202020202020202020-
  6090 0000346D 202020202020202020-
  6090 00003476 202020202020202020-
  6090 0000347F 202020202020202020-
  6090 00003488 2020202020DDDBDE   
  6091 00003490 00                      	db 0
  6092                                  
  6093                                  ; -------------------------------------------------------------
  6094                                  
  6095                                  	; 22/12/2024
  6096                                  	; 21/12/2024
  6097                                  PlayingScreen:
  6098 00003491 DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6098 0000349A DBDBDBDBDBDBDBDBDB-
  6098 000034A3 DBDBDBDBDBDBDBDBDB-
  6098 000034AC DBDBDBDBDBDBDB2044-
  6098 000034B5 4F5320506C61796572-
  6098 000034BE 20DBDBDBDBDBDBDBDB-
  6098 000034C7 DBDBDBDBDBDBDBDBDB-
  6098 000034D0 DBDBDBDBDBDBDBDBDB-
  6098 000034D9 DBDBDBDBDBDBDBDB   
  6099 000034E1 C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6099 000034EA CDCDCDCDCDCDCDCDCD-
  6099 000034F3 CDCDCDCDCDCDCDCDCD-
  6099 000034FC CDCDCDCDCDCDCDCDCD-
  6099 00003505 CDCDCDCDCDCDCDCDCD-
  6099 0000350E CDCDCDCDCDCDCDCDCD-
  6099 00003517 CDCDCDCDCDCDCDCDCD-
  6099 00003520 CDCDCDCDCDCDCDCDCD-
  6099 00003529 CDCDCDCDCDCDCDBB   
  6100 00003531 BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6100 0000353A 202020202020202020-
  6100 00003543 202020202020202020-
  6100 0000354C 202020202020202055-
  6100 00003555 736572204775696465-
  6100 0000355E 202020202020202020-
  6100 00003567 202020202020202020-
  6100 00003570 202020202020202020-
  6100 00003579 20202020202020BA   
  6101 00003581 BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<H>             Hardware Info", 9 dup(32), 186
  6101 0000358A 706163653E20202020-
  6101 00003593 2020202020506C6179-
  6101 0000359C 2F5061757365202020-
  6101 000035A5 20202020203C483E20-
  6101 000035AE 202020202020202020-
  6101 000035B7 202020486172647761-
  6101 000035C0 726520496E666F2020-
  6101 000035C9 20202020202020BA   
  6102 000035D1 BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>         Wave Lighting", 9 dup(32), 186
  6102 000035DA 3E2020202020202020-
  6102 000035E3 202020202053746F70-
  6102 000035EC 202020202020202020-
  6102 000035F5 20202020203C456E74-
  6102 000035FE 65723E202020202020-
  6102 00003607 20202057617665204C-
  6102 00003610 69676874696E672020-
  6102 00003619 20202020202020BA   
  6103 00003621 BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6103 0000362A 3E2020202020202020-
  6103 00003633 2020202020466F7277-
  6103 0000363C 617264732020202020-
  6103 00003645 20202020203C2B3E2F-
  6103 0000364E 3C2D3E202020202020-
  6103 00003657 202020496E632F4465-
  6103 00003660 6320566F6C756D6520-
  6103 00003669 20202020202020BA   
  6104 00003671 BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6104 0000367A 3E2020202020202020-
  6104 00003683 20202020204261636B-
  6104 0000368C 776172647320202020-
  6104 00003695 20202020203C513E20-
  6104 0000369E 202020202020202020-
  6104 000036A7 202020517569742050-
  6104 000036B0 726F6772616D202020-
  6104 000036B9 20202020202020BA   
  6105 000036C1 CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6105 000036CA CDCDCDCDCDCDCDCDCD-
  6105 000036D3 CDCDCDCDCDCDCDCDCD-
  6105 000036DC CDCDCDCDCDCDCDCDCD-
  6105 000036E5 CDCDCDCDCDCDCDCDCD-
  6105 000036EE CDCDCDCDCDCDCDCDCD-
  6105 000036F7 CDCDCDCDCDCDCDCDCD-
  6105 00003700 CDCDCDCDCDCDCDCDCD-
  6105 00003709 CDCDCDCDCDCDCDB9   
  6106 00003711 BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6106 0000371A 6C65204E616D65203A-
  6106 00003723 202020202020202020-
  6106 0000372C 202020202020202020-
  6106 00003735 20202020204269742D-
  6106 0000373E 5261746520203A2020-
  6106 00003747 202020302020426974-
  6106 00003750 732020202020202020-
  6106 00003759 20202020202020BA   
  6107 00003761 BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6107 0000376A 657175656E6379203A-
  6107 00003773 202020202030202020-
  6107 0000377C 2020487A2020202020-
  6107 00003785 2020202020232D4368-
  6107 0000378E 616E6E656C733A2020-
  6107 00003797 202020302020202020-
  6107 000037A0 202020202020202020-
  6107 000037A9 20202020202020BA   
  6108 000037B1 C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6108 000037BA CDCDCDCDCDCDCDCDCD-
  6108 000037C3 CDCDCDCDCDCDCDCDCD-
  6108 000037CC CDCDCDCDCDCDCDCDCD-
  6108 000037D5 CDCDCDCDCDCDCDCDCD-
  6108 000037DE CDCDCDCDCDCDCDCDCD-
  6108 000037E7 CDCDCDCDCDCDCDCDCD-
  6108 000037F0 CDCDCDCDCDCDCDCDCD-
  6108 000037F9 CDCDCDCDCDCDCDBC   
  6109 00003801 202020202020202020-     	db  80 dup(32)
  6109 0000380A 202020202020202020-
  6109 00003813 202020202020202020-
  6109 0000381C 202020202020202020-
  6109 00003825 202020202020202020-
  6109 0000382E 202020202020202020-
  6109 00003837 202020202020202020-
  6109 00003840 202020202020202020-
  6109 00003849 2020202020202020   
  6110                                  improper_samplerate_txt:
  6111                                  read_error_txt:
  6112 00003851 202020202020202020-     	db  80 dup(32)
  6112 0000385A 202020202020202020-
  6112 00003863 202020202020202020-
  6112 0000386C 202020202020202020-
  6112 00003875 202020202020202020-
  6112 0000387E 202020202020202020-
  6112 00003887 202020202020202020-
  6112 00003890 202020202020202020-
  6112 00003899 2020202020202020   
  6113 000038A1 202020202020202020-     	db  80 dup(32)
  6113 000038AA 202020202020202020-
  6113 000038B3 202020202020202020-
  6113 000038BC 202020202020202020-
  6113 000038C5 202020202020202020-
  6113 000038CE 202020202020202020-
  6113 000038D7 202020202020202020-
  6113 000038E0 202020202020202020-
  6113 000038E9 2020202020202020   
  6114 000038F1 202020202020202020-     	db  80 dup(32)
  6114 000038FA 202020202020202020-
  6114 00003903 202020202020202020-
  6114 0000390C 202020202020202020-
  6114 00003915 202020202020202020-
  6114 0000391E 202020202020202020-
  6114 00003927 202020202020202020-
  6114 00003930 202020202020202020-
  6114 00003939 2020202020202020   
  6115 00003941 202020202020202020-     	db  80 dup(32)
  6115 0000394A 202020202020202020-
  6115 00003953 202020202020202020-
  6115 0000395C 202020202020202020-
  6115 00003965 202020202020202020-
  6115 0000396E 202020202020202020-
  6115 00003977 202020202020202020-
  6115 00003980 202020202020202020-
  6115 00003989 2020202020202020   
  6116 00003991 202020202020202020-     	db  80 dup(32)
  6116 0000399A 202020202020202020-
  6116 000039A3 202020202020202020-
  6116 000039AC 202020202020202020-
  6116 000039B5 202020202020202020-
  6116 000039BE 202020202020202020-
  6116 000039C7 202020202020202020-
  6116 000039D0 202020202020202020-
  6116 000039D9 2020202020202020   
  6117 000039E1 202020202020202020-     	db  80 dup(32)
  6117 000039EA 202020202020202020-
  6117 000039F3 202020202020202020-
  6117 000039FC 202020202020202020-
  6117 00003A05 202020202020202020-
  6117 00003A0E 202020202020202020-
  6117 00003A17 202020202020202020-
  6117 00003A20 202020202020202020-
  6117 00003A29 2020202020202020   
  6118 00003A31 202020202020202020-     	db  80 dup(32)
  6118 00003A3A 202020202020202020-
  6118 00003A43 202020202020202020-
  6118 00003A4C 202020202020202020-
  6118 00003A55 202020202020202020-
  6118 00003A5E 202020202020202020-
  6118 00003A67 202020202020202020-
  6118 00003A70 202020202020202020-
  6118 00003A79 2020202020202020   
  6119 00003A81 202020202020202020-     	db  80 dup(32)
  6119 00003A8A 202020202020202020-
  6119 00003A93 202020202020202020-
  6119 00003A9C 202020202020202020-
  6119 00003AA5 202020202020202020-
  6119 00003AAE 202020202020202020-
  6119 00003AB7 202020202020202020-
  6119 00003AC0 202020202020202020-
  6119 00003AC9 2020202020202020   
  6120 00003AD1 202020202020202020-     	db  80 dup(32)
  6120 00003ADA 202020202020202020-
  6120 00003AE3 202020202020202020-
  6120 00003AEC 202020202020202020-
  6120 00003AF5 202020202020202020-
  6120 00003AFE 202020202020202020-
  6120 00003B07 202020202020202020-
  6120 00003B10 202020202020202020-
  6120 00003B19 2020202020202020   
  6121 00003B21 202020202020202020-     	db  80 dup(32)
  6121 00003B2A 202020202020202020-
  6121 00003B33 202020202020202020-
  6121 00003B3C 202020202020202020-
  6121 00003B45 202020202020202020-
  6121 00003B4E 202020202020202020-
  6121 00003B57 202020202020202020-
  6121 00003B60 202020202020202020-
  6121 00003B69 2020202020202020   
  6122 00003B71 202020202020202020-     	db  80 dup(32)
  6122 00003B7A 202020202020202020-
  6122 00003B83 202020202020202020-
  6122 00003B8C 202020202020202020-
  6122 00003B95 202020202020202020-
  6122 00003B9E 202020202020202020-
  6122 00003BA7 202020202020202020-
  6122 00003BB0 202020202020202020-
  6122 00003BB9 2020202020202020   
  6123 00003BC1 202020202020202020-     	db  80 dup(32)
  6123 00003BCA 202020202020202020-
  6123 00003BD3 202020202020202020-
  6123 00003BDC 202020202020202020-
  6123 00003BE5 202020202020202020-
  6123 00003BEE 202020202020202020-
  6123 00003BF7 202020202020202020-
  6123 00003C00 202020202020202020-
  6123 00003C09 2020202020202020   
  6124 00003C11 202020202020202020-     	db  80 dup(32)
  6124 00003C1A 202020202020202020-
  6124 00003C23 202020202020202020-
  6124 00003C2C 202020202020202020-
  6124 00003C35 202020202020202020-
  6124 00003C3E 202020202020202020-
  6124 00003C47 202020202020202020-
  6124 00003C50 202020202020202020-
  6124 00003C59 2020202020202020   
  6125 00003C61 202020202020202020-     	db  80 dup(32)
  6125 00003C6A 202020202020202020-
  6125 00003C73 202020202020202020-
  6125 00003C7C 202020202020202020-
  6125 00003C85 202020202020202020-
  6125 00003C8E 202020202020202020-
  6125 00003C97 202020202020202020-
  6125 00003CA0 202020202020202020-
  6125 00003CA9 2020202020202020   
  6126 00003CB1 202020202020202020-     	db  80 dup(32)
  6126 00003CBA 202020202020202020-
  6126 00003CC3 202020202020202020-
  6126 00003CCC 202020202020202020-
  6126 00003CD5 202020202020202020-
  6126 00003CDE 202020202020202020-
  6126 00003CE7 202020202020202020-
  6126 00003CF0 202020202020202020-
  6126 00003CF9 2020202020202020   
  6127 00003D01 202020202020202020-     	db  80 dup(32)
  6127 00003D0A 202020202020202020-
  6127 00003D13 202020202020202020-
  6127 00003D1C 202020202020202020-
  6127 00003D25 202020202020202020-
  6127 00003D2E 202020202020202020-
  6127 00003D37 202020202020202020-
  6127 00003D40 202020202020202020-
  6127 00003D49 2020202020202020   
  6128 00003D51 202020202020202020-     	db  80 dup(32)
  6128 00003D5A 202020202020202020-
  6128 00003D63 202020202020202020-
  6128 00003D6C 202020202020202020-
  6128 00003D75 202020202020202020-
  6128 00003D7E 202020202020202020-
  6128 00003D87 202020202020202020-
  6128 00003D90 202020202020202020-
  6128 00003D99 2020202020202020   
  6129 00003DA1 202020202020202020-     	db  80 dup(32)
  6129 00003DAA 202020202020202020-
  6129 00003DB3 202020202020202020-
  6129 00003DBC 202020202020202020-
  6129 00003DC5 202020202020202020-
  6129 00003DCE 202020202020202020-
  6129 00003DD7 202020202020202020-
  6129 00003DE0 202020202020202020-
  6129 00003DE9 2020202020202020   
  6130 00003DF1 CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6130 00003DFA CDCDCDCDCDCDCDCDCD-
  6130 00003E03 CDCDCDCDCDCDCDCDCD-
  6130 00003E0C CDCDCDCDCDCDCDCDCD-
  6130 00003E15 CDCDCDCDCDCDCDCDCD-
  6130 00003E1E CDCDCDCDCDCDCDCDCD-
  6130 00003E27 CDCDCDCDCDCDCDCDCD-
  6130 00003E30 CDCDCDCDCDCDCDCDCD-
  6130 00003E39 CDCDCDCDCDCDCDCD   
  6131 00003E41 202020202020202020-     	db  80 dup(32)
  6131 00003E4A 202020202020202020-
  6131 00003E53 202020202020202020-
  6131 00003E5C 202020202020202020-
  6131 00003E65 202020202020202020-
  6131 00003E6E 202020202020202020-
  6131 00003E77 202020202020202020-
  6131 00003E80 202020202020202020-
  6131 00003E89 2020202020202020   
  6132 00003E91 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6132 00003E9A 202020202020202020-
  6132 00003EA3 202020202020202020-
  6132 00003EAC 20202020202030303A-
  6132 00003EB5 303020AEAF2030303A-
  6132 00003EBE 303020202020202020-
  6132 00003EC7 202020202020202020-
  6132 00003ED0 202020202020202056-
  6132 00003ED9 4F4C2030303025     
  6133 00003EE0 00                      	db 0
  6134                                  
  6135                                  ; -------------------------------------------------------------
  6136                                  	
  6137                                  program_msg:
  6138 00003EE1 5452444F5320333836-     	db "TRDOS 386 v2.0.9 - ('sysvideo') Test Program - Dos Player"
  6138 00003EEA 2076322E302E39202D-
  6138 00003EF3 202827737973766964-
  6138 00003EFC 656F27292054657374-
  6138 00003F05 2050726F6772616D20-
  6138 00003F0E 2D20446F7320506C61-
  6138 00003F17 796572             
  6139 00003F1A 0D0A                    	db 0Dh, 0Ah
  6140 00003F1C 6279204572646F6761-     	db "by Erdogan Tan - 22/12/2024"
  6140 00003F25 6E2054616E202D2032-
  6140 00003F2E 322F31322F32303234 
  6141 00003F37 0D0A0D0A                	db 0Dh, 0Ah, 0Dh, 0Ah
  6142                                  
  6143 00003F3B 507265737320455343-     	db "Press ESC to exit .."
  6143 00003F44 20746F206578697420-
  6143 00003F4D 2E2E               
  6144 00003F4F 0D0A                    	db 0Dh, 0Ah
  6145 00003F51 0D0A                    	db 0Dh, 0Ah
  6146 00003F53 507265737320616E79-     	db "Press any key to continue .."
  6146 00003F5C 206B657920746F2063-
  6146 00003F65 6F6E74696E7565202E-
  6146 00003F6E 2E                 
  6147                                  nextline:
  6148 00003F6F 0D0A00                  	db 0Dh, 0Ah, 0
  6149                                  
  6150                                  ; -------------------------------------------------------------
  6151                                  
  6152                                  	; 22/12/2024
  6153                                  fillblock:
  6154 00003F72 FF<rep Eh>              	times 14 db 0FFh
  6155 00003F80 0000                    	dw 0
  6156                                  
  6157                                  ; -------------------------------------------------------------
  6158                                  
  6159                                  ; 23/11/2024
  6160                                  colors:
  6161 00003F82 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6162                                  	; white, cyan, green, red, yellow, blue, magenta
  6163 00003F8A 0B                      ccolor:	db 0Bh	; cyan
  6164                                  
  6165                                  EOF: 
  6166                                  
  6167                                  ; -------------------------------------------------------------
  6168                                  
  6169                                  bss:
  6170                                  
  6171                                  ABSOLUTE bss
  6172                                  
  6173 00003F8B ??                      alignb 4
  6174                                  
  6175                                  ; 21/12/2024
  6176                                  fontbuff1:
  6177 00003F8C <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6178                                  fontbuff2:
  6179 00004D8C <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6180                                  
  6181                                  ; 11/12/2024
  6182                                  wleds_addr:
  6183 00005D8C <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6184                                  ; 22/12/2024
  6185                                  prev_leds:
  6186 0000718C <res 140h>              	resd 80	; previous lighting leds
  6187                                  
  6188                                  LFB_ADDR:
  6189 000072CC ????????                	resd 1
  6190                                  ;nextrow:
  6191                                  	;resd 1
  6192                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6193 000072D0 ????????                	resd 1
  6194 000072D4 ????????                wcolor:	resd 1
  6195 000072D8 ??                      tcolor: resb 1 ; text color
  6196                                  columns:
  6197 000072D9 ??                      	resb 1
  6198 000072DA ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6199                                  
  6200 000072DB ??                      alignb 4
  6201                                  
  6202                                  bss_start:
  6203                                  
  6204                                  ; 18/11/2024
  6205                                  stopped:
  6206 000072DC ??                      	resb 1
  6207 000072DD ??                      tLO:	resb 1
  6208                                  ; 21/11/2024
  6209 000072DE ??                      tLP:	resb 1
  6210                                  ; 19/11/2024
  6211 000072DF ??                      wleds:	resb 1
  6212                                  wleds_dif:
  6213 000072E0 ????????                	resd 1
  6214 000072E4 ????????                pbuf_o:	resd 1
  6215                                  ; 07/12/2024
  6216 000072E8 ??                      pbuf_s:	resb 1
  6217                                  
  6218                                  ; 07/12/2024
  6219                                  ; 24/11/2024
  6220                                  half_buffer:
  6221 000072E9 ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6222                                  
  6223                                  ; 30/05/2024
  6224 000072EA ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6225                                  
  6226                                  ; 30/11/2024
  6227 000072EB ??                      alignb 4
  6228                                  
  6229                                  ;;;;;;;;;;;;;;
  6230                                  ; 14/11/2024
  6231                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6232                                  WAVFILEHEADERbuff:
  6233                                  RIFF_ChunkID:
  6234 000072EC ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6235                                  		; 0x52494646
  6236                                  RIFF_ChunkSize:
  6237 000072F0 ????????                	resd 1	; Represents total file size, not 
  6238                                          	; including the first 2 fields 
  6239                                  		; (Total_File_Size - 8), little-endian
  6240                                  RIFF_Format:
  6241 000072F4 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6242                                  		; 0x57415645
  6243                                  
  6244                                  ;; WAVE header parameters ("Sub-chunk")
  6245                                  WAVE_SubchunkID:
  6246 000072F8 ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6247                                  		; 0x666d7420
  6248                                  WAVE_SubchunkSize:
  6249 000072FC ????????                	resd 1	; Represents total chunk size
  6250                                  WAVE_AudioFormat:
  6251 00007300 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6252                                  		; of compression, not supported.
  6253                                  WAVE_NumChannels:
  6254 00007302 ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6255                                  WAVE_SampleRate:
  6256 00007304 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6257                                  WAVE_ByteRate:
  6258 00007308 ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6259                                  WAVE_BlockAlign:
  6260 0000730C ????                    	resw 1	; NumChannels * BytesPerSample
  6261                                  		; Number of bytes for one sample.
  6262                                  WAVE_BitsPerSample:
  6263 0000730E ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6264                                  
  6265                                  ;; DATA header parameters
  6266                                  DATA_SubchunkID:
  6267 00007310 ????????                	resd 1	; Must be equal to "data" - big-endian
  6268                                          	; 0x64617461
  6269                                  DATA_SubchunkSize:
  6270 00007314 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6271                                          	; Number of bytes in the data.
  6272                                  ;;;;;;;;;;;;;;
  6273                                  
  6274                                  ; 15/11/2024
  6275                                  cursortype:
  6276 00007318 ????                    	resw 1
  6277 0000731A ??                      flags:	resb 1
  6278                                  ; 06/11/2023
  6279                                  ac97_int_ln_reg:
  6280 0000731B ??                      	resb 1
  6281                                  filehandle:
  6282 0000731C ????????                	resd 1
  6283                                  
  6284                                  ; 30/05/2024
  6285                                  wav_file_name:
  6286 00007320 <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6287 00007370 ????                    	resw 1	; 30/11/2024
  6288                                  
  6289                                  ; 08/11/2023
  6290                                  ; 07/11/2023
  6291                                  fbs_shift:
  6292 00007372 ??                      	resb 1
  6293                                  ; 07/12/2024
  6294 00007373 ??                      SRB:	resb 1
  6295                                  
  6296                                  ; 12/11/2016 - Erdogan Tan
  6297                                  bus_dev_fn:
  6298 00007374 ????????                	resd 1
  6299                                  dev_vendor:
  6300 00007378 ????????                	resd 1
  6301                                  
  6302                                  ; 17/02/2017
  6303                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6304                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6305                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6306                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6307 0000737C ????                    NAMBAR:	resw 1	; BAR for mixer
  6308                                  NABMBAR:
  6309 0000737E ????                    	resw 1	; BAR for bus master regs
  6310                                  
  6311                                  ; 15/11/2024
  6312                                  loadfromwavfile:
  6313 00007380 ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6314                                  loadsize:
  6315 00007384 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6316                                  buffersize:
  6317 00007388 ????????                	resd 1	; 16 bit samples (not bytes)
  6318                                  		
  6319                                  ; 14/11/2024
  6320                                  TotalTime:
  6321 0000738C ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6322                                  ProgressTime:
  6323 00007390 ????????                	resd 1
  6324 00007394 ????????                count:	resd 1	; byte count of one (wav file) read
  6325                                  LoadedDataBytes:
  6326 00007398 ????????                	resd 1	; total read/load count
  6327                                  
  6328                                  timerticks:
  6329 0000739C ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6330                                  		; (in order to get the emulator/qemu to run correctly)
  6331                                  ; 14/11/2024	
  6332                                  bss_end:
  6333                                  
  6334                                  ; 02/12/2024
  6335 000073A0 <res C60h>              alignb 4096
  6336                                  
  6337                                  ; 07/12/2024
  6338                                  ; 26/11/2023
  6339                                  audio_buffer:
  6340 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6341                                  
  6342                                  ; 01/12/2024
  6343                                  ; 26/11/2023
  6344                                  temp_buffer:
  6345 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
