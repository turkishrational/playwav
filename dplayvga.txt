     1                                  ; ****************************************************************************
     2                                  ; dplayvga.s - TRDOS 386 (TRDOS v2.0.3) Test Program - 'sysvideo' pixel tests
     3                                  ; ----------------------------------------------------------------------------
     4                                  ; DPLAYVGA.PRG ! AC'97 (ICH) .WAV PLAYER program by Erdogan TAN
     5                                  ;
     6                                  ; 21/12/2024
     7                                  ;
     8                                  ; [ Last Modification: 23/01/2025 ]
     9                                  ;
    10                                  ; Modified from PLAYWAV9.PRG .wav player program by Erdogan Tan, 18/12/2024
    11                                  ;
    12                                  ; ****************************************************************************
    13                                  ; nasm dplayvga.s -l dplayvga.txt -o DPLAYVGA.PRG -Z error.txt
    14                                  ; (modified from 'circle10.s', 18/02/2021)
    15                                  
    16                                  ; Draw graphics by using 'sysvideo' bx=0305h
    17                                  ; and display text by using bx=010Fh
    18                                  
    19                                  ; 07/12/2024 - playwav9.s - interrupt (srb) + tuneloop version
    20                                  ; ------------------------------------------------------------
    21                                  ; INTERRUPT (SRB) + TUNELOOP version ; 24/11/2024 (PLAYWAV9.ASM)
    22                                  ;	(running in DOSBOX, VIRTUALBOX, QEMU is ok)
    23                                  ; Signal Response Byte = message/signal to user about an event/interrupt
    24                                  ;	    as requested (TuneLoop procedure continuously checks this SRB)
    25                                  ; (TRDOS 386 v2 feature is used here as very simple interrupt handler output)
    26                                  
    27                                  ; ------------------------------------------------------------
    28                                  
    29                                  ; 30/11/2024
    30                                  ; 20/08/2024 ; TRDOS 386 v2.0.9
    31                                  ; 29/04/2016
    32                                  _ver 	equ 0
    33                                  _exit 	equ 1
    34                                  _fork 	equ 2
    35                                  _read 	equ 3
    36                                  _write	equ 4
    37                                  _open	equ 5
    38                                  _close 	equ 6
    39                                  _wait 	equ 7
    40                                  _creat 	equ 8
    41                                  _link 	equ 9
    42                                  _unlink	equ 10
    43                                  _exec	equ 11
    44                                  _chdir	equ 12
    45                                  _time 	equ 13
    46                                  _mkdir 	equ 14
    47                                  _chmod	equ 15
    48                                  _chown	equ 16
    49                                  _break	equ 17
    50                                  _stat	equ 18
    51                                  _seek	equ 19
    52                                  _tell 	equ 20
    53                                  _mount	equ 21
    54                                  _umount	equ 22
    55                                  _setuid	equ 23
    56                                  _getuid	equ 24
    57                                  _stime	equ 25
    58                                  _quit	equ 26
    59                                  _intr	equ 27
    60                                  _fstat	equ 28
    61                                  _emt 	equ 29
    62                                  _mdate 	equ 30
    63                                  _video 	equ 31
    64                                  _audio	equ 32
    65                                  _timer	equ 33
    66                                  _sleep	equ 34
    67                                  _msg    equ 35
    68                                  _geterr	equ 36
    69                                  _fpsave	equ 37
    70                                  _pri	equ 38
    71                                  _rele	equ 39
    72                                  _fff	equ 40
    73                                  _fnf	equ 41
    74                                  _alloc	equ 42
    75                                  _dalloc equ 43
    76                                  _calbac equ 44
    77                                  _dma	equ 45
    78                                  _stdio  equ 46
    79                                  
    80                                  ; ------------------------------------------------------------
    81                                  
    82                                  %macro sys 1-4
    83                                      ; 29/04/2016 - TRDOS 386 (TRDOS v2.0)
    84                                      ; 03/09/2015
    85                                      ; 13/04/2015
    86                                      ; Retro UNIX 386 v1 system call.
    87                                      %if %0 >= 2
    88                                          mov ebx, %2
    89                                          %if %0 >= 3
    90                                              mov ecx, %3
    91                                              %if %0 = 4
    92                                                 mov edx, %4
    93                                              %endif
    94                                          %endif
    95                                      %endif
    96                                      mov eax, %1
    97                                      ;int 30h
    98                                      int 40h ; TRDOS 386 (TRDOS v2.0)
    99                                  %endmacro
   100                                  
   101                                  ; Retro UNIX 386 v1 system call format:
   102                                  ; sys systemcall (eax) <arg1 (ebx)>, <arg2 (ecx)>, <arg3 (edx)>
   103                                  
   104                                  ; ------------------------------------------------------------
   105                                  
   106                                  ; player internal variables and other equates.
   107                                  BUFFERSIZE	equ 65536
   108                                  ENDOFFILE	equ 1		; flag for knowing end of file
   109                                  
   110                                  ; ------------------------------------------------------------
   111                                  
   112                                  [BITS 32] ; 32-bit intructions
   113                                  
   114                                  [ORG 0]
   115                                  
   116                                  START_CODE:
   117                                  	; clear bss
   118 00000000 BF[C0720000]            	mov	edi, bss_start
   119 00000005 B931000000              	mov	ecx, (bss_end - bss_start)/4
   120                                  	;xor	eax, eax
   121 0000000A F3AB                    	rep	stosd
   122                                  
   123                                  	; 21/12/2024
   124                                  	; program message
   125 0000000C BE[C53E0000]            	mov	esi, program_msg
   126 00000011 E821050000              	call	print_msg
   127                                  
   128 00000016 30E4                    	xor	ah, ah
   129                                  	;int	16h	; KEYBOARD - READ CHAR FROM BUFFER, WAIT IF EMPTY
   130                                  			; Return: AH = scan code, AL = character
   131 00000018 CD32                    	int	32h	; TRDOS 386 Keyboard interrupt
   132                                  
   133                                  	; set video mode to 03h (clear screen)
   134 0000001A 66B80300                	mov	ax, 03h
   135 0000001E CD31                    	int	31h
   136                                  
   137                                  	; Prints the Credits Text.
   138                                  	sys	_msg, Credits, 255, 0Bh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000020 BB[80270000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000025 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000002A BA0B000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000002F B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000034 CD40                <1>  int 40h
   139                                  
   140                                  ; -------------------------------------------------------------
   141                                  
   142                                  	; 21/12/2024
   143                                  	; Detect (& Enable) AC'97 Audio Device
   144 00000036 E8FC060000              	call	DetectAC97
   145 0000003B 731B                    	jnc	short ac97_hardware_ready
   146                                  
   147                                  	; 30/11/2024
   148                                  	; 30/05/2024
   149                                  _dev_not_ready:
   150                                  	; couldn't find the audio device!
   151                                  	sys	_msg, noDevMsg, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000003D BB[12280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000042 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000047 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000004C B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000051 CD40                <1>  int 40h
   152 00000053 E97C040000                      jmp     Exit
   153                                  
   154                                  ac97_hardware_ready:
   155 00000058 E879080000              	call	write_audio_dev_info
   156                                  
   157                                  ; -------------------------------------------------------------
   158                                  
   159                                  	; 21/12/2024
   160                                  	;;;
   161                                  	; Read (copy) 8x14 system fonts
   162 0000005D BE[703F0000]            	mov	esi, fontbuff1
   163                                  	sys	_video, 0C03h, 256, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000062 BB030C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000067 B900010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000006C BA00000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000071 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 00000076 CD40                <1>  int 40h
   164                                  
   165                                  	; convert 8x14 fonts to 8x16 fonts
   166                                  	; by inserting 2 empty rows to each characters
   167                                  	;mov	esi, fontbuff1
   168 00000078 BF[704D0000]            	mov	edi, fontbuff2
   169                                  	; 18/02/2021
   170                                  	;mov	cx, 256
   171                                  fontconvert:
   172 0000007D 51                      	push	ecx
   173 0000007E 66B90E00                	mov	cx, 14
   174 00000082 F3A4                    	rep	movsb
   175 00000084 28C0                    	sub	al, al
   176 00000086 AA                      	stosb
   177 00000087 AA                      	stosb
   178 00000088 59                      	pop	ecx
   179 00000089 E2F2                    	loop	fontconvert
   180                                  	;;;
   181                                  
   182                                  ; ------------------------------------------------------------- 
   183                                  
   184                                  	; 21/12/2024
   185                                  	; Set Video Mode to 101h ; 640x480, 256 colors
   186                                  	sys	_video, 08FFh, 101h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000008B BBFF080000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000090 B901010000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000095 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000009A CD40                <1>  int 40h
   187 0000009C 09C0                    	or	eax, eax
   188 0000009E 0F842B040000            	jz	terminate    ; nothing to do				
   189                                  	;jz	trdos386_err ; write (OS) error msg and exit
   190                                  
   191                                  set_vesa_mode_101h_ok:
   192                                  	; linear frame buffer access
   193                                  	sys	_video, 06FFh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000000A4 BBFF060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000000A9 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000000AE CD40                <1>  int 40h
   194 000000B0 21C0                    	and	eax, eax
   195 000000B2 0F8462040000            	jz	error_exit ; set text mode and write err msg
   196 000000B8 A3[B0720000]            	mov	[LFB_ADDR], eax
   197                                  
   198                                  ; -------------------------------------------------------------
   199                                  
   200                                  	; 07/12/2024
   201                                  GetFileName_@:
   202                                  	; 30/11/2024
   203                                  	; (TRDOS 386 -Retro UNIX 386- argument transfer method)
   204                                  	; (stack: argc,argv0addr,argv1addr,argv2addr ..
   205                                  	;			.. argv0text, argv1text ..) 
   206                                  	; ---- argc, argv[] ----
   207 000000BD 89E6                    	mov	esi, esp
   208 000000BF AD                      	lodsd
   209 000000C0 83F802                  	cmp	eax, 2 ; two arguments 
   210                                  		; (program file name & mod file name)
   211 000000C3 0F8214040000            	jb	pmsg_usage ; nothing to do
   212                                  	; 07/12/2024
   213 000000C9 AD                      	lodsd	; skip program (PRG) file name
   214                                  
   215                                  	; 30/11/2024 (32bit)
   216                                  	; 29/11/2024
   217                                  	; 30/05/2024
   218                                  GetFileName:
   219 000000CA BF[04730000]            	mov	edi, wav_file_name 
   220                                  	; 07/12/2024
   221 000000CF 8B36                    	mov	esi, [esi]
   222 000000D1 31C9                    	xor	ecx, ecx ; 0
   223                                  ScanName:
   224 000000D3 AC                      	lodsb
   225                                  	;test	al, al
   226                                  	;jz	short a_4
   227                                  	; 29/11/2024
   228 000000D4 3C0D                    	cmp	al, 0Dh
   229 000000D6 7638                    	jna	short a_4
   230 000000D8 3C20                    	cmp	al, 20h
   231 000000DA 74F7                    	je	short ScanName	; scan start of name.
   232 000000DC AA                      	stosb
   233 000000DD B4FF                    	mov	ah, 0FFh
   234                                  	;;;
   235                                  	; 14/11/2024
   236                                  	; (max. path length = 64 bytes for MSDOS ?) (*)
   237                                  	;xor	ecx, ecx ; 0
   238                                  	;;;
   239                                  a_0:	
   240 000000DF FEC4                    	inc	ah
   241                                  a_1:
   242                                  	;;;
   243                                  	; 14/11/2024
   244 000000E1 41                      	inc	ecx
   245                                  	;;;
   246 000000E2 AC                      	lodsb
   247 000000E3 AA                      	stosb
   248 000000E4 3C2E                    	cmp	al, '.'
   249 000000E6 74F7                    	je	short a_0
   250                                  	; 29/11/2024
   251 000000E8 3C20                    	cmp	al, 20h
   252                                  	;and	al, al
   253                                  	;jnz	short a_1
   254                                  	;;;
   255                                  	; 14/11/2024
   256 000000EA 7613                    	jna	short a_3
   257 000000EC 20E4                    	and	ah, ah
   258 000000EE 7406                    	jz	short a_2
   259 000000F0 3C2F                    	cmp	al, '/'	; 14/12/2024
   260 000000F2 7502                    	jne	short a_2
   261 000000F4 B400                    	mov	ah, 0
   262                                  a_2:
   263 000000F6 80F94B                  	cmp	cl, 75	; 64+8+'.'+3 -> offset 75 is the last chr
   264 000000F9 72E6                    	jb	short a_1
   265                                  	; 29/11/2024
   266 000000FB 29C9                    	sub	ecx, ecx
   267 000000FD EB11                    	jmp	short a_4
   268                                  a_3:
   269                                  	; 29/11/2024
   270 000000FF 4F                      	dec	edi
   271                                  	;;;
   272 00000100 08E4                    	or	ah, ah		; if period NOT found,
   273 00000102 750C                    	jnz	short a_4 	; then add a .WAV extension.
   274                                  SetExt:
   275                                  	; 29/11/2024
   276                                  	;dec	edi
   277 00000104 C7072E574156            	mov	dword [edi], '.WAV'
   278                                  				; ! 64+12 is DOS limit
   279                                  				; but writing +4 must not
   280                                  				; destroy the following data	 
   281                                  	;mov	byte [edi+4], 0	; so, 80 bytes path + 0 is possible here
   282                                  	; 29/11/2024
   283 0000010A 83C104                  	add	ecx, 4
   284 0000010D 83C704                  	add	edi, 4
   285                                  a_4:	
   286 00000110 C60700                  	mov	byte [edi], 0
   287                                  
   288                                          ; open existing file
   289                                  	; 28/11/2024
   290                                  	;mov	edx, wav_file_name
   291 00000113 E871060000                      call    openFile ; no error? ok.
   292 00000118 7325                            jnc     short getwavparms
   293                                  
   294                                  	; 21/12/2024
   295 0000011A E899040000              	call	set_text_mode
   296                                  	; file not found!
   297                                  	; 30/11/2024
   298                                  	sys	_msg, noFileErrMsg, 255, 0Ch
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000011F BB[3D280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000124 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000129 BA0C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000012E B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000133 CD40                <1>  int 40h
   299 00000135 E99A030000                      jmp     Exit
   300                                  
   301                                  _exit_:
   302 0000013A E990030000              	jmp	terminate
   303                                  
   304                                  ; -------------------------------------------------------------
   305                                  
   306                                  getwavparms:
   307                                  	; 14/11/2024
   308 0000013F E87A060000                     	call    getWAVParameters
   309 00000144 72F4                    	jc	short _exit_		; nothing to do
   310                                  
   311                                  	; 17/11/2024
   312 00000146 B304                    	mov	bl, 4
   313 00000148 2A1D[F0720000]          	sub	bl, byte [WAVE_BlockAlign]
   314                                  			; = 0 for 16 bit stereo
   315                                  			; = 2 for 8 bit stereo or 16 bit mono
   316                                  			; = 3 for 8 bit mono	
   317                                  
   318 0000014E D0EB                    	shr	bl, 1	;  0 -->  0,  2 -->  1,  3 -->  1
   319                                  	; 15/11/2024
   320 00000150 80D300                  	adc	bl, 0	; 3 --> 1 --> 2
   321 00000153 881D[56730000]          	mov	byte [fbs_shift], bl	; = 2 mono and 8 bit
   322                                  					; = 0 stereo and 16 bit
   323                                  					; = 1 mono or 8 bit
   324                                  
   325                                  ; -------------------------------------------------------------
   326                                  
   327                                  	; 21/12/2024
   328 00000159 C605[BC720000]0F        	mov	byte [tcolor], 15
   329                                  
   330                                  Player_SplashScreen:
   331                                  _0:
   332 00000160 E8F3030000              	call	drawsplashscreen
   333                                  
   334                                  	; 21/12/2024
   335                                  	;;;
   336                                  	; set wave volume led addresses
   337 00000165 8B1D[B0720000]          	mov	ebx, [LFB_ADDR]
   338 0000016B 81C300C70100            	add	ebx, (13*80*8*14)
   339 00000171 BD50000000              	mov	ebp, 80
   340 00000176 BF[705D0000]            	mov	edi, wleds_addr
   341                                  wleds_sa_1:
   342 0000017B B90F000000              	mov	ecx, 15
   343                                  wleds_sa_2:
   344 00000180 B800230000              	mov	eax, 80*8*14 ; 640*14 pixels (next row)
   345 00000185 F7E1                    	mul	ecx
   346 00000187 01D8                    	add	eax, ebx
   347 00000189 AB                      	stosd
   348 0000018A E2F4                    	loop	wleds_sa_2
   349 0000018C 89D8                    	mov	eax, ebx
   350 0000018E AB                      	stosd
   351 0000018F 83C308                  	add	ebx, 8
   352 00000192 4D                      	dec	ebp
   353 00000193 75E6                    	jnz	short wleds_sa_1
   354                                  	;;;
   355                                  
   356                                  	; 07/12/2024
   357                                  	;;; wait for 2 seconds
   358                                  	sys	_time, 0 ; get time in unix epoch format
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000195 BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000019A B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 0000019F CD40                <1>  int 40h
   359 000001A1 89C1                    	mov	ecx, eax
   360 000001A3 83C102                  	add	ecx, 2
   361                                  _wait_2s:
   362 000001A6 90                      	nop
   363                                  	sys	_time, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000001A7 BB00000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000001AC B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 000001B1 CD40                <1>  int 40h
   364 000001B3 39C8                    	cmp	eax, ecx
   365 000001B5 72EF                    	jb	short _wait_2s
   366                                  	;;;
   367                                  
   368                                  ; -------------------------------------------------------------
   369                                  
   370                                  	; 07/12/2024 (playwav9.s)
   371                                  
   372                                  	; 18/11/2023 (ich_wav4.asm)
   373                                  	; 13/11/2023 (ich_wav3.asm)
   374                                  
   375 000001B7 803D[CE720000]01        	cmp	byte [VRA], 1
   376 000001BE 7226                    	jb	short chk_sample_rate
   377                                  
   378                                  playwav_48_khz:
   379 000001C0 C705[64730000]-         	mov	dword [loadfromwavfile], loadFromFile
   379 000001C6 [08080000]         
   380                                  	;mov	dword [loadsize], 0 ; 65536
   381                                  	;;;
   382                                  	; 17/11/2024
   383                                  	;mov	word [buffersize], 32768
   384                                  	;mov	ax, BUFFERSIZE/2 ; 32760
   385                                  	; 30/11/2024
   386                                  	;mov	eax, BUFFERSIZE/2 ; 32768
   387                                  	; 07/12/2024
   388 000001CA B800000100              	mov	eax, BUFFERSIZE ; 65536
   389 000001CF A3[6C730000]            	mov	[buffersize], eax	; 16 bit samples
   390                                  	; 07/12/2024
   391                                  	;shl	eax, 1			; bytes
   392 000001D4 8A0D[56730000]          	mov	cl, [fbs_shift]
   393 000001DA D3E8                    	shr	eax, cl 
   394                                  	;mov	[loadsize], ax ; 16380 or 32760 or 65520
   395 000001DC A3[68730000]            	mov	[loadsize], eax ; 16384 or 32768 or 65536
   396                                  	;;;
   397                                  	;jmp	PlayNow ; 30/05/2024
   398                                  	; 07/12/2024
   399 000001E1 E95F020000              	jmp	Player_Template
   400                                  
   401                                  chk_sample_rate:
   402                                  	; set conversion parameters
   403                                  	; (for 8, 11.025, 16, 22.050, 24, 32 kHZ)
   404 000001E6 66A1[E8720000]          	mov	ax, [WAVE_SampleRate]
   405 000001EC 663D80BB                	cmp	ax, 48000
   406 000001F0 74CE                    	je	short playwav_48_khz
   407                                  chk_22khz:
   408 000001F2 663D2256                	cmp	ax, 22050
   409 000001F6 7545                    	jne	short chk_11khz
   410 000001F8 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   411 000001FF 7615                    	jna	short chk_22khz_1
   412 00000201 BB[72170000]            	mov	ebx, load_22khz_stereo_16_bit
   413 00000206 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   414 0000020D 751A                    	jne	short chk_22khz_2
   415 0000020F BB[E5160000]            	mov	ebx, load_22khz_mono_16_bit
   416 00000214 EB13                    	jmp	short chk_22khz_2
   417                                  chk_22khz_1:
   418 00000216 BB[5E160000]            	mov	ebx, load_22khz_stereo_8_bit
   419 0000021B 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   420 00000222 7505                    	jne	short chk_22khz_2
   421 00000224 BB[D5150000]            	mov	ebx, load_22khz_mono_8_bit
   422                                  chk_22khz_2:
   423 00000229 B85A1D0000              	mov	eax, 7514  ; (442*17)
   424 0000022E BA25000000              	mov	edx, 37
   425 00000233 B911000000              	mov	ecx, 17
   426 00000238 E9DB010000              	jmp	set_sizes
   427                                  chk_11khz:
   428 0000023D 663D112B                	cmp	ax, 11025
   429 00000241 7545                    	jne	short chk_44khz
   430 00000243 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   431 0000024A 7615                    	jna	short chk_11khz_1
   432 0000024C BB[8E190000]            	mov	ebx, load_11khz_stereo_16_bit
   433 00000251 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   434 00000258 751A                    	jne	short chk_11khz_2
   435 0000025A BB[15190000]            	mov	ebx, load_11khz_mono_16_bit
   436 0000025F EB13                    	jmp	short chk_11khz_2
   437                                  chk_11khz_1:
   438 00000261 BB[9B180000]            	mov	ebx, load_11khz_stereo_8_bit
   439 00000266 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   440 0000026D 7505                    	jne	short chk_11khz_2
   441 0000026F BB[23180000]            	mov	ebx, load_11khz_mono_8_bit
   442                                  chk_11khz_2:
   443 00000274 B8AD0E0000              	mov	eax, 3757  ; (221*17)
   444 00000279 BA4A000000              	mov	edx, 74
   445 0000027E B911000000              	mov	ecx, 17
   446 00000283 E990010000              	jmp	set_sizes
   447                                  chk_44khz:
   448 00000288 663D44AC                	cmp	ax, 44100
   449 0000028C 7545                    	jne	short chk_16khz
   450 0000028E 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   451 00000295 7615                    	jna	short chk_44khz_1
   452 00000297 BB[951B0000]            	mov	ebx, load_44khz_stereo_16_bit
   453 0000029C 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   454 000002A3 751A                    	jne	short chk_44khz_2
   455 000002A5 BB[1C1B0000]            	mov	ebx, load_44khz_mono_16_bit
   456 000002AA EB13                    	jmp	short chk_44khz_2
   457                                  chk_44khz_1:
   458 000002AC BB[9F1A0000]            	mov	ebx, load_44khz_stereo_8_bit
   459 000002B1 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   460 000002B8 7505                    	jne	short chk_44khz_2
   461 000002BA BB[231A0000]            	mov	ebx, load_44khz_mono_8_bit
   462                                  chk_44khz_2:
   463                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   464 000002BF B8D93A0000              	mov	eax, 15065 ; (655*23)
   465                                  	; 18/11/2023 ((file size + bss + stack) <= 64KB)
   466                                  	;mov	ax, 14076 ; (612*23)
   467                                  	; 17/11/2024
   468                                  	;mov	ax, 12650 ; (550*23)
   469 000002C4 BA19000000              	mov	edx, 25
   470 000002C9 B917000000              	mov	ecx, 23
   471 000002CE E945010000              	jmp	set_sizes
   472                                  chk_16khz:
   473 000002D3 663D803E                	cmp	ax, 16000
   474 000002D7 7545                    	jne	short chk_8khz
   475 000002D9 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   476 000002E0 7615                    	jna	short chk_16khz_1
   477 000002E2 BB[1A110000]            	mov	ebx, load_16khz_stereo_16_bit
   478 000002E7 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   479 000002EE 751A                    	jne	short chk_16khz_2
   480 000002F0 BB[99100000]            	mov	ebx, load_16khz_mono_16_bit
   481 000002F5 EB13                    	jmp	short chk_16khz_2
   482                                  chk_16khz_1:
   483 000002F7 BB[DF0F0000]            	mov	ebx, load_16khz_stereo_8_bit
   484 000002FC 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   485 00000303 7505                    	jne	short chk_16khz_2
   486 00000305 BB[600F0000]            	mov	ebx, load_16khz_mono_8_bit
   487                                  chk_16khz_2:
   488                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   489 0000030A B855150000              	mov	eax, 5461
   490                                  	; 17/11/2024
   491                                  	;mov	ax, 5460
   492 0000030F BA03000000              	mov	edx, 3
   493 00000314 B901000000              	mov	ecx, 1
   494 00000319 E9FA000000              	jmp	set_sizes
   495                                  chk_8khz:
   496 0000031E 663D401F                	cmp	ax, 8000
   497 00000322 7545                    	jne	short chk_24khz
   498 00000324 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   499 0000032B 7615                    	jna	short chk_8khz_1
   500 0000032D BB[150E0000]            	mov	ebx, load_8khz_stereo_16_bit
   501 00000332 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   502 00000339 751A                    	jne	short chk_8khz_2
   503 0000033B BB[450D0000]            	mov	ebx, load_8khz_mono_16_bit
   504 00000340 EB13                    	jmp	short chk_8khz_2
   505                                  chk_8khz_1:
   506 00000342 BB[150C0000]            	mov	ebx, load_8khz_stereo_8_bit
   507 00000347 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   508 0000034E 7505                    	jne	short chk_8khz_2
   509 00000350 BB[310B0000]            	mov	ebx, load_8khz_mono_8_bit
   510                                  chk_8khz_2:
   511 00000355 B8AA0A0000              	mov	eax, 2730
   512 0000035A BA06000000              	mov	edx, 6
   513 0000035F B901000000              	mov	ecx, 1
   514 00000364 E9AF000000              	jmp	set_sizes
   515                                  chk_24khz:
   516 00000369 663DC05D                	cmp	ax, 24000
   517 0000036D 7563                    	jne	short chk_32khz
   518 0000036F 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   519 00000376 7615                    	jna	short chk_24khz_1
   520                                  	; 17/01/2025 (BugFix)
   521                                  	; bx -> ebx
   522 00000378 BB[44130000]            	mov	ebx, load_24khz_stereo_16_bit
   523 0000037D 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   524 00000384 751A                    	jne	short chk_24khz_2
   525 00000386 BB[E1120000]            	mov	ebx, load_24khz_mono_16_bit
   526 0000038B EB13                    	jmp	short chk_24khz_2
   527                                  chk_24khz_1:
   528 0000038D BB[57120000]            	mov	ebx, load_24khz_stereo_8_bit
   529 00000392 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   530 00000399 7505                    	jne	short chk_24khz_2
   531 0000039B BB[F0110000]            	mov	ebx, load_24khz_mono_8_bit
   532                                  chk_24khz_2:
   533                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   534 000003A0 B800200000              	mov	eax, 8192
   535                                  	; 17/11/2024
   536                                  	;mov	ax, 8190
   537 000003A5 BA02000000              	mov	edx, 2
   538 000003AA B901000000              	mov	ecx, 1
   539 000003AF EB67                    	jmp	short set_sizes
   540                                  
   541                                  	; 07/12/2024
   542                                  vra_needed:
   543                                  	; 30/11/2024 (TRDOS 386, ax -> eax)
   544                                  	; 13/11/2023
   545 000003B1 58                      	pop	eax ; discard return address to the caller
   546                                  	; 30/05/2024
   547                                  vra_err:
   548                                  	; 21/12/2024
   549 000003B2 E801020000              	call	set_text_mode
   550                                  	; 30/11/2024
   551                                  	sys	_msg, msg_no_vra, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000003B7 BB[A7280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000003BC B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000003C1 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000003C6 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000003CB CD40                <1>  int 40h
   552 000003CD E902010000              	jmp	Exit
   553                                  
   554                                  chk_32khz:
   555 000003D2 663D007D                	cmp	ax, 32000
   556 000003D6 75D9                    	jne	short vra_needed
   557 000003D8 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8
   558 000003DF 7615                    	jna	short chk_32khz_1
   559 000003E1 BB[45150000]            	mov	ebx, load_32khz_stereo_16_bit
   560 000003E6 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   561 000003ED 751A                    	jne	short chk_32khz_2
   562 000003EF BB[DB140000]            	mov	ebx, load_32khz_mono_16_bit
   563 000003F4 EB13                    	jmp	short chk_32khz_2
   564                                  chk_32khz_1:
   565 000003F6 BB[3E140000]            	mov	ebx, load_32khz_stereo_8_bit
   566 000003FB 803D[E6720000]01        	cmp	byte [WAVE_NumChannels], 1
   567 00000402 7505                    	jne	short chk_32khz_2
   568 00000404 BB[CB130000]            	mov	ebx, load_32khz_mono_8_bit
   569                                  chk_32khz_2:
   570                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   571 00000409 B8AA2A0000              	mov	eax, 10922
   572                                  	; 17/11/2024
   573                                  	;mov	ax, 10920
   574 0000040E BA03000000              	mov	edx, 3
   575 00000413 B902000000              	mov	ecx, 2
   576                                  	;jmp	short set_sizes
   577                                  set_sizes:
   578                                  	; 30/11/2024 (TRDOS 386, 32bit DOS)
   579                                  	;;;
   580                                  	; 17/11/2024
   581 00000418 51                      	push	ecx
   582 00000419 B102                    	mov	cl, 2
   583 0000041B 2A0D[56730000]          	sub	cl, [fbs_shift]
   584                                  		; = 2 for 16 bit stereo
   585                                  		; = 1 for 16 bit mono or 8 bit stereo
   586                                  		; = 0 for 8 bit mono
   587 00000421 D3E0                    	shl	eax, cl
   588 00000423 59                      	pop	ecx	
   589 00000424 A3[68730000]            	mov	[loadsize], eax	; (one) read count in bytes
   590                                  	;;;
   591 00000429 F7E2                    	mul	edx
   592 0000042B 83F901                  	cmp	ecx, 1
   593 0000042E 7402                    	je	short s_2
   594                                  s_1:
   595 00000430 F7F1                    	div	ecx
   596                                  s_2:
   597                                  	;;;
   598                                  	; eax = byte count of (to be) converted samples 
   599                                  	
   600                                  	; 17/11/2024
   601                                  	;;;
   602 00000432 8A0D[56730000]          	mov	cl, [fbs_shift]
   603                                  
   604 00000438 D3E0                    	shl	eax, cl
   605                                  		; *1 for 16 bit stereo
   606                                  		; *2 for 16 bit mono or 8 bit stereo
   607                                  		; *4 for for 8 bit mono
   608                                  	;;;
   609                                  
   610                                  	; eax = 16 bit stereo byte count (target buffer size)
   611                                  	
   612                                  	; 07/12/2024
   613                                  	;shr	eax, 1	; buffer size is 16 bit sample count
   614 0000043A A3[6C730000]            	mov	[buffersize], eax ; buffer size in bytes
   615 0000043F 891D[64730000]          	mov	[loadfromwavfile], ebx
   616                                  
   617                                  ; -------------------------------------------------------------
   618                                  
   619                                  Player_Template:
   620                                  	; 21/12/2024
   621 00000445 E8FE000000              	call	clearscreen
   622 0000044A E815010000              	call	drawplayingscreen
   623                                  
   624                                  	; 14/11/2024
   625 0000044F E8D81E0000              	call	SetTotalTime
   626 00000454 E8A51F0000              	call	UpdateFileInfo
   627                                  
   628                                  ; -------------------------------------------------------------
   629                                  
   630                                  StartPlay:
   631                                  	; 21/12/2024 (VGA/LFB modifications)
   632                                  	; (Direct access/map to the LFB is already done here)
   633                                  	; ((this program is in VESA/VBE graphics mode here))
   634                                  PlayNow:
   635                                  	; 07/12/2024
   636                                  	sys	_audio, 0200h, [buffersize], audio_buffer
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000459 BB00020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000045E 8B0D[6C730000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000464 BA[00800000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000469 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000046E CD40                <1>  int 40h
   637 00000470 0F82A4000000            	jc	error_exit ; return to text mode and print err msg
   638                                  
   639                                  	; 01/06/2024
   640                                  	; Initialize Audio Device (bh = 3)
   641                                  	sys	_audio, 0301h, 0, audio_int_handler
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000476 BB01030000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000047B B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000480 BA[F4070000]        <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000485 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000048A CD40                <1>  int 40h
   642                                  	;jc	short error_exit
   643 0000048C 726C                    	jc	init_err ; return to text mode and print err msg
   644                                  
   645                                  	;;;
   646                                  	; 14/11/2024
   647 0000048E B003                    	mov	al, 3	; 0 = max, 31 = min
   648                                  	; 15/11/2024
   649 00000490 E888020000              	call	SetMasterVolume
   650                                  	; 07/12/2024
   651                                  	;call	SetPCMOutVolume
   652 00000495 E8D31F0000              	call	UpdateVolume
   653                                  	;;;
   654                                  	;
   655                                  	; 14/11/2024
   656 0000049A E85E200000              	call	UpdateProgressBar
   657                                  	;;;
   658                                  
   659                                   	; 30/05/2024
   660                                  	; playwav4.asm
   661                                  _2:	
   662 0000049F E8151E0000              	call	check4keyboardstop	; flush keyboard buffer
   663 000004A4 72F9                    	jc	short _2		; 07/11/2023
   664                                  
   665                                  ; play the .wav file. Most of the good stuff is in here.
   666                                  	
   667                                  	; 05/12/2024
   668 000004A6 E814010000              	call    PlayWav
   669                                  
   670                                  ; close the .wav file and exit.
   671                                  
   672                                  	; 07/12/2024
   673                                  	;;;
   674                                  	; Stop Playing
   675                                  	;sys	_audio, 0700h
   676                                  	; Cancel callback service (for user)
   677                                  	sys	_audio, 0900h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004AB BB00090000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004B0 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004B5 CD40                <1>  int 40h
   678                                  	; Deallocate Audio Buffer (for user)
   679                                  	sys	_audio, 0A00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004B7 BB000A0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004BC B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004C1 CD40                <1>  int 40h
   680                                  	; Disable Audio Device
   681                                  	sys	_audio, 0C00h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004C3 BB000C0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004C8 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000004CD CD40                <1>  int 40h
   682                                  	;;;
   683                                  
   684                                  terminate:
   685 000004CF E8E4000000              	call	set_text_mode
   686                                  Exit:
   687                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004D4 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 000004D9 CD40                <1>  int 40h
   688                                  halt:
   689 000004DB EBFE                    	jmp	short halt
   690                                  
   691                                  ; -------------------------------------------------------------
   692                                  
   693                                  	; 30/05/2024
   694                                  pmsg_usage:
   695                                  	; 21/12/2024
   696 000004DD E8D6000000              	call	set_text_mode
   697                                  	; 01/12/2024
   698                                  	sys	_msg, msg_usage, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004E2 BB[F3270000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000004E7 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000004EC BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000004F1 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000004F6 CD40                <1>  int 40h
   699 000004F8 EBDA                    	jmp	short Exit
   700                                  
   701                                  ; -------------------------------------------------------------
   702                                  
   703                                  	; 30/05/2024
   704                                  init_err:
   705                                  	; 21/12/2024
   706 000004FA E8B9000000              	call	set_text_mode
   707                                  	; 01/12/2024
   708                                  	sys	_msg, msg_init_err, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000004FF BB[76280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000504 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000509 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000050E B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000513 CD40                <1>  int 40h
   709 00000515 EBBD                    	jmp	short Exit
   710                                  
   711                                  ; -------------------------------------------------------------
   712                                  
   713                                  	; 02/12/2024
   714                                  Player_Quit@:
   715 00000517 58                      	pop	eax ; return addr (call PlayWav@)
   716                                  	
   717                                  	; 29/11/2024
   718                                  Player_Quit:
   719 00000518 EBB5                    	jmp	 short terminate
   720                                  
   721                                  
   722                                  ; -------------------------------------------------------------
   723                                  
   724                                  	; 07/12/2024
   725                                  error_exit:
   726                                  	; 21/12/2024
   727 0000051A E899000000              	call	set_text_mode
   728                                  trdos386_error:
   729                                  	sys	_msg, trdos386_err_msg, 255, 0Eh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000051F BB[56280000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000524 B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000529 BA0E000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000052E B823000000          <1>  mov eax, %1
    97                              <1> 
    98 00000533 CD40                <1>  int 40h
   730 00000535 EB9D                    	jmp	short Exit
   731                                  
   732                                  ; -------------------------------------------------------------
   733                                  
   734                                  	; 21/12/2024
   735                                  print_msg:
   736 00000537 B40E                    	mov	ah, 0Eh
   737 00000539 BB07000000              	mov	ebx, 7
   738                                  	;mov	bl, 7 ; char attribute & color
   739                                  p_next_chr:
   740 0000053E AC                      	lodsb
   741 0000053F 08C0                    	or	al, al
   742 00000541 7404                    	jz	short p_retn ; retn
   743 00000543 CD31                    	int	31h
   744 00000545 EBF7                    	jmp	short p_next_chr
   745                                  p_retn:
   746 00000547 C3                      	retn
   747                                  
   748                                  ; -------------------------------------------------------------
   749                                  
   750                                  	; 21/12/2024
   751                                  clearscreen:
   752                                  	; fast clear
   753                                  	; 640*480, 256 colors
   754 00000548 8B3D[B0720000]          	mov	edi, [LFB_ADDR]
   755 0000054E B9002C0100              	mov	ecx, (640*480*1)/4 ; 22/12/2024
   756 00000553 31C0                    	xor	eax, eax
   757 00000555 F3AB                    	rep	stosd
   758 00000557 C3                      	retn
   759                                  
   760                                  ; -------------------------------------------------------------
   761                                  
   762                                  	; 21/12/2024
   763                                  drawsplashscreen:
   764 00000558 BD[D4290000]            	mov	ebp, SplashScreen
   765                                  	;;mov	dword [nextrow], 00100000h ; 8*16
   766                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   767                                  	;mov	esi, 0 ; row 0, column 0
   768 0000055D BE00000200              	mov	esi, 00020000h ; row 2, column 0 ; top margin = 2
   769 00000562 EB0A                    	jmp	short p_d_x
   770                                  drawplayingscreen:
   771 00000564 BD[75340000]            	mov	ebp, PlayingScreen
   772                                  	;mov	dword [nextrow], 000E0000h ; 8*14
   773                                  	;mov	esi, 0 ; row 0, column 0
   774 00000569 BE00000700              	mov	esi, 00070000h ; row 7, column 0 ; top margin = 7
   775                                  p_d_x:
   776 0000056E C605[BD720000]50        	mov	byte [columns], 80
   777                                  p_d_x_n:
   778 00000575 31D2                    	xor	edx, edx
   779 00000577 8A5500                  	mov	dl, [ebp]
   780 0000057A 20D2                    	and	dl, dl
   781 0000057C 7439                    	jz	short p_d_x_ok
   782 0000057E C1E204                  	shl	edx, 4 ; * 16 (for 8x16 font)
   783                                  
   784 00000581 BF[704D0000]            	mov	edi, fontbuff2 ; start of user font data
   785 00000586 01D7                    	add	edi, edx
   786                                  	
   787                                  	;; NOTE: Following system call writes fonts at
   788                                  	;; Std VGA video memory 0A0000h, BL bit 7 selects
   789                                  	;; screen width as 640 pixels (instead of 320 pixels)
   790                                  	;; so 8Fh is sub function 0Fh (write char)
   791                                  	;; with 640 pixels screen witdh. 
   792                                  	;; (Even if VESA VBE mode -LFB- is in use, QEMU and
   793                                  	;; a real computer with NVIDIA GEFORCE FX 550 uses
   794                                  	;; A0000h, so.. even if fonts are written at A0000h-B0000h
   795                                  	;; region, the text is appeared on screen
   796                                  	;; while LFB is at C0000000h or E0000000h.)
   797                                  
   798                                  	;sys	_video, 018Fh, [tcolor], 8001h
   799                                  			;; use STD VGA video memory
   800                                  			;; (0A0000h)
   801                                  	sys	_video, 020Fh, [tcolor], 8001h ; 8x16 user font
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000588 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000058D 8B0D[BC720000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000593 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000598 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 0000059D CD40                <1>  int 40h
   802                                  		 ; use LFB for current VBE mode
   803                                  		 ; for writing fonts on screen
   804 0000059F 45                      	inc	ebp
   805 000005A0 6683C608                	add	si, 8 ; next char pos
   806 000005A4 FE0D[BD720000]          	dec	byte [columns]
   807 000005AA 75C9                    	jnz	short p_d_x_n	; next column
   808 000005AC 6631F6                  	xor	si, si
   809                                  	;;add	esi, 00100000h	; next row ; 8*16
   810                                  	;add	esi, [nextrow]
   811 000005AF 81C600000E00            	add	esi, 000E0000h	; next row ; 8*14
   812 000005B5 EBB7                    	jmp	short p_d_x
   813                                  p_d_x_ok:
   814 000005B7 C3                      	retn
   815                                  
   816                                  ; -------------------------------------------------------------
   817                                  
   818                                  	; 21/12/2024
   819                                  set_text_mode:
   820 000005B8 30E4                    	xor    ah, ah
   821 000005BA B003                    	mov    al, 3                        
   822                                   	;int   10h ; al = 03h text mode, int 10 video
   823 000005BC CD31                    	int    31h ; TRDOS 386 - Video interrupt
   824 000005BE C3                      	retn
   825                                  
   826                                  ; -------------------------------------------------------------
   827                                  
   828                                  	; 07/12/2024 (playwav9.s)
   829                                  	; 26/11/2023 (playwav8.s)
   830                                  PlayWav:
   831                                  	; 19/11/2024
   832 000005BF C605[C3720000]01        	mov	byte [wleds], 1
   833                                  
   834                                  	;;;
   835                                  	; 09/12/2024
   836 000005C6 B834290000              	mov	eax, 10548 ; (48000*10/182)*4
   837 000005CB 803D[CE720000]00        	cmp	byte [VRA], 0
   838 000005D2 7614                    	jna	short _3 ; 48kHZ (interpolation)
   839                                  	;;;
   840                                  	; 01/12/2024 (32bit)
   841                                  	;movzx	eax, word [WAVE_SampleRate]
   842                                  	; 09/12/2024
   843 000005D4 66A1[E8720000]          	mov	ax, [WAVE_SampleRate]
   844 000005DA B90A000000              	mov	ecx, 10
   845 000005DF F7E1                    	mul	ecx
   846 000005E1 B1B6                    	mov	cl, 182
   847 000005E3 F7F1                    	div	ecx
   848                                  	; ax = samples per 1/18.2 second
   849                                  	;mov	cl, byte [WAVE_BlockAlign]
   850                                  	; 09/12/2024 
   851                                  	;mov	cl, 4 ; 16 bit, stereo
   852                                  	;mul	ecx
   853 000005E5 C1E002                  	shl	eax, 2 ; * 4
   854                                  _3:
   855 000005E8 A3[C4720000]            	mov	[wleds_dif], eax ; buffer read differential (distance)
   856                                  				; for wave volume leds update
   857                                  				; (byte stream per 1/18.2 second)
   858                                  RePlayWav:
   859                                  	; 07/12/2024
   860 000005ED BF[00800000]            	mov	edi, audio_buffer
   861 000005F2 FF15[64730000]          	call	dword [loadfromwavfile]
   862 000005F8 0F821CFFFFFF            	jc	error_exit
   863                                  
   864 000005FE C605[CD720000]01        	mov	byte [half_buffer], 1 ; (DMA) Buffer 1
   865                                  
   866 00000605 A1[78730000]            	mov	eax, [count]
   867 0000060A 0105[7C730000]          	add	[LoadedDataBytes], eax
   868                                  
   869 00000610 F605[FE720000]01        	test    byte [flags], ENDOFFILE  ; end of file
   870 00000617 752C                    	jnz	short _4 ; yes
   871                                  			 ; bypass filling dma half buffer 2
   872                                  
   873                                  	; bh = 16 : update (current, first) dma half buffer
   874                                  	; bl = 0  : then switch to the next (second) half buffer
   875                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000619 BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000061E B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000623 CD40                <1>  int 40h
   876                                  
   877                                  	; 18/12/2024
   878 00000625 C705[78730000]0000-     	mov	dword [count], 0
   878 0000062D 0000               
   879                                  
   880                                  	; 07/12/2024
   881 0000062F BF[00800000]            	mov	edi, audio_buffer
   882 00000634 FF15[64730000]          	call	dword [loadfromwavfile]
   883                                  	;jc	error_exit
   884                                  	
   885 0000063A A1[78730000]            	mov	eax, [count]
   886 0000063F 0105[7C730000]          	add	[LoadedDataBytes], eax
   887                                  _4:
   888                                  	; 07/12/2024
   889 00000645 668B0D[E8720000]         	mov	cx, [WAVE_SampleRate]
   890 0000064C B303                    	mov	bl, 3	; 16 bit, stereo
   891 0000064E B704                    	mov	bh, 4	; start to play
   892                                  	sys	_audio
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000650 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000655 CD40                <1>  int 40h
   893                                  
   894                                  ; -------------------------------------------
   895                                  
   896                                  	; 22/12/2024
   897                                   	; prepare all leds as turned off
   898 00000657 E89E1F0000              	call	reset_wave_leds
   899                                  
   900                                  ; -------------------------------------------
   901                                  
   902                                  	; 07/12/2024 (playwav9.s)
   903                                  	; 01/12/2024 (32bit)
   904                                  	; 29/11/2024
   905                                  tuneLoop:
   906                                  	; 30/05/2024
   907                                  	; 18/11/2023 (ich_wav4.asm)
   908                                  	; 08/11/2023
   909                                  	; 06/11/2023
   910                                  tLWait:
   911                                  	; 18/11/2024
   912 0000065C 803D[C0720000]00        	cmp	byte [stopped], 0
   913                                  	; 24/11/2024
   914 00000663 761E                    	jna	short tL1
   915                                  tLWait@:	; 21/11/2024
   916 00000665 E8331B0000              	call	checkUpdateEvents
   917 0000066A 726E                    	jc	_exitt_
   918 0000066C 803D[C1720000]30        	cmp	byte [tLO], '0'
   919 00000673 74E7                    	je	short tLWait
   920 00000675 E86A000000              	call	tLZ
   921 0000067A C605[C1720000]30        	mov	byte [tLO], '0'
   922 00000681 EBD9                    	jmp	short tLWait
   923                                  tL1:
   924                                  	; 27/11/2024
   925                                  	; Check AC'97 interrupt status
   926 00000683 803D[57730000]00        	cmp	byte [SRB], 0
   927 0000068A 7709                    	ja	short tL3
   928                                  tL2:
   929 0000068C E80C1B0000              	call	checkUpdateEvents
   930 00000691 7247                    	jc	_exitt_
   931 00000693 EBC7                    	jmp	short tLWait
   932                                  tL3:
   933 00000695 8035[CD720000]01        	xor	byte [half_buffer], 1
   934                                  	; 07/12/2024
   935 0000069C C605[57730000]00        	mov	byte [SRB], 0
   936                                  
   937                                  	; 07/12/2024
   938 000006A3 BF[00800000]            	mov	edi, audio_buffer
   939                                  	;call	loadFromFile
   940                                  	; 18/11/2023
   941                                  	;call	word [loadfromwavfile]
   942                                  	; 01/12/2024
   943 000006A8 FF15[64730000]          	call	dword [loadfromwavfile]
   944 000006AE 722A                    	jc	short _exitt_	; end of file
   945                                  
   946                                  	; 07/12/2024
   947                                  	;;;;
   948                                  	; bh = 16 : update (current, first) dma half buffer
   949                                  	; bl = 0  : then switch to the other half buffer
   950                                  	sys	_audio, 1000h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000006B0 BB00100000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000006B5 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 000006BA CD40                <1>  int 40h
   951                                  	;;;;
   952                                  
   953                                  	; 26/11/2024
   954 000006BC A0[CD720000]            	mov	al, [half_buffer]
   955 000006C1 0431                    	add	al, '1'
   956                                  	; 19/11/2024
   957 000006C3 A2[C1720000]            	mov	[tLO], al
   958 000006C8 E819000000              	call	tL0
   959                                  
   960                                  	; 24/11/2024
   961                                  	; 14/11/2024
   962                                  	;mov	ax, [count]
   963                                  	;add	[LoadedDataBytes], ax
   964                                  	;adc	word [LoadedDataBytes+2], 0
   965                                  	; 01/12/2024
   966 000006CD A1[78730000]            	mov	eax, [count]
   967 000006D2 0105[7C730000]          	add	[LoadedDataBytes], eax
   968                                  
   969                                  	; 07/12/2024 (playwav9.s)
   970                                  	; 27/11/2024 (playwav9.asm)
   971 000006D8 EBB2                    	jmp	short tL2
   972                                  
   973                                  _exitt_:
   974                                  	; 07/12/2024
   975                                  	; Stop Playing
   976                                  	;mov	byte [stopped], 2
   977                                  	;sys	_audio, 0700h
   978 000006DA E8821A0000              	call	ac97_stop
   979                                  
   980                                  	;;;
   981                                  	; 14/11/2024
   982 000006DF E8191E0000              	call	UpdateProgressBar
   983                                  	;;;
   984                                  
   985                                  	; 18/11/2024
   986                                  tLZ:
   987                                  	; 30/05/2024
   988 000006E4 B030                    	mov	al, '0'
   989                                  
   990                                  	;add	al, '0'
   991                                  	;call	tL0
   992                                  	;
   993                                  	;retn
   994                                  	; 06/11/2023
   995                                  	;jmp	short tL0
   996                                  	;retn
   997                                  
   998                                  	; 06/11/2023
   999                                  tL0:
  1000                                  	; 29/05/2024 (TRDOS 386)
  1001                                  	; 08/11/2023
  1002                                  	; 05/11/2023
  1003                                  	; 17/02/2017 - Buffer switch test (temporary)
  1004                                  	; 06/11/2023
  1005                                  	; al = buffer indicator ('1', '2' or '0' -stop- )
  1006                                  
  1007                                  	; 22/12/2024 (graphics mode modification)
  1008                                  	; (640*480, 256 colors)
  1009                                  	;;;
  1010                                  	;mov	ebp, 16
  1011 000006E6 BD0E000000              	mov	ebp, 14
  1012 000006EB 8B3D[B0720000]          	mov	edi, [LFB_ADDR]
  1013 000006F1 0FB6F0                  	movzx	esi, al
  1014 000006F4 C1E604                  	shl	esi, 4 ; * 16
  1015 000006F7 81C6[704D0000]          	add	esi, fontbuff2
  1016                                  tL0_1:
  1017 000006FD BA08000000              	mov	edx, 8 ; 8 pixels (8*16 pixel font)
  1018 00000702 8A26                    	mov	ah, [esi]
  1019                                  tL0_2:
  1020 00000704 B00C                    	mov	al, 0Ch ; red
  1021 00000706 D0E4                    	shl	ah, 1
  1022 00000708 7302                    	jnc	short tL0_3
  1023 0000070A B00E                    	mov	al, 0Eh ; yellow
  1024                                  tL0_3:
  1025 0000070C AA                      	stosb
  1026 0000070D 4A                      	dec	edx
  1027 0000070E 75F4                    	jnz	short tL0_2
  1028 00000710 4D                      	dec	ebp
  1029 00000711 7409                    	jz	short tL0_4
  1030 00000713 81C778020000            	add	edi, 640-8 ; next line
  1031 00000719 46                      	inc	esi
  1032 0000071A EBE1                    	jmp	short tL0_1
  1033                                  tL0_4:
  1034                                  	;;;
  1035 0000071C C3                      	retn
  1036                                  
  1037                                  ; -------------------------------------------
  1038                                  
  1039                                  	; 07/12/2024
  1040                                  SetMasterVolume:
  1041                                  	;cmp	al, 31
  1042                                  	;ja	short setvolume_ok
  1043 0000071D A2[10230000]            	mov	[volume], al  ; max = 0, min = 31
  1044                                  
  1045 00000722 B41F                    	mov	ah, 31
  1046 00000724 28C4                    	sub	ah, al
  1047 00000726 88E0                    	mov	al, ah
  1048                                  
  1049                                  	; Set Master Volume Level (BL=0 or 80h)
  1050                                  	; 	for next playing (BL>=80h)
  1051                                  	;sys	_audio, 0B80h, eax
  1052                                  	sys	_audio, 0B00h, eax
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000728 BB000B0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000072D 89C1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000072F B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000734 CD40                <1>  int 40h
  1053                                  	
  1054                                  setvolume_ok:
  1055                                  ac97_not_detected:
  1056 00000736 C3                      	retn
  1057                                  
  1058                                  ; -------------------------------------------
  1059                                  
  1060                                  	; 07/12/2024 (playwav9.s)
  1061                                  DetectAC97:
  1062                                  DetectICH:
  1063                                  	; 25/11/2023 (playwav8.s)
  1064                                  	; Detect (BH=1) AC'97 (BL=2) Audio Device
  1065                                          sys	_audio, 0102h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000737 BB02010000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000073C B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00000741 CD40                <1>  int 40h
  1066                                  	;jnc	short d_ac97_@
  1067                                  	;retn
  1068 00000743 72F1                    	jc	short ac97_not_detected
  1069                                  d_ac97_@:
  1070                                  	; 07/12/2024 (playwav9.s)
  1071                                  	; 06/06/2017
  1072                                  	sys	_audio, 0E00h ; get audio controller info
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000745 BB000E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000074A B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000074F CD40                <1>  int 40h
  1073 00000751 0F82C3FDFFFF            	jc	error_exit ; 25/11/2023
  1074                                  
  1075                                  	;cmp	ah, 2 ; ICH ? (Intel AC'97 Audio Controller)
  1076                                  	;jne	_dev_not_ready	
  1077                                  
  1078                                  	; EAX = IRQ Number in AL
  1079                                  	;	Audio Device Number in AH 
  1080                                  	; EBX = DEV/VENDOR ID
  1081                                  	;       (DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV)
  1082                                  	; ECX = BUS/DEV/FN 
  1083                                  	;       (00000000BBBBBBBBDDDDDFFF00000000)
  1084                                  	; EDX = NABMBAR/NAMBAR (for AC97)
  1085                                  	;      (Low word, DX = NAMBAR address)
  1086                                  	; EDX = Base IO Addr (DX) for SB16 & VT8233
  1087                                  
  1088 00000757 891D[5C730000]          	mov	[dev_vendor], ebx
  1089 0000075D 890D[58730000]          	mov	[bus_dev_fn], ecx
  1090                                  
  1091 00000763 668915[60730000]                mov     [NAMBAR], dx			; save audio mixer base addr
  1092                                  	;shr	edx, 16
  1093                                          ;mov    [NABMBAR], dx			; save bus master base addr
  1094 0000076A 8915[60730000]          	mov	[NAMBAR], edx
  1095                                  
  1096 00000770 A2[FF720000]            	mov	[ac97_int_ln_reg], al
  1097                                  
  1098                                  	; 07/12/2024
  1099                                  	; 01/06/2024
  1100                                  	; 25/11/2023
  1101                                  	; Get AC'97 Codec info
  1102                                  	; (Function 14, sub function 1)
  1103                                  	sys	_audio, 0E01h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000775 BB010E0000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000077A B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000077F CD40                <1>  int 40h
  1104                                  	; Save Variable Rate Audio support bit
  1105 00000781 2401                    	and	al, 1
  1106 00000783 A2[CE720000]            	mov	[VRA], al
  1107                                  
  1108                                  	;clc
  1109                                  
  1110 00000788 C3                      	retn
  1111                                  
  1112                                  ; ----------------------------------
  1113                                  	
  1114                                  	; 01/12/2024
  1115                                  	; 14/11/2024
  1116                                  	; INPUT: ds:dx = file name address
  1117                                  	; OUTPUT: [filehandle] = ; -1 = not open
  1118                                  openFile:
  1119                                  	;mov	ax, 3D00h	; open File for read
  1120                                  	;int	21h
  1121                                  	;jnc	short _of1
  1122                                  	; 01/12/2024 (TRDOS 386)
  1123                                  	;sys	_open, edx, 0
  1124                                  	; 07/12/2024
  1125                                  	sys	_open, wav_file_name, 0
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000789 BB[04730000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000078E B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000793 B805000000          <1>  mov eax, %1
    97                              <1> 
    98 00000798 CD40                <1>  int 40h
  1126 0000079A 7305                    	jnc	short _of1
  1127                                  
  1128 0000079C B8FFFFFFFF              	mov	eax, -1
  1129                                  	; cf = 1 -> not found or access error
  1130                                  _of1:
  1131 000007A1 A3[00730000]            	mov	[filehandle], eax
  1132 000007A6 C3                      	retn
  1133                                  
  1134                                  ; ----------------------------------
  1135                                  
  1136                                  ; close the currently open file
  1137                                  
  1138                                  	; 01/12/2024
  1139                                  	; 14/11/2024
  1140                                  	; INPUT: [filehandle] ; -1 = not open
  1141                                  	; OUTPUT: none
  1142                                  closeFile:
  1143 000007A7 833D[00730000]FF        	cmp	dword [filehandle], -1
  1144 000007AE 740D                    	jz	short _cf1
  1145                                  	;mov	bx, [filehandle]  
  1146                                  	;mov	ax, 3E00h
  1147                                          ;int	21h              ; close file
  1148                                  	; 01/12/2024
  1149                                  	sys	_close, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007B0 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007B6 B806000000          <1>  mov eax, %1
    97                              <1> 
    98 000007BB CD40                <1>  int 40h
  1150                                  	;mov 	dword [filehandle], -1
  1151                                  _cf1:
  1152 000007BD C3                      	retn
  1153                                  
  1154                                  ; ----------------------------------
  1155                                  
  1156                                  	; 01/12/2024
  1157                                  	; 14/11/2024 - Erdogan Tan
  1158                                  getWAVParameters:
  1159                                  ; reads WAV file header(s) (44 bytes) from the .wav file.
  1160                                  ; entry: none - assumes file is already open
  1161                                  ; exit: ax = sample rate (11025, 22050, 44100, 48000)
  1162                                  ;	cx = number of channels (mono=1, stereo=2)
  1163                                  ;	dx = bits per sample (8, 16)
  1164                                  ;	bx = number of bytes per sample (1 to 4)
  1165                                  
  1166                                          ;mov	dx, WAVFILEHEADERbuff
  1167                                  	;mov	bx, [filehandle]
  1168                                          ;mov	cx, 44			; 44 bytes
  1169                                  	;mov	ah, 3Fh
  1170                                          ;int	21h
  1171                                  	;jc	short gwavp_retn
  1172                                  	; 01/12/2024 (TRDOS 386)
  1173                                  	sys	_read, [filehandle], WAVFILEHEADERbuff, 44
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000007BE 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000007C4 B9[D0720000]        <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000007C9 BA2C000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007CE B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000007D3 CD40                <1>  int 40h
  1174 000007D5 721C                    	jc	short gwavp_retn
  1175                                  
  1176 000007D7 83F82C                  	cmp	eax, 44
  1177 000007DA 7217                    	jb	short gwavp_retn
  1178                                  
  1179 000007DC 813D[D8720000]5741-     	cmp	dword [RIFF_Format], 'WAVE'
  1179 000007E4 5645               
  1180 000007E6 750A                    	jne	short gwavp_stc_retn
  1181                                  
  1182 000007E8 66833D[E4720000]01      	cmp	word [WAVE_AudioFormat], 1 ; Offset 20, must be 1 (= PCM)
  1183                                  	;jne	short gwavp_stc_retn
  1184 000007F0 7401                    	je	short gwavp_retn ; 15/11/2024
  1185                                  
  1186                                  	; 15/11/2024
  1187                                  	;mov	cx, [WAVE_NumChannels]	; return num of channels in CX
  1188                                          ;mov    ax, [WAVE_SampleRate]	; return sample rate in AX
  1189                                  	;mov	dx, [WAVE_BitsPerSample] 
  1190                                  					; return bits per sample value in DX
  1191                                  	;mov	bx, [WAVE_BlockAlign]	; return bytes per sample in BX
  1192                                  ;gwavp_retn:
  1193                                          ;retn
  1194                                  
  1195                                  gwavp_stc_retn:
  1196 000007F2 F9                      	stc
  1197                                  gwavp_retn:
  1198 000007F3 C3                      	retn
  1199                                  
  1200                                  ; --------------------------------------------------------
  1201                                  ; 07/12/2024
  1202                                  ; --------------------------------------------------------
  1203                                  ; ref: playwav8.s (04/06/2024)
  1204                                  
  1205                                  audio_int_handler:
  1206                                  	; 18/08/2020 (14/10/2020, 'wavplay2.s')
  1207                                  
  1208                                  	; 07/12/2024
  1209                                  	;mov	al, [stopped]
  1210                                  	;cmp	al, 2
  1211                                  	;je	short _callback_retn
  1212                                  
  1213                                  	; 18/08/2020
  1214                                  	;mov	byte [SRB], 1
  1215                                  	; 07/12/2024
  1216 000007F4 FE05[57730000]          	inc	byte [SRB]
  1217                                  
  1218                                  ;_callback_retn:
  1219                                  	sys	_rele ; return from callback service 
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000007FA B827000000          <1>  mov eax, %1
    97                              <1> 
    98 000007FF CD40                <1>  int 40h
  1220                                  	; we must not come here !
  1221                                  	sys	_exit
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88                              <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000801 B801000000          <1>  mov eax, %1
    97                              <1> 
    98 00000806 CD40                <1>  int 40h
  1222                                  
  1223                                  ; --------------------------------------------------------
  1224                                  ; 07/12/2024
  1225                                  ; --------------------------------------------------------
  1226                                  
  1227                                  ; /////
  1228                                  	; 14/12/2024
  1229                                  	; 07/12/2024
  1230                                  	; 01/12/2024
  1231                                  	; 30/05/2024 (ich_wav4.asm, 19/05/2024)
  1232                                  loadFromFile:
  1233                                  	; 07/11/2023
  1234                                  
  1235 00000808 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1236                                  					; last of the file?
  1237 0000080F 7402                    	jz	short lff_0		; no
  1238 00000811 F9                      	stc
  1239 00000812 C3                      	retn
  1240                                  
  1241                                  lff_0:
  1242                                  	; 07/12/2024
  1243                                  	; 26/11/2023 (playwav8.s)
  1244                                  	;mov	edi, audio_buffer
  1245                                  
  1246                                  	; 01/12/2024 (TRDOS 386)
  1247                                  	; edi = audio buffer address
  1248                                  
  1249                                  	; 14/12/2024
  1250                                  	; 01/12/2024
  1251                                  	; 17/11/2024
  1252                                  	;mov	ebx, [filehandle]
  1253                                  	; 02/12/2024
  1254                                  	;mov	edx, [loadsize] 
  1255                                  
  1256                                  	; 17/11/2024
  1257 00000813 803D[56730000]00        	cmp	byte [fbs_shift], 0
  1258 0000081A 7677                    	jna	short lff_1 ; stereo, 16 bit
  1259                                  
  1260                                  lff_2:
  1261                                  	; 01/12/2024
  1262 0000081C BE[00800100]            	mov	esi, temp_buffer 
  1263                                  	; 14/12/2024
  1264                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000821 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000827 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000829 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000082F B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000834 CD40                <1>  int 40h
  1265 00000836 0F8289000000            	jc	lff_4 ; error !
  1266                                  
  1267                                  	; 01/12/2024
  1268                                  	; 14/11/2024
  1269 0000083C A3[78730000]            	mov	[count], eax
  1270                                  
  1271                                  	; 01/12/2024
  1272 00000841 21C0                    	and	eax, eax
  1273                                  	;jz	short lff_3
  1274                                  	; 14/12/2024
  1275 00000843 0F8485000000            	jz	lff_10
  1276                                  
  1277 00000849 8A1D[56730000]          	mov	bl, [fbs_shift]
  1278                                  
  1279                                  	; 14/12/2024
  1280 0000084F 89FA                    	mov	edx, edi ; audio buffer start address
  1281                                  
  1282                                  	; 01/12/2024
  1283 00000851 89C1                    	mov	ecx, eax
  1284 00000853 803D[F2720000]08        	cmp	byte [WAVE_BitsPerSample], 8 ; bits per sample (8 or 16)
  1285 0000085A 751E                    	jne	short lff_7 ; 16 bit samples
  1286                                  	; 8 bit samples
  1287 0000085C FECB                    	dec	bl  ; shift count, 1 = stereo, 2 = mono
  1288 0000085E 740E                    	jz	short lff_6 ; 8 bit, stereo
  1289                                  	; 01/12/2024 (32bit registers)
  1290                                  lff_5:
  1291                                  	; mono & 8 bit
  1292 00000860 AC                      	lodsb
  1293 00000861 2C80                    	sub	al, 80h ; 08/11/2023
  1294 00000863 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1295 00000866 66AB                    	stosw	; left channel
  1296 00000868 66AB                    	stosw	; right channel
  1297 0000086A E2F4                    	loop	lff_5
  1298 0000086C EB16                    	jmp	short lff_9
  1299                                  lff_6:
  1300                                  	; stereo & 8 bit
  1301 0000086E AC                      	lodsb
  1302 0000086F 2C80                    	sub	al, 80h ; 08/11/2023
  1303 00000871 C1E008                  	shl	eax, 8 ; convert 8 bit sample to 16 bit sample
  1304 00000874 66AB                    	stosw
  1305 00000876 E2F6                    	loop	lff_6
  1306 00000878 EB0A                    	jmp	short lff_9
  1307                                  lff_7:
  1308 0000087A D1E9                    	shr	ecx, 1 ; word count
  1309                                  lff_8:
  1310 0000087C 66AD                    	lodsw
  1311 0000087E 66AB                    	stosw	; left channel
  1312 00000880 66AB                    	stosw	; right channel
  1313 00000882 E2F8                    	loop	lff_8
  1314                                  lff_9:
  1315                                  	; 14/12/2024
  1316 00000884 89F8                    	mov	eax, edi
  1317 00000886 8B0D[6C730000]          	mov	ecx, [buffersize] 
  1318 0000088C 01D1                    	add	ecx, edx ; + buffer start address
  1319 0000088E 39C8                    	cmp	eax, ecx	
  1320 00000890 7225                    	jb	short lff_3
  1321 00000892 C3                      	retn
  1322                                  	
  1323                                  lff_1:  
  1324                                  	; 07/12/2024
  1325                                  	; 01/12/2024
  1326                                  	;sys 	_read, [filehandle], esi, [loadsize] ; edx
  1327                                  	; 14/12/2024
  1328                                  	sys 	_read, [filehandle], edi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000893 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000899 89F9                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000089B 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008A1 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000008A6 CD40                <1>  int 40h
  1329                                  	; 07/11/2023
  1330 000008A8 721B                    	jc	short lff_4 ; error !
  1331                                  
  1332                                  	; 01/12/2024
  1333                                  	; 14/11/2024
  1334 000008AA A3[78730000]            	mov	[count], eax
  1335                                  
  1336                                  	; 02/12/2024
  1337 000008AF 39D0                    	cmp	eax, edx ; cmp eax, [loadsize]	
  1338 000008B1 7411                    	je	short endLFF
  1339                                  	; edi = buffer (start) address
  1340 000008B3 01C7                    	add	edi, eax
  1341 000008B5 89D1                    	mov	ecx, edx
  1342                                  lff_3:
  1343                                  	;call	padfill			; blank pad the remainder
  1344                                  	; 21/12/2024
  1345                                  padfill:
  1346                                  	; 14/12/2024
  1347                                  	; 01/12/2024 (TRDOS 386, 32bit registers)
  1348                                  	; 17/11/2024
  1349                                  	;   di = offset (to be filled with ZEROs)
  1350                                  	;   bp = buffer segment
  1351                                  	;   ax = di = number of bytes loaded
  1352                                  	;   cx = buffer size (> loaded bytes)	
  1353                                  	; 07/11/2023
  1354                                  	; 06/11/2023
  1355                                  	; 17/02/2017
  1356                                  	; 01/12/2024
  1357 000008B7 29C1                    	sub	ecx, eax
  1358                                  	; 01/12/2024
  1359                                  	; 25/11/2024
  1360 000008B9 31C0                    	xor	eax, eax
  1361                                  	; 14/12/2024
  1362 000008BB F3AA                    	rep	stosb
  1363                                  	; 21/12/2024
  1364                                  	;retn
  1365                                  	; ----------
  1366                                          ;clc				; don't exit with CY yet.
  1367 000008BD 800D[FE720000]01                or	byte [flags], ENDOFFILE	; end of file flag
  1368                                  endLFF:
  1369 000008C4 C3                              retn
  1370                                  lff_4:
  1371                                  	; 08/11/2023
  1372 000008C5 B021                    	mov	al, '!'  ; error
  1373 000008C7 E81AFEFFFF              	call	tL0
  1374                                  
  1375                                  	; 01/12/2024
  1376 000008CC 31C0                    	xor	eax, eax
  1377                                  lff_10:
  1378                                  	; 14/12/2024
  1379 000008CE 8B0D[6C730000]          	mov	ecx, [buffersize]
  1380 000008D4 EBE1                    	jmp	short lff_3
  1381                                  
  1382                                  ; /////
  1383                                  
  1384                                  ; --------------------------------------------------------
  1385                                  ; --------------------------------------------------------
  1386                                  	
  1387                                  write_audio_dev_info:
  1388                                  	; 30/05/2024
  1389                                       	;sys_msg msgAudioCardInfo, 0Fh
  1390                                  	; 01/12/2024
  1391                                  	sys 	_msg, msgAudioCardInfo, 255, 0Fh
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000008D6 BB[CA270000]        <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000008DB B9FF000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000008E0 BA0F000000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000008E5 B823000000          <1>  mov eax, %1
    97                              <1> 
    98 000008EA CD40                <1>  int 40h
  1392 000008EC C3                      	retn
  1393                                  
  1394                                  ; --------------------------------------------------------
  1395                                  
  1396                                  write_ac97_pci_dev_info:
  1397                                  	; 19/11/2024
  1398                                  	; 30/05/2024
  1399                                  	; 06/06/2017
  1400                                  	; 03/06/2017
  1401                                  	; BUS/DEV/FN
  1402                                  	;	00000000BBBBBBBBDDDDDFFF00000000
  1403                                  	; DEV/VENDOR
  1404                                  	;	DDDDDDDDDDDDDDDDVVVVVVVVVVVVVVVV
  1405                                  
  1406 000008ED A1[5C730000]            	mov	eax, [dev_vendor]
  1407 000008F2 31DB                    	xor	ebx, ebx
  1408 000008F4 88C3                    	mov	bl, al
  1409 000008F6 88DA                    	mov	dl, bl
  1410 000008F8 80E30F                  	and	bl, 0Fh
  1411 000008FB 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1412 00000901 A2[27290000]            	mov	[msgVendorId+3], al
  1413 00000906 88D3                    	mov	bl, dl
  1414 00000908 C0EB04                  	shr	bl, 4
  1415 0000090B 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1416 00000911 A2[26290000]            	mov	[msgVendorId+2], al
  1417 00000916 88E3                    	mov	bl, ah
  1418 00000918 88DA                    	mov	dl, bl
  1419 0000091A 80E30F                  	and	bl, 0Fh
  1420 0000091D 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1421 00000923 A2[25290000]            	mov	[msgVendorId+1], al
  1422 00000928 88D3                    	mov	bl, dl
  1423 0000092A C0EB04                  	shr	bl, 4
  1424 0000092D 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1425 00000933 A2[24290000]            	mov	[msgVendorId], al
  1426 00000938 C1E810                  	shr	eax, 16
  1427 0000093B 88C3                    	mov	bl, al
  1428 0000093D 88DA                    	mov	dl, bl
  1429 0000093F 80E30F                  	and	bl, 0Fh
  1430 00000942 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1431 00000948 A2[38290000]            	mov	[msgDevId+3], al
  1432 0000094D 88D3                    	mov	bl, dl
  1433 0000094F C0EB04                  	shr	bl, 4
  1434 00000952 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1435 00000958 A2[37290000]            	mov	[msgDevId+2], al
  1436 0000095D 88E3                    	mov	bl, ah
  1437 0000095F 88DA                    	mov	dl, bl
  1438 00000961 80E30F                  	and	bl, 0Fh
  1439 00000964 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1440 0000096A A2[36290000]            	mov	[msgDevId+1], al
  1441 0000096F 88D3                    	mov	bl, dl
  1442 00000971 C0EB04                  	shr	bl, 4
  1443 00000974 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1444 0000097A A2[35290000]            	mov	[msgDevId], al
  1445                                  
  1446 0000097F A1[58730000]            	mov	eax, [bus_dev_fn]
  1447 00000984 C1E808                  	shr	eax, 8
  1448 00000987 88C3                    	mov	bl, al
  1449 00000989 88DA                    	mov	dl, bl
  1450 0000098B 80E307                  	and	bl, 7 ; bit 0,1,2
  1451 0000098E 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1452 00000994 A2[5D290000]            	mov	[msgFncNo+1], al
  1453 00000999 88D3                    	mov	bl, dl
  1454 0000099B C0EB03                  	shr	bl, 3
  1455 0000099E 88DA                    	mov	dl, bl
  1456 000009A0 80E30F                  	and	bl, 0Fh
  1457 000009A3 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1458 000009A9 A2[4F290000]            	mov	[msgDevNo+1], al
  1459 000009AE 88D3                    	mov	bl, dl
  1460 000009B0 C0EB04                  	shr	bl, 4
  1461 000009B3 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1462 000009B9 A2[4E290000]            	mov	[msgDevNo], al
  1463 000009BE 88E3                    	mov	bl, ah
  1464 000009C0 88DA                    	mov	dl, bl
  1465 000009C2 80E30F                  	and	bl, 0Fh
  1466 000009C5 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1467 000009CB A2[43290000]            	mov	[msgBusNo+1], al
  1468 000009D0 88D3                    	mov	bl, dl
  1469 000009D2 C0EB04                  	shr	bl, 4
  1470 000009D5 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1471 000009DB A2[42290000]            	mov	[msgBusNo], al
  1472                                  
  1473                                  	;mov	ax, [ac97_NamBar]
  1474 000009E0 66A1[60730000]          	mov	ax, [NAMBAR]
  1475 000009E6 88C3                    	mov	bl, al
  1476 000009E8 88DA                    	mov	dl, bl
  1477 000009EA 80E30F                  	and	bl, 0Fh
  1478 000009ED 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1479 000009F3 A2[6D290000]            	mov	[msgNamBar+3], al
  1480 000009F8 88D3                    	mov	bl, dl
  1481 000009FA C0EB04                  	shr	bl, 4
  1482 000009FD 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1483 00000A03 A2[6C290000]            	mov	[msgNamBar+2], al
  1484 00000A08 88E3                    	mov	bl, ah
  1485 00000A0A 88DA                    	mov	dl, bl
  1486 00000A0C 80E30F                  	and	bl, 0Fh
  1487 00000A0F 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1488 00000A15 A2[6B290000]            	mov	[msgNamBar+1], al
  1489 00000A1A 88D3                    	mov	bl, dl
  1490 00000A1C C0EB04                  	shr	bl, 4
  1491 00000A1F 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1492 00000A25 A2[6A290000]            	mov	[msgNamBar], al
  1493                                  
  1494                                  	;mov	ax, [ac97_NabmBar]
  1495 00000A2A 66A1[62730000]          	mov	ax, [NABMBAR]
  1496 00000A30 88C3                    	mov	bl, al
  1497 00000A32 88DA                    	mov	dl, bl
  1498 00000A34 80E30F                  	and	bl, 0Fh
  1499 00000A37 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1500 00000A3D A2[7D290000]            	mov	[msgNabmBar+3], al
  1501 00000A42 88D3                    	mov	bl, dl
  1502 00000A44 C0EB04                  	shr	bl, 4
  1503 00000A47 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1504 00000A4D A2[7C290000]            	mov	[msgNabmBar+2], al
  1505 00000A52 88E3                    	mov	bl, ah
  1506 00000A54 88DA                    	mov	dl, bl
  1507 00000A56 80E30F                  	and	bl, 0Fh
  1508 00000A59 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1509 00000A5F A2[7B290000]            	mov	[msgNabmBar+1], al
  1510 00000A64 88D3                    	mov	bl, dl
  1511 00000A66 C0EB04                  	shr	bl, 4
  1512 00000A69 8A83[E0280000]          	mov	al, [hex_chars+ebx]
  1513 00000A6F A2[7A290000]            	mov	[msgNabmBar], al
  1514                                  
  1515 00000A74 31C0                    	xor	eax, eax
  1516 00000A76 A0[FF720000]            	mov	al, [ac97_int_ln_reg]
  1517 00000A7B B10A                    	mov	cl, 10
  1518 00000A7D F6F1                    	div	cl
  1519                                  	; 23/11/2024
  1520                                  	;add	[msgIRQ], ax
  1521 00000A7F 66053030                	add	ax, 3030h
  1522 00000A83 66A3[86290000]          	mov	[msgIRQ], ax
  1523                                  	;and	al, al
  1524 00000A89 3C30                    	cmp	al, 30h
  1525 00000A8B 750D                    	jnz	short _w_ac97imsg_
  1526 00000A8D A0[87290000]            	mov	al, byte [msgIRQ+1]
  1527 00000A92 B420                    	mov	ah, ' '
  1528 00000A94 66A3[86290000]          	mov	[msgIRQ], ax
  1529                                  _w_ac97imsg_:
  1530                                  	; 19/11/2024
  1531 00000A9A E8451B0000              	call 	clear_window
  1532 00000A9F B60D                    	mov	dh, 13
  1533 00000AA1 B200                    	mov	dl, 0
  1534 00000AA3 E869180000              	call	setCursorPosition
  1535                                  	;;;
  1536                                  	; 21/12/2024
  1537 00000AA8 BD[F1280000]            	mov	ebp, msgAC97Info ; message
  1538                                  	; 22/12/2024
  1539                                  	;mov	cl, 07h ; color 
  1540 00000AAD E81F000000              	call	sys_gmsg
  1541                                  	;
  1542                                  	; 30/05/2024
  1543                                  write_VRA_info:
  1544                                  	; 21/12/2024
  1545 00000AB2 BD[8B290000]            	mov	ebp, msgVRAheader ; message
  1546                                  	;mov	cl, 07h ; color 
  1547 00000AB7 E815000000              	call	sys_gmsg
  1548                                  	;
  1549 00000ABC 803D[CE720000]00        	cmp	byte [VRA], 0
  1550 00000AC3 7607                    	jna	short _w_VRAi_no
  1551                                  _w_VRAi_yes:
  1552 00000AC5 BD[9A290000]            	mov	ebp, msgVRAyes
  1553 00000ACA EB05                    	jmp	short _w_VRAi_yn_msg
  1554                                  _w_VRAi_no:
  1555 00000ACC BD[A0290000]            	mov	ebp, msgVRAno
  1556                                  _w_VRAi_yn_msg:
  1557                                  	;mov	cl, 07h ; color 
  1558                                  	;call	sys_msg
  1559                                  	;retn
  1560                                  	;jmp	short sys_gmsg
  1561                                  	;;;
  1562                                  ; --------------------------------------------------------
  1563                                  
  1564                                  	; 22/12/2024
  1565                                  	;;;
  1566                                  	; 21/12/2024
  1567                                  	; (write message in VGA/VESA-VBE mode)
  1568                                  sys_gmsg:
  1569 00000AD1 8A4500                  	mov	al, [ebp]
  1570 00000AD4 20C0                    	and	al, al
  1571 00000AD6 7458                    	jz	short sys_gmsg_ok
  1572 00000AD8 3C20                    	cmp	al, 20h
  1573 00000ADA 731E                    	jnb	short sys_gmsg_3
  1574 00000ADC 3C0D                    	cmp	al, CR ; 13
  1575 00000ADE 750C                    	jne	short sys_gmsg_2
  1576                                  	; carriege return, move cursor to column 0
  1577 00000AE0 66C705[B4720000]00-     	mov	word [screenpos], 0
  1577 00000AE8 00                 
  1578                                  sys_gmsg_1:
  1579 00000AE9 45                      	inc	ebp
  1580 00000AEA EBE5                    	jmp	short sys_gmsg
  1581                                  sys_gmsg_2:
  1582 00000AEC 3C0A                    	cmp	al, LF ; 10
  1583 00000AEE 7540                    	jne	short sys_gmsg_ok ; 22/12/2024
  1584                                  	; line feed, move cursor to next row
  1585 00000AF0 668305[B6720000]10      	add	word [screenpos+2], 16
  1586 00000AF8 EBEF                    	jmp	short sys_gmsg_1
  1587                                  sys_gmsg_3:
  1588 00000AFA 8B35[B4720000]          	mov	esi, [screenpos]
  1589                                  		; hw = (cursor) row
  1590                                  		; si = (cursor) column
  1591 00000B00 B907000000              	mov	ecx, 07h ; gray (light)
  1592 00000B05 E8AE190000              	call	write_character
  1593 00000B0A 83C608                  	add	esi, 8
  1594                                  	;;;
  1595 00000B0D 6681FE8002              	cmp	si, 640
  1596 00000B12 7213                    	jb	short sys_gmsg_5
  1597 00000B14 C1EE10                  	shr	esi, 16
  1598 00000B17 6683C610                	add	si, 16
  1599 00000B1B 6681FEE001              	cmp	si, 480
  1600 00000B20 7202                    	jb	short sys_gmsg_4
  1601 00000B22 31F6                    	xor	esi, esi
  1602                                  sys_gmsg_4:
  1603 00000B24 C1E610                  	shl	esi, 16
  1604                                  	;;;
  1605                                  sys_gmsg_5:
  1606 00000B27 8935[B4720000]          	mov	[screenpos], esi
  1607 00000B2D 45                      	inc	ebp
  1608 00000B2E EBA1                    	jmp	short sys_gmsg
  1609                                  sys_gmsg_ok:
  1610 00000B30 C3                      	retn
  1611                                  	;;;
  1612                                  
  1613                                  ; --------------------------------------------------------
  1614                                  
  1615                                  ; 07/12/2024 - playwav9.s
  1616                                  ; 01/12/2024 - ac97play.s
  1617                                  ; 29/05/2024
  1618                                  ; 26/11/2023
  1619                                  ; 25/11/2023 - playwav6.s (32 bit registers, TRDOS 386 adaption)
  1620                                  ; 15/11/2023 - PLAYWAV5.COM, ich_wav5.asm
  1621                                  ; 14/11/2023
  1622                                  ; 13/11/2023 - Erdogan Tan - (VRA, sample rate conversion)
  1623                                  ; --------------------------------------------------------
  1624                                  
  1625                                  ;;Note:	At the end of every buffer load,
  1626                                  ;;	during buffer switch/swap, there will be discontinuity
  1627                                  ;;	between the last converted sample and the 1st sample
  1628                                  ;;	of the next buffer.
  1629                                  ;;	(like as a dot noises vaguely between normal sound samples)
  1630                                  ;;	-To avoid this defect, the 1st sample of
  1631                                  ;;	the next buffer may be read from the wav file but
  1632                                  ;;	the file pointer would need to be set to 1 sample back
  1633                                  ;;	again via seek system call. Time comsumption problem! -
  1634                                  ;;
  1635                                  ;;	Erdogan Tan - 15/11/2023
  1636                                  ;;
  1637                                  ;;	((If entire wav data would be loaded at once.. conversion
  1638                                  ;;	defect/noise would disappear.. but for DOS, to keep
  1639                                  ;;	64KB buffer limit is important also it is important
  1640                                  ;;	for running under 1MB barrier without HIMEM.SYS or DPMI.
  1641                                  ;;	I have tested this program by using 2-30MB wav files.))
  1642                                  ;;
  1643                                  ;;	Test Computer:	ASUS desktop/mainboard, M2N4-SLI, 2010.
  1644                                  ;;			AMD Athlon 64 X2 2200 MHZ CPU.
  1645                                  ;;		       	NFORCE4 (CK804) AC97 audio hardware.
  1646                                  ;;			Realtek ALC850 codec.
  1647                                  ;;		       	Retro DOS v4.2 (MSDOS 6.22) operating system.
  1648                                  
  1649                                  load_8khz_mono_8_bit:
  1650                                  	; 15/11/2023
  1651                                  	; 14/11/2023
  1652                                  	; 13/11/2023
  1653 00000B31 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1654                                  					; last of the file?
  1655 00000B38 7402                    	jz	short lff8m_0		; no
  1656 00000B3A F9                      	stc
  1657 00000B3B C3                      	retn
  1658                                  
  1659                                  lff8m_0:
  1660                                  	; 01/12/2024
  1661                                  	; edi = audio buffer address
  1662 00000B3C BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1663                                          ;mov	edx, [loadsize]
  1664                                  
  1665                                  	; esi = buffer address
  1666                                  	;; edx = buffer size
  1667                                  
  1668                                  	; load file into memory
  1669                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000B41 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000B47 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000B49 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000B4F B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000B54 CD40                <1>  int 40h
  1670 00000B56 7305                    	jnc	short lff8m_6
  1671 00000B58 E9AF000000              	jmp	lff8m_5  ; error !
  1672                                  
  1673                                  lff8m_6:
  1674                                  	; 01/12/2024
  1675 00000B5D A3[78730000]            	mov	[count], eax
  1676                                  	;;;
  1677                                  	; 07/12/2024
  1678                                  	;mov	edi, audio_buffer
  1679                                  	;;;
  1680 00000B62 21C0                    	and	eax, eax
  1681 00000B64 0F8499000000            	jz	lff8_eof
  1682                                  
  1683 00000B6A 89C1                    	mov	ecx, eax		; byte count
  1684                                  lff8m_1:
  1685 00000B6C AC                      	lodsb
  1686 00000B6D A2[58210000]            	mov	[previous_val], al
  1687 00000B72 2C80                    	sub	al, 80h
  1688 00000B74 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1689 00000B78 66AB                    	stosw		; original sample (left channel)
  1690 00000B7A 66AB                    	stosw		; original sample (right channel)
  1691                                  	;xor	eax, eax
  1692 00000B7C B080                    	mov	al, 80h
  1693 00000B7E 49                      	dec	ecx
  1694 00000B7F 7402                    	jz	short lff8m_2
  1695 00000B81 8A06                    	mov	al, [esi]
  1696                                  lff8m_2:
  1697                                  	;mov	[next_val], ax
  1698 00000B83 88C7                    	mov	bh, al	; [next_val]
  1699 00000B85 8A25[58210000]          	mov	ah, [previous_val]
  1700 00000B8B 00E0                    	add	al, ah	; [previous_val]
  1701 00000B8D D0D8                    	rcr	al, 1
  1702 00000B8F 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample
  1703 00000B91 00E0                    	add	al, ah	; [previous_val]
  1704 00000B93 D0D8                    	rcr	al, 1	
  1705 00000B95 88C3                    	mov	bl, al 	; this is temporary interpolation value
  1706 00000B97 00E0                    	add	al, ah	; [previous_val]
  1707 00000B99 D0D8                    	rcr	al, 1
  1708 00000B9B 2C80                    	sub	al, 80h
  1709 00000B9D 66C1E008                	shl	ax, 8	
  1710 00000BA1 66AB                    	stosw		; this is 1st interpolated sample (L)
  1711 00000BA3 66AB                    	stosw		; this is 1st interpolated sample (R)
  1712 00000BA5 88D8                    	mov	al, bl
  1713 00000BA7 00D0                    	add	al, dl
  1714 00000BA9 D0D8                    	rcr	al, 1
  1715 00000BAB 2C80                    	sub	al, 80h
  1716 00000BAD 66C1E008                	shl	ax, 8
  1717 00000BB1 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1718 00000BB3 66AB                    	stosw		; this is 2nd interpolated sample (R)
  1719 00000BB5 88D0                    	mov	al, dl
  1720 00000BB7 2C80                    	sub	al, 80h
  1721 00000BB9 66C1E008                	shl	ax, 8
  1722 00000BBD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1723 00000BBF 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1724                                  	;mov	al, [next_val]
  1725 00000BC1 88F8                    	mov	al, bh
  1726 00000BC3 00D0                    	add	al, dl
  1727 00000BC5 D0D8                    	rcr	al, 1
  1728 00000BC7 88C3                    	mov	bl, al	; this is temporary interpolation value
  1729 00000BC9 00D0                    	add	al, dl
  1730 00000BCB D0D8                    	rcr	al, 1
  1731 00000BCD 2C80                    	sub	al, 80h
  1732 00000BCF 66C1E008                	shl	ax, 8
  1733 00000BD3 66AB                    	stosw		; this is 4th interpolated sample (L)
  1734 00000BD5 66AB                    	stosw		; this is 4th interpolated sample (R)
  1735                                  	;mov	al, [next_val]
  1736 00000BD7 88F8                    	mov	al, bh
  1737 00000BD9 00D8                    	add	al, bl
  1738 00000BDB D0D8                    	rcr	al, 1
  1739 00000BDD 2C80                    	sub	al, 80h
  1740 00000BDF 66C1E008                	shl	ax, 8
  1741 00000BE3 66AB                    	stosw		; this is 5th interpolated sample (L)
  1742 00000BE5 66AB                    	stosw		; this is 5th interpolated sample (R)
  1743                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  1744 00000BE7 09C9                    	or	ecx, ecx
  1745 00000BE9 7581                    	jnz	short lff8m_1
  1746                                  
  1747                                  	; --------------
  1748                                  
  1749                                  lff8s_3:
  1750                                  lff8m_3:
  1751                                  lff8s2_3:
  1752                                  lff8m2_3:
  1753                                  lff16s_3:
  1754                                  lff16m_3:
  1755                                  lff16s2_3:
  1756                                  lff16m2_3:
  1757                                  lff24_3:
  1758                                  lff32_3:
  1759                                  lff44_3:
  1760                                  lff22_3:
  1761                                  lff11_3:
  1762                                  	; 08/12/2024 (BugFix)
  1763                                  	; 31/05/2024 (BugFix)
  1764 00000BEB 8B0D[6C730000]          	mov	ecx, [buffersize] ; 16 bit (48 kHZ, stereo) sample size
  1765                                  	;shl	ecx, 1	; byte count ; Bug !
  1766                                  	; 08/12/2024
  1767 00000BF1 81C1[00800000]          	add	ecx, audio_buffer
  1768 00000BF7 29F9                    	sub	ecx, edi
  1769 00000BF9 7607                    	jna	short lff8m_4
  1770                                  	;inc	ecx
  1771 00000BFB C1E902                  	shr	ecx, 2
  1772 00000BFE 31C0                    	xor	eax, eax ; fill (remain part of) buffer with zeros
  1773 00000C00 F3AB                    	rep	stosd
  1774                                  lff8m_4:
  1775                                  	; 31/05/2024 (BugFix)
  1776                                  	; cf=1 ; Bug !
  1777                                  	; 08/12/2024
  1778                                  	;clc
  1779 00000C02 C3                      	retn
  1780                                  
  1781                                  lff8_eof:
  1782                                  lff16_eof:
  1783                                  lff24_eof:
  1784                                  lff32_eof:
  1785                                  lff44_eof:
  1786                                  lff22_eof:
  1787                                  lff11_eof:
  1788                                  	; 15/11/2023
  1789 00000C03 C605[FE720000]01        	mov	byte [flags], ENDOFFILE
  1790 00000C0A EBDF                    	jmp	short lff8m_3
  1791                                  
  1792                                  lff8s_5:
  1793                                  lff8m_5:
  1794                                  lff8s2_5:
  1795                                  lff8m2_5:
  1796                                  lff16s_5:
  1797                                  lff16m_5:
  1798                                  lff16s2_5:
  1799                                  lff16m2_5:
  1800                                  lff24_5:
  1801                                  lff32_5:
  1802                                  lff44_5:
  1803                                  lff22_5:
  1804                                  lff11_5:
  1805 00000C0C B021                    	mov	al, '!'  ; error
  1806 00000C0E E8D3FAFFFF              	call	tL0
  1807                                  	
  1808                                  	;jmp	short lff8m_3
  1809                                  	; 15/11/2023
  1810 00000C13 EBEE                    	jmp	lff8_eof
  1811                                  
  1812                                  	; --------------
  1813                                  
  1814                                  load_8khz_stereo_8_bit:
  1815                                  	; 15/11/2023
  1816                                  	; 14/11/2023
  1817                                  	; 13/11/2023
  1818 00000C15 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1819                                  					; last of the file?
  1820 00000C1C 7402                    	jz	short lff8s_0		; no
  1821 00000C1E F9                      	stc
  1822 00000C1F C3                      	retn
  1823                                  
  1824                                  lff8s_0:
  1825                                  	; 01/12/2024
  1826                                  	; edi = audio buffer address
  1827 00000C20 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1828                                          ;mov	edx, [loadsize]
  1829                                  
  1830                                  	; esi = buffer address
  1831                                  	;; edx = buffer size
  1832                                  
  1833                                  	; load file into memory
  1834                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000C25 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000C2B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000C2D 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000C33 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000C38 CD40                <1>  int 40h
  1835 00000C3A 72D0                    	jc	short lff8s_5 ; error !
  1836                                  
  1837                                  	; 01/12/2024
  1838 00000C3C A3[78730000]            	mov	[count], eax
  1839                                  	;;;
  1840                                  	; 07/12/2024
  1841                                  	;mov	edi, audio_buffer
  1842                                  	;;;
  1843 00000C41 D1E8                    	shr	eax, 1
  1844 00000C43 74BE                    	jz	short lff8_eof
  1845                                  
  1846 00000C45 89C1                    	mov	ecx, eax	; word count
  1847                                  lff8s_1:
  1848 00000C47 AC                      	lodsb
  1849 00000C48 A2[58210000]            	mov	[previous_val_l], al
  1850 00000C4D 2C80                    	sub	al, 80h
  1851 00000C4F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1852 00000C53 66AB                    	stosw		; original sample (L)
  1853 00000C55 AC                      	lodsb
  1854 00000C56 A2[5A210000]            	mov	[previous_val_r], al
  1855 00000C5B 2C80                    	sub	al, 80h
  1856 00000C5D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  1857 00000C61 66AB                    	stosw		; original sample (R)
  1858                                  
  1859                                  	;xor	eax, eax
  1860 00000C63 66B88080                	mov	ax, 8080h
  1861 00000C67 49                      	dec	ecx
  1862 00000C68 7403                    	jz	short lff8s_2
  1863                                  		; convert 8 bit sample to 16 bit sample
  1864 00000C6A 668B06                  	mov	ax, [esi]
  1865                                  lff8s_2:
  1866 00000C6D A2[5C210000]            	mov	[next_val_l], al
  1867 00000C72 8825[5E210000]          	mov	[next_val_r], ah
  1868 00000C78 8A25[58210000]          	mov	ah, [previous_val_l]
  1869 00000C7E 00E0                    	add	al, ah
  1870 00000C80 D0D8                    	rcr	al, 1
  1871 00000C82 88C2                    	mov	dl, al	; this is interpolated middle (3th) sample (L)
  1872 00000C84 00E0                    	add	al, ah
  1873 00000C86 D0D8                    	rcr	al, 1
  1874 00000C88 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1875 00000C8A 00E0                    	add	al, ah
  1876 00000C8C D0D8                    	rcr	al, 1
  1877 00000C8E 2C80                    	sub	al, 80h
  1878 00000C90 66C1E008                	shl	ax, 8
  1879 00000C94 66AB                    	stosw		; this is 1st interpolated sample (L)
  1880 00000C96 A0[5E210000]            	mov	al, [next_val_r]
  1881 00000C9B 8A25[5A210000]          	mov	ah, [previous_val_r]
  1882 00000CA1 00E0                    	add	al, ah
  1883 00000CA3 D0D8                    	rcr	al, 1
  1884 00000CA5 88C6                    	mov	dh, al	; this is interpolated middle (3th) sample (R)
  1885 00000CA7 00E0                    	add	al, ah
  1886 00000CA9 D0D8                    	rcr	al, 1
  1887 00000CAB 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1888 00000CAD 00E0                    	add	al, ah
  1889 00000CAF D0D8                    	rcr	al, 1
  1890 00000CB1 2C80                    	sub	al, 80h
  1891 00000CB3 66C1E008                	shl	ax, 8
  1892 00000CB7 66AB                    	stosw		; this is 1st interpolated sample (R)
  1893 00000CB9 88D8                    	mov	al, bl
  1894 00000CBB 00D0                    	add	al, dl
  1895 00000CBD D0D8                    	rcr	al, 1
  1896 00000CBF 2C80                    	sub	al, 80h
  1897 00000CC1 66C1E008                	shl	ax, 8
  1898 00000CC5 66AB                    	stosw		; this is 2nd interpolated sample (L)
  1899 00000CC7 88F8                    	mov	al, bh
  1900 00000CC9 00F0                    	add	al, dh
  1901 00000CCB D0D8                    	rcr	al, 1
  1902 00000CCD 2C80                    	sub	al, 80h
  1903 00000CCF 66C1E008                	shl	ax, 8
  1904 00000CD3 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  1905 00000CD5 88D0                    	mov	al, dl
  1906 00000CD7 2C80                    	sub	al, 80h
  1907 00000CD9 66C1E008                	shl	ax, 8
  1908 00000CDD 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  1909 00000CDF 88F0                    	mov	al, dh
  1910 00000CE1 2C80                    	sub	al, 80h
  1911 00000CE3 66C1E008                	shl	ax, 8
  1912 00000CE7 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  1913 00000CE9 A0[5C210000]            	mov	al, [next_val_l]
  1914 00000CEE 00D0                    	add	al, dl
  1915 00000CF0 D0D8                    	rcr	al, 1
  1916 00000CF2 88C3                    	mov	bl, al	; this is temporary interpolation value (L)
  1917 00000CF4 00D0                    	add	al, dl
  1918 00000CF6 D0D8                    	rcr	al, 1
  1919 00000CF8 2C80                    	sub	al, 80h
  1920 00000CFA 66C1E008                	shl	ax, 8
  1921 00000CFE 66AB                    	stosw		; this is 4th interpolated sample (L)
  1922 00000D00 A0[5E210000]            	mov	al, [next_val_r]
  1923 00000D05 00F0                    	add	al, dh
  1924 00000D07 D0D8                    	rcr	al, 1
  1925 00000D09 88C7                    	mov	bh, al	; this is temporary interpolation value (R)
  1926 00000D0B 00F0                    	add	al, dh
  1927 00000D0D D0D8                    	rcr	al, 1
  1928 00000D0F 2C80                    	sub	al, 80h
  1929 00000D11 66C1E008                	shl	ax, 8
  1930 00000D15 66AB                    	stosw		; this is 4th interpolated sample (R)
  1931 00000D17 A0[5C210000]            	mov	al, [next_val_l]
  1932 00000D1C 00D8                    	add	al, bl
  1933 00000D1E D0D8                    	rcr	al, 1
  1934 00000D20 2C80                    	sub	al, 80h
  1935 00000D22 66C1E008                	shl	ax, 8
  1936 00000D26 66AB                    	stosw		; this is 5th interpolated sample (L)
  1937 00000D28 A0[5E210000]            	mov	al, [next_val_r]
  1938 00000D2D 00F8                    	add	al, bh
  1939 00000D2F D0D8                    	rcr	al, 1
  1940 00000D31 2C80                    	sub	al, 80h
  1941 00000D33 66C1E008                	shl	ax, 8
  1942 00000D37 66AB                    	stosw		; this is 5th interpolated sample (R)
  1943                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  1944 00000D39 E305                    	jecxz	lff8s_6
  1945 00000D3B E907FFFFFF              	jmp	lff8s_1
  1946                                  lff8s_6:
  1947 00000D40 E9A6FEFFFF              	jmp	lff8s_3
  1948                                  
  1949                                  load_8khz_mono_16_bit:
  1950                                  	; 13/11/2023
  1951 00000D45 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  1952                                  					; last of the file?
  1953 00000D4C 7402                    	jz	short lff8m2_0		; no
  1954 00000D4E F9                      	stc
  1955 00000D4F C3                      	retn
  1956                                  
  1957                                  lff8m2_0:
  1958                                  	; 01/12/2024
  1959                                  	; edi = audio buffer address
  1960 00000D50 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  1961                                          ;mov	edx, [loadsize]
  1962                                  
  1963                                  	; esi = buffer address
  1964                                  	;; edx = buffer size
  1965                                  
  1966                                  	; load file into memory
  1967                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000D55 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000D5B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000D5D 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000D63 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000D68 CD40                <1>  int 40h
  1968 00000D6A 0F82A0000000            	jc	lff8m2_7 ; error !
  1969                                  
  1970                                  	; 01/12/2024
  1971 00000D70 A3[78730000]            	mov	[count], eax
  1972                                  	;;;
  1973                                  	; 07/12/2024
  1974                                  	;mov	edi, audio_buffer
  1975                                  	;;;
  1976 00000D75 D1E8                    	shr	eax, 1
  1977 00000D77 7505                    	jnz	short lff8m2_8
  1978 00000D79 E985FEFFFF              	jmp	lff8_eof
  1979                                  
  1980                                  lff8m2_8:
  1981 00000D7E 89C1                    	mov	ecx, eax	; word count
  1982                                  lff8m2_1:
  1983 00000D80 66AD                    	lodsw
  1984 00000D82 66AB                    	stosw		; original sample (left channel)
  1985 00000D84 66AB                    	stosw		; original sample (right channel)
  1986 00000D86 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  1987 00000D89 66A3[58210000]          	mov	[previous_val], ax
  1988 00000D8F 31C0                    	xor	eax, eax
  1989 00000D91 49                      	dec	ecx
  1990 00000D92 7403                    	jz	short lff8m2_2
  1991 00000D94 668B06                  	mov	ax, [esi]
  1992                                  lff8m2_2:
  1993 00000D97 80C480                  	add	ah, 80h ; convert sound level to 0-65535 format
  1994 00000D9A 89C5                    	mov	ebp, eax	; [next_val]
  1995 00000D9C 660305[58210000]        	add	ax, [previous_val]
  1996 00000DA3 66D1D8                  	rcr	ax, 1
  1997 00000DA6 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample
  1998 00000DA8 660305[58210000]        	add	ax, [previous_val]
  1999 00000DAF 66D1D8                  	rcr	ax, 1	; this is temporary interpolation value
  2000 00000DB2 89C3                    	mov	ebx, eax 		
  2001 00000DB4 660305[58210000]        	add	ax, [previous_val]
  2002 00000DBB 66D1D8                  	rcr	ax, 1
  2003 00000DBE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2004 00000DC1 66AB                    	stosw		; this is 1st interpolated sample (L)
  2005 00000DC3 66AB                    	stosw		; this is 1st interpolated sample (R)
  2006 00000DC5 89D8                    	mov	eax, ebx
  2007 00000DC7 6601D0                  	add	ax, dx
  2008 00000DCA 66D1D8                  	rcr	ax, 1
  2009 00000DCD 80EC80                  	sub	ah, 80h
  2010 00000DD0 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2011 00000DD2 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2012 00000DD4 89D0                    	mov	eax, edx
  2013 00000DD6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2014 00000DD9 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2015 00000DDB 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2016 00000DDD 89E8                    	mov	eax, ebp
  2017 00000DDF 6601D0                  	add	ax, dx
  2018 00000DE2 66D1D8                  	rcr	ax, 1
  2019 00000DE5 89C3                    	mov	ebx, eax ; this is temporary interpolation value
  2020 00000DE7 6601D0                  	add	ax, dx
  2021 00000DEA 66D1D8                  	rcr	ax, 1
  2022 00000DED 80EC80                  	sub	ah, 80h
  2023 00000DF0 66AB                    	stosw		; this is 4th interpolated sample (L)
  2024 00000DF2 66AB                    	stosw		; this is 4th interpolated sample (R)
  2025 00000DF4 89E8                    	mov	eax, ebp
  2026 00000DF6 6601D8                  	add	ax, bx
  2027 00000DF9 66D1D8                  	rcr	ax, 1
  2028 00000DFC 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2029 00000DFF 66AB                    	stosw		; this is 5th interpolated sample (L)
  2030 00000E01 66AB                    	stosw		; this is 5th interpolated sample (R)
  2031                                  	; 8 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2032 00000E03 09C9                    	or	ecx, ecx
  2033 00000E05 0F8575FFFFFF            	jnz	lff8m2_1
  2034 00000E0B E9DBFDFFFF              	jmp	lff8m2_3
  2035                                  
  2036                                  lff8m2_7:
  2037                                  lff8s2_7:
  2038 00000E10 E9F7FDFFFF              	jmp	lff8m2_5  ; error
  2039                                  
  2040                                  load_8khz_stereo_16_bit:
  2041                                  	; 16/11/2023
  2042                                  	; 15/11/2023
  2043                                  	; 13/11/2023
  2044 00000E15 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2045                                  					; last of the file?
  2046 00000E1C 7402                    	jz	short lff8s2_0		; no
  2047 00000E1E F9                      	stc
  2048 00000E1F C3                      	retn
  2049                                  
  2050                                  lff8s2_0:
  2051                                  	; 01/12/2024
  2052                                  	; edi = audio buffer address
  2053 00000E20 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2054                                          ;mov	edx, [loadsize]
  2055                                  
  2056                                  	; esi = buffer address
  2057                                  	;; edx = buffer size
  2058                                  
  2059                                  	; load file into memory
  2060                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000E25 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000E2B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000E2D 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000E33 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000E38 CD40                <1>  int 40h
  2061 00000E3A 72D4                    	jc	short lff8s2_7 ; error !
  2062                                  
  2063                                  	; 01/12/2024
  2064 00000E3C A3[78730000]            	mov	[count], eax
  2065                                  	;;;
  2066                                  	; 07/12/2024
  2067                                  	;mov	edi, audio_buffer
  2068                                  	;;;
  2069 00000E41 C1E802                  	shr	eax, 2
  2070 00000E44 7505                    	jnz	short lff8s2_8
  2071 00000E46 E9B8FDFFFF              	jmp	lff8_eof
  2072                                  
  2073                                  lff8s2_8:
  2074 00000E4B 89C1                    	mov	ecx, eax ; dword count
  2075                                  lff8s2_1:
  2076 00000E4D 66AD                    	lodsw
  2077 00000E4F 66AB                    	stosw		; original sample (L)
  2078                                  	; 15/11/2023
  2079 00000E51 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2080 00000E54 66A3[58210000]          	mov	[previous_val_l], ax
  2081 00000E5A 66AD                    	lodsw
  2082 00000E5C 66AB                    	stosw		; original sample (R)
  2083 00000E5E 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2084 00000E61 66A3[5A210000]          	mov	[previous_val_r], ax
  2085 00000E67 31D2                    	xor	edx, edx
  2086 00000E69 31C0                    	xor	eax, eax
  2087                                  	; 16/11/2023
  2088 00000E6B 49                      	dec	ecx
  2089 00000E6C 7407                    	jz	short lff8s2_2
  2090 00000E6E 668B06                  	mov	ax, [esi]
  2091 00000E71 668B5602                	mov	dx, [esi+2]
  2092                                  lff8s2_2:
  2093 00000E75 80C480                  	add	ah, 80h	; convert sound level to 0-65535 format
  2094 00000E78 66A3[5C210000]          	mov	[next_val_l], ax
  2095 00000E7E 80C680                  	add	dh, 80h	; convert sound level to 0-65535 format
  2096 00000E81 668915[5E210000]        	mov	[next_val_r], dx
  2097 00000E88 660305[58210000]        	add	ax, [previous_val_l]
  2098 00000E8F 66D1D8                  	rcr	ax, 1
  2099 00000E92 89C2                    	mov	edx, eax ; this is interpolated middle (3th) sample (L)
  2100 00000E94 660305[58210000]        	add	ax, [previous_val_l]
  2101 00000E9B 66D1D8                  	rcr	ax, 1	
  2102 00000E9E 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2103 00000EA0 660305[58210000]        	add	ax, [previous_val_l]
  2104 00000EA7 66D1D8                  	rcr	ax, 1
  2105 00000EAA 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2106 00000EAD 66AB                    	stosw		; this is 1st interpolated sample (L)
  2107 00000EAF 66A1[5E210000]          	mov	ax, [next_val_r]
  2108 00000EB5 660305[5A210000]        	add	ax, [previous_val_r]
  2109 00000EBC 66D1D8                  	rcr	ax, 1
  2110 00000EBF 89C5                    	mov	ebp, eax ; this is interpolated middle (3th) sample (R)
  2111 00000EC1 660305[5A210000]        	add	ax, [previous_val_r]
  2112 00000EC8 66D1D8                  	rcr	ax, 1
  2113 00000ECB 50                      	push	eax ; *	; this is temporary interpolation value (R)
  2114 00000ECC 660305[5A210000]        	add	ax, [previous_val_r]
  2115 00000ED3 66D1D8                  	rcr	ax, 1
  2116 00000ED6 80EC80                  	sub	ah, 80h
  2117 00000ED9 66AB                    	stosw		; this is 1st interpolated sample (R)
  2118 00000EDB 89D8                    	mov	eax, ebx
  2119 00000EDD 6601D0                  	add	ax, dx
  2120 00000EE0 66D1D8                  	rcr	ax, 1
  2121 00000EE3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2122 00000EE6 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2123 00000EE8 58                      	pop	eax ; *
  2124 00000EE9 6601E8                  	add	ax, bp
  2125 00000EEC 66D1D8                  	rcr	ax, 1
  2126 00000EEF 80EC80                  	sub	ah, 80h
  2127 00000EF2 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2128 00000EF4 89D0                    	mov	eax, edx
  2129 00000EF6 80EC80                  	sub	ah, 80h
  2130 00000EF9 66AB                    	stosw		; this is middle (3th) interpolated sample (L)
  2131 00000EFB 89E8                    	mov	eax, ebp
  2132 00000EFD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2133 00000F00 66AB                    	stosw		; this is middle (3th) interpolated sample (R)
  2134 00000F02 66A1[5C210000]          	mov	ax, [next_val_l]
  2135 00000F08 6601D0                  	add	ax, dx
  2136 00000F0B 66D1D8                  	rcr	ax, 1
  2137 00000F0E 89C3                    	mov	ebx, eax ; this is temporary interpolation value (L)
  2138 00000F10 6601D0                  	add	ax, dx
  2139 00000F13 66D1D8                  	rcr	ax, 1
  2140 00000F16 80EC80                  	sub	ah, 80h
  2141 00000F19 66AB                    	stosw		; this is 4th interpolated sample (L)
  2142 00000F1B 66A1[5E210000]          	mov	ax, [next_val_r]
  2143 00000F21 6601E8                  	add	ax, bp
  2144 00000F24 66D1D8                  	rcr	ax, 1
  2145 00000F27 50                      	push	eax ; ** ; this is temporary interpolation value (R)
  2146 00000F28 6601E8                  	add	ax, bp
  2147 00000F2B 66D1D8                  	rcr	ax, 1
  2148 00000F2E 80EC80                  	sub	ah, 80h
  2149 00000F31 66AB                    	stosw		; this is 4th interpolated sample (R)
  2150 00000F33 66A1[5C210000]          	mov	ax, [next_val_l]
  2151 00000F39 6601D8                  	add	ax, bx
  2152 00000F3C 66D1D8                  	rcr	ax, 1
  2153 00000F3F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2154 00000F42 66AB                    	stosw		; this is 5th interpolated sample (L)
  2155 00000F44 58                      	pop	eax ; **
  2156 00000F45 660305[5E210000]        	add	ax, [next_val_r]
  2157 00000F4C 66D1D8                  	rcr	ax, 1
  2158 00000F4F 80EC80                  	sub	ah, 80h
  2159 00000F52 66AB                    	stosw		; this is 5th interpolated sample (R)
  2160                                  	; 8 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2161 00000F54 E305                    	jecxz	lff8_s2_9
  2162 00000F56 E9F2FEFFFF              	jmp	lff8s2_1
  2163                                  lff8_s2_9:
  2164 00000F5B E98BFCFFFF              	jmp	lff8s2_3
  2165                                  
  2166                                  ; .....................
  2167                                  
  2168                                  load_16khz_mono_8_bit:
  2169                                  	; 14/11/2023
  2170                                  	; 13/11/2023
  2171 00000F60 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2172                                  					; last of the file?
  2173 00000F67 7402                    	jz	short lff16m_0		; no
  2174 00000F69 F9                      	stc
  2175 00000F6A C3                      	retn
  2176                                  
  2177                                  lff16m_0:
  2178                                  	; 01/12/2024
  2179                                  	; edi = audio buffer address
  2180 00000F6B BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2181                                          ;mov	edx, [loadsize]
  2182                                  
  2183                                  	; esi = buffer address
  2184                                  	;; edx = buffer size
  2185                                  
  2186                                  	; load file into memory
  2187                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000F70 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000F76 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000F78 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000F7E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00000F83 CD40                <1>  int 40h
  2188 00000F85 7253                    	jc	short lff16m_7 ; error !
  2189                                  
  2190                                  	; 01/12/2024
  2191 00000F87 A3[78730000]            	mov	[count], eax
  2192                                  	;;;
  2193                                  	; 07/12/2024
  2194                                  	;mov	edi, audio_buffer
  2195                                  	;;;
  2196 00000F8C 21C0                    	and	eax, eax
  2197 00000F8E 7505                    	jnz	short lff16m_8
  2198 00000F90 E96EFCFFFF              	jmp	lff16_eof
  2199                                  
  2200                                  lff16m_8:
  2201 00000F95 89C1                    	mov	ecx, eax		; byte count
  2202                                  lff16m_1:
  2203 00000F97 AC                      	lodsb
  2204                                  	;mov	[previous_val], al
  2205 00000F98 88C3                    	mov	bl, al
  2206 00000F9A 2C80                    	sub	al, 80h
  2207 00000F9C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2208 00000FA0 66AB                    	stosw		; original sample (left channel)
  2209 00000FA2 66AB                    	stosw		; original sample (right channel)
  2210                                  	;xor	ax, ax
  2211                                  	; 14/11/22023
  2212 00000FA4 B080                    	mov	al, 80h
  2213 00000FA6 49                      	dec	ecx
  2214 00000FA7 7402                    	jz	short lff16m_2
  2215 00000FA9 8A06                    	mov	al, [esi]
  2216                                  lff16m_2:
  2217                                  	;mov	[next_val], al
  2218 00000FAB 88C7                    	mov	bh, al
  2219                                  	;add	al, [previous_val]
  2220 00000FAD 00D8                    	add	al, bl
  2221 00000FAF D0D8                    	rcr	al, 1
  2222 00000FB1 88C2                    	mov	dl, al	; this is interpolated middle (temp) sample
  2223                                  	;add	al, [previous_val]
  2224 00000FB3 00D8                    	add	al, bl
  2225 00000FB5 D0D8                    	rcr	al, 1
  2226 00000FB7 2C80                    	sub	al, 80h
  2227 00000FB9 66C1E008                	shl	ax, 8
  2228 00000FBD 66AB                    	stosw		; this is 1st interpolated sample (L)
  2229 00000FBF 66AB                    	stosw		; this is 1st interpolated sample (R)
  2230                                  	;mov	al, [next_val]
  2231 00000FC1 88F8                    	mov	al, bh
  2232 00000FC3 00D0                    	add	al, dl
  2233 00000FC5 D0D8                    	rcr	al, 1
  2234 00000FC7 2C80                    	sub	al, 80h
  2235 00000FC9 66C1E008                	shl	ax, 8
  2236 00000FCD 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2237 00000FCF 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2238                                  	
  2239                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2240 00000FD1 09C9                    	or	ecx, ecx
  2241 00000FD3 75C2                    	jnz	short lff16m_1
  2242 00000FD5 E911FCFFFF              	jmp	lff16m_3
  2243                                  
  2244                                  lff16m_7:
  2245                                  lff16s_7:
  2246 00000FDA E92DFCFFFF              	jmp	lff16m_5  ; error
  2247                                  
  2248                                  load_16khz_stereo_8_bit:
  2249                                  	; 14/11/2023
  2250                                  	; 13/11/2023
  2251 00000FDF F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2252                                  					; last of the file?
  2253 00000FE6 7402                    	jz	short lff16s_0		; no
  2254 00000FE8 F9                      	stc
  2255 00000FE9 C3                      	retn
  2256                                  
  2257                                  lff16s_0:
  2258                                  	; 01/12/2024
  2259                                  	; edi = audio buffer address
  2260 00000FEA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2261                                          ;mov	edx, [loadsize]
  2262                                  
  2263                                  	; esi = buffer address
  2264                                  	;; edx = buffer size
  2265                                  
  2266                                  	; load file into memory
  2267                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00000FEF 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00000FF5 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00000FF7 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00000FFD B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001002 CD40                <1>  int 40h
  2268 00001004 72D4                    	jc	short lff16s_7 ; error !
  2269                                  
  2270                                  	; 01/12/2024
  2271 00001006 A3[78730000]            	mov	[count], eax
  2272                                  	;;;
  2273                                  	; 07/12/2024
  2274                                  	;mov	edi, audio_buffer
  2275                                  	;;;
  2276 0000100B D1E8                    	shr	eax, 1
  2277 0000100D 7505                    	jnz	short lff16s_8
  2278 0000100F E9EFFBFFFF              	jmp	lff16_eof
  2279                                  
  2280                                  lff16s_8:
  2281 00001014 89C1                    	mov	ecx, eax	; word count
  2282                                  lff16s_1:
  2283 00001016 AC                      	lodsb
  2284 00001017 A2[58210000]            	mov	[previous_val_l], al
  2285 0000101C 2C80                    	sub	al, 80h
  2286 0000101E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2287 00001022 66AB                    	stosw		; original sample (L)
  2288 00001024 AC                      	lodsb
  2289 00001025 A2[5A210000]            	mov	[previous_val_r], al
  2290 0000102A 2C80                    	sub	al, 80h
  2291 0000102C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2292 00001030 66AB                    	stosw		; original sample (R)
  2293                                  
  2294                                  	;xor	eax, eax
  2295 00001032 66B88080                	mov	ax, 8080h
  2296 00001036 49                      	dec	ecx
  2297 00001037 7403                    	jz	short lff16s_2
  2298                                  		; convert 8 bit sample to 16 bit sample
  2299 00001039 668B06                  	mov	ax, [esi]
  2300                                  lff16s_2:
  2301                                  	;mov	[next_val_l], al
  2302                                  	;mov	[next_val_r], ah
  2303 0000103C 89C3                    	mov	ebx, eax
  2304 0000103E 0205[58210000]          	add	al, [previous_val_l]
  2305 00001044 D0D8                    	rcr	al, 1
  2306 00001046 88C2                    	mov	dl, al	; this is temporary interpolation value (L)
  2307 00001048 0205[58210000]          	add	al, [previous_val_l]
  2308 0000104E D0D8                    	rcr	al, 1
  2309 00001050 2C80                    	sub	al, 80h
  2310 00001052 66C1E008                	shl	ax, 8
  2311 00001056 66AB                    	stosw		; this is 1st interpolated sample (L)
  2312 00001058 88F8                    	mov	al, bh	; [next_val_r]
  2313 0000105A 0205[5A210000]          	add	al, [previous_val_r]
  2314 00001060 D0D8                    	rcr	al, 1
  2315 00001062 88C6                    	mov	dh, al	; this is temporary interpolation value (R)
  2316 00001064 0205[5A210000]          	add	al, [previous_val_r]
  2317 0000106A D0D8                    	rcr	al, 1
  2318 0000106C 2C80                    	sub	al, 80h
  2319 0000106E 66C1E008                	shl	ax, 8
  2320 00001072 66AB                    	stosw		; this is 1st interpolated sample (R)
  2321 00001074 88D0                    	mov	al, dl
  2322 00001076 00D8                    	add	al, bl	; [next_val_l]
  2323 00001078 D0D8                    	rcr	al, 1
  2324 0000107A 2C80                    	sub	al, 80h
  2325 0000107C 66C1E008                	shl	ax, 8
  2326 00001080 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2327 00001082 88F0                    	mov	al, dh
  2328 00001084 00F8                    	add	al, bh	; [next_val_r]
  2329 00001086 D0D8                    	rcr	al, 1
  2330 00001088 2C80                    	sub	al, 80h
  2331 0000108A 66C1E008                	shl	ax, 8
  2332 0000108E 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2333                                  	
  2334                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2335 00001090 09C9                    	or	ecx, ecx
  2336 00001092 7582                    	jnz	short lff16s_1
  2337 00001094 E952FBFFFF              	jmp	lff16s_3
  2338                                  
  2339                                  load_16khz_mono_16_bit:
  2340                                  	; 15/11/2023
  2341                                  	; 13/11/2023
  2342 00001099 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2343                                  					; last of the file?
  2344 000010A0 7402                    	jz	short lff16m2_0		; no
  2345 000010A2 F9                      	stc
  2346 000010A3 C3                      	retn
  2347                                  
  2348                                  lff16m2_0:
  2349                                  	; 01/12/2024
  2350                                  	; edi = audio buffer address
  2351 000010A4 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2352                                          ;mov	edx, [loadsize]
  2353                                  
  2354                                  	; esi = buffer address
  2355                                  	;; edx = buffer size
  2356                                  
  2357                                  	; load file into memory
  2358                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000010A9 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000010AF 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000010B1 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000010B7 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000010BC CD40                <1>  int 40h
  2359 000010BE 7255                    	jc	short lff16m2_7 ; error !
  2360                                  
  2361                                  	; 01/12/2024
  2362 000010C0 A3[78730000]            	mov	[count], eax
  2363                                  	;;;
  2364                                  	; 07/12/2024
  2365                                  	;mov	edi, audio_buffer
  2366                                  	;;;
  2367 000010C5 D1E8                    	shr	eax, 1
  2368 000010C7 7505                    	jnz	short lff16m2_8
  2369 000010C9 E935FBFFFF              	jmp	lff16_eof
  2370                                  
  2371                                  lff16m2_8:
  2372 000010CE 89C1                    	mov	ecx, eax  ; word count
  2373                                  lff16m2_1:
  2374 000010D0 66AD                    	lodsw
  2375 000010D2 66AB                    	stosw		; original sample (left channel)
  2376 000010D4 66AB                    	stosw		; original sample (right channel)
  2377 000010D6 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2378                                  	;mov	[previous_val], ax
  2379 000010D9 89C3                    	mov	ebx, eax
  2380 000010DB 31C0                    	xor	eax, eax
  2381 000010DD 49                      	dec	ecx
  2382 000010DE 7403                    	jz	short lff16m2_2
  2383 000010E0 668B06                  	mov	ax, [esi]
  2384                                  lff16m2_2:
  2385 000010E3 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2386 000010E6 89C5                    	mov	ebp, eax	; [next_val]
  2387                                  	;add	ax, [previous_val]
  2388 000010E8 6601D8                  	add	ax, bx
  2389 000010EB 66D1D8                  	rcr	ax, 1
  2390 000010EE 89C2                    	mov	edx, eax ; this is temporary interpolation value
  2391                                  	;add	ax, [previous_val]
  2392 000010F0 6601D8                  	add	ax, bx
  2393 000010F3 66D1D8                  	rcr	ax, 1
  2394 000010F6 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2395 000010F9 66AB                    	stosw		; this is 1st interpolated sample (L)
  2396 000010FB 66AB                    	stosw		; this is 1st interpolated sample (R)
  2397 000010FD 89E8                    	mov	eax, ebp
  2398 000010FF 6601D0                  	add	ax, dx
  2399 00001102 66D1D8                  	rcr	ax, 1
  2400 00001105 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2401 00001108 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2402 0000110A 66AB                    	stosw		; this is 2nd interpolated sample (R)
  2403                                  	; 16 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2404 0000110C 09C9                    	or	ecx, ecx
  2405 0000110E 75C0                    	jnz	short lff16m2_1
  2406 00001110 E9D6FAFFFF              	jmp	lff16m2_3
  2407                                  
  2408                                  lff16m2_7:
  2409                                  lff16s2_7:
  2410 00001115 E9F2FAFFFF              	jmp	lff16m2_5  ; error
  2411                                  
  2412                                  load_16khz_stereo_16_bit:
  2413                                  	; 16/11/2023
  2414                                  	; 15/11/2023
  2415                                  	; 13/11/2023
  2416 0000111A F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2417                                  					; last of the file?
  2418 00001121 7402                    	jz	short lff16s2_0		; no
  2419 00001123 F9                      	stc
  2420 00001124 C3                      	retn
  2421                                  
  2422                                  lff16s2_0:
  2423                                  	; 01/12/2024
  2424                                  	; edi = audio buffer address
  2425 00001125 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2426                                          ;mov	edx, [loadsize]
  2427                                  
  2428                                  	; esi = buffer address
  2429                                  	;; edx = buffer size
  2430                                  
  2431                                  	; load file into memory
  2432                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000112A 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001130 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001132 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001138 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000113D CD40                <1>  int 40h
  2433 0000113F 72D4                    	jc	short lff16s2_7 ; error !
  2434                                  
  2435                                  	; 01/12/2024
  2436 00001141 A3[78730000]            	mov	[count], eax
  2437                                  	;;;
  2438                                  	; 07/12/2024
  2439                                  	;mov	edi, audio_buffer
  2440                                  	;;;
  2441 00001146 C1E802                  	shr	eax, 2
  2442 00001149 7505                    	jnz	short lff16s2_8
  2443 0000114B E9B3FAFFFF              	jmp	lff16_eof
  2444                                  
  2445                                  lff16s2_8:
  2446 00001150 89C1                    	mov	ecx, eax  ; dword count
  2447                                  lff16s2_1:
  2448 00001152 66AD                    	lodsw
  2449 00001154 66AB                    	stosw		; original sample (L)
  2450 00001156 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2451 00001159 66A3[58210000]          	mov	[previous_val_l], ax
  2452 0000115F 66AD                    	lodsw
  2453 00001161 66AB                    	stosw		; original sample (R)
  2454 00001163 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2455 00001166 66A3[5A210000]          	mov	[previous_val_r], ax
  2456 0000116C 31D2                    	xor	edx, edx
  2457 0000116E 31C0                    	xor	eax, eax
  2458                                  	; 16/11/2023
  2459 00001170 49                      	dec	ecx
  2460 00001171 7407                    	jz	short lff16s2_2
  2461 00001173 668B06                  	mov	ax, [esi]
  2462 00001176 668B5602                	mov	dx, [esi+2]
  2463                                  lff16s2_2:
  2464 0000117A 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2465                                  	;mov	[next_val_l], ax
  2466 0000117D 89C5                    	mov	ebp, eax
  2467 0000117F 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2468 00001182 668915[5E210000]        	mov	[next_val_r], dx
  2469 00001189 660305[58210000]        	add	ax, [previous_val_l]
  2470 00001190 66D1D8                  	rcr	ax, 1
  2471 00001193 89C2                    	mov	edx, eax ; this is temporary interpolation value (L)
  2472 00001195 660305[58210000]        	add	ax, [previous_val_l]
  2473 0000119C 66D1D8                  	rcr	ax, 1
  2474 0000119F 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2475 000011A2 66AB                    	stosw		; this is 1st interpolated sample (L)
  2476 000011A4 66A1[5E210000]          	mov	ax, [next_val_r]
  2477 000011AA 660305[5A210000]        	add	ax, [previous_val_r]
  2478 000011B1 66D1D8                  	rcr	ax, 1
  2479 000011B4 89C3                    	mov	ebx, eax ; this is temporary interpolation value (R)
  2480 000011B6 660305[5A210000]        	add	ax, [previous_val_r]
  2481 000011BD 66D1D8                  	rcr	ax, 1
  2482 000011C0 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2483 000011C3 66AB                    	stosw		; this is 1st interpolated sample (R)
  2484                                  	;mov	ax, [next_val_l]
  2485 000011C5 89E8                    	mov	eax, ebp
  2486 000011C7 6601D0                  	add	ax, dx
  2487 000011CA 66D1D8                  	rcr	ax, 1
  2488 000011CD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2489 000011D0 66AB                    	stosw		; this is 2nd interpolated sample (L)
  2490 000011D2 66A1[5E210000]          	mov	ax, [next_val_r]
  2491 000011D8 6601D8                  	add	ax, bx
  2492 000011DB 66D1D8                  	rcr	ax, 1
  2493 000011DE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2494 000011E1 66AB                    	stosw 		; this is 2nd interpolated sample (R)
  2495                                  	
  2496                                  	; 16 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2497 000011E3 09C9                    	or	ecx, ecx
  2498 000011E5 0F8567FFFFFF            	jnz	lff16s2_1
  2499 000011EB E9FBF9FFFF              	jmp	lff16s2_3
  2500                                  
  2501                                  ; .....................
  2502                                  
  2503                                  load_24khz_mono_8_bit:
  2504                                  	; 15/11/2023
  2505 000011F0 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2506                                  					; last of the file?
  2507 000011F7 7402                    	jz	short lff24m_0		; no
  2508 000011F9 F9                      	stc
  2509 000011FA C3                      	retn
  2510                                  
  2511                                  lff24m_0:
  2512                                  	; 01/12/2024
  2513                                  	; edi = audio buffer address
  2514 000011FB BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2515                                          ;mov	edx, [loadsize]
  2516                                  
  2517                                  	; esi = buffer address
  2518                                  	;; edx = buffer size
  2519                                  
  2520                                  	; load file into memory
  2521                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001200 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001206 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001208 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000120E B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001213 CD40                <1>  int 40h
  2522 00001215 723B                    	jc	short lff24m_7 ; error !
  2523                                  
  2524                                  	; 01/12/2024
  2525 00001217 A3[78730000]            	mov	[count], eax
  2526                                  	;;;
  2527                                  	; 07/12/2024
  2528                                  	;mov	edi, audio_buffer
  2529                                  	;;;
  2530 0000121C 21C0                    	and	eax, eax
  2531 0000121E 7505                    	jnz	short lff24m_8
  2532 00001220 E9DEF9FFFF              	jmp	lff24_eof
  2533                                  
  2534                                  lff24m_8:
  2535 00001225 89C1                    	mov	ecx, eax	; byte count
  2536                                  lff24m_1:
  2537 00001227 AC                      	lodsb
  2538                                  	;mov	[previous_val], al
  2539 00001228 88C3                    	mov	bl, al
  2540 0000122A 2C80                    	sub	al, 80h
  2541 0000122C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2542 00001230 66AB                    	stosw		; original sample (left channel)
  2543 00001232 66AB                    	stosw		; original sample (right channel)
  2544                                  	;xor	eax, eax
  2545 00001234 B080                    	mov	al, 80h
  2546 00001236 49                      	dec	ecx
  2547 00001237 7402                    	jz	short lff24m_2
  2548 00001239 8A06                    	mov	al, [esi]
  2549                                  lff24m_2:
  2550                                  	;;mov	[next_val], al
  2551                                  	;mov	bh, al
  2552                                  	;add	al, [previous_val]
  2553 0000123B 00D8                    	add	al, bl
  2554 0000123D D0D8                    	rcr	al, 1
  2555 0000123F 2C80                    	sub	al, 80h
  2556 00001241 66C1E008                	shl	ax, 8
  2557 00001245 66AB                    	stosw		; this is interpolated sample (L)
  2558 00001247 66AB                    	stosw		; this is interpolated sample (R)
  2559                                  	
  2560                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2561 00001249 09C9                    	or	ecx, ecx
  2562 0000124B 75DA                    	jnz	short lff24m_1
  2563 0000124D E999F9FFFF              	jmp	lff24_3
  2564                                  
  2565                                  lff24m_7:
  2566                                  lff24s_7:
  2567 00001252 E9B5F9FFFF              	jmp	lff24_5  ; error
  2568                                  
  2569                                  load_24khz_stereo_8_bit:
  2570                                  	; 15/11/2023
  2571 00001257 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2572                                  					; last of the file?
  2573 0000125E 7402                    	jz	short lff24s_0		; no
  2574 00001260 F9                      	stc
  2575 00001261 C3                      	retn
  2576                                  
  2577                                  lff24s_0:
  2578                                  	; 01/12/2024
  2579                                  	; edi = audio buffer address
  2580 00001262 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2581                                          ;mov	edx, [loadsize]
  2582                                  
  2583                                  	; esi = buffer address
  2584                                  	;; edx = buffer size
  2585                                  
  2586                                  	; load file into memory
  2587                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001267 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000126D 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000126F 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001275 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 0000127A CD40                <1>  int 40h
  2588 0000127C 72D4                    	jc	short lff24s_7 ; error !
  2589                                  
  2590                                  	; 01/12/2024
  2591 0000127E A3[78730000]            	mov	[count], eax
  2592                                  	;;;
  2593                                  	; 07/12/2024
  2594                                  	;mov	edi, audio_buffer
  2595                                  	;;;
  2596 00001283 D1E8                    	shr	eax, 1
  2597 00001285 7505                    	jnz	short lff24s_8
  2598 00001287 E977F9FFFF              	jmp	lff24_eof
  2599                                  
  2600                                  lff24s_8:
  2601 0000128C 89C1                    	mov	ecx, eax  ; word count
  2602                                  lff24s_1:
  2603 0000128E AC                      	lodsb
  2604 0000128F A2[58210000]            	mov	[previous_val_l], al
  2605 00001294 2C80                    	sub	al, 80h
  2606 00001296 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2607 0000129A 66AB                    	stosw		; original sample (L)
  2608 0000129C AC                      	lodsb
  2609 0000129D A2[5A210000]            	mov	[previous_val_r], al
  2610 000012A2 2C80                    	sub	al, 80h
  2611 000012A4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2612 000012A8 66AB                    	stosw		; original sample (R)
  2613                                  
  2614                                  	;xor	eax, eax
  2615 000012AA 66B88080                	mov	ax, 8080h
  2616 000012AE 49                      	dec	ecx
  2617 000012AF 7403                    	jz	short lff24s_2
  2618                                  		; convert 8 bit sample to 16 bit sample
  2619 000012B1 668B06                  	mov	ax, [esi]
  2620                                  lff24s_2:
  2621                                  	;;mov	[next_val_l], al
  2622                                  	;;mov	[next_val_r], ah
  2623                                  	;mov	bx, ax
  2624 000012B4 88E7                    	mov	bh, ah
  2625 000012B6 0205[58210000]          	add	al, [previous_val_l]
  2626 000012BC D0D8                    	rcr	al, 1
  2627                                  	;mov	dl, al
  2628 000012BE 2C80                    	sub	al, 80h
  2629 000012C0 66C1E008                	shl	ax, 8
  2630 000012C4 66AB                    	stosw		; this is interpolated sample (L)
  2631 000012C6 88F8                    	mov	al, bh	; [next_val_r]
  2632 000012C8 0205[5A210000]          	add	al, [previous_val_r]
  2633 000012CE D0D8                    	rcr	al, 1
  2634                                  	;mov	dh, al
  2635 000012D0 2C80                    	sub	al, 80h
  2636 000012D2 66C1E008                	shl	ax, 8
  2637 000012D6 66AB                    	stosw		; this is interpolated sample (R)
  2638                                  		
  2639                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2640 000012D8 09C9                    	or	ecx, ecx
  2641 000012DA 75B2                    	jnz	short lff24s_1
  2642 000012DC E90AF9FFFF              	jmp	lff24_3
  2643                                  
  2644                                  load_24khz_mono_16_bit:
  2645                                  	; 15/11/2023
  2646 000012E1 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2647                                  					; last of the file?
  2648 000012E8 7402                    	jz	short lff24m2_0		; no
  2649 000012EA F9                      	stc
  2650 000012EB C3                      	retn
  2651                                  
  2652                                  lff24m2_0:
  2653                                  	; 01/12/2024
  2654                                  	; edi = audio buffer address
  2655 000012EC BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2656                                          ;mov	edx, [loadsize]
  2657                                  
  2658                                  	; esi = buffer address
  2659                                  	;; edx = buffer size
  2660                                  
  2661                                  	; load file into memory
  2662                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000012F1 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000012F7 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000012F9 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000012FF B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001304 CD40                <1>  int 40h
  2663 00001306 7237                    	jc	short lff24m2_7 ; error !
  2664                                  
  2665                                  	; 01/12/2024
  2666 00001308 A3[78730000]            	mov	[count], eax
  2667                                  	;;;
  2668                                  	; 07/12/2024
  2669                                  	;mov	edi, audio_buffer
  2670                                  	;;;
  2671 0000130D D1E8                    	shr	eax, 1
  2672 0000130F 7505                    	jnz	short lff24m2_8
  2673 00001311 E9EDF8FFFF              	jmp	lff24_eof
  2674                                  
  2675                                  lff24m2_8:
  2676 00001316 89C1                    	mov	ecx, eax  ; word count
  2677                                  lff24m2_1:
  2678 00001318 66AD                    	lodsw
  2679 0000131A 66AB                    	stosw		; original sample (left channel)
  2680 0000131C 66AB                    	stosw		; original sample (right channel)
  2681 0000131E 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2682                                  	;mov	[previous_val], ax
  2683                                  	;mov	ebx, eax
  2684                                  	;xor	eax, eax
  2685 00001321 31DB                    	xor	ebx, ebx
  2686 00001323 49                      	dec	ecx
  2687 00001324 7403                    	jz	short lff24m2_2
  2688                                  	;mov	ax, [esi]
  2689 00001326 668B1E                  	mov	bx, [esi]
  2690                                  lff24m2_2:
  2691                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  2692                                  	;mov	ebp, eax	; [next_val]
  2693                                  	;add	ax, [previous_val]
  2694                                  	; ax = [previous_val]
  2695                                  	; bx = [next_val]
  2696 00001329 6601D8                  	add	ax, bx
  2697 0000132C 66D1D8                  	rcr	ax, 1
  2698 0000132F 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2699 00001332 66AB                    	stosw		; this is interpolated sample (L)
  2700 00001334 66AB                    	stosw		; this is interpolated sample (R)
  2701                                  	; 24 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2702 00001336 09C9                    	or	ecx, ecx
  2703 00001338 75DE                    	jnz	short lff24m2_1
  2704 0000133A E9ACF8FFFF              	jmp	lff24_3
  2705                                  
  2706                                  lff24m2_7:
  2707                                  lff24s2_7:
  2708 0000133F E9C8F8FFFF              	jmp	lff24_5  ; error
  2709                                  
  2710                                  load_24khz_stereo_16_bit:
  2711                                  	; 16/11/2023
  2712                                  	; 15/11/2023
  2713 00001344 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2714                                  					; last of the file?
  2715 0000134B 7402                    	jz	short lff24s2_0		; no
  2716 0000134D F9                      	stc
  2717 0000134E C3                      	retn
  2718                                  
  2719                                  lff24s2_0:
  2720                                  	; 01/12/2024
  2721                                  	; edi = audio buffer address
  2722 0000134F BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2723                                          ;mov	edx, [loadsize]
  2724                                  
  2725                                  	; esi = buffer address
  2726                                  	;; edx = buffer size
  2727                                  
  2728                                  	; load file into memory
  2729                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001354 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000135A 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000135C 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001362 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001367 CD40                <1>  int 40h
  2730 00001369 72D4                    	jc	short lff24s2_7 ; error !
  2731                                  
  2732                                  	; 01/12/2024
  2733 0000136B A3[78730000]            	mov	[count], eax
  2734                                  	;;;
  2735                                  	; 07/12/2024
  2736                                  	;mov	edi, audio_buffer
  2737                                  	;;;
  2738 00001370 C1E802                  	shr	eax, 2
  2739 00001373 7505                    	jnz	short lff24s2_8
  2740 00001375 E989F8FFFF              	jmp	lff24_eof
  2741                                  
  2742                                  lff24s2_8:
  2743 0000137A 89C1                    	mov	ecx, eax  ; dword count
  2744                                  lff24s2_1:
  2745 0000137C 66AD                    	lodsw
  2746 0000137E 66AB                    	stosw		; original sample (L)
  2747 00001380 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2748 00001383 66A3[58210000]          	mov	[previous_val_l], ax
  2749 00001389 66AD                    	lodsw
  2750 0000138B 66AB                    	stosw		; original sample (R)
  2751 0000138D 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2752                                  	;mov	[previous_val_r], ax
  2753 00001390 89C3                    	mov	ebx, eax
  2754 00001392 31D2                    	xor	edx, edx
  2755 00001394 31C0                    	xor	eax, eax
  2756                                  	; 16/11/2023
  2757 00001396 49                      	dec	ecx
  2758 00001397 7407                    	jz	short lff24s2_2
  2759 00001399 668B06                  	mov	ax, [esi]
  2760 0000139C 668B5602                	mov	dx, [esi+2]
  2761                                  lff24s2_2:
  2762 000013A0 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  2763                                  	;;mov	[next_val_l], ax
  2764                                  	;mov	ebp, eax
  2765 000013A3 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  2766                                  	;mov	[next_val_r], dx
  2767 000013A6 660305[58210000]        	add	ax, [previous_val_l]
  2768 000013AD 66D1D8                  	rcr	ax, 1
  2769 000013B0 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  2770 000013B3 66AB                    	stosw		; this is interpolated sample (L)
  2771                                  	;mov	ax, [next_val_r]
  2772 000013B5 89D0                    	mov	eax, edx
  2773                                  	;add	ax, [previous_val_r]
  2774 000013B7 6601D8                  	add	ax, bx
  2775 000013BA 66D1D8                  	rcr	ax, 1
  2776 000013BD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  2777 000013C0 66AB                    	stosw		; this is interpolated sample (R)
  2778                                  	
  2779                                  	; 24 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2780 000013C2 09C9                    	or	ecx, ecx
  2781 000013C4 75B6                    	jnz	short lff24s2_1
  2782 000013C6 E920F8FFFF              	jmp	lff24_3
  2783                                  
  2784                                  ; .....................
  2785                                  
  2786                                  load_32khz_mono_8_bit:
  2787                                  	; 15/11/2023
  2788 000013CB F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2789                                  					; last of the file?
  2790 000013D2 7402                    	jz	short lff32m_0		; no
  2791 000013D4 F9                      	stc
  2792 000013D5 C3                      	retn
  2793                                  
  2794                                  lff32m_0:
  2795                                  	; 01/12/2024
  2796                                  	; edi = audio buffer address
  2797 000013D6 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2798                                          ;mov	edx, [loadsize]
  2799                                  
  2800                                  	; esi = buffer address
  2801                                  	;; edx = buffer size
  2802                                  
  2803                                  	; load file into memory
  2804                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000013DB 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000013E1 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000013E3 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000013E9 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000013EE CD40                <1>  int 40h
  2805 000013F0 7247                    	jc	short lff32m_7 ; error !
  2806                                  
  2807                                  	; 01/12/2024
  2808 000013F2 A3[78730000]            	mov	[count], eax
  2809                                  	;;;
  2810                                  	; 07/12/2024
  2811                                  	;mov	edi, audio_buffer
  2812                                  	;;;
  2813 000013F7 21C0                    	and	eax, eax
  2814 000013F9 7505                    	jnz	short lff32m_8
  2815 000013FB E903F8FFFF              	jmp	lff32_eof
  2816                                  
  2817                                  lff32m_8:
  2818 00001400 89C1                    	mov	ecx, eax	; byte count
  2819                                  lff32m_1:
  2820 00001402 AC                      	lodsb
  2821                                  	;mov	[previous_val], al
  2822 00001403 88C3                    	mov	bl, al
  2823 00001405 2C80                    	sub	al, 80h
  2824 00001407 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2825 0000140B 66AB                    	stosw		; original sample (left channel)
  2826 0000140D 66AB                    	stosw		; original sample (right channel)
  2827                                  	;xor	eax, eax
  2828 0000140F B080                    	mov	al, 80h
  2829 00001411 49                      	dec	ecx
  2830 00001412 7402                    	jz	short lff32m_2
  2831 00001414 8A06                    	mov	al, [esi]
  2832                                  lff32m_2:
  2833                                  	;;mov	[next_val], al
  2834                                  	;mov	bh, al
  2835                                  	;add	al, [previous_val]
  2836 00001416 00D8                    	add	al, bl
  2837 00001418 D0D8                    	rcr	al, 1
  2838 0000141A 2C80                    	sub	al, 80h
  2839 0000141C 66C1E008                	shl	ax, 8
  2840 00001420 66AB                    	stosw		; this is interpolated sample (L)
  2841 00001422 66AB                    	stosw		; this is interpolated sample (R)
  2842                                  	
  2843                                  	; different than 8-16-24 kHZ !
  2844                                  	; 'original-interpolated-original' trio samples
  2845 00001424 E30E                    	jecxz	lff32m_3
  2846                                  
  2847 00001426 AC                      	lodsb
  2848 00001427 2C80                    	sub	al, 80h
  2849 00001429 66C1E008                	shl	ax, 8
  2850 0000142D 66AB                    	stosw		; original sample (left channel)
  2851 0000142F 66AB                    	stosw		; original sample (right channel)
  2852                                  
  2853                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  2854 00001431 49                      	dec	ecx
  2855 00001432 75CE                    	jnz	short lff32m_1
  2856                                  lff32m_3:
  2857 00001434 E9B2F7FFFF              	jmp	lff32_3
  2858                                  
  2859                                  lff32m_7:
  2860                                  lff32s_7:
  2861 00001439 E9CEF7FFFF              	jmp	lff32_5  ; error
  2862                                  
  2863                                  load_32khz_stereo_8_bit:
  2864                                  	; 15/11/2023
  2865 0000143E F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2866                                  					; last of the file?
  2867 00001445 7402                    	jz	short lff32s_0		; no
  2868 00001447 F9                      	stc
  2869 00001448 C3                      	retn
  2870                                  
  2871                                  lff32s_0:
  2872                                  	; 01/12/2024
  2873                                  	; edi = audio buffer address
  2874 00001449 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2875                                          ;mov	edx, [loadsize]
  2876                                  
  2877                                  	; esi = buffer address
  2878                                  	;; edx = buffer size
  2879                                  
  2880                                  	; load file into memory
  2881                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000144E 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001454 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001456 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000145C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001461 CD40                <1>  int 40h
  2882 00001463 72D4                    	jc	short lff32s_7 ; error !
  2883                                  
  2884                                  	; 01/12/2024
  2885 00001465 A3[78730000]            	mov	[count], eax
  2886                                  	;;;
  2887                                  	; 07/12/2024
  2888                                  	;mov	edi, audio_buffer
  2889                                  	;;;
  2890 0000146A D1E8                    	shr	eax, 1
  2891 0000146C 7505                    	jnz	short lff32s_8
  2892 0000146E E990F7FFFF              	jmp	lff32_eof
  2893                                  
  2894                                  lff32s_8:
  2895 00001473 89C1                    	mov	ecx, eax  ; word count
  2896                                  lff32s_1:
  2897 00001475 AC                      	lodsb
  2898 00001476 A2[58210000]            	mov	[previous_val_l], al
  2899 0000147B 2C80                    	sub	al, 80h
  2900 0000147D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2901 00001481 66AB                    	stosw		; original sample (L)
  2902 00001483 AC                      	lodsb
  2903 00001484 A2[5A210000]            	mov	[previous_val_r], al
  2904 00001489 2C80                    	sub	al, 80h
  2905 0000148B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  2906 0000148F 66AB                    	stosw		; original sample (R)
  2907                                  
  2908                                  	;xor	eax, eax
  2909 00001491 66B88080                	mov	ax, 8080h
  2910 00001495 49                      	dec	ecx
  2911 00001496 7403                    	jz	short lff32s_2
  2912                                  		; convert 8 bit sample to 16 bit sample
  2913 00001498 668B06                  	mov	ax, [esi]
  2914                                  lff32s_2:
  2915                                  	;;mov	[next_val_l], al
  2916                                  	;;mov	[next_val_r], ah
  2917                                  	;mov	bx, ax
  2918 0000149B 88E7                    	mov	bh, ah
  2919 0000149D 0205[58210000]          	add	al, [previous_val_l]
  2920 000014A3 D0D8                    	rcr	al, 1
  2921                                  	;mov	dl, al
  2922 000014A5 2C80                    	sub	al, 80h
  2923 000014A7 66C1E008                	shl	ax, 8
  2924 000014AB 66AB                    	stosw		; this is interpolated sample (L)
  2925 000014AD 88F8                    	mov	al, bh	; [next_val_r]
  2926 000014AF 0205[5A210000]          	add	al, [previous_val_r]
  2927 000014B5 D0D8                    	rcr	al, 1
  2928                                  	;mov	dh, al
  2929 000014B7 2C80                    	sub	al, 80h
  2930 000014B9 66C1E008                	shl	ax, 8
  2931 000014BD 66AB                    	stosw		; this is interpolated sample (R)
  2932                                  
  2933                                  	; different than 8-16-24 kHZ !
  2934                                  	; 'original-interpolated-original' trio samples
  2935 000014BF E315                    	jecxz	lff32s_3
  2936                                  
  2937 000014C1 AC                      	lodsb
  2938 000014C2 2C80                    	sub	al, 80h
  2939 000014C4 66C1E008                	shl	ax, 8
  2940 000014C8 66AB                    	stosw		; original sample (left channel)
  2941                                  
  2942 000014CA AC                      	lodsb
  2943 000014CB 2C80                    	sub	al, 80h
  2944 000014CD 66C1E008                	shl	ax, 8
  2945 000014D1 66AB                    	stosw		; original sample (right channel)
  2946                                  		
  2947                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  2948 000014D3 49                      	dec	ecx
  2949 000014D4 759F                    	jnz	short lff32s_1
  2950                                  lff32s_3:
  2951 000014D6 E910F7FFFF              	jmp	lff32_3
  2952                                  
  2953                                  load_32khz_mono_16_bit:
  2954                                  	; 15/11/2023
  2955 000014DB F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  2956                                  					; last of the file?
  2957 000014E2 7402                    	jz	short lff32m2_0		; no
  2958 000014E4 F9                      	stc
  2959 000014E5 C3                      	retn
  2960                                  
  2961                                  lff32m2_0:
  2962                                  	; 01/12/2024
  2963                                  	; edi = audio buffer address
  2964 000014E6 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  2965                                          ;mov	edx, [loadsize]
  2966                                  
  2967                                  	; esi = buffer address
  2968                                  	;; edx = buffer size
  2969                                  
  2970                                  	; load file into memory
  2971                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000014EB 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000014F1 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000014F3 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000014F9 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000014FE CD40                <1>  int 40h
  2972 00001500 723E                    	jc	short lff32m2_7 ; error !
  2973                                  
  2974                                  	; 01/12/2024
  2975 00001502 A3[78730000]            	mov	[count], eax
  2976                                  	;;;
  2977                                  	; 07/12/2024
  2978                                  	;mov	edi, audio_buffer
  2979                                  	;;;
  2980 00001507 D1E8                    	shr	eax, 1
  2981 00001509 7505                    	jnz	short lff32m2_8
  2982 0000150B E9F3F6FFFF              	jmp	lff32_eof
  2983                                  
  2984                                  lff32m2_8:
  2985 00001510 89C1                    	mov	ecx, eax  ; word count
  2986                                  lff32m2_1:
  2987 00001512 66AD                    	lodsw
  2988 00001514 66AB                    	stosw		; original sample (left channel)
  2989 00001516 66AB                    	stosw		; original sample (right channel)
  2990 00001518 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  2991                                  	;mov	[previous_val], ax
  2992                                  	;mov	ebx, eax
  2993                                  	;xor	eax, eax
  2994 0000151B 31DB                    	xor	ebx, ebx
  2995 0000151D 49                      	dec	ecx
  2996 0000151E 7403                    	jz	short lff32m2_2
  2997                                  	;mov	ax, [esi]
  2998 00001520 668B1E                  	mov	bx, [esi]
  2999                                  lff32m2_2:
  3000                                  	;add	ah, 80h ; convert sound level 0 to 65535 format
  3001                                  	;mov	ebp, eax ; [next_val]
  3002                                  	;add	ax, [previous_val]
  3003                                  	; ax = [previous_val]
  3004                                  	; bx = [next_val]
  3005 00001523 6601D8                  	add	ax, bx
  3006 00001526 66D1D8                  	rcr	ax, 1
  3007 00001529 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3008 0000152C 66AB                    	stosw		; this is interpolated sample (L)
  3009 0000152E 66AB                    	stosw		; this is interpolated sample (R)
  3010                                  
  3011                                  	; different than 8-16-24 kHZ !
  3012                                  	; 'original-interpolated-original' trio samples 
  3013 00001530 E309                    	jecxz	lff32m2_3
  3014                                  
  3015 00001532 66AD                    	lodsw
  3016 00001534 66AB                    	stosw		; original sample (left channel)
  3017 00001536 66AB                    	stosw		; original sample (right channel)
  3018                                  
  3019                                  	; 32 kHZ mono to 48 kHZ stereo conversion of the sample is OK
  3020 00001538 49                      	dec	ecx
  3021 00001539 75D7                    	jnz	short lff32m2_1
  3022                                  lff32m2_3:
  3023 0000153B E9ABF6FFFF              	jmp	lff32_3
  3024                                  
  3025                                  lff32m2_7:
  3026                                  lff32s2_7:
  3027 00001540 E9C7F6FFFF              	jmp	lff32_5  ; error
  3028                                  
  3029                                  load_32khz_stereo_16_bit:
  3030                                  	; 16/11/2023
  3031                                  	; 15/11/2023
  3032 00001545 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3033                                  					; last of the file?
  3034 0000154C 7402                    	jz	short lff32s2_0		; no
  3035 0000154E F9                      	stc
  3036 0000154F C3                      	retn
  3037                                  
  3038                                  lff32s2_0:
  3039                                  	; 01/12/2024
  3040                                  	; edi = audio buffer address
  3041 00001550 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3042                                          ;mov	edx, [loadsize]
  3043                                  
  3044                                  	; esi = buffer address
  3045                                  	;; edx = buffer size
  3046                                  
  3047                                  	; load file into memory
  3048                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001555 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000155B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000155D 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001563 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001568 CD40                <1>  int 40h
  3049 0000156A 72D4                    	jc	short lff32s2_7 ; error !
  3050                                  
  3051                                  	; 01/12/2024
  3052 0000156C A3[78730000]            	mov	[count], eax
  3053                                  	;;;
  3054                                  	; 07/12/2024
  3055                                  	;mov	edi, audio_buffer
  3056                                  	;;;
  3057 00001571 C1E802                  	shr	eax, 2
  3058 00001574 7505                    	jnz	short lff32s2_8
  3059 00001576 E988F6FFFF              	jmp	lff32_eof
  3060                                  
  3061                                  lff32s2_8:
  3062 0000157B 89C1                    	mov	ecx, eax ; dword count
  3063                                  lff32s2_1:
  3064 0000157D 66AD                    	lodsw
  3065 0000157F 66AB                    	stosw		; original sample (L)
  3066 00001581 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3067 00001584 66A3[58210000]          	mov	[previous_val_l], ax
  3068 0000158A 66AD                    	lodsw
  3069 0000158C 66AB                    	stosw		; original sample (R)
  3070 0000158E 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format 
  3071                                  	;mov	[previous_val_r], ax
  3072 00001591 89C3                    	mov	ebx, eax
  3073 00001593 31D2                    	xor	edx, edx
  3074 00001595 31C0                    	xor	eax, eax
  3075                                  	; 16/11/2023
  3076 00001597 49                      	dec	ecx
  3077 00001598 7407                    	jz	short lff32s2_2
  3078 0000159A 668B06                  	mov	ax, [esi]
  3079 0000159D 668B5602                	mov	dx, [esi+2]
  3080                                  lff32s2_2:
  3081 000015A1 80C480                  	add	ah, 80h	; convert sound level 0 to 65535 format
  3082                                  	;;mov	[next_val_l], ax
  3083                                  	;mov	ebp, eax
  3084 000015A4 80C680                  	add	dh, 80h	; convert sound level 0 to 65535 format
  3085                                  	;mov	[next_val_r], dx
  3086 000015A7 660305[58210000]        	add	ax, [previous_val_l]
  3087 000015AE 66D1D8                  	rcr	ax, 1
  3088 000015B1 80EC80                  	sub	ah, 80h ; -32768 to +32767 format again
  3089 000015B4 66AB                    	stosw		; this is interpolated sample (L)
  3090                                  	;mov	ax, [next_val_r]
  3091 000015B6 89D0                    	mov	eax, edx
  3092                                  	;add	ax, [previous_val_r]
  3093 000015B8 6601D8                  	add	ax, bx
  3094 000015BB 66D1D8                  	rcr	ax, 1
  3095 000015BE 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  3096 000015C1 66AB                    	stosw		; this is interpolated sample (R)
  3097                                  
  3098                                  	; different than 8-16-24 kHZ !
  3099                                  	; 'original-interpolated-original' trio samples
  3100 000015C3 E30B                    	jecxz	lff32s2_3
  3101                                  
  3102 000015C5 66AD                    	lodsw
  3103 000015C7 66AB                    	stosw	; original sample (L)
  3104 000015C9 66AD                    	lodsw
  3105 000015CB 66AB                    	stosw	; original sample (R)
  3106                                  	
  3107                                  	; 32 kHZ stereo to 48 kHZ stereo conversion of the sample is OK
  3108 000015CD 49                      	dec	ecx
  3109 000015CE 75AD                    	jnz	short lff32s2_1
  3110                                  lff32s2_3:
  3111 000015D0 E916F6FFFF              	jmp	lff32_3
  3112                                  
  3113                                  ; .....................
  3114                                  
  3115                                  load_22khz_mono_8_bit:
  3116                                  	; 16/11/2023
  3117 000015D5 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3118                                  					; last of the file?
  3119 000015DC 7402                    	jz	short lff22m_0		; no
  3120 000015DE F9                      	stc
  3121 000015DF C3                      	retn
  3122                                  
  3123                                  lff22m_0:
  3124                                  	; 01/12/2024
  3125                                  	; edi = audio buffer address
  3126 000015E0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3127                                          ;mov	edx, [loadsize]
  3128                                  
  3129                                  	; esi = buffer address
  3130                                  	;; edx = buffer size
  3131                                  
  3132                                  	; load file into memory
  3133                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000015E5 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000015EB 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000015ED 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000015F3 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000015F8 CD40                <1>  int 40h
  3134 000015FA 725D                    	jc	short lff22m_7 ; error !
  3135                                  
  3136                                  	; 01/12/2024
  3137 000015FC A3[78730000]            	mov	[count], eax
  3138                                  	;;;
  3139                                  	; 07/12/2024
  3140                                  	;mov	edi, audio_buffer
  3141                                  	;;;
  3142 00001601 21C0                    	and	eax, eax
  3143 00001603 7505                    	jnz	short lff22m_8
  3144 00001605 E9F9F5FFFF              	jmp	lff22_eof
  3145                                  
  3146                                  lff22m_8:
  3147 0000160A 89C1                    	mov	ecx, eax	; byte count
  3148                                  lff22m_9:
  3149 0000160C BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3150 00001611 C605[60210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3151                                  lff22m_1:
  3152                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3153 00001618 AC                      	lodsb
  3154 00001619 B280                    	mov	dl, 80h
  3155 0000161B 49                      	dec	ecx
  3156 0000161C 7402                    	jz	short lff22m_2_1
  3157 0000161E 8A16                    	mov	dl, [esi]
  3158                                  lff22m_2_1:	
  3159                                  	; al = [previous_val]
  3160                                  	; dl = [next_val]
  3161 00001620 E8EF050000              	call	interpolating_3_8bit_mono ; 1 of 17
  3162 00001625 E32D                    	jecxz	lff22m_3
  3163                                  lff22m_2_2:
  3164 00001627 AC                      	lodsb
  3165 00001628 B280                    	mov	dl, 80h
  3166 0000162A 49                      	dec	ecx
  3167 0000162B 7402                    	jz	short lff22m_2_3
  3168 0000162D 8A16                    	mov	dl, [esi]
  3169                                  lff22m_2_3:
  3170 0000162F E864060000               	call	interpolating_2_8bit_mono ; 2 of 17 .. 6 of 17
  3171 00001634 E31E                    	jecxz	lff22m_3
  3172 00001636 4D                      	dec	ebp
  3173 00001637 75EE                    	jnz	short lff22m_2_2
  3174                                  
  3175 00001639 A0[60210000]            	mov	al, [faz]
  3176 0000163E FEC8                    	dec	al
  3177 00001640 74CA                    	jz	short lff22m_9
  3178 00001642 FE0D[60210000]          	dec	byte [faz]
  3179 00001648 BD04000000              	mov	ebp, 4
  3180 0000164D FEC8                    	dec	al
  3181 0000164F 75C7                    	jnz	short lff22m_1 ; 3:2:2:2:2 ; 7-11 of 17
  3182 00001651 45                      	inc	ebp ; 5
  3183 00001652 EBC4                    	jmp	short lff22m_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3184                                  
  3185                                  lff22m_3:
  3186                                  lff22s_3:
  3187 00001654 E992F5FFFF              	jmp	lff22_3	; padfill
  3188                                  		; (put zeros in the remain words of the buffer)
  3189                                  lff22m_7:
  3190                                  lff22s_7:
  3191 00001659 E9AEF5FFFF              	jmp	lff22_5  ; error
  3192                                  
  3193                                  load_22khz_stereo_8_bit:
  3194                                  	; 16/11/2023
  3195 0000165E F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3196                                  					; last of the file?
  3197 00001665 7402                    	jz	short lff22s_0		; no
  3198 00001667 F9                      	stc
  3199 00001668 C3                      	retn
  3200                                  
  3201                                  lff22s_0:
  3202                                  	; 01/12/2024
  3203                                  	; edi = audio buffer address
  3204 00001669 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3205                                          ;mov	edx, [loadsize]
  3206                                  
  3207                                  	; esi = buffer address
  3208                                  	;; edx = buffer size
  3209                                  
  3210                                  	; load file into memory
  3211                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000166E 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001674 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001676 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000167C B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001681 CD40                <1>  int 40h
  3212 00001683 72D4                    	jc	short lff22s_7 ; error !
  3213                                  
  3214                                  	; 01/12/2024
  3215 00001685 A3[78730000]            	mov	[count], eax
  3216                                  	;;;
  3217                                  	; 07/12/2024
  3218                                  	;mov	edi, audio_buffer
  3219                                  	;;;
  3220 0000168A D1E8                    	shr	eax, 1
  3221 0000168C 7505                    	jnz	short lff22s_8
  3222 0000168E E970F5FFFF              	jmp	lff22_eof
  3223                                  
  3224                                  lff22s_8:
  3225 00001693 89C1                    	mov	ecx, eax	; word count
  3226                                  lff22s_9:
  3227 00001695 BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3228 0000169A C605[60210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3229                                  lff22s_1:
  3230                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3231 000016A1 66AD                    	lodsw
  3232 000016A3 66BA8080                	mov	dx, 8080h
  3233 000016A7 49                      	dec	ecx
  3234 000016A8 7403                    	jz	short lff22s_2_1
  3235 000016AA 668B16                  	mov	dx, [esi]
  3236                                  lff22s_2_1:	
  3237                                  	; al = [previous_val_l]
  3238                                  	; ah = [previous_val_r]
  3239                                  	; dl = [next_val_l]
  3240                                  	; dh = [next_val_r]
  3241 000016AD E893050000              	call	interpolating_3_8bit_stereo ; 1 of 17
  3242 000016B2 E3A0                    	jecxz	lff22s_3
  3243                                  lff22s_2_2:
  3244 000016B4 66AD                    	lodsw
  3245 000016B6 66BA8080                	mov	dx, 8080h
  3246 000016BA 49                      	dec	ecx
  3247 000016BB 7403                    	jz	short lff22s_2_3
  3248 000016BD 668B16                  	mov	dx, [esi]
  3249                                  lff22s_2_3:
  3250 000016C0 E8F0050000               	call	interpolating_2_8bit_stereo ; 2 of 17 .. 6 of 17
  3251 000016C5 E38D                    	jecxz	lff22s_3
  3252 000016C7 4D                      	dec	ebp
  3253 000016C8 75EA                    	jnz	short lff22s_2_2
  3254                                  
  3255 000016CA A0[60210000]            	mov	al, [faz]
  3256 000016CF FEC8                    	dec	al
  3257 000016D1 74C2                    	jz	short lff22s_9
  3258 000016D3 FE0D[60210000]          	dec	byte [faz]
  3259 000016D9 BD04000000              	mov	ebp, 4
  3260 000016DE FEC8                    	dec	al
  3261 000016E0 75BF                    	jnz	short lff22s_1 ; 3:2:2:2:2 ; 7-11 of 17
  3262 000016E2 45                      	inc	ebp ; 5
  3263 000016E3 EBBC                    	jmp	short lff22s_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3264                                  
  3265                                  load_22khz_mono_16_bit:
  3266                                  	; 16/11/2023
  3267 000016E5 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3268                                  					; last of the file?
  3269 000016EC 7402                    	jz	short lff22m2_0		; no
  3270 000016EE F9                      	stc
  3271 000016EF C3                      	retn
  3272                                  
  3273                                  lff22m2_0:
  3274                                  	; 01/12/2024
  3275                                  	; edi = audio buffer address
  3276 000016F0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3277                                          ;mov	edx, [loadsize]
  3278                                  
  3279                                  	; esi = buffer address
  3280                                  	;; edx = buffer size
  3281                                  
  3282                                  	; load file into memory
  3283                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000016F5 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000016FB 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000016FD 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001703 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001708 CD40                <1>  int 40h
  3284 0000170A 7261                    	jc	short lff22m2_7 ; error !
  3285                                  
  3286                                  	; 01/12/2024
  3287 0000170C A3[78730000]            	mov	[count], eax
  3288                                  	;;;
  3289                                  	; 07/12/2024
  3290                                  	;mov	edi, audio_buffer
  3291                                  	;;;
  3292 00001711 D1E8                    	shr	eax, 1
  3293 00001713 7505                    	jnz	short lff22m2_8
  3294 00001715 E9E9F4FFFF              	jmp	lff22_eof
  3295                                  
  3296                                  lff22m2_8:
  3297 0000171A 89C1                    	mov	ecx, eax	; word count
  3298                                  lff22m2_9:
  3299 0000171C BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3300 00001721 C605[60210000]03        	mov	byte [faz], 3  ; 3 steps/phases
  3301                                  lff22m2_1:
  3302                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3303 00001728 66AD                    	lodsw
  3304 0000172A 31D2                    	xor	edx, edx
  3305 0000172C 49                      	dec	ecx
  3306 0000172D 7403                    	jz	short lff22m2_2_1
  3307 0000172F 668B16                  	mov	dx, [esi]
  3308                                  lff22m2_2_1:	
  3309                                  	; ax = [previous_val]
  3310                                  	; dx = [next_val]
  3311 00001732 E8AF050000              	call	interpolating_3_16bit_mono ; 1 of 17
  3312 00001737 E32F                    	jecxz	lff22m2_3
  3313                                  lff22m2_2_2:
  3314 00001739 66AD                    	lodsw
  3315 0000173B 31D2                    	xor	edx, edx
  3316 0000173D 49                      	dec	ecx
  3317 0000173E 7403                    	jz	short lff22m2_2_3
  3318 00001740 668B16                  	mov	dx, [esi]
  3319                                  lff22m2_2_3:
  3320 00001743 E831060000               	call	interpolating_2_16bit_mono ; 2 of 17 .. 6 of 17
  3321 00001748 E31E                    	jecxz	lff22m2_3
  3322 0000174A 4D                      	dec	ebp
  3323 0000174B 75EC                    	jnz	short lff22m2_2_2
  3324                                  
  3325 0000174D A0[60210000]            	mov	al, [faz]
  3326 00001752 FEC8                    	dec	al
  3327 00001754 74C6                    	jz	short lff22m2_9
  3328 00001756 FE0D[60210000]          	dec	byte [faz]
  3329 0000175C BD04000000              	mov	ebp, 4
  3330 00001761 FEC8                    	dec	al
  3331 00001763 75C3                    	jnz	short lff22m2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3332 00001765 45                      	inc	ebp ; 5
  3333 00001766 EBC0                    	jmp	short lff22m2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3334                                  
  3335                                  lff22m2_3:
  3336                                  lff22s2_3:
  3337 00001768 E97EF4FFFF              	jmp	lff22_3	; padfill
  3338                                  		; (put zeros in the remain words of the buffer)
  3339                                  lff22m2_7:
  3340                                  lff22s2_7:
  3341 0000176D E99AF4FFFF              	jmp	lff22_5  ; error
  3342                                  
  3343                                  load_22khz_stereo_16_bit:
  3344                                  	; 16/11/2023
  3345 00001772 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3346                                  					; last of the file?
  3347 00001779 7402                    	jz	short lff22s2_0		; no
  3348 0000177B F9                      	stc
  3349 0000177C C3                      	retn
  3350                                  
  3351                                  lff22s2_0:
  3352                                  	; 01/12/2024
  3353                                  	; edi = audio buffer address
  3354 0000177D BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3355                                          ;mov	edx, [loadsize]
  3356                                  
  3357                                  	; esi = buffer address
  3358                                  	;; edx = buffer size
  3359                                  
  3360                                  	; load file into memory
  3361                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001782 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001788 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000178A 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001790 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001795 CD40                <1>  int 40h
  3362 00001797 72D4                    	jc	short lff22s2_7 ; error !
  3363                                  
  3364                                  	; 01/12/2024
  3365 00001799 A3[78730000]            	mov	[count], eax
  3366                                  	;;;
  3367                                  	; 07/12/2024
  3368                                  	;mov	edi, audio_buffer
  3369                                  	;;;
  3370 0000179E C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3371 000017A1 7505                    	jnz	short lff22s2_8
  3372 000017A3 E95BF4FFFF              	jmp	lff22_eof
  3373                                  
  3374                                  lff22s2_8:
  3375 000017A8 89C1                    	mov	ecx, eax	; dword count
  3376                                  lff22s2_9:
  3377 000017AA BD05000000              	mov	ebp, 5 ; interpolation (one step) loop count
  3378 000017AF C605[60210000]03        	mov	byte [faz], 3  ; 3 steps/phase
  3379                                  lff22s2_1:
  3380                                  	; 3:2:2:2:2:2::3:2:2:2:2::3:2:2:2:2:2  ; 37/17
  3381 000017B6 66AD                    	lodsw
  3382 000017B8 89C3                    	mov	ebx, eax
  3383 000017BA 66AD                    	lodsw
  3384 000017BC 8B16                    	mov	edx, [esi]
  3385 000017BE 668915[5C210000]        	mov	[next_val_l], dx
  3386                                  	; 26/11/2023
  3387 000017C5 C1EA10                  	shr	edx, 16
  3388 000017C8 49                      	dec	ecx
  3389 000017C9 7509                    	jnz	short lff22s2_2_1
  3390 000017CB 31D2                    	xor	edx, edx ; 0
  3391 000017CD 668915[5C210000]        	mov	[next_val_l], dx
  3392                                  lff22s2_2_1:
  3393                                  	; bx = [previous_val_l]
  3394                                  	; ax = [previous_val_r]
  3395                                  	; [next_val_l]
  3396                                  	; dx = [next_val_r]
  3397 000017D4 E83D050000              	call	interpolating_3_16bit_stereo ; 1 of 17 
  3398 000017D9 E38D                    	jecxz	lff22s2_3
  3399                                  lff22s2_2_2:
  3400 000017DB 66AD                    	lodsw
  3401 000017DD 89C3                    	mov	ebx, eax
  3402 000017DF 66AD                    	lodsw
  3403 000017E1 8B16                    	mov	edx, [esi]
  3404 000017E3 668915[5C210000]        	mov	[next_val_l], dx
  3405                                  	; 26/11/2023
  3406 000017EA C1EA10                  	shr	edx, 16
  3407 000017ED 49                      	dec	ecx
  3408 000017EE 7509                    	jnz	short lff22s2_2_3
  3409 000017F0 31D2                    	xor	edx, edx ; 0
  3410 000017F2 668915[5C210000]        	mov	[next_val_l], dx
  3411                                  lff22s2_2_3:
  3412 000017F9 E893050000               	call	interpolating_2_16bit_stereo ; 2 of 17 .. 6 of 17
  3413 000017FE E31E                    	jecxz	lff22s2_2_4
  3414                                  
  3415 00001800 4D                      	dec	ebp
  3416 00001801 75D8                    	jnz	short lff22s2_2_2
  3417                                  
  3418 00001803 A0[60210000]            	mov	al, [faz]
  3419 00001808 FEC8                    	dec	al
  3420 0000180A 749E                    	jz	short lff22s2_9
  3421 0000180C FE0D[60210000]          	dec	byte [faz]
  3422 00001812 BD04000000              	mov	ebp, 4
  3423 00001817 FEC8                    	dec	al
  3424 00001819 759B                    	jnz	short lff22s2_1 ; 3:2:2:2:2 ; 7-11 of 17
  3425 0000181B 45                      	inc	ebp ; 5
  3426 0000181C EB98                    	jmp	short lff22s2_1 ; 3:2:2:2:2:2 ; 12-17 of 17
  3427                                  
  3428                                  lff22s2_2_4:
  3429                                  	; 26/11/2023
  3430 0000181E E9C8F3FFFF              	jmp	lff22_3	; padfill
  3431                                  
  3432                                  ; .....................
  3433                                  
  3434                                  load_11khz_mono_8_bit:
  3435                                  	; 18/11/2023
  3436 00001823 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3437                                  					; last of the file?
  3438 0000182A 7402                    	jz	short lff11m_0		; no
  3439 0000182C F9                      	stc
  3440 0000182D C3                      	retn
  3441                                  
  3442                                  lff11m_0:
  3443                                  	; 01/12/2024
  3444                                  	; edi = audio buffer address
  3445 0000182E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3446                                          ;mov	edx, [loadsize]
  3447                                  
  3448                                  	; esi = buffer address
  3449                                  	;; edx = buffer size
  3450                                  
  3451                                  	; load file into memory
  3452                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001833 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001839 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000183B 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001841 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001846 CD40                <1>  int 40h
  3453 00001848 7247                    	jc	short lff11m_7 ; error !
  3454                                  
  3455                                  	; 01/12/2024
  3456 0000184A A3[78730000]            	mov	[count], eax
  3457                                  	;;;
  3458                                  	; 07/12/2024
  3459                                  	;mov	edi, audio_buffer
  3460                                  	;;;
  3461 0000184F 21C0                    	and	eax, eax
  3462 00001851 7505                    	jnz	short lff11m_8
  3463 00001853 E9ABF3FFFF              	jmp	lff11_eof
  3464                                  
  3465                                  lff11m_8:
  3466 00001858 89C1                    	mov	ecx, eax		; byte count
  3467                                  lff11m_9:
  3468 0000185A BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3469                                  lff11m_1:
  3470                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3471 0000185F AC                      	lodsb
  3472 00001860 B280                    	mov	dl, 80h
  3473 00001862 49                      	dec	ecx
  3474 00001863 7402                    	jz	short lff11m_2_1
  3475 00001865 8A16                    	mov	dl, [esi]
  3476                                  lff11m_2_1:	
  3477                                  	; al = [previous_val]
  3478                                  	; dl = [next_val]
  3479 00001867 E854050000              	call	interpolating_5_8bit_mono
  3480 0000186C E328                    	jecxz	lff11m_3
  3481                                  lff11m_2_2:
  3482 0000186E AC                      	lodsb
  3483 0000186F B280                    	mov	dl, 80h
  3484 00001871 49                      	dec	ecx
  3485 00001872 7402                    	jz	short lff11m_2_3
  3486 00001874 8A16                    	mov	dl, [esi]
  3487                                  lff11m_2_3:
  3488 00001876 E851060000               	call	interpolating_4_8bit_mono
  3489 0000187B E319                    	jecxz	lff11m_3
  3490                                  
  3491 0000187D 4D                      	dec	ebp
  3492 0000187E 74DA                    	jz	short lff11m_9
  3493                                  
  3494 00001880 AC                      	lodsb
  3495 00001881 B280                    	mov	dl, 80h
  3496 00001883 49                      	dec	ecx
  3497 00001884 7402                    	jz	short lff11m_2_4
  3498 00001886 8A16                    	mov	dl, [esi]
  3499                                  lff11m_2_4:
  3500 00001888 E83F060000              	call	interpolating_4_8bit_mono
  3501 0000188D E307                    	jecxz	lff11m_3
  3502 0000188F EBCE                    	jmp	short lff11m_1
  3503                                  
  3504                                  lff11m_7:
  3505                                  lff11s_7:
  3506 00001891 E976F3FFFF              	jmp	lff11_5  ; error
  3507                                  
  3508                                  lff11m_3:
  3509                                  lff11s_3:
  3510 00001896 E950F3FFFF              	jmp	lff11_3	; padfill
  3511                                  		; (put zeros in the remain words of the buffer)
  3512                                  
  3513                                  load_11khz_stereo_8_bit:
  3514                                  	; 18/11/2023
  3515 0000189B F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3516                                  					; last of the file?
  3517 000018A2 7402                    	jz	short lff11s_0		; no
  3518 000018A4 F9                      	stc
  3519 000018A5 C3                      	retn
  3520                                  
  3521                                  lff11s_0:
  3522                                  	; 01/12/2024
  3523                                  	; edi = audio buffer address
  3524 000018A6 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3525                                          ;mov	edx, [loadsize]
  3526                                  
  3527                                  	; esi = buffer address
  3528                                  	;; edx = buffer size
  3529                                  
  3530                                  	; load file into memory
  3531                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000018AB 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000018B1 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000018B3 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000018B9 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000018BE CD40                <1>  int 40h
  3532 000018C0 72CF                    	jc	short lff11s_7 ; error !
  3533                                  
  3534                                  	; 01/12/2024
  3535 000018C2 A3[78730000]            	mov	[count], eax
  3536                                  	;;;
  3537                                  	; 07/12/2024
  3538                                  	;mov	edi, audio_buffer
  3539                                  	;;;
  3540 000018C7 D1E8                    	shr	eax, 1
  3541 000018C9 7505                    	jnz	short lff11s_8
  3542 000018CB E933F3FFFF              	jmp	lff11_eof
  3543                                  
  3544                                  lff11s_8:
  3545 000018D0 89C1                    	mov	ecx, eax	; word count
  3546                                  lff11s_9:
  3547 000018D2 BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3548                                  lff11s_1:
  3549                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3550 000018D7 66AD                    	lodsw
  3551 000018D9 66BA8080                	mov	dx, 8080h
  3552 000018DD 49                      	dec	ecx
  3553 000018DE 7403                    	jz	short lff11s_2_1
  3554 000018E0 668B16                  	mov	dx, [esi]
  3555                                  lff11s_2_1:	
  3556                                  	; al = [previous_val_l]
  3557                                  	; ah = [previous_val_r]
  3558                                  	; dl = [next_val_l]
  3559                                  	; dh = [next_val_r]
  3560 000018E3 E837050000              	call	interpolating_5_8bit_stereo
  3561 000018E8 E3AC                    	jecxz	lff11s_3
  3562                                  lff11s_2_2:
  3563 000018EA 66AD                    	lodsw
  3564 000018EC 66BA8080                	mov	dx, 8080h
  3565 000018F0 49                      	dec	ecx
  3566 000018F1 7403                    	jz	short lff11s_2_3
  3567 000018F3 668B16                  	mov	dx, [esi]
  3568                                  lff11s_2_3:
  3569 000018F6 E810060000               	call	interpolating_4_8bit_stereo
  3570 000018FB E399                    	jecxz	lff11s_3
  3571                                  	
  3572 000018FD 4D                      	dec	ebp
  3573 000018FE 74D2                    	jz	short lff11s_9
  3574                                  
  3575 00001900 66AD                    	lodsw
  3576 00001902 66BA8080                	mov	dx, 8080h
  3577 00001906 49                      	dec	ecx
  3578 00001907 7403                    	jz	short lff11s_2_4
  3579 00001909 668B16                  	mov	dx, [esi]
  3580                                  lff11s_2_4:
  3581 0000190C E8FA050000              	call	interpolating_4_8bit_stereo
  3582 00001911 E383                    	jecxz	lff11s_3
  3583 00001913 EBC2                    	jmp	short lff11s_1
  3584                                  
  3585                                  load_11khz_mono_16_bit:
  3586                                  	; 18/11/2023
  3587 00001915 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3588                                  					; last of the file?
  3589 0000191C 7402                    	jz	short lff11m2_0		; no
  3590 0000191E F9                      	stc
  3591 0000191F C3                      	retn
  3592                                  
  3593                                  lff11m2_0:
  3594                                  	; 01/12/2024
  3595                                  	; edi = audio buffer address
  3596 00001920 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3597                                          ;mov	edx, [loadsize]
  3598                                  
  3599                                  	; esi = buffer address
  3600                                  	;; edx = buffer size
  3601                                  
  3602                                  	; load file into memory
  3603                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001925 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 0000192B 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 0000192D 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001933 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001938 CD40                <1>  int 40h
  3604 0000193A 724D                    	jc	short lff11m2_7 ; error !
  3605                                  
  3606                                  	; 01/12/2024
  3607 0000193C A3[78730000]            	mov	[count], eax
  3608                                  	;;;
  3609                                  	; 07/12/2024
  3610                                  	;mov	edi, audio_buffer
  3611                                  	;;;
  3612 00001941 D1E8                    	shr	eax, 1
  3613 00001943 7505                    	jnz	short lff11m2_8
  3614 00001945 E9B9F2FFFF              	jmp	lff11_eof
  3615                                  
  3616                                  lff11m2_8:
  3617 0000194A 89C1                    	mov	ecx, eax	; word count
  3618                                  lff11m2_9:
  3619 0000194C BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3620                                  lff11m2_1:
  3621                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3622 00001951 66AD                    	lodsw
  3623 00001953 31D2                    	xor	edx, edx
  3624 00001955 49                      	dec	ecx
  3625 00001956 7403                    	jz	short lff11m2_2_1
  3626 00001958 668B16                  	mov	dx, [esi]
  3627                                  lff11m2_2_1:	
  3628                                  	; ax = [previous_val]
  3629                                  	; dx = [next_val]
  3630 0000195B E818060000              	call	interpolating_5_16bit_mono
  3631 00001960 E362                    	jecxz	lff11m2_3
  3632                                  lff11m2_2_2:
  3633 00001962 66AD                    	lodsw
  3634 00001964 31D2                    	xor	edx, edx
  3635 00001966 49                      	dec	ecx
  3636 00001967 7403                    	jz	short lff11m2_2_3
  3637 00001969 668B16                  	mov	dx, [esi]
  3638                                  lff11m2_2_3:
  3639 0000196C E831070000               	call	interpolating_4_16bit_mono
  3640 00001971 E351                    	jecxz	lff11m2_3
  3641                                  
  3642 00001973 4D                      	dec	ebp
  3643 00001974 74D6                    	jz	short lff11m2_9
  3644                                  
  3645 00001976 66AD                    	lodsw
  3646 00001978 31D2                    	xor	edx, edx
  3647 0000197A 49                      	dec	ecx
  3648 0000197B 7403                    	jz	short lff11m2_2_4
  3649 0000197D 668B16                  	mov	dx, [esi]
  3650                                  lff11m2_2_4:
  3651 00001980 E81D070000               	call	interpolating_4_16bit_mono
  3652 00001985 E33D                    	jecxz	lff11m2_3
  3653 00001987 EBC8                    	jmp	short lff11m2_1
  3654                                  
  3655                                  lff11m2_7:
  3656                                  lff11s2_7:
  3657 00001989 E97EF2FFFF              	jmp	lff11_5  ; error
  3658                                  
  3659                                  load_11khz_stereo_16_bit:
  3660                                  	; 17/01/2025
  3661                                  	; 18/11/2023
  3662 0000198E F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3663                                  					; last of the file?
  3664 00001995 7402                    	jz	short lff11s2_0		; no
  3665 00001997 F9                      	stc
  3666 00001998 C3                      	retn
  3667                                  
  3668                                  lff11s2_0:
  3669                                  	; 01/12/2024
  3670                                  	; edi = audio buffer address
  3671 00001999 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3672                                          ;mov	edx, [loadsize]
  3673                                  
  3674                                  	; esi = buffer address
  3675                                  	;; edx = buffer size
  3676                                  
  3677                                  	; load file into memory
  3678                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000199E 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000019A4 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000019A6 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000019AC B803000000          <1>  mov eax, %1
    97                              <1> 
    98 000019B1 CD40                <1>  int 40h
  3679 000019B3 72D4                    	jc	short lff11s2_7 ; error !
  3680                                  
  3681                                  	; 01/12/2024
  3682 000019B5 A3[78730000]            	mov	[count], eax
  3683                                  	;;;
  3684                                  	; 07/12/2024
  3685                                  	;mov	edi, audio_buffer
  3686                                  	;;;
  3687 000019BA C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  3688 000019BD 750A                    	jnz	short lff11s2_8
  3689 000019BF E93FF2FFFF              	jmp	lff11_eof
  3690                                  
  3691                                  lff11m2_3:
  3692                                  lff11s2_3:
  3693 000019C4 E922F2FFFF              	jmp	lff11_3	; padfill
  3694                                  		; (put zeros in the remain words of the buffer)
  3695                                  
  3696                                  lff11s2_8:
  3697 000019C9 89C1                    	mov	ecx, eax	; dword count
  3698                                  lff11s2_9:
  3699 000019CB BD06000000              	mov	ebp, 6 ; interpolation (one step) loop count
  3700                                  lff11s2_1:
  3701                                  	; 5:4:4::5:4:4::5:4:4::5:4:4::5:4:4::5:4  ; 74/17
  3702 000019D0 66AD                    	lodsw
  3703 000019D2 89C3                    	mov	ebx, eax
  3704 000019D4 66AD                    	lodsw
  3705 000019D6 8B16                    	mov	edx, [esi]
  3706                                  	; 17/01/2025
  3707                                  	;mov	[next_val_l], edx
  3708                                  	; 26/11/2023
  3709                                  	;shr	edx, 16
  3710                                  	;mov	[next_val_r], dx
  3711 000019D8 49                      	dec	ecx
  3712 000019D9 7502                    	jnz	short lff11s2_2_1
  3713 000019DB 31D2                    	xor	edx, edx ; 0
  3714                                  	;mov	[next_val_l], dx
  3715                                  	;mov	[next_val_r], dx
  3716                                  lff11s2_2_1:
  3717                                  	; bx = [previous_val_l]
  3718                                  	; ax = [previous_val_r]
  3719                                  	; [next_val_l]
  3720                                  	; dx = [next_val_r]
  3721                                  	;;;
  3722                                  	; 17/01/2025 (BugFix)
  3723 000019DD 8915[5C210000]          	mov	[next_val_l], edx
  3724                                  	;;;
  3725 000019E3 E8EB050000              	call	interpolating_5_16bit_stereo
  3726 000019E8 E3DA                    	jecxz	lff11s2_3
  3727                                  lff11s2_2_2:
  3728 000019EA 66AD                    	lodsw
  3729 000019EC 89C3                    	mov	ebx, eax
  3730 000019EE 66AD                    	lodsw
  3731 000019F0 8B16                    	mov	edx, [esi]
  3732                                  	; 17/01/2025
  3733                                  	;mov	[next_val_l], dx
  3734                                  	; 26/11/2023
  3735                                  	;shr	edx, 16
  3736                                  	;mov	[next_val_r], dx
  3737 000019F2 49                      	dec	ecx
  3738 000019F3 7502                    	jnz	short lff11s2_2_3
  3739 000019F5 31D2                    	xor	edx, edx ; 0
  3740                                  	;mov	[next_val_l], dx
  3741                                  	;mov	[next_val_r], dx
  3742                                  lff11s2_2_3:
  3743                                  	;;;
  3744                                  	; 17/01/2025 (BugFix)
  3745 000019F7 8915[5C210000]          	mov	[next_val_l], edx
  3746                                  	;;;
  3747 000019FD E8D9060000              	call	interpolating_4_16bit_stereo
  3748 00001A02 E3C0                    	jecxz	lff11s2_3
  3749                                  	
  3750 00001A04 4D                      	dec	ebp
  3751 00001A05 74C4                    	jz	short lff11s2_9
  3752                                  
  3753 00001A07 66AD                    	lodsw
  3754 00001A09 89C3                    	mov	ebx, eax
  3755 00001A0B 66AD                    	lodsw
  3756 00001A0D 8B16                    	mov	edx, [esi]
  3757                                  	; 17/01/2025
  3758                                  	;mov	[next_val_l], dx
  3759                                  	; 26/11/2023
  3760                                  	;shr	edx, 16
  3761                                  	;mov	[next_val_r], dx
  3762 00001A0F 49                      	dec	ecx
  3763 00001A10 7502                    	jnz	short lff11s2_2_4
  3764 00001A12 31D2                    	xor	edx, edx ; 0
  3765                                  	;mov	[next_val_l], dx
  3766                                  	;mov	[next_val_r], dx
  3767                                  lff11s2_2_4:
  3768                                  	;;;
  3769                                  	; 17/01/2025 (BugFix)
  3770 00001A14 8915[5C210000]          	mov	[next_val_l], edx
  3771                                  	;;;
  3772 00001A1A E8BC060000               	call	interpolating_4_16bit_stereo
  3773 00001A1F E3A3                    	jecxz	lff11s2_3
  3774 00001A21 EBAD                    	jmp	short lff11s2_1
  3775                                  
  3776                                  ; .....................
  3777                                  
  3778                                  load_44khz_mono_8_bit:
  3779                                  	; 18/11/2023
  3780 00001A23 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3781                                  					; last of the file?
  3782 00001A2A 7402                    	jz	short lff44m_0		; no
  3783 00001A2C F9                      	stc
  3784 00001A2D C3                      	retn
  3785                                  
  3786                                  lff44m_0:
  3787                                  	; 01/12/2024
  3788                                  	; edi = audio buffer address
  3789 00001A2E BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3790                                          ;mov	edx, [loadsize]
  3791                                  
  3792                                  	; esi = buffer address
  3793                                  	;; edx = buffer size
  3794                                  
  3795                                  	; load file into memory
  3796                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001A33 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001A39 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001A3B 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001A41 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001A46 CD40                <1>  int 40h
  3797 00001A48 7250                    	jc	short lff44m_7 ; error !
  3798                                  
  3799                                  	; 01/12/2024
  3800 00001A4A A3[78730000]            	mov	[count], eax
  3801                                  	;;;
  3802                                  	; 07/12/2024
  3803                                  	;mov	edi, audio_buffer
  3804                                  	;;;
  3805 00001A4F 21C0                    	and	eax, eax
  3806 00001A51 7505                    	jnz	short lff44m_8
  3807 00001A53 E9ABF1FFFF              	jmp	lff44_eof
  3808                                  
  3809                                  lff44m_8:
  3810 00001A58 89C1                    	mov	ecx, eax	; byte count
  3811                                  lff44m_9:
  3812 00001A5A BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3813 00001A5F C605[60210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3814                                  lff44m_1:
  3815                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3816                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3817 00001A66 AC                      	lodsb
  3818 00001A67 B280                    	mov	dl, 80h
  3819 00001A69 49                      	dec	ecx
  3820 00001A6A 7402                    	jz	short lff44m_2_1
  3821 00001A6C 8A16                    	mov	dl, [esi]
  3822                                  lff44m_2_1:	
  3823                                  	; al = [previous_val]
  3824                                  	; dl = [next_val]
  3825 00001A6E E825020000              	call	interpolating_2_8bit_mono
  3826 00001A73 E320                    	jecxz	lff44m_3
  3827                                  lff44m_2_2:
  3828 00001A75 AC                      	lodsb
  3829 00001A76 2C80                    	sub	al, 80h
  3830 00001A78 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3831 00001A7C 66AB                    	stosw		; (L)
  3832 00001A7E 66AB                    	stosw		; (R)
  3833                                  
  3834 00001A80 49                      	dec	ecx
  3835 00001A81 7412                    	jz	short lff44m_3
  3836 00001A83 4D                      	dec	ebp
  3837 00001A84 75EF                    	jnz	short lff44m_2_2
  3838                                  	
  3839 00001A86 FE0D[60210000]          	dec	byte [faz]
  3840 00001A8C 74CC                    	jz	short lff44m_9 
  3841 00001A8E BD0B000000              	mov	ebp, 11
  3842 00001A93 EBD1                    	jmp	short lff44m_1
  3843                                  
  3844                                  lff44m_3:
  3845                                  lff44s_3:
  3846 00001A95 E951F1FFFF              	jmp	lff44_3	; padfill
  3847                                  		; (put zeros in the remain words of the buffer)
  3848                                  lff44m_7:
  3849                                  lff44s_7:
  3850 00001A9A E96DF1FFFF              	jmp	lff44_5  ; error
  3851                                  
  3852                                  load_44khz_stereo_8_bit:
  3853                                  	; 16/11/2023
  3854 00001A9F F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3855                                  					; last of the file?
  3856 00001AA6 7402                    	jz	short lff44s_0		; no
  3857 00001AA8 F9                      	stc
  3858 00001AA9 C3                      	retn
  3859                                  
  3860                                  lff44s_0:
  3861                                  	; 01/12/2024
  3862                                  	; edi = audio buffer address
  3863 00001AAA BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3864                                          ;mov	edx, [loadsize]
  3865                                  
  3866                                  	; esi = buffer address
  3867                                  	;; edx = buffer size
  3868                                  
  3869                                  	; load file into memory
  3870                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001AAF 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001AB5 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001AB7 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001ABD B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001AC2 CD40                <1>  int 40h
  3871 00001AC4 72D4                    	jc	short lff44s_7 ; error !
  3872                                  
  3873                                  	; 01/12/2024
  3874 00001AC6 A3[78730000]            	mov	[count], eax
  3875                                  	;;;
  3876                                  	; 07/12/2024
  3877                                  	;mov	edi, audio_buffer
  3878                                  	;;;
  3879 00001ACB D1E8                    	shr	eax, 1
  3880 00001ACD 7505                    	jnz	short lff44s_8
  3881 00001ACF E92FF1FFFF              	jmp	lff44_eof
  3882                                  
  3883                                  lff44s_8:
  3884 00001AD4 89C1                    	mov	ecx, eax	; word count
  3885                                  lff44s_9:
  3886 00001AD6 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3887 00001ADB C605[60210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  3888                                  lff44s_1:
  3889                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3890                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3891 00001AE2 66AD                    	lodsw
  3892 00001AE4 66BA8080                	mov	dx, 8080h
  3893 00001AE8 49                      	dec	ecx
  3894 00001AE9 7403                    	jz	short lff44s_2_1
  3895 00001AEB 668B16                  	mov	dx, [esi]
  3896                                  lff44s_2_1:	
  3897                                  	; al = [previous_val_l]
  3898                                  	; ah = [previous_val_r]
  3899                                  	; dl = [next_val_l]
  3900                                  	; dh = [next_val_r]
  3901 00001AEE E8C2010000              	call	interpolating_2_8bit_stereo
  3902 00001AF3 E3A0                    	jecxz	lff44s_3
  3903                                  lff44s_2_2:
  3904 00001AF5 AC                      	lodsb
  3905 00001AF6 2C80                    	sub	al, 80h
  3906 00001AF8 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3907 00001AFC 66AB                    	stosw		; (L)
  3908 00001AFE AC                      	lodsb
  3909 00001AFF 2C80                    	sub	al, 80h
  3910 00001B01 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  3911 00001B05 66AB                    	stosw		; (R)
  3912                                  
  3913 00001B07 49                      	dec	ecx
  3914 00001B08 748B                    	jz	short lff44s_3	
  3915 00001B0A 4D                      	dec	ebp
  3916 00001B0B 75E8                    	jnz	short lff44s_2_2
  3917                                  	
  3918 00001B0D FE0D[60210000]          	dec	byte [faz]
  3919 00001B13 74C1                    	jz	short lff44s_9 
  3920 00001B15 BD0B000000              	mov	ebp, 11
  3921 00001B1A EBC6                    	jmp	short lff44s_1
  3922                                  
  3923                                  load_44khz_mono_16_bit:
  3924                                  	; 18/11/2023
  3925 00001B1C F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3926                                  					; last of the file?
  3927 00001B23 7402                    	jz	short lff44m2_0		; no
  3928 00001B25 F9                      	stc
  3929 00001B26 C3                      	retn
  3930                                  
  3931                                  lff44m2_0:
  3932                                  	; 01/12/2024
  3933                                  	; edi = audio buffer address
  3934 00001B27 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  3935                                          ;mov	edx, [loadsize]
  3936                                  
  3937                                  	; esi = buffer address
  3938                                  	;; edx = buffer size
  3939                                  
  3940                                  	; load file into memory
  3941                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001B2C 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001B32 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001B34 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001B3A B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001B3F CD40                <1>  int 40h
  3942 00001B41 724D                    	jc	short lff44m2_7 ; error !
  3943                                  
  3944                                  	; 01/12/2024
  3945 00001B43 A3[78730000]            	mov	[count], eax
  3946                                  	;;;
  3947                                  	; 07/12/2024
  3948                                  	;mov	edi, audio_buffer
  3949                                  	;;;
  3950 00001B48 D1E8                    	shr	eax, 1
  3951 00001B4A 7505                    	jnz	short lff44m2_8
  3952 00001B4C E9B2F0FFFF              	jmp	lff44_eof
  3953                                  
  3954                                  lff44m2_8:
  3955 00001B51 89C1                    	mov	ecx, eax	; word count
  3956                                  lff44m2_9:
  3957 00001B53 BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  3958 00001B58 C605[60210000]02        	mov	byte [faz], 2  ; 2 steps/phases
  3959                                  lff44m2_1:
  3960                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  3961                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  3962 00001B5F 66AD                    	lodsw
  3963 00001B61 31D2                    	xor	edx, edx
  3964 00001B63 49                      	dec	ecx
  3965 00001B64 7403                    	jz	short lff44m2_2_1
  3966 00001B66 668B16                  	mov	dx, [esi]
  3967                                  lff44m2_2_1:	
  3968                                  	; ax = [previous_val]
  3969                                  	; dx = [next_val]
  3970 00001B69 E80B020000              	call	interpolating_2_16bit_mono
  3971 00001B6E E31B                    	jecxz	lff44m2_3
  3972                                  lff44m2_2_2:
  3973 00001B70 66AD                    	lodsw
  3974 00001B72 66AB                    	stosw		; (L)eft Channel
  3975 00001B74 66AB                    	stosw		; (R)ight Channel
  3976                                  
  3977 00001B76 49                      	dec	ecx
  3978 00001B77 7412                    	jz	short lff44m2_3	
  3979 00001B79 4D                      	dec	ebp
  3980 00001B7A 75F4                    	jnz	short lff44m2_2_2
  3981                                  	
  3982 00001B7C FE0D[60210000]          	dec	byte [faz]
  3983 00001B82 74CF                    	jz	short lff44m2_9 
  3984 00001B84 BD0B000000              	mov	ebp, 11
  3985 00001B89 EBD4                    	jmp	short lff44m2_1
  3986                                  
  3987                                  lff44m2_3:
  3988                                  lff44s2_3:
  3989 00001B8B E95BF0FFFF              	jmp	lff44_3	; padfill
  3990                                  		; (put zeros in the remain words of the buffer)
  3991                                  lff44m2_7:
  3992                                  lff44s2_7:
  3993 00001B90 E977F0FFFF              	jmp	lff44_5  ; error
  3994                                  
  3995                                  load_44khz_stereo_16_bit:
  3996                                  	; 18/11/2023
  3997 00001B95 F605[FE720000]01                test    byte [flags], ENDOFFILE	; have we already read the
  3998                                  					; last of the file?
  3999 00001B9C 7402                    	jz	short lff44s2_0		; no
  4000 00001B9E F9                      	stc
  4001 00001B9F C3                      	retn
  4002                                  
  4003                                  lff44s2_0:
  4004                                  	; 01/12/2024
  4005                                  	; edi = audio buffer address
  4006 00001BA0 BE[00800100]            	mov	esi, temp_buffer ; temporary buffer for wav data
  4007                                          ;mov	edx, [loadsize]
  4008                                  
  4009                                  	; esi = buffer address
  4010                                  	;; edx = buffer size
  4011                                  
  4012                                  	; load file into memory
  4013                                  	sys 	_read, [filehandle], esi, [loadsize]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00001BA5 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 00001BAB 89F1                <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 00001BAD 8B15[68730000]      <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00001BB3 B803000000          <1>  mov eax, %1
    97                              <1> 
    98 00001BB8 CD40                <1>  int 40h
  4014 00001BBA 72D4                    	jc	short lff44s2_7 ; error !
  4015                                  
  4016                                  	; 01/12/2024
  4017 00001BBC A3[78730000]            	mov	[count], eax
  4018                                  	;;;
  4019                                  	; 07/12/2024
  4020                                  	;mov	edi, audio_buffer
  4021                                  	;;;
  4022 00001BC1 C1E802                  	shr	eax, 2	; dword (left chan word + right chan word)
  4023 00001BC4 7505                    	jnz	short lff44s2_8
  4024 00001BC6 E938F0FFFF              	jmp	lff44_eof
  4025                                  
  4026                                  lff44s2_8:
  4027 00001BCB 89C1                    	mov	ecx, eax	; dword count
  4028                                  lff44s2_9:
  4029 00001BCD BD0A000000              	mov	ebp, 10 ; interpolation (one step) loop count
  4030 00001BD2 C605[60210000]02        	mov	byte [faz], 2  ; 2 steps/phase
  4031                                  lff44s2_1:
  4032                                  	; 2:1:1:1:1:1:1:1:1:1:1::	; 25/23
  4033                                  	; 2:1:1:1:1:1:1:1:1:1:1:1
  4034 00001BD9 66AD                    	lodsw
  4035 00001BDB 89C3                    	mov	ebx, eax
  4036 00001BDD 66AD                    	lodsw
  4037                                  	;mov	dx, [esi]
  4038                                  	;mov	[next_val_l], dx
  4039                                  	;mov	dx, [esi+2]
  4040                                  	; 26/11/2023
  4041 00001BDF 8B16                    	mov	edx, [esi]
  4042 00001BE1 668915[5C210000]        	mov	[next_val_l], dx
  4043 00001BE8 C1EA10                  	shr	edx, 16
  4044 00001BEB 49                      	dec	ecx
  4045 00001BEC 7509                    	jnz	short lff44s2_2_1
  4046 00001BEE 31D2                    	xor	edx, edx ; 0
  4047 00001BF0 668915[5C210000]        	mov	[next_val_l], dx
  4048                                  lff44s2_2_1:
  4049                                  	; bx = [previous_val_l]
  4050                                  	; ax = [previous_val_r]
  4051                                  	; [next_val_l]
  4052                                  	; dx = [next_val_r]
  4053 00001BF7 E895010000              	call	interpolating_2_16bit_stereo
  4054 00001BFC E38D                    	jecxz	lff44s2_3
  4055                                  lff44s2_2_2:
  4056                                  	;movsw		; (L)eft Channel
  4057                                  	;movsw		; (R)ight Channel
  4058 00001BFE A5                      	movsd
  4059                                  
  4060 00001BFF 49                      	dec	ecx
  4061 00001C00 7489                    	jz	short lff44s2_3	
  4062 00001C02 4D                      	dec	ebp
  4063 00001C03 75F9                    	jnz	short lff44s2_2_2
  4064                                  	
  4065 00001C05 FE0D[60210000]          	dec	byte [faz]
  4066 00001C0B 74C0                    	jz	short lff44s2_9 
  4067 00001C0D BD0B000000              	mov	ebp, 11
  4068 00001C12 EBC5                    	jmp	short lff44s2_1
  4069                                  
  4070                                  ; .....................
  4071                                  
  4072                                  interpolating_3_8bit_mono:
  4073                                  	; 16/11/2023
  4074                                  	; al = [previous_val]
  4075                                  	; dl = [next_val]
  4076                                  	; original-interpolated-interpolated
  4077 00001C14 88C3                    	mov	bl, al
  4078 00001C16 2C80                    	sub	al, 80h
  4079 00001C18 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4080 00001C1C 66AB                    	stosw		; original sample (L)
  4081 00001C1E 66AB                    	stosw		; original sample (R)
  4082 00001C20 88D8                    	mov	al, bl
  4083 00001C22 00D0                    	add	al, dl
  4084 00001C24 D0D8                    	rcr	al, 1
  4085 00001C26 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4086 00001C28 00D8                    	add	al, bl
  4087 00001C2A D0D8                    	rcr	al, 1
  4088 00001C2C 2C80                    	sub	al, 80h
  4089 00001C2E 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4090 00001C32 66AB                    	stosw		; interpolated sample 1 (L)
  4091 00001C34 66AB                    	stosw		; interpolated sample 1 (R)
  4092 00001C36 88F8                    	mov	al, bh
  4093 00001C38 00D0                    	add	al, dl	; [next_val]
  4094 00001C3A D0D8                    	rcr	al, 1
  4095 00001C3C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4096 00001C40 66AB                    	stosw		; interpolated sample 2 (L)
  4097 00001C42 66AB                    	stosw		; interpolated sample 2 (R)
  4098 00001C44 C3                      	retn
  4099                                  
  4100                                  interpolating_3_8bit_stereo:
  4101                                  	; 16/11/2023
  4102                                  	; al = [previous_val_l]
  4103                                  	; ah = [previous_val_r]
  4104                                  	; dl = [next_val_l]
  4105                                  	; dh = [next_val_r]
  4106                                  	; original-interpolated-interpolated
  4107 00001C45 89C3                    	mov	ebx, eax
  4108 00001C47 2C80                    	sub	al, 80h
  4109 00001C49 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4110 00001C4D 66AB                    	stosw		; original sample (L)
  4111 00001C4F 88F8                    	mov	al, bh
  4112 00001C51 2C80                    	sub	al, 80h
  4113 00001C53 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4114 00001C57 66AB                    	stosw		; original sample (R)
  4115 00001C59 88D8                    	mov	al, bl
  4116 00001C5B 00D0                    	add	al, dl	; [next_val_l]
  4117 00001C5D D0D8                    	rcr	al, 1
  4118 00001C5F 50                      	push	eax ; *	; al = interpolated middle (L) (temporary)
  4119 00001C60 00D8                    	add	al, bl	; [previous_val_l]
  4120 00001C62 D0D8                    	rcr	al, 1
  4121 00001C64 2C80                    	sub	al, 80h
  4122 00001C66 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4123 00001C6A 66AB                    	stosw		; interpolated sample 1 (L)
  4124 00001C6C 88F8                    	mov	al, bh
  4125 00001C6E 00F0                    	add	al, dh	; [next_val_r]
  4126 00001C70 D0D8                    	rcr	al, 1
  4127 00001C72 50                      	push	eax ; ** ; al = interpolated middle (R) (temporary)
  4128 00001C73 00F8                    	add	al, bh	; [previous_val_r]
  4129 00001C75 D0D8                    	rcr	al, 1
  4130 00001C77 2C80                    	sub	al, 80h
  4131 00001C79 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4132 00001C7D 66AB                    	stosw		; interpolated sample 1 (R)
  4133 00001C7F 5B                      	pop	ebx ; **
  4134 00001C80 58                      	pop	eax ; *
  4135 00001C81 00D0                    	add	al, dl	; [next_val_l]
  4136 00001C83 D0D8                    	rcr	al, 1
  4137 00001C85 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4138 00001C89 66AB                    	stosw		; interpolated sample 2 (L)
  4139 00001C8B 88D8                    	mov	al, bl
  4140 00001C8D 00F0                    	add	al, dh	; [next_val_r]
  4141 00001C8F D0D8                    	rcr	al, 1
  4142 00001C91 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4143 00001C95 66AB                    	stosw		; interpolated sample 2 (R)
  4144 00001C97 C3                      	retn
  4145                                  
  4146                                  interpolating_2_8bit_mono:
  4147                                  	; 16/11/2023
  4148                                  	; al = [previous_val]
  4149                                  	; dl = [next_val]
  4150                                  	; original-interpolated
  4151 00001C98 88C3                    	mov	bl, al
  4152 00001C9A 2C80                    	sub	al, 80h
  4153 00001C9C 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4154 00001CA0 66AB                    	stosw		; original sample (L)
  4155 00001CA2 66AB                    	stosw		; original sample (R)
  4156 00001CA4 88D8                    	mov	al, bl
  4157 00001CA6 00D0                    	add	al, dl
  4158 00001CA8 D0D8                    	rcr	al, 1
  4159 00001CAA 2C80                    	sub	al, 80h
  4160 00001CAC 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4161 00001CB0 66AB                    	stosw		; interpolated sample (L)
  4162 00001CB2 66AB                    	stosw		; interpolated sample (R)
  4163 00001CB4 C3                      	retn
  4164                                  
  4165                                  interpolating_2_8bit_stereo:
  4166                                  	; 16/11/2023
  4167                                  	; al = [previous_val_l]
  4168                                  	; ah = [previous_val_r]
  4169                                  	; dl = [next_val_l]
  4170                                  	; dh = [next_val_r]
  4171                                  	; original-interpolated
  4172 00001CB5 89C3                    	mov	ebx, eax
  4173 00001CB7 2C80                    	sub	al, 80h
  4174 00001CB9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4175 00001CBD 66AB                    	stosw		; original sample (L)
  4176 00001CBF 88F8                    	mov	al, bh
  4177 00001CC1 2C80                    	sub	al, 80h
  4178 00001CC3 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4179 00001CC7 66AB                    	stosw		; original sample (R)
  4180 00001CC9 88D8                    	mov	al, bl	; [previous_val_l]
  4181 00001CCB 00D0                    	add	al, dl	; [next_val_l]
  4182 00001CCD D0D8                    	rcr	al, 1
  4183 00001CCF 2C80                    	sub	al, 80h
  4184 00001CD1 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4185 00001CD5 66AB                    	stosw		; interpolated sample (L)
  4186 00001CD7 88F8                    	mov	al, bh
  4187 00001CD9 00F0                    	add	al, dh	; [next_val_r]
  4188 00001CDB D0D8                    	rcr	al, 1
  4189 00001CDD 2C80                    	sub	al, 80h
  4190 00001CDF 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4191 00001CE3 66AB                    	stosw		; interpolated sample (R)
  4192 00001CE5 C3                      	retn
  4193                                  
  4194                                  interpolating_3_16bit_mono:
  4195                                  	; 16/11/2023
  4196                                  	; ax = [previous_val]
  4197                                  	; dx = [next_val]
  4198                                  	; original-interpolated-interpolated
  4199                                  
  4200 00001CE6 66AB                    	stosw		; original sample (L)
  4201 00001CE8 66AB                    	stosw		; original sample (R)
  4202 00001CEA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4203 00001CED 50                      	push	eax ; *	; [previous_val]
  4204 00001CEE 80C680                  	add	dh, 80h
  4205 00001CF1 6601D0                  	add	ax, dx
  4206 00001CF4 66D1D8                  	rcr	ax, 1
  4207 00001CF7 5B                      	pop	ebx ; *
  4208 00001CF8 93                      	xchg	ebx, eax ; bx  = interpolated middle (temporary)
  4209 00001CF9 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4210 00001CFC 66D1D8                  	rcr	ax, 1
  4211 00001CFF 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4212 00001D02 66AB                    	stosw 		; interpolated sample 1 (L)
  4213 00001D04 66AB                    	stosw		; interpolated sample 1 (R)
  4214 00001D06 89D8                    	mov	eax, ebx
  4215 00001D08 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4216 00001D0B 66D1D8                  	rcr	ax, 1
  4217 00001D0E 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4218 00001D11 66AB                    	stosw		; interpolated sample 2 (L)
  4219 00001D13 66AB                    	stosw		; interpolated sample 2 (R)
  4220 00001D15 C3                      	retn
  4221                                  
  4222                                  interpolating_3_16bit_stereo:
  4223                                  	; 16/11/2023
  4224                                  	; bx = [previous_val_l]
  4225                                  	; ax = [previous_val_r]
  4226                                  	; [next_val_l]
  4227                                  	; dx = [next_val_r]
  4228                                  	; original-interpolated-interpolated
  4229                                  
  4230 00001D16 93                      	xchg	eax, ebx
  4231 00001D17 66AB                    	stosw		; original sample (L)
  4232 00001D19 93                      	xchg	eax, ebx
  4233 00001D1A 66AB                    	stosw		; original sample (R)
  4234 00001D1C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4235 00001D1F 50                      	push	eax ; *	; [previous_val_r]
  4236 00001D20 80C780                  	add	bh, 80h
  4237 00001D23 8005[5D210000]80        	add	byte [next_val_l+1], 80h
  4238 00001D2A 66A1[5C210000]          	mov	ax, [next_val_l]
  4239 00001D30 6601D8                  	add	ax, bx	; [previous_val_l]
  4240 00001D33 66D1D8                  	rcr	ax, 1
  4241 00001D36 93                      	xchg	eax, ebx ; ax = [previous_val_l]
  4242 00001D37 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4243 00001D3A 66D1D8                  	rcr	ax, 1
  4244 00001D3D 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4245 00001D40 66AB                    	stosw 		; interpolated sample 1 (L)
  4246 00001D42 58                      	pop	eax  ; *
  4247 00001D43 80C680                  	add	dh, 80h ; convert sound level 0 to 65535 format
  4248 00001D46 52                      	push	edx  ; * ; [next_val_r]
  4249 00001D47 92                      	xchg	eax, edx
  4250 00001D48 6601D0                  	add	ax, dx	; [next_val_r] + [previous_val_r]
  4251 00001D4B 66D1D8                  	rcr	ax, 1	; / 2
  4252 00001D4E 50                      	push	eax ; ** ; interpolated middle (R)
  4253 00001D4F 6601D0                  	add	ax, dx	; + [previous_val_r]
  4254 00001D52 66D1D8                  	rcr	ax, 1
  4255 00001D55 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4256 00001D58 66AB                    	stosw 		; interpolated sample 1 (R)
  4257 00001D5A 66A1[5C210000]          	mov	ax, [next_val_l]
  4258 00001D60 6601D8                  	add	ax, bx	; + interpolated middle (L)
  4259 00001D63 66D1D8                  	rcr	ax, 1
  4260 00001D66 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4261 00001D69 66AB                    	stosw 		; interpolated sample 2 (L)
  4262 00001D6B 58                      	pop	eax ; **
  4263 00001D6C 5A                      	pop	edx ; *
  4264 00001D6D 6601D0                  	add	ax, dx	; interpolated middle + [next_val_r]
  4265 00001D70 66D1D8                  	rcr	ax, 1	; / 2
  4266 00001D73 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4267 00001D76 66AB                    	stosw 		; interpolated sample 2 (L)
  4268 00001D78 C3                      	retn
  4269                                  
  4270                                  interpolating_2_16bit_mono:
  4271                                  	; 16/11/2023
  4272                                  	; ax = [previous_val]
  4273                                  	; dx = [next_val]
  4274                                  	; original-interpolated
  4275                                  
  4276 00001D79 66AB                    	stosw		; original sample (L)
  4277 00001D7B 66AB                    	stosw		; original sample (R)
  4278 00001D7D 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4279 00001D80 80C680                  	add	dh, 80h
  4280 00001D83 6601D0                  	add	ax, dx
  4281 00001D86 66D1D8                  	rcr	ax, 1
  4282 00001D89 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4283 00001D8C 66AB                    	stosw		; interpolated sample (L)
  4284 00001D8E 66AB                    	stosw		; interpolated sample (R)
  4285 00001D90 C3                      	retn
  4286                                  
  4287                                  interpolating_2_16bit_stereo:
  4288                                  	; 17/01/2025
  4289                                  	; 16/11/2023
  4290                                  	; bx = [previous_val_l]
  4291                                  	; ax = [previous_val_r]
  4292                                  	; [next_val_l]
  4293                                  	; dx = [next_val_r]
  4294                                  	; original-interpolated
  4295                                  
  4296 00001D91 93                      	xchg	eax, ebx
  4297 00001D92 66AB                    	stosw		; original sample (L)
  4298 00001D94 93                      	xchg	eax, ebx
  4299 00001D95 66AB                    	stosw		; original sample (R)
  4300 00001D97 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4301 00001D9A 80C680                  	add	dh, 80h
  4302 00001D9D 6601D0                  	add	ax, dx	; [previous_val_r] + [next_val_r]
  4303 00001DA0 66D1D8                  	rcr	ax, 1	; / 2
  4304                                  	; 17/01/2025
  4305 00001DA3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4306                                  	;push	eax ; *	; interpolated sample (R)
  4307                                  	; 17/01/2025
  4308 00001DA6 C1E010                  	shl	eax, 16
  4309 00001DA9 66A1[5C210000]          	mov	ax, [next_val_l]
  4310 00001DAF 80C480                  	add	ah, 80h
  4311 00001DB2 80C780                  	add	bh, 80h
  4312 00001DB5 6601D8                  	add	ax, bx	; [next_val_l] + [previous_val_l]
  4313 00001DB8 66D1D8                  	rcr	ax, 1	; / 2
  4314 00001DBB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4315                                  	; 17/01/2025
  4316                                  	;stosw 		; interpolated sample (L)
  4317                                  	;pop	eax ; *	
  4318                                  	;sub	ah, 80h	; -32768 to +32767 format again
  4319                                  	;stosw 		; interpolated sample (R)
  4320                                  	; 17/01/2025
  4321 00001DBE AB                      	stosd
  4322 00001DBF C3                      	retn
  4323                                  
  4324                                  interpolating_5_8bit_mono:
  4325                                  	; 17/11/2023
  4326                                  	; al = [previous_val]
  4327                                  	; dl = [next_val]
  4328                                  	; original-interpltd-interpltd-interpltd-interpltd
  4329 00001DC0 88C3                    	mov	bl, al
  4330 00001DC2 2C80                    	sub	al, 80h
  4331 00001DC4 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4332 00001DC8 66AB                    	stosw		; original sample (L)
  4333 00001DCA 66AB                    	stosw		; original sample (R)
  4334 00001DCC 88D8                    	mov	al, bl
  4335 00001DCE 00D0                    	add	al, dl
  4336 00001DD0 D0D8                    	rcr	al, 1
  4337 00001DD2 88C7                    	mov	bh, al	; interpolated middle (temporary)
  4338 00001DD4 00D8                    	add	al, bl  ; [previous_val]
  4339 00001DD6 D0D8                    	rcr	al, 1 	
  4340 00001DD8 88C6                    	mov	dh, al	; interpolated 1st quarter (temporary)
  4341 00001DDA 00D8                    	add	al, bl
  4342 00001DDC D0D8                    	rcr	al, 1
  4343 00001DDE 2C80                    	sub	al, 80h
  4344 00001DE0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4345 00001DE4 66AB                    	stosw		; interpolated sample 1 (L)
  4346 00001DE6 66AB                    	stosw		; interpolated sample 1 (R)
  4347 00001DE8 88F8                    	mov	al, bh
  4348 00001DEA 00F0                    	add	al, dh
  4349 00001DEC D0D8                    	rcr	al, 1
  4350 00001DEE 2C80                    	sub	al, 80h
  4351 00001DF0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4352 00001DF4 66AB                    	stosw		; interpolated sample 2 (L)
  4353 00001DF6 66AB                    	stosw		; interpolated sample 2 (R)
  4354 00001DF8 88F8                    	mov	al, bh
  4355 00001DFA 00D0                    	add	al, dl	; [next_val]
  4356 00001DFC D0D8                    	rcr	al, 1
  4357 00001DFE 88C6                    	mov	dh, al	; interpolated 3rd quarter (temporary)
  4358 00001E00 00F8                    	add	al, bh
  4359 00001E02 D0D8                    	rcr	al, 1
  4360 00001E04 2C80                    	sub	al, 80h
  4361 00001E06 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4362 00001E0A 66AB                    	stosw		; interpolated sample 3 (L)
  4363 00001E0C 66AB                    	stosw		; interpolated sample 3 (R)
  4364 00001E0E 88F0                    	mov	al, dh
  4365 00001E10 00D0                    	add	al, dl
  4366 00001E12 D0D8                    	rcr	al, 1
  4367 00001E14 2C80                    	sub	al, 80h
  4368 00001E16 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4369 00001E1A 66AB                    	stosw		; interpolated sample 4 (L)
  4370 00001E1C 66AB                    	stosw		; interpolated sample 4 (R)
  4371 00001E1E C3                      	retn
  4372                                  
  4373                                  interpolating_5_8bit_stereo:
  4374                                  	; 17/11/2023
  4375                                  	; al = [previous_val_l]
  4376                                  	; ah = [previous_val_r]
  4377                                  	; dl = [next_val_l]
  4378                                  	; dh = [next_val_r]
  4379                                  	; original-interpltd-interpltd-interpltd-interpltd
  4380 00001E1F 89C3                    	mov	ebx, eax
  4381 00001E21 2C80                    	sub	al, 80h
  4382 00001E23 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4383 00001E27 66AB                    	stosw		; original sample (L)
  4384 00001E29 88F8                    	mov	al, bh
  4385 00001E2B 2C80                    	sub	al, 80h
  4386 00001E2D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4387 00001E31 66AB                    	stosw		; original sample (R)
  4388 00001E33 52                      	push	edx ; *
  4389 00001E34 88D8                    	mov	al, bl
  4390 00001E36 00D0                    	add	al, dl	; [next_val_l]
  4391 00001E38 D0D8                    	rcr	al, 1
  4392 00001E3A 50                      	push	eax ; **	; al = interpolated middle (L) (temporary)
  4393 00001E3B 00D8                    	add	al, bl	; [previous_val_l]
  4394 00001E3D D0D8                    	rcr	al, 1
  4395 00001E3F 86D8                    	xchg	al, bl
  4396 00001E41 00D8                    	add	al, bl	; bl = interpolated 1st quarter (L) (temp)
  4397 00001E43 D0D8                    	rcr	al, 1
  4398 00001E45 2C80                    	sub	al, 80h
  4399 00001E47 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4400 00001E4B 66AB                    	stosw		; interpolated sample 1 (L)
  4401 00001E4D 88F8                    	mov	al, bh
  4402 00001E4F 00F0                    	add	al, dh	; [next_val_r]
  4403 00001E51 D0D8                    	rcr	al, 1
  4404 00001E53 50                      	push	eax ; *** ; al = interpolated middle (R) (temporary)
  4405 00001E54 00F8                    	add	al, bh	; [previous_val_r]
  4406 00001E56 D0D8                    	rcr	al, 1
  4407 00001E58 86F8                    	xchg	al, bh
  4408 00001E5A 00F8                    	add	al, bh	; bh = interpolated 1st quarter (R) (temp)
  4409 00001E5C D0D8                    	rcr	al, 1
  4410 00001E5E 2C80                    	sub	al, 80h
  4411 00001E60 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4412 00001E64 66AB                    	stosw		; interpolated sample 1 (R)
  4413 00001E66 5A                      	pop	edx ; ***
  4414 00001E67 58                      	pop	eax ; **	; al = interpolated middle (L) (temporary)
  4415 00001E68 86D8                    	xchg	al, bl	; al = interpolated 1st quarter (L) (temp)
  4416 00001E6A 00D8                    	add	al, bl	; bl = interpolated middle (L) (temporary)
  4417 00001E6C D0D8                    	rcr	al, 1
  4418 00001E6E 2C80                    	sub	al, 80h
  4419 00001E70 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4420 00001E74 66AB                    	stosw		; interpolated sample 2 (L)
  4421 00001E76 88D0                    	mov	al, dl 	; interpolated middle (R) (temporary)
  4422 00001E78 86F8                    	xchg	al, bh	; al = interpolated 1st quarter (R) (temp)
  4423 00001E7A 00F8                    	add	al, bh	; bh = interpolated middle (R) (temporary)
  4424 00001E7C D0D8                    	rcr	al, 1
  4425 00001E7E 2C80                    	sub	al, 80h
  4426 00001E80 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4427 00001E84 66AB                    	stosw		; interpolated sample 2 (R)
  4428 00001E86 5A                      	pop	edx ; *
  4429 00001E87 88D8                    	mov	al, bl	; interpolated middle (L) (temporary)
  4430 00001E89 00D0                    	add	al, dl	; [next_val_l]
  4431 00001E8B D0D8                    	rcr	al, 1
  4432 00001E8D 86D8                    	xchg	al, bl	; al = interpolated middle (R) (temporary)
  4433 00001E8F 00D8                    	add	al, bl	; bl = interpolated 3rd quarter (L) (temp)
  4434 00001E91 D0D8                    	rcr	al, 1
  4435 00001E93 2C80                    	sub	al, 80h
  4436 00001E95 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4437 00001E99 66AB                    	stosw		; interpolated sample 3 (L)
  4438 00001E9B 88F8                    	mov	al, bh	
  4439 00001E9D 00F0                    	add	al, dh	; interpolated middle (R) + [next_val_r]
  4440 00001E9F D0D8                    	rcr	al, 1
  4441 00001EA1 86F8                    	xchg	al, bh	; al = interpolated middle (R)
  4442 00001EA3 00F8                    	add	al, bh	; bh = interpolated 3rd quarter (R) (temp)
  4443 00001EA5 D0D8                    	rcr	al, 1
  4444 00001EA7 2C80                    	sub	al, 80h
  4445 00001EA9 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4446 00001EAD 66AB                    	stosw		; interpolated sample 3 (R)
  4447 00001EAF 88D8                    	mov	al, bl
  4448 00001EB1 00D0                    	add	al, dl	; [next_val_l]
  4449 00001EB3 D0D8                    	rcr	al, 1
  4450 00001EB5 2C80                    	sub	al, 80h
  4451 00001EB7 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4452 00001EBB 66AB                    	stosw		; interpolated sample 4 (L)
  4453 00001EBD 88F8                    	mov	al, bh
  4454 00001EBF 00F0                    	add	al, dh	; [next_val_r]
  4455 00001EC1 D0D8                    	rcr	al, 1
  4456 00001EC3 2C80                    	sub	al, 80h
  4457 00001EC5 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4458 00001EC9 66AB                    	stosw		; interpolated sample 4 (R)
  4459 00001ECB C3                      	retn
  4460                                  
  4461                                  interpolating_4_8bit_mono:
  4462                                  	; 17/11/2023
  4463                                  	; al = [previous_val]
  4464                                  	; dl = [next_val]
  4465                                  	; original-interpolated-interpolated-interpolated
  4466 00001ECC 88C3                    	mov	bl, al
  4467 00001ECE 2C80                    	sub	al, 80h
  4468 00001ED0 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4469 00001ED4 66AB                    	stosw		; original sample (L)
  4470 00001ED6 66AB                    	stosw		; original sample (R)
  4471 00001ED8 88D8                    	mov	al, bl
  4472 00001EDA 00D0                    	add	al, dl	
  4473 00001EDC D0D8                    	rcr	al, 1
  4474 00001EDE 86D8                    	xchg	al, bl  ; al = [previous_val]
  4475 00001EE0 00D8                    	add	al, bl	; bl = interpolated middle (sample 2)
  4476 00001EE2 D0D8                    	rcr	al, 1 	
  4477 00001EE4 2C80                    	sub	al, 80h
  4478 00001EE6 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4479 00001EEA 66AB                    	stosw		; interpolated sample 1 (L)
  4480 00001EEC 66AB                    	stosw		; interpolated sample 1 (R)
  4481 00001EEE 88D8                    	mov	al, bl	; interpolated middle (sample 2)
  4482 00001EF0 2C80                    	sub	al, 80h
  4483 00001EF2 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4484 00001EF6 66AB                    	stosw		; interpolated sample 2 (L)
  4485 00001EF8 66AB                    	stosw		; interpolated sample 2 (R)
  4486 00001EFA 88D8                    	mov	al, bl
  4487 00001EFC 00D0                    	add	al, dl	; [next_val]
  4488 00001EFE D0D8                    	rcr	al, 1
  4489 00001F00 2C80                    	sub	al, 80h
  4490 00001F02 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4491 00001F06 66AB                    	stosw		; interpolated sample 3 (L)
  4492 00001F08 66AB                    	stosw		; interpolated sample 3 (R)
  4493 00001F0A C3                      	retn
  4494                                  
  4495                                  interpolating_4_8bit_stereo:
  4496                                  	; 17/11/2023
  4497                                  	; al = [previous_val_l]
  4498                                  	; ah = [previous_val_r]
  4499                                  	; dl = [next_val_l]
  4500                                  	; dh = [next_val_r]	
  4501                                  	; original-interpolated-interpolated-interpolated
  4502 00001F0B 89C3                    	mov	ebx, eax
  4503 00001F0D 2C80                    	sub	al, 80h
  4504 00001F0F 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4505 00001F13 66AB                    	stosw		; original sample (L)
  4506 00001F15 88F8                    	mov	al, bh
  4507 00001F17 2C80                    	sub	al, 80h
  4508 00001F19 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4509 00001F1D 66AB                    	stosw		; original sample (R)
  4510 00001F1F 88D8                    	mov	al, bl
  4511 00001F21 00D0                    	add	al, dl	; [next_val_l]
  4512 00001F23 D0D8                    	rcr	al, 1
  4513 00001F25 86D8                    	xchg	al, bl	; al = [previous_val_l]
  4514 00001F27 00D8                    	add	al, bl	; bl = interpolated middle (L) (sample 2)
  4515 00001F29 D0D8                    	rcr	al, 1
  4516 00001F2B 2C80                    	sub	al, 80h
  4517 00001F2D 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4518 00001F31 66AB                    	stosw		; interpolated sample 1 (L)
  4519 00001F33 88F8                    	mov	al, bh
  4520 00001F35 00F0                    	add	al, dh	; [next_val_r]
  4521 00001F37 D0D8                    	rcr	al, 1
  4522 00001F39 86F8                    	xchg	al, bh	; al = [previous_val_h]
  4523 00001F3B 00F8                    	add	al, bh	; bh = interpolated middle (R) (sample 2)
  4524 00001F3D D0D8                    	rcr	al, 1
  4525 00001F3F 2C80                    	sub	al, 80h
  4526 00001F41 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4527 00001F45 66AB                    	stosw		; interpolated sample 1 (R)
  4528 00001F47 88D8                    	mov	al, bl	; interpolated middle (L) (sample 2)
  4529 00001F49 2C80                    	sub	al, 80h
  4530 00001F4B 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4531 00001F4F 66AB                    	stosw		; interpolated sample 2 (L)
  4532 00001F51 88F8                    	mov	al, bh	; interpolated middle (L) (sample 2)
  4533 00001F53 2C80                    	sub	al, 80h
  4534 00001F55 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4535 00001F59 66AB                    	stosw		; interpolated sample 2 (L)
  4536 00001F5B 88D8                    	mov	al, bl
  4537 00001F5D 00D0                    	add	al, dl	; [next_val_l]
  4538 00001F5F D0D8                    	rcr	al, 1
  4539 00001F61 2C80                    	sub	al, 80h
  4540 00001F63 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4541 00001F67 66AB                    	stosw		; interpolated sample 3 (L)
  4542 00001F69 88F8                    	mov	al, bh
  4543 00001F6B 00F0                    	add	al, dh	; [next_val_r]
  4544 00001F6D D0D8                    	rcr	al, 1
  4545 00001F6F 2C80                    	sub	al, 80h
  4546 00001F71 66C1E008                	shl	ax, 8	; convert 8 bit sample to 16 bit sample
  4547 00001F75 66AB                    	stosw		; interpolated sample 3 (R)
  4548 00001F77 C3                      	retn
  4549                                  
  4550                                  interpolating_5_16bit_mono:
  4551                                  	; 18/11/2023
  4552                                  	; ax = [previous_val]
  4553                                  	; dx = [next_val]
  4554                                  	; original-interpltd-interpltd-interpltd-interpltd
  4555 00001F78 66AB                    	stosw		; original sample (L)
  4556 00001F7A 66AB                    	stosw		; original sample (R)
  4557 00001F7C 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4558 00001F7F 89C3                    	mov	ebx, eax ; [previous_val]
  4559 00001F81 80C680                  	add	dh, 80h
  4560 00001F84 6601D0                  	add	ax, dx
  4561 00001F87 66D1D8                  	rcr	ax, 1
  4562 00001F8A 50                      	push	eax ; *	; interpolated middle (temporary)
  4563 00001F8B 6601D8                  	add	ax, bx	; interpolated middle + [previous_val] 
  4564 00001F8E 66D1D8                  	rcr	ax, 1
  4565 00001F91 50                      	push	eax ; **	; interpolated 1st quarter (temporary)
  4566 00001F92 6601D8                  	add	ax, bx	; 1st quarter + [previous_val]
  4567 00001F95 66D1D8                  	rcr	ax, 1	
  4568 00001F98 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4569 00001F9B 66AB                    	stosw 		; interpolated sample 1 (L)
  4570 00001F9D 66AB                    	stosw		; interpolated sample 1 (R)
  4571 00001F9F 58                      	pop	eax ; **
  4572 00001FA0 5B                      	pop	ebx ; *
  4573 00001FA1 6601D8                  	add	ax, bx	; 1st quarter + middle
  4574 00001FA4 66D1D8                  	rcr	ax, 1	; / 2
  4575 00001FA7 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again	
  4576 00001FAA 66AB                    	stosw		; interpolated sample 2 (L)
  4577 00001FAC 66AB                    	stosw		; interpolated sample 2 (R)
  4578 00001FAE 89D8                    	mov	eax, ebx
  4579 00001FB0 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4580 00001FB3 66D1D8                  	rcr	ax, 1
  4581 00001FB6 50                      	push	eax ; *	; interpolated 3rd quarter (temporary)
  4582 00001FB7 6601D8                  	add	ax, bx	; + interpolated middle
  4583 00001FBA 66D1D8                  	rcr	ax, 1
  4584 00001FBD 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4585 00001FC0 66AB                    	stosw		; interpolated sample 3 (L)
  4586 00001FC2 66AB                    	stosw		; interpolated sample 3 (R)
  4587 00001FC4 58                      	pop	eax ; *	
  4588 00001FC5 6601D0                  	add	ax, dx	; 3rd quarter + [next_val]
  4589 00001FC8 66D1D8                  	rcr	ax, 1	; / 2
  4590 00001FCB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4591 00001FCE 66AB                    	stosw		; interpolated sample 4 (L)
  4592 00001FD0 66AB                    	stosw		; interpolated sample 4 (R)
  4593 00001FD2 C3                      	retn
  4594                                  
  4595                                  interpolating_5_16bit_stereo:
  4596                                  	; 18/11/2023
  4597                                  	; bx = [previous_val_l]
  4598                                  	; ax = [previous_val_r]
  4599                                  	; [next_val_l]
  4600                                  	; [next_val_r]
  4601                                  	; original-interpltd-interpltd-interpltd-interpltd
  4602 00001FD3 51                      	push	ecx ; !
  4603 00001FD4 93                      	xchg	eax, ebx
  4604 00001FD5 66AB                    	stosw		; original sample (L)
  4605 00001FD7 93                      	xchg	eax, ebx
  4606 00001FD8 66AB                    	stosw		; original sample (R)
  4607 00001FDA 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4608 00001FDD 50                      	push	eax ; *	; [previous_val_r]
  4609 00001FDE 80C780                  	add	bh, 80h
  4610 00001FE1 8005[5D210000]80        	add	byte [next_val_l+1], 80h
  4611 00001FE8 66A1[5C210000]          	mov	ax, [next_val_l]
  4612 00001FEE 6601D8                  	add	ax, bx	; [previous_val_l]
  4613 00001FF1 66D1D8                  	rcr	ax, 1
  4614 00001FF4 89C1                    	mov	ecx, eax ; interpolated middle (L)
  4615 00001FF6 6601D8                  	add	ax, bx	
  4616 00001FF9 66D1D8                  	rcr	ax, 1
  4617 00001FFC 89C2                    	mov	edx, eax ; interpolated 1st quarter (L)
  4618 00001FFE 6601D8                  	add	ax, bx	; [previous_val_l]
  4619 00002001 66D1D8                  	rcr	ax, 1
  4620 00002004 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4621 00002007 66AB                    	stosw 		; interpolated sample 1 (L)
  4622 00002009 89C8                    	mov	eax, ecx
  4623 0000200B 6601D0                  	add	ax, dx	; middle (L) + 1st quarter (L)
  4624 0000200E 66D1D8                  	rcr	ax, 1	; / 2
  4625 00002011 89C3                    	mov	ebx, eax  ; interpolated sample 2 (L)
  4626 00002013 5A                      	pop	edx ; *	; [previous_val_r]
  4627 00002014 89D0                    	mov	eax, edx
  4628 00002016 8005[5F210000]80        	add	byte [next_val_r+1], 80h
  4629 0000201D 660305[5E210000]        	add	ax, [next_val_r]
  4630 00002024 66D1D8                  	rcr	ax, 1
  4631 00002027 50                      	push	eax ; *	; interpolated middle (R)
  4632 00002028 6601D0                  	add	ax, dx
  4633 0000202B 66D1D8                  	rcr	ax, 1
  4634 0000202E 50                      	push	eax ; ** ; interpolated 1st quarter (R)
  4635 0000202F 6601D0                  	add	ax, dx	; [previous_val_r]
  4636 00002032 66D1D8                  	rcr	ax, 1
  4637 00002035 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4638 00002038 66AB                    	stosw 		; interpolated sample 1 (R)
  4639 0000203A 89D8                    	mov	eax, ebx
  4640 0000203C 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4641 0000203F 66AB                    	stosw 		; interpolated sample 2 (L)
  4642 00002041 58                      	pop	eax ; **
  4643 00002042 5A                      	pop	edx ; *
  4644 00002043 6601D0                  	add	ax, dx	; 1st quarter (R) + middle (R)
  4645 00002046 66D1D8                  	rcr	ax, 1	; / 2
  4646 00002049 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4647 0000204C 66AB                    	stosw 		; interpolated sample 2 (R)
  4648 0000204E 89C8                    	mov	eax, ecx
  4649 00002050 660305[5C210000]        	add	ax, [next_val_l]
  4650 00002057 66D1D8                  	rcr	ax, 1
  4651 0000205A 50                      	push	eax ; * ; interpolated 3rd quarter (L)
  4652 0000205B 6601C8                  	add	ax, cx	; interpolated middle (L)
  4653 0000205E 66D1D8                  	rcr	ax, 1
  4654 00002061 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4655 00002064 66AB                    	stosw 		; interpolated sample 3 (L)
  4656 00002066 89D0                    	mov	eax, edx
  4657 00002068 660305[5E210000]        	add	ax, [next_val_r]
  4658 0000206F 66D1D8                  	rcr	ax, 1
  4659 00002072 50                      	push	eax ; ** ; interpolated 3rd quarter (R)
  4660 00002073 6601D0                  	add	ax, dx	; interpolated middle (R)
  4661 00002076 66D1D8                  	rcr	ax, 1
  4662 00002079 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4663 0000207C 66AB                    	stosw 		; interpolated sample 3 (R)
  4664 0000207E 5B                      	pop	ebx ; **
  4665 0000207F 58                      	pop	eax ; *
  4666 00002080 660305[5C210000]        	add	ax, [next_val_l]
  4667 00002087 66D1D8                  	rcr	ax, 1
  4668 0000208A 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4669 0000208D 66AB                    	stosw 		; interpolated sample 4 (L)
  4670 0000208F 89D8                    	mov	eax, ebx
  4671 00002091 660305[5E210000]        	add	ax, [next_val_r]
  4672 00002098 66D1D8                  	rcr	ax, 1
  4673 0000209B 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4674 0000209E 66AB                    	stosw 		; interpolated sample 4 (R)
  4675 000020A0 59                      	pop	ecx ; !
  4676 000020A1 C3                      	retn
  4677                                  
  4678                                  interpolating_4_16bit_mono:
  4679                                  	; 18/11/2023
  4680                                  	; ax = [previous_val]
  4681                                  	; dx = [next_val]
  4682                                  	; original-interpolated
  4683                                  
  4684 000020A2 66AB                    	stosw		; original sample (L)
  4685 000020A4 66AB                    	stosw		; original sample (R)
  4686 000020A6 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4687 000020A9 89C3                    	mov	ebx, eax ; [previous_val]
  4688 000020AB 80C680                  	add	dh, 80h
  4689 000020AE 6601D0                  	add	ax, dx	; [previous_val] + [next_val]
  4690 000020B1 66D1D8                  	rcr	ax, 1
  4691 000020B4 93                      	xchg	eax, ebx
  4692 000020B5 6601D8                  	add	ax, bx	; [previous_val] + interpolated middle
  4693 000020B8 66D1D8                  	rcr	ax, 1
  4694 000020BB 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4695 000020BE 66AB                    	stosw 		; interpolated sample 1 (L)
  4696 000020C0 66AB                    	stosw		; interpolated sample 1 (R)
  4697 000020C2 89D8                    	mov	eax, ebx ; interpolated middle
  4698 000020C4 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4699 000020C7 66AB                    	stosw 		; interpolated sample 2 (L)
  4700 000020C9 66AB                    	stosw		; interpolated sample 2 (R)
  4701 000020CB 89D8                    	mov	eax, ebx
  4702 000020CD 6601D0                  	add	ax, dx	; interpolated middle + [next_val]
  4703 000020D0 66D1D8                  	rcr	ax, 1
  4704 000020D3 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4705 000020D6 66AB                    	stosw		; interpolated sample 3 (L)
  4706 000020D8 66AB                    	stosw		; interpolated sample 3 (R)
  4707 000020DA C3                      	retn
  4708                                  
  4709                                  interpolating_4_16bit_stereo:
  4710                                  	; 18/11/2023
  4711                                  	; bx = [previous_val_l]
  4712                                  	; ax = [previous_val_r]
  4713                                  	; [next_val_l]
  4714                                  	; [next_val_r]
  4715                                  	; original-interpolated-interpolated-interpolated
  4716 000020DB 93                      	xchg	eax, ebx
  4717 000020DC 66AB                    	stosw		; original sample (L)
  4718 000020DE 93                      	xchg	eax, ebx
  4719 000020DF 66AB                    	stosw		; original sample (R)
  4720 000020E1 80C480                  	add	ah, 80h ; convert sound level 0 to 65535 format
  4721 000020E4 89C2                    	mov	edx, eax ; [previous_val_r]
  4722 000020E6 80C780                  	add	bh, 80h
  4723 000020E9 8005[5D210000]80        	add	byte [next_val_l+1], 80h
  4724 000020F0 66A1[5C210000]          	mov	ax, [next_val_l]
  4725 000020F6 6601D8                  	add	ax, bx	; [previous_val_l]
  4726 000020F9 66D1D8                  	rcr	ax, 1
  4727 000020FC 93                      	xchg	eax, ebx
  4728 000020FD 6601D8                  	add	ax, bx	; bx = interpolated middle (L)
  4729 00002100 66D1D8                  	rcr	ax, 1
  4730 00002103 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4731 00002106 66AB                    	stosw 		; interpolated sample 1 (L)
  4732 00002108 8005[5F210000]80        	add	byte [next_val_r+1], 80h
  4733 0000210F 89D0                    	mov	eax, edx ; [previous_val_r]
  4734 00002111 660305[5E210000]        	add	ax, [next_val_r]
  4735 00002118 66D1D8                  	rcr	ax, 1
  4736 0000211B 92                      	xchg	eax, edx
  4737 0000211C 6601D0                  	add	ax, dx	; dx = interpolated middle (R)
  4738 0000211F 66D1D8                  	rcr	ax, 1
  4739 00002122 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4740 00002125 66AB                    	stosw 		; interpolated sample 1 (R)
  4741 00002127 89D8                    	mov	eax, ebx
  4742 00002129 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4743 0000212C 66AB                    	stosw 		; interpolated sample 2 (L)
  4744 0000212E 89D0                    	mov	eax, edx
  4745 00002130 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4746 00002133 66AB                    	stosw 		; interpolated sample 2 (R)
  4747 00002135 89D8                    	mov	eax, ebx
  4748 00002137 660305[5C210000]        	add	ax, [next_val_l]
  4749 0000213E 66D1D8                  	rcr	ax, 1
  4750 00002141 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4751 00002144 66AB                    	stosw 		; interpolated sample 3 (L)
  4752 00002146 89D0                    	mov	eax, edx
  4753 00002148 660305[5E210000]        	add	ax, [next_val_r]
  4754 0000214F 66D1D8                  	rcr	ax, 1
  4755 00002152 80EC80                  	sub	ah, 80h	; -32768 to +32767 format again
  4756 00002155 66AB                    	stosw 		; interpolated sample 3 (R)
  4757 00002157 C3                      	retn
  4758                                  
  4759                                  ; 13/11/2023
  4760                                  previous_val:
  4761 00002158 0000                    previous_val_l: dw 0
  4762 0000215A 0000                    previous_val_r: dw 0
  4763                                  next_val:
  4764 0000215C 0000                    next_val_l: dw 0
  4765 0000215E 0000                    next_val_r: dw 0
  4766                                  
  4767                                  ; 16/11/2023
  4768 00002160 00                      faz:	db 0
  4769                                  
  4770                                  ; --------------------------------------------------------
  4771                                  ; --------------------------------------------------------
  4772                                  
  4773                                  ; 07/12/2024
  4774                                  ; Ref: TRDOS 386 v2.0.9, trdosk8.s (18/09/2024)
  4775                                  ;		'sysaudio' system call (23/08/2024)
  4776                                  ; 18/11/2024
  4777                                  ; Ref: TRDOS 386 v2.0.9, audio.s, Erdogan Tan, 06/06/2024
  4778                                  
  4779                                  ac97_stop: 
  4780                                  	; 18/11/2024
  4781 00002161 C605[C0720000]02        	mov	byte [stopped], 2
  4782                                  	; 07/12/2024
  4783                                  	sys	_audio, 0700h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002168 BB00070000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 0000216D B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002172 CD40                <1>  int 40h
  4784 00002174 C3                      	retn
  4785                                  
  4786                                  ac97_pause:
  4787                                  	; 18/11/2024
  4788 00002175 C605[C0720000]01        	mov	byte [stopped], 1 ; paused
  4789                                  	; 07/12/2024
  4790                                  	sys	_audio, 0500h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000217C BB00050000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002181 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 00002186 CD40                <1>  int 40h
  4791 00002188 C3                      	retn
  4792                                  
  4793                                  ac97_play: ; continue to play (after pause)
  4794                                  	; 18/11/2024
  4795 00002189 C605[C0720000]00        	mov	byte [stopped], 0
  4796                                  	; 07/12/2024	
  4797                                  	sys	_audio, 0600h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 00002190 BB00060000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002195 B820000000          <1>  mov eax, %1
    97                              <1> 
    98 0000219A CD40                <1>  int 40h
  4798 0000219C C3                      	retn
  4799                                  	
  4800                                  ; --------------------------------------------------------
  4801                                  ; 14/11/2024 - Erdogan Tan
  4802                                  ; --------------------------------------------------------
  4803                                  
  4804                                  	; 07/12/2024
  4805                                  	; 01/12/2024 (32bit registers)
  4806                                  	; 29/11/2024
  4807                                  checkUpdateEvents:
  4808 0000219D E817010000              	call	check4keyboardstop
  4809 000021A2 727D                    	jc	short c4ue_ok
  4810                                  
  4811                                  	; 18/11/2024
  4812 000021A4 50                      	push	eax ; *
  4813 000021A5 09C0                    	or	eax, eax
  4814 000021A7 0F84C2000000            	jz	c4ue_cpt
  4815                                  
  4816                                  	; 18/11/2024
  4817 000021AD 3C20                    	cmp	al, 20h ; SPACE (spacebar) ; pause/play
  4818 000021AF 7543                    	jne	short ch4ue_chk_s
  4819 000021B1 803D[C0720000]00        	cmp	byte [stopped], 0
  4820 000021B8 7714                    	ja	short c4ue_chk_ps
  4821                                  	; pause
  4822 000021BA E8B6FFFFFF              	call	ac97_pause
  4823                                  	; 21/11/2024
  4824 000021BF A0[C1720000]            	mov	al, [tLO]
  4825 000021C4 A2[C2720000]            	mov	byte [tLP], al
  4826 000021C9 E9A1000000              	jmp	c4ue_cpt
  4827                                  c4ue_chk_ps:
  4828 000021CE 803D[C0720000]01        	cmp	byte [stopped], 1
  4829 000021D5 770A                    	ja	short c4ue_replay
  4830                                  	; continue to play (after a pause)
  4831 000021D7 E8ADFFFFFF              	call	ac97_play 
  4832 000021DC E98E000000              	jmp	c4ue_cpt
  4833                                  c4ue_replay:
  4834                                  	; 19/11/2024
  4835 000021E1 58                      	pop	eax ; *
  4836 000021E2 58                      	pop	eax ; return address
  4837                                  	; 07/02/2024
  4838                                  	;mov	al, [volume]
  4839                                  	;call	SetmasterVolume
  4840 000021E3 C605[C0720000]00        	mov	byte [stopped], 0
  4841 000021EA E8C6030000              	call	move_to_beginning
  4842                                  	;jmp	PlayWav
  4843                                  	; 07/12/2024
  4844 000021EF E9F9E3FFFF              	jmp	RePlayWav
  4845                                  
  4846                                  ch4ue_chk_s:
  4847 000021F4 3C53                    	cmp	al, 'S'	; stop
  4848 000021F6 751E                    	jne	short ch4ue_chk_fb
  4849 000021F8 803D[C0720000]00        	cmp	byte [stopped], 0
  4850 000021FF 776E                    	ja	c4ue_cpt ; Already stopped/paused
  4851 00002201 E85BFFFFFF              	call	ac97_stop
  4852                                  	; 19/11/2024
  4853 00002206 C605[C1720000]00        	mov	byte [tLO], 0
  4854                                  	; 21/11/2024
  4855 0000220D C605[C2720000]30        	mov	byte [tLP], '0'
  4856 00002214 EB59                    	jmp	short c4ue_cpt
  4857                                  
  4858                                  ch4ue_chk_fb:
  4859                                  	; 17/11/2024
  4860 00002216 3C46                    	cmp	al, 'F'
  4861 00002218 7508                    	jne	short c4ue_chk_b
  4862 0000221A E86E030000              	call 	Player_ProcessKey_Forwards
  4863 0000221F EB4E                    	jmp	short c4ue_cpt
  4864                                  
  4865                                  	; 01/12/2024
  4866                                  	; 18/11/2024
  4867                                  c4ue_ok:
  4868 00002221 C3                      	retn
  4869                                  	
  4870                                  c4ue_chk_b:
  4871 00002222 3C42                    	cmp	al, 'B'
  4872                                  	;;jne	short c4ue_cpt
  4873                                  	; 19/11/2024
  4874 00002224 7507                    	jne	short c4ue_chk_h
  4875 00002226 E85E030000              	call 	Player_ProcessKey_Backwards
  4876 0000222B EB42                    	jmp	short c4ue_cpt
  4877                                  
  4878                                  c4ue_chk_h:
  4879                                  	; 19/11/2024
  4880 0000222D 3C48                    	cmp	al, 'H'
  4881 0000222F 750E                    	jne	short c4ue_chk_cr
  4882 00002231 C605[C3720000]00        	mov	byte [wleds], 0
  4883 00002238 E8B0E6FFFF              	call 	write_ac97_pci_dev_info
  4884                                  	;mov	dh, 24
  4885                                  	;mov	dl, 79
  4886                                  	;call	setCursorPosition
  4887                                  	; 21/12/2024
  4888 0000223D EB30                    	jmp	short c4ue_cpt
  4889                                  c4ue_chk_cr:
  4890                                  	; 19/11/2024
  4891 0000223F 3C0D                    	cmp	al, 0Dh ; ENTER/CR key
  4892 00002241 752C                    	jne	short c4ue_cpt
  4893                                  	;inc	byte [wleds]
  4894                                  	;jnz	short c4ue_cpt
  4895                                  	;inc	byte [wleds]
  4896                                  	;;;
  4897                                  	; 22/12/2024 (faster method)
  4898                                  	; (UpdateWaveLeds procedure turns off previously
  4899                                  	;  lighting wave leds only)
  4900 00002243 E8B2030000              	call	reset_wave_leds ; prepare all leds as turned off
  4901                                  	;;;
  4902                                  	; 23/11/2024
  4903 00002248 31DB                    	xor	ebx, ebx
  4904 0000224A 8A1D[C3720000]          	mov	bl, [wleds]
  4905 00002250 FEC3                    	inc	bl
  4906 00002252 80E30F                  	and	bl, 0Fh
  4907 00002255 7501                    	jnz	short c4ue_sc
  4908 00002257 43                      	inc	ebx
  4909                                  c4ue_sc:
  4910 00002258 881D[C3720000]          	mov	[wleds], bl
  4911 0000225E D0EB                    	shr	bl, 1
  4912 00002260 8A83[663F0000]          	mov	al, [ebx+colors]
  4913 00002266 7302                    	jnc	short c4ue_sc_@
  4914 00002268 0C10                    	or	al, 10h ; blue (dark) background
  4915                                  c4ue_sc_@:
  4916 0000226A A2[6E3F0000]            	mov	[ccolor], al
  4917                                  	;;;
  4918                                  c4ue_cpt:
  4919                                  	; 01/12/2024 (TRDOS 386)
  4920                                  	sys	_time, 4 ; get timer ticks (18.2 ticks/second)
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 0000226F BB04000000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 00002274 B80D000000          <1>  mov eax, %1
    97                              <1> 
    98 00002279 CD40                <1>  int 40h
  4921                                  	; 18/11/2024
  4922 0000227B 59                      	pop	ecx ; *
  4923                                  	; 01/12/2024
  4924 0000227C 3B05[80730000]          	cmp	eax, [timerticks]
  4925                                  	;je	short c4ue_ok
  4926                                  	; 18/11/2024
  4927 00002282 7407                    	je	short c4ue_skip_utt
  4928                                  c4ue_utt:	
  4929                                  	; 01/12/2024
  4930 00002284 A3[80730000]            	mov	[timerticks], eax
  4931 00002289 EB04                    	jmp	short c4ue_cpt_@
  4932                                  c4ue_skip_utt:
  4933                                  	; 18/11/2024
  4934 0000228B 21C9                    	and	ecx, ecx
  4935 0000228D 7492                    	jz	short c4ue_ok
  4936                                  c4ue_cpt_@:
  4937                                  	; 18/11/2024
  4938 0000228F 803D[C0720000]00        	cmp	byte [stopped], 0
  4939 00002296 7789                    	ja	short c4ue_ok
  4940                                  	
  4941 00002298 E841010000              	call	CalcProgressTime
  4942                                  
  4943                                  	;cmp	ax, [ProgressTime]
  4944                                  	; 01/12/2024
  4945 0000229D 3B05[74730000]          	cmp	eax, [ProgressTime]
  4946                                  	;je	short c4ue_ok
  4947                                  			; same second, no need to update
  4948                                  	; 23/11/2024
  4949 000022A3 7405                    	je	short c4ue_uvb
  4950                                  
  4951                                  	;call	UpdateProgressTime
  4952                                  	;call	UpdateProgressBar@
  4953 000022A5 E853020000              	call	UpdateProgressBar
  4954                                  
  4955                                  	; 23/11/2024
  4956                                  c4ue_uvb:
  4957 000022AA 803D[C3720000]00        	cmp	byte [wleds], 0
  4958 000022B1 7605                    	jna	short c4ue_vb_ok
  4959                                  
  4960 000022B3 E88C030000              	call	UpdateWaveLeds
  4961                                  
  4962                                  c4ue_vb_ok:
  4963 000022B8 C3                      	retn	
  4964                                  
  4965                                  ; --------------------------------------------------------
  4966                                  ; 19/05/2024 - (playwav4.asm) ich_wav4.asm
  4967                                  ; --------------------------------------------------------
  4968                                  
  4969                                  	; 07/12/2024
  4970                                  	; 01/12/2024 (TRDOS 386)
  4971                                  	; 29/11/2024
  4972                                  check4keyboardstop:
  4973                                  	; 19/05/2024
  4974                                  	; 08/11/2023
  4975                                  	; 04/11/2023
  4976 000022B9 B401                    	mov	ah, 1
  4977                                  	;int	16h
  4978                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  4979 000022BB CD32                    	int	32h
  4980                                  	;clc
  4981 000022BD 7433                    	jz	short _cksr
  4982                                  
  4983 000022BF 30E4                    	xor	ah, ah
  4984                                  	;int	16h
  4985                                  	; 01/12/2024 (TRDOS 386 keyboard interrupt)
  4986 000022C1 CD32                    	int	32h
  4987                                  
  4988                                  	;;;
  4989                                  	; 19/05/2024 (change PCM out volume)
  4990 000022C3 3C2B                    	cmp	al, '+'
  4991 000022C5 750D                    	jne	short p_1
  4992                                  	
  4993 000022C7 A0[10230000]            	mov	al, [volume]
  4994 000022CC 3C00                    	cmp	al, 0
  4995 000022CE 7624                    	jna	short p_3
  4996 000022D0 FEC8                    	dec	al
  4997 000022D2 EB0F                    	jmp	short p_2
  4998                                  p_1:
  4999 000022D4 3C2D                    	cmp	al, '-'
  5000 000022D6 751D                    	jne	short p_4
  5001                                  
  5002 000022D8 A0[10230000]            	mov	al, [volume]
  5003 000022DD 3C1F                    	cmp	al, 31
  5004 000022DF 7313                    	jnb	short p_3
  5005 000022E1 FEC0                    	inc	al
  5006                                  p_2:
  5007 000022E3 A2[10230000]            	mov	[volume], al
  5008                                  	; 14/11/2024
  5009                                  	;call	SetPCMOutVolume
  5010                                  	; 15/11/2024 (QEMU)
  5011                                  	; 07/12/2024
  5012 000022E8 E830E4FFFF              	call	SetMasterVolume
  5013                                  	;call	UpdateVolume
  5014                                  	;;clc
  5015                                  	;retn
  5016 000022ED E97B010000              	jmp	UpdateVolume
  5017                                  	;mov	ah, al
  5018                                  	;mov    dx, [NAMBAR]
  5019                                    	;;add   dx, CODEC_MASTER_VOL_REG
  5020                                  	;add	dx, CODEC_PCM_OUT_REG
  5021                                  	;out    dx, ax
  5022                                  	;
  5023                                  	;call   delay1_4ms
  5024                                          ;call   delay1_4ms
  5025                                          ;call   delay1_4ms
  5026                                          ;call   delay1_4ms
  5027                                  _cksr:		; 19/05/2024
  5028                                  	; 18/12/2024
  5029 000022F2 31C0                    	xor	eax, eax
  5030                                  	;clc
  5031                                  p_3:
  5032 000022F4 C3                      	retn
  5033                                  p_4:
  5034                                  	; 17/11/2024
  5035 000022F5 80FC01                  	cmp	ah, 01h  ; ESC
  5036 000022F8 7414                        	je	short p_q
  5037                                  	;cmp	ax, 2E03h ; 21/12/2024 
  5038 000022FA 3C03                    	cmp	al, 03h  ; CTRL+C
  5039 000022FC 7410                    	je	short p_q
  5040                                  
  5041                                  	; 18/11/2024
  5042 000022FE 3C20                    	cmp	al, 20h
  5043 00002300 740D                    	je	short p_r
  5044                                  
  5045                                  	; 19/11/2024
  5046 00002302 3C0D                    	cmp	al, 0Dh ; CR/ENTER
  5047 00002304 7409                    	je	short p_r
  5048                                  
  5049 00002306 24DF                    	and	al, 0DFh
  5050                                  
  5051                                  	;cmp	al, 'B'
  5052                                  	;je	short p_r
  5053                                  	;cmp	al, 'F'
  5054                                  	;je	short p_r
  5055                                  
  5056 00002308 3C51                    	cmp	al, 'Q'
  5057                                  	;je	short p_q
  5058 0000230A 7402                    	je	short p_quit ; 29/11/2024
  5059                                  
  5060 0000230C F8                      	clc
  5061 0000230D C3                      	retn
  5062                                  
  5063                                  	;;;
  5064                                  ;_cskr:	
  5065                                  p_q:
  5066                                  p_quit:
  5067 0000230E F9                      	stc
  5068                                  p_r:
  5069 0000230F C3                      	retn
  5070                                  
  5071                                  ; 29/05/2024
  5072                                  ; 19/05/2024
  5073 00002310 02                      volume: db	02h
  5074                                  
  5075                                  ; --------------------------------------------------------
  5076                                  
  5077                                  	; 22/12/2024
  5078                                  	; 21/12/2024
  5079                                  	; simulate cursor position in VGA (VESA VBE) mode
  5080                                  	; ! for 640*480, 256 colors (1 byte/pixel) !
  5081                                  setCursorPosition:
  5082                                  	; dh = Row
  5083                                  	; dl = Column
  5084                                  	
  5085 00002311 31C0                    	xor	eax, eax
  5086 00002313 B00E                    	mov	al, 14	; row height is 14 pixels (8*14)
  5087 00002315 F6E6                    	mul	dh
  5088 00002317 6683C007                	add	ax, 7	; top margin
  5089 0000231B C1E010                  	shl	eax, 16
  5090 0000231E 88D0                    	mov	al, dl	; * 8 ; character width = 8 pixels
  5091 00002320 66C1E003                	shl	ax, 3
  5092                                  			; hw = row, ax = column
  5093 00002324 A3[B4720000]            	mov	[screenpos], eax
  5094                                  	; 22/12/2024
  5095 00002329 31C0                    	xor	eax, eax
  5096 0000232B C3                      	retn
  5097                                  	
  5098                                  ; --------------------------------------------------------
  5099                                  ; 14/11/2024
  5100                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5101                                  
  5102                                  ;; NAME:	SetTotalTime
  5103                                  ;; DESCRIPTION: Calculates the total time in seconds in file
  5104                                  ;; INPUT:	DATA_SubchunkSize, WAVE_SampleRate, WAVE_BlockAlign
  5105                                  ;; OUTPUT:	CurrentTotalTime=Total time in seconds in file,
  5106                                  ;; 		Output on the screen of the total time in seconds
  5107                                  
  5108                                  	; 01/12/2024 (32 bit registers)
  5109                                  SetTotalTime:
  5110                                  	;; Calculate total seconds in file
  5111                                  	;mov	ax, [DATA_SubchunkSize]
  5112                                  	;mov	dx, [DATA_SubchunkSize + 2]
  5113                                  	;mov	bx, [WAVE_SampleRate]
  5114                                  	;div	bx
  5115                                  	;xor	dx, dx
  5116                                  	; 01/12/2024
  5117 0000232C A1[F8720000]            	mov	eax, [DATA_SubchunkSize]
  5118 00002331 0FB71D[E8720000]        	movzx	ebx, word [WAVE_SampleRate]
  5119 00002338 31D2                    	xor	edx, edx
  5120 0000233A F7F3                    	div	ebx
  5121                                  
  5122                                  	;mov	bx, [WAVE_BlockAlign]
  5123                                  	;div	bx
  5124                                  	; 01/12/2024
  5125 0000233C 668B1D[F0720000]        	mov	bx, [WAVE_BlockAlign]
  5126 00002343 31D2                    	xor	edx, edx
  5127 00002345 F7F3                    	div	ebx
  5128                                  
  5129                                  	;mov	[TotalTime], ax
  5130 00002347 A3[70730000]            	mov	[TotalTime], eax
  5131                                  
  5132 0000234C B33C                    	mov	bl, 60
  5133 0000234E F6F3                    	div	bl
  5134                                  
  5135                                  	;; al = minutes, ah = seconds
  5136 00002350 50                      	push	eax ; **
  5137 00002351 50                      	push	eax ; *
  5138                                  
  5139                                  	;mov	dh, 24
  5140                                  	; 21/12/2024 (640*480)
  5141 00002352 B620                    	mov	dh, 32
  5142 00002354 B22A                    	mov	dl, 42
  5143 00002356 E8B6FFFFFF              	call	setCursorPosition
  5144                                  
  5145 0000235B 58                      	pop	eax ; *
  5146 0000235C 30E4                    	xor	ah, ah
  5147 0000235E BD02000000              	mov	ebp, 2
  5148 00002363 E812000000              	call	PrintNumber
  5149                                  	
  5150                                  	;mov	dh, 24
  5151                                  	; 21/12/2024 (640*480)
  5152 00002368 B620                    	mov	dh, 32
  5153 0000236A B22D                    	mov	dl, 45
  5154 0000236C E8A0FFFFFF              	call	setCursorPosition
  5155                                  
  5156 00002371 58                      	pop	eax ; **
  5157 00002372 88E0                    	mov	al, ah
  5158 00002374 30E4                    	xor	ah, ah
  5159                                  	; 21/12/2024
  5160 00002376 66BD0200                	mov	bp, 2
  5161                                  	;jmp	short PrintNumber
  5162                                  
  5163                                  ; --------------------------------------------------------
  5164                                  
  5165                                  	; 21/12/2024 (write numbers in VESA VBE graphics mode)
  5166                                  	; 01/12/2024 (32bit registers)
  5167                                  PrintNumber:
  5168                                  	; eax = binary number
  5169                                  	; ebp = digits
  5170 0000237A 8B35[B4720000]          	mov	esi, [screenpos]
  5171                                  		; hw = row, si = column
  5172 00002380 BB0A000000              	mov	ebx, 10
  5173 00002385 31C9                    	xor	ecx, ecx
  5174                                  printNumber_CutNumber:
  5175 00002387 41                      	inc	ecx
  5176 00002388 31D2                    	xor	edx, edx
  5177 0000238A F7F3                    	div	ebx
  5178 0000238C 52                      	push	edx
  5179 0000238D 39E9                    	cmp	ecx, ebp
  5180 0000238F 7402                    	je	short printNumber_printloop
  5181 00002391 EBF4                    	jmp	printNumber_CutNumber
  5182                                  
  5183                                  printNumber_printloop:
  5184 00002393 58                      	pop	eax
  5185                                  	; 21/12/2024
  5186                                  	; ebp = count of digits
  5187                                  	; eax <= 9
  5188                                  
  5189 00002394 0430                    	add	al, '0'
  5190                                  	
  5191                                  	; esi = pixel position (hw = row, si = column)
  5192                                  	; eax = al = character
  5193                                  	;call	write_character
  5194                                  	; 22/12/2024
  5195 00002396 E818010000              	call	write_character_white
  5196                                  
  5197 0000239B 4D                      	dec	ebp
  5198 0000239C 7405                     	jz	short printNumber_ok
  5199 0000239E 83C608                  	add	esi, 8	; next column
  5200 000023A1 EBF0                    	jmp	short printNumber_printloop
  5201                                  printNumber_ok:
  5202 000023A3 C3                      	retn
  5203                                  
  5204                                  ; --------------------------------------------------------
  5205                                  
  5206                                  	; 14/11/2024 - Erdogan Tan
  5207                                  SetProgressTime:
  5208                                  	;; Calculate playing/progress seconds in file
  5209 000023A4 E835000000              	call	CalcProgressTime
  5210                                  
  5211                                  	; 01/12/2024 (32bit registers)
  5212                                  UpdateProgressTime:
  5213                                  	; eax = (new) progress time 
  5214                                  
  5215 000023A9 A3[74730000]            	mov	[ProgressTime], eax
  5216                                  
  5217 000023AE B33C                    	mov	bl, 60
  5218 000023B0 F6F3                    	div	bl
  5219                                  
  5220                                  	;; al = minutes, ah = seconds
  5221 000023B2 50                      	push	eax ; **
  5222 000023B3 50                      	push	eax ; *
  5223                                  
  5224                                  	;mov	dh, 24
  5225                                  	; 21/12/2024 (640*480)
  5226 000023B4 B620                    	mov	dh, 32
  5227 000023B6 B221                    	mov	dl, 33
  5228 000023B8 E854FFFFFF              	call	setCursorPosition
  5229                                  
  5230 000023BD 58                      	pop	eax ; *
  5231 000023BE 30E4                    	xor	ah, ah
  5232 000023C0 BD02000000              	mov	ebp, 2
  5233 000023C5 E8B0FFFFFF              	call	PrintNumber
  5234                                  	
  5235                                  	;mov	dh, 24
  5236                                  	; 21/12/2024 (640*480)
  5237 000023CA B620                    	mov	dh, 32
  5238 000023CC B224                    	mov	dl, 36
  5239 000023CE E83EFFFFFF              	call	setCursorPosition
  5240                                  
  5241 000023D3 58                      	pop	eax ; **
  5242 000023D4 88E0                    	mov	al, ah
  5243 000023D6 30E4                    	xor	ah, ah
  5244                                  	; 21/12/2024
  5245 000023D8 66BD0200                	mov	bp, 2
  5246 000023DC EB9C                    	jmp	short PrintNumber
  5247                                  
  5248                                  ; --------------------------------------------------------
  5249                                  
  5250                                  	; 01/12/2024 (32bit registers)
  5251                                  	; 17/11/2024
  5252                                  	; 14/11/2024
  5253                                  CalcProgressTime:
  5254                                  	;mov	ax, [LoadedDataBytes]
  5255                                  	;mov	dx, [LoadedDataBytes+2]
  5256                                  	;mov	bx, ax
  5257                                  	;or	bx, dx
  5258                                  	;jz	short cpt_ok
  5259                                  	; 01/12/2024
  5260 000023DE A1[7C730000]            	mov	eax, [LoadedDataBytes]
  5261 000023E3 09C0                    	or	eax, eax
  5262 000023E5 7416                    	jz	short cpt_ok
  5263                                  
  5264                                  	;mov	bx, [WAVE_SampleRate]
  5265                                  	;div	bx
  5266                                  	;xor	dx, dx
  5267                                  	;mov	bx, [WAVE_BlockAlign]
  5268                                  	;div	bx
  5269                                  	; 01/12/2024
  5270 000023E7 0FB71D[E8720000]        	movzx	ebx, word [WAVE_SampleRate]
  5271 000023EE 31D2                    	xor	edx, edx
  5272 000023F0 F7F3                    	div	ebx
  5273 000023F2 31D2                    	xor	edx, edx
  5274 000023F4 668B1D[F0720000]        	mov	bx, [WAVE_BlockAlign]
  5275 000023FB F7F3                    	div	ebx
  5276                                  cpt_ok:
  5277                                  	; eax = (new) progress time
  5278 000023FD C3                      	retn
  5279                                  
  5280                                  ; --------------------------------------------------------
  5281                                  ; 14/11/2024
  5282                                  ; (Ref: player.asm, out_cs.asm, Matan Alfasi, 2017)
  5283                                  
  5284                                  ;; DESCRIPTION: Update file information on template
  5285                                  ;; PARAMS:	WAVE parameters and other variables
  5286                                  ;; REGS:	AX(RW)
  5287                                  ;; VARS:	CurrentFileName, WAVE_SampleRate, 
  5288                                  ;; RETURNS:	On-screen file info is updated.
  5289                                  
  5290                                  	; 01/12/2024 (32bit registers)
  5291                                  UpdateFileInfo:
  5292                                  	;; Print File Name
  5293                                  	;mov	dh, 9
  5294                                  	; 21/12/2024 (640*480 graphics display)
  5295 000023FE B608                    	mov	dh, 8
  5296 00002400 B217                    	mov	dl, 23
  5297 00002402 E80AFFFFFF              	call	setCursorPosition
  5298                                  	
  5299 00002407 BE[04730000]            	mov	esi, wav_file_name
  5300                                  	
  5301                                  	;;;
  5302                                  	; 14/11/2024
  5303                                  	; skip directory separators
  5304                                  	; (note: asciiz string, max. 79 bytes except zero tail)
  5305 0000240C 89F3                    	mov	ebx, esi
  5306                                  chk4_nxt_sep:
  5307 0000240E AC                      	lodsb
  5308 0000240F 3C2F                    	cmp	al, '/'	; 14/12/2024
  5309 00002411 7406                    	je	short chg_fpos
  5310 00002413 20C0                    	and	al, al
  5311 00002415 7406                    	jz	short chg_fpos_ok
  5312 00002417 EBF5                    	jmp	short chk4_nxt_sep
  5313                                  chg_fpos:
  5314 00002419 89F3                    	mov	ebx, esi
  5315 0000241B EBF1                    	jmp	short chk4_nxt_sep
  5316                                  chg_fpos_ok:
  5317 0000241D 89DE                    	mov	esi, ebx ; file name (without its path/directory)
  5318                                  	;;;
  5319                                  
  5320 0000241F E870000000              	call	PrintString
  5321                                  	
  5322                                  	;; Print Frequency
  5323                                  	;mov	dh, 10
  5324                                  	; 21/12/2024 (640*480 graphics display)
  5325 00002424 B609                    	mov	dh, 9
  5326 00002426 B217                    	mov	dl, 23
  5327 00002428 E8E4FEFFFF              	call	setCursorPosition
  5328                                  	;movzx	eax, word [WAVE_SampleRate]
  5329                                  	; 22/12/2024
  5330                                  	; eax = 0
  5331 0000242D 66A1[E8720000]          	mov	ax, [WAVE_SampleRate]
  5332 00002433 BD05000000              	mov	ebp, 5
  5333 00002438 E83DFFFFFF              	call	PrintNumber
  5334                                  
  5335                                  	;; Print BitRate
  5336                                  	;mov	dh, 9
  5337                                  	; 21/12/2024 (640*480 graphics display)
  5338 0000243D B608                    	mov	dh, 8
  5339 0000243F B239                    	mov	dl, 57
  5340 00002441 E8CBFEFFFF              	call	setCursorPosition
  5341 00002446 66A1[F2720000]          	mov	ax, [WAVE_BitsPerSample]
  5342 0000244C 66BD0200                	mov	bp, 2
  5343 00002450 E825FFFFFF              	call	PrintNumber
  5344                                  
  5345                                  	;; Print Channel Number
  5346                                  	;mov	dh, 10
  5347                                  	; 21/12/2024 (640*480 graphics display)
  5348 00002455 B609                    	mov	dh, 9
  5349 00002457 B239                    	mov	dl, 57
  5350 00002459 E8B3FEFFFF              	call	setCursorPosition
  5351 0000245E 66A1[E6720000]          	mov	ax, [WAVE_NumChannels]
  5352 00002464 66BD0100                	mov	bp, 1
  5353 00002468 E80DFFFFFF              	call	PrintNumber
  5354                                  
  5355                                  	;call	UpdateVolume
  5356                                  	;retn
  5357                                  
  5358                                  ; --------------------------------------------------------
  5359                                  
  5360                                  	; 14/11/2024
  5361                                  UpdateVolume:
  5362                                  	;; Print Volume
  5363                                  	;mov	dh, 24
  5364                                  	; 21/12/2024 (640*480)
  5365 0000246D B620                    	mov	dh, 32
  5366 0000246F B24B                    	mov	dl, 75
  5367 00002471 E89BFEFFFF              	call	setCursorPosition
  5368                                  	; 22/12/2024
  5369                                  	; eax = 0
  5370                                  
  5371 00002476 A0[10230000]            	mov	al, [volume]
  5372                                  
  5373 0000247B B364                    	mov	bl, 100
  5374 0000247D F6E3                    	mul	bl
  5375                                  
  5376 0000247F B31F                    	mov	bl, 31
  5377 00002481 F6F3                    	div	bl
  5378                                  
  5379                                  	;neg	ax
  5380                                  	;add	ax, 100	
  5381                                  	; 01/12/2024
  5382 00002483 B464                    	mov	ah, 100
  5383 00002485 28C4                    	sub	ah, al
  5384 00002487 0FB6C4                  	movzx	eax, ah
  5385                                  	;xor	ah, ah
  5386                                  	;mov	bp, 3
  5387 0000248A BD03000000              	mov	ebp, 3
  5388                                  	;call	PrintNumber
  5389                                  	;retn
  5390 0000248F E9E6FEFFFF              	jmp	PrintNumber	
  5391                                  
  5392                                  ; --------------------------------------------------------
  5393                                  
  5394                                  	; 21/12/2024
  5395                                  	; write text in VESA VBE graphics mode
  5396                                  PrintString:
  5397                                  	; esi = string address
  5398                                  printstr_loop:
  5399 00002494 31C0                    	xor	eax, eax
  5400 00002496 AC                      	lodsb
  5401 00002497 08C0                    	or	al, al
  5402 00002499 7417                    	jz	short printstr_ok
  5403                                  
  5404 0000249B 56                      	push	esi
  5405                                  
  5406 0000249C 8B35[B4720000]          	mov	esi, [screenpos]
  5407                                  
  5408                                  	; esi = pixel position (hw = row, si = column)
  5409                                  	; eax = al = character
  5410                                  	;call	write_character
  5411                                  	; 22/12/2024
  5412 000024A2 E80C000000              	call	write_character_white
  5413                                  
  5414 000024A7 668305[B4720000]08      	add	word [screenpos], 8 ; update column (only, not row)
  5415                                  
  5416 000024AF 5E                      	pop	esi
  5417 000024B0 EBE2                    	jmp	short printstr_loop
  5418                                  
  5419                                  printstr_ok:
  5420 000024B2 C3                      	retn
  5421                                  
  5422                                  ; --------------------------------------------------------
  5423                                  
  5424                                  	; 21/12/2024
  5425                                  	; write character (at cursor position)
  5426                                  	; in graphics mode (640*480, 256 colors)
  5427                                  	; 22/12/2024
  5428                                  write_character_white:
  5429 000024B3 B90F000000              	mov	ecx, 0Fh
  5430                                  write_character:
  5431                                  	; esi = pixel position (hw = row, si = column)
  5432                                  	; eax = al = character
  5433                                  	; cl = color
  5434 000024B8 890D[B8720000]          	mov	[wcolor], ecx ; 22/12/2024
  5435                                  
  5436                                  	; 22/12/2024
  5437 000024BE 50                      	push	eax
  5438                                  	; clear previous character pixels
  5439 000024BF BF[563F0000]            	mov	edi, fillblock
  5440                                  	sys	_video, 020Fh, 0, 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000024C4 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000024C9 B900000000          <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000024CE BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000024D3 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000024D8 CD40                <1>  int 40h
  5441 000024DA 58                      	pop	eax
  5442                                  
  5443 000024DB C1E004                  	shl	eax, 4 ; 8*16 pixel user font
  5444 000024DE BF[704D0000]            	mov	edi, fontbuff2 ; start of user font data
  5445 000024E3 01C7                    	add	edi, eax
  5446                                  
  5447                                  	; 21/12/2024
  5448                                  	; NOTE:
  5449                                  	; TRDOS 386 does not use 8*14 pixel fonts in sysvideo
  5450                                  	; system calls -in graphics mode-
  5451                                  	; because 8*16 pixel operations are faster
  5452                                  	;			than 8*14 pixel operations.
  5453                                  	; ((so, 8*14 fonts can be converted to 8*16 fonts by
  5454                                  	; adding 2 empty lines))
  5455                                  	; (8*14 characters can be written via pixel operations)
  5456                                    	
  5457                                  	; 21/12/2024 (TRDOS 386 v2.0.9, trdosk6.s, 27/09/2024)
  5458                                  	;;;;;;;;;;;;;;;;; ; sysvideo system call
  5459                                  	;sysvideo:
  5460                                  	;   function in BH
  5461                                  	;	02h: Super VGA, LINEAR FRAME BUFFER data transfers
  5462                                  	;   sub function in BL
  5463                                  	;	0Fh: WRITE CHARACTER (FONT)
  5464                                  	;          CL = char's color (8 bit, 256 colors)
  5465                                  	;	If DH bit 7 = 1
  5466                                  	;	   USER FONT (from user buffer)
  5467                                  	;	         DL = 1 -> 8x16 pixel font
  5468                                   	;	   EDI = user's font buffer address
  5469                                  	;		(NOTE: byte order is as row0,row1,row2..)
  5470                                  	;	   ESI = start position (row, column)
  5471                                  	;		(HW = row, SI = column)
  5472                                  	;;;;;;;;;;;;;;;;;
  5473                                  
  5474                                  	sys	_video, 020Fh, [wcolor], 8001h
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000024E5 BB0F020000          <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90 000024EA 8B0D[B8720000]      <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92 000024F0 BA01800000          <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000024F5 B81F000000          <1>  mov eax, %1
    97                              <1> 
    98 000024FA CD40                <1>  int 40h
  5475                                  
  5476 000024FC C3                      	retn
  5477                                  
  5478                                  ; --------------------------------------------------------
  5479                                  
  5480                                  	; 22/12/2024
  5481                                  	; 21/12/2024
  5482                                  	; (write chars in VESA VBE graphics mode)
  5483                                  	; 14/11/2024
  5484                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5485                                  	; (Modification: Erdogan Tan, 14/11/2024)
  5486                                  
  5487                                  	;PROGRESSBAR_ROW equ 23
  5488                                  	; 21/12/2024 (640*480)
  5489                                  	PROGRESSBAR_ROW equ 31
  5490                                  
  5491                                  UpdateProgressBar:
  5492 000024FD E8A2FEFFFF              	call	SetProgressTime	; 14/11/2024
  5493                                  
  5494                                  	; 01/12/2024 (32bit registers)
  5495 00002502 A1[74730000]            	mov	eax, [ProgressTime]
  5496                                  UpdateProgressBar@:
  5497 00002507 BA50000000              	mov	edx, 80
  5498 0000250C F7E2                    	mul	edx
  5499 0000250E 8B1D[70730000]          	mov	ebx, [TotalTime]
  5500 00002514 F7F3                    	div	ebx
  5501                                  
  5502                                  	; 22/12/2024
  5503                                  	; check progress bar indicator position if it is same 
  5504 00002516 3A05[BE720000]          	cmp	al, [pbprev]
  5505 0000251C 7430                    	je	short UpdateProgressBar_ok
  5506 0000251E A2[BE720000]            	mov	[pbprev], al
  5507                                  
  5508                                  UpdateProgressBar@@:
  5509                                  	;; Push for the 'Clean' part
  5510 00002523 50                      	push	eax ; **
  5511 00002524 50                      	push	eax ; *
  5512                                  
  5513                                  	;; Set cursor position
  5514 00002525 B61F                    	mov	dh, PROGRESSBAR_ROW
  5515 00002527 B200                    	mov	dl, 0
  5516 00002529 E8E3FDFFFF              	call	setCursorPosition
  5517                                  
  5518 0000252E 58                      	pop	eax ; *
  5519 0000252F 09C0                    	or	eax, eax
  5520 00002531 742D                    	jz	short UpdateProgressBar_Clean
  5521                                  
  5522                                  UpdateProgressBar_DrawProgress:
  5523                                  	; 22/12/2024
  5524                                  	; 21/12/2024
  5525                                  	; (write progress bar chars in graphics mode)
  5526                                  	;;;;
  5527 00002533 89C5                    	mov	ebp, eax
  5528 00002535 50                      	push	eax ; ***
  5529 00002536 8B35[B4720000]          	mov	esi, [screenpos]
  5530                                  UpdateProgressBar_DrawProgress_@:
  5531 0000253C B8DF000000              	mov	eax, 223
  5532                                  	
  5533                                  	; esi = pixel position (hw = row, si = column)
  5534                                  	; eax = al = character
  5535                                  	;call	write_character
  5536                                  	; 22/12/2024
  5537 00002541 E86DFFFFFF              	call	write_character_white
  5538                                  
  5539 00002546 4D                      	dec	ebp
  5540 00002547 7406                    	jz	short UpdateProgressBar_DrawCursor
  5541                                  
  5542 00002549 83C608                  	add	esi, 8 ; next column
  5543 0000254C EBEE                    	jmp	short UpdateProgressBar_DrawProgress_@
  5544                                  	;;;
  5545                                  
  5546                                  UpdateProgressBar_ok:
  5547 0000254E C3                      	retn
  5548                                  
  5549                                  UpdateProgressBar_DrawCursor:
  5550                                  	; 22/12/2024
  5551 0000254F 5A                      	pop	edx ; ***
  5552 00002550 B61F                    	mov	dh, PROGRESSBAR_ROW
  5553 00002552 E8BAFDFFFF              	call	setCursorPosition
  5554                                  
  5555                                  	; 21/12/2024
  5556                                  	; (write progress bar character in graphics mode)
  5557                                  	;;;;
  5558                                  	;;;mov	eax, 223
  5559                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5560                                  	;;mov	eax, 223*16
  5561                                  	;;mov	edi, fontbuff2 ; start of user font data
  5562                                  	;;add	edi, eax
  5563                                  	;mov	edi, fontbuff2+(223*16)
  5564                                  	;
  5565                                  	;sys	_video, 020Fh, 0Ch, 8001h
  5566                                  	; 22/12/2024
  5567                                  	;mov	eax, 223
  5568                                  	; eax = 0
  5569 00002557 B0DF                    	mov	al, 223
  5570 00002559 B10C                    	mov	cl, 0Ch ; red
  5571 0000255B E858FFFFFF              	call	write_character
  5572                                  	;;;;
  5573                                  
  5574                                  UpdateProgressBar_Clean:
  5575                                  	;pop	eax  ; **
  5576                                  	; 22/12/2024
  5577 00002560 5A                      	pop	edx  ; **
  5578                                  	; 21/12/2024
  5579 00002561 BD50000000              	mov	ebp, 80
  5580                                  	;sub	bp, ax
  5581 00002566 6629D5                  	sub	bp, dx ; 22/12/2024
  5582 00002569 74E3                    	jz	short UpdateProgressBar_ok
  5583                                  
  5584 0000256B B61F                    	mov	dh, PROGRESSBAR_ROW
  5585                                  	;mov	dl, al ; 22/12/2024
  5586 0000256D E89FFDFFFF              	call	setCursorPosition
  5587                                  
  5588                                  	; 21/12/2024
  5589                                  	; (write progress bar chars in graphics mode)
  5590                                  	;;;;
  5591 00002572 8B35[B4720000]          	mov	esi, [screenpos]
  5592                                  UpdateProgressBar_Clean_@:
  5593                                  	;;;mov	eax, 223
  5594                                  	;;;shl	eax, 4 ; 8*16 pixel user font
  5595                                  	;;mov	eax, 223*16
  5596                                  	;mov	edi, fontbuff2 ; start of user font data
  5597                                  	;add	edi, eax
  5598                                  	;mov	edi, fontbuff2+(223*16)
  5599                                  	;
  5600                                  	;sys	_video, 020Fh, 08h, 8001h
  5601                                  	; 22/12/2024
  5602                                  	;mov	eax, 223
  5603                                  	; eax = 0
  5604 00002578 B0DF                    	mov	al, 223
  5605 0000257A B108                    	mov	cl, 08h ; gray (dark)
  5606 0000257C E837FFFFFF              	call	write_character
  5607                                  	;;;;
  5608                                  
  5609 00002581 4D                      	dec	ebp
  5610 00002582 74CA                    	jz	short UpdateProgressBar_ok
  5611                                  
  5612 00002584 83C608                  	add	esi, 8 ; next column
  5613 00002587 EBEF                    	jmp	short UpdateProgressBar_Clean_@
  5614                                  	;;;;
  5615                                  
  5616                                  ; --------------------------------------------------------
  5617                                  ; 17/11/2024
  5618                                  
  5619                                  Player_ProcessKey_Backwards:
  5620                                  	;; In order to go backwards 5 seconds:
  5621                                  	;; Update file pointer to the beginning, skip headers
  5622 00002589 B142                    	mov	cl, 'B'
  5623 0000258B EB02                    	jmp	short Player_ProcessKey_B_or_F
  5624                                  
  5625                                  Player_ProcessKey_Forwards:
  5626                                  	;; In order to fast-forward 5 seconds, set the file pointer
  5627                                  	;; to CUR_SEEK + 5 * Freq
  5628                                  
  5629 0000258D B146                    	mov	cl, 'F'
  5630                                  	;jmp	short Player_ProcessKey_B_or_F
  5631                                  
  5632                                  	; 01/12/2024 (32bit regsisters)
  5633                                  Player_ProcessKey_B_or_F:
  5634                                  	; 17/11/2024
  5635                                  	; 04/11/2024
  5636                                  	; (Ref: player.asm, Matan Alfasi, 2017)
  5637                                    
  5638                                  	; 04/11/2024
  5639 0000258F B805000000              	mov	eax, 5
  5640 00002594 0FB71D[F0720000]        	movzx	ebx, word [WAVE_BlockAlign]
  5641 0000259B F7E3                    	mul	ebx
  5642 0000259D 668B1D[E8720000]        	mov	bx, [WAVE_SampleRate]
  5643 000025A4 F7E3                    	mul	ebx
  5644                                  	; eax = transfer byte count for 5 seconds
  5645                                  	
  5646                                  	; 17/11/2024
  5647 000025A6 80F942                  	cmp	cl, 'B'
  5648                                  	;mov	bx, [LoadedDataBytes]
  5649                                  	;mov	cx, [LoadedDataBytes+2]
  5650                                  	; 01/12/2024
  5651 000025A9 8B0D[7C730000]          	mov	ecx, [LoadedDataBytes]
  5652 000025AF 7508                    	jne	short move_forward ; cl = 'F'
  5653                                  move_backward:
  5654                                  	;sub	bx, ax
  5655                                  	;sbb	cx, dx
  5656 000025B1 29C1                    	sub	ecx, eax
  5657 000025B3 7316                    	jnc	short move_file_pointer
  5658                                  move_to_beginning:
  5659                                  	;xor	cx, cx ; 0
  5660                                  	;xor	bx, bx ; 0
  5661 000025B5 31C9                    	xor	ecx, ecx
  5662 000025B7 EB12                    	jmp	short move_file_pointer
  5663                                  move_forward: 
  5664                                  	;add	bx, ax
  5665                                  	;adc	cx, dx
  5666 000025B9 01C1                    	add	ecx, eax
  5667 000025BB 7208                    	jc	short move_to_end
  5668                                  	;cmp	cx, [DATA_SubchunkSize+2]
  5669                                  	;ja	short move_to_end
  5670                                  	;jb	short move_file_pointer
  5671                                  	;cmp	bx, [DATA_SubchunkSize]
  5672                                  	;jna	short move_file_pointer
  5673 000025BD 3B0D[F8720000]          	cmp	ecx, [DATA_SubchunkSize]
  5674 000025C3 7606                    	jna	short move_file_pointer
  5675                                  move_to_end:
  5676                                  	;mov	bx, [DATA_SubchunkSize]
  5677                                  	;mov	cx, [DATA_SubchunkSize+2]
  5678 000025C5 8B0D[F8720000]          	mov	ecx, [DATA_SubchunkSize]
  5679                                  move_file_pointer:
  5680                                  	;mov	dx, bx    
  5681                                  	;mov	[LoadedDataBytes], dx
  5682                                  	;mov	[LoadedDataBytes+2], cx
  5683 000025CB 890D[7C730000]          	mov	[LoadedDataBytes], ecx
  5684                                  	;add	dx, 44 ; + header
  5685                                  	;adc	cx, 0
  5686 000025D1 83C12C                  	add	ecx, 44 
  5687                                  
  5688                                  	; seek
  5689                                  	;mov	bx, [filehandle]
  5690                                  	;mov	ax, 4200h
  5691                                  	;int	21h
  5692                                  	; 01/12/2024
  5693 000025D4 31D2                    	xor	edx, edx ; offset from beginning of the file
  5694                                  	; ecx = offset	
  5695                                  	; ebx = file handle
  5696                                  	; edx = 0
  5697                                  	sys	_seek, [filehandle]
    83                              <1> 
    84                              <1> 
    85                              <1> 
    86                              <1> 
    87                              <1>  %if %0 >= 2
    88 000025D6 8B1D[00730000]      <1>  mov ebx, %2
    89                              <1>  %if %0 >= 3
    90                              <1>  mov ecx, %3
    91                              <1>  %if %0 = 4
    92                              <1>  mov edx, %4
    93                              <1>  %endif
    94                              <1>  %endif
    95                              <1>  %endif
    96 000025DC B813000000          <1>  mov eax, %1
    97                              <1> 
    98 000025E1 CD40                <1>  int 40h
  5698 000025E3 C3                      	retn
  5699                                  
  5700                                  ; --------------------------------------------------------
  5701                                  
  5702                                  	; 22/12/2024 (VESA VBE mode graphics) 
  5703                                  	; (640*480, 256 colors)
  5704                                  clear_window:
  5705 000025E4 8B3D[B0720000]          	mov	edi, [LFB_ADDR]
  5706 000025EA 81C700C70100            	add	edi, (13*80*8*14)
  5707 000025F0 29C0                    	sub	eax, eax
  5708 000025F2 B9008C0000              	mov	ecx, (16*640*14)/4 ; 16 rows
  5709 000025F7 F3AB                    	rep	stosd
  5710 000025F9 C3                      	retn
  5711                                  
  5712                                  ; --------------------------------------------------------
  5713                                  
  5714                                  	; 22/12/2024
  5715                                  	; 21/12/2024
  5716                                  	; (simulate wave leds in graphics mode)
  5717                                  	; (640*480, 256 colors)
  5718                                  reset_wave_leds:
  5719                                  	; 22/12/2024
  5720 000025FA C705[70710000]0000-     	mov	dword [prev_leds], 0
  5720 00002602 0000               
  5721                                  	;
  5722 00002604 BD00050000              	mov	ebp, 16*80 ; 80 columns with 16 levels
  5723 00002609 BE[705D0000]            	mov	esi, wleds_addr
  5724                                  next_led:
  5725 0000260E AD                      	lodsd
  5726 0000260F 89C7                    	mov	edi, eax
  5727 00002611 BA0E000000              	mov	edx, 14 ; 14 lines (8*14 pixel font)
  5728 00002616 BB[505D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5729                                  led_line:
  5730 0000261B 8A23                    	mov	ah, [ebx]
  5731 0000261D B908000000              	mov	ecx, 8 ; 8 pixels (8*16 pixel font)
  5732                                  next_pixel:
  5733 00002622 D0E4                    	shl	ah, 1
  5734 00002624 7308                    	jnc	short skip_this
  5735 00002626 B008                    	mov	al, 8 ; gray
  5736 00002628 AA                      	stosb
  5737 00002629 49                      	dec	ecx
  5738 0000262A 75F6                    	jnz	short next_pixel
  5739 0000262C EB06                    	jmp	short next_line
  5740                                  skip_this:
  5741 0000262E B000                    	mov	al, 0 ; black
  5742 00002630 AA                      	stosb
  5743 00002631 49                      	dec	ecx
  5744 00002632 75EE                    	jnz	short next_pixel
  5745                                  next_line:
  5746 00002634 4A                      	dec	edx
  5747 00002635 7504                    	jnz	short next_line_@
  5748 00002637 4D                      	dec	ebp
  5749 00002638 75D4                    	jnz	short next_led
  5750 0000263A C3                      	retn
  5751                                  next_line_@:
  5752                                  	; 22/12/2024
  5753 0000263B 81C778020000            	add	edi, 640-8 ; next line
  5754 00002641 43                      	inc	ebx
  5755 00002642 EBD7                    	jmp	short led_line	
  5756                                  
  5757                                  ; --------------------------------------------------------
  5758                                  
  5759                                  	; 22/12/2024 (graphics mode)
  5760                                  	; 09/12/2024
  5761                                  	; 19/11/2024
  5762                                  UpdateWaveLeds:
  5763                                  	; 23/11/2024
  5764                                  	;call	reset_wave_leds
  5765                                  	; 22/12/2024 (faster method, 80 against 80*16)
  5766                                  	; turn off previously lighting wave leds at first
  5767                                  	;;;
  5768 00002644 BE[70710000]            	mov	esi, prev_leds
  5769 00002649 833E00                  	cmp	dword [esi], 0
  5770 0000264C 7433                    	jz	short UpdateWaveLeds_ok
  5771 0000264E B950000000              	mov	ecx, 80
  5772                                  turn_off_led:
  5773 00002653 AD                      	lodsd
  5774 00002654 89C7                    	mov	edi, eax
  5775                                  	; edi = wave led address
  5776 00002656 BD0E000000              	mov	ebp, 14
  5777 0000265B BB[505D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5778 00002660 31D2                    	xor	edx, edx
  5779 00002662 B008                    	mov	al, 8 ; gray (dark)
  5780                                  toffl_next_line:
  5781                                  	;;mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5782                                  	;mov	dl, 8
  5783 00002664 88C2                    	mov	dl, al ; 8
  5784 00002666 8A23                    	mov	ah, [ebx]
  5785                                  toffl_next_pixel:
  5786 00002668 D0E4                    	shl	ah, 1
  5787 0000266A 7310                    	jnc	short toffl_skip_this
  5788 0000266C AA                      	stosb
  5789                                  toffl_next_pixel_@:
  5790 0000266D 4A                      	dec	edx
  5791 0000266E 75F8                    	jnz	short toffl_next_pixel
  5792 00002670 4D                      	dec	ebp
  5793 00002671 740C                    	jz	short toffl_next_led
  5794 00002673 81C778020000            	add	edi, 640-8 ; next line
  5795 00002679 43                      	inc	ebx
  5796 0000267A EBE8                    	jmp	short toffl_next_line
  5797                                  toffl_skip_this:
  5798 0000267C 47                      	inc	edi
  5799 0000267D EBEE                    	jmp	short toffl_next_pixel_@
  5800                                  toffl_next_led:
  5801 0000267F E2D2                    	loop	turn_off_led
  5802                                  UpdateWaveLeds_ok:
  5803                                  	;;;
  5804                                  	; 09/12/2024
  5805                                  	;jmp	short turn_on_leds
  5806                                  
  5807                                  ; --------------------------------------------------------
  5808                                  
  5809                                  	; 21/12/2024 (VESA VBE Mode, 640*480, 256 colors)
  5810                                  	; 09/12/2024
  5811                                  	; 01/12/2024 (TRDOS 386, 32bit registers, flat memory)
  5812                                  	; 23/11/2024 (Retro DOS, 16bit registers, segmented)
  5813                                  	; 21/11/2024, 22/11/2024
  5814                                  	; 19/11/2024
  5815                                  turn_on_leds:
  5816                                  	; 09/12/2024
  5817                                  	; 07/12/2024
  5818 00002681 8A15[CD720000]          	mov	dl, [half_buffer]
  5819                                  tol_@:
  5820                                  	; 07/12/2024
  5821 00002687 3815[CC720000]          	cmp	[pbuf_s], dl
  5822 0000268D 7520                    	jne	short tol_ns_buf
  5823 0000268F 8B1D[C4720000]          	mov	ebx, [wleds_dif]
  5824 00002695 8B35[C8720000]          	mov	esi, [pbuf_o]
  5825 0000269B 8B0D[6C730000]          	mov	ecx, [buffersize] ; bytes
  5826 000026A1 29D9                    	sub	ecx, ebx ; sub ecx, [wleds_dif]
  5827 000026A3 01DE                    	add	esi, ebx
  5828 000026A5 7204                    	jc	short tol_o_@
  5829 000026A7 39CE                    	cmp	esi, ecx
  5830 000026A9 760C                    	jna	short tol_s_buf
  5831                                  tol_o_@:
  5832 000026AB 89CE                    	mov	esi, ecx
  5833 000026AD EB08                    	jmp	short tol_s_buf
  5834                                  
  5835                                  tol_ns_buf:
  5836 000026AF 8815[CC720000]          	mov	[pbuf_s], dl
  5837 000026B5 31F6                    	xor	esi, esi ; 0
  5838                                  tol_s_buf:
  5839 000026B7 8935[C8720000]          	mov	[pbuf_o], esi
  5840                                  
  5841                                  tol_buf_@:
  5842                                  	; 07/12/2024
  5843 000026BD 81C6[00800000]          	add	esi, audio_buffer
  5844 000026C3 B950000000              	mov	ecx, 80
  5845                                  	;xor	eax, eax ; 0
  5846 000026C8 BB[705D0000]            	mov	ebx, wleds_addr
  5847                                  	; 22/12/2024
  5848 000026CD BF[70710000]            	mov	edi, prev_leds
  5849                                  tol_fill_c:
  5850 000026D2 31C0                    	xor	eax, eax ; 0 ; 22/12/2024
  5851 000026D4 66AD                    	lodsw	; left
  5852                                  	; 23/01/2025
  5853 000026D6 80C480                  	add	ah, 80h
  5854 000026D9 89C2                    	mov	edx, eax
  5855 000026DB 66AD                    	lodsw	; right
  5856                                  	;add	ax, dx
  5857 000026DD 80C480                  	add	ah, 80h
  5858                                  	; 21/12/2024 (16 volume levels)
  5859                                  	;shr	eax, 12
  5860                                  	; 23/01/2025
  5861 000026E0 01D0                    	add	eax, edx ; L+R
  5862 000026E2 C1E80D                  	shr	eax, 13	; (L+R)/2 & 16 volume levels 
  5863                                  
  5864 000026E5 53                      	push	ebx ; *
  5865                                  	; 01/12/2024
  5866 000026E6 C1E002                  	shl	eax, 2
  5867 000026E9 01C3                    	add	ebx, eax
  5868                                  	; 01/12/2024 (32bit address)
  5869                                  	;mov	edi, [ebx]
  5870                                  	; 22/12/2024
  5871 000026EB 8B03                    	mov	eax, [ebx]
  5872 000026ED AB                      	stosd
  5873 000026EE 57                      	push	edi ; **
  5874 000026EF 89C7                    	mov	edi, eax
  5875                                  	;;;
  5876                                  	; 21/12/2024
  5877                                  	; (simulate wave leds in graphics mode)
  5878                                  	; (640*480, 256 colors)
  5879                                  turn_on_led:
  5880                                  	; edi = wave led address
  5881 000026F1 BD0E000000              	mov	ebp, 14
  5882 000026F6 BB[505D0000]            	mov	ebx, fontbuff2+(254*16) ; char = 254
  5883 000026FB A0[6E3F0000]            	mov	al, [ccolor]
  5884                                  tol_next_line:
  5885 00002700 BA08000000              	mov	edx, 8 ; 8 pixels (8*14 pixel font)
  5886 00002705 8A23                    	mov	ah, [ebx]
  5887                                  tol_next_pixel:
  5888 00002707 D0E4                    	shl	ah, 1
  5889 00002709 7310                    	jnc	short tol_skip_this
  5890 0000270B AA                      	stosb
  5891                                  tol_next_pixel_@:
  5892 0000270C 4A                      	dec	edx
  5893 0000270D 75F8                    	jnz	short tol_next_pixel
  5894 0000270F 4D                      	dec	ebp
  5895 00002710 740C                    	jz	short tol_next_led
  5896                                  	; 22/12/2024
  5897 00002712 81C778020000            	add	edi, 640-8 ; next line
  5898 00002718 43                      	inc	ebx
  5899 00002719 EBE5                    	jmp	short tol_next_line
  5900                                  tol_skip_this:
  5901 0000271B 47                      	inc	edi
  5902 0000271C EBEE                    	jmp	short tol_next_pixel_@
  5903                                  tol_next_led:
  5904                                  	; 22/12/2024
  5905 0000271E 5F                      	pop	edi ; **
  5906                                  	;;;
  5907 0000271F 5B                      	pop	ebx ; *
  5908 00002720 83C340                  	add	ebx, 16*4
  5909 00002723 E2AD                    	loop	tol_fill_c
  5910                                  
  5911 00002725 C3                      	retn
  5912                                  
  5913                                  ; -------------------------------------------------------------
  5914                                  
  5915                                  ; -------------------------------------------------------------
  5916                                  ; ac97.inc (11/11/2023)
  5917                                  ; -------------------------------------------------------------
  5918                                  
  5919                                  ; special characters
  5920                                  LF      EQU 10
  5921                                  CR      EQU 13
  5922                                  
  5923                                  ; PCI stuff
  5924                                  
  5925                                  ; Intel ICH2 equates. It is assumed that ICH0 and plain ole ICH are compatible.
  5926                                  
  5927                                  INTEL_VID       equ     8086h           ; Intel's PCI vendor ID
  5928                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  5929                                  SIS_VID		equ	1039h
  5930                                  NVIDIA_VID	equ	10DEh	 ; Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source c.
  5931                                  AMD_VID		equ	1022h
  5932                                  
  5933                                  ICH_DID         equ     2415h           ; ICH device ID
  5934                                  ICH0_DID        equ     2425h           ; ICH0
  5935                                  ICH2_DID        equ     2445h           ; ICH2 I think there are more ICHes.
  5936                                                                          ; they all should be compatible.
  5937                                  
  5938                                  ; 17/02/2017 (Erdogan Tan, ref: ALSA Device IDs, ALSA project)
  5939                                  ICH3_DID	equ     2485h           ; ICH3
  5940                                  ICH4_DID        equ     24C5h           ; ICH4
  5941                                  ICH5_DID	equ     24D5h           ; ICH5
  5942                                  ICH6_DID	equ     266Eh           ; ICH6
  5943                                  ESB6300_DID	equ     25A6h           ; 6300ESB
  5944                                  ESB631X_DID	equ     2698h           ; 631XESB
  5945                                  ICH7_DID	equ	27DEh		; ICH7
  5946                                  ; 03/11/2023 - Erdogan Tan (Ref: MenuetOS AC97 WAV Player source code, 2004)
  5947                                  MX82440_DID	equ	7195h
  5948                                  SI7012_DID	equ	7012h
  5949                                  NFORCE_DID	equ	01B1h
  5950                                  NFORCE2_DID	equ	006Ah
  5951                                  AMD8111_DID	equ	746Dh
  5952                                  AMD768_DID	equ	7445h
  5953                                  ; 03/11/2023 - Erdogan Tan - Ref: MPXPLAY/SBEMU/KOLIBRIOS AC97 source code
  5954                                  CK804_DID	equ	0059h
  5955                                  MCP04_DID	equ	003Ah
  5956                                  CK8_DID		equ	008Ah
  5957                                  NFORCE3_DID	equ	00DAh
  5958                                  CK8S_DID	equ	00EAh
  5959                                  
  5960                                  ; -------------------------------------------------------------
  5961                                  
  5962                                  ; 22/12/2024
  5963 00002726 90<rep 2h>              align 4
  5964                                  
  5965                                  ; 13/11/2024
  5966                                  ; ('<<' to 'shl' conversion for FASM)
  5967                                  ;
  5968                                  ; 29/05/2024 (TRDOS 386)
  5969                                  ; 17/02/2017
  5970                                  ; Valid ICH device IDs
  5971                                  
  5972                                  valid_ids:
  5973                                  	;dd (ICH_DID shl 16) + INTEL_VID	; 8086h:2415h
  5974 00002728 86801524                	dd (ICH_DID << 16) + INTEL_VID		; 8086h:2415h
  5975 0000272C 86802524                	dd (ICH0_DID << 16) + INTEL_VID		; 8086h:2425h
  5976 00002730 86804524                	dd (ICH2_DID << 16) + INTEL_VID		; 8086h:2445h
  5977 00002734 86808524                	dd (ICH3_DID << 16) + INTEL_VID		; 8086h:2485h
  5978 00002738 8680C524                	dd (ICH4_DID << 16) + INTEL_VID		; 8086h:24C5h
  5979 0000273C 8680D524                	dd (ICH5_DID << 16) + INTEL_VID		; 8086h:24D5h
  5980 00002740 86806E26                	dd (ICH6_DID << 16) + INTEL_VID		; 8086h:266Eh
  5981 00002744 8680A625                	dd (ESB6300_DID << 16) + INTEL_VID	; 8086h:25A6h
  5982 00002748 86809826                	dd (ESB631X_DID << 16) + INTEL_VID	; 8086h:2698h
  5983 0000274C 8680DE27                	dd (ICH7_DID << 16) + INTEL_VID		; 8086h:27DEh
  5984                                  	; 03/11/2023 - Erdogan Tan
  5985 00002750 86809571                	dd (MX82440_DID << 16) + INTEL_VID	; 8086h:7195h
  5986 00002754 39101270                	dd (SI7012_DID << 16)  + SIS_VID	; 1039h:7012h
  5987 00002758 DE10B101                	dd (NFORCE_DID << 16)  + NVIDIA_VID	; 10DEh:01B1h
  5988 0000275C DE106A00                	dd (NFORCE2_DID << 16) + NVIDIA_VID	; 10DEh:006Ah
  5989 00002760 22106D74                	dd (AMD8111_DID << 16) + AMD_VID	; 1022h:746Dh
  5990 00002764 22104574                	dd (AMD768_DID << 16)  + AMD_VID	; 1022h:7445h
  5991 00002768 DE105900                	dd (CK804_DID << 16) + NVIDIA_VID	; 10DEh:0059h
  5992 0000276C DE103A00                	dd (MCP04_DID << 16) + NVIDIA_VID	; 10DEh:003Ah
  5993 00002770 DE108A00                	dd (CK8_DID << 16) + NVIDIA_VID		; 1022h:008Ah
  5994 00002774 DE10DA00                	dd (NFORCE3_DID << 16) + NVIDIA_VID	; 10DEh:00DAh
  5995 00002778 DE10EA00                	dd (CK8S_DID << 16) + NVIDIA_VID	; 10DEh:00EAh
  5996                                  
  5997                                  valid_id_count equ (($ - valid_ids)>>2)	; 05/11/2023
  5998                                  ; 13/11/2024
  5999                                  ;valid_id_count = ($ - valid_ids) shr 2	; 05/11/2023
  6000                                  
  6001 0000277C 00000000                	dd 0
  6002                                  
  6003                                  Credits:
  6004 00002780 564741205741562050-     	db 'VGA WAV Player for TRDOS 386 by Erdogan Tan. '
  6004 00002789 6C6179657220666F72-
  6004 00002792 205452444F53203338-
  6004 0000279B 36206279204572646F-
  6004 000027A4 67616E2054616E2E20 
  6005                                  	;db 'December 2024.', 10,13,0
  6006 000027AD 4A616E756172792032-     	db 'January 2025.', 10,13,0
  6006 000027B6 3032352E0A0D00     
  6007                                  	;;db '22/12/2024', 10,13
  6008                                  	;db '17/01/2025', 10,13
  6009 000027BD 32332F30312F323032-     	db '23/01/2025', 10,13
  6009 000027C6 350A0D             
  6010                                  ; 15/11/2024
  6011                                  reset:
  6012 000027C9 00                      	db 0
  6013                                  
  6014                                  msgAudioCardInfo:
  6015 000027CA 666F7220496E74656C-     	db 'for Intel AC97 (ICH) Audio Controller.', 10,13,0
  6015 000027D3 204143393720284943-
  6015 000027DC 482920417564696F20-
  6015 000027E5 436F6E74726F6C6C65-
  6015 000027EE 722E0A0D00         
  6016                                  
  6017                                  	; 21/12/2024
  6018                                  msg_usage:
  6019 000027F3 75736167653A206470-     	db 'usage: dplayvga filename.wav',10,13,0
  6019 000027FC 6C6179766761206669-
  6019 00002805 6C656E616D652E7761-
  6019 0000280E 760A0D00           
  6020                                  
  6021                                  noDevMsg:
  6022 00002812 4572726F723A20556E-     	db 'Error: Unable to find AC97 audio device!'
  6022 0000281B 61626C6520746F2066-
  6022 00002824 696E64204143393720-
  6022 0000282D 617564696F20646576-
  6022 00002836 69636521           
  6023 0000283A 0A0D00                  	db 10,13,0
  6024                                  
  6025                                  noFileErrMsg:
  6026 0000283D 4572726F723A206669-     	db 'Error: file not found.',10,13,0
  6026 00002846 6C65206E6F7420666F-
  6026 0000284F 756E642E0A0D00     
  6027                                  
  6028                                  ; 07/12/2024
  6029                                  trdos386_err_msg:
  6030 00002856 5452444F5320333836-     	db 'TRDOS 386 System call error !',10,13,0
  6030 0000285F 2053797374656D2063-
  6030 00002868 616C6C206572726F72-
  6030 00002871 20210A0D00         
  6031                                  
  6032                                  ; 29/05/2024
  6033                                  ; 11/11/2023
  6034                                  msg_init_err:
  6035 00002876 0D0A                    	db CR, LF
  6036 00002878 4143393720436F6E74-     	db 'AC97 Controller/Codec initialization error !'
  6036 00002881 726F6C6C65722F436F-
  6036 0000288A 64656320696E697469-
  6036 00002893 616C697A6174696F6E-
  6036 0000289C 206572726F722021   
  6037 000028A4 0D0A00                  	db CR, LF, 0 ; 07/12/2024
  6038                                  
  6039                                  ; 25/11/2023
  6040                                  msg_no_vra:
  6041 000028A7 0A0D                    	db 10,13
  6042 000028A9 4E6F20565241207375-     	db 'No VRA support ! Only 48 kHZ sample rate supported !'
  6042 000028B2 70706F72742021204F-
  6042 000028BB 6E6C79203438206B48-
  6042 000028C4 5A2073616D706C6520-
  6042 000028CD 726174652073757070-
  6042 000028D6 6F727465642021     
  6043 000028DD 0A0D00                  	db 10,13,0
  6044                                  
  6045                                  ; 19/11/2024
  6046                                  ; 03/06/2017
  6047                                  hex_chars:
  6048 000028E0 303132333435363738-     	db '0123456789ABCDEF', 0
  6048 000028E9 3941424344454600   
  6049                                  msgAC97Info:
  6050 000028F1 0D0A                    	db 0Dh, 0Ah
  6051 000028F3 204143393720417564-     	db ' AC97 Audio Controller & Codec Info', 0Dh, 0Ah 
  6051 000028FC 696F20436F6E74726F-
  6051 00002905 6C6C6572202620436F-
  6051 0000290E 64656320496E666F0D-
  6051 00002917 0A                 
  6052 00002918 2056656E646F722049-     	db ' Vendor ID: '
  6052 00002921 443A20             
  6053                                  msgVendorId:
  6054 00002924 303030306820446576-     	db '0000h Device ID: '
  6054 0000292D 6963652049443A20   
  6055                                  msgDevId:
  6056 00002935 30303030680D0A          	db '0000h', 0Dh, 0Ah
  6057 0000293C 204275733A20            	db ' Bus: '
  6058                                  msgBusNo:
  6059 00002942 303068204465766963-     	db '00h Device: '
  6059 0000294B 653A20             
  6060                                  msgDevNo:
  6061 0000294E 3030682046756E6374-     	db '00h Function: '
  6061 00002957 696F6E3A20         
  6062                                  msgFncNo:
  6063 0000295C 303068                  	db '00h'
  6064 0000295F 0D0A                    	db 0Dh, 0Ah
  6065 00002961 204E414D4241523A20      	db ' NAMBAR: '
  6066                                  msgNamBar:
  6067 0000296A 30303030682020          	db '0000h  '
  6068 00002971 4E41424D4241523A20      	db 'NABMBAR: '
  6069                                  msgNabmBar:
  6070 0000297A 303030306820204952-     	db '0000h  IRQ: '
  6070 00002983 513A20             
  6071                                  msgIRQ:
  6072 00002986 3030                    	dw 3030h
  6073 00002988 0D0A00                  	db 0Dh, 0Ah, 0
  6074                                  ; 25/11/2023
  6075                                  msgVRAheader:
  6076 0000298B 205652412073757070-     	db ' VRA support: '
  6076 00002994 6F72743A20         
  6077 00002999 00                      	db 0	
  6078                                  msgVRAyes:
  6079 0000299A 5945530D0A00            	db 'YES', 0Dh, 0Ah, 0
  6080                                  msgVRAno:
  6081 000029A0 4E4F200D0A              	db 'NO ', 0Dh, 0Ah
  6082 000029A5 2028496E746572706F-     	db ' (Interpolated sample rate playing method)'
  6082 000029AE 6C617465642073616D-
  6082 000029B7 706C65207261746520-
  6082 000029C0 706C6179696E67206D-
  6082 000029C9 6574686F6429       
  6083 000029CF 0D0A00                  	db 0Dh, 0Ah, 0
  6084                                  
  6085 000029D2 90<rep 2h>              align 4
  6086                                  
  6087                                  ; -------------------------------------------------------------
  6088                                  
  6089                                  	; 21/12/2024
  6090                                  SplashScreen:
  6091 000029D4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6091 000029DD 202020202020202020-
  6091 000029E6 202020202020202020-
  6091 000029EF 202020202020202020-
  6091 000029F8 202020202020202020-
  6091 00002A01 202020202020202020-
  6091 00002A0A 202020202020202020-
  6091 00002A13 202020202020202020-
  6091 00002A1C 2020202020DDDBDE   
  6092 00002A24 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6092 00002A2D 202020202020202020-
  6092 00002A36 202020202020202020-
  6092 00002A3F 202020202020202020-
  6092 00002A48 202020202020202020-
  6092 00002A51 202020202020202020-
  6092 00002A5A 202020202020202020-
  6092 00002A63 202020202020202020-
  6092 00002A6C 2020202020DDDBDE   
  6093 00002A74 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6093 00002A7D 202020202020202020-
  6093 00002A86 202020202020202020-
  6093 00002A8F 202020202020202020-
  6093 00002A98 202020202020202020-
  6093 00002AA1 202020202020202020-
  6093 00002AAA 202020202020202020-
  6093 00002AB3 202020202020202020-
  6093 00002ABC 2020202020DDDBDE   
  6094 00002AC4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6094 00002ACD 202020202020202020-
  6094 00002AD6 202020202020202020-
  6094 00002ADF 202020202020202020-
  6094 00002AE8 202020202020202020-
  6094 00002AF1 202020202020202020-
  6094 00002AFA 202020202020202020-
  6094 00002B03 202020202020202020-
  6094 00002B0C 2020202020DDDBDE   
  6095 00002B14 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6095 00002B1D 202020202020202020-
  6095 00002B26 202020202020202020-
  6095 00002B2F 202020202020202020-
  6095 00002B38 202020202020202020-
  6095 00002B41 202020202020202020-
  6095 00002B4A 202020202020202020-
  6095 00002B53 202020202020202020-
  6095 00002B5C 2020202020DDDBDE   
  6096 00002B64 DDDBDE202020202020-     	db  221, 219, 222, "                     _______   ______        _______.                     ", 221, 219, 222
  6096 00002B6D 202020202020202020-
  6096 00002B76 2020202020205F5F5F-
  6096 00002B7F 5F5F5F5F2020205F5F-
  6096 00002B88 5F5F5F5F2020202020-
  6096 00002B91 2020205F5F5F5F5F5F-
  6096 00002B9A 5F2E20202020202020-
  6096 00002BA3 202020202020202020-
  6096 00002BAC 2020202020DDDBDE   
  6097 00002BB4 DDDBDE202020202020-     	db  221, 219, 222, "                    |       \ /  __  \      /       |                     ", 221, 219, 222
  6097 00002BBD 202020202020202020-
  6097 00002BC6 20202020207C202020-
  6097 00002BCF 202020205C202F2020-
  6097 00002BD8 5F5F20205C20202020-
  6097 00002BE1 20202F202020202020-
  6097 00002BEA 207C20202020202020-
  6097 00002BF3 202020202020202020-
  6097 00002BFC 2020202020DDDBDE   
  6098 00002C04 DDDBDE202020202020-     	db  221, 219, 222, "                    |  .--.  |  |  |  |    |   (----`                     ", 221, 219, 222
  6098 00002C0D 202020202020202020-
  6098 00002C16 20202020207C20202E-
  6098 00002C1F 2D2D2E20207C20207C-
  6098 00002C28 20207C20207C202020-
  6098 00002C31 207C202020282D2D2D-
  6098 00002C3A 2D6020202020202020-
  6098 00002C43 202020202020202020-
  6098 00002C4C 2020202020DDDBDE   
  6099 00002C54 DDDBDE202020202020-     	db  221, 219, 222, "                    |  |  |  |  |  |  |     \   \                         ", 221, 219, 222
  6099 00002C5D 202020202020202020-
  6099 00002C66 20202020207C20207C-
  6099 00002C6F 20207C20207C20207C-
  6099 00002C78 20207C20207C202020-
  6099 00002C81 20205C2020205C2020-
  6099 00002C8A 202020202020202020-
  6099 00002C93 202020202020202020-
  6099 00002C9C 2020202020DDDBDE   
  6100 00002CA4 DDDBDE202020202020-     	db  221, 219, 222, "                    |  '--'  |  `--'  | .----)   |                        ", 221, 219, 222
  6100 00002CAD 202020202020202020-
  6100 00002CB6 20202020207C202027-
  6100 00002CBF 2D2D2720207C202060-
  6100 00002CC8 2D2D2720207C202E2D-
  6100 00002CD1 2D2D2D292020207C20-
  6100 00002CDA 202020202020202020-
  6100 00002CE3 202020202020202020-
  6100 00002CEC 2020202020DDDBDE   
  6101 00002CF4 DDDBDE202020202020-     	db  221, 219, 222, "                    |_______/ \______/  |_______/                         ", 221, 219, 222
  6101 00002CFD 202020202020202020-
  6101 00002D06 20202020207C5F5F5F-
  6101 00002D0F 5F5F5F5F2F205C5F5F-
  6101 00002D18 5F5F5F5F2F20207C5F-
  6101 00002D21 5F5F5F5F5F5F2F2020-
  6101 00002D2A 202020202020202020-
  6101 00002D33 202020202020202020-
  6101 00002D3C 2020202020DDDBDE   
  6102 00002D44 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6102 00002D4D 202020202020202020-
  6102 00002D56 202020202020202020-
  6102 00002D5F 202020202020202020-
  6102 00002D68 202020202020202020-
  6102 00002D71 202020202020202020-
  6102 00002D7A 202020202020202020-
  6102 00002D83 202020202020202020-
  6102 00002D8C 2020202020DDDBDE   
  6103 00002D94 DDDBDE20202020202E-     	db  221, 219, 222, "     .______    __          ___   ____    ____  _______ .______           ", 221, 219, 222
  6103 00002D9D 5F5F5F5F5F5F202020-
  6103 00002DA6 205F5F202020202020-
  6103 00002DAF 202020205F5F5F2020-
  6103 00002DB8 205F5F5F5F20202020-
  6103 00002DC1 5F5F5F5F20205F5F5F-
  6103 00002DCA 5F5F5F5F202E5F5F5F-
  6103 00002DD3 5F5F5F202020202020-
  6103 00002DDC 2020202020DDDBDE   
  6104 00002DE4 DDDBDE20202020207C-     	db  221, 219, 222, "     |   _  \  |  |        /   \  \   \  /   / |   ____||   _  \          ", 221, 219, 222
  6104 00002DED 2020205F20205C2020-
  6104 00002DF6 7C20207C2020202020-
  6104 00002DFF 2020202F2020205C20-
  6104 00002E08 205C2020205C20202F-
  6104 00002E11 2020202F207C202020-
  6104 00002E1A 5F5F5F5F7C7C202020-
  6104 00002E23 5F20205C2020202020-
  6104 00002E2C 2020202020DDDBDE   
  6105 00002E34 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |_)  | |  |       /  ^  \  \   \/   /  |  |__   |  |_)  |         ", 221, 219, 222
  6105 00002E3D 20207C5F2920207C20-
  6105 00002E46 7C20207C2020202020-
  6105 00002E4F 20202F20205E20205C-
  6105 00002E58 20205C2020205C2F20-
  6105 00002E61 20202F20207C20207C-
  6105 00002E6A 5F5F2020207C20207C-
  6105 00002E73 5F2920207C20202020-
  6105 00002E7C 2020202020DDDBDE   
  6106 00002E84 DDDBDE20202020207C-     	db  221, 219, 222, "     |   ___/  |  |      /  /_\  \  \_    _/   |   __|  |      /          ", 221, 219, 222
  6106 00002E8D 2020205F5F5F2F2020-
  6106 00002E96 7C20207C2020202020-
  6106 00002E9F 202F20202F5F5C2020-
  6106 00002EA8 5C20205C5F20202020-
  6106 00002EB1 5F2F2020207C202020-
  6106 00002EBA 5F5F7C20207C202020-
  6106 00002EC3 2020202F2020202020-
  6106 00002ECC 2020202020DDDBDE   
  6107 00002ED4 DDDBDE20202020207C-     	db  221, 219, 222, "     |  |      |  `----./  _____  \   |  |     |  |____ |  |\  \----.     ", 221, 219, 222
  6107 00002EDD 20207C202020202020-
  6107 00002EE6 7C2020602D2D2D2D2E-
  6107 00002EEF 2F20205F5F5F5F5F20-
  6107 00002EF8 205C2020207C20207C-
  6107 00002F01 20202020207C20207C-
  6107 00002F0A 5F5F5F5F207C20207C-
  6107 00002F13 5C20205C2D2D2D2D2E-
  6107 00002F1C 2020202020DDDBDE   
  6108 00002F24 DDDBDE20202020207C-     	db  221, 219, 222, "     | _|      |_______/__/     \__\  |__|     |_______|| _| `._____|     ", 221, 219, 222
  6108 00002F2D 205F7C202020202020-
  6108 00002F36 7C5F5F5F5F5F5F5F2F-
  6108 00002F3F 5F5F2F20202020205C-
  6108 00002F48 5F5F5C20207C5F5F7C-
  6108 00002F51 20202020207C5F5F5F-
  6108 00002F5A 5F5F5F5F7C7C205F7C-
  6108 00002F63 20602E5F5F5F5F5F7C-
  6108 00002F6C 2020202020DDDBDE   
  6109 00002F74 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6109 00002F7D 202020202020202020-
  6109 00002F86 202020202020202020-
  6109 00002F8F 202020202020202020-
  6109 00002F98 202020202020202020-
  6109 00002FA1 202020202020202020-
  6109 00002FAA 202020202020202020-
  6109 00002FB3 202020202020202020-
  6109 00002FBC 2020202020DDDBDE   
  6110 00002FC4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6110 00002FCD 202020202020202020-
  6110 00002FD6 202020202020202020-
  6110 00002FDF 202020202020202020-
  6110 00002FE8 202020202020202020-
  6110 00002FF1 202020202020202020-
  6110 00002FFA 202020202020202020-
  6110 00003003 202020202020202020-
  6110 0000300C 2020202020DDDBDE   
  6111 00003014 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6111 0000301D 202020202020202020-
  6111 00003026 202020202020202020-
  6111 0000302F 202020202020202020-
  6111 00003038 202020202020202020-
  6111 00003041 202020202020202020-
  6111 0000304A 202020202020202020-
  6111 00003053 202020202020202020-
  6111 0000305C 2020202020DDDBDE   
  6112 00003064 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6112 0000306D 202020202020202020-
  6112 00003076 202020202020202020-
  6112 0000307F 202020202020202020-
  6112 00003088 202020202020202020-
  6112 00003091 202020202020202020-
  6112 0000309A 202020202020202020-
  6112 000030A3 202020202020202020-
  6112 000030AC 2020202020DDDBDE   
  6113 000030B4 DDDBDE202020202020-     	db  221, 219, 222, "                                WELCOME TO                                ", 221, 219, 222
  6113 000030BD 202020202020202020-
  6113 000030C6 202020202020202020-
  6113 000030CF 202020202020202057-
  6113 000030D8 454C434F4D4520544F-
  6113 000030E1 202020202020202020-
  6113 000030EA 202020202020202020-
  6113 000030F3 202020202020202020-
  6113 000030FC 2020202020DDDBDE   
  6114 00003104 DDDBDE202020202020-     	db  221, 219, 222, "                                DOS PLAYER                                ", 221, 219, 222
  6114 0000310D 202020202020202020-
  6114 00003116 202020202020202020-
  6114 0000311F 202020202020202044-
  6114 00003128 4F5320504C41594552-
  6114 00003131 202020202020202020-
  6114 0000313A 202020202020202020-
  6114 00003143 202020202020202020-
  6114 0000314C 2020202020DDDBDE   
  6115 00003154 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6115 0000315D 202020202020202020-
  6115 00003166 202020202020202020-
  6115 0000316F 202020202020202020-
  6115 00003178 202020202020202020-
  6115 00003181 202020202020202020-
  6115 0000318A 202020202020202020-
  6115 00003193 202020202020202020-
  6115 0000319C 2020202020DDDBDE   
  6116 000031A4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6116 000031AD 202020202020202020-
  6116 000031B6 202020202020202020-
  6116 000031BF 202020202020202020-
  6116 000031C8 202020202020202020-
  6116 000031D1 202020202020202020-
  6116 000031DA 202020202020202020-
  6116 000031E3 202020202020202020-
  6116 000031EC 2020202020DDDBDE   
  6117 000031F4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6117 000031FD 202020202020202020-
  6117 00003206 202020202020202020-
  6117 0000320F 202020202020202020-
  6117 00003218 202020202020202020-
  6117 00003221 202020202020202020-
  6117 0000322A 202020202020202020-
  6117 00003233 202020202020202020-
  6117 0000323C 2020202020DDDBDE   
  6118 00003244 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6118 0000324D 202020202020202020-
  6118 00003256 202020202020202020-
  6118 0000325F 202020202020202020-
  6118 00003268 202020202020202020-
  6118 00003271 202020202020202020-
  6118 0000327A 202020202020202020-
  6118 00003283 202020202020202020-
  6118 0000328C 2020202020DDDBDE   
  6119 00003294 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6119 0000329D 202020202020202020-
  6119 000032A6 202020202020202020-
  6119 000032AF 202020202020202020-
  6119 000032B8 202020202020202020-
  6119 000032C1 202020202020202020-
  6119 000032CA 202020202020202020-
  6119 000032D3 202020202020202020-
  6119 000032DC 2020202020DDDBDE   
  6120 000032E4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6120 000032ED 202020202020202020-
  6120 000032F6 202020202020202020-
  6120 000032FF 202020202020202020-
  6120 00003308 202020202020202020-
  6120 00003311 202020202020202020-
  6120 0000331A 202020202020202020-
  6120 00003323 202020202020202020-
  6120 0000332C 2020202020DDDBDE   
  6121 00003334 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6121 0000333D 202020202020202020-
  6121 00003346 202020202020202020-
  6121 0000334F 202020202020202020-
  6121 00003358 202020202020202020-
  6121 00003361 202020202020202020-
  6121 0000336A 202020202020202020-
  6121 00003373 202020202020202020-
  6121 0000337C 2020202020DDDBDE   
  6122 00003384 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6122 0000338D 202020202020202020-
  6122 00003396 202020202020202020-
  6122 0000339F 202020202020202020-
  6122 000033A8 202020202020202020-
  6122 000033B1 202020202020202020-
  6122 000033BA 202020202020202020-
  6122 000033C3 202020202020202020-
  6122 000033CC 2020202020DDDBDE   
  6123 000033D4 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6123 000033DD 202020202020202020-
  6123 000033E6 202020202020202020-
  6123 000033EF 202020202020202020-
  6123 000033F8 202020202020202020-
  6123 00003401 202020202020202020-
  6123 0000340A 202020202020202020-
  6123 00003413 202020202020202020-
  6123 0000341C 2020202020DDDBDE   
  6124 00003424 DDDBDE202020202020-     	db  221, 219, 222, "                                                                          ", 221, 219, 222
  6124 0000342D 202020202020202020-
  6124 00003436 202020202020202020-
  6124 0000343F 202020202020202020-
  6124 00003448 202020202020202020-
  6124 00003451 202020202020202020-
  6124 0000345A 202020202020202020-
  6124 00003463 202020202020202020-
  6124 0000346C 2020202020DDDBDE   
  6125 00003474 00                      	db 0
  6126                                  
  6127                                  ; -------------------------------------------------------------
  6128                                  
  6129                                  	; 22/12/2024
  6130                                  	; 21/12/2024
  6131                                  PlayingScreen:
  6132 00003475 DBDBDBDBDBDBDBDBDB-     	db  34 dup(219), " DOS Player ", 34 dup(219)
  6132 0000347E DBDBDBDBDBDBDBDBDB-
  6132 00003487 DBDBDBDBDBDBDBDBDB-
  6132 00003490 DBDBDBDBDBDBDB2044-
  6132 00003499 4F5320506C61796572-
  6132 000034A2 20DBDBDBDBDBDBDBDB-
  6132 000034AB DBDBDBDBDBDBDBDBDB-
  6132 000034B4 DBDBDBDBDBDBDBDBDB-
  6132 000034BD DBDBDBDBDBDBDBDB   
  6133 000034C5 C9CDCDCDCDCDCDCDCD-     	db  201, 78 dup(205), 187
  6133 000034CE CDCDCDCDCDCDCDCDCD-
  6133 000034D7 CDCDCDCDCDCDCDCDCD-
  6133 000034E0 CDCDCDCDCDCDCDCDCD-
  6133 000034E9 CDCDCDCDCDCDCDCDCD-
  6133 000034F2 CDCDCDCDCDCDCDCDCD-
  6133 000034FB CDCDCDCDCDCDCDCDCD-
  6133 00003504 CDCDCDCDCDCDCDCDCD-
  6133 0000350D CDCDCDCDCDCDCDBB   
  6134 00003515 BA2020202020202020-     	db  186, 33 dup(32), " User Guide ", 33 dup(32), 186
  6134 0000351E 202020202020202020-
  6134 00003527 202020202020202020-
  6134 00003530 202020202020202055-
  6134 00003539 736572204775696465-
  6134 00003542 202020202020202020-
  6134 0000354B 202020202020202020-
  6134 00003554 202020202020202020-
  6134 0000355D 20202020202020BA   
  6135 00003565 BA2020202020203C53-     	db  186, 6  dup(32), "<Space>         Play/Pause    ", 4 dup(32), "<H>             Hardware Info", 9 dup(32), 186
  6135 0000356E 706163653E20202020-
  6135 00003577 2020202020506C6179-
  6135 00003580 2F5061757365202020-
  6135 00003589 20202020203C483E20-
  6135 00003592 202020202020202020-
  6135 0000359B 202020486172647761-
  6135 000035A4 726520496E666F2020-
  6135 000035AD 20202020202020BA   
  6136 000035B5 BA2020202020203C53-     	db  186, 6  dup(32), "<S>             Stop          ", 4 dup(32), "<Enter>         Wave Lighting", 9 dup(32), 186
  6136 000035BE 3E2020202020202020-
  6136 000035C7 202020202053746F70-
  6136 000035D0 202020202020202020-
  6136 000035D9 20202020203C456E74-
  6136 000035E2 65723E202020202020-
  6136 000035EB 20202057617665204C-
  6136 000035F4 69676874696E672020-
  6136 000035FD 20202020202020BA   
  6137 00003605 BA2020202020203C46-     	db  186, 6  dup(32), "<F>             Forwards      ", 4 dup(32), "<+>/<->         Inc/Dec Volume", 8 dup(32), 186
  6137 0000360E 3E2020202020202020-
  6137 00003617 2020202020466F7277-
  6137 00003620 617264732020202020-
  6137 00003629 20202020203C2B3E2F-
  6137 00003632 3C2D3E202020202020-
  6137 0000363B 202020496E632F4465-
  6137 00003644 6320566F6C756D6520-
  6137 0000364D 20202020202020BA   
  6138 00003655 BA2020202020203C42-     	db  186, 6  dup(32), "<B>             Backwards     ", 4 dup(32), "<Q>             Quit Program ", 9 dup(32), 186
  6138 0000365E 3E2020202020202020-
  6138 00003667 20202020204261636B-
  6138 00003670 776172647320202020-
  6138 00003679 20202020203C513E20-
  6138 00003682 202020202020202020-
  6138 0000368B 202020517569742050-
  6138 00003694 726F6772616D202020-
  6138 0000369D 20202020202020BA   
  6139 000036A5 CCCDCDCDCDCDCDCDCD-     	db  204, 78 dup(205), 185
  6139 000036AE CDCDCDCDCDCDCDCDCD-
  6139 000036B7 CDCDCDCDCDCDCDCDCD-
  6139 000036C0 CDCDCDCDCDCDCDCDCD-
  6139 000036C9 CDCDCDCDCDCDCDCDCD-
  6139 000036D2 CDCDCDCDCDCDCDCDCD-
  6139 000036DB CDCDCDCDCDCDCDCDCD-
  6139 000036E4 CDCDCDCDCDCDCDCDCD-
  6139 000036ED CDCDCDCDCDCDCDB9   
  6140 000036F5 BA2020202020204669-     	db  186, 6  dup(32), "File Name :                   ", 4 dup(32), "Bit-Rate  :     0  Bits      ", 9 dup(32), 186
  6140 000036FE 6C65204E616D65203A-
  6140 00003707 202020202020202020-
  6140 00003710 202020202020202020-
  6140 00003719 20202020204269742D-
  6140 00003722 5261746520203A2020-
  6140 0000372B 202020302020426974-
  6140 00003734 732020202020202020-
  6140 0000373D 20202020202020BA   
  6141 00003745 BA2020202020204672-     	db  186, 6  dup(32), "Frequency :     0     Hz      ", 4 dup(32), "#-Channels:     0            ", 9 dup(32), 186
  6141 0000374E 657175656E6379203A-
  6141 00003757 202020202030202020-
  6141 00003760 2020487A2020202020-
  6141 00003769 2020202020232D4368-
  6141 00003772 616E6E656C733A2020-
  6141 0000377B 202020302020202020-
  6141 00003784 202020202020202020-
  6141 0000378D 20202020202020BA   
  6142 00003795 C8CDCDCDCDCDCDCDCD-     	db  200, 78 dup(205), 188
  6142 0000379E CDCDCDCDCDCDCDCDCD-
  6142 000037A7 CDCDCDCDCDCDCDCDCD-
  6142 000037B0 CDCDCDCDCDCDCDCDCD-
  6142 000037B9 CDCDCDCDCDCDCDCDCD-
  6142 000037C2 CDCDCDCDCDCDCDCDCD-
  6142 000037CB CDCDCDCDCDCDCDCDCD-
  6142 000037D4 CDCDCDCDCDCDCDCDCD-
  6142 000037DD CDCDCDCDCDCDCDBC   
  6143 000037E5 202020202020202020-     	db  80 dup(32)
  6143 000037EE 202020202020202020-
  6143 000037F7 202020202020202020-
  6143 00003800 202020202020202020-
  6143 00003809 202020202020202020-
  6143 00003812 202020202020202020-
  6143 0000381B 202020202020202020-
  6143 00003824 202020202020202020-
  6143 0000382D 2020202020202020   
  6144                                  improper_samplerate_txt:
  6145                                  read_error_txt:
  6146 00003835 202020202020202020-     	db  80 dup(32)
  6146 0000383E 202020202020202020-
  6146 00003847 202020202020202020-
  6146 00003850 202020202020202020-
  6146 00003859 202020202020202020-
  6146 00003862 202020202020202020-
  6146 0000386B 202020202020202020-
  6146 00003874 202020202020202020-
  6146 0000387D 2020202020202020   
  6147 00003885 202020202020202020-     	db  80 dup(32)
  6147 0000388E 202020202020202020-
  6147 00003897 202020202020202020-
  6147 000038A0 202020202020202020-
  6147 000038A9 202020202020202020-
  6147 000038B2 202020202020202020-
  6147 000038BB 202020202020202020-
  6147 000038C4 202020202020202020-
  6147 000038CD 2020202020202020   
  6148 000038D5 202020202020202020-     	db  80 dup(32)
  6148 000038DE 202020202020202020-
  6148 000038E7 202020202020202020-
  6148 000038F0 202020202020202020-
  6148 000038F9 202020202020202020-
  6148 00003902 202020202020202020-
  6148 0000390B 202020202020202020-
  6148 00003914 202020202020202020-
  6148 0000391D 2020202020202020   
  6149 00003925 202020202020202020-     	db  80 dup(32)
  6149 0000392E 202020202020202020-
  6149 00003937 202020202020202020-
  6149 00003940 202020202020202020-
  6149 00003949 202020202020202020-
  6149 00003952 202020202020202020-
  6149 0000395B 202020202020202020-
  6149 00003964 202020202020202020-
  6149 0000396D 2020202020202020   
  6150 00003975 202020202020202020-     	db  80 dup(32)
  6150 0000397E 202020202020202020-
  6150 00003987 202020202020202020-
  6150 00003990 202020202020202020-
  6150 00003999 202020202020202020-
  6150 000039A2 202020202020202020-
  6150 000039AB 202020202020202020-
  6150 000039B4 202020202020202020-
  6150 000039BD 2020202020202020   
  6151 000039C5 202020202020202020-     	db  80 dup(32)
  6151 000039CE 202020202020202020-
  6151 000039D7 202020202020202020-
  6151 000039E0 202020202020202020-
  6151 000039E9 202020202020202020-
  6151 000039F2 202020202020202020-
  6151 000039FB 202020202020202020-
  6151 00003A04 202020202020202020-
  6151 00003A0D 2020202020202020   
  6152 00003A15 202020202020202020-     	db  80 dup(32)
  6152 00003A1E 202020202020202020-
  6152 00003A27 202020202020202020-
  6152 00003A30 202020202020202020-
  6152 00003A39 202020202020202020-
  6152 00003A42 202020202020202020-
  6152 00003A4B 202020202020202020-
  6152 00003A54 202020202020202020-
  6152 00003A5D 2020202020202020   
  6153 00003A65 202020202020202020-     	db  80 dup(32)
  6153 00003A6E 202020202020202020-
  6153 00003A77 202020202020202020-
  6153 00003A80 202020202020202020-
  6153 00003A89 202020202020202020-
  6153 00003A92 202020202020202020-
  6153 00003A9B 202020202020202020-
  6153 00003AA4 202020202020202020-
  6153 00003AAD 2020202020202020   
  6154 00003AB5 202020202020202020-     	db  80 dup(32)
  6154 00003ABE 202020202020202020-
  6154 00003AC7 202020202020202020-
  6154 00003AD0 202020202020202020-
  6154 00003AD9 202020202020202020-
  6154 00003AE2 202020202020202020-
  6154 00003AEB 202020202020202020-
  6154 00003AF4 202020202020202020-
  6154 00003AFD 2020202020202020   
  6155 00003B05 202020202020202020-     	db  80 dup(32)
  6155 00003B0E 202020202020202020-
  6155 00003B17 202020202020202020-
  6155 00003B20 202020202020202020-
  6155 00003B29 202020202020202020-
  6155 00003B32 202020202020202020-
  6155 00003B3B 202020202020202020-
  6155 00003B44 202020202020202020-
  6155 00003B4D 2020202020202020   
  6156 00003B55 202020202020202020-     	db  80 dup(32)
  6156 00003B5E 202020202020202020-
  6156 00003B67 202020202020202020-
  6156 00003B70 202020202020202020-
  6156 00003B79 202020202020202020-
  6156 00003B82 202020202020202020-
  6156 00003B8B 202020202020202020-
  6156 00003B94 202020202020202020-
  6156 00003B9D 2020202020202020   
  6157 00003BA5 202020202020202020-     	db  80 dup(32)
  6157 00003BAE 202020202020202020-
  6157 00003BB7 202020202020202020-
  6157 00003BC0 202020202020202020-
  6157 00003BC9 202020202020202020-
  6157 00003BD2 202020202020202020-
  6157 00003BDB 202020202020202020-
  6157 00003BE4 202020202020202020-
  6157 00003BED 2020202020202020   
  6158 00003BF5 202020202020202020-     	db  80 dup(32)
  6158 00003BFE 202020202020202020-
  6158 00003C07 202020202020202020-
  6158 00003C10 202020202020202020-
  6158 00003C19 202020202020202020-
  6158 00003C22 202020202020202020-
  6158 00003C2B 202020202020202020-
  6158 00003C34 202020202020202020-
  6158 00003C3D 2020202020202020   
  6159 00003C45 202020202020202020-     	db  80 dup(32)
  6159 00003C4E 202020202020202020-
  6159 00003C57 202020202020202020-
  6159 00003C60 202020202020202020-
  6159 00003C69 202020202020202020-
  6159 00003C72 202020202020202020-
  6159 00003C7B 202020202020202020-
  6159 00003C84 202020202020202020-
  6159 00003C8D 2020202020202020   
  6160 00003C95 202020202020202020-     	db  80 dup(32)
  6160 00003C9E 202020202020202020-
  6160 00003CA7 202020202020202020-
  6160 00003CB0 202020202020202020-
  6160 00003CB9 202020202020202020-
  6160 00003CC2 202020202020202020-
  6160 00003CCB 202020202020202020-
  6160 00003CD4 202020202020202020-
  6160 00003CDD 2020202020202020   
  6161 00003CE5 202020202020202020-     	db  80 dup(32)
  6161 00003CEE 202020202020202020-
  6161 00003CF7 202020202020202020-
  6161 00003D00 202020202020202020-
  6161 00003D09 202020202020202020-
  6161 00003D12 202020202020202020-
  6161 00003D1B 202020202020202020-
  6161 00003D24 202020202020202020-
  6161 00003D2D 2020202020202020   
  6162 00003D35 202020202020202020-     	db  80 dup(32)
  6162 00003D3E 202020202020202020-
  6162 00003D47 202020202020202020-
  6162 00003D50 202020202020202020-
  6162 00003D59 202020202020202020-
  6162 00003D62 202020202020202020-
  6162 00003D6B 202020202020202020-
  6162 00003D74 202020202020202020-
  6162 00003D7D 2020202020202020   
  6163 00003D85 202020202020202020-     	db  80 dup(32)
  6163 00003D8E 202020202020202020-
  6163 00003D97 202020202020202020-
  6163 00003DA0 202020202020202020-
  6163 00003DA9 202020202020202020-
  6163 00003DB2 202020202020202020-
  6163 00003DBB 202020202020202020-
  6163 00003DC4 202020202020202020-
  6163 00003DCD 2020202020202020   
  6164 00003DD5 CDCDCDCDCDCDCDCDCD-     	db  80 dup(205)
  6164 00003DDE CDCDCDCDCDCDCDCDCD-
  6164 00003DE7 CDCDCDCDCDCDCDCDCD-
  6164 00003DF0 CDCDCDCDCDCDCDCDCD-
  6164 00003DF9 CDCDCDCDCDCDCDCDCD-
  6164 00003E02 CDCDCDCDCDCDCDCDCD-
  6164 00003E0B CDCDCDCDCDCDCDCDCD-
  6164 00003E14 CDCDCDCDCDCDCDCDCD-
  6164 00003E1D CDCDCDCDCDCDCDCD   
  6165 00003E25 202020202020202020-     	db  80 dup(32)
  6165 00003E2E 202020202020202020-
  6165 00003E37 202020202020202020-
  6165 00003E40 202020202020202020-
  6165 00003E49 202020202020202020-
  6165 00003E52 202020202020202020-
  6165 00003E5B 202020202020202020-
  6165 00003E64 202020202020202020-
  6165 00003E6D 2020202020202020   
  6166 00003E75 202020202020202020-     	db  33 dup(32), "00:00 ", 174, 175, " 00:00", 24 dup(32), "VOL 000%"
  6166 00003E7E 202020202020202020-
  6166 00003E87 202020202020202020-
  6166 00003E90 20202020202030303A-
  6166 00003E99 303020AEAF2030303A-
  6166 00003EA2 303020202020202020-
  6166 00003EAB 202020202020202020-
  6166 00003EB4 202020202020202056-
  6166 00003EBD 4F4C2030303025     
  6167 00003EC4 00                      	db 0
  6168                                  
  6169                                  ; -------------------------------------------------------------
  6170                                  	
  6171                                  program_msg:
  6172 00003EC5 5452444F5320333836-     	db "TRDOS 386 v2.0.9 - ('sysvideo') Test Program - Dos Player"
  6172 00003ECE 2076322E302E39202D-
  6172 00003ED7 202827737973766964-
  6172 00003EE0 656F27292054657374-
  6172 00003EE9 2050726F6772616D20-
  6172 00003EF2 2D20446F7320506C61-
  6172 00003EFB 796572             
  6173 00003EFE 0D0A                    	db 0Dh, 0Ah
  6174 00003F00 6279204572646F6761-     	db "by Erdogan Tan - 22/12/2024"
  6174 00003F09 6E2054616E202D2032-
  6174 00003F12 322F31322F32303234 
  6175 00003F1B 0D0A0D0A                	db 0Dh, 0Ah, 0Dh, 0Ah
  6176                                  
  6177 00003F1F 507265737320455343-     	db "Press ESC to exit .."
  6177 00003F28 20746F206578697420-
  6177 00003F31 2E2E               
  6178 00003F33 0D0A                    	db 0Dh, 0Ah
  6179 00003F35 0D0A                    	db 0Dh, 0Ah
  6180 00003F37 507265737320616E79-     	db "Press any key to continue .."
  6180 00003F40 206B657920746F2063-
  6180 00003F49 6F6E74696E7565202E-
  6180 00003F52 2E                 
  6181                                  nextline:
  6182 00003F53 0D0A00                  	db 0Dh, 0Ah, 0
  6183                                  
  6184                                  ; -------------------------------------------------------------
  6185                                  
  6186                                  	; 22/12/2024
  6187                                  fillblock:
  6188 00003F56 FF<rep Eh>              	times 14 db 0FFh
  6189 00003F64 0000                    	dw 0
  6190                                  
  6191                                  ; -------------------------------------------------------------
  6192                                  
  6193                                  ; 23/11/2024
  6194                                  colors:
  6195 00003F66 0F0B0A0C0E090D0F        	db 0Fh, 0Bh, 0Ah, 0Ch, 0Eh, 09h, 0Dh, 0Fh
  6196                                  	; white, cyan, green, red, yellow, blue, magenta
  6197 00003F6E 0B                      ccolor:	db 0Bh	; cyan
  6198                                  
  6199                                  EOF: 
  6200                                  
  6201                                  ; -------------------------------------------------------------
  6202                                  
  6203                                  bss:
  6204                                  
  6205                                  ABSOLUTE bss
  6206                                  
  6207 00003F6F ??                      alignb 4
  6208                                  
  6209                                  ; 21/12/2024
  6210                                  fontbuff1:
  6211 00003F70 <res E00h>              	resb 256*14 ; 8x14 font data (from system)
  6212                                  fontbuff2:
  6213 00004D70 <res 1000h>             	resb 256*16 ; 8x16 font data (modif. from 8x14)
  6214                                  
  6215                                  ; 11/12/2024
  6216                                  wleds_addr:
  6217 00005D70 <res 1400h>             	resd 80*16 ; 32 bit addrs, 80 leds, 16 volume levels
  6218                                  ; 22/12/2024
  6219                                  prev_leds:
  6220 00007170 <res 140h>              	resd 80	; previous lighting leds
  6221                                  
  6222                                  LFB_ADDR:
  6223 000072B0 ????????                	resd 1
  6224                                  ;nextrow:
  6225                                  	;resd 1
  6226                                  screenpos: ; hw = (cursor) row, lw = (cursor) column
  6227 000072B4 ????????                	resd 1
  6228 000072B8 ????????                wcolor:	resd 1
  6229 000072BC ??                      tcolor: resb 1 ; text color
  6230                                  columns:
  6231 000072BD ??                      	resb 1
  6232 000072BE ??                      pbprev:	resb 1 ; previous progress bar indicator position
  6233                                  
  6234 000072BF ??                      alignb 4
  6235                                  
  6236                                  bss_start:
  6237                                  
  6238                                  ; 18/11/2024
  6239                                  stopped:
  6240 000072C0 ??                      	resb 1
  6241 000072C1 ??                      tLO:	resb 1
  6242                                  ; 21/11/2024
  6243 000072C2 ??                      tLP:	resb 1
  6244                                  ; 19/11/2024
  6245 000072C3 ??                      wleds:	resb 1
  6246                                  wleds_dif:
  6247 000072C4 ????????                	resd 1
  6248 000072C8 ????????                pbuf_o:	resd 1
  6249                                  ; 07/12/2024
  6250 000072CC ??                      pbuf_s:	resb 1
  6251                                  
  6252                                  ; 07/12/2024
  6253                                  ; 24/11/2024
  6254                                  half_buffer:
  6255 000072CD ??                      	resb 1	; dma half buffer 1 or 2 (0 or 1)
  6256                                  
  6257                                  ; 30/05/2024
  6258 000072CE ??                      VRA:	resb 1	; Variable Rate Audio Support Status
  6259                                  
  6260                                  ; 30/11/2024
  6261 000072CF ??                      alignb 4
  6262                                  
  6263                                  ;;;;;;;;;;;;;;
  6264                                  ; 14/11/2024
  6265                                  ; (Ref: player.asm, Matan Alfasi, 2017)  
  6266                                  WAVFILEHEADERbuff:
  6267                                  RIFF_ChunkID:
  6268 000072D0 ????????                	resd 1	; Must be equal to "RIFF" - big-endian
  6269                                  		; 0x52494646
  6270                                  RIFF_ChunkSize:
  6271 000072D4 ????????                	resd 1	; Represents total file size, not 
  6272                                          	; including the first 2 fields 
  6273                                  		; (Total_File_Size - 8), little-endian
  6274                                  RIFF_Format:
  6275 000072D8 ????????                	resd 1	; Must be equal to "WAVE" - big-endian
  6276                                  		; 0x57415645
  6277                                  
  6278                                  ;; WAVE header parameters ("Sub-chunk")
  6279                                  WAVE_SubchunkID:
  6280 000072DC ????????                	resd 1	; Must be equal to "fmt " - big-endian
  6281                                  		; 0x666d7420
  6282                                  WAVE_SubchunkSize:
  6283 000072E0 ????????                	resd 1	; Represents total chunk size
  6284                                  WAVE_AudioFormat:
  6285 000072E4 ????                    	resw 1	; PCM (Raw) - is 1, other - is a form 
  6286                                  		; of compression, not supported.
  6287                                  WAVE_NumChannels:
  6288 000072E6 ????                    	resw 1	; Number of channels, Mono-1, Stereo-2
  6289                                  WAVE_SampleRate:
  6290 000072E8 ????????                	resd 1	; Frequency rate, in Hz (8000, 44100 ...)
  6291                                  WAVE_ByteRate:
  6292 000072EC ????????                	resd 1	; SampleRate * NumChannels * BytesPerSample
  6293                                  WAVE_BlockAlign:
  6294 000072F0 ????                    	resw 1	; NumChannels * BytesPerSample
  6295                                  		; Number of bytes for one sample.
  6296                                  WAVE_BitsPerSample:
  6297 000072F2 ????                    	resw 1	; 8 = 8 bits, 16 = 16 bits, etc.
  6298                                  
  6299                                  ;; DATA header parameters
  6300                                  DATA_SubchunkID:
  6301 000072F4 ????????                	resd 1	; Must be equal to "data" - big-endian
  6302                                          	; 0x64617461
  6303                                  DATA_SubchunkSize:
  6304 000072F8 ????????                	resd 1	; NumSamples * NumChannels * BytesPerSample
  6305                                          	; Number of bytes in the data.
  6306                                  ;;;;;;;;;;;;;;
  6307                                  
  6308                                  ; 15/11/2024
  6309                                  cursortype:
  6310 000072FC ????                    	resw 1
  6311 000072FE ??                      flags:	resb 1
  6312                                  ; 06/11/2023
  6313                                  ac97_int_ln_reg:
  6314 000072FF ??                      	resb 1
  6315                                  filehandle:
  6316 00007300 ????????                	resd 1
  6317                                  
  6318                                  ; 30/05/2024
  6319                                  wav_file_name:
  6320 00007304 <res 50h>               	resb 80	; wave file, path name (<= 80 bytes)
  6321 00007354 ????                    	resw 1	; 30/11/2024
  6322                                  
  6323                                  ; 08/11/2023
  6324                                  ; 07/11/2023
  6325                                  fbs_shift:
  6326 00007356 ??                      	resb 1
  6327                                  ; 07/12/2024
  6328 00007357 ??                      SRB:	resb 1
  6329                                  
  6330                                  ; 12/11/2016 - Erdogan Tan
  6331                                  bus_dev_fn:
  6332 00007358 ????????                	resd 1
  6333                                  dev_vendor:
  6334 0000735C ????????                	resd 1
  6335                                  
  6336                                  ; 17/02/2017
  6337                                  ; NAMBAR:  Native Audio Mixer Base Address Register
  6338                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 10h-13h
  6339                                  ; NABMBAR: Native Audio Bus Mastering Base Address register
  6340                                  ;    (ICH, Audio D31:F5, PCI Config Space) Address offset: 14h-17h
  6341 00007360 ????                    NAMBAR:	resw 1	; BAR for mixer
  6342                                  NABMBAR:
  6343 00007362 ????                    	resw 1	; BAR for bus master regs
  6344                                  
  6345                                  ; 15/11/2024
  6346                                  loadfromwavfile:
  6347 00007364 ????????                	resd 1	; 'loadfromfile' or load+conversion proc address
  6348                                  loadsize:
  6349 00007368 ????????                	resd 1	; (.wav file) read count (bytes) per one time
  6350                                  buffersize:
  6351 0000736C ????????                	resd 1	; 16 bit samples (not bytes)
  6352                                  		
  6353                                  ; 14/11/2024
  6354                                  TotalTime:
  6355 00007370 ????????                	resd 1	; Total (WAV File) Playing Time in seconds
  6356                                  ProgressTime:
  6357 00007374 ????????                	resd 1
  6358 00007378 ????????                count:	resd 1	; byte count of one (wav file) read
  6359                                  LoadedDataBytes:
  6360 0000737C ????????                	resd 1	; total read/load count
  6361                                  
  6362                                  timerticks:
  6363 00007380 ????????                	resd 1	; (to eliminate excessive lookup of events in tuneloop)
  6364                                  		; (in order to get the emulator/qemu to run correctly)
  6365                                  ; 14/11/2024	
  6366                                  bss_end:
  6367                                  
  6368                                  ; 02/12/2024
  6369 00007384 <res C7Ch>              alignb 4096
  6370                                  
  6371                                  ; 07/12/2024
  6372                                  ; 26/11/2023
  6373                                  audio_buffer:
  6374 00008000 <res 10000h>            	resb 65536  ; DMA Buffer Size / 2	
  6375                                  
  6376                                  ; 01/12/2024
  6377                                  ; 26/11/2023
  6378                                  temp_buffer:
  6379 00018000 <res 10000h>            	resb 65536  ;  rb BUFFERSIZE
